var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function i(){return Object.create(null)}function a(e){e.forEach(r)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function u(e,t,n,r){if(e){const i=c(e,t,n,r);return e[0](i)}}function c(e,t,r,i){return e[1]&&i?n(r.ctx.slice(),e[1](i(t))):r.ctx}function f(e,t,n,r,i,a,o){const s=function(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}(t,r,i,a);if(s){const i=c(t,n,r,o);e.p(i,s)}}function d(e){return null==e?"":e}const h="undefined"!=typeof window;let p=h?()=>window.performance.now():()=>Date.now(),m=h?e=>requestAnimationFrame(e):e;const g=new Set;function y(e){g.forEach((t=>{t.c(e)||(g.delete(t),t.f())})),0!==g.size&&m(y)}function v(e){let t;return 0===g.size&&m(y),{promise:new Promise((n=>{g.add(t={c:e,f:n})})),abort(){g.delete(t)}}}function b(e,t){e.appendChild(t)}function x(e,t,n){e.insertBefore(t,n||null)}function w(e){e.parentNode.removeChild(e)}function _(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function k(e){return document.createElement(e)}function O(e){return document.createTextNode(e)}function S(){return O(" ")}function $(){return O("")}function E(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function A(e){return function(t){return t.preventDefault(),e.call(this,t)}}function D(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function C(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function M(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function j(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function F(e,t,n){e.classList[n?"add":"remove"](t)}function T(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const N=new Set;let R,P=0;function z(e,t,n,r,i,a,o,s=0){const l=16.666/r;let u="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*a(e);u+=100*e+`%{${o(r,1-r)}}\n`}const c=u+`100% {${o(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(c)}_${s}`,d=e.ownerDocument;N.add(d);const h=d.__svelte_stylesheet||(d.__svelte_stylesheet=d.head.appendChild(k("style")).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[f]||(p[f]=!0,h.insertRule(`@keyframes ${f} ${c}`,h.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${f} ${r}ms linear ${i}ms 1 both`,P+=1,f}function B(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-r.length;i&&(e.style.animation=r.join(", "),P-=i,P||m((()=>{P||(N.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),N.clear())})))}function I(e){R=e}function L(){if(!R)throw new Error("Function called outside component initialization");return R}function q(e){L().$$.on_mount.push(e)}function U(){const e=L();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const i=T(t,n);r.slice().forEach((t=>{t.call(e,i)}))}}}function V(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}const W=[],H=[],G=[],X=[],Y=Promise.resolve();let J=!1;function K(){J||(J=!0,Y.then(re))}function Q(){return K(),Y}function Z(e){G.push(e)}function ee(e){X.push(e)}let te=!1;const ne=new Set;function re(){if(!te){te=!0;do{for(let e=0;e<W.length;e+=1){const t=W[e];I(t),ie(t.$$)}for(I(null),W.length=0;H.length;)H.pop()();for(let e=0;e<G.length;e+=1){const t=G[e];ne.has(t)||(ne.add(t),t())}G.length=0}while(W.length);for(;X.length;)X.pop()();J=!1,te=!1,ne.clear()}}function ie(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Z)}}let ae;function oe(){return ae||(ae=Promise.resolve(),ae.then((()=>{ae=null}))),ae}function se(e,t,n){e.dispatchEvent(T(`${t?"intro":"outro"}${n}`))}const le=new Set;let ue;function ce(){ue={r:0,c:[],p:ue}}function fe(){ue.r||a(ue.c),ue=ue.p}function de(e,t){e&&e.i&&(le.delete(e),e.i(t))}function he(e,t,n,r){if(e&&e.o){if(le.has(e))return;le.add(e),ue.c.push((()=>{le.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const pe={duration:0};function me(n,r,i){let a,s,l=r(n,i),u=!1,c=0;function f(){a&&B(n,a)}function d(){const{delay:r=0,duration:i=300,easing:o=t,tick:d=e,css:h}=l||pe;h&&(a=z(n,0,1,i,r,o,h,c++)),d(0,1);const m=p()+r,g=m+i;s&&s.abort(),u=!0,Z((()=>se(n,!0,"start"))),s=v((e=>{if(u){if(e>=g)return d(1,0),se(n,!0,"end"),f(),u=!1;if(e>=m){const t=o((e-m)/i);d(t,1-t)}}return u}))}let h=!1;return{start(){h||(B(n),o(l)?(l=l(),oe().then(d)):d())},invalidate(){h=!1},end(){u&&(f(),u=!1)}}}function ge(n,r,i){let s,l=r(n,i),u=!0;const c=ue;function f(){const{delay:r=0,duration:i=300,easing:o=t,tick:f=e,css:d}=l||pe;d&&(s=z(n,1,0,i,r,o,d));const h=p()+r,m=h+i;Z((()=>se(n,!1,"start"))),v((e=>{if(u){if(e>=m)return f(0,1),se(n,!1,"end"),--c.r||a(c.c),!1;if(e>=h){const t=o((e-h)/i);f(1-t,t)}}return u}))}return c.r+=1,o(l)?oe().then((()=>{l=l(),f()})):f(),{end(e){e&&l.tick&&l.tick(1,0),u&&(s&&B(n,s),u=!1)}}}const ye="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ve(e,t){e.d(1),t.delete(e.key)}function be(e,t){he(e,1,1,(()=>{t.delete(e.key)}))}function xe(e,t,n,r,i,a,o,s,l,u,c,f){let d=e.length,h=a.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,v=new Map;for(p=h;p--;){const e=f(i,a,p),s=n(e);let l=o.get(s);l?r&&l.p(e,t):(l=u(s,e),l.c()),y.set(s,g[p]=l),s in m&&v.set(s,Math.abs(p-m[s]))}const b=new Set,x=new Set;function w(e){de(e,1),e.m(s,c),o.set(e.key,e),c=e.first,h--}for(;d&&h;){const t=g[h-1],n=e[d-1],r=t.key,i=n.key;t===n?(c=t.first,d--,h--):y.has(i)?!o.has(r)||b.has(r)?w(t):x.has(i)?d--:v.get(r)>v.get(i)?(x.add(r),w(t)):(b.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;h;)w(g[h-1]);return g}function we(e,t){const n={},r={},i={$$scope:1};let a=e.length;for(;a--;){const o=e[a],s=t[a];if(s){for(const e in o)e in s||(r[e]=1);for(const e in s)i[e]||(n[e]=s[e],i[e]=1);e[a]=s}else for(const e in o)i[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}function _e(e){return"object"==typeof e&&null!==e?e:{}}function ke(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function Oe(e){e&&e.c()}function Se(e,t,n){const{fragment:i,on_mount:s,on_destroy:l,after_update:u}=e.$$;i&&i.m(t,n),Z((()=>{const t=s.map(r).filter(o);l?l.push(...t):a(t),e.$$.on_mount=[]})),u.forEach(Z)}function $e(e,t){const n=e.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ee(t,n,r,o,s,l,u=[-1]){const c=R;I(t);const f=n.props||{},d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:i(),dirty:u,skip_bound:!1};let h=!1;if(d.ctx=r?r(t,f,((e,n,...r)=>{const i=r.length?r[0]:n;return d.ctx&&s(d.ctx[e],d.ctx[e]=i)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](i),h&&function(e,t){-1===e.$$.dirty[0]&&(W.push(e),K(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],d.update(),h=!0,a(d.before_update),d.fragment=!!o&&o(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(w)}else d.fragment&&d.fragment.c();n.intro&&de(t.$$.fragment),Se(t,n.target,n.anchor),re()}I(c)}class Ae{$destroy(){$e(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const De=function(e,t){JSZip.loadAsync(e).then((e=>{e.forEach(((e,n)=>{n.async("string").then((e=>{var n=parser.parse(e,{ignoreAttributes:!0});console.log(n),t(n)}))}))}))},Ce=6,Me=7,je=12,Fe=13,Te=15,Ne=16,Re=17,Pe=20,ze=21,Be=22,Ie=26,Le=27,qe=30,Ue=31,Ve=33,We=34,He=38,Ge=40,Xe=41,Ye=47,Je=48,Ke=49,Qe=51,Ze=56,et=57,tt=58,nt=59,rt=60,it=61,at=64,ot=67,st=68,lt=74,ut=75,ct={[1]:"Strip Ball",[2]:"ST+",[3]:"AG+",[4]:"MA+",[5]:"AV+",[Ce]:"Catch",[Me]:"Dodge",[8]:"Sprint",[9]:"Pass Block",[10]:"Foul Appearance",[11]:"Leap",[je]:"Extra Arms",[Fe]:"Mighty Blow",[14]:"Leader",[Te]:"Horns",[Ne]:"Two-Heads",[Re]:"Stand Firm",[18]:"Always Hungry",[19]:"Regeneration",[Pe]:"Take Root",[ze]:"Accurate",[Be]:"Break Tackle",[23]:"Sneaky Git",[25]:"Chainsaw",[Ie]:"Dauntless",[Le]:"Dirty Player",[28]:"Diving Catch",[29]:"Dump-Off",[qe]:"Block",[Ue]:"Bone-Head",[32]:"Very Long Legs",[Ve]:"Disturbing Presence",[We]:"Diving Tackle",[35]:"Fend",[36]:"Frenzy",[37]:"Grab",[He]:"Guard",[39]:"Hail-Mary Pass",[Ge]:"Juggernaut",[Xe]:"Jump-Up",[44]:"Loner",[45]:"Nerves Of Steel",[46]:"No Hands",[Ye]:"Pass",[Je]:"Piling On",[Ke]:"Prehensile Tail",[50]:"Pro",[Qe]:"Really Stupid",[52]:"Right Stuff",[53]:"Safe Throw",[54]:"Secret Weapon",[55]:"Shadowing",[Ze]:"Side Step",[et]:"Tackle",[tt]:"Strong Arm",[nt]:"Stunty",[rt]:"Sure Feet",[it]:"Sure Hands",[63]:"Thick Skull",[at]:"Throw Team Mate",[ot]:"Wild Animal",[st]:"Wrestle",[69]:"Tentacles",[70]:"Multiple Block",[71]:"Kick",[72]:"Kick-Off Return",[lt]:"Big Hand",[ut]:"Claw",[76]:"Ball and Chain",[77]:"Stab",[78]:"Hypnotic Gaze",[79]:"Stakes",[80]:"Bombardier",[81]:"Decay",[82]:"Nurgles Rot",[83]:"Titchy",[84]:"Blood-Lust",[85]:"Fan Favourite",[86]:"Animosity"},ft={Active:void 0,Reserves:1,SentOff:5,KO:2,Casualty:4},dt={NoStatus:0,RerollTaken:1,RerollNotTaken:2,RerollWithSkill:3,Reroll4:4},ht=0,pt=1,mt=2,gt=3,yt=4,vt=1,bt=5,xt=void 0,wt=2,_t=1,kt=35,Ot=57,St="AD",$t="BD",Et="P",At="DS",Dt="DD",Ct={0:St,1:$t,2:Et,3:At,4:Dt},Mt=1,jt=2,Ft=3,Tt=4,Nt=5,Rt=6,Pt=7,zt=8,Bt=9,It=10,Lt=12,qt=13,Ut=14,Vt=15,Wt=16,Ht=17,Gt=18,Xt=20,Yt=21,Jt=22,Kt=24,Qt=25,Zt=33,en={[qt]:"Amazon",[Kt]:"Bretonnian",[zt]:"Chaos",[Yt]:"Chaos Dwarf",[Zt]:"Chaos Pact",[Bt]:"Dark Elf",[jt]:"Dwarf",[Rt]:"Goblin",[Vt]:"High Elf",[Mt]:"Human",[Wt]:"Khemri",[Qt]:"Kislev",[Nt]:"Lizardman",[Ht]:"Necromantic",[Lt]:"Norse",[Gt]:"Nurgle",[Tt]:"Orc",[Ut]:"Pro Elf",[Ft]:"Skaven",[It]:"Undead",[Jt]:"Underworld",[Xt]:"Vampire",[Pt]:"Wood Elf"},tn={[qt]:"amazon",[Kt]:"bretonnia",[zt]:"chaos",[Yt]:"chaosdwarf",[Zt]:"chaospact",[Bt]:"darkelf",[jt]:"dwarf",[Rt]:"goblin",[Vt]:"highelf",[Mt]:"human",[Wt]:"khemri",[Qt]:"kislev",[Nt]:"lizardman",[Ht]:"necromantic",[Lt]:"norse",[Gt]:"nurgle",[Tt]:"orc",[Ut]:"proelf",[Ft]:"skaven",[It]:"undead",[Jt]:"underworld",[Xt]:"vampire",[Pt]:"woodelf"};const nn=[{},{dice:38,icon:"BadlyHurt",result:"Badly Hurt",effect:"No long term effect"},{dice:41,icon:"BrokenRibs",result:"Broken Rib",effect:"Miss next game "},{dice:42,icon:"GroinStrain",result:"Groin Strain",effect:"Miss next game "},{dice:43,icon:"GougedEye",result:"Gouged Eye",effect:"Miss next game"},{dice:44,icon:"BrokenJaw",result:"Broken Jaw",effect:"Miss next game "},{dice:45,icon:"FracturedArm",result:"Fractured Arm",effect:"Miss next game "},{dice:46,icon:"FracturedLeg",result:"Fractured Leg",effect:"Miss next game "},{dice:47,icon:"SmashedHand",result:"Smashed Hand ",effect:"Miss next game "},{dice:48,icon:"PinchedNerve",result:"Pinched Nerve",effect:"Miss next game "},{dice:51,icon:"NigglingInjury2",result:"Damaged Back",effect:"Niggling Injury"},{dice:52,icon:"NigglingInjury2",result:"Smashed Knee",effect:"Niggling Injury"},{dice:53,icon:"MovementBust",result:"Smashed Hip",effect:"-1 MA"},{dice:54,icon:"MovementBust",result:"Smashed Ankle",effect:"-1 MA"},{dice:55,icon:"ArmourBust",result:"Serious Concussion",effect:"-1 AV"},{dice:56,icon:"ArmourBust",result:"Fractured Skull",effect:"-1 AV"},{dice:57,icon:"AgilityBust",result:"Broken Neck",effect:"-1 AG"},{dice:58,icon:"StrengthBust",result:"Smashed Collar Bone",effect:"-1 ST"},{dice:61,icon:"Dead",result:"Dead",effect:"Dead!"}],rn={GFI:1,Dodge:2,Armor:3,Injury:4,Block:5,StandUp:6,Pickup:7,Casualty:8,Catch:9,KickoffScatter:10,ThrowIn:11,Pass:12,Push:13,FollowUp:14,FoulPenalty:15,Interception:16,WakeUp:17,TouchBack:19,BoneHead:20,ReallyStupid:21,WildAnimal:22,Loner:23,Landing:24,Regeneration:25,InaccuratePassScatter:26,AlwaysHungryRoll:27,EatTeammate:28,Dauntless:29,SafeThrow:30,JumpUp:31,Shadowing:32,Stab:34,Leap:36,FoulAppearance:37,Tentacles:38,ChainsawKickback:39,TakeRoot:40,BallAndChain:41,HailMaryPass:42,DivingTackle:44,Pro:45,HypnoticGaze:46,Animosity:49,Bloodlust:50,Bite:51,Bribe:52,Fireball:54,LightningBolt:55,ThrowTeammate:56,Multiblock:57,KickoffGust:58,PileOnArmorRoll:59,PileOnInjuryRoll:60,Wrestle2:61,DodgePick:62,StandFirm:63,Juggernaut:64,StandFirm2:65,RaiseDead:66,Fans:69,Weather:70,SwealteringHeat:71,BombKD:72,ChainsawArmor:73};function an(e){return null!=e&&"function"==typeof e[Symbol.iterator]}class on{constructor(e){this.name=e}named(e){return this.name=e,this}_flat(){throw new Error("${this.constructor}._flat() missing implementation")}get flat(){return Object.defineProperty(this,"flat",{value:Object.values(this._flat().reduce(((e,t)=>{const n=e[`${t.name}-${t.value}`];return n?n.weight+=t.weight:e[`${t.name}-${t.value}`]=t,e}),{}))}),this.flat}get cdf(){Object.defineProperty(this,"cdf",{value:this.flat.sort(((e,t)=>e.value-t.value)).reduce(((e,t)=>(e.push({weight:e[e.length-1].weight+t.weight,value:t.value}),e)))})}sample(){var e=Math.random();for(const t of this.flat){if(t.weight>e)return t.value;e-=t.weight}return this.flat[this.flat.length-1].value}get singularValue(){const e=this.flat;if(e.length>1)throw new Error("Distribution doesn't have a singular value");return e[0].value}get isSingularValue(){return 1==this.flat.length}get expectedValue(){return Object.defineProperty(this,"expectedValue",{value:this.flat.reduce(((e,t)=>e+t.value*t.weight),0)}),this.expectedValue}add(...e){return(e=e.filter((e=>null!==e))).length>0?new cn([this,...e]):this}product(...e){return(e=e.filter((e=>null!==e))).length>0?new fn([this,...e]):this}divide(e){return new dn(this,e)}subtract(e){return new hn(this,e)}get valueString(){return`[${this.isSingularValue?"V":"EV"}=${this.valueOf().toFixed(2)}]`}valueOf(){return this.expectedValue}max(...e){var t=this;for(var n of e)n.expectedValue>t.expectedValue&&(t=n);return t}min(...e){var t=this;for(var n of e)n.expectedValue<t.expectedValue&&(t=n);return t}}class sn extends on{constructor(e,t){super(t);const n=e.map((e=>e.weight)).reduce(((e,t)=>e+t));e.forEach((e=>{e.weight/=n})),this.values=Object.values(e.reduce(((e,t)=>{const n=e[`${t.name}`];if(n){if(n.value!=t.value)throw new Error("Inconsistent values passed to SimpleDistribution");n.weight+=t.weight}else e[`${t.name}`]=t;return e}),{}))}_flat(){return this.values.flatMap((e=>e.value instanceof on?e.value.flat.map((t=>({name:`${e.name} → ${t.name}`,weight:e.weight*t.weight,value:t.value}))):e))}}class ln extends on{constructor(e,t){super(e),this.value=t}_flat(){return this.value instanceof on?this.value.flat.map((e=>({name:`${this.name} → ${e.name}`,weight:e.weight,value:e.value}))):[{name:this.name,weight:1,value:this.value}]}}class un extends on{constructor(e,t,n,r,i){if(super(i),this.valFunc=e,this.nameFunc=t,this.distFuncName=n,!an(r))throw new Error("values not iterable",r);if(0==r.length)throw new Error("empty values list",r);this.values=r}_combine(e,t){return e instanceof on?e[this.distFuncName](t):t instanceof on?t[this.distFuncName](e):this.valFunc(e,t)}_flat(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();t=t?t instanceof on?new sn(n instanceof on?t.flat.flatMap((e=>n.flat.map((t=>({name:this.name||this.nameFunc(e.name,t.name),weight:e.weight*t.weight,value:this.valFunc(e.value,t.value)}))))):t.flat.map((e=>({name:this.name||this.nameFunc(e.name,n),value:this.valFunc(e.value,n),weight:e.weight}))),this.name):n instanceof on?new sn(n.flat.map((e=>({name:this.name||this.nameFunc(t,e.name),value:this.valFunc(t,e.value),weight:e.weight}))),this.name):new ln(this.name||this.nameFunc(t,n),this.valFunc(t,n)):n}return t.flat}}class cn extends un{constructor(e,t){super(((e,t)=>e+t),((e,t)=>`${e} + ${t}`),"add",e,t)}}class fn extends un{constructor(e,t){super(((e,t)=>e*t),((e,t)=>`${e} * ${t}`),"product",e,t)}}class dn extends un{constructor(e,t,n){super(((e,t)=>e/t),((e,t)=>`${e} / ${t}`),"divide",[e,t],n)}}class hn extends un{constructor(e,t,n){super(((e,t)=>e-t),((e,t)=>`${e} - ${t}`),"subtract",[e,t],n)}}class pn extends on{constructor(e,t,n){if(super(n),!an(t))throw new Error("values not iterable",t);if(0==t.length)throw new Error("empty values list",t);this.better=e,this.values=t}_simple(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();if(t){if(!(t instanceof sn&&n instanceof sn))throw new Error("Can only compare simple distributions");t=new sn(t.values.flatMap((e=>n.values.map((t=>({name:this.better(e.value,t.value)?e.name:t.name,weight:e.weight*t.weight,value:this.better(e.value,t.value)?e.value:t.value}))))))}else t=n}return t}get simple(){return Object.defineProperty(this,"simple",{value:this._simple().named(this.name)}),console.assert(Math.abs(this.simple.expectedValue-this.expectedValue)<1e-4,this),this.simple}_flat(){return this._simple().flat}}class mn extends pn{constructor(e,t){super(((e,t)=>e>t),e,t)}}class gn extends pn{constructor(e,t){super(((e,t)=>e<t),e,t)}}function yn(e,t,n,r){n=n||"value",r=r||"weight";const i=e.sort(((e,t)=>e[n]-t[n])),a=e.reduce(((e,t)=>e+t[r]),0);for(var o=0;t>1e-8&&o<i.length;)(t-=i[o][r]/a)>1e-8&&o++;return i[o][n]}var vn="1.12.0",bn="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},xn=Array.prototype,wn=Object.prototype,_n="undefined"!=typeof Symbol?Symbol.prototype:null,kn=xn.push,On=xn.slice,Sn=wn.toString,$n=wn.hasOwnProperty,En="undefined"!=typeof ArrayBuffer,An="undefined"!=typeof DataView,Dn=Array.isArray,Cn=Object.keys,Mn=Object.create,jn=En&&ArrayBuffer.isView,Fn=isNaN,Tn=isFinite,Nn=!{toString:null}.propertyIsEnumerable("toString"),Rn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Pn=Math.pow(2,53)-1;function zn(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var a=Array(t+1);for(i=0;i<t;i++)a[i]=arguments[i];return a[t]=r,e.apply(this,a)}}function Bn(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function In(e){return void 0===e}function Ln(e){return!0===e||!1===e||"[object Boolean]"===Sn.call(e)}function qn(e){var t="[object "+e+"]";return function(e){return Sn.call(e)===t}}var Un=qn("String"),Vn=qn("Number"),Wn=qn("Date"),Hn=qn("RegExp"),Gn=qn("Error"),Xn=qn("Symbol"),Yn=qn("ArrayBuffer"),Jn=qn("Function"),Kn=bn.document&&bn.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Kn&&(Jn=function(e){return"function"==typeof e||!1});var Qn=Jn,Zn=qn("Object"),er=An&&Zn(new DataView(new ArrayBuffer(8))),tr="undefined"!=typeof Map&&Zn(new Map),nr=qn("DataView");var rr=er?function(e){return null!=e&&Qn(e.getInt8)&&Yn(e.buffer)}:nr,ir=Dn||qn("Array");function ar(e,t){return null!=e&&$n.call(e,t)}var or=qn("Arguments");!function(){or(arguments)||(or=function(e){return ar(e,"callee")})}();var sr=or;function lr(e){return Vn(e)&&Fn(e)}function ur(e){return function(){return e}}function cr(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=Pn}}function fr(e){return function(t){return null==t?void 0:t[e]}}var dr=fr("byteLength"),hr=cr(dr),pr=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var mr=En?function(e){return jn?jn(e)&&!rr(e):hr(e)&&pr.test(Sn.call(e))}:ur(!1),gr=fr("length");function yr(e,t){t=function(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(e){return t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=Rn.length,r=e.constructor,i=Qn(r)&&r.prototype||wn,a="constructor";for(ar(e,a)&&!t.contains(a)&&t.push(a);n--;)(a=Rn[n])in e&&e[a]!==i[a]&&!t.contains(a)&&t.push(a)}function vr(e){if(!Bn(e))return[];if(Cn)return Cn(e);var t=[];for(var n in e)ar(e,n)&&t.push(n);return Nn&&yr(e,t),t}function br(e,t){var n=vr(t),r=n.length;if(null==e)return!r;for(var i=Object(e),a=0;a<r;a++){var o=n[a];if(t[o]!==i[o]||!(o in i))return!1}return!0}function xr(e){return e instanceof xr?e:this instanceof xr?void(this._wrapped=e):new xr(e)}function wr(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,dr(e))}xr.VERSION=vn,xr.prototype.value=function(){return this._wrapped},xr.prototype.valueOf=xr.prototype.toJSON=xr.prototype.value,xr.prototype.toString=function(){return String(this._wrapped)};var _r="[object DataView]";function kr(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&Or(e,t,n,r)}function Or(e,t,n,r){e instanceof xr&&(e=e._wrapped),t instanceof xr&&(t=t._wrapped);var i=Sn.call(e);if(i!==Sn.call(t))return!1;if(er&&"[object Object]"==i&&rr(e)){if(!rr(t))return!1;i=_r}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return _n.valueOf.call(e)===_n.valueOf.call(t);case"[object ArrayBuffer]":case _r:return Or(wr(e),wr(t),n,r)}var a="[object Array]"===i;if(!a&&mr(e)){if(dr(e)!==dr(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(Qn(o)&&o instanceof o&&Qn(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!kr(e[l],t[l],n,r))return!1}else{var u,c=vr(e);if(l=c.length,vr(t).length!==l)return!1;for(;l--;)if(!ar(t,u=c[l])||!kr(e[u],t[u],n,r))return!1}return n.pop(),r.pop(),!0}function Sr(e){if(!Bn(e))return[];var t=[];for(var n in e)t.push(n);return Nn&&yr(e,t),t}function $r(e){var t=gr(e);return function(n){if(null==n)return!1;var r=Sr(n);if(gr(r))return!1;for(var i=0;i<t;i++)if(!Qn(n[e[i]]))return!1;return e!==Mr||!Qn(n[Er])}}var Er="forEach",Ar=["clear","delete"],Dr=["get","has","set"],Cr=Ar.concat(Er,Dr),Mr=Ar.concat(Dr),jr=["add"].concat(Ar,Er,"has"),Fr=tr?$r(Cr):qn("Map"),Tr=tr?$r(Mr):qn("WeakMap"),Nr=tr?$r(jr):qn("Set"),Rr=qn("WeakSet");function Pr(e){for(var t=vr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function zr(e){for(var t={},n=vr(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function Br(e){var t=[];for(var n in e)Qn(e[n])&&t.push(n);return t.sort()}function Ir(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var a=arguments[i],o=e(a),s=o.length,l=0;l<s;l++){var u=o[l];t&&void 0!==n[u]||(n[u]=a[u])}return n}}var Lr=Ir(Sr),qr=Ir(vr),Ur=Ir(Sr,!0);function Vr(e){if(!Bn(e))return{};if(Mn)return Mn(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Wr(e){return Bn(e)?ir(e)?e.slice():Lr({},e):e}function Hr(e){return ir(e)?e:[e]}function Gr(e){return xr.toPath(e)}function Xr(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function Yr(e,t,n){var r=Xr(e,Gr(t));return In(r)?n:r}function Jr(e){return e}function Kr(e){return e=qr({},e),function(t){return br(t,e)}}function Qr(e){return e=Gr(e),function(t){return Xr(t,e)}}function Zr(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,a){return e.call(t,n,r,i,a)}}return function(){return e.apply(t,arguments)}}function ei(e,t,n){return null==e?Jr:Qn(e)?Zr(e,t,n):Bn(e)&&!ir(e)?Kr(e):Qr(e)}function ti(e,t){return ei(e,t,1/0)}function ni(e,t,n){return xr.iteratee!==ti?xr.iteratee(e,t):ei(e,t,n)}function ri(){}function ii(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}xr.toPath=Hr,xr.iteratee=ti;var ai=Date.now||function(){return(new Date).getTime()};function oi(e){var t=function(t){return e[t]},n="(?:"+vr(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}}var si={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},li=oi(si),ui=oi(zr(si)),ci=xr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},fi=/(.)^/,di={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},hi=/\\|'|\r|\n|\u2028|\u2029/g;function pi(e){return"\\"+di[e]}var mi=0;function gi(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var a=Vr(e.prototype),o=e.apply(a,i);return Bn(o)?o:a}var yi=zn((function(e,t){var n=yi.placeholder,r=function(){for(var i=0,a=t.length,o=Array(a),s=0;s<a;s++)o[s]=t[s]===n?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return gi(e,r,this,this,o)};return r}));yi.placeholder=xr;var vi=zn((function(e,t,n){if(!Qn(e))throw new TypeError("Bind must be called on a function");var r=zn((function(i){return gi(e,r,t,this,n.concat(i))}));return r})),bi=cr(gr);function xi(e,t,n,r){if(r=r||[],t||0===t){if(t<=0)return r.concat(e)}else t=1/0;for(var i=r.length,a=0,o=gr(e);a<o;a++){var s=e[a];if(bi(s)&&(ir(s)||sr(s)))if(t>1)xi(s,t-1,n,r),i=r.length;else for(var l=0,u=s.length;l<u;)r[i++]=s[l++];else n||(r[i++]=s)}return r}var wi=zn((function(e,t){var n=(t=xi(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=vi(e[r],e)}return e}));var _i=zn((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),ki=yi(_i,xr,1);function Oi(e){return function(){return!e.apply(this,arguments)}}function Si(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var $i=yi(Si,2);function Ei(e,t,n){t=ni(t,n);for(var r,i=vr(e),a=0,o=i.length;a<o;a++)if(t(e[r=i[a]],r,e))return r}function Ai(e){return function(t,n,r){n=ni(n,r);for(var i=gr(t),a=e>0?0:i-1;a>=0&&a<i;a+=e)if(n(t[a],a,t))return a;return-1}}var Di=Ai(1),Ci=Ai(-1);function Mi(e,t,n,r){for(var i=(n=ni(n,r,1))(t),a=0,o=gr(e);a<o;){var s=Math.floor((a+o)/2);n(e[s])<i?a=s+1:o=s}return a}function ji(e,t,n){return function(r,i,a){var o=0,s=gr(r);if("number"==typeof a)e>0?o=a>=0?a:Math.max(a+s,o):s=a>=0?Math.min(a+1,s):a+s+1;else if(n&&a&&s)return r[a=n(r,i)]===i?a:-1;if(i!=i)return(a=t(On.call(r,o,s),lr))>=0?a+o:-1;for(a=e>0?o:s-1;a>=0&&a<s;a+=e)if(r[a]===i)return a;return-1}}var Fi=ji(1,Di,Mi),Ti=ji(-1,Ci);function Ni(e,t,n){var r=(bi(e)?Di:Ei)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function Ri(e,t,n){var r,i;if(t=Zr(t,n),bi(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var a=vr(e);for(r=0,i=a.length;r<i;r++)t(e[a[r]],a[r],e)}return e}function Pi(e,t,n){t=ni(t,n);for(var r=!bi(e)&&vr(e),i=(r||e).length,a=Array(i),o=0;o<i;o++){var s=r?r[o]:o;a[o]=t(e[s],s,e)}return a}function zi(e){var t=function(t,n,r,i){var a=!bi(t)&&vr(t),o=(a||t).length,s=e>0?0:o-1;for(i||(r=t[a?a[s]:s],s+=e);s>=0&&s<o;s+=e){var l=a?a[s]:s;r=n(r,t[l],l,t)}return r};return function(e,n,r,i){var a=arguments.length>=3;return t(e,Zr(n,i,4),r,a)}}var Bi=zi(1),Ii=zi(-1);function Li(e,t,n){var r=[];return t=ni(t,n),Ri(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function qi(e,t,n){t=ni(t,n);for(var r=!bi(e)&&vr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(!t(e[o],o,e))return!1}return!0}function Ui(e,t,n){t=ni(t,n);for(var r=!bi(e)&&vr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(t(e[o],o,e))return!0}return!1}function Vi(e,t,n,r){return bi(e)||(e=Pr(e)),("number"!=typeof n||r)&&(n=0),Fi(e,t,n)>=0}var Wi=zn((function(e,t,n){var r,i;return Qn(t)?i=t:(t=Gr(t),r=t.slice(0,-1),t=t[t.length-1]),Pi(e,(function(e){var a=i;if(!a){if(r&&r.length&&(e=Xr(e,r)),null==e)return;a=e[t]}return null==a?a:a.apply(e,n)}))}));function Hi(e,t){return Pi(e,Qr(t))}function Gi(e,t,n){var r,i,a=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=bi(e)?e:Pr(e)).length;s<l;s++)null!=(r=e[s])&&r>a&&(a=r);else t=ni(t,n),Ri(e,(function(e,n,r){((i=t(e,n,r))>o||i===-1/0&&a===-1/0)&&(a=e,o=i)}));return a}function Xi(e,t,n){if(null==t||n)return bi(e)||(e=Pr(e)),e[ii(e.length-1)];var r=bi(e)?Wr(e):Pr(e),i=gr(r);t=Math.max(Math.min(t,i),0);for(var a=i-1,o=0;o<t;o++){var s=ii(o,a),l=r[o];r[o]=r[s],r[s]=l}return r.slice(0,t)}function Yi(e,t){return function(n,r,i){var a=t?[[],[]]:{};return r=ni(r,i),Ri(n,(function(t,i){var o=r(t,i,n);e(a,t,o)})),a}}var Ji=Yi((function(e,t,n){ar(e,n)?e[n].push(t):e[n]=[t]})),Ki=Yi((function(e,t,n){e[n]=t})),Qi=Yi((function(e,t,n){ar(e,n)?e[n]++:e[n]=1})),Zi=Yi((function(e,t,n){e[n?0:1].push(t)}),!0),ea=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ta(e,t,n){return t in n}var na=zn((function(e,t){var n={},r=t[0];if(null==e)return n;Qn(r)?(t.length>1&&(r=Zr(r,t[1])),t=Sr(e)):(r=ta,t=xi(t,!1,!1),e=Object(e));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];r(s,o,e)&&(n[o]=s)}return n})),ra=zn((function(e,t){var n,r=t[0];return Qn(r)?(r=Oi(r),t.length>1&&(n=t[1])):(t=Pi(xi(t,!1,!1),String),r=function(e,n){return!Vi(t,n)}),na(e,r,n)}));function ia(e,t,n){return On.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function aa(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:ia(e,e.length-t)}function oa(e,t,n){return On.call(e,null==t||n?1:t)}var sa=zn((function(e,t){return t=xi(t,!0,!0),Li(e,(function(e){return!Vi(t,e)}))})),la=zn((function(e,t){return sa(e,t)}));function ua(e,t,n,r){Ln(t)||(r=n,n=t,t=!1),null!=n&&(n=ni(n,r));for(var i=[],a=[],o=0,s=gr(e);o<s;o++){var l=e[o],u=n?n(l,o,e):l;t&&!n?(o&&a===u||i.push(l),a=u):n?Vi(a,u)||(a.push(u),i.push(l)):Vi(i,l)||i.push(l)}return i}var ca=zn((function(e){return ua(xi(e,!0,!0))}));function fa(e){for(var t=e&&Gi(e,gr).length||0,n=Array(t),r=0;r<t;r++)n[r]=Hi(e,r);return n}var da=zn(fa);function ha(e,t){return e._chain?xr(t).chain():t}function pa(e){return Ri(Br(e),(function(t){var n=xr[t]=e[t];xr.prototype[t]=function(){var e=[this._wrapped];return kn.apply(e,arguments),ha(this,n.apply(xr,e))}})),xr}Ri(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=xn[e];xr.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),ha(this,n)}})),Ri(["concat","join","slice"],(function(e){var t=xn[e];xr.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),ha(this,e)}}));var ma=pa(Object.freeze({__proto__:null,VERSION:vn,restArguments:zn,isObject:Bn,isNull:function(e){return null===e},isUndefined:In,isBoolean:Ln,isElement:function(e){return!(!e||1!==e.nodeType)},isString:Un,isNumber:Vn,isDate:Wn,isRegExp:Hn,isError:Gn,isSymbol:Xn,isArrayBuffer:Yn,isDataView:rr,isArray:ir,isFunction:Qn,isArguments:sr,isFinite:function(e){return!Xn(e)&&Tn(e)&&!isNaN(parseFloat(e))},isNaN:lr,isTypedArray:mr,isEmpty:function(e){if(null==e)return!0;var t=gr(e);return"number"==typeof t&&(ir(e)||Un(e)||sr(e))?0===t:0===gr(vr(e))},isMatch:br,isEqual:function(e,t){return kr(e,t)},isMap:Fr,isWeakMap:Tr,isSet:Nr,isWeakSet:Rr,keys:vr,allKeys:Sr,values:Pr,pairs:function(e){for(var t=vr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:zr,functions:Br,methods:Br,extend:Lr,extendOwn:qr,assign:qr,defaults:Ur,create:function(e,t){var n=Vr(e);return t&&qr(n,t),n},clone:Wr,tap:function(e,t){return t(e),e},get:Yr,has:function(e,t){for(var n=(t=Gr(t)).length,r=0;r<n;r++){var i=t[r];if(!ar(e,i))return!1;e=e[i]}return!!n},mapObject:function(e,t,n){t=ni(t,n);for(var r=vr(e),i=r.length,a={},o=0;o<i;o++){var s=r[o];a[s]=t(e[s],s,e)}return a},identity:Jr,constant:ur,noop:ri,toPath:Hr,property:Qr,propertyOf:function(e){return null==e?ri:function(t){return Yr(e,t)}},matcher:Kr,matches:Kr,times:function(e,t,n){var r=Array(Math.max(0,e));t=Zr(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:ii,now:ai,escape:li,unescape:ui,templateSettings:ci,template:function(e,t,n){!t&&n&&(t=n),t=Ur({},t,xr.templateSettings);var r,i=RegExp([(t.escape||fi).source,(t.interpolate||fi).source,(t.evaluate||fi).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(i,(function(t,n,r,i,s){return o+=e.slice(a,s).replace(hi,pi),a=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t})),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return r.call(this,e,xr)},l=t.variable||"obj";return s.source="function("+l+"){\n"+o+"}",s},result:function(e,t,n){var r=(t=Gr(t)).length;if(!r)return Qn(n)?n.call(e):n;for(var i=0;i<r;i++){var a=null==e?void 0:e[t[i]];void 0===a&&(a=n,i=r),e=Qn(a)?a.call(e):a}return e},uniqueId:function(e){var t=++mi+"";return e?e+t:t},chain:function(e){var t=xr(e);return t._chain=!0,t},iteratee:ti,partial:yi,bind:vi,bindAll:wi,memoize:function(e,t){var n=function(r){var i=n.cache,a=""+(t?t.apply(this,arguments):r);return ar(i,a)||(i[a]=e.apply(this,arguments)),i[a]};return n.cache={},n},delay:_i,defer:ki,throttle:function(e,t,n){var r,i,a,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:ai(),r=null,o=e.apply(i,a),r||(i=a=null)},u=function(){var u=ai();s||!1!==n.leading||(s=u);var c=t-(u-s);return i=this,a=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=u,o=e.apply(i,a),r||(i=a=null)):r||!1===n.trailing||(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),s=0,r=i=a=null},u},debounce:function(e,t,n){var r,i,a=function(t,n){r=null,n&&(i=e.apply(t,n))},o=zn((function(o){if(r&&clearTimeout(r),n){var s=!r;r=setTimeout(a,t),s&&(i=e.apply(this,o))}else r=_i(a,t,this,o);return i}));return o.cancel=function(){clearTimeout(r),r=null},o},wrap:function(e,t){return yi(t,e)},negate:Oi,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:Si,once:$i,findKey:Ei,findIndex:Di,findLastIndex:Ci,sortedIndex:Mi,indexOf:Fi,lastIndexOf:Ti,find:Ni,detect:Ni,findWhere:function(e,t){return Ni(e,Kr(t))},each:Ri,forEach:Ri,map:Pi,collect:Pi,reduce:Bi,foldl:Bi,inject:Bi,reduceRight:Ii,foldr:Ii,filter:Li,select:Li,reject:function(e,t,n){return Li(e,Oi(ni(t)),n)},every:qi,all:qi,some:Ui,any:Ui,contains:Vi,includes:Vi,include:Vi,invoke:Wi,pluck:Hi,where:function(e,t){return Li(e,Kr(t))},max:Gi,min:function(e,t,n){var r,i,a=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=bi(e)?e:Pr(e)).length;s<l;s++)null!=(r=e[s])&&r<a&&(a=r);else t=ni(t,n),Ri(e,(function(e,n,r){((i=t(e,n,r))<o||i===1/0&&a===1/0)&&(a=e,o=i)}));return a},shuffle:function(e){return Xi(e,1/0)},sample:Xi,sortBy:function(e,t,n){var r=0;return t=ni(t,n),Hi(Pi(e,(function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")},groupBy:Ji,indexBy:Ki,countBy:Qi,partition:Zi,toArray:function(e){return e?ir(e)?On.call(e):Un(e)?e.match(ea):bi(e)?Pi(e,Jr):Pr(e):[]},size:function(e){return null==e?0:bi(e)?e.length:vr(e).length},pick:na,omit:ra,first:aa,head:aa,take:aa,initial:ia,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:oa(e,Math.max(0,e.length-t))},rest:oa,tail:oa,drop:oa,compact:function(e){return Li(e,Boolean)},flatten:function(e,t){return xi(e,t,!1)},without:la,uniq:ua,unique:ua,union:ca,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=gr(e);r<i;r++){var a=e[r];if(!Vi(t,a)){var o;for(o=1;o<n&&Vi(arguments[o],a);o++);o===n&&t.push(a)}}return t},difference:sa,unzip:fa,transpose:fa,zip:da,object:function(e,t){for(var n={},r=0,i=gr(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),a=0;a<r;a++,e+=n)i[a]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(On.call(e,r,r+=t));return n},mixin:pa,default:xr}));function ga(e){return e&&e.length?e:e?[e]:[]}function ya(e){return e[Math.floor(Math.random()*e.length)]}function va(e){for(var t=0,n=0;n<e;n++)t+=.9**n;return t}function ba(e,t){return Math.max(Math.abs((e.x||0)-(t.x||0)),Math.abs((e.y||0)-(t.y||0)))}function xa(e,t){var n;return n=0==e.id?25-(t.x||0):t.x||0,new ln(`${n} to goal`,0==n?8:4*.85**(n-1))}ma._=ma;const wa="actual",_a="simulated";class ka{team;playerState;constructor(e,t,n){this.team=e,this.id=t.Data.Id,this.name=t.Data.Name,this.cell=t.Cell,this.situation=t.Situation,this.playerState=t,this.canAct=1==t.CanAct&&this.situation===ft.Active,this.skills=$a.translateStringNumberList(t.Data.ListSkills)||[],this.isBallCarrier=0==ba(n.Ball.Cell,this.cell)&&1==n.Ball.IsHeld}get skillNames(){return this.skills.map((e=>ct[e]))}}class Oa{teamState;constructor(e,t){this.players=e.ListPitchPlayers.PlayerState.map((e=>new ka(this,e,t))),this.name=e.Data.Name,this.id=e.Data.TeamId||0,this.turn=e.GameTurn||0}get shortName(){return this.name.split(/\s+/).map((e=>e[0])).join("")}}class Sa{teams;activeTeam;turn;constructor({teams:e,activeTeamId:t,ballCell:n}){this.teams=e,this.activeTeam=e.filter((e=>e.id==t))[0]||e[0],this.turn=this.activeTeam&&this.activeTeam.turn||0,this.ballCell=n}static argsFromXml(e){const t={};return t.teams=e.ListTeams.TeamState.map((t=>new Oa(t,e))),t.activeTeamId=e.ActiveTeam,t.ballCell=e.Ball.Cell,t}playerById(e){for(var t of this.teams)for(var n of t.players)if(n.id===e)return n}playerAtPosition(e){for(var t of this.teams)for(var n of t.players)if((n.cell.x||0)===(e.x||0)&&(n.cell.y||0)===(e.y||0))return n;console.log("No player found",{replayStep:this.replayStep,action:this.action,cell:e})}}class $a{static handledSkills=[];static diceSeparator=", ";constructor(e){Object.assign(this,e),this.onPitchValues={},this.onTeamValues={},this.armorRollCache={},this.dependentRolls=[],console.assert(!this.unhandledSkills||0==this.unhandledSkills.length,"Unhandled skills for roll",{roll:this,skills:this.unhandledSkills&&this.unhandledSkills.map((e=>ct[e.SkillId])),rollName:this.rollName})}static argsFromXml(e){const t={};t.initialBoardState=new Sa(Sa.argsFromXml(e.initialBoard)),t.finalBoardState=new Sa(Sa.argsFromXml(e.replayStep.BoardState));var n=e.action.PlayerId;return t.activePlayer=t.initialBoardState.playerById(n),t.rollType=e.boardActionResult.RollType,t.dice=this.dice(e.boardActionResult),t.skillsInEffect=ga(e.boardActionResult.CoachChoices.ListSkills.SkillInfo),t.unhandledSkills=t.skillsInEffect.filter((e=>!this.handledSkills.includes(e.SkillId))),t.ignore=this.ignore(e),t.actionType=e.action.ActionType,t.rollStatus=e.boardActionResult.RollStatus,t.resultType=e.boardActionResult.ResultType,t.subResultType=e.boardActionResult.SubResultType,t.stepIndex=e.stepIndex,t.resultIndex=e.resultIndex,t.actionIndex=e.actionIndex,t.isReroll=[dt.RerollTaken,dt.RerollWithSkill].includes(t.rollStatus),t}get startIndex(){return this.stepIndex}get activeTeam(){return this.finalBoardState.activeTeam}get teams(){return this.finalBoardState.teams}get turn(){return this.finalBoardState.turn}get rollName(){return this.constructor.rollName}get jointDescription(){return[this.description].concat(this.dependentRolls.map((e=>e.shortDescription||e.description))).join(" → ")}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice}`}get shortDescription(){return`${this.rollName}: ${this.activePlayer.name} - ${this.dice.join(this.constructor.diceSeparator)}`}isDependentRoll(e){return!1}value(e,t){throw"value must be defined by subclass"}get expectedValue(){return this.possibleOutcomes.expectedValue}get possibleOutcomes(){throw`possibleOutcomes must be defined by subclass ${this.constructor.name}`}simulateDice(){throw"simulateDice must be defined by subclass"}static ignore(e){return e.boardActionResult.RollStatus==dt.RerollNotTaken||void 0===e.boardActionResult.CoachChoices.ListDices}static dice(e){return this.translateStringNumberList(e.CoachChoices.ListDices)}get actualValue(){const e=this.value(this.dice,!1);return e instanceof on?e:new ln(this.rollName,e)}get valueWithDependents(){return this.actualValue.add(...this.dependentRolls.map((e=>e.actualValue)))}get actual(){var e=this.dataPoint(-1,wa);const t=this.possibleOutcomes.flat.map((t=>({value:t.value-e.expectedValue,weight:t.weight})));return Object.assign(e,{turn:this.turn,player:this.activePlayer&&this.activePlayer.name||"",playerSkills:this.activePlayer&&this.activePlayer.skills.map((e=>ct[e]))||[],rollName:this.rollName,dice:this.dice,dnvMin:Math.min(...t.map((e=>e.value))),dnvq33:yn(t,.33,"value","weight"),dnvMed:yn(t,.5,"value","weight"),dnvq67:yn(t,.67,"value","weight"),dnvMax:Math.max(...t.map((e=>e.value))),outcomes:this.possibleOutcomes.flat.map((t=>t.value-e.expectedValue)),weights:this.possibleOutcomes.flat.map((e=>e.weight)),description:this.jointDescription,valueDescription:`${this.valueWithDependents.valueString} ${this.possibleOutcomes.valueString}`})}simulated(e){return this.dataPoint(e,_a)}dataPoint(e,t){var n;return t==wa?n=this.valueWithDependents.singularValue:t==_a&&(n=this.possibleOutcomes.sample()),{iteration:e,turn:this.turn,activeTeamId:this.activeTeam.id,activeTeamName:this.activeTeam.name,teamId:this.activePlayer?this.activePlayer.team.id:this.activeTeam.id,teamName:this.activePlayer?this.activePlayer.team.name:this.activeTeam.name,outcomeValue:n,type:t,expectedValue:this.expectedValue,netValue:n-this.expectedValue,rollIndex:this.rollIndex}}static translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}static fromReplayStep(e,t,n){for(var r=ga(n.RulesEventBoardAction),i=[],a=0;a<r.length;a++){var o=r[a];i=i.concat($a.fromAction(e,t,n,a,o))}return i}static fromAction(e,t,n,r,i){for(var a=ga(i.Results.BoardActionResult),o=[],s=0;s<a.length;s++){var l=a[s],u=this.fromBoardActionResult(e,t,n,r,i,s,l);u&&o.push(u)}return 0==a.length&&console.warn("Unexpectedly missing boardactionresult",{stepIndex:t,replayStep:n,action:i}),o}static fromBoardActionResult(e,t,n,r,i,a,o){var s;return null===(s=void 0===o.RollType?Fa:za[o.RollType])?null:s?new s(s.argsFromXml({initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o})):(console.warn("Unknown roll "+o.RollType,{initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o}),null)}onActiveTeam(e){return e.team.id===this.activeTeam.id}playerValue(e){var t=this.initialBoardState.ballCell;if((t.x||0)<0||(t.y||0)<0)return this.rawPlayerValue(e);var n=ba(t,e.cell);return 0==n?this.rawPlayerValue(e).product(new ln("On Ball",2)).named(`PV(${e.name})`):1==n?this.rawPlayerValue(e).product(new ln("By Ball",1.5)).named(`PV(${e.name})`):this.rawPlayerValue(e)}rawPlayerValue(e){return new ln(`TV(${e.name})`,1)}teamValue(e,t,n){return new cn(e.players.filter((e=>t.includes(e.situation)||e.id==n.id)).map((e=>this.playerValue(e))),`TV(${e.name})`)}get halfTurnsInGame(){var e=this.teams.map((e=>this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}get halfTurnsInHalf(){var e=this.teams.map((e=>this.turn<=8?8-e.turn:this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}stunTurns(e){return Math.min(this.onActiveTeam(e)?4:3,this.halfTurnsInHalf)}kdTurns(e){return Math.min(this.onActiveTeam(e)?2:1,this.halfTurnsInHalf)}onPitchValue(e){return this.onPitchValues[e.id]||(this.onPitchValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[ft.Active],e).named(`TPV(${e.team.name})`)).named(`%PV(${e.name})`))}onTeamValue(e){return this.onTeamValues[e.id]||(this.onTeamValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[ft.Active,ft.Reserves,ft.KO],e).named("Players on Team")).named(e.name))}armorRoll(e){return this.armorRollCache[e.id]||(this.armorRollCache[e.id]=new Aa({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:e}))}knockdownValue(e,t){const n=this.onPitchValue(e);var r=this.kdTurns(e),i=va(r),a=[new ln(`TDT(${r/2})`,i)];this.onActiveTeam(e)&&a.push(new ln("On Active Team",-1));var o=n.product(...a).named(`KD(${e.name})`);return t&&(o=o.add(this.armorRoll(e).possibleOutcomes.named("Armor Roll"))),o}stunValue(e){var t=this.onPitchValue(e),n=this.stunTurns(e),r=va(n),i=[new ln(`TDT(${n/2})`,r)];return this.onActiveTeam(e)&&i.push(new ln("On Active Team",-1)),t.product(...i).named(`STUN(${e.name})`)}koValue(e){const t=this.onPitchValue(e);var n=this.halfTurnsInHalf,r=this.stunTurns(e),i=[new ln(`TDT(${n-r})`,va(n)-va(r))];return this.onActiveTeam(e)&&i.push(new ln("On Active Team",-1)),t.product(...i).named(`KO(${e.name})`)}casValue(e){const t=this.onTeamValue(e).product(new ln(`TDT(${this.halfTurnsInGame/2})`,va(this.halfTurnsInGame))),n=this.onPitchValue(e).subtract(this.onTeamValue(e)).product(new ln(`TDT(${this.halfTurnsInHalf/2})`,va(this.halfTurnsInHalf))),r=t.add(n).named(`PV(${e.name})`);var i=[];return this.onActiveTeam(e)&&i.push(new ln("On Active Team",-1)),r.product(...i).subtract(this.stunValue(e)).named(`CAS(${e.name})`)}get dependentMoveValues(){const e=this.dependentRolls.filter((e=>e.constructor==Fa));return e.length>0?new cn(e.map((e=>e.value())),"Following Moves"):null}get unactivatedPlayers(){return Object.defineProperty(this,"unactivatedPlayers",{value:this.activeTeam.players.filter((e=>e.canAct))}),this.unactivatedPlayers}get turnoverValue(){const e=this.unactivatedPlayers.filter((e=>e!=this.activePlayer)).map((e=>this.onPitchValue(e)));var t;return t=e.length>0?new cn(e).named("Unactivated PV").product(-1).named("Turnover"):new ln("No Active Players",0),Object.defineProperty(this,"turnoverValue",{value:t}),this.turnoverValue}get rerollValue(){return new ln("Reroll",0)}}class Ea extends $a{static numDice=1;static diceSeparator="+";static canCauseInjury=!1;static includeFollowingMoves=!0;constructor(e){super(e),console.assert(!this.computedTarget||!this.target||this.computedTarget==this.target,"Computed target (%d) doesn't equal target from replay XML (%d)",this.computedTarget,this.target,this),console.assert(void 0===this.computedModifier||void 0===this.modifier||this.computedModifier==this.modifier,"Computed modifier (%d) doesn't equal modifier from replay XML (%d)",this.computedModifier,this.modifier,this),console.assert(void 0===this.dice||this.constructor.numDice==this.dice.length,"Mismatch in number of dice (%d) and expected number of dice (%d)",this.dice&&this.dice.length,this.constructor.numDice,this)}static argsFromXml(e){const t=super.argsFromXml(e);return t.modifier=ga(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t.target=e.boardActionResult.Requirement,t}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice} (${this.modifiedTarget})`}get actual(){return Object.assign(super.actual,{target:this.modifiedTarget})}get modifiedTarget(){var e=(this.target||this.computedTarget)-(this.modifier||this.computedModifier||0);return 1==this.constructor.numDice?Math.min(6,Math.max(2,e)):e}value(e,t){return e.reduce(((e,t)=>e+t),0)>=this.modifiedTarget?this.passValue(t).add(t?this.dependentMoveValues:null):this.dependentRolls.length>=1&&this.dependentRolls[0].constructor==this.constructor&&this.dependentRolls[0].isReroll?new ln(`Rerolled ${this.rollName}`,this.rerollValue):this.failValue(t)}get possibleOutcomes(){for(var e=[0],t=0;t<this.constructor.numDice;t++){for(var n=[],r=1;r<=6;r++)for(const t of e)n.push(t+r);e=n}var i=[],a=[];for(const t of e)t>=this.modifiedTarget?i.unshift(t):a.unshift(t);var o=[];if(i.length>0){const e=Math.min(...i),t=Math.max(...i);o.push({name:e===t?e:`${e}-${t}`,value:this.passValue(!0).add(this.dependentMoveValues),weight:i.length/(i.length+a.length)})}if(a.length>0){const e=Math.min(...a),t=Math.max(...a);o.push({name:e===t?e:`${e}-${t}`,value:this.hasSkillReroll?this.reroll.possibleOutcomes:this.failValue(!0),weight:a.length/(i.length+a.length)})}return Object.defineProperty(this,"possibleOutcomes",{value:new sn(o)}),this.possibleOutcomes}get reroll(){const e=new this.constructor({...this,rollStatus:dt.RerollWithSkill});return Object.defineProperty(this,"reroll",{value:e}),this.reroll}get hasSkillReroll(){return this.activePlayer.skills.includes(this.constructor.rerollSkill)&&!this.skillsInEffect.includes(this.constructor.rerollCancelSkill)&&![dt.RerollWithSkill,dt.RerollTaken].includes(this.rollStatus)}simulateDice(){return this.dice.map((()=>ya([1,2,3,4,5,6])))}passValue(){return new ln("Pass",0)}failValue(){return new ln("Fail",0)}isDependentRoll(e){return e.rollType==this.rollType&&[dt.RerollTaken,dt.RerollWithSkill].includes(e.rollStatus)||this.constructor.canCauseInjury&&[Aa,Ma,ja].includes(e.constructor)&&!e.isFoul||this.constructor.includeFollowingMoves&&e.constructor==Fa}}class Aa extends Ea{static numDice=2;static handledSkills=[ut,Fe,Le,Je];static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=59==n.RollType,t.isPileOn){var r=ga(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Je))[0].PlayerId)}}return t.isFoul=e.action.ActionType==bt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(ga(e.replayStep.RulesEventBoardAction)[0].PlayerId),console.log(e,t.finalBoardState.activePlayer,t.foulingPlayer)),t}get description(){if(this.isFoul){var e=this.foulingPlayer.skills.length>0?` (${this.foulingPlayer.skillNames.join(", ")})`:"",t=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.foulingPlayer.team.shortName}] ${this.foulingPlayer.name}${e} against ${this.activePlayer.name}${t} - ${this.dice.join(this.constructor.diceSeparator)}`}return super.description}isDependentRoll(e){return this.isFoul&&([Ma,ja].includes(e.constructor)&&e.isFoul&&e.activePlayer.id==this.activePlayer.id||e.constructor==Pa)}get rollName(){return this.isFoul?"Foul (Armor)":this.isPileOn?"Pile On (Armor)":"Armor"}get computedTarget(){return this.activePlayer.playerState.Data.Av+1}get computedModifier(){return 0}get injuryRoll(){return Object.defineProperty(this,"injuryRoll",{value:new Ma({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:this.activePlayer,modifier:0})}),this.injuryRoll}value(e,t){var n=super.value(e,t);return this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}passValue(e){var t=this.stunValue(this.activePlayer);if(e&&(t=t.add(this.injuryRoll.possibleOutcomes.named("Injury Roll"))),this.isPileOn){const e=this.knockdownValue(this.pilingOnPlayer,!1);return t.add(e)}return t}failValue(){var e=new ln("No Break",0);return this.isPileOn?e.add(this.knockdownValue(this.pilingOnPlayer,!1)):e}}class Da extends Ea{static rollName="Intercept";static handledSkills=[je];passValue(){return this.turnoverValue}}class Ca extends Ea{static rollName="Catch";static handledSkills=[Ve,Ce,je];static rerollSkill=Ce;failValue(){return this.turnoverValue}}class Ma extends $a{static handledSkills=[Fe,Le,nt];static diceSeparator="+";static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=60==n.RollType,t.isPileOn){var r=ga(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Je))[0].PlayerId)}}return t.isFoul=e.action.ActionType==bt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(ga(e.replayStep.RulesEventBoardAction)[0].PlayerId)),t.modifier=ga(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t}get rollName(){return this.isPileOn?"Pile On (Injury)":"Injury"}static ignore(e){return 1!=e.boardActionResult.IsOrderCompleted?(console.log("Ignoring incomplete InjuryRoll",{roll:this}),!0):super.ignore(e)}injuryValue(e){return this.activePlayer.skills.includes(nt)&&(e+=1),e<=7?new ln("No Injury",0):e<=9?this.koValue(this.activePlayer):this.casValue(this.activePlayer)}value(e){var t=e[0]+e[1]+this.modifier,n=this.injuryValue(t);return this.isPileOn&&(n=n.subtract(this.onPitchValue(this.pilingOnPlayer))),this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}get possibleOutcomes(){for(var e={},t=1;t<=6;t++)for(var n=1;n<=6;n++){var r=e[this.value([t,n],!0).name];r||(r=e[this.value([t,n],!0).name]=[]),r.unshift({name:(t+n).toString(),value:this.value([t,n],!0)})}return Object.defineProperty(this,"possibleOutcomes",{value:new sn(Object.values(e).map((e=>{const t=Math.min(...e.map((e=>parseInt(e.name)))),n=Math.max(...e.map((e=>parseInt(e.name))));return{name:t===n?t:`${t}-${n}`,weight:e.length,value:e[0].value}})))}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ya([1,2,3,4,5,6])))}}class ja extends $a{static rollName="Casualty";static diceSeparator="";static argsFromXml(e){const t=super.argsFromXml(e);return t.isFoul=e.action.ActionType==bt,t}static dice(e){var t=super.dice(e);return[(t=t.slice(0,t.length/2))[t.length-1]]}value(e){return new ln("CAS",0)}get possibleOutcomes(){for(var e=[],t=1;t<=6;t++)for(var n=1;n<=8;n++)e.unshift({name:`${t}${n}`,value:this.value(10*t+n,!0),weight:1});return Object.defineProperty(this,"possibleOutcomes",{value:new sn(e)}),this.possibleOutcomes}simulateDice(){return 10*ya([1,2,3,4,5,6])+ya([1,2,3,4,5,6,7,8])}static ignore(e){return e.boardActionResult.ResultType!=wt&&e.boardActionResult.SubResultType!=_t&&12!=e.boardActionResult.SubResultType?(console.warn("Ignoring casualty roll, should verify",{roll:this}),!0):super.ignore(e)}}class Fa extends $a{static rollName="Move";static ignore(e){return 0==ba(e.action.Order.CellFrom,e.action.Order.CellTo.Cell)}static argsFromXml(e){const t=super.argsFromXml(e);return t.cellFrom=e.action.Order.CellFrom,t.cellTo=e.action.Order.CellTo.Cell,t}get jointDescription(){const e=[this].concat(this.dependentRolls),t=this.cellFrom,n=e[e.length-1].cellTo;return`Move: [${this.activePlayer.team.shortName}] ${this.activePlayer.name} - (${t.x||0}, ${t.y||0}) → (${n.x||0}, ${n.y||0})`}isDependentRoll(e){return e.constructor==Fa&&this.activePlayer.id==e.activePlayer.id}value(){return this.activePlayer&&this.activePlayer.isBallCarrier?xa(this.activePlayer.team,this.cellTo).subtract(xa(this.activePlayer.team,this.cellFrom)):new ln("Move",0)}get possibleOutcomes(){return this.value().add(...this.dependentRolls.map((e=>e.value())))}}class Ta extends $a{static ignore(){return!0}value(){return new ln("No Value",0)}get expectedValue(){return 0}simulateDice(){return null}get possibleOutcomes(){return[]}}class Na extends Ta{static rollName="Push";static handledSkills=[Ze]}class Ra extends Ta{static rollName="Follow Up"}class Pa extends Ta{}const za={1:class extends Ea{static rollName="GFI";static handledSkills=[rt];static rerollSkill=rt;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},2:class extends Ea{static rollName="Dodge";static handledSkills=[Be,nt,Ne,Me,et,Ke,We];static rerollSkill=Me;static rerollCancelSkill=et;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},3:Aa,4:Ma,5:class extends $a{static rollName="Block";static handledSkills=[et,Me,qe,He,Te,Re,st,Pe];static diceSeparator="/";static argsFromXml(e){const t=super.argsFromXml(e);return t.isRedDice=e.boardActionResult.Requirement<0,t.attacker=t.activePlayer,t.defender=t.finalBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}isDependentRoll(e){return[Na,Ra,Fa].includes(e.constructor)||[Aa,Ma,ja].includes(e.constructor)&&!e.isFoul||e.rollType===this.rollType&&e.rollStatus==dt.RerollTaken}static dice(e){var t=super.dice(e);return t.slice(0,t.length/2).map((e=>Ct[e]))}get description(){var e=this.isRedDice?" uphill":"",t=this.attacker.skills.length>0?` (${this.attacker.skillNames.join(", ")})`:"",n=this.defender.skills.length>0?` (${this.defender.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${t} against ${this.defender.name}${n} - ${this.dice.join(this.constructor.diceSeparator)}${e}`}static ignore(e){return e.boardActionResult.ResultType!=wt||(e.boardActionResult.SubResultType==kt||(e.boardActionResult.SubResultType==Ot||super.ignore(e)))}dieValue(e,t){const n=this.attacker,r=this.defender;var i=n&&n.skills||[],a=r&&r.skills||[];switch(e){case St:return this.knockdownValue(n,t).add(this.turnoverValue);case $t:const e=i.includes(qe),u=a.includes(qe);var o=[];if(i.includes(st)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));o.push(e)}if(i.includes(Ge)&&this.isBlitz){const e=this.knockdownValue(r,!1).product(new ln("Push",.33)).named(`Push(${r.name})`).add(t?this.dependentMoveValues:null);o.push(e)}var s,l=[];if(a.includes(st)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));l.push(e)}if(e&&u){s=new ln("Block/Block",0).add(t?this.dependentMoveValues:null)}else if(e){s=this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}else if(u){s=this.knockdownValue(n,t)}else{s=this.knockdownValue(r,t).add(this.knockdownValue(n,t),this.turnoverValue)}return s.min(...l).max(...o);case Et:return(a.includes(Re)?new ln("Stand Firm",0):this.knockdownValue(r,!1).product(new ln("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null);case At:return a.includes(Me)&&!i.includes(et)?(a.includes(Re)?new ln("Stand Firm",0):this.knockdownValue(r,!1).product(new ln("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null):this.knockdownValue(r,t).add(t?this.dependentMoveValues:null);case Dt:return this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}}value(e,t){if(this.dependentRolls.length>0&&this.dependentRolls[0].rollType==this.rollType&&this.dependentRolls[0].rollStatus==dt.RerollTaken)return this.rerollValue;var n=e.filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>this.dieValue(e,t)));if(1==n.length)return n[0];if(this.isRedDice){var[r,...i]=n;return r.min(...i)}var[r,...i]=n;return r.max(...i)}get possibleOutcomes(){var e;const t=new sn([{name:Et,weight:1/3,value:this.dieValue(Et,!0)},{name:St,weight:1/6,value:this.dieValue(St,!0)},{name:Dt,weight:1/6,value:this.dieValue(Dt,!0)},{name:At,weight:1/6,value:this.dieValue(At,!0)},{name:$t,weight:1/6,value:this.dieValue($t,!0)}]);return e=1==this.dice.length?t:this.isRedDice?new gn(new Array(this.dice.length).fill(t)):new mn(new Array(this.dice.length).fill(t)),Object.defineProperty(this,"possibleOutcomes",{value:e}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ya([St,$t,Et,Et,At,Dt])))}},6:class extends Ea{static rollName="Stand Up";failValue(){return this.knockdownValue(this.activePlayer,!1)}},7:class extends Ea{static rollName="Pickup";static rerollSkill=it;static handledSkills=[it,lt,je];failValue(){return this.turnoverValue}},8:ja,9:Ca,10:null,11:null,12:class extends Ea{static rollName="Pass";static rerollSkill=Ye;static handledSkills=[Ye,tt,ze];failValue(){return this.turnoverValue}},13:Na,14:Ra,15:Pa,16:Da,17:class extends Ea{static rollName="Wake Up";constructor(e){super(e),this.finalBoardState.activeTeam=this.activePlayer.team,this.finalBoardState.turn=this.finalBoardState.activeTeam.turn+1}passValue(){return this.koValue(this.activePlayer).product(-1).named("Wake Up")}},19:null,20:class extends Ea{static rollName="Bone Head";static handledSkills=[Ue];failValue(){return this.knockdownValue(this.activePlayer,!1)}},21:class extends Ea{static rollName="Really Stupid";static handledSkills=[Qe];failValue(){return this.knockdownValue(this.activePlayer,!1)}},22:class extends Ea{static rollName="Wild Animal";static handledSkills=[ot];failValue(){return-this.onPitchValue(this.activePlayer)}},24:class extends Ea{static rollName="Landing";static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e)}},26:null,29:class extends Ea{static rollName="Dauntless";static handledSkills=[Ie]},31:class extends Ea{static rollName="Jump-Up";static handledSkills=[Xe];failValue(){return-this.onPitchValue(this.activePlayer)}},36:class extends Ea{static rollName="Leap";static canCauseInjury=!0;failValue(){return this.knockdownValue(this.activePlayer).add(this.turnoverValue)}},40:class extends Ea{static rollName="Take Root";static handledSkills=[Pe];failValue(){return this.knockdownValue(this.activePlayer,!1)}},54:class extends Ea{static rollName="Fireball";static canCauseInjury=!0;passValue(e){return this.knockdownValue(this.activePlayer,e)}},55:class extends Ea{static rollName="Lightning Bolt";static canCauseInjury=!0;static argsFromXml(e){const t=super.argsFromXml(e);return t.activePlayer=t.initialBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}passValue(e){return this.knockdownValue(this.activePlayer,e)}},56:class extends Ea{static rollName="Throw Teammate";static handledSkills=[at];failValue(){return new ln("Fail",0)}isDependentRoll(e){return[Ca,Da].includes(e.constructor)}},58:null,59:Aa,60:Ma,61:null,64:null,70:null},Ba=function(e){var t,n,r,i=(n=(t=e).Replay.ReplayStep[0],r=t.Replay.ReplayStep[t.Replay.ReplayStep.length-1],console.log("Full gameinfo:"),console.log(n.GameInfos),{stadiumName:n.GameInfos.NameStadium,stadiumType:n.GameInfos.StructStadium,leagueName:n.GameInfos.RowLeague.Name,homeTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[0].UserId,teamName:n.BoardState.ListTeams.TeamState[0].Data.Name,raceId:n.BoardState.ListTeams.TeamState[0].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.HomeScore||0},awayTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[1].UserId,teamName:n.BoardState.ListTeams.TeamState[1].Data.Name,raceId:n.BoardState.ListTeams.TeamState[1].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.AwayScore||0}});console.log("Extracted game details...",i);for(var a=[],o=0;o<e.Replay.ReplayStep.length;o++){var s=e.Replay.ReplayStep[o];s.index=o,a=a.concat($a.fromReplayStep(e.Replay.ReplayStep[o-1]&&e.Replay.ReplayStep[o-1].BoardState,o,s))}return console.log("Extracted rolls...",a),(a=(a=a.filter((e=>!e.ignore))).reduce(((e,t)=>(e.length>0&&e[e.length-1].isDependentRoll(t)?e[e.length-1].dependentRolls.push(t):e.push(t),e)),[])).forEach(((e,t)=>{e.rollIndex=t,e.endIndex=a[t+1]?a[t+1].startIndex-1:null})),{fullReplay:e.Replay,gameDetails:i,playerDetails:{},rolls:a,version:1}};function Ia(t){let n,r,i,a,o,s,l,u,c,f,d;return{c(){n=k("div"),r=k("span"),i=O("Select Replay\n    "),a=k("input"),o=S(),s=k("script"),u=k("script"),C(a,"type","file"),C(a,"accept",".bbrz,.zip"),C(a,"class","svelte-16kp35q"),C(r,"id","file-input-button"),C(r,"class","btn btn-primary btn-file centered svelte-16kp35q"),C(n,"class","text-center"),s.src!==(l="https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js")&&C(s,"src","https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js"),u.src!==(c="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js")&&C(u,"src","https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js"),C(u,"integrity","sha512-JtZhe+DT2O3VPwzAMhyOpVY75fn92Zm1ebHVgAdXFf/x+7SfbonV/O7OWLsHkj11+yMtZAXavsuMvCaQS3WXrQ=="),C(u,"crossorigin","anonymous")},m(e,l){x(e,n,l),b(n,r),b(r,i),b(r,a),t[2](a),x(e,o,l),b(document.head,s),b(document.head,u),f||(d=E(a,"change",t[1]),f=!0)},p:e,i:e,o:e,d(e){e&&w(n),t[2](null),e&&w(o),w(s),w(u),f=!1,d()}}}function La(e,t,n){const r=U();let i;return[i,function(){console.log("Preparing to parse XML..."),r("replayLoading");const e=i.files;e.length>0&&De(e[0],(function(t){console.log("Preparing to process replay json..."),t.Replay.filename=e[0].name;const n=Ba(t);r("replayLoaded",n)}),(function(e){r("replayError"),alert(e)}))},function(e){H[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class qa extends Ae{constructor(e){super(),Ee(this,e,La,Ia,s,{})}}function Ua(t){let n;return{c(){n=k("div"),n.innerHTML='<div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 110%">Loading...</div>',C(n,"id","loading"),C(n,"class","progress")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class Va extends Ae{constructor(e){super(),Ee(this,e,null,Ua,s,{})}}function Wa(t){let n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,_,$,E,A,D,j,F,T,N,R,P,z,B,I,L,q,U,V,W,H,G,X,Y,J,K,Q,Z,ee,te,ne,re,ie,ae,oe,se,le,ue,ce,fe,de,he,pe,me,ge,ye=t[0].leagueName+"",ve=t[0].homeTeam.teamName+"",be=t[0].homeTeam.coachName+"",xe=(en[t[0].homeTeam.raceId]||`Unknown: ${t[0].homeTeam.raceId}`)+"",we=t[0].homeTeam.score+"",_e=t[0].awayTeam.score+"",ke=t[0].awayTeam.teamName+"",Oe=t[0].awayTeam.teamName+"",Se=(en[t[0].awayTeam.raceId]||`Unknown: ${t[0].awayTeam.raceId}`)+"",$e=t[0].stadiumName+"",Ee=(t[0].stadiumType||"None")+"";return{c(){n=k("div"),r=k("div"),i=k("div"),a=O(t[1]),o=S(),s=k("div"),l=k("div"),u=O("League:\n      "),c=k("span"),f=O(ye),d=S(),h=k("div"),p=k("div"),m=k("div"),g=k("div"),y=k("span"),v=O(ve),_=S(),$=k("div"),E=O("Coach:\n          "),A=k("span"),D=O(be),j=S(),F=k("div"),T=O("Race:\n          "),N=k("span"),R=O(xe),P=S(),z=k("div"),B=k("span"),I=O(we),L=O("\n        -\n        "),q=k("span"),U=O(_e),V=S(),W=k("div"),H=k("div"),G=k("span"),X=O(ke),Y=S(),J=k("div"),K=O("Coach:\n          "),Q=k("span"),Z=O(Oe),ee=S(),te=k("div"),ne=O("Race:\n          "),re=k("span"),ie=O(Se),ae=S(),oe=k("div"),se=k("div"),le=O("Stadium:\n        "),ue=k("span"),ce=O($e),fe=S(),de=k("div"),he=k("div"),pe=O("Stadium Enhancement:\n        "),me=k("span"),ge=O(Ee),C(i,"class","col-sm-12"),C(r,"class","row filename svelte-ooduml"),C(c,"id","league-name"),C(l,"class","col-sm-12"),C(s,"class","row league-name svelte-ooduml"),C(y,"id","home-team"),C(g,"class","team-name home svelte-ooduml"),C(A,"id","home-coach"),C($,"class","coach-name svelte-ooduml"),C(N,"id","home-race"),C(F,"class","race svelte-ooduml"),C(m,"class","col-sm-5 team-details team-details-left svelte-ooduml"),C(B,"id","home-score"),C(B,"class","home svelte-ooduml"),C(q,"id","away-score"),C(q,"class","away svelte-ooduml"),C(z,"class","col-sm-2 score svelte-ooduml"),C(G,"id","away-team"),C(H,"class","team-name away svelte-ooduml"),C(Q,"id","away-coach"),C(J,"class","coach-name svelte-ooduml"),C(re,"id","away-race"),C(te,"class","race svelte-ooduml"),C(W,"class","col-sm-5 team-details team-details-right svelte-ooduml"),C(p,"class","row"),C(ue,"id","stadium-name"),C(se,"class","col-sm-12"),C(oe,"class","row stadium-name svelte-ooduml"),C(me,"id","stadium-type"),C(he,"class","col-sm-12"),C(de,"class","row stadium-type svelte-ooduml"),C(h,"id","game-details"),C(n,"id","summary"),C(n,"class","container svelte-ooduml")},m(e,t){x(e,n,t),b(n,r),b(r,i),b(i,a),b(n,o),b(n,s),b(s,l),b(l,u),b(l,c),b(c,f),b(n,d),b(n,h),b(h,p),b(p,m),b(m,g),b(g,y),b(y,v),b(m,_),b(m,$),b($,E),b($,A),b(A,D),b(m,j),b(m,F),b(F,T),b(F,N),b(N,R),b(p,P),b(p,z),b(z,B),b(B,I),b(z,L),b(z,q),b(q,U),b(p,V),b(p,W),b(W,H),b(H,G),b(G,X),b(W,Y),b(W,J),b(J,K),b(J,Q),b(Q,Z),b(W,ee),b(W,te),b(te,ne),b(te,re),b(re,ie),b(h,ae),b(h,oe),b(oe,se),b(se,le),b(se,ue),b(ue,ce),b(h,fe),b(h,de),b(de,he),b(he,pe),b(he,me),b(me,ge)},p(e,[t]){2&t&&M(a,e[1]),1&t&&ye!==(ye=e[0].leagueName+"")&&M(f,ye),1&t&&ve!==(ve=e[0].homeTeam.teamName+"")&&M(v,ve),1&t&&be!==(be=e[0].homeTeam.coachName+"")&&M(D,be),1&t&&xe!==(xe=(en[e[0].homeTeam.raceId]||`Unknown: ${e[0].homeTeam.raceId}`)+"")&&M(R,xe),1&t&&we!==(we=e[0].homeTeam.score+"")&&M(I,we),1&t&&_e!==(_e=e[0].awayTeam.score+"")&&M(U,_e),1&t&&ke!==(ke=e[0].awayTeam.teamName+"")&&M(X,ke),1&t&&Oe!==(Oe=e[0].awayTeam.teamName+"")&&M(Z,Oe),1&t&&Se!==(Se=(en[e[0].awayTeam.raceId]||`Unknown: ${e[0].awayTeam.raceId}`)+"")&&M(ie,Se),1&t&&$e!==($e=e[0].stadiumName+"")&&M(ce,$e),1&t&&Ee!==(Ee=(e[0].stadiumType||"None")+"")&&M(ge,Ee)},i:e,o:e,d(e){e&&w(n)}}}function Ha(e,t,n){let{gameDetails:r}=t,{filename:i}=t;return e.$$set=e=>{"gameDetails"in e&&n(0,r=e.gameDetails),"filename"in e&&n(1,i=e.filename)},[r,i]}class Ga extends Ae{constructor(e){super(),Ee(this,e,Ha,Wa,s,{gameDetails:0,filename:1})}}function Xa(t){let n;return{c(){n=k("div"),n.innerHTML='<div class="col-sm-12"><div><h1>What am I looking at?</h1> \n      <p>Diced or Not has imported your replay, and categorized each of the dice\n        rolls how much value you got out of them, based on whether they passed\n        or failed. It also computed what value you should have expected to get\n        out of those rolls. Finally, it compared the value you got to the\n        expected value, and add up that net value across the game. You can see\n        that trend-line in the graph above.</p> \n      <p>The values attributed to the rolls are based on the following standards:</p> \n      <ul><li>Each teams player positions/activations is worth 1 per turn. This\n          means that a block that results in a knockdown for your opponent will\n          give you fractional points based on that player&#39;s TV value compared to\n          the whole team value, while getting your own player stunned would cost\n          you that same fraction, but times multiple turns.</li> \n        <li>Future player value is time-discounted to account for the uncertainty\n          of future events. So, if first turn of knockdown is worth 0.1, then\n          the second turn of a stun would be worth 0.09, the third 0.081, and so\n          on.</li> \n        <li>Player value is scaled based on vicinity to the ball and goal line.\n          So, having the ball doubles the value of your player, and marking the\n          ball multiplies the value by 1.5. Being within movement distance of\n          the endzone also multiplies player value, by larger amounts as the\n          player is closer to the endzone.</li> \n        <li>Ball-possession and fields position account for another pool of\n          points. Based on the expectation of a team taking 8 turns to score\n          once in a drive, moving the ball all the way up the field and scoring\n          a touchdown should be worth 8 points. We divide that in half: 4 points\n          for actually scoring the touchdown, and 4 points for moving the ball\n          up the field. The 4 field-position points are weighted more heavily\n          toward the endzone, and are awarded by net-position. So, moving the\n          ball one square forward gives you points equal to the value of your\n          new position minus the value of your old position.</li></ul> \n      <p>Once your game was analyzed, Diced or Not simulated rolling those same\n        sets of dice\n        <span id="game-count">0</span>\n        more times, and compared the net value of your game to the net value in\n        the simulated games. The fainter background lines show the 99th, 90th,\n        75th, 50th, 25th, 10th, and 1st percentile cumulative net-values. So, if\n        your line is above the top background line, then your game was better\n        than 99% of games with the same dice, and you most definitely were not\n        diced. If you line was below the 3rd line from the bottom, then your\n        game was worse than 3/4s of games, and you might have a slight argument\n        for having been diced.</p></div> \n    <div><h2>Terminology</h2> \n      <dl><dt id="value-def">Value</dt><dd>An abstraction of how much getting that roll result likely helped your\n          game. For example, getting a Defender Down on a Block roll would be a\n          +1 value, and getting an Attacker Down on a Block roll would be a -1\n          value (because it ends your turn). More details of the values assigned\n          are listed in the\n          <a href="#value-table">Values Table</a>.\n        </dd><dt id="expected-value-def">Expected Value</dt><dd>The average\n          <a href="value-def">Value</a>\n          over all of the possible results of a roll.\n        </dd><dt>Net Value</dt><dd>The difference between the actual value and the expected value on a\n          specific roll.\n        </dd><dt>Cumulative Net Value</dt><dd>The running total of Net Value for all the rolls taken so far by a\n          team.</dd></dl></div> \n    <div><h2>To Do</h2> \n      <div><h3>Value calculation changes</h3> \n        <ul><li>Add points when a touchdown is scored.</li> \n          <li>Count net change in points between rolls.</li> \n          <li>Handle the value of team rerolls, and the expected results of\n            rerolling.</li> \n          <li>Account for Bribe use in Fouls.</li> \n          <li>Compute player value by using actual TV values.</li> \n          <li>Adjust player value based on distance to endzone.</li> \n          <li>Include Piling-On in block expected value calculations.</li> \n          <li>Make sure armor/injury rolls make use of Mighty Blow in expected\n            value calculations.</li> \n          <li>Make sure that Claw is properly accounted for in possible outcome\n            calculations.</li> \n          <li>Make sure that Dirty Player is properly accountef for in possibel\n            outcome calculations.</li></ul></div> \n      <div><h3>Display improvements</h3> \n        <ul><li>Add thumbnails of the board state across the game.</li> \n          <li>Make the Dice logs less verbose by making player stats popups.</li> \n          <li>Display the full range of expected values and their probablities on\n            the graph.</li></ul></div></div></div>',C(n,"id","explanation"),C(n,"class","row")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class Ya extends Ae{constructor(e){super(),Ee(this,e,null,Xa,s,{})}}function Ja(t){let n;return{c(){n=k("div"),n.innerHTML='<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> \n    <span class="sr-only">Error:</span>\n    Could not process saved replay data, it might be a bad URL.',C(n,"class","alert alert-danger svelte-tlpcpu"),C(n,"role","alert"),C(n,"id","data-param-error")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class Ka extends Ae{constructor(e){super(),Ee(this,e,null,Ja,s,{})}}function Qa(e,t,n){const r=e.slice();return r[7]=t[n],r}function Za(e,t,n){const r=e.slice();return r[7]=t[n],r}function eo(t){let n;return{c(){n=O(t[0])},m(e,t){x(e,n,t)},p(e,t){1&t&&M(n,e[0])},i:e,o:e,d(e){e&&w(n)}}}function to(e){let t,n,r,i,a,o,s,l,u,c,f=e[0].values.reduce(e[5],null)+"",d=e[0].valueString+"",h=e[0].name&&ao(e),p=e[1]&&oo(e);return{c(){t=k("details"),n=k("summary"),h&&h.c(),r=S(),i=O(f),a=S(),o=O(d),s=S(),p&&p.c(),t.open=e[1]},m(f,d){x(f,t,d),b(t,n),h&&h.m(n,null),b(n,r),b(n,i),b(n,a),b(n,o),b(t,s),p&&p.m(t,null),l=!0,u||(c=E(t,"click",D(A(e[6]))),u=!0)},p(e,a){e[0].name?h?h.p(e,a):(h=ao(e),h.c(),h.m(n,r)):h&&(h.d(1),h=null),(!l||1&a)&&f!==(f=e[0].values.reduce(e[5],null)+"")&&M(i,f),(!l||1&a)&&d!==(d=e[0].valueString+"")&&M(o,d),e[1]?p?(p.p(e,a),2&a&&de(p,1)):(p=oo(e),p.c(),de(p,1),p.m(t,null)):p&&(ce(),he(p,1,1,(()=>{p=null})),fe()),(!l||2&a)&&(t.open=e[1])},i(e){l||(de(p),l=!0)},o(e){he(p),l=!1},d(e){e&&w(t),h&&h.d(),p&&p.d(),u=!1,c()}}}function no(e){let t,n;return t=new xo({props:{dist:e[0].simple}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.dist=e[0].simple),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function ro(e){let t,n,r,i,a,o,s,l,u=e[0].valueString+"",c=e[0].name&&co(e),f=e[1]&&fo(e);return{c(){t=k("details"),n=k("summary"),c&&c.c(),r=S(),i=O(u),a=S(),f&&f.c(),t.open=e[1]},m(u,d){x(u,t,d),b(t,n),c&&c.m(n,null),b(n,r),b(n,i),b(t,a),f&&f.m(t,null),o=!0,s||(l=E(t,"click",D(A(e[4]))),s=!0)},p(e,a){e[0].name?c?c.p(e,a):(c=co(e),c.c(),c.m(n,r)):c&&(c.d(1),c=null),(!o||1&a)&&u!==(u=e[0].valueString+"")&&M(i,u),e[1]?f?(f.p(e,a),2&a&&de(f,1)):(f=fo(e),f.c(),de(f,1),f.m(t,null)):f&&(ce(),he(f,1,1,(()=>{f=null})),fe()),(!o||2&a)&&(t.open=e[1])},i(e){o||(de(f),o=!0)},o(e){he(f),o=!1},d(e){e&&w(t),c&&c.d(),f&&f.d(),s=!1,l()}}}function io(e){let t,n,r,i;const a=[yo,go],o=[];function s(e,t){return e[0].value instanceof on?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=$()},m(e,n){o[t].m(e,n),x(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ce(),he(o[l],1,1,(()=>{o[l]=null})),fe(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),de(n,1),n.m(r.parentNode,r))},i(e){i||(de(n),i=!0)},o(e){he(n),i=!1},d(e){o[t].d(e),e&&w(r)}}}function ao(e){let t,n,r=e[0].name+"";return{c(){t=O(r),n=O(" →")},m(e,r){x(e,t,r),x(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&M(t,r)},d(e){e&&w(t),e&&w(n)}}}function oo(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=uo(Qa(e,a,t));const s=e=>he(o[e],1,1,(()=>{o[e]=null}));return{c(){t=k("ul");for(let e=0;e<o.length;e+=1)o[e].c();C(t,"class","list-group")},m(a,s){x(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",D(e[3])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Qa(e,a,r);o[r]?(o[r].p(i,n),de(o[r],1)):(o[r]=uo(i),o[r].c(),de(o[r],1),o[r].m(t,null))}for(ce(),r=a.length;r<o.length;r+=1)s(r);fe()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)de(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)he(o[e]);n=!1},d(e){e&&w(t),_(o,e),r=!1,i()}}}function so(t){let n,r,i,a=t[7].toFixed(2)+"";return{c(){n=k("li"),r=O(a),i=S(),C(n,"class","list-group-item list-group-item-action")},m(e,t){x(e,n,t),b(n,r),b(n,i)},p(e,t){1&t&&a!==(a=e[7].toFixed(2)+"")&&M(r,a)},i:e,o:e,d(e){e&&w(n)}}}function lo(e){let t,n,r,i;return n=new xo({props:{dist:e[7]}}),{c(){t=k("li"),Oe(n.$$.fragment),r=S(),C(t,"class","list-group-item list-group-item-action")},m(e,a){x(e,t,a),Se(n,t,null),b(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7]),n.$set(r)},i(e){i||(de(n.$$.fragment,e),i=!0)},o(e){he(n.$$.fragment,e),i=!1},d(e){e&&w(t),$e(n)}}}function uo(e){let t,n,r,i;const a=[lo,so],o=[];function s(e,t){return e[7]instanceof on?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=$()},m(e,n){o[t].m(e,n),x(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ce(),he(o[l],1,1,(()=>{o[l]=null})),fe(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),de(n,1),n.m(r.parentNode,r))},i(e){i||(de(n),i=!0)},o(e){he(n),i=!1},d(e){o[t].d(e),e&&w(r)}}}function co(e){let t,n,r=e[0].name+"";return{c(){t=O(r),n=O(" →")},m(e,r){x(e,t,r),x(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&M(t,r)},d(e){e&&w(t),e&&w(n)}}}function fo(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=mo(Za(e,a,t));const s=e=>he(o[e],1,1,(()=>{o[e]=null}));return{c(){t=k("ul");for(let e=0;e<o.length;e+=1)o[e].c();C(t,"class","list-group")},m(a,s){x(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",D(e[2])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Za(e,a,r);o[r]?(o[r].p(i,n),de(o[r],1)):(o[r]=mo(i),o[r].c(),de(o[r],1),o[r].m(t,null))}for(ce(),r=a.length;r<o.length;r+=1)s(r);fe()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)de(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)he(o[e]);n=!1},d(e){e&&w(t),_(o,e),r=!1,i()}}}function ho(t){let n,r,i,a,o,s,l,u=(100*t[7].weight).toFixed(1)+"",c=t[7].name+"",f=t[7].value+"";return{c(){n=k("li"),r=O(u),i=O("%:\n              "),a=O(c),o=O("\n              →\n              "),s=O(f),l=S(),C(n,"class","list-group-item list-group-item-action")},m(e,t){x(e,n,t),b(n,r),b(n,i),b(n,a),b(n,o),b(n,s),b(n,l)},p(e,t){1&t&&u!==(u=(100*e[7].weight).toFixed(1)+"")&&M(r,u),1&t&&c!==(c=e[7].name+"")&&M(a,c),1&t&&f!==(f=e[7].value+"")&&M(s,f)},i:e,o:e,d(e){e&&w(n)}}}function po(e){let t,n,r,i;return n=new xo({props:{dist:e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)}}),{c(){t=k("li"),Oe(n.$$.fragment),r=S(),C(t,"class","list-group-item list-group-item-action")},m(e,a){x(e,t,a),Se(n,t,null),b(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)),n.$set(r)},i(e){i||(de(n.$$.fragment,e),i=!0)},o(e){he(n.$$.fragment,e),i=!1},d(e){e&&w(t),$e(n)}}}function mo(e){let t,n,r,i;const a=[po,ho],o=[];function s(e,t){return e[7].value instanceof on?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=$()},m(e,n){o[t].m(e,n),x(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ce(),he(o[l],1,1,(()=>{o[l]=null})),fe(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),de(n,1),n.m(r.parentNode,r))},i(e){i||(de(n),i=!0)},o(e){he(n),i=!1},d(e){o[t].d(e),e&&w(r)}}}function go(t){let n,r,i,a=t[0].name+"",o=t[0].valueString+"";return{c(){n=O(a),r=S(),i=O(o)},m(e,t){x(e,n,t),x(e,r,t),x(e,i,t)},p(e,t){1&t&&a!==(a=e[0].name+"")&&M(n,a),1&t&&o!==(o=e[0].valueString+"")&&M(i,o)},i:e,o:e,d(e){e&&w(n),e&&w(r),e&&w(i)}}}function yo(e){let t,n,r;return t=new xo({props:{dist:e[0].value.named(e[0].name)}}),{c(){Oe(t.$$.fragment),n=O(";")},m(e,i){Se(t,e,i),x(e,n,i),r=!0},p(e,n){const r={};1&n&&(r.dist=e[0].value.named(e[0].name)),t.$set(r)},i(e){r||(de(t.$$.fragment,e),r=!0)},o(e){he(t.$$.fragment,e),r=!1},d(e){$e(t,e),e&&w(n)}}}function vo(e){let t,n,r,i;const a=[io,ro,no,to,eo],o=[];function s(e,t){return e[0]instanceof ln?0:e[0]instanceof sn?1:e[0]instanceof pn?2:e[0]instanceof un?3:4}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=$()},m(e,n){o[t].m(e,n),x(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(ce(),he(o[l],1,1,(()=>{o[l]=null})),fe(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),de(n,1),n.m(r.parentNode,r))},i(e){i||(de(n),i=!0)},o(e){he(n),i=!1},d(e){o[t].d(e),e&&w(r)}}}function bo(e,t,n){let{dist:r}=t,i=!1;return e.$$set=e=>{"dist"in e&&n(0,r=e.dist)},[r,i,function(t){V(e,t)},function(t){V(e,t)},()=>n(1,i=!i),(e,t)=>e?r.nameFunc(e,t.name||t):t.name,()=>n(1,i=!i)]}class xo extends Ae{constructor(e){super(),Ee(this,e,bo,vo,s,{dist:0})}}function wo(e,t,n){const r=e.slice();return r[7]=t[n],r}function _o(t){let n,r,i,a,o,s,l=t[0].jointDescription+"",u=t[0].valueWithDependents.valueString+"",c=t[0].possibleOutcomes.valueString+"";return{c(){n=k("div"),r=O(l),i=S(),a=O(u),o=S(),s=O(c)},m(e,t){x(e,n,t),b(n,r),b(n,i),b(n,a),b(n,o),b(n,s)},p(e,t){1&t&&l!==(l=e[0].jointDescription+"")&&M(r,l),1&t&&u!==(u=e[0].valueWithDependents.valueString+"")&&M(a,u),1&t&&c!==(c=e[0].possibleOutcomes.valueString+"")&&M(s,c)},i:e,o:e,d(e){e&&w(n)}}}function ko(e){let t,n,r,i,o,s,l,u,c,f,d,h,p,m,g,y,v,_,$,j,F=e[0].jointDescription+"",T=e[0].valueWithDependents.valueString+"",N=e[0].possibleOutcomes.valueString+"",R=e[3]&&Oo(e);return y=new xo({props:{dist:e[0].possibleOutcomes.named("Possible Outcomes")}}),{c(){t=k("details"),n=k("summary"),r=O(F),i=S(),o=O(T),s=S(),l=O(N),u=S(),c=k("ul"),f=k("li"),d=k("details"),h=k("summary"),h.textContent="Actual Outcomes",p=S(),R&&R.c(),m=S(),g=k("li"),Oe(y.$$.fragment),d.open=e[3],C(f,"class","list-group-item list-group-item-action"),C(g,"class","list-group-item list-group-item-action"),C(c,"class","list-group"),C(t,"id",v="roll-"+e[0].rollIndex)},m(a,v){x(a,t,v),b(t,n),b(n,r),b(n,i),b(n,o),b(n,s),b(n,l),b(t,u),b(t,c),b(c,f),b(f,d),b(d,h),b(d,p),R&&R.m(d,null),b(c,m),b(c,g),Se(y,g,null),_=!0,$||(j=[E(d,"click",D(A(e[6]))),E(c,"click",D(e[4]))],$=!0)},p(e,n){(!_||1&n)&&F!==(F=e[0].jointDescription+"")&&M(r,F),(!_||1&n)&&T!==(T=e[0].valueWithDependents.valueString+"")&&M(o,T),(!_||1&n)&&N!==(N=e[0].possibleOutcomes.valueString+"")&&M(l,N),e[3]?R?(R.p(e,n),8&n&&de(R,1)):(R=Oo(e),R.c(),de(R,1),R.m(d,null)):R&&(ce(),he(R,1,1,(()=>{R=null})),fe()),(!_||8&n)&&(d.open=e[3]);const i={};1&n&&(i.dist=e[0].possibleOutcomes.named("Possible Outcomes")),y.$set(i),(!_||1&n&&v!==(v="roll-"+e[0].rollIndex))&&C(t,"id",v)},i(e){_||(de(R),de(y.$$.fragment,e),_=!0)},o(e){he(R),he(y.$$.fragment,e),_=!1},d(e){e&&w(t),R&&R.d(),$e(y),$=!1,a(j)}}}function Oo(e){let t,n,r,i,a=e[2],o=[];for(let t=0;t<a.length;t+=1)o[t]=So(wo(e,a,t));const s=e=>he(o[e],1,1,(()=>{o[e]=null}));return{c(){t=k("ul");for(let e=0;e<o.length;e+=1)o[e].c();C(t,"class","list-group")},m(a,s){x(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",D(e[5])),r=!0)},p(e,n){if(4&n){let r;for(a=e[2],r=0;r<a.length;r+=1){const i=wo(e,a,r);o[r]?(o[r].p(i,n),de(o[r],1)):(o[r]=So(i),o[r].c(),de(o[r],1),o[r].m(t,null))}for(ce(),r=a.length;r<o.length;r+=1)s(r);fe()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)de(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)he(o[e]);n=!1},d(e){e&&w(t),_(o,e),r=!1,i()}}}function So(e){let t,n,r,i;return n=new xo({props:{dist:e[7]}}),{c(){t=k("li"),Oe(n.$$.fragment),r=S(),C(t,"class","list-group-item list-group-item-action")},m(e,a){x(e,t,a),Se(n,t,null),b(t,r),i=!0},p(e,t){const r={};4&t&&(r.dist=e[7]),n.$set(r)},i(e){i||(de(n.$$.fragment,e),i=!0)},o(e){he(n.$$.fragment,e),i=!1},d(e){e&&w(t),$e(n)}}}function $o(e){let t,n,r,i;const a=[ko,_o],o=[];function s(e,t){return e[1]?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=$()},m(e,n){o[t].m(e,n),x(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(ce(),he(o[l],1,1,(()=>{o[l]=null})),fe(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),de(n,1),n.m(r.parentNode,r))},i(e){i||(de(n),i=!0)},o(e){he(n),i=!1},d(e){o[t].d(e),e&&w(r)}}}function Eo(e,t,n){let r,{roll:i}=t,{selected:a}=t,o=!1;return e.$$set=e=>{"roll"in e&&n(0,i=e.roll),"selected"in e&&n(1,a=e.selected)},e.$$.update=()=>{1&e.$$.dirty&&n(2,r=[i,...i.dependentRolls].map((e=>{const t=e.actualValue;return t.name?t.named(`${e.shortDescription} - ${t.name}`):t.named(e.shortDescription)})))},[i,a,r,o,function(t){V(e,t)},function(t){V(e,t)},()=>n(3,o=!o)]}class Ao extends Ae{constructor(e){super(),Ee(this,e,Eo,$o,s,{roll:0,selected:1})}}function Do(e,t,n){const r=e.slice();return r[2]=t[n],r}function Co(e,t){let n,r,i,a;return r=new Ao({props:{roll:t[2],selected:t[1]==t[2].rollIndex}}),{key:e,first:null,c(){n=k("li"),Oe(r.$$.fragment),i=S(),C(n,"class","list-group-item list-group-item-action"),F(n,"active",t[1]==t[2].rollIndex),this.first=n},m(e,t){x(e,n,t),Se(r,n,null),b(n,i),a=!0},p(e,t){const i={};1&t&&(i.roll=e[2]),3&t&&(i.selected=e[1]==e[2].rollIndex),r.$set(i),3&t&&F(n,"active",e[1]==e[2].rollIndex)},i(e){a||(de(r.$$.fragment,e),a=!0)},o(e){he(r.$$.fragment,e),a=!1},d(e){e&&w(n),$e(r)}}}function Mo(e){let t,n,r=[],i=new Map,a=e[0];const o=e=>e[2].rollIndex;for(let t=0;t<a.length;t+=1){let n=Do(e,a,t),s=o(n);i.set(s,r[t]=Co(s,n))}return{c(){t=k("ul");for(let e=0;e<r.length;e+=1)r[e].c();C(t,"class","list-group")},m(e,i){x(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,[n]){if(3&n){const a=e[0];ce(),r=xe(r,n,o,1,e,a,i,t,be,Co,null,Do),fe()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)de(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)he(r[e]);n=!1},d(e){e&&w(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function jo(e,t,n){let{rolls:r}=t,{selectedRoll:i}=t;return e.$$set=e=>{"rolls"in e&&n(0,r=e.rolls),"selectedRoll"in e&&n(1,i=e.selectedRoll)},[r,i]}class Fo extends Ae{constructor(e){super(),Ee(this,e,jo,Mo,s,{rolls:0,selectedRoll:1})}}function To(t){let n,r,i;return{c(){n=k("div"),r=O(t[1]),C(n,"class",i=d(`team team-${t[2]}`)+" svelte-1jw4bbo"),C(n,"title",t[1]),F(n,"current",t[0]),F(n,"active",t[3])},m(e,t){x(e,n,t),b(n,r)},p(e,[t]){2&t&&M(r,e[1]),4&t&&i!==(i=d(`team team-${e[2]}`)+" svelte-1jw4bbo")&&C(n,"class",i),2&t&&C(n,"title",e[1]),5&t&&F(n,"current",e[0]),12&t&&F(n,"active",e[3])},i:e,o:e,d(e){e&&w(n)}}}function No(e,t,n){let r,i,a,o,{rolls:s}=t,{replayStepIndex:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return e.$$set=e=>{"rolls"in e&&n(4,s=e.rolls),"replayStepIndex"in e&&n(5,l=e.replayStepIndex),"replayStart"in e&&n(6,u=e.replayStart),"replayEnd"in e&&n(7,c=e.replayEnd)},e.$$.update=()=>{if(241&e.$$.dirty){n(1,r=s[0].turn),n(2,i=s[0].activeTeam.id);let e=s[0].startIndex,t=s[s.length-1].endIndex;n(0,a=e<=l&&t>=l),n(3,o=a||(!u||u<=e)&&(!c||t&&c>=t))}},[a,r,i,o,s,l,u,c]}class Ro extends Ae{constructor(e){super(),Ee(this,e,No,To,s,{rolls:4,replayStepIndex:5,replayStart:6,replayEnd:7})}}function Po(e,t,n){const r=e.slice();return r[3]=t[n],r}function zo(e){let t,n,r,i;function a(t){e[7].call(null,t)}function o(t){e[8].call(null,t)}let s={rolls:e[3],replayStepIndex:e[2]};return void 0!==e[0]&&(s.replayStart=e[0]),void 0!==e[1]&&(s.replayEnd=e[1]),t=new Ro({props:s}),H.push((()=>ke(t,"replayStart",a))),H.push((()=>ke(t,"replayEnd",o))),{c(){Oe(t.$$.fragment)},m(e,n){Se(t,e,n),i=!0},p(e,i){const a={};16&i&&(a.rolls=e[3]),4&i&&(a.replayStepIndex=e[2]),!n&&1&i&&(n=!0,a.replayStart=e[0],ee((()=>n=!1))),!r&&2&i&&(r=!0,a.replayEnd=e[1],ee((()=>r=!1))),t.$set(a)},i(e){i||(de(t.$$.fragment,e),i=!0)},o(e){he(t.$$.fragment,e),i=!1},d(e){$e(t,e)}}}function Bo(e){let t,n,r;return n=new Fo({props:{rolls:e[6],selectedRoll:e[5]}}),{c(){t=k("div"),Oe(n.$$.fragment),C(t,"class","details-list")},m(e,i){x(e,t,i),Se(n,t,null),r=!0},p(e,t){const r={};64&t&&(r.rolls=e[6]),32&t&&(r.selectedRoll=e[5]),n.$set(r)},i(e){r||(de(n.$$.fragment,e),r=!0)},o(e){he(n.$$.fragment,e),r=!1},d(e){e&&w(t),$e(n)}}}function Io(e){let t,n,r,i,a,o=e[4],s=[];for(let t=0;t<o.length;t+=1)s[t]=zo(Po(e,o,t));const l=e=>he(s[e],1,1,(()=>{s[e]=null}));let u=e[5]&&e[6]&&e[6].length>0&&Bo(e);return{c(){t=k("div"),n=k("div");for(let e=0;e<s.length;e+=1)s[e].c();r=S(),u&&u.c(),i=$(),C(n,"class","turn-list")},m(e,o){x(e,t,o),b(t,n);for(let e=0;e<s.length;e+=1)s[e].m(n,null);x(e,r,o),u&&u.m(e,o),x(e,i,o),a=!0},p(e,[t]){if(23&t){let r;for(o=e[4],r=0;r<o.length;r+=1){const i=Po(e,o,r);s[r]?(s[r].p(i,t),de(s[r],1)):(s[r]=zo(i),s[r].c(),de(s[r],1),s[r].m(n,null))}for(ce(),r=o.length;r<s.length;r+=1)l(r);fe()}e[5]&&e[6]&&e[6].length>0?u?(u.p(e,t),96&t&&de(u,1)):(u=Bo(e),u.c(),de(u,1),u.m(i.parentNode,i)):u&&(ce(),he(u,1,1,(()=>{u=null})),fe())},i(e){if(!a){for(let e=0;e<o.length;e+=1)de(s[e]);de(u),a=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)he(s[e]);he(u),a=!1},d(e){e&&w(t),_(s,e),e&&w(r),u&&u.d(e),e&&w(i)}}}function Lo(e,t,n){let r,i,a,o,{rolls:s}=t,{replayStepIndex:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return e.$$set=e=>{"rolls"in e&&n(3,s=e.rolls),"replayStepIndex"in e&&n(2,l=e.replayStepIndex),"replayStart"in e&&n(0,u=e.replayStart),"replayEnd"in e&&n(1,c=e.replayEnd)},e.$$.update=()=>{60&e.$$.dirty&&(n(5,i=function(e){let t=s.findIndex((t=>e<t.stepIndex));return t>0?s[t-1].rollIndex:0}(l)),function(e,t){n(4,r=e.reduce(((e,t)=>{const n=e[e.length-1],r=n&&n[n.length-1];return n&&r&&r.activeTeam.id==t.activeTeam.id&&r.turn==t.turn?n.push(t):e.push([t]),e}),[]))}(s),n(6,o=r.find((e=>{let t=e[0].startIndex,n=e[e.length-1].endIndex;return t<=l&&n>=l}))),a=r.length)},[u,c,l,s,r,i,o,function(e){u=e,n(0,u)},function(e){c=e,n(1,c)}]}class qo extends Ae{constructor(e){super(),Ee(this,e,Lo,Io,s,{rolls:3,replayStepIndex:2,replayStart:0,replayEnd:1})}}
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */var Uo,Vo=(Uo=function(e,t){return(Uo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}Uo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Wo=Object.prototype.hasOwnProperty;function Ho(e,t){return Wo.call(e,t)}function Go(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)Ho(e,r)&&t.push(r);return t}function Xo(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Yo(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function Jo(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Ko(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Qo(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Qo(e[t]))return!0}else if("object"==typeof e){var r=Go(e),i=r.length;for(t=0;t<i;t++)if(Qo(e[r[t]]))return!0}return!1}function Zo(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var es=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,Zo(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=Zo(t,{name:n,index:r,operation:i,tree:a}),s}return Vo(t,e),t}(Error),ts=es,ns=Xo,rs={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=as(n,this.path);r&&(r=Xo(r));var i=os(n,{op:"remove",path:this.from}).removed;return os(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=as(n,this.from);return os(n,{op:"add",path:this.path,value:Xo(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:cs(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},is={add:function(e,t,n){return Yo(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:rs.move,copy:rs.copy,test:rs.test,_get:rs._get};function as(e,t){if(""==t)return e;var n={op:"_get",path:t};return os(e,n),n.value}function os(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):ls(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=as(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=cs(e,t.value),!1===o.test)throw new ts("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new ts("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=Xo(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,f=void 0,d=void 0,h=void 0;for(h="function"==typeof n?n:ls;;){if(d=s[u],i&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===l[d]?f=s.slice(0,u).join("/"):u==c-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(n&&!Yo(d))throw new ts("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Yo(d)&&(d=~~d)}if(u>=c){if(n&&"add"===t.op&&d>l.length)throw new ts("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=is[t.op].call(t,l,d,e)).test)throw new ts("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(d&&-1!=d.indexOf("~")&&(d=Ko(d)),u>=c){if(!1===(o=rs[t.op].call(t,l,d,e)).test)throw new ts("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[d]}}function ss(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new ts("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Xo(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=os(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function ls(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new ts("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!rs[e.op])throw new ts("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new ts("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new ts('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new ts("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new ts("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Qo(e.value))throw new ts("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new ts("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new ts("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=us([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new ts("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function us(e,t,n){try{if(!Array.isArray(e))throw new ts("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ss(Xo(t),Xo(e),n||!0);else{n=n||ls;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof ts)return e;throw e}}function cs(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!cs(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!cs(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var fs=Object.freeze({__proto__:null,JsonPatchError:ts,deepClone:ns,getValueByPointer:as,applyOperation:os,applyPatch:ss,applyReducer:function(e,t,n){var r=os(e,t);if(!1===r.test)throw new ts("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument},validator:ls,validate:us,_areEquals:cs}),ds=new WeakMap,hs=function(e){this.observers=new Map,this.obj=e},ps=function(e,t){this.callback=e,this.observer=t};
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */function ms(e,t){void 0===t&&(t=!1);var n=ds.get(e.object);gs(n.value,e.object,e.patches,"",t),e.patches.length&&ss(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function gs(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=Go(t),o=Go(e),s=!1,l=o.length-1;l>=0;l--){var u=e[f=o[l]];if(!Ho(t,f)||void 0===t[f]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Jo(f),value:Xo(u)}),n.push({op:"remove",path:r+"/"+Jo(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[f];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?gs(u,c,n,r+"/"+Jo(f),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+Jo(f),value:Xo(u)}),n.push({op:"replace",path:r+"/"+Jo(f),value:Xo(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var f;Ho(e,f=a[l])||void 0===t[f]||n.push({op:"add",path:r+"/"+Jo(f),value:Xo(t[f])})}}}var ys=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){return ds.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new hs(e),ds.set(e,r);if(n)return n;if(n={},r.value=Xo(e),t){n.callback=t,n.next=null;var a=function(){ms(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){ms(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new ps(t,n)),n},generate:ms,compare:function(e,t,n){void 0===n&&(n=!1);var r=[];return gs(e,t,r,"",n),r}});Object.assign({},fs,ys,{JsonPatchError:es,deepClone:Xo,escapePathComponent:Jo,unescapePathComponent:Ko});var vs=/("(?:[^\\"]|\\.)*")|[:,]/g,bs=function(e,t){var n,r,i;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),r=""===n?1/0:void 0===t.maxLength?80:t.maxLength,i=t.replacer,function e(t,a,o){var s,l,u,c,f,d,h,p,m,g,y,v;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,i)))return y;if(h=r-a.length-o,y.length<=h&&(m=y.replace(vs,(function(e,t){return t||e+" "}))).length<=h)return m;if(null!=i&&(t=JSON.parse(y),i=void 0),"object"==typeof t&&null!==t){if(p=a+n,u=[],l=0,Array.isArray(t))for(g="[",s="]",h=t.length;l<h;l++)u.push(e(t[l],p,l===h-1?0:1)||"null");else for(g="{",s="}",h=(d=Object.keys(t)).length;l<h;l++)c=d[l],f=JSON.stringify(c)+": ",void 0!==(v=e(t[c],p,f.length+(l===h-1?0:1)))&&u.push(f+v);if(u.length>0)return[g,n+u.join(",\n"+p),s].join("\n"+a)}return y}(e,"",0)};function xs(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var ws={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var _s="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},ks=xs((function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=ws,r=(t=e.exports={}).re=[],i=t.src=[],a=t.t={};let o=0;const s=(e,t,n)=>{const s=o++;_s(s,t),a[e]=s,i[s]=t,r[s]=new RegExp(t,n?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),s("FULL",`^${i[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),s("LOOSE",`^${i[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),s("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",i[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));const Os=["includePrerelease","loose","rtl"];var Ss=e=>e?"object"!=typeof e?{loose:!0}:Os.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const $s=/^[0-9]+$/,Es=(e,t)=>{const n=$s.test(e),r=$s.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var As={compareIdentifiers:Es,rcompareIdentifiers:(e,t)=>Es(t,e)};const{MAX_LENGTH:Ds,MAX_SAFE_INTEGER:Cs}=ws,{re:Ms,t:js}=ks,{compareIdentifiers:Fs}=As;class Ts{constructor(e,t){if(t=Ss(t),e instanceof Ts){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>Ds)throw new TypeError(`version is longer than ${Ds} characters`);_s("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?Ms[js.LOOSE]:Ms[js.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Cs||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Cs||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Cs||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Cs)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(_s("SemVer.compare",this.version,this.options,e),!(e instanceof Ts)){if("string"==typeof e&&e===this.version)return 0;e=new Ts(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ts||(e=new Ts(e,this.options)),Fs(this.major,e.major)||Fs(this.minor,e.minor)||Fs(this.patch,e.patch)}comparePre(e){if(e instanceof Ts||(e=new Ts(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(_s("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Fs(n,r)}while(++t)}compareBuild(e){e instanceof Ts||(e=new Ts(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(_s("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Fs(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Ns=Ts;const{MAX_LENGTH:Rs}=ws,{re:Ps,t:zs}=ks;var Bs=(e,t)=>{if(t=Ss(t),e instanceof Ns)return e;if("string"!=typeof e)return null;if(e.length>Rs)return null;if(!(t.loose?Ps[zs.LOOSE]:Ps[zs.FULL]).test(e))return null;try{return new Ns(e,t)}catch(e){return null}};var Is=(e,t)=>{const n=Bs(e,t);return n?n.version:null};var Ls=(e,t)=>{const n=Bs(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var qs=(e,t,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new Ns(e,n).inc(t,r).version}catch(e){return null}};var Us=(e,t,n)=>new Ns(e,n).compare(new Ns(t,n));var Vs=(e,t,n)=>0===Us(e,t,n);var Ws=(e,t)=>{if(Vs(e,t))return null;{const n=Bs(e),r=Bs(t),i=n.prerelease.length||r.prerelease.length,a=i?"pre":"",o=i?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return a+e;return o}};var Hs=(e,t)=>new Ns(e,t).major;var Gs=(e,t)=>new Ns(e,t).minor;var Xs=(e,t)=>new Ns(e,t).patch;var Ys=(e,t)=>{const n=Bs(e,t);return n&&n.prerelease.length?n.prerelease:null};var Js=(e,t,n)=>Us(t,e,n);var Ks=(e,t)=>Us(e,t,!0);var Qs=(e,t,n)=>{const r=new Ns(e,n),i=new Ns(t,n);return r.compare(i)||r.compareBuild(i)};var Zs=(e,t)=>e.sort(((e,n)=>Qs(e,n,t)));var el=(e,t)=>e.sort(((e,n)=>Qs(n,e,t)));var tl=(e,t,n)=>Us(e,t,n)>0;var nl=(e,t,n)=>Us(e,t,n)<0;var rl=(e,t,n)=>0!==Us(e,t,n);var il=(e,t,n)=>Us(e,t,n)>=0;var al=(e,t,n)=>Us(e,t,n)<=0;var ol=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Vs(e,n,r);case"!=":return rl(e,n,r);case">":return tl(e,n,r);case">=":return il(e,n,r);case"<":return nl(e,n,r);case"<=":return al(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const{re:sl,t:ll}=ks;var ul=(e,t)=>{if(e instanceof Ns)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=sl[ll.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),sl[ll.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;sl[ll.COERCERTL].lastIndex=-1}else n=e.match(sl[ll.COERCE]);return null===n?null:Bs(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)},cl=fl;function fl(e){var t=this;if(t instanceof fl||(t=new fl),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}function dl(e,t,n){var r=t===e.head?new ml(n,null,t,e):new ml(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function hl(e,t){e.tail=new ml(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function pl(e,t){e.head=new ml(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function ml(e,t,n,r){if(!(this instanceof ml))return new ml(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}fl.Node=ml,fl.create=fl,fl.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},fl.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},fl.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},fl.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)hl(this,arguments[e]);return this.length},fl.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)pl(this,arguments[e]);return this.length},fl.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},fl.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},fl.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},fl.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},fl.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},fl.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},fl.prototype.map=function(e,t){t=t||this;for(var n=new fl,r=this.head;null!==r;)n.push(e.call(t,r.value,this)),r=r.next;return n},fl.prototype.mapReverse=function(e,t){t=t||this;for(var n=new fl,r=this.tail;null!==r;)n.push(e.call(t,r.value,this)),r=r.prev;return n},fl.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},fl.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},fl.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},fl.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},fl.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new fl;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;for(;null!==i&&r<t;r++,i=i.next)n.push(i.value);return n},fl.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new fl;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;null!==i&&r>t;r--)i=i.prev;for(;null!==i&&r>e;r--,i=i.prev)n.push(i.value);return n},fl.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;var a=[];for(r=0;i&&r<t;r++)a.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(r=0;r<n.length;r++)i=dl(this,i,n[r]);return a},fl.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(fl)}catch(e){}const gl=Symbol("max"),yl=Symbol("length"),vl=Symbol("lengthCalculator"),bl=Symbol("allowStale"),xl=Symbol("maxAge"),wl=Symbol("dispose"),_l=Symbol("noDisposeOnSet"),kl=Symbol("lruList"),Ol=Symbol("cache"),Sl=Symbol("updateAgeOnGet"),$l=()=>1;const El=(e,t,n)=>{const r=e[Ol].get(t);if(r){const t=r.value;if(Al(e,t)){if(Cl(e,r),!e[bl])return}else n&&(e[Sl]&&(r.value.now=Date.now()),e[kl].unshiftNode(r));return t.value}},Al=(e,t)=>{if(!t||!t.maxAge&&!e[xl])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[xl]&&n>e[xl]},Dl=e=>{if(e[yl]>e[gl])for(let t=e[kl].tail;e[yl]>e[gl]&&null!==t;){const n=t.prev;Cl(e,t),t=n}},Cl=(e,t)=>{if(t){const n=t.value;e[wl]&&e[wl](n.key,n.value),e[yl]-=n.length,e[Ol].delete(n.key),e[kl].removeNode(t)}};class Ml{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const jl=(e,t,n,r)=>{let i=n.value;Al(e,i)&&(Cl(e,n),e[bl]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var Fl=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[gl]=e.max||1/0;const t=e.length||$l;if(this[vl]="function"!=typeof t?$l:t,this[bl]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[xl]=e.maxAge||0,this[wl]=e.dispose,this[_l]=e.noDisposeOnSet||!1,this[Sl]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[gl]=e||1/0,Dl(this)}get max(){return this[gl]}set allowStale(e){this[bl]=!!e}get allowStale(){return this[bl]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[xl]=e,Dl(this)}get maxAge(){return this[xl]}set lengthCalculator(e){"function"!=typeof e&&(e=$l),e!==this[vl]&&(this[vl]=e,this[yl]=0,this[kl].forEach((e=>{e.length=this[vl](e.value,e.key),this[yl]+=e.length}))),Dl(this)}get lengthCalculator(){return this[vl]}get length(){return this[yl]}get itemCount(){return this[kl].length}rforEach(e,t){t=t||this;for(let n=this[kl].tail;null!==n;){const r=n.prev;jl(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[kl].head;null!==n;){const r=n.next;jl(this,e,n,t),n=r}}keys(){return this[kl].toArray().map((e=>e.key))}values(){return this[kl].toArray().map((e=>e.value))}reset(){this[wl]&&this[kl]&&this[kl].length&&this[kl].forEach((e=>this[wl](e.key,e.value))),this[Ol]=new Map,this[kl]=new cl,this[yl]=0}dump(){return this[kl].map((e=>!Al(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[kl]}set(e,t,n){if((n=n||this[xl])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[vl](t,e);if(this[Ol].has(e)){if(i>this[gl])return Cl(this,this[Ol].get(e)),!1;const a=this[Ol].get(e).value;return this[wl]&&(this[_l]||this[wl](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[yl]+=i-a.length,a.length=i,this.get(e),Dl(this),!0}const a=new Ml(e,t,i,r,n);return a.length>this[gl]?(this[wl]&&this[wl](e,t),!1):(this[yl]+=a.length,this[kl].unshift(a),this[Ol].set(e,this[kl].head),Dl(this),!0)}has(e){if(!this[Ol].has(e))return!1;const t=this[Ol].get(e).value;return!Al(this,t)}get(e){return El(this,e,!0)}peek(e){return El(this,e,!1)}pop(){const e=this[kl].tail;return e?(Cl(this,e),e.value):null}del(e){Cl(this,this[Ol].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[Ol].forEach(((e,t)=>El(this,t,!1)))}};class Tl{constructor(e,t){if(t=Ss(t),e instanceof Tl)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Tl(e.raw,t);if(e instanceof au)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!ql(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Ul(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=Rl.get(t);if(n)return n;const r=this.options.loose,i=r?Pl[zl.HYPHENRANGELOOSE]:Pl[zl.HYPHENRANGE];e=e.replace(i,tu(this.options.includePrerelease)),_s("hyphen replace",e),e=e.replace(Pl[zl.COMPARATORTRIM],Bl),_s("comparator trim",e,Pl[zl.COMPARATORTRIM]),e=(e=(e=e.replace(Pl[zl.TILDETRIM],Il)).replace(Pl[zl.CARETTRIM],Ll)).split(/\s+/).join(" ");const a=r?Pl[zl.COMPARATORLOOSE]:Pl[zl.COMPARATOR],o=e.split(" ").map((e=>Wl(e,this.options))).join(" ").split(/\s+/).map((e=>eu(e,this.options))).filter(this.options.loose?e=>!!e.match(a):()=>!0).map((e=>new au(e,this.options))),s=(o.length,new Map);for(const e of o){if(ql(e))return[e];s.set(e.value,e)}s.size>1&&s.has("")&&s.delete("");const l=[...s.values()];return Rl.set(t,l),l}intersects(e,t){if(!(e instanceof Tl))throw new TypeError("a Range is required");return this.set.some((n=>Vl(n,t)&&e.set.some((e=>Vl(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Ns(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(nu(this.set[t],e,this.options))return!0;return!1}}var Nl=Tl;const Rl=new Fl({max:1e3}),{re:Pl,t:zl,comparatorTrimReplace:Bl,tildeTrimReplace:Il,caretTrimReplace:Ll}=ks,ql=e=>"<0.0.0-0"===e.value,Ul=e=>""===e.value,Vl=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},Wl=(e,t)=>(_s("comp",e,t),e=Yl(e,t),_s("caret",e),e=Gl(e,t),_s("tildes",e),e=Kl(e,t),_s("xrange",e),e=Zl(e,t),_s("stars",e),e),Hl=e=>!e||"x"===e.toLowerCase()||"*"===e,Gl=(e,t)=>e.trim().split(/\s+/).map((e=>Xl(e,t))).join(" "),Xl=(e,t)=>{const n=t.loose?Pl[zl.TILDELOOSE]:Pl[zl.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return _s("tilde",e,t,n,r,i,a),Hl(n)?o="":Hl(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:Hl(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(_s("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,_s("tilde return",o),o}))},Yl=(e,t)=>e.trim().split(/\s+/).map((e=>Jl(e,t))).join(" "),Jl=(e,t)=>{_s("caret",e,t);const n=t.loose?Pl[zl.CARETLOOSE]:Pl[zl.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let s;return _s("caret",e,t,n,i,a,o),Hl(n)?s="":Hl(i)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:Hl(a)?s="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(_s("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(_s("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),_s("caret return",s),s}))},Kl=(e,t)=>(_s("replaceXRanges",e,t),e.split(/\s+/).map((e=>Ql(e,t))).join(" ")),Ql=(e,t)=>{e=e.trim();const n=t.loose?Pl[zl.XRANGELOOSE]:Pl[zl.XRANGE];return e.replace(n,((n,r,i,a,o,s)=>{_s("xRange",e,n,r,i,a,o,s);const l=Hl(i),u=l||Hl(a),c=u||Hl(o),f=c;return"="===r&&f&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&f?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(s="-0"),n=`${r+i}.${a}.${o}${s}`):u?n=`>=${i}.0.0${s} <${+i+1}.0.0-0`:c&&(n=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`),_s("xRange return",n),n}))},Zl=(e,t)=>(_s("replaceStars",e,t),e.trim().replace(Pl[zl.STAR],"")),eu=(e,t)=>(_s("replaceGTE0",e,t),e.trim().replace(Pl[t.includePrerelease?zl.GTE0PRE:zl.GTE0],"")),tu=e=>(t,n,r,i,a,o,s,l,u,c,f,d,h)=>`${n=Hl(r)?"":Hl(i)?`>=${r}.0.0${e?"-0":""}`:Hl(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=Hl(u)?"":Hl(c)?`<${+u+1}.0.0-0`:Hl(f)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${f}-${d}`:e?`<${u}.${c}.${+f+1}-0`:`<=${l}`}`.trim(),nu=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(_s(e[n].semver),e[n].semver!==au.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},ru=Symbol("SemVer ANY");class iu{static get ANY(){return ru}constructor(e,t){if(t=Ss(t),e instanceof iu){if(e.loose===!!t.loose)return e;e=e.value}_s("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ru?this.value="":this.value=this.operator+this.semver.version,_s("comp",this)}parse(e){const t=this.options.loose?ou[su.COMPARATORLOOSE]:ou[su.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new Ns(n[2],this.options.loose):this.semver=ru}toString(){return this.value}test(e){if(_s("Comparator.test",e,this.options.loose),this.semver===ru||e===ru)return!0;if("string"==typeof e)try{e=new Ns(e,this.options)}catch(e){return!1}return ol(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof iu))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new Nl(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new Nl(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=ol(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),s=ol(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||i&&a||o||s}}var au=iu;const{re:ou,t:su}=ks;var lu=(e,t,n)=>{try{t=new Nl(t,n)}catch(e){return!1}return t.test(e)};var uu=(e,t)=>new Nl(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));var cu=(e,t,n)=>{let r=null,i=null,a=null;try{a=new Nl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new Ns(r,n)))})),r};var fu=(e,t,n)=>{let r=null,i=null,a=null;try{a=new Nl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new Ns(r,n)))})),r};var du=(e,t)=>{e=new Nl(e,t);let n=new Ns("0.0.0");if(e.test(n))return n;if(n=new Ns("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let i=null;r.forEach((e=>{const t=new Ns(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!tl(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||n&&!tl(n,i)||(n=i)}return n&&e.test(n)?n:null};var hu=(e,t)=>{try{return new Nl(e,t).range||"*"}catch(e){return null}};const{ANY:pu}=au;var mu=(e,t,n,r)=>{let i,a,o,s,l;switch(e=new Ns(e,r),t=new Nl(t,r),n){case">":i=tl,a=al,o=nl,s=">",l=">=";break;case"<":i=nl,a=il,o=tl,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(lu(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let c=null,f=null;if(u.forEach((e=>{e.semver===pu&&(e=new au(">=0.0.0")),c=c||e,f=f||e,i(e.semver,c.semver,r)?c=e:o(e.semver,f.semver,r)&&(f=e)})),c.operator===s||c.operator===l)return!1;if((!f.operator||f.operator===s)&&a(e,f.semver))return!1;if(f.operator===l&&o(e,f.semver))return!1}return!0};var gu=(e,t,n)=>mu(e,t,">",n);var yu=(e,t,n)=>mu(e,t,"<",n);var vu=(e,t,n)=>(e=new Nl(e,n),t=new Nl(t,n),e.intersects(t));const{ANY:bu}=au,xu=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===bu)return 1===t.length&&t[0].semver===bu;const r=new Set;let i,a,o,s,l,u,c;for(const t of e)">"===t.operator||">="===t.operator?i=wu(i,t,n):"<"===t.operator||"<="===t.operator?a=_u(a,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&a){if(o=Us(i.semver,a.semver,n),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==a.operator))return null}for(const e of r){if(i&&!lu(e,String(i),n))return null;if(a&&!lu(e,String(a),n))return null;for(const r of t)if(!lu(e,String(r),n))return!1;return!0}for(const e of t){if(c=c||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,i)if(">"===e.operator||">="===e.operator){if(s=wu(i,e,n),s===e&&s!==i)return!1}else if(">="===i.operator&&!lu(i.semver,String(e),n))return!1;if(a)if("<"===e.operator||"<="===e.operator){if(l=_u(a,e,n),l===e&&l!==a)return!1}else if("<="===a.operator&&!lu(a.semver,String(e),n))return!1;if(!e.operator&&(a||i)&&0!==o)return!1}return!(i&&u&&!a&&0!==o)&&!(a&&c&&!i&&0!==o)},wu=(e,t,n)=>{if(!e)return t;const r=Us(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},_u=(e,t,n)=>{if(!e)return t;const r=Us(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var ku=(e,t,n)=>{if(e===t)return!0;e=new Nl(e,n),t=new Nl(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=xu(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},Ou={re:ks.re,src:ks.src,tokens:ks.t,SEMVER_SPEC_VERSION:ws.SEMVER_SPEC_VERSION,SemVer:Ns,compareIdentifiers:As.compareIdentifiers,rcompareIdentifiers:As.rcompareIdentifiers,parse:Bs,valid:Is,clean:Ls,inc:qs,diff:Ws,major:Hs,minor:Gs,patch:Xs,prerelease:Ys,compare:Us,rcompare:Js,compareLoose:Ks,compareBuild:Qs,sort:Zs,rsort:el,gt:tl,lt:nl,eq:Vs,neq:rl,gte:il,lte:al,cmp:ol,coerce:ul,Comparator:au,Range:Nl,satisfies:lu,toComparators:uu,maxSatisfying:cu,minSatisfying:fu,minVersion:du,validRange:hu,outside:mu,gtr:gu,ltr:yu,intersects:vu,simplifyRange:(e,t,n)=>{const r=[];let i=null,a=null;const o=e.sort(((e,t)=>Us(e,t,n)));for(const e of o){lu(e,t,n)?(a=e,i||(i=e)):(a&&r.push([i,a]),a=null,i=null)}i&&r.push([i,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return l.length<u.length?l:t},subset:ku};function Su(e,t,n){return e.fields=t||[],e.fname=n,e}function $u(e){return null==e?null:e.fname}function Eu(e){return null==e?null:e.fields}function Au(e){return 1===e.length?Du(e[0]):Cu(e)}const Du=e=>function(t){return t[e]},Cu=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Mu(e){throw Error(e)}function ju(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||Mu("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&Mu("Access path missing closing bracket: "+e),o&&Mu("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function Fu(e,t,n){const r=ju(e);return e=1===r.length?r[0]:e,Su((n&&n.get||Au)(r),[e],t||e)}const Tu=Fu("id"),Nu=Su((e=>e),[],"identity"),Ru=Su((()=>0),[],"zero"),Pu=Su((()=>1),[],"one"),zu=Su((()=>!0),[],"true"),Bu=Su((()=>!1),[],"false");function Iu(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}function Lu(e,t){let n=e||0;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=1&&Iu(t||"error","ERROR",arguments),this},warn(){return n>=2&&Iu(t||"warn","WARN",arguments),this},info(){return n>=3&&Iu(t||"log","INFO",arguments),this},debug(){return n>=4&&Iu(t||"log","DEBUG",arguments),this}}}var qu=Array.isArray;function Uu(e){return e===Object(e)}const Vu=e=>"__proto__"!==e;function Wu(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=Gu(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;Hu(e,n,t[n],r)}return e}),{})}function Hu(e,t,n,r){if(!Vu(t))return;let i,a;if(Uu(n)&&!qu(n))for(i in a=Uu(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?Hu(a,i,n[i]):Vu(i)&&(a[i]=n[i]);else e[t]=n}function Gu(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function Xu(e){return e[e.length-1]}function Yu(e){return null==e||""===e?null:+e}const Ju=e=>t=>e*Math.exp(t),Ku=e=>t=>Math.log(e*t),Qu=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Zu=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,ec=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function tc(e,t,n,r){const i=n(e[0]),a=n(Xu(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function nc(e,t){return tc(e,t,Yu,Nu)}function rc(e,t){var n=Math.sign(e[0]);return tc(e,t,Ku(n),Ju(n))}function ic(e,t,n){return tc(e,t,ec(n),ec(1/n))}function ac(e,t,n){return tc(e,t,Qu(n),Zu(n))}function oc(e,t,n,r,i){const a=r(e[0]),o=r(Xu(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function sc(e,t,n){return oc(e,t,n,Yu,Nu)}function lc(e,t,n){const r=Math.sign(e[0]);return oc(e,t,n,Ku(r),Ju(r))}function uc(e,t,n,r){return oc(e,t,n,ec(r),ec(1/r))}function cc(e,t,n,r){return oc(e,t,n,Qu(r),Zu(r))}function fc(e){return 1+~~(new Date(e).getMonth()/3)}function dc(e){return 1+~~(new Date(e).getUTCMonth()/3)}function hc(e){return null!=e?qu(e)?e:[e]:[]}function pc(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function mc(e){return"function"==typeof e}function gc(e,t,n){n=n||{},t=hc(t)||[];const r=[],i=[],a={},o=n.comparator||vc;return hc(e).forEach(((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=mc(e)?e:Fu(e,null,n)),(Eu(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:Su(o(i,r),Object.keys(a))}const yc=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),vc=(e,t)=>1===e.length?bc(e[0],t[0]):xc(e,t,e.length),bc=(e,t)=>function(n,r){return yc(e(n),e(r))*t},xc=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=yc(a(r),a(i));return o*t[s]});function wc(e){return mc(e)?e:()=>e}function _c(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function kc(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function Oc(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function Sc(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const $c=Object.prototype.hasOwnProperty;function Ec(e,t){return $c.call(e,t)}const Ac={};function Dc(e){let t,n={};function r(e){return Ec(n,e)&&n[e]!==Ac}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===Ac&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=Ac),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===Ac||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function Cc(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=Xu(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function Mc(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,kc(r,n)}function jc(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function Fc(e){return"boolean"==typeof e}function Tc(e){return"[object Date]"===Object.prototype.toString.call(e)}function Nc(e){return e&&mc(e[Symbol.iterator])}function Rc(e){return"number"==typeof e}function Pc(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function zc(e){return"string"==typeof e}function Bc(e,t,n){e&&(e=t?hc(e).map((e=>e.replace(/\\(.)/g,"$1"))):hc(e));const r=e&&e.length,i=n&&n.get||Au,a=e=>i(t?[e]:ju(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return Su(o,e,"key")}function Ic(e,t){const n=e[0],r=Xu(e),i=+t;return i?1===i?r:n+i*(r-n):n}function Lc(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>Ec(t,e)||Ec(n,e),get:e=>Ec(t,e)?t[e]:Ec(n,e)?a(e,n[e]):void 0,set:(e,n)=>Ec(t,e)?t[e]=n:a(e,n)}}function qc(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Uc(e,t){let n="";for(;--t>=0;)n+=e;return n}function Vc(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?Uc(i,o)+a:"center"===r?Uc(i,~~(o/2))+a+Uc(i,Math.ceil(o/2)):a+Uc(i,o)}function Wc(e){return e&&Xu(e)-e[0]||0}function Hc(e){return qu(e)?"["+e.map(Hc)+"]":Uu(e)||zc(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Gc(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}const Xc=e=>Rc(e)||Tc(e)?e:Date.parse(e);function Yc(e,t){return t=t||Xc,null==e||""===e?null:t(e)}function Jc(e){return null==e||""===e?null:e+""}function Kc(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Qc(e,t,n,r){const i=null!=r?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function Zc(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const ef=/^([A-Za-z]+:)?\/\//,tf=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,nf=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,rf="file://";async function af(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function of(e,t){t=kc({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=tf.test(e.replace(nf,""));null!=e&&"string"==typeof e&&s||Mu("Sanitize failure, invalid URI: "+Hc(e));const l=ef.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(rf))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(rf.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function sf(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):lf}async function lf(){Mu("No file system access.")}function uf(e){return e?async function(t,n){const r=kc({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?mc(a[i])?a[i]():a.text():Mu(a.status+""+a.statusText)}:cf}async function cf(){Mu("No HTTP fetch method available.")}const ff=e=>null!=e&&e==e,df=e=>!(Number.isNaN(+e)||e instanceof Date),hf={boolean:Gc,integer:Yu,number:Yu,date:Yc,string:Jc,unknown:Nu},pf=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>df(e)&&Number.isInteger(+e),df,e=>!Number.isNaN(Date.parse(e))],mf=["boolean","integer","number","date"];function gf(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=pf.length,i=pf.map(((e,t)=>t+1));for(let a,o,s=0,l=0;s<n;++s)for(o=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&ff(o)&&!pf[a](o)&&(i[a]=0,++l,l===pf.length))return"string";return mf[i.reduce(((e,t)=>0===e?t:e),0)-1]}function yf(e,t){return t.reduce(((t,n)=>(t[n]=gf(e,n),t)),{})}var vf={},bf={};function xf(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function wf(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function _f(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function kf(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+_f(-e,6):e>9999?"+"+_f(e,6):_f(e,4)}(e.getUTCFullYear())+"-"+_f(e.getUTCMonth()+1,2)+"-"+_f(e.getUTCDate(),2)+(i?"T"+_f(t,2)+":"+_f(n,2)+":"+_f(r,2)+"."+_f(i,3)+"Z":r?"T"+_f(t,2)+":"+_f(n,2)+":"+_f(r,2)+"Z":n||t?"T"+_f(t,2)+":"+_f(n,2)+"Z":"")}function Of(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return bf;if(u)return u=!1,vf;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==bf;){for(var f=[];r!==vf&&r!==bf;)f.push(r),r=c();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?kf(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=xf(e);return function(r,i){return t(n(r),i,e)}}(e,t):xf(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=wf(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=wf(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}function Sf(e){const t=function(t,n){const r={delimiter:e};return $f(t,n?kc(n,r):r)};return t.responseType="text",t}function $f(e,t){return t.header&&(e=t.header.map(Hc).join(t.delimiter)+"\n"+e),Of(t.delimiter).parse(e+"")}function Ef(e,t){const n=t&&t.property?Fu(t.property):Nu;return Uu(e)&&!function(e){return!("function"!=typeof Buffer||!mc(Buffer.isBuffer))&&Buffer.isBuffer(e)}(e)?function(e,t){!qu(e)&&Nc(e)&&(e=[...e]);return t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t):n(JSON.parse(e))}function Af(e){return e}function Df(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return Cf(e,t)}))}:Cf(e,t)}function Cf(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=Mf(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Mf(e,t){var n=function(e){if(null==e)return Af;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function jf(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1];return t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function Ff(e){return Mf(e,Tf.apply(this,arguments))}function Tf(e,t,n){var r,i,a;if(arguments.length>1)r=Nf(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:jf(e,r)}}function Nf(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}$f.responseType="text",Ef.responseType="json";const Rf={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Pf(e,t){let n,r,i,a;return e=Ef(e,t),t&&t.feature?(n=Df,i=t.feature):t&&t.mesh?(n=Ff,i=t.mesh,a=Rf[t.filter]):Mu("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):Mu("Invalid TopoJSON object: "+i),r&&r.features||[r]}Pf.responseType="json";const zf={dsv:$f,csv:Sf(","),tsv:Sf("\t"),json:Ef,topojson:Pf};function Bf(e,t){return arguments.length>1?(zf[e]=t,this):Ec(zf,e)?zf[e]:null}function If(e){const t=Bf(e);return t&&t.responseType||"text"}function Lf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qf(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>Lf(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}function Uf(e){return null===e?NaN:+e}const Vf=qf(Lf),Wf=Vf.right,Hf=Vf.left;qf(Uf).center;class Gf{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var Xf=Math.sqrt(50),Yf=Math.sqrt(10),Jf=Math.sqrt(2);function Kf(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Qf(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a}function Qf(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Xf?10:a>=Yf?5:a>=Jf?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Xf?10:a>=Yf?5:a>=Jf?2:1)}function Zf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Xf?i*=10:a>=Yf?i*=5:a>=Jf&&(i*=2),t<e?-i:i}function ed(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function td(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function nd(e,t,n=0,r=e.length-1,i=Lf){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);nd(e,t,Math.max(n,Math.floor(t-o*l/a+u)),Math.min(r,Math.floor(t+(a-o)*l/a+u)),i)}const a=e[t];let o=n,s=r;for(rd(e,n,t),i(e[r],a)>0&&rd(e,n,r);o<s;){for(rd(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?rd(e,n,s):(++s,rd(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function rd(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function id(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return td(e);if(t>=1)return ed(e);var r,i=(r-1)*t,a=Math.floor(i),o=ed(nd(e,a).subarray(0,a+1));return o+(td(e.subarray(a+1))-o)*(i-a)}}function ad(e,t,n=Uf){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function od(e,t){return id(e,.5,t)}function sd(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function ld(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function ud(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function cd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function fd(e){return(e=cd(Math.abs(e)))?e[1]:NaN}var dd,hd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function pd(e){if(!(t=hd.exec(e)))throw new Error("invalid format: "+e);var t;return new md({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function md(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function gd(e,t){var n=cd(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}pd.prototype=md.prototype,md.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var yd={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>gd(100*e,t),r:gd,s:function(e,t){var n=cd(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(dd=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+cd(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function vd(e){return e}var bd,xd,wd,_d=Array.prototype.map,kd=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Od(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?vd:(t=_d.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?vd:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(_d.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=pd(e)).fill,n=e.align,f=e.sign,d=e.symbol,h=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):yd[v]||(void 0===g&&(g=12),y=!0,v="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?a:/[%p]/.test(v)?l:"",w=yd[v],_=/[defgprs%]/.test(v);function k(e){var i,a,l,d=b,k=x;if("c"===v)k=w(e)+k,e="";else{var O=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),O&&0==+e&&"+"!==f&&(O=!1),d=(O?"("===f?f:u:"-"===f||"("===f?"":f)+d,k=("s"===v?kd[8+dd/3]:"")+k+(O&&"("===f?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}m&&!h&&(e=r(e,1/0));var S=d.length+e.length+k.length,$=S<p?new Array(p-S+1).join(t):"";switch(m&&h&&(e=r($+e,$.length?p-k.length:1/0),$=""),n){case"<":e=d+e+k+$;break;case"=":e=d+$+e+k;break;case"^":e=$.slice(0,S=$.length>>1)+d+e+k+$.slice(S);break;default:e=$+d+e+k}return s(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:f,formatPrefix:function(e,t){var n=f(((e=pd(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(fd(t)/3))),i=Math.pow(10,-r),a=kd[8+r/3];return function(e){return n(i*e)+a}}}}function Sd(e){return Math.max(0,-fd(Math.abs(e)))}function $d(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(fd(t)/3)))-fd(Math.abs(e)))}function Ed(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,fd(t)-fd(e))+1}!function(e){bd=Od(e),xd=bd.format,wd=bd.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var Ad=new Date,Dd=new Date;function Cd(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return Cd((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return Ad.setTime(+t),Dd.setTime(+r),e(Ad),e(Dd),Math.floor(n(Ad,Dd))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Md=Cd((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));Md.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Cd((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Md:null};var jd=1e3,Fd=6e4,Td=36e5,Nd=864e5,Rd=6048e5,Pd=Cd((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*jd)}),(function(e,t){return(t-e)/jd}),(function(e){return e.getUTCSeconds()})),zd=Cd((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*jd)}),(function(e,t){e.setTime(+e+t*Fd)}),(function(e,t){return(t-e)/Fd}),(function(e){return e.getMinutes()})),Bd=Cd((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*jd-e.getMinutes()*Fd)}),(function(e,t){e.setTime(+e+t*Td)}),(function(e,t){return(t-e)/Td}),(function(e){return e.getHours()})),Id=Cd((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Fd)/Nd),(e=>e.getDate()-1));function Ld(e){return Cd((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Fd)/Rd}))}var qd=Ld(0),Ud=Ld(1),Vd=(Ld(2),Ld(3),Ld(4)),Wd=(Ld(5),Ld(6),Cd((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),Hd=Cd((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));Hd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Cd((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var Gd=Cd((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Fd)}),(function(e,t){return(t-e)/Fd}),(function(e){return e.getUTCMinutes()})),Xd=Cd((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Td)}),(function(e,t){return(t-e)/Td}),(function(e){return e.getUTCHours()})),Yd=Cd((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Nd}),(function(e){return e.getUTCDate()-1}));function Jd(e){return Cd((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Rd}))}var Kd=Jd(0),Qd=Jd(1),Zd=(Jd(2),Jd(3),Jd(4)),eh=(Jd(5),Jd(6),Cd((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}))),th=Cd((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));th.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Cd((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const nh="year",rh="quarter",ih="month",ah="week",oh="date",sh="day",lh="dayofyear",uh="hours",ch="minutes",fh="seconds",dh="milliseconds",hh=[nh,rh,ih,ah,oh,sh,lh,uh,ch,fh,dh],ph=hh.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function mh(e){const t=hc(e).slice(),n={};t.length||Mu("Missing time unit."),t.forEach((e=>{Ec(ph,e)?n[e]=1:Mu("Invalid time unit: ".concat(e,"."))}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&Mu("Incompatible time units: ".concat(e)),t.sort(((e,t)=>ph[e]-ph[t])),t}const gh={[nh]:"%Y ",[rh]:"Q%q ",[ih]:"%b ",[oh]:"%d ",[ah]:"W%U ",[sh]:"%a ",[lh]:"%j ",[uh]:"%H:00",[ch]:"00:%M",[fh]:":%S",[dh]:".%L",["".concat(nh,"-").concat(ih)]:"%Y-%m ",["".concat(nh,"-").concat(ih,"-").concat(oh)]:"%Y-%m-%d ",["".concat(uh,"-").concat(ch)]:"%H:%M"};function yh(e,t){const n=kc({},gh,t),r=mh(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const vh=new Date;function bh(e){return vh.setFullYear(e),vh.setMonth(0),vh.setDate(1),vh.setHours(0,0,0,0),vh}function xh(e){return _h(new Date(e))}function wh(e){return kh(new Date(e))}function _h(e){return Id.count(bh(e.getFullYear())-1,e)}function kh(e){return qd.count(bh(e.getFullYear())-1,e)}function Oh(e){return bh(e).getDay()}function Sh(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function $h(e){return Ah(new Date(e))}function Eh(e){return Dh(new Date(e))}function Ah(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Yd.count(t-1,e)}function Dh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Kd.count(t-1,e)}function Ch(e){return vh.setTime(Date.UTC(e,0,1)),vh.getUTCDay()}function Mh(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function jh(e,t,n,r,i){const a=t||1,o=Xu(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=Kc(e),c=u.year?s(nh):wc(2012),f=u.month?s(ih):u.quarter?s(rh):Ru,d=u.week&&u.day?s(sh,1,ah+sh):u.week?s(ah,1):u.day?s(sh,1):u.date?s(oh,1):u.dayofyear?s(lh,1):Pu,h=u.hours?s(uh):Ru,p=u.minutes?s(ch):Ru,m=u.seconds?s(fh):Ru,g=u.milliseconds?s(dh):Ru;return function(e){l.setTime(+e);const t=c(l);return i(t,f(l),d(l,t),h(l),p(l),m(l),g(l))}}function Fh(e,t,n){return t+7*e-(n+6)%7}const Th={[nh]:e=>e.getFullYear(),[rh]:e=>Math.floor(e.getMonth()/3),[ih]:e=>e.getMonth(),[oh]:e=>e.getDate(),[uh]:e=>e.getHours(),[ch]:e=>e.getMinutes(),[fh]:e=>e.getSeconds(),[dh]:e=>e.getMilliseconds(),[lh]:e=>_h(e),[ah]:e=>kh(e),[ah+sh]:(e,t)=>Fh(kh(e),e.getDay(),Oh(t)),[sh]:(e,t)=>Fh(1,e.getDay(),Oh(t))},Nh={[rh]:e=>3*e,[ah]:(e,t)=>Fh(e,0,Oh(t))};function Rh(e,t){return jh(e,t||1,Th,Nh,Sh)}const Ph={[nh]:e=>e.getUTCFullYear(),[rh]:e=>Math.floor(e.getUTCMonth()/3),[ih]:e=>e.getUTCMonth(),[oh]:e=>e.getUTCDate(),[uh]:e=>e.getUTCHours(),[ch]:e=>e.getUTCMinutes(),[fh]:e=>e.getUTCSeconds(),[dh]:e=>e.getUTCMilliseconds(),[lh]:e=>Ah(e),[ah]:e=>Dh(e),[sh]:(e,t)=>Fh(1,e.getUTCDay(),Ch(t)),[ah+sh]:(e,t)=>Fh(Dh(e),e.getUTCDay(),Ch(t))},zh={[rh]:e=>3*e,[ah]:(e,t)=>Fh(e,0,Ch(t))};function Bh(e,t){return jh(e,t||1,Ph,zh,Mh)}const Ih={[nh]:Hd,[rh]:Wd.every(3),[ih]:Wd,[ah]:qd,[oh]:Id,[sh]:Id,[lh]:Id,[uh]:Bd,[ch]:zd,[fh]:Pd,[dh]:Md},Lh={[nh]:th,[rh]:eh.every(3),[ih]:eh,[ah]:Kd,[oh]:Yd,[sh]:Yd,[lh]:Yd,[uh]:Xd,[ch]:Gd,[fh]:Pd,[dh]:Md};function qh(e){return Ih[e]}function Uh(e){return Lh[e]}function Vh(e,t,n){return e?e.offset(t,n):void 0}function Wh(e,t,n){return Vh(qh(e),t,n)}function Hh(e,t,n){return Vh(Uh(e),t,n)}function Gh(e,t,n,r){return e?e.range(t,n,r):void 0}function Xh(e,t,n,r){return Gh(qh(e),t,n,r)}function Yh(e,t,n,r){return Gh(Uh(e),t,n,r)}const Jh=1e3,Kh=6e4,Qh=36e5,Zh=864e5,ep=2592e6,tp=31536e6,np=[nh,ih,oh,uh,ch,fh,dh],rp=np.slice(0,-1),ip=rp.slice(0,-1),ap=ip.slice(0,-1),op=ap.slice(0,-1),sp=[nh,ih],lp=[nh],up=[[rp,1,Jh],[rp,5,5e3],[rp,15,15e3],[rp,30,3e4],[ip,1,Kh],[ip,5,3e5],[ip,15,9e5],[ip,30,18e5],[ap,1,Qh],[ap,3,108e5],[ap,6,216e5],[ap,12,432e5],[op,1,Zh],[[nh,ah],1,6048e5],[sp,1,ep],[sp,3,7776e6],[lp,1,tp]];function cp(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Wc(t))/n;let i,a,o=qf((e=>e[2])).right(up,r);return o===up.length?(i=lp,a=Zf(t[0]/tp,t[1]/tp,n)):o?(o=up[r/up[o-1][2]<up[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=np,a=Math.max(Zf(t[0],t[1],n),1)),{units:i,step:a}}function fp(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function dp(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function hp(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function pp(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=$p(i),c=Ep(i),f=$p(a),d=Ep(a),h=$p(o),p=Ep(o),m=$p(s),g=Ep(s),y=$p(l),v=Ep(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Xp,e:Xp,f:Zp,g:cm,G:dm,H:Yp,I:Jp,j:Kp,L:Qp,m:em,M:tm,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Nm,s:Rm,S:nm,u:rm,U:im,V:om,w:sm,W:lm,x:null,X:null,y:um,Y:fm,Z:hm,"%":Tm},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:pm,e:pm,f:bm,g:Cm,G:jm,H:mm,I:gm,j:ym,L:vm,m:xm,M:wm,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Nm,s:Rm,S:_m,u:km,U:Om,V:$m,w:Em,W:Am,x:null,X:null,y:Dm,Y:Mm,Z:Fm,"%":Tm},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=y.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return O(e,t,n,r)},d:zp,e:zp,f:Vp,g:Tp,G:Fp,H:Ip,I:Ip,j:Bp,L:Up,m:Pp,M:Lp,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:Rp,Q:Hp,s:Gp,S:qp,u:Dp,U:Cp,V:Mp,w:Ap,W:jp,x:function(e,t,r){return O(e,n,t,r)},X:function(e,t,n){return O(e,r,t,n)},y:Tp,Y:Fp,Z:Np,"%":Wp};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=xp[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=hp(1900,void 0,1);if(O(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=dp(hp(a.y,0,1))).getUTCDay(),r=i>4||0===i?Qd.ceil(r):Qd(r),r=Yd.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=fp(hp(a.y,0,1))).getDay(),r=i>4||0===i?Ud.ceil(r):Ud(r),r=Id.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?dp(hp(a.y,0,1)).getUTCDay():fp(hp(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,dp(a)):fp(a)}}function O(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in xp?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var mp,gp,yp,vp,bp,xp={"-":"",_:" ",0:"0"},wp=/^\s*\d+/,_p=/^%/,kp=/[\\^$*+?|[\]().{}]/g;function Op(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function Sp(e){return e.replace(kp,"\\$&")}function $p(e){return new RegExp("^(?:"+e.map(Sp).join("|")+")","i")}function Ep(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function Ap(e,t,n){var r=wp.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Dp(e,t,n){var r=wp.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Cp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Mp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function jp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Fp(e,t,n){var r=wp.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Tp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Np(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Rp(e,t,n){var r=wp.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Pp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function zp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Bp(e,t,n){var r=wp.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Ip(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Lp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function qp(e,t,n){var r=wp.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Up(e,t,n){var r=wp.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Vp(e,t,n){var r=wp.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Wp(e,t,n){var r=_p.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Hp(e,t,n){var r=wp.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Gp(e,t,n){var r=wp.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Xp(e,t){return Op(e.getDate(),t,2)}function Yp(e,t){return Op(e.getHours(),t,2)}function Jp(e,t){return Op(e.getHours()%12||12,t,2)}function Kp(e,t){return Op(1+Id.count(Hd(e),e),t,3)}function Qp(e,t){return Op(e.getMilliseconds(),t,3)}function Zp(e,t){return Qp(e,t)+"000"}function em(e,t){return Op(e.getMonth()+1,t,2)}function tm(e,t){return Op(e.getMinutes(),t,2)}function nm(e,t){return Op(e.getSeconds(),t,2)}function rm(e){var t=e.getDay();return 0===t?7:t}function im(e,t){return Op(qd.count(Hd(e)-1,e),t,2)}function am(e){var t=e.getDay();return t>=4||0===t?Vd(e):Vd.ceil(e)}function om(e,t){return e=am(e),Op(Vd.count(Hd(e),e)+(4===Hd(e).getDay()),t,2)}function sm(e){return e.getDay()}function lm(e,t){return Op(Ud.count(Hd(e)-1,e),t,2)}function um(e,t){return Op(e.getFullYear()%100,t,2)}function cm(e,t){return Op((e=am(e)).getFullYear()%100,t,2)}function fm(e,t){return Op(e.getFullYear()%1e4,t,4)}function dm(e,t){var n=e.getDay();return Op((e=n>=4||0===n?Vd(e):Vd.ceil(e)).getFullYear()%1e4,t,4)}function hm(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Op(t/60|0,"0",2)+Op(t%60,"0",2)}function pm(e,t){return Op(e.getUTCDate(),t,2)}function mm(e,t){return Op(e.getUTCHours(),t,2)}function gm(e,t){return Op(e.getUTCHours()%12||12,t,2)}function ym(e,t){return Op(1+Yd.count(th(e),e),t,3)}function vm(e,t){return Op(e.getUTCMilliseconds(),t,3)}function bm(e,t){return vm(e,t)+"000"}function xm(e,t){return Op(e.getUTCMonth()+1,t,2)}function wm(e,t){return Op(e.getUTCMinutes(),t,2)}function _m(e,t){return Op(e.getUTCSeconds(),t,2)}function km(e){var t=e.getUTCDay();return 0===t?7:t}function Om(e,t){return Op(Kd.count(th(e)-1,e),t,2)}function Sm(e){var t=e.getUTCDay();return t>=4||0===t?Zd(e):Zd.ceil(e)}function $m(e,t){return e=Sm(e),Op(Zd.count(th(e),e)+(4===th(e).getUTCDay()),t,2)}function Em(e){return e.getUTCDay()}function Am(e,t){return Op(Qd.count(th(e)-1,e),t,2)}function Dm(e,t){return Op(e.getUTCFullYear()%100,t,2)}function Cm(e,t){return Op((e=Sm(e)).getUTCFullYear()%100,t,2)}function Mm(e,t){return Op(e.getUTCFullYear()%1e4,t,4)}function jm(e,t){var n=e.getUTCDay();return Op((e=n>=4||0===n?Zd(e):Zd.ceil(e)).getUTCFullYear()%1e4,t,4)}function Fm(){return"+0000"}function Tm(){return"%"}function Nm(e){return+e}function Rm(e){return Math.floor(+e/1e3)}function Pm(e){const t={};return n=>t[n]||(t[n]=e(n))}function zm(e){const t=Pm(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=pd(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=pd(null==a?",f":a);const o=Zf(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=$d(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=Ed(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=Sd(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let Bm,Im;function Lm(){return Bm=zm({format:xd,formatPrefix:wd})}function qm(e){return zm(Od(e))}function Um(e){return arguments.length?Bm=qm(e):Bm}function Vm(e,t,n){Uu(n=n||{})||Mu("Invalid time multi-format specifier: ".concat(n));const r=t(fh),i=t(ch),a=t(uh),o=t(oh),s=t(ah),l=t(ih),u=t(rh),c=t(nh),f=e(n.milliseconds||".%L"),d=e(n.seconds||":%S"),h=e(n.minutes||"%I:%M"),p=e(n.hours||"%I %p"),m=e(n.date||n.day||"%a %d"),g=e(n.week||"%b %d"),y=e(n.month||"%B"),v=e(n.quarter||"%B"),b=e(n.year||"%Y");return e=>(r(e)<e?f:i(e)<e?d:a(e)<e?h:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?y:v:b)(e)}function Wm(e){const t=Pm(e.format),n=Pm(e.utcFormat);return{timeFormat:e=>zc(e)?t(e):Vm(t,qh,e),utcFormat:e=>zc(e)?n(e):Vm(n,Uh,e),timeParse:Pm(e.parse),utcParse:Pm(e.utcParse)}}function Hm(){return Im=Wm({format:gp,parse:yp,utcFormat:vp,utcParse:bp})}function Gm(e){return Wm(pp(e))}function Xm(e){return arguments.length?Im=Gm(e):Im}!function(e){mp=pp(e),gp=mp.format,yp=mp.parse,vp=mp.utcFormat,bp=mp.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Lm(),Hm();const Ym=(e,t)=>kc({},e,t);function Jm(e,t){const n=e?qm(e):Um(),r=t?Gm(t):Xm();return Ym(n,r)}function Km(e,t){const n=arguments.length;return n&&2!==n&&Mu("defaultLocale expects either zero or two arguments."),n?Ym(Um(e),Xm(t)):Ym(Um(),Xm())}function Qm(e,t,n,r){const i=Bf((t=t||{}).type||"json");return i||Mu("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=Xm();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,f=e.columns||Object.keys(e[0]);"auto"===t&&(t=yf(e,f));f=Object.keys(t);const d=f.map((e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1));return("utc"===a[0]?r:n)(o)}if(!hf[i])throw Error("Illegal format pattern: "+e+":"+i);return hf[i]}));for(s=0,u=e.length,c=f.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=f[l],a[o]=d[l](a[o])}(e,t.parse,n,r),Ec(e,"columns")&&delete e.columns,e}const Zm=function(e,t){return n=>({options:n||{},sanitize:of,load:af,fileAccess:!!t,file:sf(t),http:uf(e)})}("undefined"!=typeof fetch&&fetch,null);function eg(e){const t=e||Nu,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function tg(e,t){try{await t(e)}catch(t){e.error(t)}}const ng=Symbol("vega_id");let rg=1;function ig(e){return!(!e||!ag(e))}function ag(e){return e[ng]}function og(e,t){return e[ng]=t,e}function sg(e){const t=e===Object(e)?e:{data:e};return ag(t)?t:og(t,rg++)}function lg(e){return ug(e,sg({}))}function ug(e,t){for(const n in e)t[n]=e[n];return t}function cg(e,t){return og(t,ag(e))}function fg(e,t){return e?t?(n,r)=>e(n,r)||ag(t(n))-ag(t(r)):(t,n)=>e(t,n)||ag(t)-ag(n):null}function dg(e){return e&&e.constructor===hg}function hg(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:hg,insert(t){const n=hc(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=mc(e)?r:t,i=hc(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:wc(r)};return mc(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return mc(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let f,d,h,p,m,g;for(f=0,d=l.length;f<d;++f)u[ag(l[f])]=1;for(f=0,d=t.length;f<d;++f)m=t[f],u[ag(m)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],l.forEach((e=>{p(e)&&(u[ag(e)]=-1)}));for(f=0,d=e.length;f<d;++f)m=e[f],g=ag(m),u[g]?u[g]=1:s.add.push(sg(e[f]));for(f=0,d=l.length;f<d;++f)m=l[f],u[ag(m)]<0&&s.rem.push(m);function y(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[ag(e)]=e)}for(f=0,d=n.length;f<d;++f)h=n[f],m=h.tuple,p=h.field,g=u[ag(m)],g>0&&(y(m,p,h.value),s.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,l.forEach((e=>{p(e)&&u[ag(e)]>0&&y(e,h.field,h.value)})),s.modifies(h.field);if(o)s.mod=t.length||r.length?l.filter((e=>u[ag(e)]>0)):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const pg="_:mod:_";function mg(){Object.defineProperty(this,pg,{writable:!0,value:{}})}mg.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[pg];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=qu(n)?1+n.length:-1),i},modified(e,t){const n=this[pg];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(qu(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[pg]={},this}};let gg=0;const yg=new mg;function vg(e,t,n,r){this.id=++gg,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function bg(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}vg.prototype={targets(){return this._targets||(this._targets=eg(Tu))},set(e){return this.value!==e?(this.value=e,1):0},skip:bg(1),modified:bg(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new mg,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof vg?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)hc(s).forEach((e=>{e instanceof vg?e!==this&&(e.targets().add(this),a.push(e)):Mu("Pulse parameters must be operator instances.")})),this.source=s;else if(qu(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||yg,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let xg=0;function wg(e,t,n){this.id=++xg,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function _g(e,t,n){return new wg(e,t,n)}wg.prototype={_filter:zu,_apply:Nu,targets(){return this._targets||(this._targets=eg(Tu))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=_g(e);return this.targets().add(t),t},apply(e){const t=_g(null,e);return this.targets().add(t),t},merge(){const e=_g();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=_g();return this.targets().add(_g(null,null,_c(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(_g(null,null,(()=>n=!0))),t.targets().add(_g(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){}};const kg={skip:!0};function Og(e,t,n,r,i,a){const o=kc({},a,kg);let s,l;mc(n)||(n=wc(n)),void 0===r?s=t=>e.touch(n(t)):mc(r)?(l=new vg(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;dg(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function Sg(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new vg(null,function(e,t){return t=mc(t)?t:wc(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const $g={};function Eg(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function Ag(e,t){const n=[];return Zc(e,t,(e=>n.push(e))),n}function Dg(e,t){const n={};return e.visit(t,(e=>{n[ag(e)]=1})),e=>n[ag(e)]?null:e}function Cg(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function Mg(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(o|=i.ADD),r.changed(i.REM)&&(o|=i.REM),r.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function jg(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}Eg.prototype={StopPropagation:$g,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new Eg(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new Eg(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Dg(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return qu(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?qu(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=Cg(n.addF,t)),2&e&&(n.remF=Cg(n.remF,t)),4&e&&(n.modF=Cg(n.modF,t)),16&e&&(n.srcF=Cg(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=Ag(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=Ag(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=Ag(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Zc(n.source,n.srcF,r),n;1&e&&Zc(n.add,n.addF,r),2&e&&Zc(n.rem,n.remF,r),4&e&&Zc(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||Zc(i,e?Dg(n,5):n.srcF,r)}return n}},Mc(Mg,Eg,{fork(e){const t=new Eg(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?qu(e)?e.some((e=>n[e])):n[e]:0},filter(){Mu("MultiPulse does not support filtering.")},materialize(){Mu("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const Fg={skip:!1,force:!1};function Tg(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Ng(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,Ng(e,r,t,n)}(t,0,e)):r=n,r}}}function Ng(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function Rg(){this.logger(Lu()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=Km();try{this._loader=Zm()}catch(e){}this._touched=eg(Tu),this._input={},this._pulse=null,this._heap=Tg(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function Pg(e){return function(){return this._log[e].apply(this,arguments)}}function zg(e,t){vg.call(this,e,null,t)}Rg.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Pg("error"),warn:Pg("warn"),info:Pg("info"),debug:Pg("debug"),logLevel:Pg("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof vg?i=e:e&&e.prototype instanceof vg?i=new e:mc(e)?i=new vg(null,e):(a=0,i=new vg(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&Mu("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Fg);const r=new Eg(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||Fg;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||Fg;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:hg,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Qm(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(zu).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:If(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=_g(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):hc(e);const l=s.length;for(let e=0;e<l;++e)s[e].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof vg?Sg:Og)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return jg(r);if(r._pending&&await r._pending,t&&await tg(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new Eg(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=eg(Tu);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=$g),s!==$g&&o._targets&&o._targets.forEach((e=>r._enqueue(e))),++u):r._enqueue(o,!0)}catch(e){r._heap.clear(),l=e}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await tg(r,e[t].callback)}return n&&await tg(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?jg(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&qu(n)?new Mg(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){if(t&&t.stamp===e.stamp)return t;e=e.fork(),t&&t!==$g&&(e.source=t.source);return e}(this._pulse,n&&n.pulse)}},Mc(zg,vg,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Bg={};function Ig(e){const t=Lg(e);return t&&t.Definition||null}function Lg(e){return e=e&&e.toLowerCase(),Ec(Bg,e)?Bg[e]:null}function*qg(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function Ug(e,t,n){const r=Float64Array.from(qg(e,n));return r.sort(Lf),t.map((e=>ad(r,e)))}function Vg(e,t){return Ug(e,[.25,.5,.75],t)}function Wg(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=Vg(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Hg(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,f=e.extent[0],d=e.extent[1];const h=e.span||d-f||Math.abs(f)||1;if(e.step)a=e.step;else if(e.steps){for(l=h/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(h)/r)-o));Math.ceil(h/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&h/l<=t&&(a=l)}l=Math.log(a);const p=l>=0?0:1+~~(-l/r),m=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(f/a+m)*a,f=f<l?l-a:l,d=Math.ceil(d/a)*a),{start:f,stop:d===f?f+a:d,step:a}}var Gg=Math.random;function Xg(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(qg(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(Gg()*a)];c[u]=s/a}return c.sort(Lf),[id(c,n/2),id(c,1-n/2)]}function Yg(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,f=u+t;for(;l<i;++l){if(o=r(e[l]),o>=f){for(c=(u+c)/2;s<l;++s)a[s]=c;f=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}const Jg=Math.sqrt(2*Math.PI),Kg=Math.SQRT2;let Qg=NaN;function Zg(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(Qg==Qg)i=Qg,Qg=NaN;else{do{i=2*Gg()-1,a=2*Gg()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,Qg=a*r}return e+i*t}function ey(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Jg)}function ty(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function ny(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Kg*function(e){let t,n=-Math.log((1-e)*(1+e));n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0;return t*e}(2*e-1)}function ry(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Zg(n,r),pdf:e=>ey(e,n,r),cdf:e=>ty(e,n,r),icdf:e=>ny(e,n,r)};return i.mean(e).stdev(t)}function iy(e,t){const n=ry();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=Wg(e)),i):t},sample:()=>e[~~(Gg()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function ay(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Zg()*t)}function oy(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Jg*e)}function sy(e,t,n){return ty(Math.log(e),t,n)}function ly(e,t,n){return Math.exp(ny(e,t,n))}function uy(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>ay(n,r),pdf:e=>oy(e,n,r),cdf:e=>sy(e,n,r),icdf:e=>ly(e,n,r)};return i.mean(e).stdev(t)}function cy(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=Gg();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function fy(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*Gg()}function dy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function hy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function py(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function my(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>fy(n,r),pdf:e=>dy(e,n,r),cdf:e=>hy(e,n,r),icdf:e=>py(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function gy(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function yy(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,f=0,d=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,f+=(s-f)/c,d+=(l-d)/c;for(c=0;c<i;++c)a[c]-=f,o[c]-=d;return[a,o,f,d]}function vy(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function by(e,t,n,r,i){let a=0,o=0;return vy(e,t,n,((e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function xy(e,t,n){let r=0,i=0,a=0,o=0,s=0;vy(e,t,n,((e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=gy(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:by(e,t,n,i,u)}}function wy(e,t,n){let r=0,i=0,a=0,o=0,s=0;vy(e,t,n,((e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=gy(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:by(e,t,n,i,u)}}function _y(e,t,n){const[r,i,a,o]=yy(e,t,n);let s,l,u,c=0,f=0,d=0,h=0,p=0;vy(e,t,n,((e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,f+=(u-f)/p,d+=(u*l-d)/p,h+=(s*u-h)/p}));const[m,g]=gy(f/o,c/o,d/o,h/o),y=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:y,rSquared:by(e,t,n,o,y)}}function ky(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;vy(e,t,n,((e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l}));const u=gy(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:by(e,t,n,s,c)}}function Oy(e,t,n){const[r,i,a,o]=yy(e,t,n),s=r.length;let l,u,c,f,d=0,h=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],f=u*u,d+=(f-d)/l,h+=(f*u-h)/l,p+=(f*f-p)/l,m+=(u*c-m)/l,g+=(f*c-g)/l;const y=p-d*d,v=d*y-h*h,b=(g*d-m*h)/v,x=(m*y-g*h)/v,w=-b*d,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:by(e,t,n,o,_)}}function Sy(e,t,n,r){if(1===r)return xy(e,t,n);if(2===r)return Oy(e,t,n);const[i,a,o,s]=yy(e,t,n),l=i.length,u=[],c=[],f=r+1;let d,h,p,m,g;for(d=0;d<f;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*a[p];for(u.push(m),g=new Float64Array(f),h=0;h<f;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+h);g[h]=m}c.push(g)}c.push(u);const y=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),v=e=>{e-=o;let t=s+y[0]+y[1]*e+y[2]*e*e;for(d=3;d<f;++d)t+=y[d]*Math.pow(e,d);return t};return{coef:$y(f,y,-o,s),predict:v,rSquared:by(e,t,n,s,v)}}function $y(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function Ey(e,t,n,r){const[i,a,o,s]=yy(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let e=-1;++e<=2;){const t=[0,u-1];for(let e=0;e<l;++e){const n=i[e],r=t[0],o=t[1],s=n-i[r]>i[o]-n?r:o;let l=0,u=0,h=0,p=0,m=0;const g=1/Math.abs(i[s]-n||1);for(let e=r;e<=o;++e){const t=i[e],r=a[e],o=Ay(Math.abs(n-t)*g)*d[e],s=t*o;l+=o,u+=s,h+=r*o,p+=r*s,m+=t*s}const[y,v]=gy(u/l,h/l,p/l,m/l);c[e]=y+v*n,f[e]=Math.abs(a[e]-c[e]),Dy(i,e+1,t)}if(2===e)break;const n=od(f);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<l;++r)e=f[r]/(6*n),d[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function Ay(e){return(e=1-e*e*e)*e*e}function Dy(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const Cy=.1*Math.PI/180;function My(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let e=n;--e>0;)c.push(i(a+e/n*s));let f=u[0],d=c[c.length-1];for(;d;){const e=i((f[0]+d[0])/2);e[0]-f[0]>=l&&jy(f,e,d)>Cy?c.push(e):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function jy(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function Fy(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function Ty(e,t,n){return n||e+(t?"_"+t:"")}const Ny=()=>{},Ry={init:Ny,add:Ny,rem:Ny,idx:0},Py={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},zy=Object.keys(Py);function By(e,t){return Py[e](t)}function Iy(e,t){return e.idx-t.idx}function Ly(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function qy(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function Uy(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function Vy(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Wy(e,t){const n=t||Nu,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=Py[e]())}))};return e.forEach(n),Object.values(t).sort(Iy)}(e),i=e.slice().sort(Iy);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Ly,a.prototype.add=qy,a.prototype.rem=Uy,a.prototype.set=Vy,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function Hy(e){this._key=e?Fu(e):ag,this.reset()}zy.forEach((e=>{Py[e]=function(e,t){return n=>kc({name:e,out:n||e},Ry,t)}(e,Py[e])}));const Gy=Hy.prototype;function Xy(e){zg.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}Gy.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},Gy.add=function(e){this._add.push(e)},Gy.rem=function(e){this._rem.push(e)},Gy.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},Gy.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",Ec(n,r)||(n[r]=1,++a);return a},Gy.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=Sc(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},Gy.argmin=function(e){return this.extent(e)[0]||{}},Gy.argmax=function(e){return this.extent(e)[1]||{}},Gy.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},Gy.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},Gy.quartile=function(e){return this._get===e&&this._q||(this._q=Vg(this.values(),e),this._get=e),this._q},Gy.q1=function(e){return this.quartile(e)[0]},Gy.q2=function(e){return this.quartile(e)[1]},Gy.q3=function(e){return this.quartile(e)[2]},Gy.ci=function(e){return this._get===e&&this._ci||(this._ci=Xg(this.values(),1e3,.05,e),this._get=e),this._ci},Gy.ci0=function(e){return this.ci(e)[0]},Gy.ci1=function(e){return this.ci(e)[1]},Xy.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:zy},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Mc(Xy,zg,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=hc(Eu(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=hc(e.groupby),this._dnames=this._dims.map((e=>{const t=$u(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:Fy(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,f,d,h,p,m;for(l!==o.length&&Mu("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],f=o[m],null==c&&"count"!==f&&Mu("Null aggregate field specified."),h=$u(c),p=Ty(f,h,s[m]),n.push(p),"count"!==f?(d=u[h],d||(i(c),d=u[h]=[],d.field=c,this._measures.push(d)),"count"!==f&&(this._countOnly=!1),d.push(By(f,p))):this._counts.push(p);return this._measures=this._measures.map((e=>Wy(e,e.field))),{}},cellkey:Fy(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new Hy),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?cg(t.tuple,a):sg(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,f;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Yy(e){zg.call(this,null,e)}function Jy(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter((e=>!o[r(e)])),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?qc(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function Ky(e){zg.call(this,[],e)}function Qy(e){vg.call(this,null,Zy,e)}function Zy(e){return this.value&&!e.modified()?this.value:gc(e.fields,e.orders)}function ev(e){zg.call(this,null,e)}function tv(e){zg.call(this,null,e)}Yy.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Mc(Yy,zg,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(Eu(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Hg(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=Yu(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=Su(l,Eu(t),e.name||"bin_"+$u(t))}}),Ky.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Mc(Ky,zg,{transform(e,t){const n=t.fork(t.ALL),r=Jy(ag,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(fg(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Mc(Qy,vg),ev.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Mc(ev,zg,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n((e=>i[e]=1+(i[e]||0))),c=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=sg({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),tv.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Mc(tv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push(sg(s)),(s={})[t]=a);return o}(s,i,a,e.filter||zu)):n.mod=s,n.source=this.value,n.modifies(r)}});const nv={kde:iy,mixture:cy,normal:ry,lognormal:uy,uniform:my},rv="function";function iv(e,t){const n=e.function;Ec(nv,n)||Mu("Unknown distribution function: "+n);const r=nv[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>iv(e,t)))):typeof r[n]===rv&&r[n](e[n]);return r}function av(e){zg.call(this,null,e)}const ov=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],sv={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:ov},{name:"weights",type:"number",array:!0}]};function lv(e,t){return e?e.map(((e,n)=>t[n]||$u(e))):null}function uv(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}av.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:ov.concat(sv)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Mc(av,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=iv(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&Mu("Invalid density method: "+o),e.extent||r.data||Mu("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=My(o,e.extent||Oc(r.data()),i,a).map((e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],sg(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function cv(e){zg.call(this,null,e)}cv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function fv(e){vg.call(this,null,dv,e),this.modified(!0)}function dv(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:Su((n=>t(n,e)),Eu(t),$u(t))}function hv(e){zg.call(this,[void 0,void 0],e)}function pv(e,t){vg.call(this,e),this.parent=t,this.count=0}function mv(e){zg.call(this,{},e),this._keys=Dc();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function gv(e){vg.call(this,null,yv,e)}function yv(e){return this.value&&!e.modified()?this.value:qu(e.name)?hc(e.name).map((e=>Fu(e))):Fu(e.name,e.as)}function vv(e){zg.call(this,Dc(),e)}function bv(e){zg.call(this,[],e)}function xv(e){zg.call(this,[],e)}function wv(e){zg.call(this,null,e)}function _v(e){zg.call(this,[],e)}Mc(cv,zg,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=uv(t.source,e.groupby,Nu),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>Wc(Oc(e,t))/30)(n,a),s=fg(((e,t)=>a(e)-a(t))),l=e.as||"bin",u=r.length;let c,f=1/0,d=-1/0,h=0;for(;h<u;++h){const e=r[h].sort(s);c=-1;for(const t of Yg(e,o,i,a))t<f&&(f=t),t>d&&(d=t),e[++c][l]=t}return this.value={start:f,stop:d,step:o},t.reflow(!0).modifies(l)}}),Mc(fv,vg),hv.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Mc(hv,zg,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=Yu(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=$u(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),Mc(pv,vg,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Mc(mv,zg,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=Ec(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new pv(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=ag(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(ag(e),t),s(t).add(e)})),o||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=ag(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{s(a.get(ag(e))).mod(e)})),o&&t.visit(t.REFLOW,(e=>{const t=ag(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),Mc(gv,vg),vv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Mc(vv,zg,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=ag(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(e=>{const t=ag(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(t=>{l(t,e)?a.push(t):r.set(ag(t),1)})),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),bv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Mc(bv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=lv(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),s=t.reduce(((e,t)=>Math.max(e,t.length)),0);let l,u,c,f=0;for(;f<s;++f){for(u=lg(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][f])?null:c;a&&(u[a]=f),n.add.push(u)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),xv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Mc(xv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map($u),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<l;++a)t=lg(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),wv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Mc(wv,zg,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),Mc(_v,zg,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=sg(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const kv={value:"value",median:od,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:td,max:ed},Ov=[];function Sv(e){zg.call(this,[],e)}function $v(e){Xy.call(this,e)}function Ev(e){zg.call(this,null,e)}function Av(e){vg.call(this,null,Dv,e)}function Dv(e){return this.value&&!e.modified()?this.value:Bc(e.fields,e.flat)}function Cv(e){zg.call(this,[],e),this._pending=null}function Mv(e,t,n){n.forEach(sg);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function jv(e){zg.call(this,{},e)}function Fv(e){vg.call(this,null,Tv,e)}function Tv(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function Nv(e){vg.call(this,null,Rv,e)}function Rv(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function Pv(e){zg.call(this,null,e)}function zv(e){Xy.call(this,e)}function Bv(e){mv.call(this,e)}function Iv(e){zg.call(this,null,e)}function Lv(e){zg.call(this,null,e)}function qv(e){zg.call(this,null,e)}Sv.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Mc(Sv,zg,{transform(e,t){var n,r,i,a,o,s,l,u,c,f,d=t.fork(t.ALL),h=function(e){var t,n=e.method||kv.value;if(null!=kv[n])return n===kv.value?(t=void 0!==e.value?e.value:0,()=>t):kv[n];Mu("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=$u(e.field),g=$u(e.key),y=(e.groupby||[]).map($u),v=function(e,t,n,r){var i,a,o,s,l,u,c,f,d=e=>e(f),h=[],p=r?r.slice():[],m={},g={};for(p.forEach(((e,t)=>m[e]=t+1)),s=0,c=e.length;s<c;++s)u=n(f=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(d):Ov)+""])||(o=g[a]=[],h.push(o),o.values=i),o[l-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(o=0,u=v.length;o<u;++o)for(i=(n=v[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=v.domain[l],f={_impute:!0},s=0,c=i.length;s<c;++s)f[y[s]]=i[s];f[g]=a,f[m]=Number.isNaN(r)?r=h(n,p):r,b.push(sg(f))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d}}),$v.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:zy},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Mc($v,Xy,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{kc(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),Ev.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Mc(Ev,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=uv(r,e.groupby,e.field),a=(e.groupby||[]).map($u),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&Mu("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=Oc(r,e.field)),f=d=e.steps||d),i.forEach((t=>{const n=iy(t,o)[s],r=e.counts?t.length:1;My(n,c||Oc(t),f,d).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push(sg(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Mc(Av,vg),Mc(Cv,zg,{transform(e,t){const n=t.dataflow;if(this._pending)return Mv(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return Mv(this,t,n.parse(e.values,e.format));if(e.async){return{async:n.request(e.url,e.format).then((e=>(this._pending=hc(e.data),e=>e.touch(this))))}}return n.request(e.url,e.format).then((e=>Mv(this,t,hc(e.data))))}}),jv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Mc(jv,zg,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,f=o?t.SOURCE:t.ADD,d=t,h=e.as;return i?(u=i.length,s>1&&!h&&Mu('Multi-field lookup requires explicit "as" parameter.'),h&&h.length!==s*u&&Mu('The "as" parameter has too few output field names.'),h=h||i.map($u),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[h[c]]=a;else for(t=0;t<u;++t,++c)e[h[c]]=i[t](o)}):(h||Mu("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[h[i]]=null==t?a:t}),o?d=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),f|=c?t.MOD:0),t.visit(f,l),d.modifies(h)}}),Mc(Fv,vg),Mc(Nv,vg),Mc(Pv,zg,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),zv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:zy,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Mc(zv,Xy,{_transform:Xy.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=Eu(n).concat(Eu(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(yc),t?i.slice(0,t):i}(n,e.limit||0,t);t.changed()&&e.set("__pivot__",null,null,!0);return{key:e.key,groupby:e.groupby,ops:o.map((()=>i)),fields:o.map((e=>function(e,t,n,r){return Su((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:o.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),Mc(Bv,mv,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(ag(e),n,t,e);return(e.modified("field")||r&&t.modified(Eu(r)))&&Mu("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(sg(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),Iv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Mc(Iv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=lv(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):ug;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,(e=>{const t=ag(e);n.rem.push(o[t]),o[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,sg({}));o[ag(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,o[ag(e)]))})),n}}),Mc(Lv,zg,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),qv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Uv(e){zg.call(this,null,e)}function Vv(e){zg.call(this,[],e),this.count=0}function Wv(e){zg.call(this,null,e)}function Hv(e){zg.call(this,null,e),this.modified(!0)}function Gv(e){zg.call(this,null,e)}Mc(qv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=uv(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map($u),o=[],s=e.step||.01,l=e.probs||ld(s/2,1-1e-14,s),u=l.length;return i.forEach((e=>{const t=Ug(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push(sg(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),Mc(Uv,zg,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=ag(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=lg(e);r[ag(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[ag(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),Vv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Mc(Vv,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[ag(t)]=1,e)),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*Gg()),r<o.length&&r>=l&&(t=o[r],a[ag(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=ag(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((e=>-1!==a[ag(e)]))),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,(e=>{a[ag(e)]||u(e)})),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[ag(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[ag(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter((e=>!a[ag(e)]))),this.count=s,this.value=n.source=o,n}}),Wv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Mc(Wv,zg,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=ld(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,sg(t)})),n.add=t.add.concat(this.value),n}}),Mc(Hv,zg,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Xv=["unit0","unit1"];function Yv(e){zg.call(this,Dc(),e)}function Jv(e){zg.call(this,null,e)}Gv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:hh,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Xv}]},Mc(Gv,zg,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?Uh:qh)(a.unit).offset,s=e.as||Xv,l=s[0],u=s[1],c=a.step;let f=a.start||1/0,d=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(Eu(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,d=-1/0),t.visit(h,(e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<f&&(f=i),s>d&&(d=s))})),a.start=f,a.stop=d,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:cp({extent:e.extent||Oc(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=mh(r),o=this.value||{},s=(n?Bh:Rh)(a,i);return s.unit=Xu(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),Mc(Yv,zg,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Mc(Jv,zg,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(fg(e.sort)):t.source).map(e.field))}});const Kv={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Kv.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Mu("ntile num must be greater than zero.");const n=Kv.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Mu("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n){if(null!=e(t[n]))return n}return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};const Qv=Object.keys(Kv);function Zv(e){const t=hc(e.ops),n=hc(e.fields),r=hc(e.params),i=hc(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let f=!0;function d(e){hc(Eu(e)).forEach((e=>s[e]=1))}d(e.sort),t.forEach(((e,t)=>{const s=n[t],h=$u(s),p=Ty(e,h,i[t]);if(d(s),a.push(p),Ec(Kv,e))o.push(function(e,t,n,r){const i=Kv[e](t,n);return{init:i.init||Ru,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&Mu("Null aggregate field specified."),"count"===e)return void u.push(p);f=!1;let t=l[h];t||(t=l[h]=[],t.field=s,c.push(t)),t.push(By(e,p))}})),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>Wy(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new Hy;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,f)),this.inputs=Object.keys(s)}const eb=Zv.prototype;function tb(e){zg.call(this,{},e),this._mlen=0,this._mods=[]}function nb(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?qf(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||wc(-1)};t.init();for(let e=0;e<l;++e)rb(c,o,e,l),a&&ib(c,u),t.update(c,s[e])}function rb(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function ib(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}eb.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},eb.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},tb.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Qv.concat(zy)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Mc(tb,zg,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=fg(e.sort),i=Fy(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new Zv(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)nb(this._mods[t],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Jy(ag),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});var ab=Object.freeze({__proto__:null,aggregate:Xy,bin:Yy,collect:Ky,compare:Qy,countpattern:ev,cross:tv,density:av,dotbin:cv,expression:fv,extent:hv,facet:mv,field:gv,filter:vv,flatten:bv,fold:xv,formula:wv,generate:_v,impute:Sv,joinaggregate:$v,kde:Ev,key:Av,load:Cv,lookup:jv,multiextent:Fv,multivalues:Nv,params:Pv,pivot:zv,prefacet:Bv,project:Iv,proxy:Lv,quantile:qv,relay:Uv,sample:Vv,sequence:Wv,sieve:Hv,subflow:pv,timeunit:Gv,tupleindex:Yv,values:Jv,window:tb});const ob=Math.PI,sb=2*ob,lb=1e-6,ub=sb-lb;function cb(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function fb(){return new cb}function db(e){return function(){return e}}cb.prototype=fb.prototype={constructor:cb,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,l=r-t,u=a-e,c=o-t,f=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>lb)if(Math.abs(c*s-l*u)>lb&&i){var d=n-a,h=r-o,p=s*s+l*l,m=d*d+h*h,g=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((ob-Math.acos((p+f-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>lb&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>lb||Math.abs(this._y1-u)>lb)&&(this._+="L"+l+","+u),n&&(f<0&&(f=f%sb+sb),f>ub?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>lb&&(this._+="A"+n+","+n+",0,"+ +(f>=ob)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var hb=Math.abs,pb=Math.atan2,mb=Math.cos,gb=Math.max,yb=Math.min,vb=Math.sin,bb=Math.sqrt,xb=1e-12,wb=Math.PI,_b=wb/2,kb=2*wb;function Ob(e){return e>1?0:e<-1?wb:Math.acos(e)}function Sb(e){return e>=1?_b:e<=-1?-_b:Math.asin(e)}function $b(e){return e.innerRadius}function Eb(e){return e.outerRadius}function Ab(e){return e.startAngle}function Db(e){return e.endAngle}function Cb(e){return e&&e.padAngle}function Mb(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,f=s-a,d=f*l-c*u;if(!(d*d<xb))return[e+(d=(c*(t-a)-f*(e-i))/d)*l,t+d*u]}function jb(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/bb(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,m=r+f,g=(d+p)/2,y=(h+m)/2,v=p-d,b=m-h,x=v*v+b*b,w=i-a,_=d*m-p*h,k=(b<0?-1:1)*bb(gb(0,w*w*x-_*_)),O=(_*b-v*k)/x,S=(-_*v-b*k)/x,$=(_*b+v*k)/x,E=(-_*v+b*k)/x,A=O-g,D=S-y,C=$-g,M=E-y;return A*A+D*D>C*C+M*M&&(O=$,S=E),{cx:O,cy:S,x01:-c,y01:-f,x11:O*(i/w-1),y11:S*(i/w-1)}}function Fb(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Tb(e){this._context=e}function Nb(e){return new Tb(e)}function Rb(e){return e[0]}function Pb(e){return e[1]}function zb(e,t){var n=db(!0),r=null,i=Nb,a=null;function o(o){var s,l,u,c=(o=Fb(o)).length,f=!1;for(null==r&&(a=i(u=fb())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?Rb:db(e),t="function"==typeof t?t:void 0===t?Pb:db(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:db(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:db(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:db(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o}function Bb(e,t,n){var r=null,i=db(!0),a=null,o=Nb,s=null;function l(l){var u,c,f,d,h,p=(l=Fb(l)).length,m=!1,g=new Array(p),y=new Array(p);for(null==a&&(s=o(h=fb())),u=0;u<=p;++u){if(!(u<p&&i(d=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=u-1;f>=c;--f)s.point(g[f],y[f]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(d,u,l),y[u]=+t(d,u,l),s.point(r?+r(d,u,l):g[u],n?+n(d,u,l):y[u]))}if(h)return s=null,h+""||null}function u(){return zb().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?Rb:db(+e),t="function"==typeof t?t:db(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?Pb:db(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:db(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:db(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:db(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:db(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:db(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:db(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:db(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l}Tb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Ib={draw:function(e,t){var n=Math.sqrt(t/wb);e.moveTo(n,0),e.arc(0,0,n,0,kb)}};function Lb(){}function qb(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Ub(e){this._context=e}function Vb(e){this._context=e}function Wb(e){this._context=e}function Hb(e,t){this._basis=new Ub(e),this._beta=t}Ub.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:qb(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Vb.prototype={areaStart:Lb,areaEnd:Lb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Wb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:qb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Hb.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)r=l/n,this._basis.point(this._beta*e[l]+(1-this._beta)*(i+r*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var Gb=function e(t){function n(e){return 1===t?new Ub(e):new Hb(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function Xb(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Yb(e,t){this._context=e,this._k=(1-t)/6}Yb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Xb(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Xb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Jb=function e(t){function n(e){return new Yb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Kb(e,t){this._context=e,this._k=(1-t)/6}Kb.prototype={areaStart:Lb,areaEnd:Lb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Xb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Qb=function e(t){function n(e){return new Kb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Zb(e,t){this._context=e,this._k=(1-t)/6}Zb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Xb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ex=function e(t){function n(e){return new Zb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function tx(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>xb){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>xb){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function nx(e,t){this._context=e,this._alpha=t}nx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:tx(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var rx=function e(t){function n(e){return t?new nx(e,t):new Yb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function ix(e,t){this._context=e,this._alpha=t}ix.prototype={areaStart:Lb,areaEnd:Lb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:tx(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ax=function e(t){function n(e){return t?new ix(e,t):new Kb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function ox(e,t){this._context=e,this._alpha=t}ox.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:tx(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var sx=function e(t){function n(e){return t?new ox(e,t):new Zb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function lx(e){this._context=e}function ux(e){return e<0?-1:1}function cx(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(ux(a)+ux(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function fx(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function dx(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function hx(e){this._context=e}function px(e){this._context=new mx(e)}function mx(e){this._context=e}function gx(e){this._context=e}function yx(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function vx(e,t){this._context=e,this._t=t}function bx(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}lx.prototype={areaStart:Lb,areaEnd:Lb,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},hx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:dx(this,this._t0,fx(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,dx(this,fx(this,n=cx(this,e,t)),n);break;default:dx(this,this._t0,n=cx(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(px.prototype=Object.create(hx.prototype)).point=function(e,t){hx.prototype.point.call(this,t,e)},mx.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},gx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=yx(e),i=yx(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},vx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const xx=()=>"undefined"!=typeof Image?Image:null;function wx(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function _x(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const kx=Symbol("implicit");function Ox(){var e=new Map,t=[],n=[],r=kx;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==kx)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return Ox(t,n).unknown(r)},wx.apply(i,arguments),i}function Sx(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function $x(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ex(){}var Ax=.7,Dx=1/Ax,Cx="\\s*([+-]?\\d+)\\s*",Mx="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",jx="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Fx=/^#([0-9a-f]{3,8})$/,Tx=new RegExp("^rgb\\("+[Cx,Cx,Cx]+"\\)$"),Nx=new RegExp("^rgb\\("+[jx,jx,jx]+"\\)$"),Rx=new RegExp("^rgba\\("+[Cx,Cx,Cx,Mx]+"\\)$"),Px=new RegExp("^rgba\\("+[jx,jx,jx,Mx]+"\\)$"),zx=new RegExp("^hsl\\("+[Mx,jx,jx]+"\\)$"),Bx=new RegExp("^hsla\\("+[Mx,jx,jx,Mx]+"\\)$"),Ix={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Lx(){return this.rgb().formatHex()}function qx(){return this.rgb().formatRgb()}function Ux(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Fx.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Vx(t):3===n?new Xx(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Wx(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Wx(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Tx.exec(e))?new Xx(t[1],t[2],t[3],1):(t=Nx.exec(e))?new Xx(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Rx.exec(e))?Wx(t[1],t[2],t[3],t[4]):(t=Px.exec(e))?Wx(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=zx.exec(e))?Qx(t[1],t[2]/100,t[3]/100,1):(t=Bx.exec(e))?Qx(t[1],t[2]/100,t[3]/100,t[4]):Ix.hasOwnProperty(e)?Vx(Ix[e]):"transparent"===e?new Xx(NaN,NaN,NaN,0):null}function Vx(e){return new Xx(e>>16&255,e>>8&255,255&e,1)}function Wx(e,t,n,r){return r<=0&&(e=t=n=NaN),new Xx(e,t,n,r)}function Hx(e){return e instanceof Ex||(e=Ux(e)),e?new Xx((e=e.rgb()).r,e.g,e.b,e.opacity):new Xx}function Gx(e,t,n,r){return 1===arguments.length?Hx(e):new Xx(e,t,n,null==r?1:r)}function Xx(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Yx(){return"#"+Kx(this.r)+Kx(this.g)+Kx(this.b)}function Jx(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Kx(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Qx(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new tw(e,t,n,r)}function Zx(e){if(e instanceof tw)return new tw(e.h,e.s,e.l,e.opacity);if(e instanceof Ex||(e=Ux(e)),!e)return new tw;if(e instanceof tw)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new tw(o,s,l,e.opacity)}function ew(e,t,n,r){return 1===arguments.length?Zx(e):new tw(e,t,n,null==r?1:r)}function tw(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function nw(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}Sx(Ex,Ux,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Lx,formatHex:Lx,formatHsl:function(){return Zx(this).formatHsl()},formatRgb:qx,toString:qx}),Sx(Xx,Gx,$x(Ex,{brighter:function(e){return e=null==e?Dx:Math.pow(Dx,e),new Xx(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?Ax:Math.pow(Ax,e),new Xx(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yx,formatHex:Yx,formatRgb:Jx,toString:Jx})),Sx(tw,ew,$x(Ex,{brighter:function(e){return e=null==e?Dx:Math.pow(Dx,e),new tw(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ax:Math.pow(Ax,e),new tw(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Xx(nw(e>=240?e-240:e+120,i,r),nw(e,i,r),nw(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const rw=Math.PI/180,iw=180/Math.PI,aw=.96422,ow=.82521,sw=4/29,lw=6/29,uw=3*lw*lw;function cw(e){if(e instanceof dw)return new dw(e.l,e.a,e.b,e.opacity);if(e instanceof bw)return xw(e);e instanceof Xx||(e=Hx(e));var t,n,r=gw(e.r),i=gw(e.g),a=gw(e.b),o=hw((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=hw((.4360747*r+.3850649*i+.1430804*a)/aw),n=hw((.0139322*r+.0971045*i+.7141733*a)/ow)),new dw(116*o-16,500*(t-o),200*(o-n),e.opacity)}function fw(e,t,n,r){return 1===arguments.length?cw(e):new dw(e,t,n,null==r?1:r)}function dw(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function hw(e){return e>.008856451679035631?Math.pow(e,1/3):e/uw+sw}function pw(e){return e>lw?e*e*e:uw*(e-sw)}function mw(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function gw(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function yw(e){if(e instanceof bw)return new bw(e.h,e.c,e.l,e.opacity);if(e instanceof dw||(e=cw(e)),0===e.a&&0===e.b)return new bw(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*iw;return new bw(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function vw(e,t,n,r){return 1===arguments.length?yw(e):new bw(e,t,n,null==r?1:r)}function bw(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function xw(e){if(isNaN(e.h))return new dw(e.l,0,0,e.opacity);var t=e.h*rw;return new dw(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}Sx(dw,fw,$x(Ex,{brighter:function(e){return new dw(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new dw(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Xx(mw(3.1338561*(t=aw*pw(t))-1.6168667*(e=1*pw(e))-.4906146*(n=ow*pw(n))),mw(-.9787684*t+1.9161415*e+.033454*n),mw(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),Sx(bw,vw,$x(Ex,{brighter:function(e){return new bw(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new bw(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return xw(this).rgb()}}));var ww=-.14861,_w=1.78277,kw=-.29227,Ow=-.90649,Sw=1.97294,$w=Sw*Ow,Ew=Sw*_w,Aw=_w*kw-Ow*ww;function Dw(e){if(e instanceof Mw)return new Mw(e.h,e.s,e.l,e.opacity);e instanceof Xx||(e=Hx(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(Aw*r+$w*t-Ew*n)/(Aw+$w-Ew),a=r-i,o=(Sw*(n-i)-kw*a)/Ow,s=Math.sqrt(o*o+a*a)/(Sw*i*(1-i)),l=s?Math.atan2(o,a)*iw-120:NaN;return new Mw(l<0?l+360:l,s,i,e.opacity)}function Cw(e,t,n,r){return 1===arguments.length?Dw(e):new Mw(e,t,n,null==r?1:r)}function Mw(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function jw(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Fw(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return jw((n-r/t)*t,o,i,a,s)}}function Tw(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return jw((n-r/t)*t,i,a,o,s)}}Sx(Mw,Cw,$x(Ex,{brighter:function(e){return e=null==e?Dx:Math.pow(Dx,e),new Mw(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?Ax:Math.pow(Ax,e),new Mw(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*rw,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Xx(255*(t+n*(ww*r+_w*i)),255*(t+n*(kw*r+Ow*i)),255*(t+n*(Sw*r)),this.opacity)}}));var Nw=e=>()=>e;function Rw(e,t){return function(n){return e+n*t}}function Pw(e,t){var n=t-e;return n?Rw(e,n>180||n<-180?n-360*Math.round(n/360):n):Nw(isNaN(e)?t:e)}function zw(e){return 1==(e=+e)?Bw:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Nw(isNaN(t)?n:t)}}function Bw(e,t){var n=t-e;return n?Rw(e,n):Nw(isNaN(e)?t:e)}var Iw=function e(t){var n=zw(t);function r(e,t){var r=n((e=Gx(e)).r,(t=Gx(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Bw(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Lw(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=Gx(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var qw=Lw(Fw),Uw=Lw(Tw);function Vw(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Ww(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Hw(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Zw(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function Gw(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Xw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Yw(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Zw(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Jw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Kw=new RegExp(Jw.source,"g");function Qw(e,t){var n,r,i,a=Jw.lastIndex=Kw.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=Jw.exec(e))&&(r=Kw.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:Xw(n,r)})),a=Kw.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Zw(e,t){var n,r=typeof t;return null==t||"boolean"===r?Nw(t):("number"===r?Xw:"string"===r?(n=Ux(t))?(t=n,Iw):Qw:t instanceof Ux?Iw:t instanceof Date?Gw:Ww(t)?Vw:Array.isArray(t)?Hw:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Yw:Xw)(e,t)}function e_(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var t_,n_=180/Math.PI,r_={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function i_(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*n_,skewX:Math.atan(l)*n_,scaleX:o,scaleY:s}}function a_(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:Xw(e,i)},{i:l-2,x:Xw(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Xw(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Xw(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Xw(e,n)},{i:s-2,x:Xw(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var o_=a_((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?r_:i_(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),s_=a_((function(e){return null==e?r_:(t_||(t_=document.createElementNS("http://www.w3.org/2000/svg","g")),t_.setAttribute("transform",e),(e=t_.transform.baseVal.consolidate())?i_((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):r_)}),", ",")",")");function l_(e){return((e=Math.exp(e))+1/e)/2}var u_=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[0],f=i[1],d=i[2],h=c-s,p=f-l,m=h*h+p*p;if(m<1e-12)o=Math.log(d/u)/t,a=function(e){return[s+e*h,l+e*p,u*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),y=(d*d-u*u+r*m)/(2*u*n*g),v=(d*d-u*u-r*m)/(2*d*n*g),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);o=(x-b)/t,a=function(e){var r=e*o,i=l_(b),a=u/(n*g)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,l+a*p,u*i/l_(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function c_(e){return function(t,n){var r=e((t=ew(t)).h,(n=ew(n)).h),i=Bw(t.s,n.s),a=Bw(t.l,n.l),o=Bw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var f_=c_(Pw),d_=c_(Bw);function h_(e){return function(t,n){var r=e((t=vw(t)).h,(n=vw(n)).h),i=Bw(t.c,n.c),a=Bw(t.l,n.l),o=Bw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var p_=h_(Pw),m_=h_(Bw);function g_(e){return function t(n){function r(t,r){var i=e((t=Cw(t)).h,(r=Cw(r)).h),a=Bw(t.s,r.s),o=Bw(t.l,r.l),s=Bw(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}var y_=g_(Pw),v_=g_(Bw);function b_(e,t){void 0===t&&(t=e,e=Zw);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var x_=Object.freeze({__proto__:null,interpolate:Zw,interpolateArray:function(e,t){return(Ww(t)?Vw:Hw)(e,t)},interpolateBasis:Fw,interpolateBasisClosed:Tw,interpolateDate:Gw,interpolateDiscrete:function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},interpolateHue:function(e,t){var n=Pw(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},interpolateNumber:Xw,interpolateNumberArray:Vw,interpolateObject:Yw,interpolateRound:e_,interpolateString:Qw,interpolateTransformCss:o_,interpolateTransformSvg:s_,interpolateZoom:u_,interpolateRgb:Iw,interpolateRgbBasis:qw,interpolateRgbBasisClosed:Uw,interpolateHsl:f_,interpolateHslLong:d_,interpolateLab:function(e,t){var n=Bw((e=fw(e)).l,(t=fw(t)).l),r=Bw(e.a,t.a),i=Bw(e.b,t.b),a=Bw(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}},interpolateHcl:p_,interpolateHclLong:m_,interpolateCubehelix:y_,interpolateCubehelixLong:v_,piecewise:b_,quantize:function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}});function w_(e){return+e}var __=[0,1];function k_(e){return e}function O_(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function S_(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=O_(i,r),a=n(o,a)):(r=O_(r,i),a=n(a,o)),function(e){return a(r(e))}}function $_(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=O_(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=Wf(e,t,1,r)-1;return a[n](i[n](t))}}function E_(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function A_(){var e,t,n,r,i,a,o=__,s=__,l=Zw,u=k_;function c(){var e=Math.min(o.length,s.length);return u!==k_&&(u=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?$_:S_,i=a=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return f.invert=function(n){return u(t((a||(a=r(s,o.map(e),Xw)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,w_),c()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),l=e_,c()},f.clamp=function(e){return arguments.length?(u=!!e||k_,c()):u!==k_},f.interpolate=function(e){return arguments.length?(l=e,c()):l},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function D_(){return A_()(k_,k_)}function C_(e,t,n,r){var i,a=Zf(e,t,n);switch((r=pd(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=$d(a,o))||(r.precision=i),wd(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=Ed(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=Sd(a))||(r.precision=i-2*("%"===r.type))}return xd(r)}function M_(e){var t=e.domain;return e.ticks=function(e){var n=t();return Kf(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return C_(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=Qf(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function j_(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function F_(e){return Math.log(e)}function T_(e){return Math.exp(e)}function N_(e){return-Math.log(-e)}function R_(e){return-Math.exp(-e)}function P_(e){return isFinite(e)?+("1e"+e):e<0?0:e}function z_(e){return function(t){return-e(-t)}}function B_(e){var t,n,r=e(F_,T_),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?P_:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=z_(t),n=z_(n),e(N_,R_)):e(F_,T_),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(d=s,s=l,l=d);var u,c,f,d=t(s),h=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(c=1,u=n(d);c<a;++c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}}else for(;d<=h;++d)for(c=a-1,u=n(d);c>=1;--c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}2*m.length<p&&(m=Kf(s,l,p))}else m=Kf(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=xd(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(j_(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function I_(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function L_(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function q_(e){var t=1,n=e(I_(t),L_(t));return n.constant=function(n){return arguments.length?e(I_(t=+n),L_(t)):t},M_(n)}function U_(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function V_(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function W_(e){return e<0?-e*e:e*e}function H_(e){var t=e(k_,k_),n=1;function r(){return 1===n?e(k_,k_):.5===n?e(V_,W_):e(U_(n),U_(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},M_(t)}function G_(){var e=H_(A_());return e.copy=function(){return E_(e,G_()).exponent(e.exponent())},wx.apply(e,arguments),e}var X_=1e3,Y_=6e4,J_=36e5,K_=864e5,Q_=2592e6,Z_=31536e6;function ek(e){return new Date(e)}function tk(e){return e instanceof Date?+e:+new Date(+e)}function nk(e,t,n,r,i,a,o,s,l){var u=D_(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),y=l("%b %d"),v=l("%B"),b=l("%Y"),x=[[o,1,X_],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,Y_],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,J_],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,K_],[r,2,1728e5],[n,1,6048e5],[t,1,Q_],[t,3,7776e6],[e,1,Z_]];function w(s){return(o(s)<s?d:a(s)<s?h:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:y:e(s)<s?v:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=qf((function(e){return e[2]})).right(x,a);return o===x.length?(i=Zf(n/Z_,r/Z_,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(Zf(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?f(Array.from(e,tk)):f().map(ek)},u.ticks=function(e){var t,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=f();return(e=_(e,t[0],t[t.length-1]))?f(j_(t,e)):u},u.copy=function(){return E_(u,nk(e,t,n,r,i,a,o,s,l))},u}function rk(){var e,t,n,r,i,a=0,o=1,s=k_,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(Zw),u.rangeRound=c(e_),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function ik(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ak(){var e=M_(rk()(k_));return e.copy=function(){return ik(e,ak())},_x.apply(e,arguments)}function ok(){var e=H_(rk());return e.copy=function(){return ik(e,ok()).exponent(e.exponent())},_x.apply(e,arguments)}function sk(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,f=k_,d=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),f(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,f=b_(e,[n,r,i]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h):[s,l,u]},h.clamp=function(e){return arguments.length?(d=!!e,h):d},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=p(Zw),h.rangeRound=p(e_),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h}}function lk(){var e=H_(sk());return e.copy=function(){return ik(e,lk()).exponent(e.exponent())},_x.apply(e,arguments)}function uk(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const ck="linear",fk="log",dk="pow",hk="sqrt",pk="symlog",mk="time",gk="utc",yk="sequential",vk="diverging",bk="quantile",xk="quantize",wk="threshold",_k="ordinal",kk="point",Ok="band",Sk="bin-ordinal",$k="continuous",Ek="discrete",Ak="discretizing",Dk="interpolating",Ck="temporal";function Mk(){const e=Ox().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],f=a[1-c],d=uk(e,s,l);let h=a[c-0];r=(f-h)/(d||1),o&&(r=Math.floor(r)),h+=(f-h-r*(e-s))*u,i=r*(1-s),o&&(h=Math.round(h),i=Math.round(i));const p=ld(e).map((e=>h+r*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,f=+e[0],d=+e[1];return f!=f||d!=d||(d<f&&(c=f,f=d,d=c),d<o[0]||f>a[1-r])?void 0:(l=Math.max(0,Wf(o,f)-1),u=f===d?l:Wf(o,d)-1,f-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return Mk().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function jk(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return jk(t())},e}var Fk=Array.prototype.map;function Tk(e){return Fk.call(e,Yu)}const Nk=Array.prototype.slice;const Rk={};function Pk(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?function(e){return function(t){let n,r=t[0],i=t[1];return i<r&&(n=r,r=i,i=n),[e.invert(r),e.invert(i)]}}(n):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n};return r.metadata=Kc(hc(n)),r}function zk(e,t,n){return arguments.length>1?(Rk[e]=Pk(e,t,n),this):Bk(e)?Rk[e]:void 0}function Bk(e){return Ec(Rk,e)}function Ik(e,t){const n=Rk[e];return n&&n.metadata[t]}function Lk(e){return Ik(e,$k)}function qk(e){return Ik(e,Ek)}function Uk(e){return Ik(e,Ak)}function Vk(e){return Ik(e,fk)}function Wk(e){return Ik(e,Dk)}function Hk(e){return Ik(e,bk)}zk("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,w_),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,w_):[0,1],M_(r)})),zk(ck,(function e(){var t=D_();return t.copy=function(){return E_(t,e())},wx.apply(t,arguments),M_(t)}),$k),zk(fk,(function e(){var t=B_(A_()).domain([1,10]);return t.copy=function(){return E_(t,e()).base(t.base())},wx.apply(t,arguments),t}),[$k,fk]),zk(dk,G_,$k),zk(hk,(function(){return G_.apply(null,arguments).exponent(.5)}),$k),zk(pk,(function e(){var t=q_(A_());return t.copy=function(){return E_(t,e()).constant(t.constant())},wx.apply(t,arguments)}),$k),zk(mk,(function(){return wx.apply(nk(Hd,Wd,qd,Id,Bd,zd,Pd,Md,gp).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[$k,Ck]),zk(gk,(function(){return wx.apply(nk(th,eh,Kd,Yd,Xd,Gd,Pd,Md,vp).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[$k,Ck]),zk(yk,ak,[$k,Dk]),zk("".concat(yk,"-").concat(ck),ak,[$k,Dk]),zk("".concat(yk,"-").concat(fk),(function e(){var t=B_(rk()).domain([1,10]);return t.copy=function(){return ik(t,e()).base(t.base())},_x.apply(t,arguments)}),[$k,Dk,fk]),zk("".concat(yk,"-").concat(dk),ok,[$k,Dk]),zk("".concat(yk,"-").concat(hk),(function(){return ok.apply(null,arguments).exponent(.5)}),[$k,Dk]),zk("".concat(yk,"-").concat(pk),(function e(){var t=q_(rk());return t.copy=function(){return ik(t,e()).constant(t.constant())},_x.apply(t,arguments)}),[$k,Dk]),zk("".concat(vk,"-").concat(ck),(function e(){var t=M_(sk()(k_));return t.copy=function(){return ik(t,e())},_x.apply(t,arguments)}),[$k,Dk]),zk("".concat(vk,"-").concat(fk),(function e(){var t=B_(sk()).domain([.1,1,10]);return t.copy=function(){return ik(t,e()).base(t.base())},_x.apply(t,arguments)}),[$k,Dk,fk]),zk("".concat(vk,"-").concat(dk),lk,[$k,Dk]),zk("".concat(vk,"-").concat(hk),(function(){return lk.apply(null,arguments).exponent(.5)}),[$k,Dk]),zk("".concat(vk,"-").concat(pk),(function e(){var t=q_(sk());return t.copy=function(){return ik(t,e()).constant(t.constant())},_x.apply(t,arguments)}),[$k,Dk]),zk(bk,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=ad(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[Wf(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(Lf),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},wx.apply(o,arguments)}),[Ak,bk]),zk(xk,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[Wf(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},wx.apply(M_(s),arguments)}),Ak),zk(wk,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[Wf(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},wx.apply(a,arguments)}),Ak),zk(Sk,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(Wf(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Tk(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Nk.call(e),r):n.slice()},r.tickFormat=function(e,n){return C_(t[0],Xu(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[Ek,Ak]),zk(_k,Ox,Ek),zk(Ok,Mk,Ek),zk(kk,(function(){return jk(Mk().paddingInner(1))}),Ek);const Gk=["clamp","base","constant","exponent"];function Xk(e,t){const n=t[0],r=Xu(t)-n;return function(t){return e(n+t*r)}}function Yk(e,t,n){return b_(Qk(t||"rgb",n),e)}function Jk(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Kk(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=zk(a)().domain([t,n]).range([0,1]),Gk.forEach((t=>e[t]?o[t](e[t]()):0)),o):wc(.5)}function Qk(e,t){const n=x_[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Zk(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function eO(e,t){for(const n in e)nO(n,t(e[n]))}const tO={};function nO(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(tO[e]=t,this):tO[e]}eO({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Zk),eO({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>Yk(Zk(e))));const rO="symbol",iO=e=>qu(e)?e.map((e=>String(e))):String(e),aO=(e,t)=>e[1]-t[1],oO=(e,t)=>t[1]-e[1];function sO(e,t,n){let r;return Rc(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Wc(e.domain())/n||1)))),Uu(t)&&(r=t.step,t=t.interval),zc(t)&&(t=e.type===mk?qh(t):e.type==gk?Uh(t):Mu("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function lO(e,t,n){let r=e.range(),i=r[0],a=Xu(r),o=aO;if(i>a&&(r=a,a=i,i=r,o=oO),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(o).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],Xu(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function uO(e,t){return e.bins?lO(e,e.bins):e.ticks?e.ticks(t):e.domain()}function cO(e,t,n,r,i,a){const o=t.type;let s=iO;if(o===mk||i===mk)s=e.timeFormat(r);else if(o===gk||i===gk)s=e.utcFormat(r);else if(Vk(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=fO(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function fO(e,t,n){const r=uO(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const dO={[bk]:"quantiles",[xk]:"thresholds",[wk]:"domain"},hO={[bk]:"quantiles",[xk]:"domain"};function pO(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=Xu(e),t}(e.bins):e.type===fk?fO(e,t,!0):dO[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[dO[e.type]]()):uO(e,t)}function mO(e,t,n,r,i,a,o){const s=hO[t.type]&&a!==mk&&a!==gk?function(e,t,n){const r=t[hO[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):cO(e,t,n,i,a,o);return r===rO&&(e=>dO[e.type]||e.bins)(t)?gO(s):"discrete"===r?vO(s):bO(s)}const gO=e=>(t,n,r)=>{const i=yO(r[n+1],yO(r.max,1/0)),a=xO(t,e),o=xO(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a},yO=(e,t)=>null!=e?e:t,vO=e=>(t,n)=>n?e(t):null,bO=e=>t=>e(t),xO=(e,t)=>Number.isFinite(e)?t(e):null;function wO(e,t,n,r){const i=r||t.type;return zc(n)&&function(e){return Ik(e,Ck)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==mk?n||i!==gk?mO(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function _O(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=wO(e,t,n.format,n.formatType);if(Uk(t.type)){const e=pO(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(qk(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(Xu(e)))}}let kO=0;const OO="p_";function SO(e){return e&&e.gradient}function $O(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?OO:"";return i||(i=e.id="gradient_"+kO++,"radial"===r?(e.x1=EO(e.x1,.5),e.y1=EO(e.y1,.5),e.r1=EO(e.r1,0),e.x2=EO(e.x2,.5),e.y2=EO(e.y2,.5),e.r2=EO(e.r2,.5),a=OO):(e.x1=EO(e.x1,0),e.y1=EO(e.y1,0),e.x2=EO(e.x2,1),e.y2=EO(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function EO(e,t){return null!=e?e:t}function AO(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const DO={basis:{curve:function(e){return new Ub(e)}},"basis-closed":{curve:function(e){return new Vb(e)}},"basis-open":{curve:function(e){return new Wb(e)}},bundle:{curve:Gb,tension:"beta",value:.85},cardinal:{curve:Jb,tension:"tension",value:0},"cardinal-open":{curve:ex,tension:"tension",value:0},"cardinal-closed":{curve:Qb,tension:"tension",value:0},"catmull-rom":{curve:rx,tension:"alpha",value:.5},"catmull-rom-closed":{curve:ax,tension:"alpha",value:.5},"catmull-rom-open":{curve:sx,tension:"alpha",value:.5},linear:{curve:Nb},"linear-closed":{curve:function(e){return new lx(e)}},monotone:{horizontal:function(e){return new px(e)},vertical:function(e){return new hx(e)}},natural:{curve:function(e){return new gx(e)}},step:{curve:function(e){return new vx(e,.5)}},"step-after":{curve:function(e){return new vx(e,1)}},"step-before":{curve:function(e){return new vx(e,0)}}};function CO(e,t,n){var r=Ec(DO,e)&&DO[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const MO={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},jO=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function FO(e){const t=[];let n,r,i,a,o,s,l,u,c,f;const d=e.slice().replace(jO[0],"###$1").split(jO[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],r=n.slice(1).trim().replace(jO[2],"$1###$2").replace(jO[3],"$1###$2").split(jO[4]),o=n.charAt(0),i=[o],u=0,f=r.length;u<f;++u)(a=+r[u])===a&&i.push(a);if(s=MO[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const TO=Math.PI/180,NO=Math.PI/2,RO=2*Math.PI,PO=Math.sqrt(3)/2;var zO={},BO={},IO=[].join;function LO(e){const t=IO.call(e);if(BO[t])return BO[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*m,_=r+m+x*p,k=n+g,O=r+y,S=k+x*y,$=O-x*g;return BO[t]=[c*w+f*_,d*w+h*_,c*S+f*$,d*S+h*$,c*k+f*O,d*k+h*O]}const qO=["l",0,0,0,0,0,0,0];function UO(e,t,n){const r=qO[0]=e[0];if("a"===r||"A"===r)qO[1]=t*e[1],qO[2]=n*e[2],qO[3]=e[3],qO[4]=e[4],qO[5]=e[5],qO[6]=t*e[6],qO[7]=n*e[7];else if("h"===r||"H"===r)qO[1]=t*e[1];else if("v"===r||"V"===r)qO[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)qO[i]=(i%2==1?t:n)*e[i];return qO}function VO(e,t,n,r,i,a){var o,s,l,u,c,f=null,d=0,h=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(o=t[g],1===i&&1===a||(o=UO(o,i,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+r);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+r);break;case"h":d+=o[1],e.lineTo(d+n,h+r);break;case"H":d=o[1],e.lineTo(d+n,h+r);break;case"v":h+=o[1],e.lineTo(d+n,h+r);break;case"V":h=o[1],e.lineTo(d+n,h+r);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+r);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+r);break;case"c":s=d+o[5],l=h+o[6],p=d+o[3],m=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+r,p+n,m+r,s+n,l+r),d=s,h=l;break;case"C":d=o[5],h=o[6],p=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,p+n,m+r,d+n,h+r);break;case"s":s=d+o[3],l=h+o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,d+o[1]+n,h+o[2]+r,s+n,l+r),p=d+o[1],m=h+o[2],d=s,h=l;break;case"S":s=o[3],l=o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"q":s=d+o[3],l=h+o[4],p=d+o[1],m=h+o[2],e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"Q":s=o[3],l=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"t":s=d+o[1],l=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,m=h):"t"===f[0]?(p=2*d-u,m=2*h-c):"q"===f[0]&&(p=2*d-p,m=2*h-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),h=l,p=(d=s)+o[1],m=h+o[2];break;case"T":s=o[1],l=o[2],p=2*d-p,m=2*h-m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"a":WO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+r]),d+=o[6],h+=o[7];break;case"A":WO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function WO(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=IO.call(arguments);if(zO[u])return zO[u];const c=o*TO,f=Math.sin(c),d=Math.cos(c),h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5;let m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=d/n,y=f/n,v=-f/r,b=d/r,x=g*s+y*l,w=v*s+b*l,_=g*e+y*t,k=v*e+b*t;let O=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;O<0&&(O=0);let S=Math.sqrt(O);a==i&&(S=-S);const $=.5*(x+_)-S*(k-w),E=.5*(w+k)+S*(_-x),A=Math.atan2(w-E,x-$);let D=Math.atan2(k-E,_-$)-A;D<0&&1===a?D+=RO:D>0&&0===a&&(D-=RO);const C=Math.ceil(Math.abs(D/(NO+.001))),M=[];for(let e=0;e<C;++e){const t=A+e*D/C,i=A+(e+1)*D/C;M[e]=[$,E,t,i,n,r,f,d]}return zO[u]=M}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=LO(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const HO=.5773502691896257,GO={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,RO)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n,i=r-n*HO,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n,i=r-n*HO;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=PO*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function XO(e){return Ec(GO,e)?GO[e]:function(e){if(!Ec(YO,e)){const t=FO(e);YO[e]={draw:function(e,n){VO(e,t,0,0,Math.sqrt(n)/2)}}}return YO[e]}(e)}var YO={};const JO=.448084975506;function KO(e){return e.x}function QO(e){return e.y}function ZO(e){return e.width}function eS(e){return e.height}function tS(e){return"function"==typeof e?e:()=>+e}function nS(e,t,n){return Math.max(t,Math.min(e,n))}function rS(){var e=KO,t=QO,n=ZO,r=eS,i=tS(0),a=i,o=i,s=i,l=null;function u(u,c,f){var d,h=null!=c?c:+e.call(this,u),p=null!=f?f:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),y=Math.min(m,g)/2,v=nS(+i.call(this,u),0,y),b=nS(+a.call(this,u),0,y),x=nS(+o.call(this,u),0,y),w=nS(+s.call(this,u),0,y);if(l||(l=d=fb()),v<=0&&b<=0&&x<=0&&w<=0)l.rect(h,p,m,g);else{var _=h+m,k=p+g;l.moveTo(h+v,p),l.lineTo(_-b,p),l.bezierCurveTo(_-JO*b,p,_,p+JO*b,_,p+b),l.lineTo(_,k-w),l.bezierCurveTo(_,k-JO*w,_-JO*w,k,_-w,k),l.lineTo(h+x,k),l.bezierCurveTo(h+JO*x,k,h,k-JO*x,h,k-x),l.lineTo(h,p+v),l.bezierCurveTo(h,p+JO*v,h+JO*v,p,h+v,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(t){return arguments.length?(e=tS(t),u):e},u.y=function(e){return arguments.length?(t=tS(e),u):t},u.width=function(e){return arguments.length?(n=tS(e),u):n},u.height=function(e){return arguments.length?(r=tS(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=tS(e),a=null!=t?tS(t):i,s=null!=n?tS(n):i,o=null!=r?tS(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function iS(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var f=Math.sqrt(u*u+c*c),d=(u/=f)*s,h=(c/=f)*s,p=Math.atan2(c,u);l.moveTo(a-d,o-h),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+d,o+h),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,RO);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,f=a.length,d=!1;for(null==l&&(l=c=fb()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===d&&(d=!d)&&(i=0),d&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function aS(e,t){return null!=e?e:t}const oS=e=>e.x||0,sS=e=>e.y||0,lS=e=>!(!1===e.defined),uS=function(){var e=$b,t=Eb,n=db(0),r=null,i=Ab,a=Db,o=Cb,s=null;function l(){var l,u,c=+e.apply(this,arguments),f=+t.apply(this,arguments),d=i.apply(this,arguments)-_b,h=a.apply(this,arguments)-_b,p=hb(h-d),m=h>d;if(s||(s=l=fb()),f<c&&(u=f,f=c,c=u),f>xb)if(p>kb-xb)s.moveTo(f*mb(d),f*vb(d)),s.arc(0,0,f,d,h,!m),c>xb&&(s.moveTo(c*mb(h),c*vb(h)),s.arc(0,0,c,h,d,m));else{var g,y,v=d,b=h,x=d,w=h,_=p,k=p,O=o.apply(this,arguments)/2,S=O>xb&&(r?+r.apply(this,arguments):bb(c*c+f*f)),$=yb(hb(f-c)/2,+n.apply(this,arguments)),E=$,A=$;if(S>xb){var D=Sb(S/c*vb(O)),C=Sb(S/f*vb(O));(_-=2*D)>xb?(x+=D*=m?1:-1,w-=D):(_=0,x=w=(d+h)/2),(k-=2*C)>xb?(v+=C*=m?1:-1,b-=C):(k=0,v=b=(d+h)/2)}var M=f*mb(v),j=f*vb(v),F=c*mb(w),T=c*vb(w);if($>xb){var N,R=f*mb(b),P=f*vb(b),z=c*mb(x),B=c*vb(x);if(p<wb&&(N=Mb(M,j,z,B,R,P,F,T))){var I=M-N[0],L=j-N[1],q=R-N[0],U=P-N[1],V=1/vb(Ob((I*q+L*U)/(bb(I*I+L*L)*bb(q*q+U*U)))/2),W=bb(N[0]*N[0]+N[1]*N[1]);E=yb($,(c-W)/(V-1)),A=yb($,(f-W)/(V+1))}}k>xb?A>xb?(g=jb(z,B,M,j,f,A,m),y=jb(R,P,F,T,f,A,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),A<$?s.arc(g.cx,g.cy,A,pb(g.y01,g.x01),pb(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,A,pb(g.y01,g.x01),pb(g.y11,g.x11),!m),s.arc(0,0,f,pb(g.cy+g.y11,g.cx+g.x11),pb(y.cy+y.y11,y.cx+y.x11),!m),s.arc(y.cx,y.cy,A,pb(y.y11,y.x11),pb(y.y01,y.x01),!m))):(s.moveTo(M,j),s.arc(0,0,f,v,b,!m)):s.moveTo(M,j),c>xb&&_>xb?E>xb?(g=jb(F,T,R,P,c,-E,m),y=jb(M,j,z,B,c,-E,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),E<$?s.arc(g.cx,g.cy,E,pb(g.y01,g.x01),pb(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,E,pb(g.y01,g.x01),pb(g.y11,g.x11),!m),s.arc(0,0,c,pb(g.cy+g.y11,g.cx+g.x11),pb(y.cy+y.y11,y.cx+y.x11),m),s.arc(y.cx,y.cy,E,pb(y.y11,y.x11),pb(y.y01,y.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(F,T)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-wb/2;return[mb(r)*n,vb(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:db(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:db(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:db(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:db(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:db(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:db(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:db(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),cS=Bb().x(oS).y1(sS).y0((e=>(e.y||0)+(e.height||0))).defined(lS),fS=Bb().y(sS).x1(oS).x0((e=>(e.x||0)+(e.width||0))).defined(lS),dS=zb().x(oS).y(sS).defined(lS),hS=rS().x(oS).y(sS).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>aS(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>aS(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>aS(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>aS(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),pS=function(e,t){var n=null;function r(){var r;if(n||(n=r=fb()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:db(e||Ib),t="function"==typeof t?t:db(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:db(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:db(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>XO(e.shape||"circle"))).size((e=>aS(e.size,64))),mS=iS().x(oS).y(sS).defined(lS).size((e=>e.size||1));function gS(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function yS(e,t,n,r){return hS.context(e)(t,n,r)}var vS=1;function bS(){vS=1}function xS(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+vS++),o=i.clipping[a]||(i.clipping[a]={id:a});return mc(r)?o.path=r(null):gS(n)?o.path=yS(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function wS(e){this.clear(),e&&this.union(e)}function _S(e){this.mark=e,this.bounds=this.bounds||new wS}function kS(e){_S.call(this,e),this.items=this.items||[]}function OS(e){this._pending=0,this._loader=e||Zm()}function SS(e){e._pending+=1}function $S(e){e._pending-=1}function ES(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}wS.prototype={clone(){return new wS(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Mc(kS,_S),OS.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return SS(t),t._loader.sanitize(e,{context:"href"}).then((e=>($S(t),e))).catch((()=>($S(t),null)))},loadImage(e){const t=this,n=xx();return SS(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=Ec(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>$S(t),i.onerror=()=>$S(t),i.src=r,i})).catch((e=>($S(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const AS=RO-1e-8;let DS,CS,MS,jS,FS,TS,NS,RS;const PS=(e,t)=>DS.add(e,t),zS=(e,t)=>PS(CS=e,MS=t),BS=e=>PS(e,DS.y1),IS=e=>PS(DS.x1,e),LS=(e,t)=>FS*e+NS*t,qS=(e,t)=>TS*e+RS*t,US=(e,t)=>PS(LS(e,t),qS(e,t)),VS=(e,t)=>zS(LS(e,t),qS(e,t));function WS(e,t){return DS=e,t?(jS=t*TO,FS=RS=Math.cos(jS),TS=Math.sin(jS),NS=-TS):(FS=RS=1,jS=TS=NS=0),HS}const HS={beginPath(){},closePath(){},moveTo:VS,lineTo:VS,rect(e,t,n,r){jS?(US(e+n,t),US(e+n,t+r),US(e,t+r),VS(e,t)):(PS(e+n,t+r),zS(e,t))},quadraticCurveTo(e,t,n,r){const i=LS(e,t),a=qS(e,t),o=LS(n,r),s=qS(n,r);GS(CS,i,o,BS),GS(MS,a,s,IS),zS(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=LS(e,t),s=qS(e,t),l=LS(n,r),u=qS(n,r),c=LS(i,a),f=qS(i,a);XS(CS,o,l,c,BS),XS(MS,s,u,f,IS),zS(c,f)},arc(e,t,n,r,i,a){if(r+=jS,i+=jS,CS=n*Math.cos(i)+e,MS=n*Math.sin(i)+t,Math.abs(i-r)>AS)PS(e-n,t-n),PS(e+n,t+n);else{const o=r=>PS(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=RO)<0&&(r+=RO),(i%=RO)<0&&(i+=RO),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=RO,s=r-r%NO,l=0;l<4&&s>i;++l,s-=NO)o(s);else for(s=r-r%NO+NO,l=0;l<4&&s<i;++l,s+=NO)o(s)}}};function GS(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function XS(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(YS(u,e,t,n,r)),0<c&&c<1&&i(YS(c,e,t,n,r))}function YS(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var JS=(JS=bx(1,1))?JS.getContext("2d"):null;const KS=new wS;function QS(e){return function(t,n){if(!JS)return!0;e(JS,t),KS.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=KS;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(JS.isPointInPath(t,e))return!0;return!1}}function ZS(e,t){return t.contains(e.x||0,e.y||0)}function e$(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(KS.set(n,r,n+i,r+a))}function t$(e,t){const n=e.x||0,r=e.y||0;return n$(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function n$(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let f,d,h,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(f=-u,d=-(a-t)),1===p&&(f=u,d=s-t),2===p&&(f=-c,d=-(o-n)),3===p&&(f=c,d=l-n),Math.abs(f)<1e-10&&d<0)return!1;if(h=d/f,f<0){if(h>g)return!1;h>m&&(m=h)}else if(f>0){if(h<m)return!1;h<g&&(g=h)}}return!0}function r$(e,t){e.globalCompositeOperation=t.blend||"source-over"}function i$(e,t){return null==e?t:e}function a$(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function o$(e,t,n){return SO(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+i$(t.x1,.5)*r,n.y1+i$(t.y1,.5)*i,Math.max(r,i)*i$(t.r1,0),n.x1+i$(t.x2,.5)*r,n.y1+i$(t.y2,.5)*i,Math.max(r,i)*i$(t.r2,.5));else{const o=i$(t.x1,0),s=i$(t.y1,0),l=i$(t.x2,1),u=i$(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=bx(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=a$(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return a$(a,t.stops)}(e,n,t.bounds):n}function s$(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=o$(e,t,t.fill),!0)}var l$=[];function u$(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&((n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=o$(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||l$),e.lineDashOffset=t.strokeDashOffset||0),!0))}function c$(e,t){return e.zindex-t.zindex||e.index-t.index}function f$(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(c$)}function d$(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=f$(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function h$(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=f$(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function p$(e){return function(t,n,r){d$(n,(n=>{r&&!r.intersects(n.bounds)||g$(e,t,n,n)}))}}function m$(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||g$(e,t,n.items[0],n.items)}}function g$(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(r$(t,n),n.fill&&s$(t,n,i)&&t.fill(),n.stroke&&u$(t,n,i)&&t.stroke()))}function y$(e){return e=e||zu,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,h$(n,(n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function v$(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(o=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function b$(e){return y$(v$(e))}function x$(e,t){return"translate("+e+","+t+")"}function w$(e){return"rotate("+e+")"}function _$(e){return x$(e.x||0,e.y||0)}function k$(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=TO),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return x$(e.x||0,e.y||0)+(e.angle?" "+w$(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(WS(e,n.angle),n),ES(e,n).translate(n.x||0,n.y||0)},draw:p$(r),pick:b$(r),isect:n||QS(r)}}var O$=k$("arc",(function(e,t){return uS.context(e)(t)}));function S$(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=v$(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(WS(e),r),ES(e,r[0]))},draw:m$(r),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:ZS,tip:n}}var $$=S$("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?fS:cS).curve(CO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function E$(e,t){e.beginPath(),gS(t)?yS(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function A$(e){const t=i$(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function D$(e,t){const n=A$(t);e("d",yS(null,t,n,n))}function C$(e,t,n,r){const i=A$(t);e.beginPath(),yS(e,t,(n||0)+i,(r||0)+i)}const M$=v$(C$),j$=v$(C$,!1),F$=v$(C$,!0);var T$={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",_$(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),ES(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){d$(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(C$(e,t,r,i),r$(e,t),t.fill&&s$(e,t,o)&&e.fill(),t.stroke&&!a&&u$(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&E$(e,t),n&&n.translate(-r,-i),d$(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(C$(e,t,r,i),r$(e,t),u$(e,t,o)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return h$(t,(l=>{let u,c,f;const d=l.bounds;if(d&&!d.contains(i,a))return;c=l.x||0,f=l.y||0;const h=c+(l.width||0),p=f+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<f||a>p))return;if(e.save(),e.translate(c,f),c=i-c,f=a-f,m&&gS(l)&&!F$(e,l,o,s))return e.restore(),null;const g=l.strokeForeground,y=!1!==t.interactive;return y&&g&&l.stroke&&j$(e,l,o,s)?(e.restore(),l):(u=h$(l,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,f)?this.pick(e,n,r,c,f):null)),!u&&y&&(l.fill||!g&&l.stroke)&&M$(e,l,o,s)&&(u=l),e.restore(),u||null)}))},isect:e$,content:function(e,t,n){e("clip-path",t.clip?xS(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),D$(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?D$(e,t):e("d","")}},N$={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function R$(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function P$(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function z$(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function B$(e,t){return"center"===e?t/2:"right"===e?t:0}function I$(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var L$={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=R$(t,n),i=P$(t,r),a=z$(t,r),o=(t.x||0)-B$(t.align,i),s=(t.y||0)-I$(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",N$["xmlns:xlink"],"xlink:href"),e("transform",x$(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=P$(t,n),i=z$(t,n),a=(t.x||0)-B$(t.align,r),o=(t.y||0)-I$(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){d$(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=R$(t,this);let i,a,o,s,l=P$(t,r),u=z$(t,r),c=(t.x||0)-B$(t.align,l),f=(t.y||0)-I$(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,f+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(r$(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,f,l,u))}))},pick:y$(),isect:zu,get:R$,xOffset:B$,yOffset:I$},q$=S$("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return dS.curve(CO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function U$(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*TO,l=t.pathCache;l&&l.path===n||((t.pathCache=l=FO(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),VO(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):VO(e,l,r,i,a,o)}var V$={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return x$(e.x||0,e.y||0)+(e.angle?" "+w$(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return U$(WS(e,t.angle),t)?e.set(0,0,0,0):ES(e,t,!0)},draw:p$(U$),pick:b$(U$),isect:QS(U$)};function W$(e,t){e.beginPath(),yS(e,t)}var H$={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",yS(null,t))},bound:function(e,t){var n,r;return ES(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:p$(W$),pick:b$(W$),isect:e$};function G$(e,t,n){var r,i,a,o;return!(!t.stroke||!u$(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var X$={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",_$(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return ES(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){d$(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&G$(e,t,r)&&(r$(e,t),e.stroke())}}))},pick:y$((function(e,t,n,r){return!!e.isPointInStroke&&(G$(e,t,1)&&e.isPointInStroke(n,r))})),isect:t$},Y$=k$("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),J$=k$("symbol",(function(e,t){return pS.context(e)(t)}),ZS);const K$=Lc();var Q$={height:iE,measureWidth:nE,estimateWidth:eE,width:eE,canvas:Z$};function Z$(e){Q$.width=e&&JS?nE:eE}function eE(e,t){return tE(lE(e,t),iE(e))}function tE(e,t){return~~(.8*e.length*t)}function nE(e,t){return iE(e)<=0||!(t=lE(e,t))?0:rE(t,cE(e))}function rE(e,t){const n="(".concat(t,") ").concat(e);let r=K$.get(n);return void 0===r&&(JS.font=t,r=JS.measureText(e).width,K$.set(n,r)),r}function iE(e){return null!=e.fontSize?+e.fontSize||0:11}function aE(e){return null!=e.lineHeight?e.lineHeight:iE(e)+2}function oE(e){return function(e){return qu(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!qu(e.text)?e.text.split(e.lineBreak):e.text)}function sE(e){const t=oE(e);return(qu(t)?t.length-1:0)*aE(e)}function lE(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(Q$.width===nE){const t=cE(e);return e=>rE(e,t)}{const t=iE(e);return e=>tE(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"…",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)i=s+l>>>1,r(t.slice(i))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)i=1+(s+l>>>1),r(t.slice(0,i))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function uE(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function cE(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+iE(e)+"px "+uE(e,t)}function fE(e){var t=e.baseline,n=iE(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*aE(e):"line-bottom"===t?.29*n-.5*aE(e):0)}Z$(!0);const dE={left:"start",center:"middle",right:"end"},hE=new wS;function pE(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-NO,n+=i*Math.cos(t),r+=i*Math.sin(t)),hE.x1=n,hE.y1=r,hE}function mE(e,t,n){var r,i=Q$.height(t),a=t.align,o=pE(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+fE(t)-Math.round(.8*i),f=oE(t);if(qu(f)?(i+=aE(t)*(f.length-1),r=f.reduce(((e,n)=>Math.max(e,Q$.width(t,n))),0)):r=Q$.width(t,f),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*TO,s,l);else if(2===n)return e.rotatedPoints(t.angle*TO,s,l);return e}var gE={arc:O$,area:$$,group:T$,image:L$,line:q$,path:V$,rect:H$,rule:X$,shape:Y$,symbol:J$,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+fE(t),a=pE(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",dE[t.align]||"start"),l?(n=x$(o,s)+" "+w$(l),(r||i)&&(n+=" "+x$(r,i))):n=x$(o+r,s+i),e("transform",n)},bound:mE,draw:function(e,t,n){d$(t,(t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=cE(t),e.textAlign=t.align||"left",i=(r=pE(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*TO),i=a=0),i+=t.dx||0,a+=(t.dy||0)+fE(t),l=oE(t),r$(e,t),qu(l))for(s=aE(t),o=0;o<l.length;++o)u=lE(t,l[o]),t.fill&&s$(e,t,c)&&e.fillText(u,i,a),t.stroke&&u$(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=lE(t,l),t.fill&&s$(e,t,c)&&e.fillText(u,i,a),t.stroke&&u$(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}}))},pick:y$((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=pE(t),s=o.x1,l=o.y1,u=mE(hE,t,1),c=-t.angle*TO,f=Math.cos(c),d=Math.sin(c),h=f*i-d*a+(s-f*s+d*l),p=d*i+f*a+(l-d*s-f*l);return u.contains(h,p)})),isect:function(e,t){const n=mE(hE,e,2);return n$(t,n[0],n[1],n[2],n[3])||n$(t,n[0],n[1],n[4],n[5])||n$(t,n[4],n[5],n[6],n[7])||n$(t,n[2],n[3],n[6],n[7])}},trail:S$("trail",(function(e,t){return mS.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function yE(e,t,n){var r=gE[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new wS),e,n)}var vE={mark:null};function bE(e,t,n){var r,i,a,o,s=gE[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(vE.mark=e,a=vE),o=yE(a,l,n),t=t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new wS,c)for(r=0,i=u.length;r<i;++r)t.union(yE(u[r],l,n));return e.bounds=t}const xE=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function wE(e,t){return JSON.stringify(e,xE,t)}function _E(e){return kE("string"==typeof e?JSON.parse(e):e)}function kE(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&kE(a[n]);return i&&bE(e),e}function OE(e){arguments.length?this.root=_E(e):(this.root=SE({marktype:"group",name:"root",role:"frame"}),this.root.items=[new kS(this.root)])}function SE(e,t){const n={bounds:new wS,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function $E(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function EE(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function AE(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=$E(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function DE(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function CE(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function ME(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function jE(e,t){this._active=null,this._handlers={},this._loader=e||Zm(),this._tooltip=t||FE}function FE(e,t,n,r){e.element().setAttribute("title",r||"")}function TE(e){this._el=null,this._bgcolor=null,this._loader=new OS(e)}OE.prototype={toJSON(e){return wE(this.root,e||0)},mark(e,t,n){const r=SE(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},jE.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=$E(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=gE[o.marktype]).tip){for((a=ME(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},TE.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const NE="dragenter",RE="dragleave",PE="dragover",zE="mousedown",BE="mousemove",IE="mouseout",LE="mouseover",qE="click",UE="mousewheel",VE="touchstart",WE="touchmove",HE="touchend",GE=BE,XE=IE,YE=qE;function JE(e,t){jE.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function KE(e,t){(e=>e===VE||e===WE||e===HE?[VE,WE,HE]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function QE(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function ZE(e){return function(t){this.fire(e,t),this._active=null}}Mc(JE,jE,{initialize(e,t,n){return this._canvas=e&&EE(e,"canvas"),[qE,zE,BE,IE,RE].forEach((e=>KE(this,e))),jE.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",NE,RE,PE,zE,"mouseup",BE,IE,LE,qE,"dblclick","wheel",UE,VE,WE,HE],DOMMouseScroll(e){this.fire(UE,e)},mousemove:QE(BE,LE,IE),dragover:QE(PE,NE,RE),mouseout:ZE(IE),dragleave:ZE(RE),mousedown(e){this._down=this._active,this.fire(zE,e)},click(e){this._down===this._active&&(this.fire(qE,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(VE,e,!0)},touchmove(e){this.fire(WE,e,!0)},touchend(e){this.fire(HE,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===YE&&r&&r.href?this.handleHref(t,r,r.href):e!==GE&&e!==XE||this.handleTooltip(t,r,e!==XE),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(KE(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=ME(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return gE[e.marktype].pick.call(this,a,e,t,n,r,i)}});var eA="undefined"!=typeof window&&window.devicePixelRatio||1;function tA(e){TE.call(this,e),this._options={},this._redraw=!1,this._dirty=new wS,this._tempb=new wS}const nA=TE.prototype;function rA(e,t){jE.call(this,e,t);const n=this;n._hrefHandler=iA(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=iA(n,((e,t)=>{n.handleTooltip(e,t,e.type!==XE)}))}Mc(tA,TE,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:bx(1,1,this._options.type),e&&this._canvas&&(DE(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),nA.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(nA.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?eA:i;e.width=t*l,e.height=n*l;for(const e in a)s[e]=a[e];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||Mu("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((e,t,n)=>(new wS).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=gE[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),mc(n)?(e.beginPath(),n(e),e.clip()):E$(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const iA=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Mc(rA,jE,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(YE,this._hrefHandler),r.removeEventListener(GE,this._tooltipHandler),r.removeEventListener(XE,this._tooltipHandler)),this._svg=r=e&&EE(e,"svg"),r&&(r.addEventListener(YE,this._hrefHandler),r.addEventListener(GE,this._tooltipHandler),r.addEventListener(XE,this._tooltipHandler)),jE.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:iA(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const aA="aria-hidden",oA="aria-label",sA="role",lA="aria-roledescription",uA="graphics-object",cA="graphics-symbol",fA=(e,t,n)=>({[sA]:e,[lA]:t,[oA]:n||void 0}),dA=Kc(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),hA={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?vA(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(qk(s)?"discrete":s," scale")+" with ".concat(_O(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?vA(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return u=r,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Xu(e)}(a))+" with ".concat(_O(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(yA(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(yA(e),"'")}},pA={ariaRole:sA,ariaRoleDescription:lA,description:oA};function mA(e,t){const n=!1===t.aria;if(e(aA,n||void 0),n||null==t.description)for(const t in pA)e(pA[t],void 0);else{const n=t.mark.marktype;e(oA,t.description),e(sA,t.ariaRole||("group"===n?uA:cA)),e(lA,t.ariaRoleDescription||"".concat(n," mark"))}}function gA(e){return!1===e.aria?{[aA]:!0}:dA[e.role]?null:hA[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return fA(t.role||cA,t.desc,n.description||r(n))}catch(e){return null}}(e,hA[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return fA(n?uA:cA,"".concat(t," mark container"),e.description)}(e)}function yA(e){return hc(e.text).join(" ")}function vA(e){try{return hc(Xu(e.items).items[0].text).join(" ")}catch(e){return null}}const bA=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function xA(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(bA(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=bA(e),o),toString:()=>e};return o}const wA=e=>_A(xA(),e)+"";function _A(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):_A(e,r)}}return e.close()}const kA={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},OA={fill:"none","stroke-miterlimit":10},SA=N$.xmlns;function $A(e){TE.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const EA=TE.prototype;function AA(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function DA(e,t,n){let r,i,a;if("radial"===t.gradient){let r=AE(e,n++,"pattern",SA);PA(r,{id:OO+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=AE(r,0,"rect",SA),PA(r,{width:1,height:1,fill:"url(".concat(BA(),"#").concat(t.id,")")}),PA(e=AE(e,n++,"radialGradient",SA),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else PA(e=AE(e,n++,"linearGradient",SA),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=AE(e,r,"stop",SA),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return DE(e,r),n}function CA(e,t,n){let r;return(e=AE(e,n,"clipPath",SA)).setAttribute("id",t.id),t.path?(r=AE(e,0,"path",SA),r.setAttribute("d",t.path)):(r=AE(e,0,"rect",SA),PA(r,{x:0,y:0,width:t.width,height:t.height})),DE(e,1),n+1}function MA(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=$E(a,r,SA),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=$E(a,"path",SA);o.appendChild(t),t.__data__=e;const n=$E(a,"g",SA);o.appendChild(n),n.__data__=e;const r=$E(a,"path",SA);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}Mc($A,TE,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=AE(e,0,"svg",SA),PA(this._svg,N$),this._svg.setAttribute("class","marks"),DE(e,1),this._root=AE(this._svg,0,"g",SA),PA(this._root,OA),DE(this._svg,1)),this.background(this._bgcolor),EA.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),EA.background.apply(this,arguments)},resize(e,t,n,r){return EA.resize.call(this,e,t,n,r),this._svg&&(PA(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=AE(e,0,"rect",SA),PA(n,{width:this._width,height:this._height,fill:t}));const r=wA(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),DE(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=gE[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,AA(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,AA(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=gE[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=MA(t,e,n,"g",r);u.setAttribute("class",CE(t));const c=gA(t);for(const e in c)zA(u,e,c[e]);o||zA(u,"pointer-events",a),zA(u,"clip-path",t.clip?xS(this,t,t.group):null);const f=e=>{const t=this.isDirty(e),n=MA(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;d$(n,(n=>{r=e.mark(t,n,r),++i})),DE(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&f(t.items[0]):d$(t,f),DE(u,l),u},_update(e,t,n){jA=t,FA=t.__values__,mA(NA,n),e.attr(NA,n,this);const r=TA[e.type];r&&r.call(this,e,t,n),jA&&this.style(jA,n)},style(e,t){if(null!=t)for(const n in kA){let r="font"===n?uE(t):t[n];if(r===FA[n])continue;const i=kA[n];null==r?e.removeAttribute(i):(SO(r)&&(r=$O(r,this._defs.gradient,BA())),e.setAttribute(i,r+"")),FA[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=AE(e,1,"defs",SA)),r=DA(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=AE(e,1,"defs",SA)),r=CA(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):DE(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let jA=null,FA=null;const TA={group(e,t,n){const r=jA=t.childNodes[2];FA=r.__values__,e.foreground(NA,n,this),FA=t.__values__,jA=t.childNodes[1],e.content(NA,n,this);const i=jA=t.childNodes[0];e.background(NA,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==FA.events&&(zA(r,"pointer-events",a),zA(i,"pointer-events",a),FA.events=a),n.strokeForeground&&n.stroke){const e=n.fill;zA(r,"display",null),this.style(i,n),zA(i,"stroke",null),e&&(n.fill=null),FA=r.__values__,this.style(r,n),e&&(n.fill=e),jA=null}else zA(r,"display","none")},image(e,t,n){!1===n.smooth?(RA(t,"image-rendering","optimizeSpeed"),RA(t,"image-rendering","pixelated")):RA(t,"image-rendering",null)},text(e,t,n){const r=oE(n);let i,a,o,s;qu(r)?(a=r.map((e=>lE(n,e))),i=a.join("\n"),i!==FA.text&&(DE(t,0),o=t.ownerDocument,s=aE(n),a.forEach(((e,r)=>{const i=$E(o,"tspan",SA);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)})),FA.text=i)):(a=lE(n,r),a!==FA.text&&(t.textContent=a,FA.text=a)),zA(t,"font-family",uE(n)),zA(t,"font-size",iE(n)+"px"),zA(t,"font-style",n.fontStyle),zA(t,"font-variant",n.fontVariant),zA(t,"font-weight",n.fontWeight)}};function NA(e,t,n){t!==FA[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(jA,e,t,n):zA(jA,e,t),FA[e]=t)}function RA(e,t,n){n!==FA[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),FA[t]=n)}function PA(e,t){for(const n in t)zA(e,n,t[n])}function zA(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function BA(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function IA(e){TE.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Mc(IA,TE,{svg(){return this._text},_render(e){const t=xA();t.open("svg",kc({},N$,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",OA,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=gE[t.marktype],r=n.tag,i=[mA,n.attr];e.open("g",{class:CE(t),"clip-path":t.clip?xS(this,t,t.group):null},gA(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=oE(a);if(qu(t)){const n={x:0,dy:aE(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(lE(a,t[r])).close()}else e.text(lE(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),d$(a,(t=>this.mark(e,t))),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):d$(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;"bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===r&&(e["font-family"]=uE(t),e["font-size"]=iE(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in kA){let r=t[n];const a=kA[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(SO(r)&&(r=$O(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:OO+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const LA="canvas",qA="none",UA={Canvas:LA,PNG:"png",SVG:"svg",None:qA},VA={};function WA(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(VA[e]=t,this):VA[e]}function HA(e,t,n){const r=[],i=(new wS).union(t),a=e.marktype;return a?GA(e,i,n,r):"group"===a?XA(e,i,n,r):Mu("Intersect scene must be mark node or group item.")}function GA(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)XA(i[s],t,n,r);else for(const e=gE[a].isect;s<o;++s){const n=i[s];YA(n,t,e)&&r.push(n)}}return r}function XA(e,t,n,r){n&&n(e.mark)&&YA(e,t,gE.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)GA(i[e],t,n,r);t.translate(o,s)}return r}function YA(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}VA.canvas=VA.png={renderer:tA,headless:tA,handler:JE},VA.svg={renderer:$A,headless:IA,handler:rA},VA.none={};const JA=new wS;function KA(e){const t=e.clip;if(mc(t))t(WS(JA.clear()));else{if(!t)return;JA.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(JA)}function QA(e,t,n){return e===t||("path"===n?ZA(e,t):e instanceof Date&&t instanceof Date?+e==+t:Rc(e)&&Rc(t)?Math.abs(e-t)<=1e-9:e&&t&&(Uu(e)||Uu(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!QA(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function ZA(e,t){return QA(FO(e),FO(t))}const eD="top",tD="left",nD="right",rD="bottom",iD="start",aD="middle",oD="end",sD="group",lD="axis",uD="title",cD="frame",fD="scope",dD="legend",hD="row-header",pD="row-footer",mD="row-title",gD="column-header",yD="column-footer",vD="column-title",bD="padding",xD="fit",wD="fit-x",_D="fit-y",kD="none",OD="all",SD="each",$D="flush",ED="column",AD="row";function DD(e){zg.call(this,null,e)}function CD(e,t,n){return t(e.bounds.clear(),e,n)}Mc(DD,zg,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=gE[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=CD(r,o),r.items.forEach((e=>{e.bounds.clear().union(l)}));else if(i===sD||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),l.clear(),r.items.forEach((e=>l.union(CD(e,o)))),r.role){case lD:case dD:case uD:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,(e=>{l.union(CD(e,o))})),t.visit(t.MOD,(e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(CD(e,o))})),s&&(l.clear(),r.items.forEach((e=>l.union(e.bounds))));return KA(r),t.modifies("bounds")}});const MD=":vega_identifier:";function jD(e){zg.call(this,0,e)}function FD(e){zg.call(this,null,e)}function TD(e){zg.call(this,null,e)}jD.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Mc(jD,zg,{transform(e,t){const n=(i=t.dataflow)._signals[MD]||(i._signals[MD]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),Mc(FD,zg,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===sD?kS:_S;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const ND={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&RD(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},RD=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),PD=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(RD(a,n=e[r].bounds,t))return!0},zD=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},BD=e=>(e.forEach((e=>e.opacity=1)),e),ID=(e,t)=>e.reflow(t.modified()).modifies("opacity");function LD(e){zg.call(this,null,e)}Mc(TD,zg,{transform(e,t){const n=ND[e.method]||ND.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(BD(o),t=ID(t,e)),t;if(o=o.filter(zD),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=BD(o),t=ID(t,e),i.length>=3&&PD(i,r)){do{i=n(i,r)}while(i.length>=3&&PD(i,r));i.length<3&&!Xu(o).opacity&&(i.length>1&&(Xu(i).opacity=0),Xu(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new wS;return t===eD||t===rD?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((e=>{a(e)||(e.opacity=0)})));const s=i[0].mark.bounds.clear();return o.forEach((e=>{e.opacity&&s.union(e.bounds)})),t}}),Mc(LD,zg,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const qD=new wS;function UD(e,t,n){return e[t]===n?0:(e[t]=n,1)}function VD(e){var t=e.items[0].orient;return t===tD||t===nD}function WD(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=g&&sE(g),x=0,w=0;switch(qD.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(o.items[i].bounds),(i=c[1])>-1&&v.union(o.items[i].bounds),u){case eD:x=h||0,w=-d,a=Math.max(p,Math.min(m,-v.y1)),v.add(0,-a).add(f,0),g&&HD(e,g,a,y,b,0,-1,v);break;case tD:x=-d,w=h||0,a=Math.max(p,Math.min(m,-v.x1)),v.add(-a,0).add(0,f),g&&HD(e,g,a,y,b,1,-1,v);break;case nD:x=n+d,w=h||0,a=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(a,f),g&&HD(e,g,a,y,b,1,1,v);break;case rD:x=h||0,w=r+d,a=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(f,a),g&&HD(e,g,a,y,0,0,1,v);break;default:x=o.x,w=o.y}return ES(v.translate(x,w),o),UD(o,"x",x+l)|UD(o,"y",w+l)&&(o.bounds=qD,e.dirty(o),o.bounds=v,e.dirty(o)),o.mark.bounds.clear().union(v)}function HD(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const GD=(e,t)=>Math.floor(Math.min(e,t)),XD=(e,t)=>Math.ceil(Math.max(e,t));function YD(e){return(new wS).set(0,0,e.width||0,e.height||0)}function JD(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function KD(e,t,n){const r=Uu(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function QD(e){return e<0?Math.ceil(-e):0}function ZD(e,t,n){var r,i,a,o,s,l,u,c,f,d,h,p=!n.nodirty,m=n.bounds===$D?YD:JD,g=qD.set(0,0,0,0),y=KD(n.align,ED),v=KD(n.align,AD),b=KD(n.padding,ED),x=KD(n.padding,AD),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,O=Array(k),S=Array(w),$=0,E=Array(k),A=Array(_),D=0,C=Array(k),M=Array(k),j=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)A[i]=0;for(i=0;i<k;++i)l=t[i],s=j[i]=m(l),l.x=l.x||0,C[i]=0,l.y=l.y||0,M[i]=0,a=i%w,o=~~(i/w),$=Math.max($,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),A[o]=Math.max(A[o],c),O[i]=b+QD(s.x1),E[i]=x+QD(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(O[i]=0),i<w&&(E[i]=0);if(y===SD)for(a=1;a<w;++a){for(h=0,i=a;i<k;i+=w)h<O[i]&&(h=O[i]);for(i=a;i<k;i+=w)O[i]=h+S[a-1]}else if(y===OD){for(h=0,i=0;i<k;++i)i%w&&h<O[i]&&(h=O[i]);for(i=0;i<k;++i)i%w&&(O[i]=h+$)}else for(y=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)O[i]+=S[a-1];if(v===SD)for(o=1;o<_;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<E[i]&&(h=E[i]);for(i=o*w;i<r;++i)E[i]=h+A[o-1]}else if(v===OD){for(h=0,i=w;i<k;++i)h<E[i]&&(h=E[i]);for(i=w;i<k;++i)E[i]=h+D}else for(v=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)E[i]+=A[o-1];for(f=0,i=0;i<k;++i)f=O[i]+(i%w?f:0),C[i]+=f-t[i].x;for(a=0;a<w;++a)for(d=0,i=a;i<k;i+=w)d+=E[i],M[i]+=d-t[i].y;if(y&&KD(n.center,ED)&&_>1)for(i=0;i<k;++i)(f=(s=y===OD?$:S[i%w])-j[i].x2-t[i].x-C[i])>0&&(C[i]+=f/2);if(v&&KD(n.center,AD)&&1!==w)for(i=0;i<k;++i)(d=(s=v===OD?D:A[~~(i/w)])-j[i].y2-t[i].y-M[i])>0&&(M[i]+=d/2);for(i=0;i<k;++i)g.union(j[i].translate(C[i],M[i]));switch(f=KD(n.anchor,"x"),d=KD(n.anchor,"y"),KD(n.anchor,ED)){case oD:f-=g.width();break;case aD:f-=g.width()/2}switch(KD(n.anchor,AD)){case oD:d-=g.height();break;case aD:d-=g.height()/2}for(f=Math.round(f),d=Math.round(d),g.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(l=t[i]).x+=C[i]+=f,l.y+=M[i]+=d,g.union(l.mark.bounds.union(l.bounds.translate(C[i],M[i]))),p&&e.dirty(l);return g}function eC(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===sD)switch(t.role){case lD:case dD:case uD:break;case hD:o.rowheaders.push(...n);break;case pD:o.rowfooters.push(...n);break;case gD:o.colheaders.push(...n);break;case yD:o.colfooters.push(...n);break;case mD:o.rowtitle=n[0];break;case vD:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),f=c.marks,d=n.bounds===$D?tC:nC,h=n.offset,p=n.columns||f.length,m=p<=0?1:Math.ceil(f.length/p),g=m*p;const y=ZD(e,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=KD(n.headerBand,AD,null),r=rC(e,c.rowheaders,f,p,m,-KD(h,"rowHeader"),GD,0,d,"x1",0,p,1,l)),c.colheaders&&(l=KD(n.headerBand,ED,null),i=rC(e,c.colheaders,f,p,p,-KD(h,"columnHeader"),GD,1,d,"y1",0,1,p,l)),c.rowfooters&&(l=KD(n.footerBand,AD,null),a=rC(e,c.rowfooters,f,p,m,KD(h,"rowFooter"),XD,0,d,"x2",p-1,p,1,l)),c.colfooters&&(l=KD(n.footerBand,ED,null),o=rC(e,c.colfooters,f,p,p,KD(h,"columnFooter"),XD,1,d,"y2",g-p,1,p,l)),c.rowtitle&&(s=KD(n.titleAnchor,AD),u=KD(h,"rowTitle"),u=s===oD?a+u:r-u,l=KD(n.titleBand,AD,.5),iC(e,c.rowtitle,u,0,y,l)),c.coltitle&&(s=KD(n.titleAnchor,ED),u=KD(h,"columnTitle"),u=s===oD?o+u:i-u,l=KD(n.titleBand,ED,.5),iC(e,c.coltitle,u,1,y,l))}function tC(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function nC(e,t){return e.bounds[t]}function rC(e,t,n,r,i,a,o,s,l,u,c,f,d,h){var p,m,g,y,v,b,x,w,_,k=n.length,O=0,S=0;if(!k)return O;for(p=c;p<k;p+=f)n[p]&&(O=o(O,l(n[p],u)));if(!t.length)return O;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),O+=a,m=0,y=t.length;m<y;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,y=t.length;m<y;++m,p+=f){for(v=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=d);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),_=O):(w=O,_=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,v[u])}return S}function iC(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function aC(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",iD),c=u===oD?1:u===aD?.5:0,f={align:SD,bounds:s("bounds",$D),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case tD:f.anchor={x:Math.floor(r.x1)-l,column:oD,y:c*(o||r.height()+2*r.y1),row:u};break;case nD:f.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case eD:f.anchor={y:Math.floor(i.y1)-l,row:oD,x:c*(a||i.width()+2*i.x1),column:u};break;case rD:f.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":f.anchor={x:l,y:l};break;case"top-right":f.anchor={x:a-l,y:l,column:oD};break;case"bottom-left":f.anchor={x:l,y:o-l,row:oD};break;case"bottom-right":f.anchor={x:a-l,y:o-l,column:oD,row:oD}}return f}function oC(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case tD:i+=Math.ceil(o.bounds.width())+l;break;case nD:case rD:break;default:a+=o.bounds.height()+l}switch((i||a)&&lC(e,n,i,a),o.orient){case tD:c+=sC(t,n,o,s,1,1);break;case nD:u+=sC(t,n,o,oD,0,0)+l,c+=sC(t,n,o,s,1,1);break;case rD:u+=sC(t,n,o,s,0,0),c+=sC(t,n,o,oD,-1,0,1)+l;break;default:u+=sC(t,n,o,s,0,0)}(u||c)&&lC(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(lC(e,n,-u,0),lC(e,o,-u,0))}else(i||a)&&lC(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==kD&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,ES(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function sC(e,t,n,r,i,a,o){const s="symbol"!==e.datum.type,l=n.datum.vgrad,u=(!s||!a&&l||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,c=l&&a?u:0,f=l&&a?0:u,d=i<=0?0:sE(n);return Math.round(r===iD?c:r===oD?f-d:.5*(u-d))}function lC(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function uC(e){zg.call(this,null,e)}Mc(uC,zg,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&eC(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),f=(new wS).set(0,0,u,c),d=f.clone(),h=f.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case lD:(VD(i)?d:h).union(WD(e,i,u,c));break;case uD:r=i;break;case dD:p.push(oC(e,i));break;case cD:case fD:case hD:case pD:case mD:case gD:case yD:case vD:d.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const t={};p.forEach((e=>{(a=e.orient||nD)!==kD&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];ZD(e,i,aC(i,r,n.legends,d,h,u,c))}p.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&n.autosize.type===xD)switch(t.orient){case tD:case nD:f.add(r.x1,0).add(r.x2,0);break;case eD:case rD:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(d).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,l=o.orient,u=o.anchor,c=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=l===tD||l===nD?r:n,m=0,g=0,y=0,v=0,b=0;if(s!==sD?l===tD?(m=i.y2,p=i.y1):l===nD?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):l===tD&&(m=r,p=0),a=u===iD?m:u===oD?p:(m+p)/2,h&&h.text){switch(l){case eD:case rD:b=d.bounds.height()+f;break;case tD:v=d.bounds.width()+f;break;case nD:v=-d.bounds.width()-f}qD.clear().union(h.bounds),qD.translate(v-(h.x||0),b-(h.y||0)),UD(h,"x",v)|UD(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(qD),h.mark.bounds.clear().union(qD),e.dirty(h)),qD.clear().union(h.bounds)}else qD.clear();switch(qD.union(d.bounds),l){case eD:g=a,y=i.y1-qD.height()-c;break;case tD:g=i.x1-qD.width()-c,y=a;break;case nD:g=i.x2+qD.width()+c,y=a;break;case rD:g=a,y=i.y2+c;break;default:g=o.x,y=o.y}return UD(o,"x",g)|UD(o,"y",y)&&(qD.translate(g,y),e.dirty(o),o.bounds.clear().union(qD),t.bounds.clear().union(qD),e.dirty(o)),o.bounds}(e,r,u,c,f));t.clip&&f.set(0,0,t.width||0,t.height||0);!function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,Math.ceil(n.y2-c));if(i.contains===bD){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===kD?(u=0,f=0,l=o,c=s):a===xD?(l=Math.max(0,o-u-d),c=Math.max(0,s-f-h)):a===wD?(l=Math.max(0,o-u-d),s=c+f+h):a===_D?(o=l+u+d,c=Math.max(0,s-f-h)):"pad"===a&&(o=l+u+d,s=c+f+h);e._resizeView(o,s,l,c,[u,f],i.resize)}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}});var cC=Object.freeze({__proto__:null,bound:DD,identifier:jD,mark:FD,overlap:TD,render:LD,viewlayout:uC});function fC(e){zg.call(this,null,e)}function dC(e){zg.call(this,null,e)}function hC(){return sg({})}function pC(e){zg.call(this,null,e)}function mC(e){zg.call(this,[],e)}Mc(fC,zg,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=sO(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||cO(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?lO(a,e.values,o):uO(a,o);return i&&(r.rem=i),i=l.map(((e,t)=>sg({index:t/(l.length-1||1),value:e,label:s(e)}))),e.extra&&i.length&&i.push(sg({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Mc(dC,zg,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||hC,a=e.key||ag,o=this.value;return qu(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&Mu("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=Dc().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),Mc(pC,zg,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(qu(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||Bu,l=i.enter||Bu,u=i.exit||Bu,c=(a&&!o?i[a]:s)||Bu;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{l(t,e),s(t,e)})),n.modifies(l.output),n.modifies(s.output),c!==Bu&&c!==s&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&u!==Bu&&(t.visit(t.REM,(t=>{u(t,e)})),n.modifies(u.output)),o||c!==Bu){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,(t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)):t.visit(i,(t=>{(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),Mc(mC,zg,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||rO,f=e.scale,d=+e.limit,h=sO(f,null==e.count?5:e.count,e.minstep),p=!!e.values||c===rO,m=e.format||mO(s,f,h,c,e.formatSpecifier,e.formatType,p),g=e.values||pO(f,h);return u&&(l.rem=u),c===rO?(d&&g.length>d?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,d-1),o=!0):u=g,mc(i=e.size)?(e.values||0!==f(u[0])||(u=u.slice(1)),a=u.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=wc(a=i||8),u=u.map(((t,n)=>sg({index:n,label:m(t,n,u),value:t,offset:a,size:i(t,e)}))),o&&(o=g[u.length],u.push(sg({index:u.length,label:"…".concat(g.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=f.domain(),r=Kk(f,n[0],Xu(n)),g.length<3&&!e.values&&n[0]!==Xu(n)&&(g=[n[0],Xu(n)]),u=g.map(((e,t)=>sg({index:t,label:m(e,t,g),value:e,perc:r(e)})))):(i=g.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Xu(t),a=i-r;if(e.type===wk){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(f),u=g.map(((e,t)=>sg({index:t,label:m(e,t,g),value:e,perc:t?r(e):0,perc2:t===i?1:r(g[t+1])})))),l.source=u,l.add=u,this.value=u,l}});const gC=e=>e.source.x,yC=e=>e.source.y,vC=e=>e.target.x,bC=e=>e.target.y;function xC(e){zg.call(this,{},e)}xC.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Mc(xC,zg,{transform(e,t){var n=e.sourceX||gC,r=e.sourceY||yC,i=e.targetX||vC,a=e.targetY||bC,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=OC.get(l+"-"+s)||OC.get(l);return u||Mu("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[o]=u(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});const wC=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,_C=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},kC=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},OC=Dc({line:wC,"line-radial":(e,t,n,r)=>wC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:_C,"arc-radial":(e,t,n,r)=>_C(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:kC,"curve-radial":(e,t,n,r)=>kC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function SC(e){zg.call(this,null,e)}SC.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Mc(SC,zg,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.field||Pu,u=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(l),h=d.length,p=u,m=(c-u)/ud(d),g=ld(h);for(e.sort&&g.sort(((e,t)=>d[e]-d[t])),n=0;n<h;++n)i=d[g[n]],(r=f[g[n]])[o]=p,r[s]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)}});function $C(e){return Lk(e)&&e!==yk}const EC=Kc(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function AC(e){zg.call(this,null,e),this.modified(!0)}function DC(e,t,n){Vk(e)&&(Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+Hc(t)));return t}function CC(e,t,n){return mc(e)&&(t||n)?Xk(e,MC(t||[0,1],n)):e}function MC(e,t){return t?e.slice().reverse():e}function jC(e){zg.call(this,null,e)}Mc(AC,zg,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";if(n===yk)return"sequential-linear";(function(e){const t=e.type;return Lk(t)&&t!==mk&&t!==gk&&(e.scheme||e.range&&e.range.length&&e.range.every(zc))})(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":"");return(r+n||ck).toLowerCase()}(e);for(i in r&&i===r.type||(this.value=r=zk(i)()),e)if(!EC[i]){if("padding"===i&&$C(r.type))continue;mc(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==Ok&&e!==kk&&Mu("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===kk?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*uk(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;qu(t.scheme)?r=Yk(t.scheme,t.interpolate,t.interpolateGamma):(r=nO(t.scheme.toLowerCase()))||Mu("Unrecognized scheme name: ".concat(t.scheme));return n=e===wk?n+1:e===Sk?n-1:e===bk||e===xk?+t.schemeCount||5:n,Wk(e)?CC(r,i,t.reverse):mc(r)?Jk(CC(r,i),n):e===_k?r:r.slice(0,n)}(r,t,n),mc(a))){if(e.interpolator)return e.interpolator(a);Mu("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&Wk(r))return e.interpolator(Yk(MC(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Qk(t.interpolate,t.interpolateGamma)):mc(e.round)?e.round(i):mc(e.rangeRound)&&e.interpolate(i?e_:Zw);a&&e.range(MC(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!qu(r)){const t=e.domain(),n=t[0],i=Xu(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||Mu("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=ld(o,s+a/2,a)}r?e.bins=r:e.bins&&delete e.bins;e.type===Sk&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain());return n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(DC(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===ck||t===dk||t===hk)}(e);if(!o)return 0;$C(s)&&t.padding&&o[0]!==Xu(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(Xu(n)-n[0]),s=o/(o-2*r),l=e===fk?lc(t,null,s):e===hk?uc(t,null,s,.5):e===dk?uc(t,null,s,i||1):e===pk?cc(t,null,s,a||1):sc(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant));if((l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}e.domain(DC(s,o,n)),s===_k&&e.unknown(t.domainImplicit?kx:void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&sO(e,t.nice)||null);return o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Mc(jC,zg,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(fg(e.sort)),this.modified(n),t}});const FC="zero",TC="center",NC="normalize",RC=["y0","y1"];function PC(e){zg.call(this,null,e)}function zC(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function BC(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function IC(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}PC.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:FC,values:[FC,TC,NC]},{name:"as",type:"string",array:!0,length:2,default:RC}]},Mc(PC,zg,{transform(e,t){var n,r,i,a,o=e.as||RC,s=o[0],l=o[1],u=fg(e.sort),c=e.field||Pu,f=e.offset===TC?zC:e.offset===NC?BC:IC;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,f,d,h=[],p=e=>e(l);if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],h.push(c)),c.push(l);for(u=0,d=0,s=h.length;u<s;++u){for(a=0,f=0,o=(c=h[u]).length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,f>d&&(d=f),n&&c.sort(n)}return h.max=d,h}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var LC=Object.freeze({__proto__:null,axisticks:fC,datajoin:dC,encode:pC,legendentries:mC,linkpath:xC,pie:SC,scale:AC,sortitems:jC,stack:PC}),qC=1e-6,UC=1e-12,VC=Math.PI,WC=VC/2,HC=VC/4,GC=2*VC,XC=180/VC,YC=VC/180,JC=Math.abs,KC=Math.atan,QC=Math.atan2,ZC=Math.cos,eM=Math.ceil,tM=Math.exp,nM=Math.hypot,rM=Math.log,iM=Math.pow,aM=Math.sin,oM=Math.sign||function(e){return e>0?1:e<0?-1:0},sM=Math.sqrt,lM=Math.tan;function uM(e){return e>1?0:e<-1?VC:Math.acos(e)}function cM(e){return e>1?WC:e<-1?-WC:Math.asin(e)}function fM(){}function dM(e,t){e&&pM.hasOwnProperty(e.type)&&pM[e.type](e,t)}var hM={Feature:function(e,t){dM(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)dM(n[r].geometry,t)}},pM={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){mM(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)mM(n[r],t,0)},Polygon:function(e,t){gM(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)gM(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)dM(n[r],t)}};function mM(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function gM(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)mM(e[n],t,1);t.polygonEnd()}function yM(e,t){e&&hM.hasOwnProperty(e.type)?hM[e.type](e,t):dM(e,t)}var vM,bM,xM,wM,_M,kM,OM,SM,$M,EM,AM,DM,CM,MM,jM,FM,TM=new Gf,NM=new Gf,RM={point:fM,lineStart:fM,lineEnd:fM,polygonStart:function(){TM=new Gf,RM.lineStart=PM,RM.lineEnd=zM},polygonEnd:function(){var e=+TM;NM.add(e<0?GC+e:e),this.lineStart=this.lineEnd=this.point=fM},sphere:function(){NM.add(GC)}};function PM(){RM.point=BM}function zM(){IM(vM,bM)}function BM(e,t){RM.point=IM,vM=e,bM=t,xM=e*=YC,wM=ZC(t=(t*=YC)/2+HC),_M=aM(t)}function IM(e,t){var n=(e*=YC)-xM,r=n>=0?1:-1,i=r*n,a=ZC(t=(t*=YC)/2+HC),o=aM(t),s=_M*o,l=wM*a+s*ZC(i),u=s*r*aM(i);TM.add(QC(u,l)),xM=e,wM=a,_M=o}function LM(e){return[QC(e[1],e[0]),cM(e[2])]}function qM(e){var t=e[0],n=e[1],r=ZC(n);return[r*ZC(t),r*aM(t),aM(n)]}function UM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function VM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function WM(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function HM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function GM(e){var t=sM(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var XM,YM,JM,KM,QM,ZM,ej,tj,nj,rj,ij,aj,oj,sj,lj,uj,cj={point:fj,lineStart:hj,lineEnd:pj,polygonStart:function(){cj.point=mj,cj.lineStart=gj,cj.lineEnd=yj,MM=new Gf,RM.polygonStart()},polygonEnd:function(){RM.polygonEnd(),cj.point=fj,cj.lineStart=hj,cj.lineEnd=pj,TM<0?(kM=-(SM=180),OM=-($M=90)):MM>qC?$M=90:MM<-1e-6&&(OM=-90),FM[0]=kM,FM[1]=SM},sphere:function(){kM=-(SM=180),OM=-($M=90)}};function fj(e,t){jM.push(FM=[kM=e,SM=e]),t<OM&&(OM=t),t>$M&&($M=t)}function dj(e,t){var n=qM([e*YC,t*YC]);if(CM){var r=VM(CM,n),i=VM([r[1],-r[0],0],r);GM(i),i=LM(i);var a,o=e-EM,s=o>0?1:-1,l=i[0]*XC*s,u=JC(o)>180;u^(s*EM<l&&l<s*e)?(a=i[1]*XC)>$M&&($M=a):u^(s*EM<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*XC)<OM&&(OM=a):(t<OM&&(OM=t),t>$M&&($M=t)),u?e<EM?vj(kM,e)>vj(kM,SM)&&(SM=e):vj(e,SM)>vj(kM,SM)&&(kM=e):SM>=kM?(e<kM&&(kM=e),e>SM&&(SM=e)):e>EM?vj(kM,e)>vj(kM,SM)&&(SM=e):vj(e,SM)>vj(kM,SM)&&(kM=e)}else jM.push(FM=[kM=e,SM=e]);t<OM&&(OM=t),t>$M&&($M=t),CM=n,EM=e}function hj(){cj.point=dj}function pj(){FM[0]=kM,FM[1]=SM,cj.point=fj,CM=null}function mj(e,t){if(CM){var n=e-EM;MM.add(JC(n)>180?n+(n>0?360:-360):n)}else AM=e,DM=t;RM.point(e,t),dj(e,t)}function gj(){RM.lineStart()}function yj(){mj(AM,DM),RM.lineEnd(),JC(MM)>qC&&(kM=-(SM=180)),FM[0]=kM,FM[1]=SM,CM=null}function vj(e,t){return(t-=e)<0?t+360:t}function bj(e,t){return e[0]-t[0]}function xj(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var wj={sphere:fM,point:_j,lineStart:Oj,lineEnd:Ej,polygonStart:function(){wj.lineStart=Aj,wj.lineEnd=Dj},polygonEnd:function(){wj.lineStart=Oj,wj.lineEnd=Ej}};function _j(e,t){e*=YC;var n=ZC(t*=YC);kj(n*ZC(e),n*aM(e),aM(t))}function kj(e,t,n){++XM,JM+=(e-JM)/XM,KM+=(t-KM)/XM,QM+=(n-QM)/XM}function Oj(){wj.point=Sj}function Sj(e,t){e*=YC;var n=ZC(t*=YC);sj=n*ZC(e),lj=n*aM(e),uj=aM(t),wj.point=$j,kj(sj,lj,uj)}function $j(e,t){e*=YC;var n=ZC(t*=YC),r=n*ZC(e),i=n*aM(e),a=aM(t),o=QC(sM((o=lj*a-uj*i)*o+(o=uj*r-sj*a)*o+(o=sj*i-lj*r)*o),sj*r+lj*i+uj*a);YM+=o,ZM+=o*(sj+(sj=r)),ej+=o*(lj+(lj=i)),tj+=o*(uj+(uj=a)),kj(sj,lj,uj)}function Ej(){wj.point=_j}function Aj(){wj.point=Cj}function Dj(){Mj(aj,oj),wj.point=_j}function Cj(e,t){aj=e,oj=t,e*=YC,t*=YC,wj.point=Mj;var n=ZC(t);sj=n*ZC(e),lj=n*aM(e),uj=aM(t),kj(sj,lj,uj)}function Mj(e,t){e*=YC;var n=ZC(t*=YC),r=n*ZC(e),i=n*aM(e),a=aM(t),o=lj*a-uj*i,s=uj*r-sj*a,l=sj*i-lj*r,u=nM(o,s,l),c=cM(u),f=u&&-c/u;nj.add(f*o),rj.add(f*s),ij.add(f*l),YM+=c,ZM+=c*(sj+(sj=r)),ej+=c*(lj+(lj=i)),tj+=c*(uj+(uj=a)),kj(sj,lj,uj)}function jj(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Fj(e,t){return[JC(e)>VC?e+Math.round(-e/GC)*GC:e,t]}function Tj(e,t,n){return(e%=GC)?t||n?jj(Rj(e),Pj(t,n)):Rj(e):t||n?Pj(t,n):Fj}function Nj(e){return function(t,n){return[(t+=e)>VC?t-GC:t<-VC?t+GC:t,n]}}function Rj(e){var t=Nj(e);return t.invert=Nj(-e),t}function Pj(e,t){var n=ZC(e),r=aM(e),i=ZC(t),a=aM(t);function o(e,t){var o=ZC(t),s=ZC(e)*o,l=aM(e)*o,u=aM(t),c=u*n+s*r;return[QC(l*i-c*a,s*n-u*r),cM(c*i+l*a)]}return o.invert=function(e,t){var o=ZC(t),s=ZC(e)*o,l=aM(e)*o,u=aM(t),c=u*i-l*a;return[QC(l*i+u*a,s*n+c*r),cM(c*n-s*r)]},o}function zj(e,t){(t=qM(t))[0]-=e,GM(t);var n=uM(-t[1]);return((-t[2]<0?-n:n)+GC-qC)%GC}function Bj(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:fM,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Ij(e,t){return JC(e[0]-t[0])<qC&&JC(e[1]-t[1])<qC}function Lj(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function qj(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(Ij(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new Lj(r,e,null,!0)),l.push(n.o=new Lj(r,null,n,!1)),s.push(n=new Lj(o,e,null,!1)),l.push(n.o=new Lj(o,null,n,!0))}})),s.length){for(l.sort(t),Uj(s),Uj(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,f=s[0];;){for(var d=f,h=!0;d.v;)if((d=d.n)===f)return;u=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(u=d.p.z,a=u.length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}u=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}}function Uj(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Vj(e){return JC(e[0])<=VC?e[0]:oM(e[0])*((JC(e[0])+VC)%GC-VC)}function Wj(e,t,n,r){return function(i){var a,o,s,l=t(i),u=Bj(),c=t(u),f=!1,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,o=[],a=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,o=sd(o);var e=function(e,t){var n=Vj(t),r=t[1],i=aM(r),a=[aM(n),-ZC(n),0],o=0,s=0,l=new Gf;1===i?r=WC+qC:-1===i&&(r=-WC-qC);for(var u=0,c=e.length;u<c;++u)if(d=(f=e[u]).length)for(var f,d,h=f[d-1],p=Vj(h),m=h[1]/2+HC,g=aM(m),y=ZC(m),v=0;v<d;++v,p=x,g=_,y=k,h=b){var b=f[v],x=Vj(b),w=b[1]/2+HC,_=aM(w),k=ZC(w),O=x-p,S=O>=0?1:-1,$=S*O,E=$>VC,A=g*_;if(l.add(QC(A*S*aM($),y*k+A*ZC($))),o+=E?O+S*GC:O,E^p>=n^x>=n){var D=VM(qM(h),qM(b));GM(D);var C=VM(a,D);GM(C);var M=(E^O>=0?-1:1)*cM(C[2]);(r>M||r===M&&(D[0]||D[1]))&&(s+=E^O>=0?1:-1)}}return(o<-1e-6||o<qC&&l<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),qj(o,Gj,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){d.point=p,l.lineStart()}function g(){d.point=h,l.lineEnd()}function y(e,t){s.push([e,t]),c.point(e,t)}function v(){c.lineStart(),s=[]}function b(){y(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),d=u.result(),h=d.length;if(s.pop(),a.push(s),s=null,h)if(1&l){if((t=(n=d[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(Hj))}return d}}function Hj(e){return e.length>1}function Gj(e,t){return((e=e.x)[0]<0?e[1]-WC-qC:WC-e[1])-((t=t.x)[0]<0?t[1]-WC-qC:WC-t[1])}Fj.invert=Fj;var Xj=Wj((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?VC:-VC,l=JC(a-n);JC(l-VC)<qC?(e.point(n,r=(r+o)/2>0?WC:-WC),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=VC&&(JC(n-i)<qC&&(n-=i*qC),JC(a-s)<qC&&(a-=s*qC),r=function(e,t,n,r){var i,a,o=aM(e-n);return JC(o)>qC?KC((aM(t)*(a=ZC(r))*aM(n)-aM(r)*(i=ZC(t))*aM(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*WC,r.point(-VC,i),r.point(0,i),r.point(VC,i),r.point(VC,0),r.point(VC,-i),r.point(0,-i),r.point(-VC,-i),r.point(-VC,0),r.point(-VC,i);else if(JC(e[0]-t[0])>qC){var a=e[0]<t[0]?VC:-VC;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-VC,-WC]);function Yj(e){var t=ZC(e),n=6*YC,r=t>0,i=JC(t)>qC;function a(e,n){return ZC(e)*ZC(n)>t}function o(e,n,r){var i=[1,0,0],a=VM(qM(e),qM(n)),o=UM(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,f=VM(i,a),d=HM(i,u);WM(d,HM(a,c));var h=f,p=UM(d,h),m=UM(h,h),g=p*p-m*(UM(d,d)-1);if(!(g<0)){var y=sM(g),v=HM(h,(-p-y)/m);if(WM(v,d),v=LM(v),!r)return v;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var O=w-x,S=JC(O-VC)<qC;if(!S&&k<_&&(b=_,_=k,k=b),S||O<qC?S?_+k>0^v[1]<(JC(v[0]-x)<qC?_:k):_<=v[1]&&v[1]<=k:O>VC^(x<=v[0]&&v[0]<=w)){var $=HM(h,(-p+y)/m);return WM($,d),[v,LM($)]}}}function s(t,n){var i=r?e:VC-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Wj(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(f,d){var h,p=[f,d],m=a(f,d),g=r?m?0:s(f,d):m?s(f+(f<0?VC:-VC),d):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(h=o(t,p))||Ij(t,h)||Ij(p,h))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),h=o(p,t),e.point(h[0],h[1])):(h=o(t,p),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var y;g&n||!(y=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!m||t&&Ij(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=ZC(t),s=aM(t),l=r*n;null==i?(i=t+r*GC,a=t-l/2):(i=zj(o,i),a=zj(o,a),(r>0?i<a:i>a)&&(i+=r*GC));for(var u,c=i;r>0?c>a:c<a;c-=l)u=LM([o,-s*ZC(c),-s*aM(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-VC,e-VC])}var Jj=1e9,Kj=-Jj;function Qj(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,f=0;if(null==i||(c=o(i,s))!==(f=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==f);else u.point(a[0],a[1])}function o(r,i){return JC(r[0]-e)<qC?i>0?0:3:JC(r[0]-n)<qC?i>0?2:1:JC(r[1]-t)<qC?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,f,d,h,p,m,g,y,v,b=o,x=Bj(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]);y=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(k(f,d),h&&g&&x.rejoin(),l.push(x.result()));w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,f=s[0],d=f[0],h=f[1];l<c;++l)a=d,o=h,d=(f=s[l])[0],h=f[1],o<=r?h>r&&(d-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(d-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=v&&t,i=(l=sd(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&qj(l,s,t,a,o),o.polygonEnd());b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(u&&c.push([a,o]),y)f=a,d=o,h=s,y=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(Kj,Math.min(Jj,p)),m=Math.max(Kj,Math.min(Jj,m))],x=[a=Math.max(Kj,Math.min(Jj,a)),o=Math.max(Kj,Math.min(Jj,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,f=t[0]-s,d=t[1]-l;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<u)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>u&&(u=o)}else if(f>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*f,e[1]=l+u*d),c<1&&(t[0]=s+c*f,t[1]=l+c*d),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),v=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),v=!1)}p=a,m=o,g=s}return w}}function Zj(e,t,n){var r=ld(e,t-qC,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function eF(e,t,n){var r=ld(e,t-qC,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var tF,nF,rF,iF,aF=e=>e,oF=new Gf,sF=new Gf,lF={point:fM,lineStart:fM,lineEnd:fM,polygonStart:function(){lF.lineStart=uF,lF.lineEnd=dF},polygonEnd:function(){lF.lineStart=lF.lineEnd=lF.point=fM,oF.add(JC(sF)),sF=new Gf},result:function(){var e=oF/2;return oF=new Gf,e}};function uF(){lF.point=cF}function cF(e,t){lF.point=fF,tF=rF=e,nF=iF=t}function fF(e,t){sF.add(iF*e-rF*t),rF=e,iF=t}function dF(){fF(tF,nF)}var hF=1/0,pF=hF,mF=-hF,gF=mF,yF={point:function(e,t){e<hF&&(hF=e);e>mF&&(mF=e);t<pF&&(pF=t);t>gF&&(gF=t)},lineStart:fM,lineEnd:fM,polygonStart:fM,polygonEnd:fM,result:function(){var e=[[hF,pF],[mF,gF]];return mF=gF=-(pF=hF=1/0),e}};var vF,bF,xF,wF,_F=0,kF=0,OF=0,SF=0,$F=0,EF=0,AF=0,DF=0,CF=0,MF={point:jF,lineStart:FF,lineEnd:RF,polygonStart:function(){MF.lineStart=PF,MF.lineEnd=zF},polygonEnd:function(){MF.point=jF,MF.lineStart=FF,MF.lineEnd=RF},result:function(){var e=CF?[AF/CF,DF/CF]:EF?[SF/EF,$F/EF]:OF?[_F/OF,kF/OF]:[NaN,NaN];return _F=kF=OF=SF=$F=EF=AF=DF=CF=0,e}};function jF(e,t){_F+=e,kF+=t,++OF}function FF(){MF.point=TF}function TF(e,t){MF.point=NF,jF(xF=e,wF=t)}function NF(e,t){var n=e-xF,r=t-wF,i=sM(n*n+r*r);SF+=i*(xF+e)/2,$F+=i*(wF+t)/2,EF+=i,jF(xF=e,wF=t)}function RF(){MF.point=jF}function PF(){MF.point=BF}function zF(){IF(vF,bF)}function BF(e,t){MF.point=IF,jF(vF=xF=e,bF=wF=t)}function IF(e,t){var n=e-xF,r=t-wF,i=sM(n*n+r*r);SF+=i*(xF+e)/2,$F+=i*(wF+t)/2,EF+=i,AF+=(i=wF*e-xF*t)*(xF+e),DF+=i*(wF+t),CF+=3*i,jF(xF=e,wF=t)}function LF(e){this._context=e}LF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,GC)}},result:fM};var qF,UF,VF,WF,HF,GF=new Gf,XF={point:fM,lineStart:function(){XF.point=YF},lineEnd:function(){qF&&JF(UF,VF),XF.point=fM},polygonStart:function(){qF=!0},polygonEnd:function(){qF=null},result:function(){var e=+GF;return GF=new Gf,e}};function YF(e,t){XF.point=JF,UF=WF=e,VF=HF=t}function JF(e,t){WF-=e,HF-=t,GF.add(sM(WF*WF+HF*HF)),WF=e,HF=t}function KF(){this._string=[]}function QF(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function ZF(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),yM(e,n(r))),r.result()}return a.area=function(e){return yM(e,n(lF)),lF.result()},a.measure=function(e){return yM(e,n(XF)),XF.result()},a.bounds=function(e){return yM(e,n(yF)),yF.result()},a.centroid=function(e){return yM(e,n(MF)),MF.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,aF):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new KF):new LF(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function eT(e){return function(t){var n=new tT;for(var r in e)n[r]=e[r];return n.stream=t,n}}function tT(){}function nT(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),yM(n,e.stream(yF)),t(yF.result()),null!=r&&e.clipExtent(r),e}function rT(e,t,n){return nT(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function iT(e,t,n){return rT(e,[[0,0],t],n)}function aT(e,t,n){return nT(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function oT(e,t,n){return nT(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}KF.prototype={_radius:4.5,_circle:QF(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=QF(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}},tT.prototype={constructor:tT,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var sT=ZC(30*YC);function lT(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var x=o+d,w=s+h,_=l+p,k=sM(x*x+w*w+_*_),O=cM(_/=k),S=JC(JC(_)-1)<qC||JC(a-f)<qC?(a+f)/2:QC(w,x),$=e(S,O),E=$[0],A=$[1],D=E-r,C=A-i,M=v*D-y*C;(M*M/b>t||JC((y*D+v*C)/b-.5)>.3||o*d+s*h+l*p<sT)&&(n(r,i,a,o,s,l,E,A,S,x/=k,w/=k,_,m,g),g.point(E,A),n(E,A,S,x,w,_,u,c,f,d,h,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,f,d,h,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){c=NaN,m.point=v,t.lineStart()}function v(r,i){var a=qM([r,i]),o=e(r,i);n(c,f,u,d,h,p,c=o[0],f=o[1],u=r,d=a[0],h=a[1],p=a[2],16,t),t.point(c,f)}function b(){m.point=g,t.lineEnd()}function x(){y(),m.point=w,m.lineEnd=_}function w(e,t){v(r=e,t),i=c,a=f,o=d,s=h,l=p,m.point=v}function _(){n(c,f,u,d,h,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return eT({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var uT=eT({point:function(e,t){this.stream.point(e*YC,t*YC)}});function cT(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=ZC(a),s=aM(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-f*t+d),i*(h-f*e-c*t)]},p}function fT(e){return dT((function(){return e}))()}function dT(e){var t,n,r,i,a,o,s,l,u,c,f=150,d=480,h=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,w=1,_=null,k=Xj,O=null,S=aF,$=.5;function E(e){return l(e[0]*YC,e[1]*YC)}function A(e){return(e=l.invert(e[0],e[1]))&&[e[0]*XC,e[1]*XC]}function D(){var e=cT(f,0,0,x,w,b).apply(null,t(p,m)),r=cT(f,d-e[0],h-e[1],x,w,b);return n=Tj(g,y,v),s=jj(t,r),l=jj(n,s),o=lT(s,$),C()}function C(){return u=c=null,E}return E.stream=function(e){return u&&c===e?u:u=uT(function(e){return eT({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(c=e)))))},E.preclip=function(e){return arguments.length?(k=e,_=void 0,C()):k},E.postclip=function(e){return arguments.length?(S=e,O=r=i=a=null,C()):S},E.clipAngle=function(e){return arguments.length?(k=+e?Yj(_=e*YC):(_=null,Xj),C()):_*XC},E.clipExtent=function(e){return arguments.length?(S=null==e?(O=r=i=a=null,aF):Qj(O=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),C()):null==O?null:[[O,r],[i,a]]},E.scale=function(e){return arguments.length?(f=+e,D()):f},E.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],D()):[d,h]},E.center=function(e){return arguments.length?(p=e[0]%360*YC,m=e[1]%360*YC,D()):[p*XC,m*XC]},E.rotate=function(e){return arguments.length?(g=e[0]%360*YC,y=e[1]%360*YC,v=e.length>2?e[2]%360*YC:0,D()):[g*XC,y*XC,v*XC]},E.angle=function(e){return arguments.length?(b=e%360*YC,D()):b*XC},E.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},E.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},E.precision=function(e){return arguments.length?(o=lT(s,$=e*e),C()):sM($)},E.fitExtent=function(e,t){return rT(E,e,t)},E.fitSize=function(e,t){return iT(E,e,t)},E.fitWidth=function(e,t){return aT(E,e,t)},E.fitHeight=function(e,t){return oT(E,e,t)},function(){return t=e.apply(this,arguments),E.invert=t.invert&&A,D()}}function hT(e){var t=0,n=VC/3,r=dT(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*YC,n=e[1]*YC):[t*XC,n*XC]},i}function pT(e,t){var n=aM(e),r=(n+aM(t))/2;if(JC(r)<qC)return function(e){var t=ZC(e);function n(e,n){return[e*t,aM(n)/t]}return n.invert=function(e,n){return[e/t,cM(n*t)]},n}(e);var i=1+n*(2*r-n),a=sM(i)/r;function o(e,t){var n=sM(i-2*r*aM(t))/r;return[n*aM(e*=r),a-n*ZC(e)]}return o.invert=function(e,t){var n=a-t,o=QC(e,JC(n))*oM(n);return n*r<0&&(o-=VC*oM(e)*oM(n)),[o/r,cM((i-(e*e+n*n)*r*r)/(2*r))]},o}function mT(){return hT(pT).scale(155.424).center([0,33.6442])}function gT(){return mT().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function yT(e){return function(t,n){var r=ZC(t),i=ZC(n),a=e(r*i);return a===1/0?[2,0]:[a*i*aM(t),a*aM(n)]}}function vT(e){return function(t,n){var r=sM(t*t+n*n),i=e(r),a=aM(i),o=ZC(i);return[QC(t*a,r*o),cM(r&&n*a/r)]}}var bT=yT((function(e){return sM(2/(1+e))}));bT.invert=vT((function(e){return 2*cM(e/2)}));var xT=yT((function(e){return(e=uM(e))&&e/aM(e)}));function wT(e,t){return[e,rM(lM((WC+t)/2))]}function _T(e){var t,n,r,i=fT(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=VC*o(),s=i(function(e){function t(t){return(t=e(t[0]*YC,t[1]*YC))[0]*=XC,t[1]*=XC,t}return e=Tj(e[0]*YC,e[1]*YC,e.length>2?e[2]*YC:0),t.invert=function(t){return(t=e.invert(t[0]*YC,t[1]*YC))[0]*=XC,t[1]*=XC,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===wT?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function kT(e){return lM((WC+e)/2)}function OT(e,t){var n=ZC(e),r=e===t?aM(e):rM(n/ZC(t))/rM(kT(t)/kT(e)),i=n*iM(kT(e),r)/r;if(!r)return wT;function a(e,t){i>0?t<-WC+qC&&(t=-WC+qC):t>WC-qC&&(t=WC-qC);var n=i/iM(kT(t),r);return[n*aM(r*e),i-n*ZC(r*e)]}return a.invert=function(e,t){var n=i-t,a=oM(r)*sM(e*e+n*n),o=QC(e,JC(n))*oM(n);return n*r<0&&(o-=VC*oM(e)*oM(n)),[o/r,2*KC(iM(i/a,1/r))-WC]},a}function ST(e,t){return[e,t]}function $T(e,t){var n=ZC(e),r=e===t?aM(e):(n-ZC(t))/(t-e),i=n/r+e;if(JC(r)<qC)return ST;function a(e,t){var n=i-t,a=r*e;return[n*aM(a),i-n*ZC(a)]}return a.invert=function(e,t){var n=i-t,a=QC(e,JC(n))*oM(n);return n*r<0&&(a-=VC*oM(e)*oM(n)),[a/r,i-oM(r)*sM(e*e+n*n)]},a}xT.invert=vT((function(e){return e})),wT.invert=function(e,t){return[e,2*KC(tM(t))-WC]},ST.invert=ST;var ET=1.340264,AT=-.081106,DT=893e-6,CT=.003796,MT=sM(3)/2;function jT(e,t){var n=cM(MT*aM(t)),r=n*n,i=r*r*r;return[e*ZC(n)/(MT*(ET+3*AT*r+i*(7*DT+9*CT*r))),n*(ET+AT*r+i*(DT+CT*r))]}function FT(e,t){var n=ZC(t),r=ZC(e)*n;return[n*aM(e)/r,aM(t)/r]}function TT(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function NT(e,t){return[ZC(t)*aM(e),aM(t)]}function RT(e,t){var n=ZC(t),r=1+ZC(e)*n;return[n*aM(e)/r,aM(t)/r]}function PT(e,t){return[rM(lM((WC+t)/2)),-e]}jT.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(ET+AT*i+a*(DT+CT*i))-t)/(ET+3*AT*i+a*(7*DT+9*CT*i)))*r)*i*i,!(JC(n)<UC));++o);return[MT*e*(ET+3*AT*i+a*(7*DT+9*CT*i))/ZC(r),cM(aM(r)/MT)]},FT.invert=vT(KC),TT.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(JC(n)>qC&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},NT.invert=vT(cM),RT.invert=vT((function(e){return 2*KC(e)})),PT.invert=function(e,t){return[-t,2*KC(tM(e))-WC]};var zT=Math.abs,BT=Math.cos,IT=Math.sin,LT=Math.PI,qT=LT/2,UT=function(e){return e>0?Math.sqrt(e):0}(2);function VT(e){return e>1?qT:e<-1?-qT:Math.asin(e)}function WT(e,t){var n,r=e*IT(t),i=30;do{t-=n=(t+IT(t)-r)/(1+BT(t))}while(zT(n)>1e-6&&--i>0);return t/2}var HT=function(e,t,n){function r(r,i){return[e*r*BT(i=WT(n,i)),t*IT(i)]}return r.invert=function(r,i){return i=VT(i/t),[r/(e*BT(i)),VT((2*i+IT(2*i))/n)]},r}(UT/qT,UT,LT);const GT=ZF(),XT=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function YT(e,t){return function n(){const r=t();return r.type=e,r.path=ZF().projection(r),r.copy=r.copy||function(){const e=n();return XT.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function JT(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(QT[e]=YT(e,t),this):QT[e]||null}function KT(e){return e&&e.path||GT}const QT={albers:gT,albersusa:function(){var e,t,n,r,i,a,o=gT(),s=mT().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=mT().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),f()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+qC,c+.12*t+qC],[a-.214*t-qC,c+.234*t-qC]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+qC,c+.166*t+qC],[a-.115*t-qC,c+.234*t-qC]]).stream(u),f()},c.fitExtent=function(e,t){return rT(c,e,t)},c.fitSize=function(e,t){return iT(c,e,t)},c.fitWidth=function(e,t){return aT(c,e,t)},c.fitHeight=function(e,t){return oT(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return fT(bT).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return fT(xT).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return hT(OT).scale(109.5).parallels([30,30])},conicequalarea:mT,conicequidistant:function(){return hT($T).scale(131.154).center([0,13.9389])},equalEarth:function(){return fT(jT).scale(177.158)},equirectangular:function(){return fT(ST).scale(152.63)},gnomonic:function(){return fT(FT).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,f=1,d=0,h=null,p=1,m=1,g=eT({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=aF;function v(){return p=s*c,m=s*f,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(d){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(y(o=e))},b.postclip=function(e){return arguments.length?(y=e,h=n=r=i=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(h=n=r=i=null,aF):Qj(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),v()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,v()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],v()):[l,u]},b.angle=function(n){return arguments.length?(t=aM(d=n%360*YC),e=ZC(d),v()):d*XC},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,v()):f<0},b.fitExtent=function(e,t){return rT(b,e,t)},b.fitSize=function(e,t){return iT(b,e,t)},b.fitWidth=function(e,t){return aT(b,e,t)},b.fitHeight=function(e,t){return oT(b,e,t)},b},mercator:function(){return _T(wT).scale(961/GC)},mollweide:function(){return fT(HT).scale(169.529)},naturalEarth1:function(){return fT(TT).scale(175.295)},orthographic:function(){return fT(NT).scale(249.5).clipAngle(90.000001)},stereographic:function(){return fT(RT).scale(250).clipAngle(142)},transversemercator:function(){var e=_T(PT),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in QT)JT(e,QT[e]);function ZT(){}const eN=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function tN(){var e=1,t=1,n=o;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,f,d=new Array,h=new Array;o=s=-1,u=n[0]>=r,eN[u<<1].forEach(p);for(;++o<e-1;)l=u,u=n[o+1]>=r,eN[l|u<<1].forEach(p);eN[u<<0].forEach(p);for(;++s<t-1;){for(o=-1,u=n[s*e+e]>=r,c=n[s*e]>=r,eN[u<<1|c<<2].forEach(p);++o<e-1;)l=u,u=n[s*e+e+o+1]>=r,f=c,c=n[s*e+o+1]>=r,eN[l|u<<1|c<<2|f<<3].forEach(p);eN[u|c<<3].forEach(p)}o=-1,c=n[s*e]>=r,eN[c<<2].forEach(p);for(;++o<e-1;)f=c,c=n[s*e+o+1]>=r,eN[c<<2|f<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}eN[c<<3].forEach(p)}(r,i,(e=>{n(e,r,i),function(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==nN((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(a=r[u*e+l-1],n[0]=o+(i-a)/(c-a)-.5),s>0&&s<t&&u===s&&(a=r[(u-1)*e+l],n[1]=s+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||Mu("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:ZT,r):n===o},r}function nN(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=rN(e,t[r]))return n;return 0}function rN(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(iN(l,f,t))return 0;c>r!=h>r&&n<(d-u)*(r-c)/(h-c)+u&&(i=-i)}return i}function iN(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function aN(e,t,n){return function(r){var i=Oc(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?Zf(a,o,e):s/(e+1);return ld(a+l,o,l)}}function oN(e){zg.call(this,null,e)}function sN(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function lN(e,t,n){const r=e>=0?e:Wg(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function uN(e){return mc(e)?e:wc(+e)}function cN(){var e=e=>e[0],t=e=>e[1],n=Pu,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=lN(r[0],s,e)>>o,c=lN(r[1],s,t)>>o,f=u?u+2:0,d=c?c+2:0,h=2*f+(i>>o),p=2*d+(a>>o),m=new Float32Array(h*p),g=new Float32Array(h*p);let y=m;s.forEach((r=>{const i=f+(+e(r)>>o),a=d+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<p&&(m[i+a*h]+=+n(r))})),u>0&&c>0?(fN(h,p,m,g,u),dN(h,p,g,m,c),fN(h,p,m,g,u),dN(h,p,g,m,c),fN(h,p,m,g,u),dN(h,p,g,m,c)):u>0?(fN(h,p,m,g,u),fN(h,p,g,m,u),fN(h,p,m,g,u),y=g):c>0&&(dN(h,p,m,g,c),dN(h,p,g,m,c),dN(h,p,m,g,c),y=g);const v=l?Math.pow(2,-2*o):1/ud(y);for(let e=0,t=h*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(i>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=uN(t),s):e},s.y=function(e){return arguments.length?(t=uN(e),s):t},s.weight=function(e){return arguments.length?(n=uN(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||Mu("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||Mu("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=hc(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&Mu("invalid bandwidth"),r=e,s):r},s}function fN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function dN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function hN(e){zg.call(this,null,e)}oN.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Mc(oN,zg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Nu,a=tN().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=aN(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>ed(t(e).values))))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,qu(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;mc(i)&&(i=i(n,r));mc(a)&&(a=a(n,r));if((1===i||null==i)&&!a)return;const o=(Rc(i)?i:i[0])||1,s=(Rc(i)?i:i[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(sN(t,o,s,l,u))}(r,n,t,e),r.forEach((e=>{l.push(ug(t,sg(null!=s?{[s]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),hN.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const pN=["x","y","weight","size","cellSize","bandwidth"];function mN(e,t){return pN.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function gN(e){zg.call(this,null,e)}Mc(hN,zg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map($u),o=mN(cN(),e),s=e.as||"grid";return n=i.map((t=>sg(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),gN.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Mc(gN,zg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=tN().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||aN(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=sN(n=mN(cN(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=qu(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(sg),i}});const yN="Feature",vN="FeatureCollection";function bN(e){zg.call(this,null,e)}function xN(e){zg.call(this,null,e)}function wN(e){zg.call(this,null,e)}function _N(e){zg.call(this,null,e)}function kN(e){zg.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,f,d=10,h=d,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return ld(eM(r/p)*p,n,p).map(c).concat(ld(eM(s/m)*m,o,m).map(f)).concat(ld(eM(t/d)*d,e,d).filter((function(e){return JC(e%p)>qC})).map(l)).concat(ld(eM(a/h)*h,i,h).filter((function(e){return JC(e%m)>qC})).map(u))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(o).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),y.precision(g)):[[r,s],[n,o]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),y.precision(g)):[[t,a],[e,i]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],y):[p,m]},y.stepMinor=function(e){return arguments.length?(d=+e[0],h=+e[1],y):[d,h]},y.precision=function(d){return arguments.length?(g=+d,l=Zj(a,i,90),u=eF(t,e,g),c=Zj(s,o,90),f=eF(r,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function ON(e){zg.call(this,null,e)}function SN(e){if(!mc(e))return!1;const t=Kc(Eu(e));return t.$x||t.$y||t.$value||t.$max}function $N(e){zg.call(this,null,e),this.modified(!0)}function EN(e,t,n){mc(e[t])&&e[t](n)}bN.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Mc(bN,zg,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&Nu,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(Eu(l))||o&&t.modified(Eu(o))||s&&t.modified(Eu(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,(e=>r.push(l(e)))),o&&s&&(t.visit(u,(e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:yN,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:vN,features:r}}}),xN.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Mc(xN,zg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Nu,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=KT(e.projection),n.materialize().reflow()):o=i===Nu||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(r,e.pointRadius);return n.visit(o,(e=>e[a]=r(i(e)))),r.pointRadius(s),n.modifies(a)}}),wN.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Mc(wN,zg,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),_N.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Mc(_N,zg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(KT(e.projection),e.field||Fu("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),kN.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Mc(kN,zg,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)mc(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(cg(r[0],n)):t.add.push(sg(n)),r[0]=n,t}}),ON.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Mc(ON,zg,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||Nu,a=function(e,t){let n;mc(e)?(n=n=>e(n,t),n.dep=SN(e)):e?n=wc(e):(n=e=>e.$value/e.$max||0,n.dep=!0);return n}(e.opacity,e),o=function(e,t){let n;mc(e)?(n=n=>Gx(e(n,t)),n.dep=SN(e)):n=wc(Gx(e||"#888"));return n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?ed(n.map((e=>ed(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=kc({},e,l);r||(n.$max=ed(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||i,u=e.y2||a,c=e.values,f=c?e=>c[e]:Ru,d=bx(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),m=p.data;for(let e=s,a=0;e<u;++e){t.$y=e-s;for(let s=o,u=e*i;s<l;++s,a+=4){t.$x=s-o,t.$value=f(s+u);const e=n(t);m[a+0]=e.r,m[a+1]=e.g,m[a+2]=e.b,m[a+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}(t,n,o.dep?o:wc(o(n)),a.dep?a:wc(a(n)))})),t.reflow(!0).modifies(s)}}),Mc($N,zg,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=JT((e||"mercator").toLowerCase());t||Mu("Unrecognized projection type: "+e);return t()}(e.type),XT.forEach((t=>{null!=e[t]&&EN(n,t,e[t])}))):XT.forEach((t=>{e.modified(t)&&EN(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=hc(e)).length?e[0]:{type:vN,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===vN?e.features:hc(e).filter((e=>null!=e)).map((e=>e.type===yN?e:{type:yN,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var AN=Object.freeze({__proto__:null,contour:gN,geojson:bN,geopath:xN,geopoint:wN,geoshape:_N,graticule:kN,heatmap:ON,isocontour:oN,kde2d:hN,projection:$N});function DN(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,f,d,h=e._root,p={data:r},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o,i=h,!(h=h[f=c<<1|u]))return i[f]=p,e;if(s=+e._x.call(null,h.data),l=+e._y.call(null,h.data),t===s&&n===l)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o}while((f=c<<1|u)==(d=(l>=o)<<1|s>=a));return i[d]=h,i[f]=p,e}function CN(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function MN(e){return e[0]}function jN(e){return e[1]}function FN(e,t,n){var r=new TN(null==t?MN:t,null==n?jN:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function TN(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function NN(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var RN=FN.prototype=TN.prototype;function PN(e){return function(){return e}}function zN(e){return 1e-6*(e()-.5)}function BN(e){return e.x+e.vx}function IN(e){return e.y+e.vy}function LN(e){return e.index}function qN(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}RN.copy=function(){var e,t,n=new TN(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=NN(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=NN(t));return n},RN.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return DN(this.cover(t,n),t,n,e)},RN.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>f&&(f=i));if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<a;++n)DN(this,o[n],s[n],e[n]);return this},RN.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n||1,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},RN.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},RN.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},RN.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],m=this._root;for(m&&p.push(new CN(m,c,f,d,h)),null==n?n=1/0:(c=e-n,f=t-n,d=e+n,h=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(a=l.y0)>h||(o=l.x1)<c||(s=l.y1)<f))if(m.length){var g=(i+o)/2,y=(a+s)/2;p.push(new CN(m[3],g,y,o,s),new CN(m[2],i,y,g,s),new CN(m[1],g,a,o,y),new CN(m[0],i,a,g,y)),(u=(t>=y)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,f=t-w,d=e+w,h=t+w,r=m.data}}return r},RN.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,f,d,h=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!h)return this;if(h.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+y)/2))?m=l:y=l,t=h,!(h=h[f=c<<1|u]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},RN.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},RN.root=function(){return this._root},RN.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},RN.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new CN(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new CN(n,u,c,a,o)),(n=l[2])&&s.push(new CN(n,r,c,u,o)),(n=l[1])&&s.push(new CN(n,u,i,a,c)),(n=l[0])&&s.push(new CN(n,r,i,u,c))}return this},RN.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new CN(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,f=(s+u)/2;(a=i[0])&&n.push(new CN(a,o,s,c,f)),(a=i[1])&&n.push(new CN(a,c,s,l,f)),(a=i[2])&&n.push(new CN(a,o,f,c,u)),(a=i[3])&&n.push(new CN(a,c,f,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},RN.x=function(e){return arguments.length?(this._x=e,this):this._x},RN.y=function(e){return arguments.length?(this._y=e,this):this._y};var UN={value:()=>{}};function VN(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new WN(r)}function WN(e){this._=e}function HN(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function GN(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function XN(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=UN,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}WN.prototype=VN.prototype={constructor:WN,on:function(e,t){var n,r=this._,i=HN(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=XN(r[n],e.name,t);else if(null==t)for(n in r)r[n]=XN(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=GN(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new WN(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var YN,JN,KN=0,QN=0,ZN=0,eR=0,tR=0,nR=0,rR="object"==typeof performance&&performance.now?performance:Date,iR="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function aR(){return tR||(iR(oR),tR=rR.now()+nR)}function oR(){tR=0}function sR(){this._call=this._time=this._next=null}function lR(e,t,n){var r=new sR;return r.restart(e,t,n),r}function uR(){tR=(eR=rR.now())+nR,KN=QN=0;try{!function(){aR(),++KN;for(var e,t=YN;t;)(e=tR-t._time)>=0&&t._call.call(null,e),t=t._next;--KN}()}finally{KN=0,function(){var e,t,n=YN,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:YN=t);JN=e,fR(r)}(),tR=0}}function cR(){var e=rR.now(),t=e-eR;t>1e3&&(nR-=t,eR=e)}function fR(e){KN||(QN&&(QN=clearTimeout(QN)),e-tR>24?(e<1/0&&(QN=setTimeout(uR,e-rR.now()-nR)),ZN&&(ZN=clearInterval(ZN))):(ZN||(eR=rR.now(),ZN=setInterval(cR,1e3)),KN=1,iR(uR)))}sR.prototype=lR.prototype={constructor:sR,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?aR():+n)+(null==t?0:+t),this._next||JN===this||(JN?JN._next=this:YN=this,JN=this),this._call=e,this._time=n,fR()},stop:function(){this._call&&(this._call=null,this._time=1/0,fR())}};const dR=4294967296;function hR(e){return e.x}function pR(e){return e.y}var mR=Math.PI*(3-Math.sqrt(5));function gR(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=lR(f),u=VN("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%dR)/dR}();function f(){d(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function d(r){var l,u,c=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*mR;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}const yR={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,f,d,h=t.length,p=0;p<a;++p)for(o=FN(t,BN,IN).visitAfter(s),e=0;e<h;++e)l=t[e],f=n[l.index],d=f*f,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,p=f+h;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,y=m*m+g*g;y<p*p&&(0===m&&(y+=(m=zN(r))*m),0===g&&(y+=(g=zN(r))*g),y=(p-(y=Math.sqrt(y)))/y*i,l.vx+=(m*=y)*(p=(h*=h)/(d+h)),l.vy+=(g*=y)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=PN(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:PN(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=PN(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=FN(e,hR,pR).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,a,u,c){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=c-a,p=f*f+d*d;if(h*h/l<p)return p<s&&(0===f&&(p+=(f=zN(n))*f),0===d&&(p+=(d=zN(n))*d),p<o&&(p=Math.sqrt(o*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=zN(n))*f),0===d&&(p+=(d=zN(n))*d),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:PN(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=LN,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=PN(30),c=1;function f(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,f,d,h,p,m,g=0;g<s;++g)u=(l=e[g]).source,d=(f=l.target).x+f.vx-u.x-u.vx||zN(o),h=f.y+f.vy-u.y-u.vy||zN(o),d*=p=((p=Math.sqrt(d*d+h*h))-n[g])/p*r*t[g],h*=p,f.vx-=d*(m=a[g]),f.vy-=h*m,u.vx+=d*(m=1-m),u.vy+=h*m}function d(){if(r){var o,l,u=r.length,c=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=qN(f,l.source)),"object"!=typeof l.target&&(l.target=qN(f,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)l=e[o],a[o]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),h(),n=new Array(c),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(c=+e,f):c},f.strength=function(e){return arguments.length?(l="function"==typeof e?e:PN(+e),h(),f):l},f.distance=function(e){return arguments.length?(u="function"==typeof e?e:PN(+e),p(),f):u},f},x:function(e){var t,n,r,i=PN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=PN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:PN(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:PN(+t),o(),a):e},a},y:function(e){var t,n,r,i=PN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=PN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:PN(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:PN(+t),o(),a):e},a}},vR="forces",bR=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],xR=["static","iterations"],wR=["x","y","vx","vy"];function _R(e){zg.call(this,null,e)}function kR(e,t,n,r){var i,a,o,s,l=hc(t.forces);for(i=0,a=bR.length;i<a;++i)(o=bR[i])!==vR&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=vR+i,(o=n||t.modified(vR,i)?SR(l[i]):r&&OR(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(vR+i,null);return e.numForces=l.length,e}function OR(e,t){var n,r;for(n in e)if(mc(r=e[n])&&t.modified(Eu(r)))return 1;return 0}function SR(e){var t,n;for(n in Ec(yR,e.force)||Mu("Unrecognized force: "+e.force),t=yR[e.force](),e)mc(t[n])&&$R(t[n],e[n],e);return t}function $R(e,t,n){e(mc(t)?e=>t(e,n):t)}_R.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:wR}]},Mc(_R,zg,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(bR),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&kR(i,e,0,t)):(this.value=i=function(e,t){const n=gR(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),kR(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(xR)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,s=0,l=t.length;s<l;++s)if(e=t[s],e.name===vR&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(wR)}});var ER=Object.freeze({__proto__:null,force:_R});function AR(e,t){return e.parent===t.parent?1:2}function DR(e,t){return e+t.x}function CR(e,t){return Math.max(e,t.y)}function MR(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function jR(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=TR)):void 0===t&&(t=FR);for(var n,r,i,a,o,s=new PR(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new PR(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(RR)}function FR(e){return e.children}function TR(e){return Array.isArray(e)?e[1]:null}function NR(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function RR(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function PR(e){this.data=e,this.depth=this.height=0,this.parent=null}function zR(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&LR(n,t)?++r:(n=UR(a=BR(a,t)),r=0);return n}function BR(e,t){var n,r;if(qR(t,e))return[t];for(n=0;n<e.length;++n)if(IR(t,e[n])&&qR(VR(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(IR(VR(e[n],e[r]),t)&&IR(VR(e[n],t),e[r])&&IR(VR(e[r],t),e[n])&&qR(WR(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function IR(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function LR(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function qR(e,t){for(var n=0;n<t.length;++n)if(!LR(e,t[n]))return!1;return!0}function UR(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return VR(e[0],e[1]);case 3:return WR(e[0],e[1],e[2])}}function VR(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(r+o+u/f*c)/2,r:(f+i+s)/2}}function WR(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=r-o,h=r-u,p=i-s,m=i-c,g=l-a,y=f-a,v=r*r+i*i-a*a,b=v-o*o-s*s+l*l,x=v-u*u-c*c+f*f,w=h*p-d*m,_=(p*x-m*b)/(2*w)-r,k=(m*g-p*y)/w,O=(h*b-d*x)/(2*w)-i,S=(d*y-h*g)/w,$=k*k+S*S-1,E=2*(a+_*k+O*S),A=_*_+O*O-a*a,D=-($?(E+Math.sqrt(E*E-4*$*A))/(2*$):A/E);return{x:r+_+k*D,y:i+O+S*D,r:D}}function HR(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function GR(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function XR(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function YR(e){this._=e,this.next=null,this.previous=null}function JR(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,o,s,l,u,c,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;HR(n,t,r=e[2]),t=new YR(t),n=new YR(n),r=new YR(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){HR(t._,n._,r=e[s]),r=new YR(r),l=n.next,u=t.previous,c=n._.r,f=t._.r;do{if(c<=f){if(GR(l._,r._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(GR(u._,r._)){(t=u).next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}}while(l!==u.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=XR(t);(r=r.next)!==n;)(o=XR(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=zR(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function KR(e){return null==e?null:QR(e)}function QR(e){if("function"!=typeof e)throw new Error;return e}function ZR(){return 0}function eP(e){return function(){return e}}function tP(e){return Math.sqrt(e.value)}function nP(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function rP(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=JR(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function iP(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function aP(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function oP(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u}PR.prototype=jR.prototype={constructor:PR,count:function(){return this.eachAfter(MR)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop(),t=r.pop();for(;e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return jR(this).eachBefore(NR)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var sP={depth:-1},lP={};function uP(e){return e.id}function cP(e){return e.parentId}function fP(){var e=uP,t=cP;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),f=c.length,d=new Map;for(i=0;i<f;++i)r=c[i],s=c[i]=new PR(r),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,d.set(u,d.has(u)?lP:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<f;++i)if(l=(s=c[i]).parent){if(!(o=d.get(l)))throw new Error("missing: "+l);if(o===lP)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=sP,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(RR),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=QR(t),n):e},n.parentId=function(e){return arguments.length?(t=QR(e),n):t},n}function dP(e,t){return e.parent===t.parent?1:2}function hP(e){var t=e.children;return t?t[0]:e.t}function pP(e){var t=e.children;return t?t[t.length-1]:e.t}function mP(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function gP(e,t,n){return e.a.parent===t.parent?e.a:n}function yP(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function vP(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u}yP.prototype=Object.create(PR.prototype);var bP=(1+Math.sqrt(5))/2;function xP(e,t,n,r,i,a){for(var o,s,l,u,c,f,d,h,p,m,g,y=[],v=t.children,b=0,x=0,w=v.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=v[x++].value}while(!c&&x<w);for(f=d=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(d/g,g/f);x<w;++x){if(c+=s=v[x].value,s<f&&(f=s),s>d&&(d=s),g=c*c*m,(h=Math.max(d/g,g/f))>p){c-=s;break}p=h}y.push(o={value:c,dice:l<u,children:v.slice(b,x)}),o.dice?oP(o,n,r,i,_?r+=u*c/_:a):vP(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return y}var wP=function e(t){function n(e,n,r,i,a){xP(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(bP);var _P=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,f=-1,d=o.length,h=e.value;++f<d;){for(l=(s=o[f]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?oP(s,n,r,i,h?r+=(a-r)*s.value/h:a):vP(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=xP(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(bP);function kP(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function OP(e){zg.call(this,null,e)}OP.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const SP=e=>e.values;function $P(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],o={},s={};let l,u,c,f=-1;for(;++f<i;)l=a(u=t[f])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=n(o[l],r);return s}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function EP(e){zg.call(this,null,e)}Mc(OP,zg,{transform(e,t){t.source||Mu("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&ig(e.data)&&i.rem.push(e.data)})),this.value=a=jR({values:hc(e.keys).reduce(((e,t)=>(e.key(t),e)),$P()).entries(i.source)},SP),n&&a.each((e=>{e.children&&(e=sg(e.data),i.add.push(e),i.source.push(e))})),kP(a,ag,ag)),i.source.root=a,i}});const AP=(e,t)=>e.parent===t.parent?1:2;Mc(EP,zg,{transform(e,t){t.source&&t.source.root||Mu(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(fg(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?AP:Pu);try{this.value=n(i)}catch(e){Mu(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const DP=["x","y","r","depth","children"];function CP(e){EP.call(this,e)}CP.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:DP.length,default:DP}]},Mc(CP,EP,{layout:function(){var e=null,t=1,n=1,r=ZR;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(nP(e)).eachAfter(rP(r,.5)).eachBefore(iP(1)):i.eachBefore(nP(tP)).eachAfter(rP(ZR,1)).eachAfter(rP(r,i.r/Math.min(t,n))).eachBefore(iP(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=KR(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:eP(+e),i):r},i},params:["radius","size","padding"],fields:DP});const MP=["x0","y0","x1","y1","depth","children"];function jP(e){EP.call(this,e)}function FP(e){zg.call(this,null,e)}jP.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:MP.length,default:MP}]},Mc(jP,EP,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&oP(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(aP),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:MP}),FP.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Mc(FP,zg,{transform(e,t){t.source||Mu("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?kP(fP().id(e.key).parentId(e.parentKey)(i.source),e.key,zu):kP(fP()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const TP={tidy:function(){var e=dP,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new yP(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new yP(r[i],i)),n.parent=t;return(o.parent=new yP(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,f=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>f.depth&&(f=e)}));var d=u===c?1:e(u,c)/2,h=d-u.x,p=t/(c.x+d+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,f=s.m,d=l.m;s=pP(s),a=hP(a),s&&a;)l=hP(l),(o=pP(o)).a=t,(i=s.z+f-a.z-u+e(s._,a._))>0&&(mP(gP(s,t,r),t,i),u+=i,c+=i),f+=s.m,u+=a.m,d+=l.m,c+=o.m;s&&!pP(o)&&(o.t=s,o.m+=f-c),a&&!hP(l)&&(l.t=a,l.m+=u-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=AR,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(DR,0)/e.length}(n),t.y=function(e){return 1+e.reduce(CR,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},NP=["x","y","depth","children"];function RP(e){EP.call(this,e)}function PP(e){zg.call(this,[],e)}RP.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:NP.length,default:NP}]},Mc(RP,EP,{layout(e){const t=e||"tidy";if(Ec(TP,t))return TP[t]();Mu("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:NP}),PP.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Mc(PP,zg,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||Mu("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[ag(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[ag(t)]&&a[ag(n)]&&i.add.push(sg({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[ag(e)]=1)),n.forEach((e=>{(a[ag(e.source)]||a[ag(e.target)])&&i.mod.push(e)}))),i}});const zP={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}var f=u[t],d=r/2+f,h=t+1,p=n-1;for(;h<p;){var m=h+p>>>1;u[m]<d?h=m+1:p=m}d-u[h-1]<u[h]-d&&t+1<h&&--h;var g=u[h]-f,y=r-g;if(o-i>l-a){var v=r?(i*y+o*g)/r:o;e(t,h,g,i,a,v,l),e(h,n,y,v,a,o,l)}else{var b=r?(a*y+l*g)/r:l;e(t,h,g,i,a,o,b),e(h,n,y,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:oP,slice:vP,slicedice:function(e,t,n,r,i){(1&e.depth?vP:oP)(e,t,n,r,i)},squarify:wP,resquarify:_P},BP=["x0","y0","x1","y1","depth","children"];function IP(e){EP.call(this,e)}IP.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:BP.length,default:BP}]},Mc(IP,EP,{layout(){const e=function(){var e=wP,t=!1,n=1,r=1,i=[0],a=ZR,o=ZR,s=ZR,l=ZR,u=ZR;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(aP),e}function f(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,f=t.x1-n,d=t.y1-n;f<r&&(r=f=(r+f)/2),d<c&&(c=d=(c+d)/2),t.x0=r,t.y0=c,t.x1=f,t.y1=d,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(d-=l(t)-n)<c&&(c=d=(c+d)/2),e(t,r,c,f,d))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=QR(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:eP(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:eP(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:eP(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:eP(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:eP(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{Ec(zP,t)?e.tile(zP[t]):Mu("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:BP});var LP=Object.freeze({__proto__:null,nest:OP,pack:CP,partition:jP,stratify:FP,tree:RP,treelinks:PP,treemap:IP});function qP(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=bx(i,a).getContext("2d");t.forEach((e=>UP(s,e,o)));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let f,d,h,p,m;for(d=0;d<a;++d)for(f=0;f<i;++f)m=4278190080&l[d*i+f],m&&(h=e(f),p=e(d),r||u.set(h,p),o&&268435456^m&&c.set(h,p));return[u,c]}function UP(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>UP(e,t.items,n)))})):gE[r].draw(e,{items:n?t.map(VP):t})}function VP(e){const t=ug(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const WP=31,HP=new Uint32Array(33),GP=new Uint32Array(33);GP[0]=0,HP[0]=~GP[0];for(let e=1;e<=32;++e)GP[e]=GP[e-1]<<1|1,HP[e]=~GP[e];function XP(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&WP)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&WP))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&WP)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&HP[o&WP]&GP[1+(s&WP)])return!0}else{if(n[l]&HP[o&WP])return!0;if(n[u]&GP[1+(s&WP)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,HP[o&WP]&GP[1+(s&WP)]);else for(r(l,HP[o&WP]),r(u,GP[1+(s&WP)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,GP[o&WP]|HP[1+(s&WP)]);else for(i(l,GP[o&WP]),i(u,HP[1+(s&WP)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function YP(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function JP(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),f=e(n-(a/=2)),d=e(n+a);return o.outOfBounds(u,f,c,d)||o.getRange(u,f,c,d)||s&&s.getRange(u,f,c,d)}const KP=[-1,-1,1,1],QP=[-1,1,-1,1];const ZP=["right","center","left"],ez=["bottom","middle","top"];function tz(e,t,n,r,i,a,o,s,l,u,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const nz={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},rz={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=Q$.width(e.datum,e.datum.text);let l,u,c,f,d,h,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,f=void 0===t[r].y2?c:t[r].y2,d=(l+u)/2,h=(c+f)/2,p=Math.abs(u-l+f-c),p>=m&&(m=p,e.x=d,e.y=h);return d=s/2,h=o/2,l=e.x-d,u=e.x+d,c=e.y-h,f=e.y+h,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&f<=a?e.baseline="top":0<=c&&a<f&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),f=e.invert(n);let d,h=r,p=a;if(!YP(c,f,l,u,i,a)&&!JP(e,c,f,u,l,h,o,s)&&!JP(e,c,f,u,l,u,o,null)){for(;p-h>=1;)d=(h+p)/2,JP(e,c,f,u,l,d,o,s)?p=d:h=d;if(h>r)return[c,f,h,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,f=Q$.width(t.datum,t.datum.text);let d,h,p,m,g,y,v,b,x,w,_,k,O,S,$,E,A,D=n?c:0,C=!1,M=!1,j=0;for(let r=0;r<u;++r){for(d=s[r].x,p=s[r].y,h=void 0===s[r].x2?d:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,d>h&&(A=d,d=h,h=A),p>m&&(A=p,p=m,m=A),x=e(d),_=e(h),w=~~((x+_)/2),k=e(p),S=e(m),O=~~((k+S)/2),v=w;v>=x;--v)for(b=O;b>=k;--b)E=l(v,b,D,f,c),E&&([t.x,t.y,D,C]=E);for(v=w;v<=_;++v)for(b=O;b<=S;++b)E=l(v,b,D,f,c),E&&([t.x,t.y,D,C]=E);C||n||($=Math.abs(h-d+m-p),g=(d+h)/2,y=(p+m)/2,$>=j&&!YP(g,y,f,c,i,a)&&!JP(e,g,y,c,f,c,o,null)&&(j=$,t.x=g,t.y=y,M=!0))}return!(!C&&!M)&&(g=f/2,y=c/2,o.setRange(e(t.x-g),e(t.y-y),e(t.x+g),e(t.y+y)),t.align="center",t.baseline="middle",!0)}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,f=t.datum.fontSize,d=Q$.width(t.datum,t.datum.text),h=[];let p,m,g,y,v,b,x,w,_,k,O,S,$=n?f:0,E=!1,A=!1,D=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,y=void 0===u[r].y2?g:u[r].y2,h.push([e((p+m)/2),e((g+y)/2)]);h.length;)if([x,w]=h.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)v=x+KP[e],b=w+QP[e],l.outOfBounds(v,b,v,b)||h.push([v,b]);if(v=e.invert(x),b=e.invert(w),_=$,k=a,!YP(v,b,d,f,i,a)&&!JP(e,v,b,f,d,_,o,s)&&!JP(e,v,b,f,d,f,o,null)){for(;k-_>=1;)O=(_+k)/2,JP(e,v,b,f,d,O,o,s)?k=O:_=O;_>$&&(t.x=v,t.y=b,$=_,E=!0)}}E||n||(S=Math.abs(m-p+y-g),v=(p+m)/2,b=(g+y)/2,S>=D&&!YP(v,b,d,f,i,a)&&!JP(e,v,b,f,d,f,o,null)&&(D=S,t.x=v,t.y=b,A=!0))}return!(!E&&!A)&&(v=d/2,b=f/2,o.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",!0)}}};function iz(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const f=Math.max(r.length,i.length),d=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,f),h=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=nz[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,f),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,y=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),v=XP(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let _;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<h.length&&!t;++e)t=5===h[e]||d[e]<0;p&&(o||g)&&(a=[e.map((e=>e.datum))].concat(a)),_=a.length?qP(v,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,o&&w)}const k=g?rz[c](v,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let f,d,h,p,m,g,y,v,b,x,w,_,k,O,S,$=0;for(let i=0;i<l;++i){if(f=(3&n[i])-1,d=(n[i]>>>2&3)-1,h=0===f&&0===d||r[i]<0,p=f&&d?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+f]+r[i]*f*p,w=u[4+d]+m*c*d/2+r[i]*d*p,v=w-c/2,b=w+c/2,_=e(g),O=e(v),S=e(b),!$){if(!tz(_,_,O,S,o,s,g,g,v,b,u,h))continue;$=Q$.width(t.datum,t.datum.text)}if(x=g+m*$*f/2,g=x-$/2,y=x+$/2,_=e(g),k=e(y),tz(_,k,O,S,o,s,g,y,v,b,u,h))return t.x=f?f*m<0?y:g:x,t.y=d?d*m<0?b:v:w,t.align=ZP[f*m+1],t.baseline=ez[d*m+1],o.setRange(_,O,k,S),!0}return!1}}(v,_,h,d);return w.forEach((e=>e.opacity=+k(e))),w}const az=["x","y","opacity","align","baseline"],oz=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function sz(e){zg.call(this,null,e)}sz.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:oz},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:az.length,default:az}]},Mc(sz,zg,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e[n];return mc(r)&&t.modified(r.fields)}("sort")))return;e.size&&2===e.size.length||Mu("Size parameter should be specified as a [width, height] array.");const r=e.as||az;return iz(t.materialize(t.SOURCE).source,e.size,e.sort,hc(e.offset||1),hc(e.anchor||oz),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}});var lz=Object.freeze({__proto__:null,label:sz});function uz(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function cz(e){zg.call(this,null,e)}cz.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Mc(cz,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=uz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map($u),a=i.length,o=e.as||[$u(e.x),$u(e.y)],s=[];r.forEach((t=>{Ey(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[o[0]]=e[0],n[o[1]]=e[1],s.push(sg(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const fz={linear:xy,log:wy,exp:_y,pow:ky,quad:Oy,poly:Sy};function dz(e){zg.call(this,null,e)}dz.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(fz)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Mc(dz,zg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=uz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map($u),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[$u(e.x),$u(e.y)],u=fz[a],c=[];let f=e.extent;Ec(fz,a)||Mu("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push(sg({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const d=f||Oc(n,e.x),h=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[l[0]]=e[0],t[l[1]]=e[1],c.push(sg(t))};"linear"===a?d.forEach((e=>h([e,r.predict(e)]))):My(r.predict,d,25,200).forEach(h)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});var hz=Object.freeze({__proto__:null,loess:cz,regression:dz});const pz=Math.pow(2,-52),mz=new Uint32Array(512);class gz{static from(e,t=Oz,n=Sz){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new gz(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>l&&(l=n),r>u&&(u=r),this._ids[t]=t}const c=(o+l)/2,f=(s+u)/2;let d,h,p,m=1/0;for(let t=0;t<a;t++){const n=yz(c,f,e[2*t],e[2*t+1]);n<m&&(d=t,m=n)}const g=e[2*d],y=e[2*d+1];m=1/0;for(let t=0;t<a;t++){if(t===d)continue;const n=yz(g,y,e[2*t],e[2*t+1]);n<m&&n>0&&(h=t,m=n)}let v=e[2*h],b=e[2*h+1],x=1/0;for(let t=0;t<a;t++){if(t===d||t===h)continue;const n=wz(g,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];_z(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(bz(g,y,v,b,w,_)){const e=h,t=v,n=b;h=p,v=w,b=_,p=e,w=t,_=n}const k=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*f)*d,y:t+(o*f-l*c)*d}}(g,y,v,b,w,_);this._cx=k.x,this._cy=k.y;for(let t=0;t<a;t++)this._dists[t]=yz(e[2*t],e[2*t+1],k.x,k.y);_z(this._ids,this._dists,0,a-1),this._hullStart=d;let O=3;n[d]=t[p]=h,n[h]=t[d]=p,n[p]=t[h]=d,r[d]=0,r[h]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(v,b)]=h,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(d,h,p,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const l=this._ids[s],u=e[2*l],c=e[2*l+1];if(s>0&&Math.abs(u-a)<=pz&&Math.abs(c-o)<=pz)continue;if(a=u,o=c,l===d||l===h||l===p)continue;let f=0;for(let e=0,t=this._hashKey(u,c);e<this._hashSize&&(f=i[(t+e)%this._hashSize],-1===f||f===n[f]);e++);f=t[f];let m,g=f;for(;m=n[g],!bz(u,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,l,n[g],-1,-1,r[g]);r[l]=this._legalize(y+2),r[g]=y,O++;let v=n[g];for(;m=n[v],bz(u,c,e[2*v],e[2*v+1],e[2*m],e[2*m+1]);)y=this._addTriangle(v,l,m,r[l],-1,r[v]),r[l]=this._legalize(y+2),n[v]=v,O--,v=m;if(g===f)for(;m=t[g],bz(u,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)y=this._addTriangle(m,l,g,-1,r[g],r[m]),this._legalize(y+2),r[m]=y,n[g]=g,O--,g=m;this._hullStart=t[l]=g,n[g]=t[v]=l,n[l]=v,i[this._hashKey(u,c)]=l,i[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(O);for(let e=0,t=this._hullStart;e<O;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=mz[--i];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c];if(xz(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1])){t[e]=p,t[o]=f;const r=n[c];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,c);const s=l+(o+1)%3;i<mz.length&&(mz[i++]=s)}else{if(0===i)break;e=mz[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function yz(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function vz(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function bz(e,t,n,r,i,a){return(vz(i,a,e,t,n,r)||vz(e,t,n,r,i,a)||vz(n,r,i,a,e,t))<0}function xz(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,f=r-s,d=i-o,h=a-s,p=c*c+f*f,m=d*d+h*h;return l*(f*m-p*h)-u*(c*m-p*d)+(l*l+u*u)*(c*h-f*d)<0}function wz(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function _z(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;kz(e,n+r>>1,i),t[e[n]]>t[e[r]]&&kz(e,n,r),t[e[i]]>t[e[r]]&&kz(e,i,r),t[e[n]]>t[e[i]]&&kz(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;kz(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(_z(e,t,i,r),_z(e,t,n,a-1)):(_z(e,t,n,a-1),_z(e,t,i,r))}}function kz(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Oz(e){return e[0]}function Sz(e){return e[1]}const $z=1e-6;class Ez{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>$z||Math.abs(this._y1-i)>$z)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class Az{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Dz{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,o=0,s=n.length;a<s;a+=3,o+=2){const s=2*n[a],l=2*n[a+1],u=2*n[a+2],c=e[s],f=e[s+1],d=e[l],h=e[l+1],p=e[u],m=e[u+1],g=d-c,y=h-f,v=p-c,b=m-f,x=g*g+y*y,w=v*v+b*b,_=2*(g*b-y*v);if(_)if(Math.abs(_)<1e-8)t=(c+p)/2,r=(f+m)/2;else{const e=1/_;t=c+(b*x-y*w)*e,r=f+(g*w-v*x)*e}else t=(c+p)/2-1e8*b,r=(f+m)/2+1e8*v;i[o]=t,i[o+1]=r}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],f=e[2*l+1];r.fill(0);for(let n=0;n<t.length;++n)l=t[n],a=u,o=c,s=f,u=4*l,c=e[2*l],f=e[2*l+1],r[a+2]=r[u]=s-f,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new Ez:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),o=2*Math.floor(r/3),s=a[i],l=a[i+1],u=a[o],c=a[o+1];this._renderSegment(s,l,u,c,e)}let s,l=i[i.length-1];for(let t=0;t<i.length;++t){s=l,l=i[t];const n=2*Math.floor(r[l]/3),u=a[n],c=a[n+1],f=4*s,d=this._project(u,c,o[f+2],o[f+3]);d&&this._renderSegment(u,c,d[0],d[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new Ez:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new Ez:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new Az;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],f=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(r=u,i=c,u=t[d],c=t[d+1],a=f,f=this._regioncode(u,c),0===a&&0===f)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,d,h,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,f)))continue;[n,d,h,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,f,a)))continue;[h,p,n,d]=t,o=s,s=this._edgecode(n,d),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,d):l=[n,d]}o=s,s=this._edgecode(h,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(h,p):l=[h,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let t,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)t=i,i=this._edgecode(s[n],s[n+1]),t&&i&&(n=this._edge(e,t,i,s,n),r=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const Cz=2*Math.PI,Mz=Math.pow;function jz(e){return e[0]}function Fz(e){return e[1]}function Tz(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Nz{static from(e,t=jz,n=Fz,r){return new Nz("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new gz(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=Tz(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new gz(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new Dz(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=Mz(t-l[2*e],2)+Mz(n-l[2*e+1],2);const f=r[e];let d=f;do{let r=s[d];const f=Mz(t-l[2*r],2)+Mz(n-l[2*r+1],2);if(f<c&&(c=f,u=r),d=d%3==2?d-2:d+1,s[d]!==e)break;if(d=o[d],-1===d){if(d=i[(a[e]+1)%i.length],d!==r&&Mz(t-l[2*d],2)+Mz(n-l[2*d+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=null==e?e=new Ez:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const o=2*i[t],s=2*i[a];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new Ez:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,Cz)}return n&&n.value()}renderHull(e){const t=null==e?e=new Ez:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new Az;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new Ez:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new Az;return this.renderTriangle(e,t),t.value()}}function Rz(e){zg.call(this,null,e)}Rz.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Pz=[-1e5,-1e5,1e5,1e5];function zz(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Mc(Rz,zg,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Pz;const a=this.value=Nz.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?zz(t):null}return t.reflow(e.modified()).modifies(n)}});var Bz=Object.freeze({__proto__:null,voronoi:Rz}),Iz=Math.PI/180,Lz=2048;function qz(){var e,t,n,r,i,a,o,s=[256,256],l=Gz,u=[],c=Math.random,f={};function d(e,t,n){for(var r,i,a,o=t.x,u=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=l(s),h=c()<.5?1:-1,p=-h;(r=d(p+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=u+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!Vz(t,e,s[0]))&&(!n||Hz(t,n))){for(var m,g=t.sprite,y=t.width>>5,v=s[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,_=t.y1-t.y0,k=(t.y+t.y0)*v+(b>>5),O=0;O<_;O++){m=0;for(var S=0;S<=y;S++)e[k+S]|=m<<w|(S<y?(m=g[O*y+S])>>>x:0);k+=v}return t.sprite=null,!0}return!1}return f.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=Lz/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(bx()),f=function(e){var t=[],n=-1;for(;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,p=u.length,m=-1,g=[],y=u.map((s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((e,t)=>t.size-e.size));++m<p;){var v=y[m];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,Uz(l,v,y,m),v.hasText&&d(f,v,h)&&(g.push(v),h?Wz(h,v):h=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return g},f.words=function(e){return arguments.length?(u=e,f):u},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=Xz(e),f):t},f.fontStyle=function(e){return arguments.length?(r=Xz(e),f):r},f.fontWeight=function(e){return arguments.length?(i=Xz(e),f):i},f.rotate=function(e){return arguments.length?(a=Xz(e),f):a},f.text=function(t){return arguments.length?(e=Xz(t),f):e},f.spiral=function(e){return arguments.length?(l=Yz[e]||e,f):l},f.fontSize=function(e){return arguments.length?(n=Xz(e),f):n},f.padding=function(e){return arguments.length?(o=Xz(e),f):o},f.random=function(e){return arguments.length?(c=e,f):c},f}function Uz(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,Lz/a);var o,s,l,u,c,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*Iz),g=Math.cos(t.rotate*Iz),y=o*g,v=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,l=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(l>h&&(h=l),f+o>=2048&&(f=0,d+=h,h=0),d+l>=Lz)break;i.translate((f+(o>>1))/a,(d+(l>>1))/a),t.rotate&&i.rotate(t.rotate*Iz),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,2048/a,Lz/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,O=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=s*c+(u>>5),$=w[2048*(d+c)+(f+u)<<2]?1<<31-u%32:0;_[S]|=$,k|=$}k?O=c:(t.y0++,l--,c--,d++)}t.y1=t.y0+O,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function Vz(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*n+(o>>5),f=0;f<u;f++){r=0;for(var d=0;d<=a;d++)if((r<<l|(d<a?(r=i[f*a+d])>>>s:0))&t[c+d])return!0;c+=n}return!1}function Wz(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function Hz(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Gz(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function Xz(e){return"function"==typeof e?e:function(){return e}}var Yz={archimedean:Gz,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const Jz=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Kz=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Qz(e){zg.call(this,qz(),e)}Qz.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Jz}]},Mc(Qz,zg,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Mu("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||Kz.some((function(n){const r=e[n];return mc(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||Jz;let o,s=e.fontSize||14;if(mc(s)?o=e.fontSizeRange:s=wc(s),o){const e=s,t=zk("sqrt")().domain(Oc(r,e)).range(o);s=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Gg).layout(),u=i.size(),c=u[0]>>1,f=u[1]>>1,d=l.length;for(let e,t,n=0;n<d;++n)e=l[n],t=e.datum,t[a[0]]=e.x+c,t[a[1]]=e.y+f,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});var Zz=Object.freeze({__proto__:null,wordcloud:Qz});const eB=e=>new Uint8Array(e),tB=e=>new Uint16Array(e),nB=e=>new Uint32Array(e);function rB(e,t,n){const r=(t<257?eB:t<65537?tB:nB)(e);return n&&r.set(n),r}function iB(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function aB(){let e=nB(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=nB(s);let u,c,f,d=Array(s);for(f=0;f<s;++f)d[f]=r(i[f]),l[f]=f;if(d=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(d,l),o)u=t,c=e,t=Array(o+s),e=nB(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,f=0;for(u=0;c<r&&f<o;++u)t[c]<i[f]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[f],l[u]=a[f++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;f<o;++f,++u)s[u]=i[f],l[u]=a[f]+e}(a,u,c,o,d,l,s,t,e);else{if(a>0)for(f=0;f<s;++f)l[f]+=a;t=d,e=l}return n=o+s,{index:l,value:d}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[Hf(r,e[0],0,i),Wf(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function oB(e){zg.call(this,function(){let e=8,t=[],n=nB(0),r=rB(0,e),i=rB(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=rB(t,e,r),i=rB(t,e))}}}(),e),this._indices=null,this._dims=null}function sB(e){zg.call(this,null,e)}oB.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Mc(oB,zg,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=aB()),a.push(iB(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let m,g,y,v,b,x,w,_,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,_=v.length;w<_;++w)x[v[w]._index]=1;for(w=0;w<h;++w)k=r[w],(!o[w]||e.modified("fields",w)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(a[y]=g=aB(),p[y]=m=g.insert(k,t.source,0)),o[w]=iB(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?f.push(w):x[w]&&l[w]!==c&&d.push(w));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,f=a.length;let d,h,p,m=i.size();i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),v=i.all();for(d=0;d<f;++d)h=s[d].fname,p=l[h]||(l[h]=o[h].insert(s[d],r,m)),a[d].onAdd(p,g);for(;m<c;++m)y[m]=v,g[m]!==v&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in r)r[h].remove(d,l);return this.reindex(t,d,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],m=e.one;let g,y,v;if(f<h)for(g=f,y=Math.min(h,d);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(f>h)for(g=h,y=Math.min(f,p);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;if(d>p)for(g=Math.max(f,p),y=d;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(d<p)for(g=Math.max(h,d),y=p;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],f=o[1],d=e.one;let h,p,m;if(l<c)for(h=l,p=Math.min(c,u);h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(l>c)for(h=c,p=Math.min(l,f);h<p;++h)m=a[h],i[m]^=d,r.push(m);if(u>f)for(h=Math.max(l,f),p=u;h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(u<f)for(h=Math.max(c,u),p=f;h<p;++h)m=a[h],i[m]^=d,r.push(m);e.range=t.slice()}}),sB.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Mc(sB,zg,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,(e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null})),a.filter(a.REM,(e=>{const t=s[e]&n;return t&&!(t^t^l[e]&n)?o[e]:null}))):(a.filter(a.ADD,u),a.filter(a.REM,(e=>(s[e]&n)===i?o[e]:null))),a.filter(a.SOURCE,(e=>u(e._index)))}});var lB=Object.freeze({__proto__:null,crossfilter:oB,resolvefilter:sB});const uB="RawCode",cB="Literal",fB="Property",dB="Identifier",hB="ArrayExpression",pB="BinaryExpression",mB="CallExpression",gB="ConditionalExpression",yB="LogicalExpression",vB="MemberExpression",bB="ObjectExpression",xB="UnaryExpression";function wB(e){this.type=e}var _B,kB,OB,SB,$B;wB.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case hB:return e.elements;case pB:case yB:return[e.left,e.right];case mB:return[e.callee].concat(e.arguments);case gB:return[e.test,e.consequent,e.alternate];case vB:return[e.object,e.property];case bB:return e.properties;case fB:return[e.key,e.value];case xB:return[e.argument];case dB:case cB:case uB:default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};(_B={})[1]="Boolean",_B[2]="<end>",_B[3]="Identifier",_B[4]="Keyword",_B[5]="Null",_B[6]="Numeric",_B[7]="Punctuator",_B[8]="String",_B[9]="RegularExpression";var EB="Identifier",AB="Unexpected token %0",DB="Invalid regular expression",CB="Invalid regular expression: missing /",MB="Octal literals are not allowed in strict mode.",jB="ILLEGAL",FB="Disabled.",TB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),NB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function RB(e,t){if(!e)throw new Error("ASSERT: "+t)}function PB(e){return e>=48&&e<=57}function zB(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function BB(e){return"01234567".indexOf(e)>=0}function IB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function LB(e){return 10===e||13===e||8232===e||8233===e}function qB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&TB.test(String.fromCharCode(e))}function UB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&NB.test(String.fromCharCode(e))}const VB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function WB(){for(;OB<SB;){const e=kB.charCodeAt(OB);if(!IB(e)&&!LB(e))break;++OB}}function HB(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)OB<SB&&zB(kB[OB])?(r=kB[OB++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):lI({},AB,jB);return String.fromCharCode(i)}function GB(){var e,t,n,r;for(t=0,"}"===(e=kB[OB])&&lI({},AB,jB);OB<SB&&zB(e=kB[OB++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&lI({},AB,jB),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function XB(){var e,t;for(e=kB.charCodeAt(OB++),t=String.fromCharCode(e),92===e&&(117!==kB.charCodeAt(OB)&&lI({},AB,jB),++OB,(e=HB("u"))&&"\\"!==e&&qB(e.charCodeAt(0))||lI({},AB,jB),t=e);OB<SB&&UB(e=kB.charCodeAt(OB));)++OB,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==kB.charCodeAt(OB)&&lI({},AB,jB),++OB,(e=HB("u"))&&"\\"!==e&&UB(e.charCodeAt(0))||lI({},AB,jB),t+=e);return t}function YB(){var e,t;return e=OB,{type:1===(t=92===kB.charCodeAt(OB)?XB():function(){var e,t;for(e=OB++;OB<SB;){if(92===(t=kB.charCodeAt(OB)))return OB=e,XB();if(!UB(t))break;++OB}return kB.slice(e,OB)}()).length?3:VB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:OB}}function JB(){var e,t,n,r,i=OB,a=kB.charCodeAt(OB),o=kB[OB];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++OB,{type:7,value:String.fromCharCode(a),start:i,end:OB};default:if(61===(e=kB.charCodeAt(OB+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return OB+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:OB};case 33:case 61:return OB+=2,61===kB.charCodeAt(OB)&&++OB,{type:7,value:kB.slice(i,OB),start:i,end:OB}}}return">>>="===(r=kB.substr(OB,4))?{type:7,value:r,start:i,end:OB+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:OB+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:OB+=2}:("//"===t&&lI({},AB,jB),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++OB}:void lI({},AB,jB))}function KB(){var e,t,n;if(RB(PB((n=kB[OB]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=OB,e="","."!==n){if(e=kB[OB++],n=kB[OB],"0"===e){if("x"===n||"X"===n)return++OB,function(e){let t="";for(;OB<SB&&zB(kB[OB]);)t+=kB[OB++];return 0===t.length&&lI({},AB,jB),qB(kB.charCodeAt(OB))&&lI({},AB,jB),{type:6,value:parseInt("0x"+t,16),start:e,end:OB}}(t);if(BB(n))return function(e){let t="0"+kB[OB++];for(;OB<SB&&BB(kB[OB]);)t+=kB[OB++];return(qB(kB.charCodeAt(OB))||PB(kB.charCodeAt(OB)))&&lI({},AB,jB),{type:6,value:parseInt(t,8),octal:!0,start:e,end:OB}}(t);n&&PB(n.charCodeAt(0))&&lI({},AB,jB)}for(;PB(kB.charCodeAt(OB));)e+=kB[OB++];n=kB[OB]}if("."===n){for(e+=kB[OB++];PB(kB.charCodeAt(OB));)e+=kB[OB++];n=kB[OB]}if("e"===n||"E"===n)if(e+=kB[OB++],"+"!==(n=kB[OB])&&"-"!==n||(e+=kB[OB++]),PB(kB.charCodeAt(OB)))for(;PB(kB.charCodeAt(OB));)e+=kB[OB++];else lI({},AB,jB);return qB(kB.charCodeAt(OB))&&lI({},AB,jB),{type:6,value:parseFloat(e),start:t,end:OB}}function QB(){var e,t,n,r;return $B=null,WB(),e=OB,t=function(){var e,t,n,r;for(RB("/"===(e=kB[OB]),"Regular expression literal must start with a slash"),t=kB[OB++],n=!1,r=!1;OB<SB;)if(t+=e=kB[OB++],"\\"===e)LB((e=kB[OB++]).charCodeAt(0))&&lI({},CB),t+=e;else if(LB(e.charCodeAt(0)))lI({},CB);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||lI({},CB),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";OB<SB&&UB((e=kB[OB]).charCodeAt(0));)++OB,"\\"===e&&OB<SB?lI({},AB,jB):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&lI({},DB,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";lI({},DB)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){lI({},DB)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:OB}}function ZB(){if(WB(),OB>=SB)return{type:2,start:OB,end:OB};const e=kB.charCodeAt(OB);return qB(e)?YB():40===e||41===e||59===e?JB():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(RB("'"===(e=kB[OB])||'"'===e,"String literal must starts with a quote"),t=OB,++OB;OB<SB;){if((n=kB[OB++])===e){e="";break}if("\\"===n)if((n=kB[OB++])&&LB(n.charCodeAt(0)))"\r"===n&&"\n"===kB[OB]&&++OB;else switch(n){case"u":case"x":"{"===kB[OB]?(++OB,i+=GB()):i+=HB(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:BB(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),OB<SB&&BB(kB[OB])&&(a=!0,r=8*r+"01234567".indexOf(kB[OB++]),"0123".indexOf(n)>=0&&OB<SB&&BB(kB[OB])&&(r=8*r+"01234567".indexOf(kB[OB++]))),i+=String.fromCharCode(r)):i+=n}else{if(LB(n.charCodeAt(0)))break;i+=n}}return""!==e&&lI({},AB,jB),{type:8,value:i,octal:a,start:t,end:OB}}():46===e?PB(kB.charCodeAt(OB+1))?KB():JB():PB(e)?KB():JB()}function eI(){const e=$B;return OB=e.end,$B=ZB(),OB=e.end,e}function tI(){const e=OB;$B=ZB(),OB=e}function nI(e,t,n){const r=new wB("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function rI(e,t){const n=new wB("CallExpression");return n.callee=e,n.arguments=t,n}function iI(e){const t=new wB(EB);return t.name=e,t}function aI(e){const t=new wB("Literal");return t.value=e.value,t.raw=kB.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function oI(e,t,n){const r=new wB("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function sI(e,t,n){const r=new wB("Property");return r.key=t,r.value=n,r.kind=e,r}function lI(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(RB(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=OB,n.description=i,n}function uI(e){2===e.type&&lI(e,"Unexpected end of input"),6===e.type&&lI(e,"Unexpected number"),8===e.type&&lI(e,"Unexpected string"),3===e.type&&lI(e,"Unexpected identifier"),4===e.type&&lI(e,"Unexpected reserved word"),lI(e,AB,e.value)}function cI(e){const t=eI();7===t.type&&t.value===e||uI(t)}function fI(e){return 7===$B.type&&$B.value===e}function dI(e){return 4===$B.type&&$B.value===e}function hI(){const e=[];for(OB=$B.start,cI("[");!fI("]");)fI(",")?(eI(),e.push(null)):(e.push(SI()),fI("]")||cI(","));return eI(),function(e){const t=new wB("ArrayExpression");return t.elements=e,t}(e)}function pI(){OB=$B.start;const e=eI();return 8===e.type||6===e.type?(e.octal&&lI(e,MB),aI(e)):iI(e.value)}function mI(){var e,t,n;return OB=$B.start,3===(e=$B).type?(n=pI(),cI(":"),sI("init",n,SI())):2!==e.type&&7!==e.type?(t=pI(),cI(":"),sI("init",t,SI())):void uI(e)}function gI(){var e,t,n=[],r={},i=String;for(OB=$B.start,cI("{");!fI("}");)t="$"+((e=mI()).key.type===EB?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?lI({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),fI("}")||cI(",");return cI("}"),function(e){const t=new wB("ObjectExpression");return t.properties=e,t}(n)}const yI={if:1};function vI(){var e,t,n;if(fI("("))return function(){cI("(");const e=$I();return cI(")"),e}();if(fI("["))return hI();if(fI("{"))return gI();if(e=$B.type,OB=$B.start,3===e||yI[$B.value])n=iI(eI().value);else if(8===e||6===e)$B.octal&&lI($B,MB),n=aI(eI());else{if(4===e)throw new Error(FB);1===e?((t=eI()).value="true"===t.value,n=aI(t)):5===e?((t=eI()).value=null,n=aI(t)):fI("/")||fI("/=")?(n=aI(QB()),tI()):uI(eI())}return n}function bI(){const e=[];if(cI("("),!fI(")"))for(;OB<SB&&(e.push(SI()),!fI(")"));)cI(",");return cI(")"),e}function xI(){return cI("."),function(){OB=$B.start;const e=eI();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||uI(e),iI(e.value)}()}function wI(){cI("[");const e=$I();return cI("]"),e}function _I(){const e=function(){var e;for(e=vI();;)if(fI("."))e=oI(".",e,xI());else if(fI("("))e=rI(e,bI());else{if(!fI("["))break;e=oI("[",e,wI())}return e}();if(7===$B.type&&(fI("++")||fI("--")))throw new Error(FB);return e}function kI(){var e,t;if(7!==$B.type&&4!==$B.type)t=_I();else{if(fI("++")||fI("--"))throw new Error(FB);if(fI("+")||fI("-")||fI("~")||fI("!"))e=eI(),t=kI(),t=function(e,t){const n=new wB("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(dI("delete")||dI("void")||dI("typeof"))throw new Error(FB);t=_I()}}return t}function OI(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function SI(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=$B,l=kI(),0===(i=OI(r=$B)))return l;for(r.prec=i,eI(),t=[e,$B],a=[l,r,o=kI()];(i=OI($B))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=nI(s,l,o),a.push(n);(r=eI()).prec=i,a.push(r),t.push($B),n=kI(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=nI(a[u-1].value,a[u-2],n),u-=2;return n}(),fI("?")&&(eI(),t=SI(),cI(":"),e=function(e,t,n){const r=new wB("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,SI())),e}function $I(){const e=SI();if(fI(","))throw new Error(FB);return e}function EI(e){OB=0,SB=(kB=e).length,$B=null,tI();const t=$I();if(2!==$B.type)throw new Error("Unexpect token after expression.");return t}var AI={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function DI(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Mu("Missing arguments to clamp function."),t.length>3&&Mu("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),replace:t("replace",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&Mu("Missing arguments to if function."),t.length>3&&Mu("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}const CI="intersect",MI="union";var jI="index:unit";function FI(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=Fu.getter||Fu(r.field),Tc(n=r.getter(e))&&(n=Yu(n)),Tc(a[s])&&(a[s]=Yu(a[s])),Tc(a[s][0])&&(a[s]=a[s].map(Yu)),"E"===r.type){if(qu(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!jc(n,a[s]))return!1}else if("R-RE"===r.type){if(!jc(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!jc(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!jc(n,a[s],!1,!0))return!1;return!0}var TI={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=Yu(t[0]),r=Yu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Yu(t[0]),r=Yu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function NI(e,t,n,r){t[0].type!==cB&&Mu("First argument to selection functions must be a string literal.");const i=t[0].value,a="unit",o="@unit",s=":"+i;(t.length>=2&&Xu(t).value)!==CI||Ec(r,o)||(r["@unit"]=n.getData(i).indataRef(n,a)),Ec(r,s)||(r[s]=n.getData(i).tuplesRef())}function RI(e){const t=this.context.data[e];return t?t.values.value:[]}const PI=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},zI=PI("format"),BI=PI("timeFormat"),II=PI("utcFormat"),LI=PI("timeParse"),qI=PI("utcParse"),UI=new Date(2e3,0,1);function VI(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(UI.setYear(2e3),UI.setMonth(e),UI.setDate(t),BI.call(this,UI,n)):""}function WI(e,t,n,r){t[0].type!==cB&&Mu("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!Ec(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function HI(e,t,n,r){if(t[0].type===cB)GI(n,r,t[0].value);else for(e in n.scales)GI(n,r,e)}function GI(e,t,n){const r="%"+n;if(!Ec(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function XI(e,t){let n;return mc(e)?e:zc(e)?(n=t.scales[e])&&n.value:void 0}function YI(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=HI,n._range=HI,n._scale=HI;const r=t=>"_["+(t.type===cB?Hc("%"+t.value):Hc("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}function JI(e,t){return function(n,r,i){if(n){const t=XI(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const KI=JI("area",(function(e){return NM=new Gf,yM(e,RM),2*NM})),QI=JI("bounds",(function(e){var t,n,r,i,a,o,s;if($M=SM=-(kM=OM=1/0),jM=[],yM(e,cj),n=jM.length){for(jM.sort(bj),t=1,a=[r=jM[0]];t<n;++t)xj(r,(i=jM[t])[0])||xj(r,i[1])?(vj(r[0],i[1])>vj(r[0],r[1])&&(r[1]=i[1]),vj(i[0],r[1])>vj(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=vj(r[1],i[0]))>o&&(o=s,kM=i[0],SM=r[1])}return jM=FM=null,kM===1/0||OM===1/0?[[NaN,NaN],[NaN,NaN]]:[[kM,OM],[SM,$M]]})),ZI=JI("centroid",(function(e){XM=YM=JM=KM=QM=ZM=ej=tj=0,nj=new Gf,rj=new Gf,ij=new Gf,yM(e,wj);var t=+nj,n=+rj,r=+ij,i=nM(t,n,r);return i<UC&&(t=ZM,n=ej,r=tj,YM<qC&&(t=JM,n=KM,r=QM),(i=nM(t,n,r))<UC)?[NaN,NaN]:[QC(n,t)*XC,cM(r/i)*XC]}));function eL(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function tL(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function nL(e){const t=Gx(e);return.2126*tL(t.r)+.7152*tL(t.g)+.0722*tL(t.b)}function rL(e,t){return e===t||e!=e&&t!=t||(qu(e)?!(!qu(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!rL(e[n],t[n]))return!1;return!0}(e,t):!(!Uu(e)||!Uu(t))&&iL(e,t))}function iL(e,t){for(const n in e)if(!rL(e[n],t[n]))return!1;return!0}function aL(e){return t=>iL(e,t)}const oL=e=>e.data;function sL(e,t){const n=RI.call(t,e);return n.root&&n.root.lookup||{}}const lL=()=>"undefined"!=typeof window&&window||null;const uL={random:()=>Gg(),cumulativeNormal:ty,cumulativeLogNormal:sy,cumulativeUniform:hy,densityNormal:ey,densityLogNormal:oy,densityUniform:dy,quantileNormal:ny,quantileLogNormal:ly,quantileUniform:py,sampleNormal:Zg,sampleLogNormal:ay,sampleUniform:fy,isArray:qu,isBoolean:Fc,isDate:Tc,isDefined:e=>void 0!==e,isNumber:Rc,isObject:Uu,isRegExp:Pc,isString:zc,isTuple:ig,isValid:e=>null!=e&&e==e,toBoolean:Gc,toDate:Yc,toNumber:Yu,toString:Jc,flush:Cc,lerp:Ic,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),kc(...e)},pad:Vc,peek:Xu,span:Wc,inrange:jc,truncate:Qc,rgb:Gx,lab:fw,hcl:vw,hsl:ew,luminance:nL,contrast:function(e,t){const n=nL(e),r=nL(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:ld,format:zI,utcFormat:II,utcParse:qI,utcOffset:Hh,utcSequence:Yh,timeFormat:BI,timeParse:LI,timeOffset:Wh,timeSequence:Xh,timeUnitSpecifier:yh,monthFormat:function(e){return VI.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return VI.call(this,e,1,"%b")},dayFormat:function(e){return VI.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return VI.call(this,0,2+e,"%a")},quarter:fc,utcquarter:dc,week:wh,utcweek:Eh,dayofyear:xh,utcdayofyear:$h,warn:function(){return eL(this.context.dataflow,"warn",arguments)},info:function(){return eL(this.context.dataflow,"info",arguments)},debug:function(){return eL(this.context.dataflow,"debug",arguments)},extent:Oc,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new wS).set(r[0],r[1],i[0],i[1]);return HA(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=hc(e.marktype),r=hc(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:pc,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=lL();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=lL();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return uk(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(zu).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?VO(n,t=t||FO(e)):e}},panLinear:nc,panLog:rc,panPow:ic,panSymlog:ac,zoomLinear:sc,zoomLog:lc,zoomPow:uc,zoomSymlog:cc,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,f,d=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!d||d.stamp<u)&&(s.changes=d=o.changeset(),d.stamp=u,o.runAfter((()=>{s.modified=!0,o.pulse(l,d).run()}),!0,1)),n&&(c=!0===n?zu:qu(n)||ig(n)?n:aL(n),d.remove(c)),t&&d.insert(t),r&&(c=aL(r),l.value.some(c)?d.remove(c):d.insert(r)),i)for(f in a)d.modify(i,f,a[f]);return 1}},cL=["view","item","group","xy","x","y"],fL="this.",dL={},hL={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(Hc("$"+e),"]"),functions:function(e){const t=DI(e);cL.forEach((e=>t[e]="event.vega."+e));for(const e in uL)t[e]=fL+e;return kc(t,YI(e,uL,dL)),t},constants:AI,visitors:dL},pL=function(e){const t=(e=e||{}).allowed?Kc(e.allowed):{},n=e.forbidden?Kc(e.forbidden):{},r=e.constants||AI,i=(e.functions||DI)(f),a=e.globalvar,o=e.fieldvar,s=mc(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function f(e){if(zc(e))return e;const t=d[e.type];return null==t&&Mu("Unsupported type: "+e.type),t(e)}const d={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:Ec(n,i)?Mu("Illegal identifier: "+i):Ec(r,i)?r[i]:Ec(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(c+=1);const r=f(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&Mu("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=Ec(i,t)&&i[t];return r||Mu("Unrecognized function: "+t),mc(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{c+=1;const t=f(e.key);return c-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return h.functions=i,h.constants=r,h}(hL);function mL(e,t,n){return 1===arguments.length?uL[e]:(uL[e]=t,n&&(dL[e]=n),pL&&(pL.functions[e]=fL+e),this)}function gL(e,t){const n={};let r;try{r=EI(e=zc(e)?e:Hc(e)+"")}catch(t){Mu("Expression parse error: "+e)}r.visit((e=>{if(e.type!==mB)return;const r=e.callee.name,i=hL.visitors[r];i&&i(r,e.arguments,t,n)}));const i=pL(r);return i.globals.forEach((e=>{const r="$"+e;!Ec(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:kc({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}mL("bandwidth",(function(e,t){const n=XI(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),HI),mL("copy",(function(e,t){const n=XI(e,(t||this).context);return n?n.copy():void 0}),HI),mL("domain",(function(e,t){const n=XI(e,(t||this).context);return n?n.domain():[]}),HI),mL("range",(function(e,t){const n=XI(e,(t||this).context);return n&&n.range?n.range():[]}),HI),mL("invert",(function(e,t,n){const r=XI(e,(n||this).context);return r?qu(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),HI),mL("scale",(function(e,t,n){const r=XI(e,(n||this).context);return r?r(t):void 0}),HI),mL("gradient",(function(e,t,n,r,i){e=XI(e,(i||this).context);const a=AO(t,n);let o=e.domain(),s=o[0],l=Xu(o),u=Nu;return l-s?u=Kk(e,s,l):e=(e.interpolator?zk("sequential")().interpolator(e.interpolator()):zk("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==Xu(o)&&o.push(l)),o.forEach((t=>a.stop(u(t),e(t)))),a}),HI),mL("geoArea",KI,HI),mL("geoBounds",QI,HI),mL("geoCentroid",ZI,HI),mL("geoShape",(function(e,t,n){const r=XI(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),HI),mL("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==cB&&Mu("First argument to indata must be a string literal."),t[1].type!==cB&&Mu("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;Ec(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),mL("data",RI,WI),mL("treePath",(function(e,t,n){const r=sL(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(oL):void 0}),WI),mL("treeAncestors",(function(e,t){const n=sL(e,this)[t];return n?n.ancestors().map(oL):void 0}),WI),mL("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[jI]&&l[jI].value:void 0,f=n===CI,d=u.length,h=0;h<d;++h)if(r=u[h],c&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=FI(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(f^(s=FI(t,r)))return s;return d&&f}),NI),mL("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,f,d,h,p=this.context.data[e],m=p?p.values.value:[],g={},y={},v={},b=m.length,x=0;x<b;++x){for(o=(r=m[x]).unit,i=r.fields,a=r.values,d=0,h=i.length;d<h;++d)s=i[d],u=(l=g[s.field]||(g[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),f=TI[c+"_union"],l[o]=f(u,hc(a[d]));n&&(u=y[o]||(y[o]=[])).push(hc(a).reduce(((e,t,n)=>(e[i[n].field]=t,e)),{}))}return t=t||MI,Object.keys(g).forEach((e=>{g[e]=Object.keys(g[e]).map((t=>g[e][t])).reduce(((n,r)=>void 0===n?r:TI[v[e]+"_"+t](n,r)))})),m=Object.keys(y),n&&m.length&&(g.vlMulti=t===MI?{or:m.reduce(((e,t)=>(e.push(...y[t]),e)),[])}:{and:m.map((e=>({or:y[e]})))}),g}),NI);const yL=Kc(["rule"]),vL=Kc(["group","image","rect"]);function bL(e){return(e+"").toLowerCase()}function xL(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var wL={operator:(e,t)=>xL(e,["_"],t.code),parameter:(e,t)=>xL(e,["datum","_"],t.code),event:(e,t)=>xL(e,["event"],t.code),handler:(e,t)=>xL(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+Hc(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return yL[t]||(e.x2&&(e.x?(vL[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(vL[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",xL(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(Hc).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function _L(e,t,n){if(!e||!Uu(e))return e;for(let r,i=0,a=kL.length;i<a;++i)if(r=kL[i],Ec(e,r.key))return r.parse(e,t,n);return e}var kL=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Mu("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Bc(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=Su(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Fu(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=Su(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=hc(e.$compare).map((e=>e&&e.$tupleid?ag:e));return t.fn[n]||(t.fn[n]=gc(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return ag}}];const OL={skip:!0};function SL(e,t,n,r){return new $L(e,t,n,r)}function $L(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||wL,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function EL(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function AL(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}$L.prototype=EL.prototype={fork(){const e=new EL(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(e){return"collect"===bL(e)}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[bL(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;!function(e){return"operator"===bL(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Mu("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=qu(i)?i.map((e=>_L(e,n,t))):_L(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&Mu("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=Uu(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||Mu("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],OL)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(zu).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const DL="default";function CL(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function ML(e,t){var n=e._runtime.data;return Ec(n,t)||Mu("Unrecognized data set: "+t),n[t]}function jL(e,t){dg(t)||Mu("Second argument to changes must be a changeset.");const n=ML(this,e);return n.modified=!0,this.pulse(n.input,t)}function FL(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function TL(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function NL(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function RL(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=NL(e),(r=ME(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;zc(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:wc(e),item:wc(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}const PL="view",zL={trap:!1};function BL(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||Uu(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function IL(e){return e.item}function LL(e){return e.item.mark.source}function qL(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function UL(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}const VL="vega-bind",WL="vega-bind-name";function HL(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=_c(r.debounce,i.update))),function(e,t,n,r){const i=UL("div",{class:VL}),a="radio"===n.input?i:i.appendChild(UL("label"));a.appendChild(UL("span",{class:WL},n.name||n.signal)),t.appendChild(i);let o=GL;switch(n.input){case"checkbox":o=XL;break;case"select":o=YL;break;case"radio":o=JL;break;case"range":o=KL}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0),i}function GL(e,t,n,r){const i=UL("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function XL(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=UL("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function YL(e,t,n,r){const i=UL("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};QL(e,r)&&(n.selected=!0),i.appendChild(UL("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(QL(n.options[t],e))return void(i.selectedIndex=t)}}function JL(e,t,n,r){const i=UL("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,o)=>{const s={type:"radio",name:n.signal,value:t};QL(t,r)&&(s.checked=!0);const l=UL("input",s);l.addEventListener("change",(()=>e.update(t)));const u=UL("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)QL(n[e].value,t)&&(n[e].checked=!0)}}function KL(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Zf(a,i,100),s=UL("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=UL("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function QL(e,t){return e===t||e+""==t+""}function ZL(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,FL(e),TL(e),NL(e),i,a).background(e.background())}function eq(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function tq(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const nq=e=>+e||0;function rq(e){return Uu(e)?{top:nq(e.top),bottom:nq(e.bottom),left:nq(e.left),right:nq(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(nq(e))}async function iq(e,t,n,r){const i=WA(t),a=i&&i.headless;return a||Mu("Unrecognized renderer type: "+t),await e.runAsync(),ZL(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var aq="width",oq="height",sq="padding",lq={skip:!0};function uq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===sq?r.left+r.right:0)}function cq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===sq?r.top+r.bottom:0)}function fq(e,t){return t.modified&&qu(t.input.value)&&e.indexOf("_:vega:_")}function dq(e,t){return!("parent"===e||t instanceof Bg.proxy)}function hq(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":qu(e)?pq(e):Uu(e)&&!Tc(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(qu(n)?pq(n):mq(n))})).join("\n")):e+"";var t}(r))}function pq(e){return"["+e.map(mq).join(", ")+"]"}function mq(e){return qu(e)?"[…]":Uu(e)&&!Tc(e)?"{…}":e}function gq(e,t){const n=this;if(t=t||{},Rg.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=kc({},e.locale,t.locale);n.locale(Jm(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||UA.Canvas,n._scenegraph=new OE;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||hq,n._redraw=!0,n._handler=(new JE).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=kc({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{qu(e[t])&&(e[t]=Kc(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return SL(e,Bg,uL,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:kc({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=uq(n,n._width),n._viewHeight=cq(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=uq(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=cq(e,t.size),a()}),{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:DL,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?zc(r)?r:r.user:DL,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return zc(n)||(r=n.item,n=n.user),CL(e,n&&n!==DL?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function yq(e,t){return Ec(e._signals,t)?e._signals[t]:Mu("Unrecognized signal name: "+Hc(t))}function vq(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function bq(e,t,n,r){let i=vq(n,r);return i||(i=eq(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function xq(e,t,n){const r=vq(t,n);return r&&t._targets.remove(r),e}Mc(gq,Rg,{async evaluate(e,t,n){if(await Rg.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(e){var t=NL(e),n=FL(e),r=TL(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach((t=>{try{t(n,r)}catch(t){e.error(t)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}return n&&tg(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&AL(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=yq(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",rq(e)):rq(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(WA(e)||Mu("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Rg.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(yq(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(aq,n,lq),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(oq,r,lq),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=eq(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return bq(this,e,yq(this,e),t)},removeSignalListener(e,t){return xq(this,yq(this,e),t)},addDataListener(e,t){return bq(this,e,ML(this,e).values,t)},removeDataListener(e,t){return xq(this,ML(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=CL(this,null);this._globalCursor=!!e,t&&CL(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new sR,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?aR():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new wg(n),o=function(n,r){i.runAsync(null,(()=>{e===PL&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(RL(i,n,r))}))};if("timer"===e)BL(i,"timer",t)&&i.timer(o,t);else if(e===PL)BL(i,"view",t)&&i.addEventListener(t,o,zL);else if("window"===e?BL(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&BL(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",IL),LL,qL(e)),this.on(this.events("view","mouseout",IL),LL,qL(t)),this},data:function(e,t){return arguments.length<2?ML(this,e).values.value:jL.call(this,e,hg().remove(zu).insert(t))},change:jL,insert:function(e,t){return jL.call(this,e,hg().insert(t))},remove:function(e,t){return jL.call(this,e,hg().remove(t))},scale:function(e){var t=this._runtime.scales;return Ec(t,e)||Mu("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=WA(r);e=n._el=e?tq(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),AL(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||JE,s=e?a.renderer:a.headless;return n._renderer=s?ZL(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),eq(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,NL(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=tq(n,t):e.appendChild(UL("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=tq(n,e.param.element))})),n._bind.forEach((e=>{HL(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==UA.Canvas&&e!==UA.SVG&&e!==UA.PNG&&Mu("Unrecognized image type: "+e);const n=await iq(this,e,t);return e===UA.SVG?function(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await iq(this,UA.Canvas,e,t)).canvas()},toSVG:async function(e){return(await iq(this,UA.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:fq,signals:dq,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const wq="[",_q="]",kq=/[[\]{}]/,Oq={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let Sq,$q;function Eq(e,t,n){return Sq=t||"view",$q=n||Oq,Dq(e.trim()).map(Cq)}function Aq(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function Dq(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=Aq(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function Cq(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=Aq(e,r,_q,wq,_q),r===t)throw"Empty between selector: "+e;if(n=Dq(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(Cq);const i=Cq(e.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(e):function(e){const t={source:Sq},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(u+1,l-1))}catch(t){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;"@"===e[0]&&(o=++u);r=Aq(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r);if(u=Aq(e,u,wq),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=Aq(e,u,_q),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&e[++u]!==wq)throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||kq.test(n[l-1]))throw"Invalid event selector: "+e;l>1?(t.type=n[1],o?t.markname=n[0].slice(1):!function(e){return $q[e]}(n[0])?t.source=n[0]:t.marktype=n[0]):t.type=n[0];"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1));null!=i&&(t.filter=i);a[0]&&(t.throttle=a[0]);a[1]&&(t.debounce=a[1]);return t}(e)}function Mq(e){return Uu(e)?e:{type:e||"pad"}}const jq=e=>+e||0;function Fq(e){return Uu(e)?e.signal?e:{top:jq(e.top),bottom:jq(e.bottom),left:jq(e.left),right:jq(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(jq(e))}const Tq=e=>Uu(e)&&!qu(e)?kc({},e):{value:e};function Nq(e,t,n,r){if(null!=n){return Uu(n)&&!qu(n)||qu(n)&&n.length&&Uu(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1}return 0}function Rq(e,t,n){for(const n in t)Nq(e,n,t[n]);for(const t in n)Nq(e,t,n[t],"update")}function Pq(e,t,n){for(const r in t)n&&Ec(n,r)||(e[r]=kc(e[r]||{},t[r]));return e}function zq(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const Bq="mark",Iq="frame",Lq="scope",qq="legend-label",Uq="title-text",Vq="title-subtitle";function Wq(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const Hq=e=>zc(e)?Hc(e):e.signal?"(".concat(e.signal,")"):Jq(e);function Gq(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:Hc(e)));for(;t.length&&null==Xu(t);)t.pop();return t.unshift(Hq(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?Xq("hcl",e.h,e.c,e.l):e.h||e.s?Xq("hsl",e.h,e.s,e.l):e.l||e.a?Xq("lab",e.l,e.a,e.b):e.r||e.g||e.b?Xq("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?Jq(e.field):void 0!==e.value?Hc(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=Hq(e.scale);null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+Yq(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0"));return t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(Yq(e.exponent),")")),null!=e.mult&&(t+="*".concat(Yq(e.mult))),null!=e.offset&&(t+="+".concat(Yq(e.offset))),e.round&&(t="round(".concat(t,")")),t}const Xq=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(Gq).join(","),")+'')");function Yq(e){return Uu(e)?"("+Gq(e)+")":e}function Jq(e){return Kq(Uu(e)?e:{datum:e})}function Kq(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):Mu("Invalid field reference: "+Hc(e));return e.signal||(r=zc(r)?ju(r).map(Hc).join("]["):Kq(r)),t+"["+r+"]"}function Qq(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||zq(l,e)||Wq(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===Iq?i.group:n===Bq?kc({},i.mark,i[t]):null,c)u=zq(l,e)||("fill"===l||"stroke"===l)&&(zq("fill",e)||zq("stroke",e)),u||Wq(a,l,c[l]);for(l in hc(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)zq(t,e)||Wq(a,t,n[t])})),e=kc({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=kc(o,e.enter),s&&(e.update=kc(s,e.update)),e}(e,t,n,r,i.config);for(const n in e)o[n]=Zq(e[n],t,a,i);return a}function Zq(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=eU((o=e[t],qu(o)?function(e){let t="";return e.forEach((e=>{const n=Gq(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n})),":"===Xu(t)&&(t+="null"),t}(o):Gq(o)),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function eU(e,t,n,r){const i=gL(e,t);return i.$fields.forEach((e=>r[e]=1)),kc(n,i.$params),i.$expr}const tU=["value","update","init","react","bind"];function nU(e,t){Mu(e+' for "outer" push: '+Hc(t))}function rU(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||nU("No prior signal definition",n),tU.forEach((t=>{void 0!==e[t]&&nU("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function iU(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function aU(e,t,n,r){return new iU(e,t,n,r)}function oU(e,t){return aU("operator",e,t)}function sU(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function lU(e,t){return t?{$field:e,$name:t}:{$field:e}}const uU=lU("key");function cU(e,t){return{$compare:e,$order:t}}function fU(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const dU="scope",hU="view";function pU(e){return e&&e.signal}function mU(e){if(pU(e))return!0;if(Uu(e))for(const t in e)if(mU(e[t]))return!0;return!1}function gU(e,t){return null!=e?e:t}function yU(e){return e&&e.signal||e}const vU="timer";function bU(e,t){return(e.merge?xU:e.stream?wU:e.type?_U:Mu("Invalid stream specification: "+Hc(e)))(e,t)}function xU(e,t){const n=kU({merge:e.merge.map((e=>bU(e,t)))},e,t);return t.addStream(n).id}function wU(e,t){const n=kU({stream:bU(e.stream,t)},e,t);return t.addStream(n).id}function _U(e,t){let n;e.type===vU?(n=t.event(vU,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===dU?hU:e||hU}(e.source),e.type);const r=kU({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function kU(e,t,n){let r=t.between;return r&&(2!==r.length&&Mu('Stream "between" parameter must have 2 entries: '+Hc(t)),e.between=[bU(r[0],n),bU(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===dU&&r.push("inScope(event.item)"),r.length&&(e.filter=gL("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const OU={code:"_.$value",ast:{type:"Identifier",value:"value"}};function SU(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||Mu("Signal update missing events specification."),zc(a)&&(a=Eq(a,t.isSubscope()?dU:hU)),a=hc(a).filter((e=>e.signal||e.scale?(s.push(e),0):1)),s.length>1&&(s=[$U(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&Mu("Signal encode and update are mutually exclusive."),o="encode(item(),"+Hc(r)+")"),i.update=zc(o)?gL(o,t):null!=o.expr?gL(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:OU,$params:{$value:t.signalRef(o.signal)}}:Mu("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((e=>t.addUpdate(kc(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):bU(e,t)}}(e,t),i))))}function $U(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const EU=e=>(t,n,r)=>aU(e,n,t||void 0,r),AU=EU("aggregate"),DU=EU("axisticks"),CU=EU("bound"),MU=EU("collect"),jU=EU("compare"),FU=EU("datajoin"),TU=EU("encode"),NU=EU("expression"),RU=EU("facet"),PU=EU("field"),zU=EU("key"),BU=EU("legendentries"),IU=EU("load"),LU=EU("mark"),qU=EU("multiextent"),UU=EU("multivalues"),VU=EU("overlap"),WU=EU("params"),HU=EU("prefacet"),GU=EU("projection"),XU=EU("proxy"),YU=EU("relay"),JU=EU("render"),KU=EU("scale"),QU=EU("sieve"),ZU=EU("sortitems"),eV=EU("viewlayout"),tV=EU("values");let nV=0;const rV={min:"min",max:"max",count:"sum"};function iV(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=lV(e.domain,e,t),null!=e.range&&(n.range=gV(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=aV(e.type||e),null!=e.gamma&&(t.interpolateGamma=aV(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return Uu(e)?{interval:aV(e.interval),step:aV(e.step)}:aV(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||qu(e)?oV(e,t):t.objectProperty(e)}(e.bins,t)),e)Ec(n,r)||"name"===r||(n[r]=aV(e[r],t))}function aV(e,t){return Uu(e)?e.signal?t.signalRef(e.signal):Mu("Unsupported object: "+Hc(e)):e}function oV(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>aV(e,t)))}function sV(e){Mu("Can not find data set: "+Hc(e))}function lV(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(qu(e)?uV:e.fields?fV:cV)(e,t,n);null==t.domainMin&&null==t.domainMax||Mu("No scale domain defined for domainMin/domainMax to override.")}function uV(e,t,n){return e.map((e=>aV(e,n)))}function cV(e,t,n){const r=n.getData(e.data);return r||sV(e.data),qk(t.type)?r.valuesRef(n,e.field,hV(e.sort,!1)):Hk(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function fV(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=zc(t)?{data:r,field:t}:qu(t)||t.signal?function(e,t){const n="_:vega:_"+nV++,r=MU({});if(qu(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+Hc(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,QU({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(qk(t.type)?dV:Hk(t.type)?pV:mV)(e,n,i)}function dV(e,t,n){const r=hV(e.sort,!0);let i,a;const o=n.map((e=>{const n=t.getData(e.data);return n||sV(e.data),n.countsRef(t,e.field,r)})),s={groupby:uU,pulse:o};r&&(i=r.op||"count",a=r.field?fU(i,r.field):"count",s.ops=[rV[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(AU(s));const l=t.add(MU({pulse:sU(i)}));return a=t.add(tV({field:uU,sort:t.sortRef(r),pulse:sU(l)})),sU(a)}function hV(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!rV[e.op]&&Mu("Multiple domain scales can not be sorted using "+e.op):Mu("No field provided for sort aggregate op: "+e.op):Uu(e)?e.field="key":e={field:"key"}),e}function pV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||sV(e.data),n.domainRef(t,e.field)}));return sU(t.add(UU({values:r})))}function mV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||sV(e.data),n.extentRef(t,e.field)}));return sU(t.add(qU({extents:r})))}function gV(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(zc(i)){if(r&&Ec(r,i))return gV(e=kc({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=qk(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Mu("Unrecognized scale range value: "+Hc(i))}else{if(i.scheme)return n.scheme=qu(i.scheme)?oV(i.scheme,t):aV(i.scheme,t),i.extent&&(n.schemeExtent=oV(i.extent,t)),void(i.count&&(n.schemeCount=aV(i.count,t)));if(i.step)return void(n.rangeStep=aV(i.step,t));if(qk(e.type)&&!qu(i))return lV(i,e,t);qu(i)||Mu("Unsupported range type: "+Hc(i))}return i.map((e=>(qu(e)?oV:aV)(e,t)))}function yV(e,t,n){return qu(e)?e.map((e=>yV(e,t,n))):Uu(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Mu("Unsupported parameter object: "+Hc(e)):e}const vV="top",bV="left",xV="right",wV="bottom",_V="center",kV="index",OV="label",SV="perc",$V="value",EV="guide-label",AV="guide-title",DV="group-title",CV="group-subtitle",MV="symbol",jV="gradient",FV="discrete",TV="size",NV=[TV,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],RV={name:1,style:1,interactive:1},PV={value:0},zV={value:1},BV="group",IV="rect",LV="rule",qV="text";function UV(e){return e.type=BV,e.interactive=e.interactive||!1,e}function VV(e,t){const n=(n,r)=>gU(e[n],gU(t[n],r));return n.isVertical=n=>"vertical"===gU(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>gU(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>gU(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>gU(e.columns,gU(t.columns,+n.isVertical(!0))),n}function WV(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function HV(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const GV=HV(Hc(bV),Hc(xV),Hc(_V));function XV(e,t){return t?e?Uu(e)?Object.assign({},e,{offset:XV(e.offset,t)}):{value:e,offset:t}:t:e}function YV(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Pq(e.encode,t,RV)):e.interactive=!1,e}function JV(e,t,n,r){const i=VV(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,f,d;a?(u=[0,1],c=[0,0],f=o,d=s):(u=[0,0],c=[1,0],f=s,d=o);const h={enter:l={opacity:PV,x:PV,y:PV,width:Tq(f),height:Tq(d)},update:kc({},l,{opacity:zV,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:PV}};return Rq(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),YV({type:IV,role:"legend-gradient",encode:h},r)}function KV(e,t,n,r,i){const a=VV(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,f,d,h="";o?(u="y",f="y2",c="x",d="width",h="1-"):(u="x",f="x2",c="y",d="height");const p={opacity:PV,fill:{scale:t,field:$V}};p[u]={signal:h+"datum."+SV,mult:l},p[c]=PV,p[f]={signal:h+"datum.perc2",mult:l},p[d]=Tq(s);const m={enter:p,update:kc({},p,{opacity:zV}),exit:{opacity:PV}};return Rq(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),YV({type:IV,role:"legend-band",key:$V,from:i,encode:m},r)}const QV="datum.".concat(SV,'<=0?"').concat(bV,'":datum.').concat(SV,'>=1?"').concat(xV,'":"').concat(_V,'"'),ZV="datum.".concat(SV,'<=0?"').concat(wV,'":datum.').concat(SV,'>=1?"').concat(vV,'":"').concat("middle",'"');function eW(e,t,n,r){const i=VV(e,t),a=i.isVertical(),o=Tq(i.gradientThickness()),s=i.gradientLength();let l,u,c,f,d=i("labelOverlap"),h="";const p={enter:l={opacity:PV},update:u={opacity:zV,text:{field:OV}},exit:{opacity:PV}};return Rq(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:gU(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:ZV},c="y",f="x",h="1-"):(l.align=u.align={signal:QV},l.baseline={value:"top"},c="x",f="y"),l[c]=u[c]={signal:h+"datum."+SV,mult:s},l[f]=u[f]=o,o.offset=gU(e.labelOffset,t.gradientLabelOffset)||0,d=d?{separation:i("labelSeparation"),method:d,order:"datum.index"}:void 0,YV({type:qV,role:qq,style:EV,key:$V,from:r,encode:p,overlap:d},n)}function tW(e,t,n,r,i){const a=VV(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(TV),h=u?Tq(u):{field:TV},p="datum.".concat(kV),m="max(1, ".concat(i,")");let g,y,v,b,x;h.mult=.5,g={enter:y={opacity:PV,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:zV,x:y.x,y:y.y},exit:{opacity:PV}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Rq(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),NV.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:$V})}));const k=YV({type:"symbol",role:"legend-symbol",key:$V,from:f,clip:!!u||void 0,encode:g},n.symbols),O=Tq(c);O.offset=a("labelOffset"),g={enter:y={opacity:PV,x:{signal:d,offset:O},y:h},update:v={opacity:zV,text:{field:OV},x:y.x,y:y.y},exit:{opacity:PV}},Rq(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const S=YV({type:qV,role:qq,style:EV,key:$V,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:PV,height:u?Tq(u):PV,opacity:PV},exit:{opacity:PV},update:v={opacity:zV,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(m,")"),v.column.signal="".concat(p," % ").concat(m),x={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),UV({role:Lq,from:r={facet:{data:r,name:"value",groupby:kV}},encode:Pq(g,o,RV),marks:[k,S],name:l,interactive:s,sort:x})}const nW='item.orient === "left"',rW='item.orient === "right"',iW="(".concat(nW," || ").concat(rW,")"),aW="datum.vgrad && ".concat(iW),oW=HV('"top"','"bottom"','"middle"'),sW=HV('"right"','"left"','"center"'),lW="datum.vgrad && ".concat(rW," ? (").concat(sW,") : (").concat(iW," && !(datum.vgrad && ").concat(nW,')) ? "left" : ').concat(GV),uW="item._anchor || (".concat(iW,' ? "middle" : "start")'),cW="".concat(aW," ? (").concat(nW," ? -90 : 90) : 0"),fW="".concat(iW," ? (datum.vgrad ? (").concat(rW,' ? "bottom" : "top") : ').concat(oW,') : "top"');function dW(e,t){let n;return Uu(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+hW(e.path)+")":e.sphere&&(n="geoShape("+hW(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function hW(e){return Uu(e)&&e.signal?e.signal:Hc(e)}function pW(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===BV?Lq:t||Bq:t}function mW(e){return{marktype:e.type,name:e.name||void 0,role:e.role||pW(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function gW(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function yW(e,t){const n=Ig(e.type);n||Mu("Unrecognized transform type: "+Hc(e.type));const r=aU(n.type.toLowerCase(),null,vW(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function vW(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=bW(i,t,n)}return r}function bW(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){zc(t.from)||Mu('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(qu(r)||Mu("Expected an array of sub-parameters. Instead: "+Hc(r)),r.map((t=>wW(e,t,n)))):wW(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!pU(i)?i.map((t=>xW(e,t,n))):xW(e,i,n):void(e.required&&Mu("Missing required "+Hc(t.type)+" parameter: "+Hc(e.name)))}function xW(e,t,n){const r=e.type;if(pU(t))return SW(r)?Mu("Expression references can not be signals."):$W(r)?n.fieldRef(t):EW(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||$W(r);return i&&_W(t)?n.exprRef(t.expr,t.as):i&&kW(t)?lU(t.field,t.as):SW(r)?gL(t,n):OW(r)?sU(n.getData(t).values):$W(r)?lU(t):EW(r)?n.compareRef(t):t}}function wW(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||Mu("Unsupported parameter: "+Hc(t));const a=kc(vW(i,t,n),i.key);return sU(n.add(WU(a)))}const _W=e=>e&&e.expr,kW=e=>e&&e.field,OW=e=>"data"===e,SW=e=>"expr"===e,$W=e=>"field"===e,EW=e=>"compare"===e;function AW(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:sU(t.getData(e.data).output)}function DW(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function CW(e){return zc(e)?e:null}function MW(e,t,n){const r=fU(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function jW(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return Uu(e)?("descending"===e.order?"-":"+")+fU(e.op,e.field):""}(a);let u,c,f=CW(i);if(null!=f&&(e=t.scope,f+=l?"|"+l:"",u=s[f]),!u){const n=a?{field:uU,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:sU(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(aU(r,void 0,n)),o&&(t.index[i]=c),u=sU(c),null!=f&&(s[f]=u)}return u}function FW(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(oU()),u=gL("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function TW(e,t){const n=pW(e),r=e.type===BV,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,f,d,h=e.layout||n===Lq||n===Iq;const p=n===Bq||h||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||Mu("Only group marks can be faceted."),null!=r.field?o=s=AW(r,n):(e.data?s=sU(n.getData(e.data).aggregate):(a=yW(kc({type:"aggregate",groupby:hc(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=AW(r,n),o=s=sU(n.add(a))),i=n.keyRef(r.groupby,!0))):o=sU(n.add(MU(null,[{}]))),o||(o=AW(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(FU({key:m.key||(e.key?lU(e.key):void 0),pulse:m.pulse,clean:!r}));const g=sU(s);s=l=t.add(MU({pulse:g})),s=t.add(LU({markdef:mW(e),interactive:gW(e.interactive,t),clip:dW(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:sU(s)}));const y=sU(s);s=u=t.add(TU(Qq(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=yW(e,t),r=n.metadata;(r.generates||r.changes)&&Mu("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=sU(s),t.add(s=n)})),e.sort&&(s=t.add(ZU({sort:t.compareRef(e.sort),pulse:sU(s)})));const v=sU(s);(i||h)&&(h=t.add(eV({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),f=sU(h));const b=t.add(CU({mark:y,pulse:f||v}));d=sU(b),r&&(p&&(o=t.operators,o.pop(),h&&o.pop()),t.pushState(v,f||d,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=AW(r,t);let o;r.name||Mu("Facet must have a name: "+Hc(r)),r.data||Mu("Facet must reference a data set: "+Hc(r)),r.field?o=t.add(HU({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(RU({key:t.keyRef(r.groupby),group:sU(t.proxy(n.parent)),pulse:a})):Mu("Facet must specify groupby or field: "+Hc(r));const s=t.fork(),l=s.add(MU()),u=s.add(QU({pulse:sU(l)}));s.addData(i,new DW(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(HU({pulse:n.pulse})),i=t.fork();i.add(QU()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(h&&o.push(h),o.push(b))),a&&(d=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:pU(a)?n.signalRef(a.signal):a,method:pU(r)?n.signalRef(r.signal):r,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(i){const e=i.tolerance;o.boundTolerance=pU(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return sU(n.add(VU(o)))}(a,d,t));const x=t.add(JU({pulse:d})),w=t.add(QU({pulse:sU(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new DW(t,l,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&Mu("Marks only support modify triggers."),FW(e,t,c)})))}function NW(e,t){const n=t.config.legend,r=e.encode||{},i=VV(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,f,d,h=0;NV.forEach((t=>e[t]?(u[t]=e[t],h=h||e[t]):0)),h||Mu("Missing valid scale for legend.");const p=function(e,t){let n=e.type||MV;e.type||1!==function(e){return NV.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=Lk(t)?jV:Uk(t)?FV:MV);return n!==jV?n:Uk(t)?FV:jV}(e,t.scaleType(h)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=sU(t.add(MU(null,[m]))),y=sU(t.add(BU(f={type:p,scale:t.scaleRef(h),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===jV?(d=[JV(e,h,n,r.gradient),eW(e,n,r.labels,y)],f.count=f.count||t.signalRef("max(2,2*floor((".concat(yU(i.gradientLength()),")/100))"))):p===FV?d=[KV(e,h,n,r.gradient,y),eW(e,n,r.labels,y)]:(c=function(e,t){const n=VV(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),d=[tW(e,n,r,y,yU(c.columns))],f.size=function(e,t,n){const r=yU(PW("size",e,n)),i=yU(PW("strokeWidth",e,n)),a=yU(function(e,t,n){return WV("fontSize",e)||function(e,t,n){const r=t.config.style[n];return r&&r[e]}("fontSize",t,n)}(n[1].encode,t,EV));return gL("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,d[0].marks)),d=[UV({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:c,interactive:s})],m.title&&d.push(function(e,t,n,r){const i=VV(e,t),a={enter:{opacity:PV},update:{opacity:zV,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:PV}};return Rq(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:uW},angle:{signal:cW},align:{signal:lW},baseline:{signal:fW},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),YV({type:qV,role:"legend-title",style:AV,from:r,encode:a},n)}(e,n,r.title,g)),TW(UV({role:"legend",from:g,encode:Pq(RW(i,e,n),a,RV),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}function RW(e,t,n){const r={enter:{},update:{}};return Rq(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function PW(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):WV(e,n[0].encode)}DW.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=sU(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new DW(e,a,i,r,o)},DW.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=CW(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&MW(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:sU(r.output)},n&&n.field&&MW(e,l,n),s=e.add(AU(l)),o=e.add(MU({pulse:sU(s)})),o={agg:s,ref:sU(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return sU(this.values)},extentRef(e,t){return jW(e,this,"extent","extent",t,!1)},domainRef(e,t){return jW(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return jW(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return jW(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return jW(e,this,"indata","tupleindex",t,!0,!0)}};const zW='item.orient==="'.concat(bV,'"?-90:item.orient==="').concat(xV,'"?90:0');function BW(e,t){const n=VV(e=zc(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=sU(t.add(MU(null,[{}])));return l.push(function(e,t,n,r){const i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Rq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),YV({type:qV,role:Uq,style:DV,from:r,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||kc({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Rq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),YV({type:qV,role:Vq,style:CV,from:r,encode:o},n)}(e,n,r.subtitle,u)),TW(UV({role:"title",from:u,encode:IW(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function IW(e,t){const n={enter:{},update:{}};return Rq(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:GV},angle:{signal:zW},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Pq(n,t,RV)}function LW(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(yW(e,t))})),e.on&&e.on.forEach((n=>{FW(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,f=!1;e.values?mU(e.values)||mU(e.format)?(r.push(UW(t,e)),r.push(u=qW())):r.push(u=qW({$ingest:e.values,$format:e.format})):e.url?mU(e.url)||mU(e.format)?(r.push(UW(t,e)),r.push(u=qW())):r.push(u=qW({$request:e.url,$format:e.format})):e.source&&(u=i=hc(e.source).map((e=>sU(t.getData(e).output))),r.push(null));for(a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=qW()),r.push(s),l.generates&&(f=!0),l.modifies&&!f&&(c=!0),l.source?u=s:l.changes&&(u=null);i&&(o=i.length-1,r[0]=YU({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,qW()));u||r.push(qW());return r.push(QU({})),r}(e,t,n))}function qW(e){const t=MU({},e);return t.metadata={source:!0},t}function UW(e,t){return IU({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const VW=e=>e===wV||e===vV,WW=(e,t,n)=>pU(e)?KW(e.signal,t,n):e===bV||e===vV?t:n,HW=(e,t,n)=>pU(e)?YW(e.signal,t,n):VW(e)?t:n,GW=(e,t,n)=>pU(e)?JW(e.signal,t,n):VW(e)?n:t,XW=(e,t,n)=>pU(e)?QW(e.signal,t,n):e===vV?{value:t}:{value:n},YW=(e,t,n)=>eH("".concat(e," === '").concat(vV,"' || ").concat(e," === '").concat(wV,"'"),t,n),JW=(e,t,n)=>eH("".concat(e," !== '").concat(vV,"' && ").concat(e," !== '").concat(wV,"'"),t,n),KW=(e,t,n)=>nH("".concat(e," === '").concat(bV,"' || ").concat(e," === '").concat(vV,"'"),t,n),QW=(e,t,n)=>nH("".concat(e," === '").concat(vV,"'"),t,n),ZW=(e,t,n)=>nH("".concat(e," === '").concat(xV,"'"),t,n),eH=(e,t,n)=>(t=null!=t?Tq(t):t,n=null!=n?Tq(n):n,tH(t)&&tH(n)?(t=t?t.signal||Hc(t.value):null,n=n?n.signal||Hc(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[kc({test:e},t)].concat(n||[])),tH=e=>null==e||1===Object.keys(e).length,nH=(e,t,n)=>({signal:"".concat(e," ? (").concat(iH(t),") : (").concat(iH(n),")")}),rH=(e,t,n,r,i)=>({signal:(null!=r?"".concat(e," === '").concat(bV,"' ? (").concat(iH(r),") : "):"")+(null!=n?"".concat(e," === '").concat(wV,"' ? (").concat(iH(n),") : "):"")+(null!=i?"".concat(e," === '").concat(xV,"' ? (").concat(iH(i),") : "):"")+(null!=t?"".concat(e," === '").concat(vV,"' ? (").concat(iH(t),") : "):"")+"(null)"}),iH=e=>pU(e)?e.signal:null==e?null:Hc(e),aH=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function oH(e,t,n,r){let i;if(t&&Ec(t,e))return t[e];if(Ec(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function sH(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function lH(e,t){return{scale:e.scale,range:t}}function uH(e,t,n,r,i){const a=VV(e,t),o=e.orient,s=e.gridScale,l=WW(o,1,-1),u=function(e,t){if(1===t);else if(Uu(e)){let n=e=kc({},e);for(;null!=n.mult;){if(!Uu(n.mult))return n.mult=pU(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=kc({},n.mult)}n.mult=t}else e=pU(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,f,d;const h={enter:c={opacity:PV},update:d={opacity:zV},exit:f={opacity:PV}};Rq(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:$V,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=HW(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:kc(m,{mult:l,offset:u});return c.x=d.x=HW(o,p,g),c.y=d.y=GW(o,p,g),c.x2=d.x2=GW(o,y),c.y2=d.y2=HW(o,y),f.x=HW(o,p),f.y=GW(o,p),YV({type:LV,role:"axis-grid",key:$V,from:r,encode:h},n)}function cH(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function fH(e,t,n,r,i,a){const o=VV(e,t),s=e.orient,l=e.scale,u=WW(s,-1,1),c=yU(o("labelFlush")),f=yU(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p,m=0===c||!!c;const g=Tq(i);g.mult=u,g.offset=Tq(o("labelPadding")||0),g.offset.mult=u;const y={scale:l,field:$V,band:.5,offset:XV(a.offset,o("labelOffset"))},v=HW(s,m?cH(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>pU(e)?ZW(e.signal,t,n):e===xV?{value:t}:{value:n})(s,"left","right")),b=HW(s,XW(s,"bottom","top"),m?cH(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=cH(l,c,"-(".concat(f,")"),f,0);m=m&&f;const w={opacity:PV,x:HW(s,y,g),y:GW(s,y,g)},_={enter:w,update:p={opacity:zV,text:{field:OV},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:PV,x:w.x,y:w.y}};Rq(_,{dx:!d&&m?HW(s,x):null,dy:!h&&m?GW(s,x):null}),Rq(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const k=o("labelBound");let O=o("labelOverlap");return O=O||k?{separation:o("labelSeparation"),method:O,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=aH(p.align,v)),p.baseline!==b&&(p.baseline=aH(p.baseline,b)),YV({type:qV,role:"axis-label",style:EV,key:$V,from:r,encode:_,overlap:O},n)}function dH(e,t,n,r){const i=VV(e,t),a=e.orient,o=WW(a,-1,1);let s,l;const u={enter:s={opacity:PV,anchor:Tq(i("titleAnchor",null)),align:{signal:GV}},update:l=kc({},s,{opacity:zV,text:Tq(e.title)}),exit:{opacity:PV}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(HV(0,1,.5),")")};return l.x=HW(a,c),l.y=GW(a,c),s.angle=HW(a,PV,((e,t)=>0===t?0:pU(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t})(o,90)),s.baseline=HW(a,XW(a,wV,vV),{value:wV}),l.angle=s.angle,l.baseline=s.baseline,Rq(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=aH(Tq(e),n.update[t]),!1):!zq(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?Tq(o):HW(t,Tq(o),Tq(a))}(i,a,u,n),u.update.align=aH(u.update.align,s.align),u.update.angle=aH(u.update.angle,s.angle),u.update.baseline=aH(u.update.baseline,s.baseline),YV({type:qV,role:"axis-title",style:AV,from:r,encode:u},n)}function hH(e,t){const n=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,l="band"===t.scaleType(e.scale)&&a.axisBand,u=e.orient;if(pU(u)){const e=sH([a.axisX,a.axisY]),t=sH([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=HW(u,oH(i,a.axisX,s,o),oH(i,a.axisY,s,o));for(i of(r={},t))r[i]=rH(u.signal,oH(i,a.axisTop,s,o),oH(i,a.axisBottom,s,o),oH(i,a.axisLeft,s,o),oH(i,a.axisRight,s,o))}else n=u===vV||u===wV?a.axisX:a.axisY,r=a["axis"+u[0].toUpperCase()+u.slice(1)];return n||r||l?kc({},s,n,r,l):s}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=VV(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},Uu(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},f=sU(t.add(MU({},[c]))),d=sU(t.add(DU({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let p;return c.grid&&h.push(uH(e,n,r.grid,d,u)),c.ticks&&(p=l("tickSize"),h.push(function(e,t,n,r,i,a){const o=VV(e,t),s=e.orient,l=WW(s,-1,1);let u,c,f;const d={enter:u={opacity:PV},update:f={opacity:zV},exit:c={opacity:PV}};Rq(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=Tq(i);h.mult=l;const p={scale:e.scale,field:$V,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=u.y=HW(s,PV,p),f.y2=u.y2=HW(s,h),c.x=HW(s,p),f.x=u.x=GW(s,PV,p),f.x2=u.x2=GW(s,h),c.y=GW(s,p),YV({type:LV,role:"axis-tick",key:$V,from:r,encode:d},n)}(e,n,r.ticks,d,p,u))),c.labels&&(p=c.ticks?p:0,h.push(fH(e,n,r.labels,d,p,u))),c.domain&&h.push(function(e,t,n,r){const i=VV(e,t),a=e.orient;let o,s;const l={enter:o={opacity:PV},update:s={opacity:zV},exit:{opacity:PV}};Rq(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=lH(e,0),c=lH(e,1);return o.x=s.x=HW(a,u,PV),o.x2=s.x2=HW(a,c),o.y=s.y=GW(a,u,PV),o.y2=s.y2=GW(a,c),YV({type:LV,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,f)),c.title&&h.push(dH(e,n,r.title,f)),TW(UV({role:"axis",from:f,encode:Pq(pH(l,e),i,RV),marks:h,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function pH(e,t){const n={enter:{},update:{}};return Rq(n,{orient:e("orient"),offset:e("offset")||0,position:gU(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function mH(e,t,n){const r=hc(e.signals),i=hc(e.scales);return n||r.forEach((e=>rU(e,t))),hc(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=yV(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=yV(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";Bk(n)||Mu("Unrecognized scale type: "+Hc(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),hc(e.data).forEach((e=>LW(e,t))),i.forEach((e=>iV(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?Mu("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=gL(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>SU(e,t,n.id)))}(e,t))),hc(e.axes).forEach((e=>hH(e,t))),hc(e.marks).forEach((e=>TW(e,t))),hc(e.legends).forEach((e=>NW(e,t))),e.title&&BW(e.title,t),t.parseLambdas(),t}function gH(e,t){const n=t.config,r=sU(t.root=t.add(oU())),i=function(e,t){const n=n=>gU(e[n],t[n]),r=[yH("background",n("background")),yH("autosize",Mq(n("autosize"))),yH("padding",Fq(n("padding"))),yH("width",n("width")||0),yH("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return hc(e.signals).forEach((e=>{Ec(i,e.name)?e=kc(i[e.name],e):r.push(e),a[e.name]=e})),hc(t.signals).forEach((e=>{Ec(a,e.name)||Ec(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>rU(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(MU()),o=t.add(TU(Qq((e=>Pq({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),BV,Iq,e.style,t,{pulse:sU(a)}))),s=t.add(eV({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:sU(o)}));t.operators.pop(),t.pushState(sU(o),sU(s),null),mH(e,t,i),t.operators.push(s);let l=t.add(CU({mark:r,pulse:sU(s)}));return l=t.add(JU({pulse:sU(l)})),l=t.add(QU({pulse:sU(l)})),t.addData("root",new DW(t,a,a,l)),t}function yH(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function vH(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function bH(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function xH(e){return(qu(e)?wH:_H)(e)}function wH(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(Uu(t)?t.signal||xH(t):Hc(t))}return n+"]"}function _H(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+Hc(t)+":"+(Uu(n)?n.signal||xH(n):Hc(n));return r+"}"}vH.prototype=bH.prototype={parse(e){return mH(e,this)},fork(){return new bH(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof iU?sU(e):e;return this.add(XU({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(sU(this.add(QU({pulse:e})))),this._parent.push(t),this._lookup.push(n?sU(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Xu(this._parent)},encode(){return Xu(this._encode)},lookup(){return Xu(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(zc(e))return lU(e,t);e.signal||Mu("Unsupported field reference: "+Hc(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=sU(this.add(PU(e)))}return r},compareRef(e){let t=!1;const n=e=>pU(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=hc(e.field).map(n),i=hc(e.order).map(n);return t?sU(this.add(jU({fields:r,orders:i}))):cU(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=hc(e).map((e=>pU(e)?(n=!0,sU(r[e.signal])):e)),n?sU(this.add(zU({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=fU(e.op,e.field),n=e.order||"ascending";return n.signal?sU(this.add(jU({fields:t,orders:this.signalRef(n.signal)}))):cU(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return Ec(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Mu("Duplicate signal name: "+Hc(e));const n=t instanceof iU?t:this.add(oU(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Mu("Unrecognized signal name: "+Hc(e)),this.signals[e]},signalRef(e){return this.signals[e]?sU(this.signals[e]):(Ec(this.lambdas,e)||(this.lambdas[e]=this.add(oU(null))),sU(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=gL(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Uu(e)?this.signalRef(e.signal||xH(e)):e},exprRef(e,t){const n={expr:gL(e,this)};return t&&(n.expr.$name=t),sU(this.add(NU(n)))},addBinding(e,t){this.bindings||Mu("Nested signals do not support binding: "+Hc(e)),this.bindings.push(kc({signal:e},t))},addScaleProj(e,t){Ec(this.scales,e)&&Mu("Duplicate scale or projection name: "+Hc(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,KU(t))},addProjection(e,t){this.addScaleProj(e,GU(t))},getScale(e){return this.scales[e]||Mu("Unrecognized scale name: "+Hc(e)),this.scales[e]},scaleRef(e){return sU(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return Ec(this.data,e)&&Mu("Duplicate data set name: "+Hc(e)),this.data[e]=t},getData(e){return this.data[e]||Mu("Undefined data set name: "+Hc(e)),this.data[e]},addDataPipeline(e,t){return Ec(this.data,e)&&Mu("Duplicate data set name: "+Hc(e)),this.addData(e,DW.fromEntries(this,t))}};kc(Bg,ab,cC,LC,AN,ER,lz,LP,hz,Bz,Zz,lB);var kH=Object.freeze({__proto__:null,version:"5.17.1",Dataflow:Rg,EventStream:wg,MultiPulse:Mg,Operator:vg,Parameters:mg,Pulse:Eg,Transform:zg,changeset:hg,definition:Ig,ingest:sg,isTuple:ig,transform:Lg,transforms:Bg,tupleid:ag,interpolate:Qk,interpolateColors:Yk,interpolateRange:Xk,quantizeInterpolator:Jk,scale:zk,scheme:nO,projection:JT,View:gq,defaultLocale:Km,formatLocale:Um,locale:Jm,resetDefaultLocale:function(){return Lm(),Hm(),Km()},timeFormatLocale:Xm,expressionFunction:mL,parse:function(e,t,n){return Uu(e)||Mu("Input Vega specification must be an object."),gH(e,new vH(t=Wu(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()},runtimeContext:SL,Debug:4,Error:1,Info:3,None:0,Warn:2,accessor:Su,accessorFields:Eu,accessorName:$u,array:hc,ascending:yc,clampRange:pc,compare:gc,constant:wc,debounce:_c,error:Mu,extend:kc,extent:Oc,extentIndex:Sc,falsy:Bu,fastmap:Dc,field:Fu,flush:Cc,hasOwnProperty:Ec,id:Tu,identity:Nu,inherits:Mc,inrange:jc,isArray:qu,isBoolean:Fc,isDate:Tc,isFunction:mc,isIterable:Nc,isNumber:Rc,isObject:Uu,isRegExp:Pc,isString:zc,key:Bc,lerp:Ic,logger:Lu,lruCache:Lc,merge:qc,mergeConfig:Wu,one:Pu,pad:Vc,panLinear:nc,panLog:rc,panPow:ic,panSymlog:ac,peek:Xu,quarter:fc,repeat:Uc,span:Wc,splitAccessPath:ju,stringValue:Hc,toBoolean:Gc,toDate:Yc,toNumber:Yu,toSet:Kc,toString:Jc,truncate:Qc,truthy:zu,utcquarter:dc,visitArray:Zc,writeConfig:Hu,zero:Ru,zoomLinear:sc,zoomLog:lc,zoomPow:uc,zoomSymlog:cc,bandwidthNRD:Wg,bin:Hg,bootstrapCI:Xg,cumulativeLogNormal:sy,cumulativeNormal:ty,cumulativeUniform:hy,densityLogNormal:oy,densityNormal:ey,densityUniform:dy,dotbin:Yg,quantileLogNormal:ly,quantileNormal:ny,quantileUniform:py,quantiles:Ug,quartiles:Vg,get random(){return Gg},randomInteger:function(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*Gg()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)},randomKDE:iy,randomLCG:function(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}},randomLogNormal:uy,randomMixture:cy,randomNormal:ry,randomUniform:my,regressionExp:_y,regressionLinear:xy,regressionLoess:Ey,regressionLog:wy,regressionPoly:Sy,regressionPow:ky,regressionQuad:Oy,sampleCurve:My,sampleLogNormal:ay,sampleNormal:Zg,sampleUniform:fy,setRandom:function(e){Gg=e},DATE:oh,DAY:sh,DAYOFYEAR:lh,HOURS:uh,MILLISECONDS:dh,MINUTES:ch,MONTH:ih,QUARTER:rh,SECONDS:fh,TIME_UNITS:hh,WEEK:ah,YEAR:nh,dayofyear:xh,timeBin:cp,timeFloor:Rh,timeInterval:qh,timeOffset:Wh,timeSequence:Xh,timeUnitSpecifier:yh,timeUnits:mh,utcFloor:Bh,utcInterval:Uh,utcOffset:Hh,utcSequence:Yh,utcdayofyear:$h,utcweek:Eh,week:wh,read:Qm,inferType:gf,inferTypes:yf,typeParsers:hf,format:zf,formats:Bf,responseType:If,loader:Zm,Bounds:wS,CanvasHandler:JE,CanvasRenderer:tA,Gradient:AO,GroupItem:kS,Handler:jE,Item:_S,Marks:gE,RenderType:UA,Renderer:TE,ResourceLoader:OS,SVGHandler:rA,SVGRenderer:$A,SVGStringRenderer:IA,Scenegraph:OE,boundClip:KA,boundContext:WS,boundItem:yE,boundMark:bE,boundStroke:ES,domChild:AE,domClear:DE,domCreate:$E,domFind:EE,font:cE,fontFamily:uE,fontSize:iE,intersect:HA,intersectBoxLine:n$,intersectPath:QS,intersectPoint:ZS,intersectRule:t$,lineHeight:aE,markup:xA,multiLineOffset:sE,pathCurves:CO,pathEqual:ZA,pathParse:FO,pathRectangle:rS,pathRender:VO,pathSymbols:XO,pathTrail:iS,point:ME,renderModule:WA,resetSVGClipId:bS,resetSVGDefIds:function(){bS(),kO=0},sceneEqual:QA,sceneFromJSON:_E,scenePickVisit:h$,sceneToJSON:wE,sceneVisit:d$,sceneZOrder:f$,serializeXML:wA,textMetrics:Q$});Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var OH=xs((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var f=[],d=[],h="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(h&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var y=f.indexOf(l);if(-1!=y)return d[y];f.push(l),d.push(m)}for(var v in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,v)),b&&null==b.set||(m[v]=a(l[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(v=0;v<x.length;v++){var w=x[v];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(m[w]=a(l[w],p-1),k.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(v=0;v<_.length;v++){var k,O=_[v];(k=Object.getOwnPropertyDescriptor(l,O))&&k.enumerable||(m[O]=a(l[O],p-1),Object.defineProperty(m,O,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)})),SH=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)};function $H(e){return!!e.or}function EH(e){return!!e.and}function AH(e){return!!e.not}function DH(e,t){if(AH(e))DH(e.not,t);else if(EH(e))for(const n of e.and)DH(n,t);else if($H(e))for(const n of e.or)DH(n,t);else t(e)}function CH(e,t){return AH(e)?{not:CH(e.not,t)}:EH(e)?{and:e.and.map((e=>CH(e,t)))}:$H(e)?{or:e.or.map((e=>CH(e,t)))}:t(e)}const MH=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n},jH=OH;function FH(e,t){const n={};for(const r of t)Ec(e,r)&&(n[r]=e[r]);return n}function TH(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>SH(e))).join(",")})`};const NH=SH;function RH(e){if(Rc(e))return e;const t=zc(e)?e:SH(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function PH(e){return!1===e||null===e}function zH(e,t){return e.indexOf(t)>-1}function BH(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function IH(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function LH(e,...t){for(const n of t)qH(e,null!=n?n:{});return e}function qH(e,t){for(const n of YH(t))Hu(e,n,t[n],!0)}function UH(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function VH(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function WH(e,t){for(const n of e)if(t.has(n))return!0;return!1}function HH(e){const t=new Set;for(const n of e){const e=ju(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function GH(e,t){return void 0===e||void 0===t||WH(HH(e),HH(t))}function XH(e){return 0===YH(e).length}const YH=Object.keys,JH=Object.values,KH=Object.entries;function QH(e){return!0===e||!1===e}function ZH(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function eG(e,t){return AH(e)?"!("+eG(e.not,t)+")":EH(e)?"("+e.and.map((e=>eG(e,t))).join(") && (")+")":$H(e)?"("+e.or.map((e=>eG(e,t))).join(") || (")+")":t(e)}function tG(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&tG(e[n],t)&&delete e[n],XH(e)}function nG(e){return e.charAt(0).toUpperCase()+e.substr(1)}function rG(e,t="datum"){const n=ju(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(Hc).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function iG(e,t="datum"){return`${t}[${Hc(ju(e).join("."))}]`}function aG(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function oG(e){return`${ju(e).map(aG).join("\\.")}`}function sG(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function lG(e){return`${ju(e).join(".")}`}function uG(e){return e?ju(e).length:0}function cG(...e){for(const t of e)if(void 0!==t)return t}let fG=42;function dG(e){const t=++fG;return e?String(e)+t:t}function hG(e){return pG(e)?e:`__${e}`}function pG(e){return 0===e.indexOf("__")}function mG(e){if(void 0!==e)return(e%360+360)%360}function gG(e){return!!Rc(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const yG={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function vG(e){return e&&e.condition}const bG=["domain","grid","labels","ticks","title"],xG={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},wG={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},_G=Object.assign(Object.assign({},wG),{style:1,labelExpr:1,encoding:1});function kG(e){return!!_G[e]}const OG=YH({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),SG={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},$G={count:1,min:1,max:1};function EG(e){return!!e&&!!e.argmin}function AG(e){return!!e&&!!e.argmax}function DG(e){return zc(e)&&!!SG[e]}const CG=["count","valid","missing","distinct"];function MG(e){return zc(e)&&zH(CG,e)}const jG=["count","sum","distinct","valid","missing"],FG=Kc(["mean","average","median","q1","q3","min","max"]);var TG=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const NG="row",RG="column",PG="facet",zG="x",BG="y",IG="x2",LG="y2",qG="radius",UG="radius2",VG="theta",WG="theta2",HG="latitude",GG="longitude",XG="latitude2",YG="longitude2",JG="color",KG="fill",QG="stroke",ZG="shape",eX="size",tX="angle",nX="opacity",rX="fillOpacity",iX="strokeOpacity",aX="strokeWidth",oX="strokeDash",sX="text",lX="order",uX="detail",cX="key",fX="tooltip",dX="href",hX="url",pX="description",mX={theta:1,theta2:1,radius:1,radius2:1};function gX(e){return e in mX}const yX={longitude:1,longitude2:1,latitude:1,latitude2:1};const vX=YH(yX),bX=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),mX),yX),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function xX(e){return e===JG||e===KG||e===QG}const wX={row:1,column:1,facet:1},_X=YH(wX),kX=Object.assign(Object.assign({},bX),wX),OX=YH(kX),SX=TG(kX,["order","detail","tooltip"]),$X=TG(SX,["row","column","facet"]);function EX(e){return!!kX[e]}const AX=[IG,LG,XG,YG,WG,UG];function DX(e){return CX(e)!==e}function CX(e){switch(e){case IG:return zG;case LG:return BG;case XG:return HG;case YG:return GG;case WG:return VG;case UG:return qG}return e}function MX(e){if(gX(e))switch(e){case VG:return"startAngle";case WG:return"endAngle";case qG:return"outerRadius";case UG:return"innerRadius"}return e}function jX(e){switch(e){case zG:return IG;case BG:return LG;case HG:return XG;case GG:return YG;case VG:return WG;case qG:return UG}}function FX(e){switch(e){case zG:case IG:return"width";case BG:case LG:return"height"}}const TX=TG(bX,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),NX=YH(TX),RX={x:1,y:1},PX=YH(RX);function zX(e){return e in RX}const BX={theta:1,radius:1},IX=YH(BX);function LX(e){return"width"===e?zG:BG}const qX=TG(TX,["text","tooltip","href","url","description","detail","key","order"]),UX=YH(qX);const VX=Object.assign(Object.assign(Object.assign({},RX),BX),qX),WX=YH(VX);function HX(e){return!!VX[e]}function GX(e,t){return function(e){switch(e){case JG:case KG:case QG:case pX:case uX:case cX:case fX:case dX:case lX:case nX:case rX:case iX:case aX:case PG:case NG:case RG:return XX;case zG:case BG:case HG:case GG:return YX;case IG:case LG:case XG:case YG:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case eX:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case oX:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ZG:return{point:"always",geoshape:"always"};case sX:return{text:"always"};case tX:return{point:"always",square:"always",text:"always"};case hX:return{image:"always"};case VG:case qG:return{text:"always",arc:"always"};case WG:case UG:return{arc:"always"}}}(e)[t]}const XX={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},YX=TG(XX,["geoshape"]);function JX(e){switch(e){case zG:case BG:case VG:case qG:case eX:case tX:case aX:case nX:case rX:case iX:case IG:case LG:case WG:case UG:return;case PG:case NG:case RG:case ZG:case oX:case sX:case fX:case dX:case hX:case pX:return"discrete";case JG:case KG:case QG:return"flexible";case HG:case GG:case XG:case YG:case uX:case cX:case lX:return}}function KX(e){return Fc(e)&&(e=RQ(e,void 0)),"bin"+YH(e).map((t=>tY(e[t])?ZH(`_${t}_${KH(e[t])}`):ZH(`_${t}_${e[t]}`))).join("")}function QX(e){return!0===e||eY(e)&&!e.binned}function ZX(e){return"binned"===e||eY(e)&&!0===e.binned}function eY(e){return Uu(e)}function tY(e){return null==e?void 0:e.selection}function nY(e){switch(e){case NG:case RG:case eX:case JG:case KG:case QG:case aX:case nX:case rX:case iX:case ZG:return 6;case oX:return 4;default:return 10}}function rY(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const iY='Autosize "fit" only works for single views and layered views.';function aY(e){return`${"width"==e?"Width":"Height"} "container" only works for single views and layered views.`}function oY(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function sY(e){return e?`Dropping "fit-${e}" because spec has discrete ${FX(e)}.`:'Dropping "fit" because spec has discrete size.'}function lY(e){return`Unknown field for ${e}. Cannot calculate view size.`}function uY(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function cY(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function fY(e){return`Selection not supported for ${e} yet.`}const dY="The same selection must be used to override scale domains in a layered view.";function hY(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function pY(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function mY(e){return`Ignoring an invalid transform: ${NH(e)}.`}function gY(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function yY(e){return`Invalid field type "${e}".`}function vY(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function bY(e,t){return`Dropping ${NH(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function xY(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function wY(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function _Y(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function kY(e){return`Using unaggregated domain with raw field has no effect (${NH(e)}).`}function OY(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function SY(e){return`Unaggregated domain is currently unsupported for log scale (${NH(e)}).`}function $Y(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function EY(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const AY="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function DY(e,t){return`Invalid ${e}: ${NH(t)}.`}function CY(e){return`1D error band does not support ${e}.`}function MY(e){return`Channel ${e} is required for "binned" bin.`}const jY=Lu(2);let FY=jY;function TY(...e){FY.warn(...e)}function NY(e){if(e&&Uu(e))for(const t of VY)if(t in e)return!0;return!1}const RY=["january","february","march","april","may","june","july","august","september","october","november","december"],PY=RY.map((e=>e.substr(0,3))),zY=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],BY=zY.map((e=>e.substr(0,3)));function IY(e,t){const n=[];if(t&&void 0!==e.day&&YH(e).length>1&&(TY(function(e){return`Dropping day from datetime ${NH(e)} as day cannot be combined with other units.`}(e)),delete(e=jH(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(gG(e)&&(e=+e),Rc(e))return e-1;{const t=e.toLowerCase(),n=RY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=PY.indexOf(r);if(-1!==i)return i;throw new Error(DY("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(gG(e)&&(e=+e),Rc(e))return e>4&&TY(DY("quarter",e)),e-1;throw new Error(DY("quarter",e))}(e.quarter):e.quarter;n.push(Rc(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(gG(e)&&(e=+e),Rc(e))return e%7;{const t=e.toLowerCase(),n=zY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=BY.indexOf(r);if(-1!==i)return i;throw new Error(DY("day",e))}}(e.day):e.day;n.push(Rc(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function LY(e){const t=IY(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}var qY=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const UY={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},VY=YH(UY);function WY(e){return e.startsWith("utc")}const HY={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function GY(e){const t=[];for(const n of VY)XY(e,n)&&t.push(n);return t}function XY(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function YY(e,t,{end:n}={end:!1}){const r=rG(t),i=WY(e)?"utc":"";let a;const o={};for(const t of VY)XY(e,t)&&(o[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=t);var s;return n&&(o[a]+="+1"),function(e){const t=IY(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}function JY(e){if(!e)return;const t=GY(e);return`timeUnitSpecifier(${SH(t)}, ${SH(HY)})`}function KY(e){if(!e)return;let t;return zc(e)?t={unit:e}:Uu(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),WY(t.unit)&&(t.utc=!0,t.unit=function(e){return e.substr(3)}(t.unit)),t}function QY(e){return e&&!!e.signal}function ZY(e){return!!e.step}function eJ(e){return!qu(e)&&("field"in e&&"data"in e)}const tJ=YH({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),nJ={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},rJ=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function iJ(e){return e&&!!e.field&&void 0!==e.equal}function aJ(e){return e&&!!e.field&&void 0!==e.lt}function oJ(e){return e&&!!e.field&&void 0!==e.lte}function sJ(e){return e&&!!e.field&&void 0!==e.gt}function lJ(e){return e&&!!e.field&&void 0!==e.gte}function uJ(e){if(e&&e.field){if(qu(e.range)&&2===e.range.length)return!0;if(QY(e.range))return!0}return!1}function cJ(e){return e&&!!e.field&&(qu(e.oneOf)||qu(e.in))}function fJ(e){return cJ(e)||iJ(e)||uJ(e)||aJ(e)||sJ(e)||oJ(e)||lJ(e)}function dJ(e,t){return BQ(e,{timeUnit:t,wrapTime:!0})}function hJ(e,t=!0){var n;const{field:r}=e,i=null===(n=KY(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+YY(i,r)+")":wQ(e,{expr:"datum"});if(iJ(e))return a+"==="+dJ(e.equal,i);if(aJ(e)){return`${a}<${dJ(e.lt,i)}`}if(sJ(e)){return`${a}>${dJ(e.gt,i)}`}if(oJ(e)){return`${a}<=${dJ(e.lte,i)}`}if(lJ(e)){return`${a}>=${dJ(e.gte,i)}`}if(cJ(e))return`indexof([${function(e,t){return e.map((e=>dJ(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return pJ(a,e.valid);if(uJ(e)){const{range:n}=e,r=QY(n)?{signal:`${n.signal}[0]`}:n[0],o=QY(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+dJ(r,i)+", "+dJ(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${dJ(r,i)}`),null!==o&&s.push(`${a} <= ${dJ(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function pJ(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function mJ(e){var t;return fJ(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=KY(e.timeUnit))||void 0===t?void 0:t.unit}):e}const gJ="quantitative",yJ="ordinal",vJ="temporal",bJ="nominal",xJ="geojson";var wJ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const _J="linear",kJ="log",OJ="pow",SJ="sqrt",$J="symlog",EJ="time",AJ="utc",DJ="quantile",CJ="quantize",MJ="threshold",jJ="point",FJ="band",TJ={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function NJ(e,t){const n=TJ[e],r=TJ[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const RJ={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function PJ(e){return RJ[e]}const zJ=["linear","log","pow","sqrt","symlog","time","utc"],BJ=Kc(zJ),IJ=Kc(["linear","log","pow","sqrt","symlog"]);const LJ=Kc(["quantile","quantize","threshold"]),qJ=Kc(zJ.concat(["quantile","quantize","threshold","sequential","identity"])),UJ=Kc(["ordinal","bin-ordinal","point","band"]);function VJ(e){return e in UJ}function WJ(e){return e in qJ}function HJ(e){return e in BJ}function GJ(e){return e in LJ}function XJ(e){return null==e?void 0:e.selection}const YJ=wJ({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),JJ=YH(YJ);function KJ(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!zH(["point","band","identity"],e);case"bins":return!zH(["point","band","identity","ordinal"],e);case"round":return HJ(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return HJ(e)||zH(["point","band"],e);case"paddingOuter":case"align":return zH(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return HJ(e);case"nice":return HJ(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return WJ(e)&&!zH(["log","time","utc","threshold","quantile"],e)}}function QJ(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return xX(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function ZJ(e){return e&&!!e.expr}function eK(e){const t=YH(e||{}),n={};for(const r of t)n[r]=GQ(e[r]);return n}const tK={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},nK=tK.arc,rK=tK.area,iK=tK.bar,aK=tK.image,oK=tK.line,sK=tK.point,lK=tK.rect,uK=tK.rule,cK=tK.text,fK=tK.tick,dK=tK.trail,hK=tK.circle,pK=tK.square,mK=tK.geoshape;function gK(e){return zH(["line","area","trail"],e)}function yK(e){return zH(["rect","bar","image","arc"],e)}const vK=YH(tK);function bK(e){return e.type}Kc(vK);const xK=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],wK=YH({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),_K=YH({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),kK={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},OK={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},SK={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function $K(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=jK(e);return lQ(n)&&!MG(n.aggregate)&&i&&HJ(i.get("type"))&&!1===i.get("zero")?EK({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function EK({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){if(gK(n.type))return r;return null===ZQ("invalid",n,i)?r:[AK(e,t),r]}function AK(e,t){const n=DK(e,!0),r="y"===CX(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function DK(e,t=!0){return pJ(zc(e)?e:wQ(e,{expr:"datum"}),!t)}function CK(e,t,n,r){const i={};if(t&&(i.scale=t),cQ(e)){const{datum:t}=e;NY(t)?i.signal=LY(t):QY(t)?i.signal=t.signal:ZJ(t)?i.signal=t.expr:i.value=t}else i.field=wQ(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function MK({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=wQ(t,{expr:o,suffix:i}),l=void 0!==n?wQ(n,{expr:o}):wQ(t,{suffix:"end",expr:o}),u={};if(0===a||1===a){u.scale=e;const t=0===a?s:l;u.field=t}else{const t=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${t})`}return r&&(u.offset=r),u}function jK({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(hQ(t)){if(pQ(t)){c=null!=c?c:rQ({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:f}=t;if(QX(o)||c&&u&&f===vJ)return s&&s.impute?CK(t,a,{binSuffix:"mid"},{offset:l}):c?MK({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):CK(t,a,LQ(t,e)?{binSuffix:"range"}:{},{offset:l});if(ZX(o)){if(lQ(n))return MK({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});TY(MY(e===zG?IG:LG))}}const u=null==o?void 0:o.get("type");return CK(t,a,VJ(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(mQ(t)){const n=t.value,r=l?{offset:l}:{};return Object.assign(Object.assign({},FK(e,n)),r)}}return mc(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function FK(e,t){return zH(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:zH(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:YQ(t)}function TK(e){return e&&"number"!==e&&"time"!==e}function NK(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function RK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(TK(n))return zK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=PK(e,r,i);if(zQ(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=zc(n)?n:r}')`:function(e,t,n){if(!e)return;const r=JY(e);return`${n||WY(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,lQ(e)?null===(o=KY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,gQ(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===AJ);return n?{signal:n}:void 0}if(t=LK(uQ(e),t,a),lQ(e)&&QX(e.bin)){return{signal:VK(l,wQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return t||"quantitative"===uQ(e)?{signal:`${qK(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function PK(e,t,n){return lQ(e)?n?`${wQ(e,{expr:t,suffix:"end"})}-${wQ(e,{expr:t,suffix:"start"})}`:wQ(e,{expr:t}):function(e){const{datum:t}=e;return NY(t)?LY(t):`${JSON.stringify(t)}`}(e)}function zK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){if(o=null!=o?o:PK(e,r,i),lQ(e)&&QX(e.bin)){return{signal:VK(o,wQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return{signal:NK(n,o,t)}}function BK(e,t,n,r,i,a){var o;if(!TK(r)){if(zQ(e)){return function(e,t,n,r){if(e)return e;if(t)return{signal:JY(t)};return r?void 0:n.timeFormat}(n,lQ(e)?null===(o=KY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a)}return LK(t,n,i)}}function IK(e,t,n){return e&&(QY(e)||"number"===e||"time"===e)?e:zQ(t)&&"time"!==n&&"utc"!==n?"time":void 0}function LK(e,t,n){return zc(t)?t:e===gJ?n.numberFormat:void 0}function qK(e,t){return`format(${e}, "${t||""}")`}function UK(e,t,n,r){var i;return TK(n)?NK(n,e,t):qK(e,null!==(i=zc(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function VK(e,t,n,r,i){const a=UK(e,n,r,i),o=UK(t,n,r,i);return`${pJ(e,!1)} ? "null" : ${a} + " – " + ${o}`}const WK="min",HK={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function GK(e){return e in HK}function XK(e){return!!e&&!!e.encoding}function YK(e){return!(!e||"count"!==e.op&&!e.field)}function JK(e){return!!e&&qu(e)}function KK(e){return"row"in e||"column"in e}function QK(e){return!!e&&"header"in e}function ZK(e){return"facet"in e}var eQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function tQ(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function nQ(e){return"sort"in e}function rQ({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(hQ(t)&&void 0!==t.band)return t.band;if(lQ(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?eZ("timeUnitBandPosition",r,a):yK(r.type)?eZ("timeUnitBand",r,a):0;if(QX(i))return yK(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function iQ(e,t,n,r,i,a){return!!(QX(t.bin)||t.timeUnit&&pQ(t)&&"temporal"===t.type)&&!!rQ({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function aQ(e){return!!e&&"condition"in e}function oQ(e){const t=e&&e.condition;return!!t&&!qu(t)&&lQ(t)}function sQ(e){const t=e&&e.condition;return!!t&&!qu(t)&&hQ(t)}function lQ(e){return!(!e||!e.field&&"count"!==e.aggregate)}function uQ(e){return e&&e.type}function cQ(e){return!!e&&"datum"in e}function fQ(e){return pQ(e)&&kQ(e)||dQ(e)}function dQ(e){return cQ(e)&&Rc(e.datum)}function hQ(e){return lQ(e)||cQ(e)}function pQ(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function mQ(e){return e&&"value"in e&&"value"in e}function gQ(e){return!!e&&("scale"in e||"sort"in e)}function yQ(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function vQ(e){return!!e&&"legend"in e}function bQ(e){return!!e&&("format"in e||"formatType"in e)}function xQ(e){return TH(e,["legend","axis","header","scale"])}function wQ(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=hG("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:f}=e;QX(u)?(o=KX(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?AG(c)?(l=`["${a}"]`,a=`argmax_${c.argmax}`):EG(c)?(l=`["${a}"]`,a=`argmin_${c.argmin}`):o=String(c):f&&(o=function(e){const t=KY(e),{utc:n}=t,r=qY(t,["utc"]);return r.unit?(n?"utc":"")+YH(r).map((e=>ZH(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+YH(r).map((e=>ZH(`_${e}_${r[e]}`))).join("")}(f),s=(!zH(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?lG(a):t.expr?iG(a,t.expr)+l:oG(a)+l}function _Q(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return lQ(e)&&!!e.bin;case"temporal":return!1}throw new Error(yY(e.type))}function kQ(e){return!_Q(e)}const OQ=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(AG(t))return`${i} for argmax(${t.argmax})`;if(EG(t))return`${i} for argmin(${t.argmin})`;const a=KY(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||QX(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(QX(i))return`${r} (binned)`;if(a){const e=null===(n=KY(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${GY(e).join("-")})`}else if(o)return AG(o)?`${r} for max ${o.argmax}`:EG(o)?`${r} for min ${o.argmin}`:`${nG(o)} of ${r}`;return r}(e,t)}};let SQ=OQ;function $Q(e){SQ=e}function EQ(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=AQ(e))||void 0===i?void 0:i.title;if(!lQ(e))return o;const s=e,l=r?DQ(s,t):void 0;return n?cG(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function AQ(e){return yQ(e)&&e.axis?e.axis:vQ(e)&&e.legend?e.legend:QK(e)&&e.header?e.header:void 0}function DQ(e,t){return SQ(e,t)}function CQ(e){var t;if(bQ(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=AQ(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function MQ(e){return lQ(e)?e:oQ(e)?e.condition:void 0}function jQ(e){return hQ(e)?e:sQ(e)?e.condition:void 0}function FQ(e,t,n,r={}){if(zc(e)||Rc(e)||Fc(e)){return TY(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${NH(n)}}.`}(t,zc(e)?"string":Rc(e)?"number":"boolean",e)),{value:e}}return hQ(e)?TQ(e,t,n,r):sQ(e)?Object.assign(Object.assign({},e),{condition:TQ(e.condition,t,n,r)}):e}function TQ(e,t,n,r){if(bQ(e)){const{format:i,formatType:a}=e,o=eQ(e,["format","formatType"]);if(TK(a)&&!n.customFormatTypes)return TY(gY(t)),TQ(o,t,n,r)}else{const i=yQ(e)?"axis":vQ(e)?"legend":QK(e)?"header":null;if(i&&e[i]){const a=e[i],{format:o,formatType:s}=a,l=eQ(a,["format","formatType"]);if(TK(s)&&!n.customFormatTypes)return TY(gY(t)),TQ(Object.assign(Object.assign({},e),{[i]:l}),t,n,r)}}return lQ(e)?NQ(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Rc(n)?"quantitative":zc(n)?"nominal":NY(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function NQ(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||DG(r)||AG(r)||EG(r)||(TY(function(e){return`Invalid aggregation operator "${e}".`}(r)),delete s.aggregate),i&&(s.timeUnit=KY(i)),o&&(s.field=`${o}`),QX(a)&&(s.bin=RQ(a,t)),ZX(a)&&!zX(t)&&TY(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),pQ(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case gJ:return"quantitative";case"t":case vJ:return"temporal";case"o":case yJ:return"ordinal";case"n":case bJ:return"nominal";case xJ:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&MG(r)&&(TY(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,r)),s.type="quantitative")}else if(!DX(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(nQ(e)&&qu(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!AG(r)&&!EG(r))return"quantitative";if(gQ(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(TJ[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(pQ(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case NG:case RG:case PG:return kQ(e)?{compatible:!1,warning:wY(t)}:PQ;case zG:case BG:case JG:case KG:case QG:case sX:case uX:case cX:case fX:case dX:case hX:case tX:case VG:case qG:case pX:return PQ;case GG:case YG:case HG:case XG:return n!==gJ?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:PQ;case nX:case rX:case iX:case aX:case eX:case WG:case UG:case IG:case LG:return"nominal"!==n||e.sort?PQ:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case oX:return zH(["ordinal","nominal"],e.type)?PQ:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case ZG:return zH(["ordinal","nominal","geojson"],e.type)?PQ:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case lX:return"nominal"!==e.type||"sort"in e?PQ:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&TY(n)}if(nQ(s)&&zc(s.sort)){const{sort:e}=s;if(GK(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&GK(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(QK(s)){const{header:e}=s,{orient:t}=e,n=eQ(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function RQ(e,t){return Fc(e)?{maxbins:nY(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:nY(t)})}const PQ={compatible:!0};function zQ(e){const{formatType:t}=CQ(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||lQ(e)&&!!e.timeUnit)}(e)}function BQ(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=KY(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return ZJ(e)?s=e.expr:QY(e)?s=e.signal:NY(e)?(l=!0,s=LY(e)):(zc(e)||Rc(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!UY[e]}(o)&&(Rc(e)&&e<1e4||zc(e)&&isNaN(Date.parse(e)))&&(s=LY({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function IQ(e,t){const{type:n}=e;return t.map((t=>{const r=BQ(t,{timeUnit:lQ(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function LQ(e,t){return QX(e.bin)?HX(t)&&zH(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var qQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function UQ(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=qQ(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:FH(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function VQ(e){return zc(e)||qu(e)&&zc(e[0])}var WQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function HQ(e){const t=qu(e.condition)?e.condition.map(XQ):XQ(e.condition);return Object.assign(Object.assign({},GQ(e)),{condition:t})}function GQ(e){if(ZJ(e)){const{expr:t}=e,n=WQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function XQ(e){if(ZJ(e)){const{expr:t}=e,n=WQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function YQ(e){if(ZJ(e)){const{expr:t}=e,n=WQ(e,["expr"]);return Object.assign({signal:t},n)}return QY(e)?e:void 0!==e?{value:e}:void 0}function JQ(e){return QY(e)?e.signal:Hc(e.value)}function KQ(e){return QY(e)?e.signal:null==e?null:Hc(e)}function QQ(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function ZQ(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?eZ(e,t,n,r):void 0}function eZ(e,t,n,{vgChannel:r}={}){return cG(r?tZ(e,t,n.style):void 0,tZ(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function tZ(e,t,n){return nZ(e,QQ(t),n)}function nZ(e,t,n){let r;t=hc(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function rZ(e,t){return hc(e).reduce(((e,n)=>{var r;return e.field.push(wQ(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function iZ(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(MH(t,e))return;n.push(e)})),n}function aZ(e,t){return MH(e,t)||!t?e:e?[...hc(e),...hc(t)].join(", "):t}function oZ(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((VQ(n)||QY(n))&&(VQ(r)||QY(r)))return{explicit:e.explicit,value:aZ(n,r)};if(VQ(n)||QY(n))return{explicit:e.explicit,value:n};if(VQ(r)||QY(r))return{explicit:e.explicit,value:r};if(!(VQ(n)||QY(n)||VQ(r)||QY(r)))return{explicit:e.explicit,value:iZ(n,r)};throw new Error("It should never reach here")}function sZ(e){return"mark"in e}class lZ{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!sZ(e)&&function(e){return bK(e)?e.type:e}(e.mark)===this.name}}var uZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function cZ(e,t){const n=e&&e[t];return!!n&&(qu(n)?BH(n,(e=>!!e.field)):lQ(n)||oQ(n))}function fZ(e){return BH(OX,(t=>{if(cZ(e,t)){const n=e[t];if(qu(n))return BH(n,(e=>!!e.aggregate));{const e=MQ(n);return e&&!!e.aggregate}}return!1}))}function dZ(e,t){const n=[],r=[],i=[],a=[],o={};return mZ(e,((s,l)=>{if(lQ(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=uZ(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=AQ(s),p=e&&e.title;let m=wQ(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:EQ(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let e;if(AG(c)?(e="argmax",m=wQ({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):EG(c)?(e="argmin",m=wQ({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),pQ(s)&&QX(f)){if(r.push({bin:f,field:u,as:m}),n.push(wQ(s,{binSuffix:"end"})),LQ(s,l)&&n.push(wQ(s,{binSuffix:"range"})),zX(l)){const e={field:m+"_end"};o[l+"2"]=e}g.bin="binned",DX(l)||(g.type=gJ)}else if(d){i.push({timeUnit:d,field:u,as:m});const e=pQ(s)&&s.type!==vJ&&"time";e&&(l===sX||l===fX?g.formatType=e:!function(e){return!!TX[e]}(l)?zX(l)&&(g.axis=Object.assign({formatType:e},g.axis)):g.legend=Object.assign({formatType:e},g.legend))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function hZ(e,t,n,r){return YH(e).reduce(((i,a)=>{if(!EX(a))return TY(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||(TY("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=VG),!function(e,t,n){const r=GX(t,n);if(!r)return!1;if("binned"===r){const n=e[t===IG?zG:BG];return!!(lQ(n)&&lQ(e[t])&&ZX(n.bin))}return!0}(e,a,t))return TY(xY(a,t)),i;if(a===eX&&"line"===t){const t=MQ(e[a]);if(null==t?void 0:t.aggregate)return TY("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===JG&&(n?"fill"in e:"stroke"in e))return TY(vY("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===uX||a===lX&&!qu(o)&&!mQ(o)||a===fX&&qu(o))o&&(i[a]=hc(o).reduce(((e,t)=>(lQ(t)?e.push(NQ(t,a)):TY(bY(t,a)),e)),[]));else{if(a===fX&&null===o)i[a]=null;else if(!(lQ(o)||cQ(o)||mQ(o)||aQ(o)||QY(o)))return TY(bY(o,a)),i;i[a]=FQ(o,a,r)}return i}),{})}function pZ(e,t){const n={};for(const r of YH(e)){const i=FQ(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function mZ(e,t,n){if(e)for(const r of YH(e)){const i=e[r];if(qu(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function gZ(e,t){return YH(t).reduce(((n,r)=>{switch(r){case zG:case BG:case dX:case pX:case hX:case IG:case LG:case VG:case WG:case qG:case UG:case HG:case GG:case XG:case YG:case sX:case ZG:case tX:case fX:return n;case lX:if("line"===e||"trail"===e)return n;case uX:case cX:{const e=t[r];if(qu(e)||lQ(e))for(const t of hc(e))t.aggregate||n.push(wQ(t,{}));return n}case eX:if("trail"===e)return n;case JG:case KG:case QG:case nX:case rX:case iX:case oX:case aX:{const e=MQ(t[r]);return e&&!e.aggregate&&n.push(wQ(e,{})),n}}}),[])}var yZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function vZ(e,t,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${bZ(t)}`:"";return{field:e+t.field,type:t.type,title:QY(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...UH(function(e){const t=[];for(const n of YH(e))if(cZ(e,n)){const r=hc(e[n]);for(const e of r)lQ(e)?t.push(e):oQ(e)&&t.push(e.condition)}return t}(n).map(xQ),RH)]}}function bZ(e){const{title:t,field:n}=e;return cG(t,n)}function xZ(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:f={}})=>{const d=bZ(n);return wZ(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},zc(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),f)})}}function wZ(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),bK(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),Fc(e[t])?{}:e[t])})]:[]}function _Z(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],l=r[i+"Error2"];return{continuousAxisChannelDef:kZ(a,n),continuousAxisChannelDef2:kZ(o,n),continuousAxisChannelDefError:kZ(s,n),continuousAxisChannelDefError2:kZ(l,n),continuousAxis:i}}function kZ(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=yZ(e,["aggregate"]);return n!==t&&TY(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function OZ(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(bK(n)&&n.orient)return n.orient;if(fQ(i)){if(fQ(a)){const e=lQ(i)&&i.aggregate,n=lQ(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return zQ(a)&&!zQ(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(fQ(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var SZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const $Z="boxplot",EZ=new lZ($Z,DZ);function AZ(e){return Rc(e)?"tukey":e}function DZ(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:pZ(e.encoding,t)});const{mark:i,encoding:a,selection:o,projection:s}=e,l=SZ(e,["mark","encoding","selection","projection"]),u=bK(i)?i:{type:i};o&&TY(fY("boxplot"));const c=null!==(n=u.extent)&&void 0!==n?n:t.boxplot.extent,f=ZQ("size",u,t),d=AZ(c),{bins:h,timeUnits:p,transform:m,continuousAxisChannelDef:g,continuousAxis:y,groupby:v,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:w,boxOrient:_,customTooltipWithoutAggregatedField:k}=function(e,t,n){const r=OZ(e,$Z),{continuousAxisChannelDef:i,continuousAxis:a}=_Z(e,r,$Z),o=i.field,s=AZ(t),l=[...CZ(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=(c[f],SZ(c,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=yZ(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(qu(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return qu(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(d),{bins:m,timeUnits:g,aggregate:y,groupby:v,encoding:b}=dZ(p,n),x="vertical"===r?"horizontal":"vertical",w=r,_=[...m,...g,{aggregate:[...y,...l],groupby:v},...u];return{bins:m,timeUnits:g,transform:_,groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:h}}(e,c,t),{color:O,size:S}=x,$=SZ(x,["color","size"]),E=e=>xZ(u,y,g,e,t.boxplot),A=E($),D=E(x),C=E(Object.assign(Object.assign({},$),S?{size:S}:{})),M=vZ([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],g,x),j={type:"tick",color:"black",opacity:1,orient:w,invalid:null,aria:!1},F="min-max"===d?M:vZ([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,x),T=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"lower_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"upper_whisker",extraEncoding:F})],N=[..."tukey"!==d?T:[],...D({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Uu(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:w,aria:!1}),positionPrefix:"mid_box",extraEncoding:M})];if("min-max"===d)return Object.assign(Object.assign({},l),{transform:(null!==(r=l.transform)&&void 0!==r?r:[]).concat(m),layer:N});const R=`datum["lower_box_${g.field}"]`,P=`datum["upper_box_${g.field}"]`,z=`(${P} - ${R})`,B=`${R} - ${c} * ${z}`,I=`${P} + ${c} * ${z}`,L=`datum["${g.field}"]`,q={joinaggregate:CZ(g.field),groupby:v},U={transform:[{filter:`(${B} <= ${L}) && (${L} <= ${I})`},{aggregate:[{op:"min",field:g.field,as:"lower_whisker_"+g.field},{op:"max",field:g.field,as:"upper_whisker_"+g.field},{op:"min",field:"lower_box_"+g.field,as:"lower_box_"+g.field},{op:"max",field:"upper_box_"+g.field,as:"upper_box_"+g.field},...b],groupby:v}],layer:T},V=SZ($,["tooltip"]),{scale:W,axis:H}=g,G=bZ(g),X=TH(H,["title"]),Y=wZ(u,"outliers",t.boxplot,{transform:[{filter:`(${L} < ${B}) || (${L} > ${I})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},void 0!==G?{title:G}:{}),void 0!==W?{scale:W}:{}),XH(X)?{}:{axis:X})},V),O?{color:O}:{}),k?{tooltip:k}:{})})[0];let J;const K=[...h,...p,q];return Y?J={transform:K,layer:[Y,U]}:(J=U,J.transform.unshift(...K)),Object.assign(Object.assign({},l),{layer:[J,{transform:m,layer:N}]})}function CZ(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var MZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const jZ="errorbar",FZ=new lZ(jZ,TZ);function TZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:pZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=RZ(e,jZ,t);delete a.size;const c=xZ(s,i,r,a,t.errorbar),f=s.thickness,d=s.size,h=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==f?{thickness:f}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==f?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function NZ(e,t){const{encoding:n}=e;if(function(e){return(hQ(e.x)||hQ(e.y))&&!hQ(e.x2)&&!hQ(e.y2)&&!hQ(e.xError)&&!hQ(e.xError2)&&!hQ(e.yError)&&!hQ(e.yError2)}(n))return{orient:OZ(e,t),inputType:"raw"};const r=function(e){return hQ(e.x2)||hQ(e.y2)}(n),i=function(e){return hQ(e.xError)||hQ(e.xError2)||hQ(e.yError)||hQ(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(hQ(e)&&hQ(r))throw new Error(`${t} cannot have both x2 and y2`);if(hQ(e)){if(fQ(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(hQ(r)){if(fQ(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(hQ(r)&&!hQ(e))throw new Error(`${t} cannot have xError2 without xError`);if(hQ(s)&&!hQ(i))throw new Error(`${t} cannot have yError2 without yError`);if(hQ(e)&&hQ(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(hQ(e)){if(fQ(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(hQ(i)){if(fQ(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function RZ(e,t,n){var r;const{mark:i,encoding:a,selection:o,projection:s}=e,l=MZ(e,["mark","encoding","selection","projection"]),u=bK(i)?i:{type:i};o&&TY(fY(t));const{orient:c,inputType:f}=NZ(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=_Z(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&TY(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:nG(t)},{fieldPrefix:"upper_",titlePrefix:PZ(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:PZ(t,n,"-")}],d=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:EQ({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:EQ({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:EQ({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&TY(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?u.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:sG(sG(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}(u,d,h,p,m,f,t,n),w=a,_=g,k=(w[_],"x"===g?"x2":"y2"),O=(w[k],"x"===g?"xError":"yError"),S=(w[O],"x"===g?"xError2":"yError2"),$=(w[S],MZ(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof O?O:O+"","symbol"==typeof S?S:S+""])),{bins:E,timeUnits:A,aggregate:D,groupby:C,encoding:M}=dZ($,n),j=[...D,...y],F="raw"!==f?[]:C,T=vZ(b,d,M,x);return{transform:[...null!==(r=l.transform)&&void 0!==r?r:[],...E,...A,...0===j.length?[]:[{aggregate:j,groupby:F}],...v],groupby:F,continuousAxisChannelDef:d,continuousAxis:g,encodingWithoutContinuousAxis:M,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:T}}function PZ(e,t,n){return nG(e)+" "+n+" "+t}const zZ="errorband",BZ=new lZ(zZ,IZ);function IZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:pZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=RZ(e,zZ,t),u=o,c=xZ(u,i,r,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),p),{aria:!1})):u.interpolate?TY(CY("interpolate")):u.tension&&TY(CY("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:l})]})}const LZ={};function qZ(e,t,n){const r=new lZ(e,t);LZ[e]={normalizer:r,parts:n}}qZ($Z,DZ,["box","median","outliers","rule","ticks"]),qZ(jZ,TZ,["ticks","rule"]),qZ(zZ,IZ,["band","borders"]);const UZ=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],VZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},WZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},HZ=YH(VZ),GZ=YH(WZ),XZ=YH({header:1,headerRow:1,headerColumn:1,headerFacet:1}),YZ=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var JZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function KZ(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=JZ(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const QZ="_vgsid_",ZZ={single:{on:"click",fields:[QZ],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[QZ],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function e0(e){return!(!e||"legend"!==e&&!e.legend)}function t0(e){return e0(e)&&Uu(e)}function n0(e){return"concat"in e}function r0(e){return"vconcat"in e}function i0(e){return"hconcat"in e}function a0(e){return Uu(e)&&void 0!==e.step}function o0(e){return e.view||e.width||e.height}const s0=YH({align:1,bounds:1,center:1,columns:1,spacing:1});var l0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function u0(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function c0(e,t){const n=f0(e,t);return a0(n)?n.step:d0}function f0(e,t){var n;return cG(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const d0=20,h0={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:d0},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:OK,circle:{},geoshape:{},image:{},line:{},point:{},rect:SK,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:ZZ,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},p0=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],m0={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},g0={blue:p0[0],orange:p0[1],red:p0[2],teal:p0[3],green:p0[4],yellow:p0[5],purple:p0[6],pink:p0[7],brown:p0[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function y0(e){const t=YH(e||{}),n={};for(const r of t){const t=e[r];n[r]=vG(t)?HQ(t):GQ(t)}return n}const v0=[..._K,...OG,...XZ,"background","padding","legend","lineBreak","scale","style","title","view"];function b0(e={}){const{color:t,font:n,fontSize:r}=e,i=l0(e,["color","font","fontSize"]),a=Wu({},h0,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:Uu(e)?Object.assign(Object.assign({},g0),e):g0}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:Uu(e)?Object.assign(Object.assign({},m0),e):m0}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=TH(a,v0);for(const e of["background","lineBreak","padding"])a[e]&&(o[e]=GQ(a[e]));for(const e of _K)a[e]&&(o[e]=eK(a[e]));for(const e of OG)a[e]&&(o[e]=y0(a[e]));for(const e of XZ)a[e]&&(o[e]=eK(a[e]));return a.legend&&(o.legend=eK(a.legend)),a.scale&&(o.scale=eK(a.scale)),a.style&&(o.style=function(e){const t=YH(e),n={};for(const r of t)n[r]=y0(e[r]);return n}(a.style)),a.title&&(o.title=eK(a.title)),a.view&&(o.view=eK(a.view)),o}const x0=["view",...vK],w0=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],_0=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function k0(e){e=jH(e);for(const t of w0)delete e[t];if(e.axis)for(const t in e.axis)vG(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of UZ)delete e.legend[t];if(e.mark){for(const t of wK)delete e.mark[t];e.mark.tooltip&&Uu(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(KZ(e.params)),delete e.params);for(const t of x0){for(const n of wK)delete e[t][n];const n=_0[t];if(n)for(const r of n)delete e[t][r];O0(e,t)}for(const t of YH(LZ))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=UQ(e.title);XH(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));XH(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));XH(r)?delete e.title:e.title=r}(e);for(const t in e)Uu(e[t])&&XH(e[t])&&delete e[t];return XH(e)?void 0:e}function O0(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);XH(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function S0(e){return"layer"in e}var $0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const E0={zero:1,center:1,normalize:1};const A0=new Set([nK,iK,rK,uK,sK,hK,pK,oK,cK,fK]),D0=new Set([iK,rK,nK]);function C0(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(lQ(a)&&lQ(o))if("quantitative"===uQ(a)&&"quantitative"===uQ(o)){if(a.stack)return t;if(o.stack)return i;const e=lQ(a)&&!!a.aggregate;if(e!==(lQ(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===uQ(a))return t;if("quantitative"===uQ(o))return i}else{if("quantitative"===uQ(a))return t;if("quantitative"===uQ(o))return i}}function M0(e,t,n={}){const r=bK(e)?e.type:e;if(!A0.has(r))return null;const i=C0(t,"x")||C0(t,"theta");if(!i)return null;const a=t[i],o=lQ(a)?wQ(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=lQ(l)?wQ(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=NX.reduce(((e,n)=>{if("tooltip"!==n&&cZ(t,n)){const r=t[n];for(const t of hc(r)){const r=MQ(t);if(r.aggregate)continue;const i=wQ(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e}),[]);let f;if(void 0!==a.stack?f=Fc(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&D0.has(r)&&(f="zero"),!f||!(f in E0))return null;var d;if(fZ(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==_J){if(n.disallowNonLinearStack)return null;TY(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return hQ(t[jX(i)])?(void 0!==a.stack&&TY(`Cannot stack "${d=i}" if there is already "${d}2".`),null):(lQ(a)&&a.aggregate&&!zH(jG,a.aggregate)&&TY(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&gK(r),stackBy:c,offset:f})}var j0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function F0(e){const t=j0(e,["point","line"]);return YH(t).length>1?t:t.type}function T0(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:TH(e[t],["point","line"])}));return e}function N0(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?Uu(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?Uu(t.point)?t.point:{}:void 0}function R0(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class P0{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(sZ(e)){const{mark:n,encoding:r}=e,i=bK(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!N0(i,t[i.type],r);case"area":return!!N0(i,t[i.type],r)||!!R0(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=j0(e,["selection","projection","mark","encoding"]),u=pZ(s,r),c=bK(o)?o:{type:o},f=N0(c,r[c.type],u),d="area"===c.type&&R0(c,r[c.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:F0(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:TH(u,["shape"])})],p=M0(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},FH(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),f&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},FH(c,["clip","tooltip"])),f),encoding:m})),n(Object.assign(Object.assign({},l),{layer:h}),Object.assign(Object.assign({},t),{config:T0(r)}))}}var z0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class B0{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(sZ(e)&&e.encoding)for(const n of PX){const r=e.encoding[n];if(r&&hQ(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of PX){const i=FX(e),a=r[e];if(a&&hQ(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=z0(a,["scale"]),s=z0(t,["rangeStep"]);n[i]={step:t.rangeStep},TY('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},o),XH(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}var I0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function L0(e,t){return t?KK(e)?G0(e,t):V0(e,t):e}function q0(e,t){return t?G0(e,t):e}function U0(e,t,n){const r=t[e];return function(e){return e&&!zc(e)&&"repeat"in e}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void TY(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t}function V0(e,t){if(void 0!==(e=U0("field",e,t))){if(null===e)return null;if(nQ(e)&&YK(e.sort)){const n=U0("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function W0(e,t){if(lQ(e))return V0(e,t);{const n=U0("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function H0(e,t){if(!hQ(e)){if(sQ(e)){const n=W0(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return I0(e,["condition"])}return e}{const n=W0(e,t);if(n)return n;if(aQ(e))return{condition:e.condition}}}function G0(e,t){const n={};for(const r in e)if(Ec(e,r)){const i=e[r];if(qu(i))n[r]=i.map((e=>H0(e,t))).filter((e=>e));else{const e=H0(i,t);void 0!==e&&(n[r]=e)}}return n}class X0{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(sZ(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of AX){const n=t[CX(e)];if(t[e]&&(lQ(n)&&!ZX(n.bin)||cQ(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return TY((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var Y0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function J0({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...YH(e),...YH(t)]);for(const a of i){const i=t[a],o=e[a];if(hQ(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else sQ(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||mQ(o)||QY(o)||hQ(o)||qu(o))&&(r[a]=o)}}else r=t;return!r||XH(r)?void 0:r}function K0(e){const{parentProjection:t,projection:n}=e;return t&&n&&TY(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${NH(t)} is overridden by a child projection ${NH(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function Q0(e,t){void 0===t&&(t=b0(e.config));const n=function(e,t={}){return Z0.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=sZ(e)||S0(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(TY(aY("width")),r=void 0),"container"==i&&(TY(aY("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?e1(n.autosize):{}),e1(e.autosize));"fit"!==s.type||a||(TY(iY),s.type="pad");"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&TY(oY("width"));"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&TY(oY("height"));if(MH(s,{type:"pad"}))return;return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const Z0=new class extends class{map(e,t){return ZK(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):i0(e)?this.mapHConcat(e,t):r0(e)?this.mapVConcat(e,t):n0(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(S0(e))return this.mapLayer(e,t);if(sZ(e))return this.mapUnit(e,t);throw new Error(rY(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=$0(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[EZ,FZ,BZ,new P0,new X0,new B0]}map(e,t){if(sZ(e)){const n=cZ(e.encoding,NG),r=cZ(e.encoding,RG),i=cZ(e.encoding,PG);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=q0(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(a,t.config))return e.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!qu(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=Y0(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map((e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+`child__layer_${ZH(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=Y0(e,["repeat","spec","data"]);!qu(r)&&e.columns&&(e=TH(e,["columns"]),TY(hY("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!qu(r)&&r.row||[l?l.row:null],f=!qu(r)&&r.column||[l?l.column:null],d=qu(r)&&r||[l?l.repeat:null];for(const e of d)for(const n of c)for(const a of f){const o={repeat:e,row:n,column:a,layer:l.layer},c=(i.name||"")+u+"child__"+(qu(r)?`${ZH(e)}`:(r.row?`row_${ZH(n)}`:"")+(r.column?`column_${ZH(a)}`:"")),f=this.map(i,Object.assign(Object.assign({},t),{repeater:o,repeaterPrefix:c}));f.name=c,s.push(TH(f,["data"]))}const h=qu(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return KK(n)&&e.columns&&(e=TH(e,["columns"]),TY(hY("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=K0({parentProjection:a,projection:r}),l=J0({parentEncoding:i,encoding:q0(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=Y0(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=Y0(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),y=q0(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:y}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&TY(`Facet encoding dropped as ${(o=[...r?[NG]:[],...i?[RG]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const t={},s={};for(const r of[NG,RG]){const i=e[r];if(i){const e=Y0(i,["align","center","spacing","columns"]);t[r]=e;for(const e of["align","center","spacing"])void 0!==i[e]&&(s[e]=null!==(n=s[e])&&void 0!==n?n:{},s[e][r]=i[e])}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:L0(Y0(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var o}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=Y0(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=Y0(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:J0({parentEncoding:n,encoding:a,layer:!0}),parentProjection:K0({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function e1(e){return zc(e)?{type:e}:null!=e?e:{}}const t1=["background","padding"];function n1(e,t){const n={};for(const t of t1)e&&void 0!==e[t]&&(n[t]=GQ(e[t]));return t&&(n.params=e.params),n}class r1{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new r1(jH(this.explicit),jH(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return cG(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of YH(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function i1(e){return{explicit:!0,value:e}}function a1(e){return{explicit:!1,value:e}}function o1(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:s1(t,n,r,i)}}function s1(e,t,n,r){return e.explicit&&t.explicit&&TY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${NH(n)} and ${NH(r)}). Using ${NH(n)}.`}(n,r,e.value,t.value)),e}function l1(e,t,n,r,i=s1){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:MH(e.value,t.value)?e:i(e,t,n,r)}class u1 extends r1{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function c1(e){return"url"in e}function f1(e){return"values"in e}function d1(e){return"name"in e&&!c1(e)&&!f1(e)&&!h1(e)}function h1(e){return e&&(p1(e)||m1(e)||g1(e))}function p1(e){return"sequence"in e}function m1(e){return"sphere"in e}function g1(e){return"graticule"in e}var y1;function v1(e){return"filter"in e}function b1(e){return void 0!==(null==e?void 0:e.stop)}function x1(e){return"lookup"in e}function w1(e){return"pivot"in e}function _1(e){return"density"in e}function k1(e){return"quantile"in e}function O1(e){return"regression"in e}function S1(e){return"loess"in e}function $1(e){return"sample"in e}function E1(e){return"window"in e}function A1(e){return"joinaggregate"in e}function D1(e){return"flatten"in e}function C1(e){return"calculate"in e}function M1(e){return"bin"in e}function j1(e){return"impute"in e}function F1(e){return"timeUnit"in e}function T1(e){return"aggregate"in e}function N1(e){return"stack"in e}function R1(e){return"fold"in e}function P1(e,t,n,r){const i=aQ(t)&&t.condition,a=r(t);if(i){return{[n]:[...hc(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?l3(e,t.selection):c3(e,t.test);return Object.assign({test:i},n)})),...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function z1(e,t="text"){const n=e.encoding[t];return P1(e,n,t,(t=>B1(t,e.config)))}function B1(e,t,n="datum"){if(e){if(mQ(e))return YQ(e.value);if(hQ(e)){const{format:r,formatType:i}=CQ(e);return RK({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function I1(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(qu(o))return{tooltip:q1({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return P1(e,o,"tooltip",(e=>{const o=B1(e,i,s);if(o)return o;if(null===e)return;let l=ZQ("tooltip",r,i);return!0===l&&(l={content:"encoding"}),zc(l)?{value:l}:Uu(l)?QY(l)?l:"encoding"===l.content?q1(n,a,i,t):{signal:s}:void 0}))}}function L1(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=CX(s),u=pQ(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=hc(u.title||DQ(u,n)).join(", ");let f;if(zX(s)){const r="x"===s?"x2":"y2",o=MQ(e[r]);if(ZX(u.bin)&&o){const e=wQ(u,{expr:a}),t=wQ(o,{expr:a}),{format:s,formatType:l}=CQ(u);f=VK(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=CQ(u);f=RK({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}f=null!=f?f:B1(u,n,a).signal,o.push({channel:s,key:c,value:f})}mZ(e,((e,t)=>{lQ(e)?s(e,t):oQ(e)&&s(e.condition,t)}));const l={};for(const{channel:e,key:t,value:n}of o)i[e]||l[t]||(l[t]=n);return l}function q1(e,t,n,{reactiveGeom:r}={}){const i=L1(e,t,n,{reactiveGeom:r}),a=KH(i).map((([e,t])=>`"${e}": ${t}`));return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function U1(e){const{markDef:t,config:n}=e,r=ZQ("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=ZQ("ariaRoleDescription",n,r);if(null!=i)return{ariaRoleDescription:{value:i}};return t in nJ?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return P1(e,a,"description",(t=>B1(t,e.config)));const o=ZQ("description",n,r);if(null!=o)return{description:YQ(o)};if(!1===r.aria)return{};const s=L1(t,i,r);if(XH(s))return;return{description:{signal:KH(s).map((([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`)).join(" + ")}}}(e))}function V1(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;void 0===s&&(l=null!=l?l:ZQ(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=YQ(l)));const u=i[e];return P1(t,u,null!=o?o:e,(n=>jK({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function W1(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:ZQ("filled",o,l),f=zH(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(i=null!==(r=ZQ(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:f,h=null!==(a=ZQ(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:YQ(d)}:{}),h?{stroke:YQ(h)}:{});return o.color&&(c?o.fill:o.stroke)&&TY(vY("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),V1("color",e,{vgChannel:p,defaultValue:c?d:h})),V1("fill",e,{defaultValue:s.fill?d:void 0})),V1("stroke",e,{defaultValue:s.stroke?h:void 0}))}function H1(e,t){const n=t[function(e){switch(e){case zG:return"xOffset";case BG:return"yOffset";case IG:return"x2Offset";case LG:return"y2Offset";case VG:return"thetaOffset";case qG:return"radiusOffset";case WG:return"theta2Offset";case UG:return"radius2Offset"}}(e)];if(n)return n}function G1(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[jX(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=H1(e,o),p=X1({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!u&&zX(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(hQ(n)&&a&&t===a.fieldChannel){if(lQ(n)){const e=rQ({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return MK({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return CK(n,i,{suffix:"end"},{offset:o})}return $K(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return m?{[r||e]:m}:void 0}function X1({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=CX(n),l=MX(n),u=ZQ(n,a,o,{vgChannel:l});if(void 0!==u)return FK(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(zH([kJ,EJ,AJ],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[FX(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(y1||(y1={}));const Y1={left:"x",center:"xc",right:"x2"},J1={top:"y",middle:"yc",bottom:"y2"};function K1(e,t,n,r="middle"){if("radius"===e||"theta"===e)return MX(e);const i="x"===e?"align":"baseline",a=ZQ(i,t,n);let o;return QY(a)?(TY(function(e){return`The ${e} for range marks cannot be an expression`}(i)),o=void 0):o=a,"x"===e?Y1[o||("top"===r?"left":"center")]:J1[o||r]}function Q1(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?Z1(e,t,{defaultPos:n,defaultPos2:r}):G1(e,t,{defaultPos:n})}function Z1(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=jX(e),s=FX(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=CX(n),u=FX(n),c=MX(n),f=r[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=H1(n in r||n in a?n:l,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){if(hQ(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0))return CK(t,a,{suffix:"start"},{offset:l});return $K({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return e2(n,a)||e2(n,{[n]:tZ(n,a,s.style),[u]:tZ(u,a,s.style)})||e2(n,s[i])||e2(n,s.mark)||{[c]:X1({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}(t,r,o),u=l[s]?K1(e,i,a):MX(e);return Object.assign(Object.assign({},G1(e,t,{defaultPos:n,vgChannel:u})),l)}function e2(e,t){const n=FX(e),r=MX(e);return void 0!==t[r]?{[r]:FK(e,t[r])}:void 0!==t[e]?{[r]:FK(e,t[e])}:t[n]?{[n]:FK(e,t[n])}:void 0}function t2(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=jX(t),d=FX(t),h=l[t],p=l[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),v=u.orient,b=null!==(i=null!==(r=l[d])&&void 0!==r?r:l.size)&&void 0!==i?i:ZQ("size",u,s,{vgChannel:d}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(lQ(h)&&(QX(h.bin)||ZX(h.bin)||h.timeUnit&&!p)&&!b&&!VJ(g)){const n=rQ({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=jX(n),f=MX(n),d=MX(c),h=H1(n,a);if(QX(e.bin)||e.timeUnit)return{[d]:i2({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:r2(c,o,l,s,h),config:u}),[f]:i2({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:r2(n,o,l,s,h),config:u})};if(ZX(e.bin)){const r=CK(e,i,{},{offset:r2(c,o,l,s,h)});if(lQ(t))return{[d]:r,[f]:CK(t,i,{},{offset:r2(n,o,l,s,h)})};if(eY(e.bin)&&e.bin.step)return{[d]:r,[f]:{signal:`scale("${i}", ${wQ(e,{expr:"datum"})} + ${e.bin.step})`,offset:r2(n,o,l,s,h)}}}return void TY(MY(c))}({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:y,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:zX(t)?ZQ("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(hQ(h)&&VJ(g)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),f=r.getScaleComponent(n),d=FX(n),h=jX(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=ZQ(p?"size":d,a,s,{vgChannel:d});let g;(o.size||void 0!==m)&&(p?g=V1("size",r,{vgChannel:d,defaultValue:m}):TY(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const y=null!==(i=hQ(t)?rQ({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[d]:n2(e,d,c,f,s,y)};const v="band"!==(null==f?void 0:f.get("type"))||!("band"in g[d]),b=K1(n,a,s,v?"middle":"top"),x=H1(n,a),w=$K({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:x,defaultRef:X1({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-y)/2});if(d)return Object.assign({[b]:w},g);{const e=MX(h),t=g[d],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:qu(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,h,t,e):Z1(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function n2(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===jJ){const e=r.get("range");return ZY(e)&&Rc(e.step)?{value:e.step-2}:{value:d0-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=c0(i.view,t),s=cG(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function r2(e,t,n,r,i){if(gX(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(QY(n)||QY(i)||QY(r)){const e=KQ(n),t=KQ(i),o=KQ(r);return{signal:(o?`${o} + `:"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function i2({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return EK({fieldDef:t,channel:e,markDef:r,ref:MK({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const a2=new Set(["aria"]);function o2(e,t){const{fill:n,stroke:r}="include"===t.color?W1(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return tJ.reduce(((n,r)=>(a2.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=YQ(e[r])),n)),{})}(e.markDef,t)),s2(e,"fill",n)),s2(e,"stroke",r)),V1("opacity",e)),V1("fillOpacity",e)),V1("strokeOpacity",e)),V1("strokeWidth",e)),V1("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!gK(n)&&mQ(r)?P1(e,r,"zindex",(e=>YQ(e.value))):{}}(e)),I1(e)),z1(e,"href")),U1(e))}function s2(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===ZQ("invalid",a,r)&&n&&!gK(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&WJ(i)&&(t[a]=!0)}return t}),{}),i=YH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>DK(e,t))).join(` ${e} `)}return}(e,{invalid:!0,channels:WX});if(r)return{[t]:[{test:r,value:null},...hc(n)]}}return n?{[t]:n}:{}}function l2(e){const{config:t,markDef:n}=e;if(ZQ("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&WJ(i)&&(t[a]=!0)}return t}),{}),i=YH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>DK(e,t))).join(` ${e} `)}return}(e,{channels:PX});if(t)return{defined:{signal:t}}}return{}}function u2(e,t){if(void 0!==t)return{[e]:YQ(t)}}const c2="voronoi",f2={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(c2)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(gK(a))return TY(`The "nearest" transform is not supported for ${a} marks.`),n;const o={name:e.getName(c2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},I1(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(c2)>=0&&(l=!0)})),l||n.splice(s+1,0,o),n}};class d2{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?TY("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class h2 extends d2{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${dG()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var p2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class m2 extends d2{constructor(e,t){super(e),this.formula=t}clone(){return new m2(null,jH(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,o=q4(t)?t.encoding[jX(r)]:void 0,s=q4(t)&&iQ(r,n,o,t.stack,t.markDef,t.config);if(a){const t=wQ(n,{forAs:!0});e[RH({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return XH(n)?null:new m2(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=p2(n,["timeUnit"]),a=KY(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new m2(e,{[RH(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of KH(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(JH(this.formula).map((e=>e.as)))}dependentFields(){return new Set(JH(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${RH(this.formula)}`}assemble(){const e=[];for(const t of JH(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=KY(i),{unit:o,utc:s}=a,l=p2(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:oG(n),type:"timeunit"},o?{units:GY(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return e}}var g2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const y2="_tuple_fields";class v2{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const b2={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!e0(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=f2.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var l,u;const c=ZH(`${r}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:z2(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Hc(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+J2))[0],o=r+y2,s=i.items.map((e=>ZH(`${r}_${e.field}`))),l=s.map((e=>`${e} !== null`)).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},x2="_toggle",w2={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+x2,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+J2,r=t.name+x2;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${t3(e)}}, `)+`${r} ? ${n} : null`}},_2={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=zc(n.clear)?Eq(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(b2.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===ZH(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));if(r(t,"[0, 0]"),-1===t){r(n.findIndex((t=>t.name===e.signals.data)),"null")}}else{let e=n.findIndex((e=>e.name===t.name+J2));r(e,"null"),w2.has(t)&&(e=n.findIndex((e=>e.name===t.name+x2)),r(e,"false"))}return n}},k2={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!HX(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!WJ(o)){TY("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:t.name,field:r.field};a.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||S2(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf(Q2)>=0)i.update=`{${r.map((e=>`${Hc(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${Hc(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!S2(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function O2(e,t){return`domain(${Hc(e.scaleName(t))})`}function S2(e){var t;return e.parent&&W4(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:S2(e.parent.parent))}const $2={has:e=>{const t="global"===e.resolve&&e.bind&&e0(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==QZ;return t&&!n&&TY("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=hc(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=t0(t.bind)?t.bind.legend:"click",o=zc(a)?Eq(a,"view"):hc(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=t0(t.bind)&&t.bind.legend,a=e=>t=>{const n=jH(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const o=`${ZH(e.field)}_legend`,s=`${r}_${o}`;if(0===n.filter((e=>e.name===s)).length){const e=i.merge.map(a(`${o}_symbols`)).concat(i.merge.map(a(`${o}_labels`))).concat(i.merge.map(a(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+J2)),o=r+y2,s=i.items.filter((e=>e.hasLegend)).map((e=>ZH(`${r}_${ZH(e.field)}_legend`))),l=`${s.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map((e=>({signal:e}))),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find((e=>e.name===r+x2)),c=t0(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}};const E2="_translate_anchor",A2="_translate_delta",D2={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=k2.has(t),a=r+E2,{x:o,y:s}=t.project.hasChannel;let l=Eq(t.translate,"scope");return i||(l=l.map((e=>(e.between[0].markname=r+q2,e)))),n.push({name:a,value:{},on:[{events:l.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?O2(e,zG):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?O2(e,BG):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+A2,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&C2(e,t,o,"width",n),void 0!==s&&C2(e,t,s,"height",n),n}};function C2(e,t,n,r,i){var a;const o=t.name,s=o+E2,l=o+A2,u=n.channel,c=k2.has(t),f=i.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],d=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(u),p=h.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===zG?"-":""}${l}.${u} / `+(c?`${d}`:`span(${m})`)}`+(c&&"pow"===p?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${d})`})}const M2="_zoom_anchor",j2="_zoom_delta",F2={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=k2.has(t),a=r+j2,{x:o,y:s}=t.project.hasChannel,l=Hc(e.scaleName(zG)),u=Hc(e.scaleName(BG));let c=Eq(t.zoom,"scope");return i||(c=c.map((e=>(e.markname=r+q2,e)))),n.push({name:r+M2,on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&T2(e,t,o,"width",n),void 0!==s&&T2(e,t,s,"height",n),n}};function T2(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=k2.has(t),u=i.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?O2(e,s):u.name,p=o+j2,m=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${h}, ${`${o}${M2}.${s}`}, ${p}`+(l&&"pow"===d?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const N2=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new v2,l={},u={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=ZH(`${o}_${n}`);for(let e=1;c.has(r);e++)r=ZH(`${o}_${n}_${e}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of hc(n.init))for(const r of YH(e))$X[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(TY('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),s.items.push(t),s.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){TY(cY(r,n.aggregate));continue}if(!i){TY(uY(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};u[RH(t)]=t}if(!l[i]){let a="E";if("interval"===t.type){WJ(e.getScaleComponent(r).get("type"))&&(a="R")}else n.bin&&(a="R-RE");const o={field:i,channel:r,type:a};o.signals=Object.assign(Object.assign({},f(o,"data")),f(o,"visual")),s.items.push(l[i]=o),s.hasField[i]=s.hasChannel[r]=l[i]}}else TY(uY(r))}if(n.init){const e=e=>s.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=hc(n.init);t.init=r.map(e)}}XH(u)||(s.timeUnit=new m2(null,u))},signals:(e,t,n)=>{const r=t.name+y2;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const t=g2(e,["signals","hasLegend"]);return t.field=oG(t.field),t}))})}},w2,k2,$2,D2,F2,b2,f2,_2];function R2(e,t){for(const n of N2)n.has(e)&&t(n)}var P2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function z2(e,t=!0,n=Nu){if(qu(e)){const r=e.map((e=>z2(e,t,n)));return t?`[${r.join(", ")}]`:r}return NY(e)?n(t?LY(e):function(e){const t=IY(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function B2(e,t){return e3(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,R2(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function I2(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}var L2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const q2="_brush",U2="_scale_trigger",V2={signals:(e,t)=>{const n=t.name,r=n+y2,i=k2.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${Hc(n+q2)}`;W2(t,((t,n)=>{var r;const i=hc(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==zG&&i!==BG)return void TY("Interval selections only support x and y encoding channels.");const l=t.init?t.init[r]:null,u=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=k2.has(t),l=Hc(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,f=e=>`scale(${l}, ${e})`,d=e.getSizeSignalRef(i===zG?"width":"height").signal,h=`${i}(unit)`,p=W2(t,((e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]));return p.push({events:{signal:t.name+U2},update:WJ(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:z2(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:z2(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,l),c=n.signals.data,f=n.signals.visual,d=Hc(e.scaleName(i)),h=WJ(e.getScaleComponent(i).get("type"))?"+":"";a.push(...u),o.push(c),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${c}) || (${h}invert(${d}, ${f})[0] === ${h}${c}[0] && ${h}invert(${d}, ${f})[1] === ${h}${c}[1]))`})})),i||a.push({name:n+U2,value:{},on:[{events:s.map((e=>({scale:e.scaleName}))),update:s.map((e=>e.expr)).join(" && ")+` ? ${n+U2} : {}`}]});const l=t.init,u=`unit: ${t3(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+J2},l?{init:`{${u}: ${z2(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+J2+", "+("global"===t.resolve?"true":`{unit: ${t3(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${Hc(t.name+Y2)})`;if(k2.has(t))return n;const u={x:void 0!==i?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of YH(u))u[t]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${t3(e)}`},u[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=L2(c,["fill","fillOpacity","cursor"]),m=YH(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:r+q2+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:r+q2,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function W2(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(TY(`${n} is not an ordered event stream for interval selections.`),e)),[])}function H2(e,t){const n=t.name,r=n+y2,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${Hc(e.vgField(t.channel,{}))}], ${a}[${Hc(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${Hc(t.field)}]`})).join(", "),s=`unit: ${t3(e)}, fields: ${r}, values`,l=t.events;return[{name:n+J2,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const G2={signals:H2,modifyExpr:(e,t)=>t.name+J2+", "+("global"===t.resolve?"null":`{unit: ${t3(e)}}`)},X2={signals:H2,modifyExpr:(e,t)=>t.name+J2+", "+("global"===t.resolve?"true":`{unit: ${t3(e)}}`)},Y2="_store",J2="_tuple",K2="_modify",Q2="vlSelectionResolve",Z2={single:X2,multi:G2,interval:V2};function e3(e,t){const n=e.component.selection;if(n)for(const e of JH(n)){if(!0===t(e,Z2[e.type]))break}}function t3(e,{escape:t}={escape:!0}){let n=t?Hc(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!U4(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of _X)e[t]&&(n+=` + '__facet_${t}_' + (facet[${Hc(r.vgField(t))}])`)}return n}function n3(e){let t=!1;return e3(e,(e=>{t=t||e.project.items.some((e=>e.field===QZ))})),t}function r3(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...r3(e.object)),t.push(...r3(e.property))),t)}function i3(e){return"MemberExpression"===e.object.type?i3(e.object):"datum"===e.object.name}function a3(e){const t=EI(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&i3(e)&&n.add(r3(e).slice(1).join("."))})),n}class o3 extends d2{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=c3(this.model,this.filter,this),this._dependentFields=a3(this.expr)}clone(){return new o3(null,this.model,jH(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var s3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function l3(e,t,n,r="datum"){const i=[];const a=eG(t,(function(t){const a=ZH(t),o=e.getSelectionComponent(a,t),s=Hc(a+Y2);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${Hc(o.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function u3(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,TY((i.length?"Multiple ":"No ")+`matching ${Hc(n)} encoding found for selection ${Hc(t.selection)}. `+`Using "field": ${Hc(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&TY(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Hc(r)}.`);return`${e.name}[${Hc(r)}]`}function c3(e,t,n){return eG(t,(t=>zc(t)?t:function(e){return null==e?void 0:e.selection}(t)?l3(e,t.selection,n):hJ(t)))}var f3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function d3(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function h3(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=f3(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in h){const n=xG[e],r=h[e];if(n&&n!==t&&"both"!==n)delete h[e];else if(vG(r)){const{condition:t}=r,n=f3(r,["condition"]),i=hc(t),a=yG[e];if(a){const{vgProp:t,part:r}=a;d3(h,r,t,[...i.map((e=>{const{test:t}=e,n=f3(e,["test"]);return Object.assign({test:c3(null,t)},n)})),n]),delete h[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=f3(e,["test"]);return`${c3(null,t)} ? ${JQ(n)} : `})).join("")+JQ(n)};h[e]=t}}else if(QY(r)){const t=yG[e];if(t){const{vgProp:n,part:i}=t;d3(h,i,n,r),delete h[e]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),XH(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:cG(d,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=h.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&QY(h.encode.labels.update.text)&&(e=sG(c,"datum.label",h.encode.labels.update.text.signal)),d3(h,"labels","text",{signal:e})}if(null===h.labelAlign&&delete h.labelAlign,h.encode){for(const t of bG)e.hasAxisPart(t)||delete h.encode[t];XH(h.encode)&&delete h.encode}const t=function(e,t){if(e)return qu(e)&&!VQ(e)?e.map((e=>DQ(e,t))).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),h),!1===n.aria?{aria:!1}:{}),{zindex:cG(d,0)})}}}function p3(e){const{axes:t}=e.component,n=[];for(const r of PX)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function m3(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...YH(i),...YH(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${KQ(i[t])} : ${KQ(a[t])}`};return s}return t[e]}))])}function g3(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:function(e){return e in IJ}(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=QY(n)?"axisOrient":"axis"+nG(n),s=[...i,...i.map((e=>a+e.substr(4)))],l=["axis",o,a];return{vlOnlyAxisConfig:m3(s,r,e,n),vgAxisConfig:m3(l,r,e,n),axisConfigStyle:y3([...l,...s],r)}}function y3(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=hc(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function v3(e,t,n,r={}){var i;const a=nZ(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const b3={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return BK(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return IK(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!lQ(e)||!ZX(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!VJ(e)&&lQ(t)&&!QX(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||_3(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||w3(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&zH(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!Uu(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy";return}(t.type,n,lQ(t)&&!!t.timeUnit,lQ(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!VJ(t)&&"log"!==t){if(lQ(e)){if(QX(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&zH(["month","hours","day","quarter"],null===(i=KY(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=k3(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",o=t.fieldDef(a);return iZ(i?[tQ(i)]:[],lQ(o)?[tQ(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(qu(n))return IQ(t,n);if(QY(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){if("rect"===e&&_Q(t))return 1;return 0}(n,t)}};function x3(e){return`(((${e.signal} % 360) + 360) % 360)`}function w3(e,t,n,r){if(void 0!==e){if("x"===n){if(QY(e)){const n=x3(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${QY(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(QY(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(QY(e)){const n=x3(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${QY(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(QY(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function _3(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(QY(e)){const n=x3(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${QY(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(QY(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${n} "${a}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function k3(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?aZ(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}class O3 extends d2{constructor(e,t){super(e),this.transform=t,this._dependentFields=a3(this.transform.calculate)}clone(){return new O3(null,jH(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(gQ(t)&&JK(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map(((e,t)=>`${hJ({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new O3(e,{calculate:o,as:S3(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${RH(this.transform)}`}}function S3(e,t,n){return wQ(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function $3(e,t){return zH(["top","bottom"],t)?"column":zH(["left","right"],t)||"row"===e?"row":"column"}function E3(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return cG((t||{})[e],i[e],n.header[e])}function A3(e,t,n,r){const i={};for(const a of e){const e=E3(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const D3=["row","column"],C3=["header","footer"];function M3(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=A3(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=$3(t,s),u=mG(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),F3(u,l)),j3(l,u,a)),I3(r,i,t,HZ,VZ))}}function j3(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=_3(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function F3(e,t){const n=w3(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function T3(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of C3)if(n[i])for(const a of n[i]){const o=P3(e,t,i,n,a);null!=o&&r.push(o)}return r}function N3(e,t){var n;const{sort:r}=e;return YK(r)?{field:wQ(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:qu(r)?{field:S3(e,t,{expr:"datum"}),order:"ascending"}:{field:wQ(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function R3(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=A3(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=RK({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=$3(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?sG(sG(l,"datum.label",u),"datum.value",wQ(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),F3(a,c)),j3(c,a,o)),I3(n,e,t,GZ,WZ))}function P3(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=A3(["labelOrient"],o.header,s,t);("row"===t&&!zH(["top","bottom"],e)||"column"===t&&!zH(["left","right"],e))&&(a=R3(o,t,s))}const l=U4(e)&&!KK(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:N3(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const z3={column:{start:0,end:1},row:{start:1,end:0}};function B3(e,t){return z3[t][e]}function I3(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=E3(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function L3(e){return[...q3(e,"width"),...q3(e,"height"),...q3(e,"childWidth"),...q3(e,"childHeight")]}function q3(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(VJ(r)&&ZY(a)){const r=e.scaleName(n);if(U4(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[U3(r,a)]}return[U3(r,a),{name:i,update:V3(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${u0(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function U3(e,t){return{name:e+"_step",value:t.step}}function V3(e,t,n){const r=t.get("type"),i=t.get("padding"),a=cG(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${KQ(o)}, ${KQ(a)}) * ${e}_step`}function W3(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function H3(e,t){return YH(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),P1(t,i,r,(e=>YQ(e.value))))}),{})}function G3(e,t){if(W4(t)||U4(t))return"shared";if(V4(t))return zX(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function X3(e,t){const n=e.scale[t],r=zX(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&TY(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const Y3=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),J3=YH(Y3);class K3 extends r1{}const Q3={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,f,d,h;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:y}=n,v=p.filled&&"trail"!==y;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=eZ(r,t.markDef,t.config);void 0!==n&&(e[r]=YQ(n))}return e}({},n,xK)),W1(n,{filled:v}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,k=void 0===x?null!==(u=Z3(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||v&&r===JG)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=YQ(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=YQ(null!=k?k:1));else if(qu(b.fill)){const e=null!==(h=null!==(d=e5(null!==(f=m.fill)&&void 0!==f?f:m.color))&&void 0!==d?d:p.fill)&&void 0!==h?h:v&&p.color;e&&(b.fill=YQ(e))}if(b.stroke)if("stroke"===r||!v&&r===JG)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(qu(b.stroke)){const e=cG(e5(m.stroke||m.color),p.stroke,v?p.color:void 0);e&&(b.stroke={value:e})}if(r!==nX){const e=lQ(t)&&n5(n,i,t);e?b.opacity=[Object.assign({test:e},YQ(null!=k?k:1)),YQ(g.legend.unselectedOpacity)]:k&&(b.opacity=YQ(k))}return b=Object.assign(Object.assign({},b),e),XH(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?Z3(s.opacity)||o.opacity:void 0;u&&(l.opacity=YQ(u));return l=Object.assign(Object.assign({},l),e),XH(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=lQ(t)?n5(n,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=TK(c)?zK({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return XH(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function Z3(e){return t5(e,((e,t)=>Math.max(e,t.value)))}function e5(e){return t5(e,((e,t)=>cG(e,t.value)))}function t5(e,t){return function(e){const t=e&&e.condition;return!!t&&(qu(t)||mQ(t))}(e)?hc(e.condition).reduce(t,e.value):mQ(e)?e.value:void 0}function n5(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=Hc(n.field);return r.map((e=>`(!length(data(${Hc(ZH(e)+Y2)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const r5={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return BK(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return IK(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(HJ(i))return"horizontal"===n?"top"===r||"bottom"===r?o5(t,"width",o,a):o:o5(t,"height",l,s);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(zH(["quantile","threshold","log","symlog"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=e5(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>EQ(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(xX(n)&&HJ(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(qu(n))return IQ(t,n);if(QY(n))return n;return}(t,e)};function i5(e){const{legend:t}=e;return cG(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(xX(e)){if(zH(["quarter","month","day"],t))return"symbol";if(HJ(n))return"gradient"}return"symbol"}(e))}function a5({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function o5(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function s5(e){const t=q4(e)?function(e){const{encoding:t}=e,n={};for(const r of[JG,...YZ]){const i=jQ(t[r]);i&&e.getScaleComponent(r)&&(r===ZG&&lQ(i)&&i.type===xJ||(n[r]=u5(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){s5(r);for(const i of YH(r.component.legends))n.legend[i]=X3(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=c5(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of YH(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function l5(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function u5(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new K3({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;e3(e,(e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&$2.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}}))}(e,t,c);const f=void 0!==a?!a:u.disable;if(c.set("disable",f,void 0!==a),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=jQ(s[t]),p=lQ(h)?null===(n=KY(h.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=i5({legend:a,channel:t,timeUnit:p,scaleType:d}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:m,legendType:g,direction:a5({legend:a,legendType:g,orient:m,legendConfig:u})};for(const n of J3){if("gradient"===g&&n.startsWith("symbol")||"symbol"===g&&n.startsWith("gradient"))continue;const r=n in r5?r5[n](y):a[n];if(void 0!==r){const i=l5(r,n,a,e.fieldDef(t));(i||void 0===l.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=H3(null!==(i=v[t])&&void 0!==i?i:{},e),r=t in Q3?Q3[t](n,w):n;void 0===r||XH(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&lQ(h)?{name:`${ZH(h.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return XH(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function c5(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const n of J3){const r=l1(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return f5(e,t);case"title":return oZ(e,t);case"type":return l=!0,a1("symbol")}return s1(e,t,n,"legend")}));e.setWithExplicit(n,r)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&tG(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&tG(e.explicit,["encode","gradient"])),e}function f5(e,t){return"circle"===t.value?t:e}var d5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function h5(e){const t=e.component.legends,n={};for(const r of YH(t)){const i=e.getScaleComponent(r),a=NH(i.get("domains"));if(n[a])for(const e of n[a]){c5(e,t[r])||n[a].push(t[r])}else n[a]=[t[r].clone()]}return JH(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=d5(a,["disable","labelExpr","selections"]);if(o)return;!1===t.aria&&null==u.aria&&(u.aria=!1);if(null===(n=u.encode)||void 0===n?void 0:n.symbols){const e=u.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||u.stroke||(e.stroke={value:"transparent"});for(const t of YZ)u[t]&&delete e[t]}u.title||delete u.title;if(void 0!==s){let e=s;(null===(i=null===(r=u.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&QY(u.encode.labels.update.text)&&(e=sG(s,"datum.label",u.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}(u,"labels","text",{signal:e})}return u}(t,e.config))).filter((e=>void 0!==e))}function p5(e){return W4(e)||V4(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),m5(e))}(e):m5(e)}function m5(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=QY(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return zH(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const g5=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class y5 extends r1{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function v5(e){e.component.projection=q4(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[GG,HG],[YG,XG]])(jQ(n[r[0]])||jQ(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});e.channelHasField(ZG)&&e.typedFieldDef(ZG).type===xJ&&t.push({signal:e.getName(`geojson_${t.length}`)});0===t.length&&t.push(e.requestDataName(y1.Main));return t}(e):void 0;return new y5(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)v5(t);const n=IH(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=IH(g5,(n=>!Ec(e.explicit,n)&&!Ec(t.explicit,n)||!(!Ec(e.explicit,n)||!Ec(t.explicit,n)||NH(e.get(n))!==NH(t.get(n)))));if(NH(e.size)===NH(t.size)){if(n)return e;if(NH(e.explicit)===NH({}))return t;if(NH(t.explicit)===NH({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new y5(n,t.specifiedProjection,t.size,jH(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}return}(e)}var b5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function x5(e,t){return`${KX(e)}_${t}`}function w5(e,t,n){var r;const i=x5(null!==(r=RQ(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function _5(e,t,n){let r,i;r=function(e){return"as"in e}(e)?zc(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[wQ(e,{forAs:!0}),wQ(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},RQ(t,void 0)),o=x5(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,o);if(tY(a.extent)){const e=a.extent,t=e.selection;i=u3(n.getSelectionComponent(ZH(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class k5 extends d2{constructor(e,t){super(e),this.bins=t}clone(){return new k5(null,jH(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(pQ(n)&&QX(n.bin)){const{key:i,binComponent:a}=_5(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(LQ(t,n)){const o=q4(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=wQ(t,{expr:"datum"}),l=wQ(t,{expr:"datum",binSuffix:"end"});return{formulaAs:wQ(t,{binSuffix:"range",forAs:!0}),formula:VK(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return XH(n)?null:new k5(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=_5(t,t.bin,n);return new k5(e,{[r]:i})}merge(e,t){for(const n of YH(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=UH([...this.bins[n].as,...e.bins[n].as],RH)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(JH(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(JH(this.bins).map((e=>e.field)))}hash(){return`Bin ${RH(this.bins)}`}assemble(){return JH(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=b5(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:oG(e.field),as:n,signal:e.signal},tY(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:oG(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:wQ({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}function O5(e,t,n,r){const i=q4(r)?r.encoding[jX(t)]:void 0;if(pQ(n)&&q4(r)&&iQ(t,n,i,r.stack,r.markDef,r.config))e.add(wQ(n,{})),e.add(wQ(n,{suffix:"end"})),n.bin&&LQ(n,t)&&e.add(wQ(n,{binSuffix:"range"}));else if(function(e){return e in yX}(t)){const n=function(e){switch(e){case HG:return"y";case XG:return"y2";case GG:return"x";case YG:return"x2"}}(t);e.add(r.getName(n))}else e.add(wQ(n));return e}class S5 extends d2{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new S5(null,new Set(this.dimensions),jH(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([wQ(e,{forAs:!0})]);else{if(EG(u)||AG(u)){const e=EG(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([wQ({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([wQ(e,{forAs:!0})]);HX(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([wQ({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([wQ({field:c,aggregate:"max"},{forAs:!0})]))}else O5(i,n,e,t)})),i.size+YH(r).length===0?null:new S5(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([a||wQ(e,{forAs:!0})])):(o[i]=null!==(r=o[i])&&void 0!==r?r:{},o[i][t]=new Set([a||wQ(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+YH(o).length===0?null:new S5(e,a,o)}merge(e){return VH(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of YH(t)){const i=t[r];for(const t of YH(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){FY.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...YH(this.measures)])}producedFields(){const e=new Set;for(const t of YH(this.measures))for(const n of YH(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${RH({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of YH(this.measures))for(const i of YH(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:oG(r));return{type:"aggregate",groupby:[...this.dimensions].map(oG),ops:e,fields:t,as:n}}}class $5 extends d2{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of _X){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[wQ(n),...QX(r)?[wQ(n,{binSuffix:"end"})]:[]]},YK(i)?{sortField:i}:qu(i)?{sortIndexField:S3(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of _X)this[t]&&(e+=` ${t.charAt(0)}:${RH(this[t])}`);return e}get fields(){var e;const t=[];for(const n of _X)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of _X)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of PX){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(VJ(r)&&ZY(i)){const n=b4(x4(this.childModel,t));n?e[t]=n:TY(lY(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=WK,field:t}=s;i.push(t),a.push(e),o.push(wQ(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const e of D3){for(const r of C3){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[e]=!0;break}}if(o[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const e of[RG,NG])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function E5(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function A5(e){const t={};return DH(e.filter,(e=>{var n;if(fJ(e)){let r=null;iJ(e)?r=GQ(e.equal):oJ(e)?r=GQ(e.lte):aJ(e)?r=GQ(e.lt):sJ(e)?r=GQ(e.gt):lJ(e)?r=GQ(e.gte):uJ(e)?r=e.range[0]:cJ(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(NY(r)?t[e.field]="date":Rc(r)?t[e.field]="number":zc(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}function D5(e){const t={};function n(e){var n;zQ(e)?t[e.field]="date":"quantitative"===e.type&&(zc(n=e.aggregate)&&zH(["min","max"],n))?t[e.field]="number":uG(e.field)>1?e.field in t||(t[e.field]="flatten"):gQ(e)&&YK(e.sort)&&uG(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((q4(e)||U4(e))&&e.forEachFieldDef(((t,r)=>{if(pQ(t))n(t);else{const i=CX(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),q4(e)){const{mark:n,markDef:r,encoding:i}=e;if(gK(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];lQ(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class C5 extends d2{constructor(e,t){super(e),this._parse=t}clone(){return new C5(null,jH(this._parse))}hash(){return`Parse ${RH(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!h1(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of YH(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:TY(pY(e,n[e],t.value)))}for(const e of YH(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:TY(pY(e,t[e],n)))}const i=new r1(t,n);r.copyAll(i);const a={};for(const e of YH(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===YH(a).length||r.parseNothing?null:new C5(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of YH(this._parse)){const n=this._parse[t];1===uG(t)&&(e[t]=n)}return e}producedFields(){return new Set(YH(this._parse))}dependentFields(){return new Set(YH(this._parse))}assembleTransforms(e=!1){return YH(this._parse).filter((t=>!e||uG(t)>1)).map((e=>{const t=function(e,t){const n=rG(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:"))return`timeParse(${n},'${E5(t.slice(5,t.length))}')`;if(0===t.indexOf("utc:"))return`utcParse(${n},'${E5(t.slice(4,t.length))}')`;return TY(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:lG(e)}})).filter((e=>null!==e))}}class M5 extends d2{clone(){return new M5(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([QZ])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:QZ}}}class j5 extends d2{constructor(e,t){super(e),this.params=t}clone(){return new j5(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${RH(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class F5 extends d2{constructor(e,t){super(e),this.params=t}clone(){return new F5(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${RH(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class T5 extends d2{constructor(e){let t;if(super(null),h1(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},TH(e.format,["parse"])):{}),f1(e))this._data={values:e.values};else if(c1(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];zH(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else m1(e)?this._data={values:[{type:"Sphere"}]}:(d1(e)||h1(e))&&(this._data={});this._generator=h1(e),e.name&&(this._name=e.name),t&&!XH(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var N5,R5=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},P5=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};function z5(e){return e instanceof T5||e instanceof j5||e instanceof F5}class B5{constructor(){N5.set(this,void 0),R5(this,N5,!1)}setModified(){R5(this,N5,!0)}get modifiedFlag(){return P5(this,N5)}}N5=new WeakMap;class I5 extends B5{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort(((e,t)=>t[1]-e[1]));for(const e of t)this.run(e[0]);return this.modifiedFlag}}class L5 extends B5{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class q5 extends L5{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of YH(n))n[t].length>1&&(this.setModified(),this.mergeNodes(e,n[t]))}}class U5 extends L5{constructor(e){super(),this.requiresSelectionId=e&&n3(e)}run(e){e instanceof M5&&(this.requiresSelectionId&&(z5(e.parent)||e.parent instanceof S5||e.parent instanceof C5)||(this.setModified(),e.remove()))}}class V5 extends B5{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof m2&&(n=e.producedFields(),WH(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class W5 extends L5{constructor(){super()}run(e){e instanceof h2&&!e.isRequired()&&(this.setModified(),e.remove())}}class H5 extends I5{run(e){if(!(z5(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof C5)if(e instanceof C5)this.setModified(),e.merge(t);else{if(GH(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class G5 extends I5{run(e){const t=[...e.children],n=e.children.filter((e=>e instanceof C5));if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of YH(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!XH(r)){this.setModified();const n=new C5(e,r);for(const i of t){if(i instanceof C5)for(const e of YH(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof C5&&0===YH(i.parse).length&&i.remove()}}}}}class X5 extends I5{run(e){e instanceof h2||e.numChildren()>0||e instanceof $5||e instanceof T5||(this.setModified(),e.remove())}}class Y5 extends I5{run(e){const t=e.children.filter((e=>e instanceof m2)),n=t.pop();for(const e of t)this.setModified(),n.merge(e)}}class J5 extends I5{run(e){const t=e.children.filter((e=>e instanceof S5)),n={};for(const e of t){const t=RH(e.groupBy);t in n||(n[t]=[]),n[t].push(e)}for(const t of YH(n)){const r=n[t];if(r.length>1){const t=r.pop();for(const n of r)t.merge(n)&&(e.removeChild(n),n.parent=t,n.remove(),this.setModified())}}}}class K5 extends I5{constructor(e){super(),this.model=e}run(e){const t=!(z5(e)||e instanceof o3||e instanceof C5||e instanceof M5),n=[],r=[];for(const i of e.children)i instanceof k5&&(t&&!GH(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof k5?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class Q5 extends I5{run(e){const t=[...e.children];if(!BH(t,(e=>e instanceof h2))||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof h2){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof h2))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class Z5 extends d2{constructor(e,t){super(e),this.transform=t}clone(){return new Z5(null,jH(this.transform))}addDimensions(e){this.transform.groupby=UH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:wQ(e)}hash(){return`JoinAggregateTransform ${RH(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class e4 extends d2{constructor(e,t){super(e),this._stack=t}clone(){return new e4(null,jH(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const e of t.sort)o.push(e.field),s.push(cG(e.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return qu(e)&&e.every((e=>zc(e)))&&e.length>1}(i)?i:zc(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new e4(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;if(i){l=MQ(r[i])}const u=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=wQ(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let f;return f=qu(c)||lQ(c)?rZ(c):u.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new e4(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${RH(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[wQ(e,{binSuffix:"mid"})]:[wQ(e,{}),wQ(e,{binSuffix:"end"})]:[wQ(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+wQ(n,{expr:"datum"})+`+${1-a}*`+wQ(n,{expr:"datum",binSuffix:"end"}),as:wQ(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:wQ(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class t4 extends d2{constructor(e,t){super(e),this.transform=t}clone(){return new t4(null,jH(this.transform))}addDimensions(e){this.transform.groupby=UH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:wQ(e)}hash(){return`WindowTransform ${RH(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>DG(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)s.push(t.field),l.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:u},void 0!==c?{ignorePeers:c}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function n4(e){if(e instanceof $5)if(1!==e.numChildren()||e.children[0]instanceof h2){const n=e.model.component.data.main;r4(n);const r=(t=e,function e(n){if(!(n instanceof $5)){const r=n.clone();if(r instanceof h2){const e=i4+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof S5||r instanceof e4||r instanceof t4||r instanceof Z5)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof S5||t instanceof e4||t instanceof t4||t instanceof Z5)&&t.addDimensions(e.fields),t.swapWithParent(),n4(e)}else e.children.map(n4);var t}function r4(e){if(e instanceof h2&&e.type===y1.Main&&1===e.numChildren()){const t=e.children[0];t instanceof $5||(t.swapWithParent(),r4(e))}}const i4="scale_";function a4(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!a4(t.children))return!1}return!0}function o4(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function s4(e,t,n){let r=e.sources,i=!1;return i=o4(new W5,r)||i,i=o4(new U5(t),r)||i,r=r.filter((e=>e.numChildren()>0)),i=o4(new X5,r)||i,r=r.filter((e=>e.numChildren()>0)),n||(i=o4(new H5,r)||i,i=o4(new K5(t),r)||i,i=o4(new V5,r)||i,i=o4(new G5,r)||i,i=o4(new J5,r)||i,i=o4(new Y5,r)||i,i=o4(new q5,r)||i,i=o4(new Q5,r)||i),e.sources=r,i}class l4{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new l4((()=>e(t)))}}var u4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function c4(e){q4(e)?function(e){const t=e.component.scales;for(const n of YH(t)){const r=f4(e,n);if(t[n].setWithExplicit("domains",r),m4(e,n),e.component.data.isFaceted){let t=e;for(;!U4(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)eJ(e)&&(e.data=i4+e.data.replace(i4,""))}}}(e):function(e){for(const t of e.children)c4(t);const t=e.component.scales;for(const n of YH(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):l1(r,e.getWithExplicit("domains"),"domains","scale",y4);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&TY(dY),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function f4(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=g4(t,n);if(!e)return void TY(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=g4(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&jQ(r.x2)?jQ(r.x)?l1(h4(n,i,e,"x"),h4(n,i,e,"x2"),"domain","scale",y4):h4(n,i,e,"x2"):"y"===t&&jQ(r.y2)?jQ(r.y)?l1(h4(n,i,e,"y"),h4(n,i,e,"y2"),"domain","scale",y4):h4(n,i,e,"y2"):h4(n,i,e,t)}function d4(e,t,n){var r;const i=null===(r=KY(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${BQ(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function h4(e,t,n,r){const{encoding:i}=n,a=jQ(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=h4(e,void 0,n,r),a=d4(t.unionWith,o,s);return i1([...i.value,...a])}if(QY(t))return i1([t]);if(t&&"unaggregated"!==t&&!XJ(t))return i1(d4(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return a1([[0,1]]);const e=n.requestDataName(y1.Main);return a1([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=HX(r)&&lQ(a)?function(e,t,n){if(!VJ(n))return;const r=e.fieldDef(t),i=r.sort;if(JK(i))return{op:"min",field:S3(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(YK(i)){return p4(i,a&&!zH(o,i.field))}if(XK(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!zH(o,l);if(EG(s)||AG(s))return p4({field:wQ(r),order:n},u);if(DG(s)||!s)return p4({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(zH(["ascending",void 0],i))return!0}return}(n,r,e):void 0;if(cQ(a)){return a1(d4([a.datum],o,s))}const c=a;if("unaggregated"===t){const e=n.requestDataName(y1.Main),{field:t}=a;return a1([{data:e,field:wQ({field:t,aggregate:"min"})},{data:e,field:wQ({field:t,aggregate:"max"})}])}if(QX(c.bin)){if(VJ(e))return a1("bin-ordinal"===e?[]:[{data:QH(u)?n.requestDataName(y1.Main):n.requestDataName(y1.Raw),field:n.vgField(r,LQ(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&Uu(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(QX(e)){const t=w5(n,c.field,e);return a1([new l4((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return a1([{data:n.requestDataName(y1.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&zH(["time","utc"],e)&&iQ(r,c,q4(n)?n.encoding[jX(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(y1.Main);return a1([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return a1(u?[{data:QH(u)?n.requestDataName(y1.Main):n.requestDataName(y1.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(y1.Main),field:n.vgField(r)}])}function p4(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":WK},r?{field:oG(r)}:{}),i?{order:i}:{})}function m4(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=XJ(i)&&i,s=eY(a)&&tY(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function g4(e,t){const{aggregate:n,type:r}=e;return n?zc(n)&&!FG[n]?{valid:!1,reason:OY(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:SY(e)}:{valid:!0}:{valid:!1,reason:kY(e)}}function y4(e,t,n,r){return e.explicit&&t.explicit&&TY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${NH(n)} and ${NH(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function v4(e){const t=UH(e.map((e=>{if(eJ(e)){return u4(e,["sort"])}return e})),RH),n=UH(e.map((e=>{if(eJ(e)){const t=e.sort;return void 0===t||QH(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),RH);if(0===t.length)return;if(1===t.length){const t=e[0];if(eJ(t)&&n.length>0){let e=n[0];if(n.length>1)TY(AY),e=!0;else if(Uu(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=UH(n.map((e=>QH(e)||!("op"in e)||zc(e.op)&&e.op in $G?e:(TY(function(e){return`Dropping sort property ${NH(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),RH);let i;1===r.length?i=r[0]:r.length>1&&(TY(AY),i=!0);const a=UH(e.map((e=>eJ(e)?e.data:null)),(e=>e));if(1===a.length&&null!==a[0]){return Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{})}return Object.assign({fields:t},i?{sort:i}:{})}function b4(e){if(eJ(e)&&zc(e.field))return e.field;if(function(e){return!qu(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(eJ(n)&&zc(n.field))if(t){if(t!==n.field)return TY("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return TY("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!qu(e)&&"fields"in e&&"data"in e}(e)){TY("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return zc(t)?t:void 0}}function x4(e,t){return v4(e.component.scales[t].get("domains").map((t=>(eJ(t)&&(t.data=e.lookupDataSource(t.data)),t))))}var w4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function _4(e){return W4(e)||V4(e)?e.children.reduce(((e,t)=>e.concat(_4(t))),k4(e)):k4(e)}function k4(e){return YH(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=i,f=w4(i,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,t,n,r){if(zX(n)){if(ZY(e))return{step:{signal:t+"_step"}}}else if(Uu(e)&&eJ(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let h;s&&(h=function(e,t){const n=t.selection;return{signal:u3(e.getSelectionComponent(n,ZH(n)),t)}}(e,s));const p=x4(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),void 0!==c?{reverse:c}:{}),f)),t}),[])}class O4 extends r1{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||BH(this.get("domains"),(e=>qu(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const S4=["range","scheme"];function $4(e){return"x"===e?"width":"y"===e?"height":void 0}function E4(e,t){const n=e.fieldDef(t);if(n&&n.bin&&QX(n.bin)){const r=w5(e,n.field,n.bin),i=$4(t),a=e.getName(i);return new l4((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function A4(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of S4)if(void 0!==n[r]){const a=KJ(i,r),o=QJ(e,r);if(a)if(o)TY(o);else switch(r){case"range":{const r=n.range;if(qu(r)){if(zX(e))return i1(r.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return l4.fromName(r,n)}return e})))}else if(Uu(r))return i1({data:t.requestDataName(y1.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return i1(r)}case"scheme":return i1(D4(n[r]))}else TY($Y(i,r,e))}if(e===zG||e===BG){const t=e===zG?"width":"height",n=r[t];if(a0(n)){if(VJ(i))return i1({step:n.step});TY(EY(t))}}const{rangeMin:a,rangeMax:o}=n,s=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=jQ(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case zG:case BG:{if(zH(["point","band"],l))if(e!==zG||n.width){if(e===BG&&!n.height){const e=f0(r.view,"height");if(a0(e))return e}}else{const e=f0(r.view,"width");if(a0(e))return e}const i=$4(e),a=t.getName(i);return e===BG&&WJ(l)?[l4.fromName(o,a),0]:[0,l4.fromName(o,a)]}case eX:{const a=C4(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:E4(n,"x"),y:E4(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=j4(t,i,r.view);return Rc(e)?e-1:new l4((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=j4(t,i,r.view);return Rc(e)?Math.pow(M4*e,2):new l4((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(xY("size",e))}(i,n,t,r);return GJ(l)?function(e,t,n){const r=()=>{const r=KQ(t),i=KQ(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return QY(t)?new l4(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&qu(n)?n.length+1:(TY(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(l,r,u,e)):[a,o]}case VG:return[0,2*Math.PI];case tX:return[0,360];case qG:return[0,new l4((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case aX:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case oX:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case ZG:return"symbol";case JG:case KG:case QG:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case nX:case rX:case iX:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t);return(void 0!==a||void 0!==o)&&KJ(i,"rangeMin")&&qu(s)&&2===s.length?i1([null!=a?a:s[0],null!=o?o:s[1]]):a1(s)}function D4(e){return function(e){return!zc(e)&&!!e.name}(e)?Object.assign({scheme:e.name},TH(e,["name"])):{scheme:e}}function C4(e,t,n){if(t)return QY(t)?{signal:`${t.signal} ? 0 : ${C4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(xY("size",e))}const M4=.95;function j4(e,t,n){const r=a0(e.width)?e.width.step:c0(n,"width"),i=a0(e.height)?e.height.step:c0(n,"height");return t.x||t.y?new l4((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function F4(e,t){q4(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of YH(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=jQ(i[s]),d=l[t],h=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=KJ(h,t),y=QJ(s,t);if(void 0!==d&&(g?y&&TY(y):TY($Y(h,t,s))),g&&void 0===y)if(void 0!==d){const e=f.timeUnit,n=f.type;switch(t){case"domainMax":case"domainMin":NY(l[t])||"temporal"===n||e?u.set(t,{signal:BQ(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in T4?T4[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):R4(e,t)}const T4={bins:({model:e,fieldOrDatumDef:t})=>lQ(t)?function(e,t){const n=t.bin;if(QX(n)){const r=w5(e,t.field,n);return new l4((()=>e.getSignalName(r)))}if(ZX(n)&&eY(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(zH([JG,KG,QG],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if((null===(r=MQ(n))||void 0===r?void 0:r.bin)||zH([EJ,AJ],e))return;return t in RX||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in RX){if(HJ(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!lQ(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===jJ)return n.pointPadding}return}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0!==e)return;if(t in RX){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return cG(e,"bar"===n?t:i)}return}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0!==e)return;if(t in RX&&n===FJ){const{bandPaddingOuter:e}=a;return cG(e,QY(i)?{signal:`${i.signal}/2`}:i/2)}return}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){if("x"===n&&void 0!==r.xReverse)return WJ(e)&&"descending"===t?QY(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(WJ(e)&&"descending"===t)return!0;return}(t,lQ(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&WJ(i)){if(qu(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!GJ(i))return!0;if((!lQ(t)||!t.bin)&&zH([...PX,...IX],e)){const{orient:t,type:n}=r;return!zH(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function N4(e){q4(e)?function(e){const t=e.component.scales;for(const n of WX){const r=t[n];if(!r)continue;const i=A4(n,e);r.setWithExplicit("range",i)}}(e):R4(e,"range")}function R4(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?N4(n):F4(n,t);for(const r of YH(n)){let i;for(const n of e.children){const e=n.component.scales[r];if(e){i=l1(i,e.getWithExplicit(t),t,"scale",o1(((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}}n[r].setWithExplicit(t,i)}}function P4(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(xX(e)||"discrete"===JX(e))return"shape"===e&&"ordinal"===t.type&&TY(_Y(e,"ordinal")),"ordinal";if(e in RX){if(zH(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in BX)return"band";return void 0!==t.band||yQ(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return xX(e)?"time":"discrete"===JX(e)?(TY(_Y(e,"temporal")),"ordinal"):lQ(t)&&t.timeUnit&&KY(t.timeUnit).utc?"utc":"time";case"quantitative":return xX(e)?lQ(t)&&QX(t.bin)?"bin-ordinal":"linear":"discrete"===JX(e)?(TY(_Y(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(yY(t.type))}(t,n,r),{type:a}=e;return HX(t)?void 0!==a?function(e,t){if(!HX(e))return!1;switch(e){case zG:case BG:case VG:case qG:return HJ(t)||zH(["band","point"],t);case eX:case aX:case nX:case rX:case iX:case tX:return HJ(t)||GJ(t)||zH(["band","point","ordinal"],t);case JG:case KG:case QG:return"band"!==t;case oX:return"ordinal"===t||GJ(t);case ZG:return"ordinal"===t}}(t,a)?lQ(n)&&(o=a,s=n.type,!(zH([yJ,bJ],s)?void 0===o||VJ(o):s===vJ?zH([EJ,AJ,void 0],o):s!==gJ||zH([kJ,OJ,SJ,$J,DJ,CJ,MJ,_J,void 0],o)))?(TY(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:(TY(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null;var o,s}function z4(e){q4(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return WX.reduce(((r,i)=>{const a=jQ(t[i]);if(a&&n===mK&&i===ZG&&a.type===xJ)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=P4(o,i,a,n);r[i]=new O4(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){z4(n);for(const a of YH(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:G3(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?NJ(e.value,t.value)?r[a]=l1(e,t,"type","scale",B4):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of YH(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new O4(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const B4=o1(((e,t)=>PJ(e)-PJ(t)));var I4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class L4{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function q4(e){return"unit"===(null==e?void 0:e.type)}function U4(e){return"facet"===(null==e?void 0:e.type)}function V4(e){return"concat"===(null==e?void 0:e.type)}function W4(e){return"layer"===(null==e?void 0:e.type)}class H4{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=eK(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=VQ(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new L4,this.projectionNameMap=n?n.projectionNameMap:new L4,this.signalNameMap=n?n.signalNameMap:new L4,this.data=e.data,this.description=e.description,this.transforms=function(e){return e.map((e=>v1(e)?{filter:CH(e.filter,mJ)}:e))}(null!==(l=e.transform)&&void 0!==l?l:[]),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(ZK(e)&&!KK(e.facet)||n0(e))&&(o.columns=l),r0(e)&&(o.columns=1);for(const t of s0)if(void 0!==e[t])if("spacing"===t){const n=e[t];o[t]=Rc(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else o[t]=e[t];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:ZK(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new r1,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?jH(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=YH(e),n={text:GQ(e.text)};for(const r of t)n[r]=GQ(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){z4(e),c4(e);for(const t of JJ)F4(e,t);t||N4(e)}(this)}parseProjection(){v5(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){s5(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=I4(e,["style"]),n={};for(const e of YH(t)){const r=t[e];void 0!==r&&(n[e]=YQ(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=YQ(this.description)),"unit"!==this.type&&"layer"!==this.type)?XH(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=I4(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of _X){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=A3(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=$3(r,a),s=B3(e,o);void 0!==s&&(n[o]=s)}}return XH(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of _X)e[n].title&&t.push(M3(this,n));for(const e of D3)t=t.concat(T3(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>h3(e,"grid",t))),...r.map((e=>h3(e,"grid",t))),...n.map((e=>h3(e,"main",t))),...r.map((e=>h3(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return h5(this)}assembleProjections(){return p5(this)}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=I4(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},UQ(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return zH(["unit","layer"],this.type)?zH(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",XH(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||U4(this.parent)?_4(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return ZH((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(y1[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(U4(this.parent)){const t=LX(W3(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(VJ(e)&&ZY(r)){const e=n.get("name"),r=b4(x4(this,t));if(r){return{signal:V3(e,n,wQ({aggregate:"distinct",field:r},{expr:"datum"}))}}return TY(lY(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):EX(e)&&HX(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return`Cannot find a selection named "${e}".`}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class G4 extends H4{vgField(e,t={}){const n=this.fieldDef(e);if(n)return wQ(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?YH(e).reduce(((n,i)=>{const a=e[i];return qu(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}(this.getMapping(),((t,n,r)=>{const i=MQ(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){mZ(this.getMapping(),((t,n)=>{const r=MQ(t);r&&e(r,n)}),t)}}var X4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Y4 extends d2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=jH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new Y4(null,jH(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${RH(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=X4(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class J4 extends d2{constructor(e,t){super(e),this.filter=t}clone(){return new J4(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==ZQ("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=HX(i)&&t.getScaleComponent(i);if(a){WJ(a.get("type"))&&"count"!==n.aggregate&&!gK(r)&&(e[n.field]=n)}return e}),{});return YH(a).length?new J4(e,a):null}dependentFields(){return new Set(YH(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${RH(this.filter)}`}assemble(){const e=YH(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=wQ(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class K4 extends d2{constructor(e,t){super(e),this.transform=t,this.transform=jH(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new K4(this.parent,jH(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${RH(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class Q4 extends d2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=jH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new Q4(null,jH(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${RH(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class Z4 extends d2{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new Z4(null,jH(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[GG,HG],[YG,XG]]){const i=r.map((e=>{const n=jQ(t.encoding[e]);return lQ(n)?n.field:cQ(n)?{expr:`${n.datum}`}:mQ(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new Z4(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(ZG)){const r=t.typedFieldDef(ZG);r.type===xJ&&(e=new Z4(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(zc);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${RH(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class e6 extends d2{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new e6(null,this.projection,jH(this.fields),jH(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[GG,HG],[YG,XG]]){const r=n.map((e=>{const n=jQ(t.encoding[e]);return lQ(n)?n.field:cQ(n)?{expr:`${n.datum}`}:mQ(n)?{expr:`${n.value}`}:void 0})),i=n[0]===YG?"2":"";(r[0]||r[1])&&(e=new e6(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(zc))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${RH(this.fields)} ${RH(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class t6 extends d2{constructor(e,t){super(e),this.transform=t}clone(){return new t6(null,jH(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new t6(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(lQ(r)&&lQ(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=gZ(t.mark,n);return new t6(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${RH(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:b1(n)?this.processSequence(n):n}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});if(r&&"value"!==r){return[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[s]}}var n6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class r6 extends d2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=jH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new r6(null,jH(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${RH(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=n6(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class i6 extends d2{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new i6(null,jH(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=_6(a.data,i);e||(e=new T5(a.data),i.push(e));const n=t.getName(`lookup_${r}`);o=new h2(e,n,y1.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(ZH(e),e).materialized,!o)throw new Error(function(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}(e))}return new i6(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?hc(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${RH({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:hc(this.transform.as)}:{});else{let t=this.transform.as;zc(t)||(TY('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}var a6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class o6 extends d2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=jH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new o6(null,jH(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${RH(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=a6(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}var s6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class l6 extends d2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=jH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new l6(null,jH(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${RH(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=s6(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class u6 extends d2{constructor(e,t){super(e),this.transform=t}clone(){return new u6(null,jH(this.transform))}addDimensions(e){var t;this.transform.groupby=UH((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${RH(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class c6 extends d2{constructor(e,t){super(e),this.transform=t}clone(){return new c6(null,jH(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${RH(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function f6(e){let t=0;return function n(r,i){var a;if(r instanceof T5&&!r.isGenerator&&!c1(r.data)){e.push(i);i={name:null,source:i.name,transform:[]}}if(r instanceof C5&&(r.parent instanceof T5&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof $5){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else{if((r instanceof j5||r instanceof F5||r instanceof J4||r instanceof o3||r instanceof O3||r instanceof e6||r instanceof Z4||r instanceof S5||r instanceof i6||r instanceof t4||r instanceof Z5||r instanceof Q4||r instanceof K4||r instanceof Y4||r instanceof r6||r instanceof o6||r instanceof l6||r instanceof M5||r instanceof c6||r instanceof u6)&&i.transform.push(r.assemble()),(r instanceof k5||r instanceof m2||r instanceof t6||r instanceof e4)&&i.transform.push(...r.assemble()),r instanceof h2)if(i.source&&0===i.transform.length)r.setSource(i.source);else if(r.parent instanceof h2)r.setSource(i.name);else if(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()){e.push(i);i={name:null,source:i.name,transform:[]}}switch(r.numChildren()){case 0:r instanceof h2&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children){n(e,{name:null,source:a,transform:[]})}break}}}}}function d6(e){return"top"===e||"left"===e||QY(e)?"header":"footer"}function h6(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=E3("title",null,i,t);let u=EQ(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=qu(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=E3("labelOrient",s,i,t),f=cG((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=zH(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[d]:"facet"===t?[]:[p6(e,t,f)]}}}function p6(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function m6(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=X3(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=i[a];for(const i of r.component.axes[t]){const t=d6(i.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[p6(e,a,!1)];const r=h3(i,"main",e.config,{header:!0});r&&o[t][0].axes.push(r),i.mainExtracted=!0}}}}function g6(e){for(const t of e.children)t.parseLayoutSize()}function y6(e,t){const n=W3(t),r=LX(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){o=void 0;break}if(o){if("independent"===a&&o.value!==e.value){o=void 0;break}o=l1(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function v6(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(VJ(e)){const e=f0(r.view,t);return ZY(n)||a0(e)?"step":e}return u0(r.view,t)}if(e.hasProjection||"arc"===e.mark)return u0(r.view,t);{const e=f0(r.view,t);return a0(e)?e.step:e}}var b6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function x6(e,t,n){return wQ(t,Object.assign({suffix:`by_${wQ(e)}`},null!=n?n:{}))}class w6 extends G4{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=V6(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!KK(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=YH(e),n={};for(const r of t){if(!zH([NG,RG],r)){TY(xY(r,"facet"));break}const t=e[r];if(void 0===t.field){TY(bY(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=NQ(b6(e,["header"]),t);return n&&(r.header=eK(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=k6(this),this.child.parseData()}parseLayoutSize(){g6(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of _X)h6(e,t);m6(e,"x"),m6(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of _X)for(const a of C3){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=E3("titleOrient",l.header,this.config,i);if(zH(["right","bottom"],t)){const n=$3(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof w6)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof w6?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:wQ(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof w6){if(this.child.channelHasField("column")){const r=wQ(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of PX){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(VJ(a)&&ZY(o)){const i=b4(x4(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):TY(lY(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const e of _X){const t=this.facet[e];if(t){s.push(wQ(t));const{bin:l,sort:u}=t;if(QX(l)&&s.push(wQ(t,{binSuffix:"end"})),YK(u)){const{field:e,op:s=WK}=u,l=x6(t,u);n&&r?(i.push(l),a.push("max"),o.push(l)):(i.push(e),a.push(s),o.push(l))}else if(qu(u)){const n=S3(t,e);i.push(n),a.push("max"),o.push(n)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?YK(n.sort)?[x6(n,n.sort,{expr:"datum"})]:qu(n.sort)?[S3(n,e,{expr:"datum"})]:[wQ(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(YK(e)?e.order:!qu(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return R3(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of D3)if(t[i]){const a=E3("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(zH(r[i],a))return R3(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=f6(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:_X.map((e=>this.facetSortFields(e))).flat(),order:_X.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&YH(e.component.selection).length){const n=Hc(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:Eq("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return I2(t)}(this,[])))]}getMapping(){return this.facet}}function _6(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(f1(e)&&f1(t)){if(MH(e.values,t.values))return o}else if(c1(e)&&c1(t)){if(e.url===t.url)return o}else if(d1(e)&&e.name===o.dataName)return o}return null}function k6(e){var t,n,r,i,a,o,s,l,u,c;let f=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new T5({values:[]});return t.push(e),e}const n=_6(e.data,t);if(n)return h1(e.data)||(n.data.format=LH({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new T5(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new u1,m=e.data;h1(m)?(p1(m)?f=new F5(f,m.sequence):g1(m)&&(f=new j5(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=C5.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new M5(f);const g=e.parent&&W4(e.parent);(q4(e)||U4(e))&&g&&(f=null!==(r=k5.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l;if(C1(o))l=e=new O3(e,o),s="derived";else if(v1(o)){const i=A5(o);l=e=null!==(r=C5.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new o3(e,t,o.filter)}else if(M1(o))l=e=k5.makeFromTransform(e,o,t),s="number";else if(F1(o))s="date",void 0===n.getWithExplicit(o.field).value&&(e=new C5(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=m2.makeFromTransform(e,o);else if(T1(o))l=e=S5.makeFromTransform(e,o),s="number",n3(t)&&(e=new M5(e));else if(x1(o))l=e=i6.make(e,t,o,a++),s="derived";else if(E1(o))l=e=new t4(e,o),s="number";else if(A1(o))l=e=new Z5(e,o),s="number";else if(N1(o))l=e=e4.makeFromTransform(e,o),s="derived";else if(R1(o))l=e=new Q4(e,o),s="derived";else if(D1(o))l=e=new K4(e,o),s="derived";else if(w1(o))l=e=new u6(e,o),s="derived";else if($1(o))e=new c6(e,o);else if(j1(o))l=e=t6.makeFromTransform(e,o),s="derived";else if(_1(o))l=e=new Y4(e,o),s="derived";else if(k1(o))l=e=new o6(e,o),s="derived";else if(O1(o))l=e=new l6(e,o),s="derived";else{if(!S1(o)){TY(mY(o));continue}l=e=new r6(e,o),s="derived"}if(l&&void 0!==s)for(const e of null!==(i=l.producedFields())&&void 0!==i?i:[])n.set(e,s,!1)}return e}(f,e,p));const y=function(e){const t={};if(q4(e)&&e.component.selection)for(const n of YH(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&uG(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=D5(e);f=null!==(i=C5.makeWithAncestors(f,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:f,q4(e)&&(f=Z4.parseAll(f,e),f=e6.parseAll(f,e)),(q4(e)||U4(e))&&(g||(f=null!==(a=k5.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=m2.makeFromEncoding(f,e))&&void 0!==o?o:f,f=O3.parseAllForSortIndex(f,e));const b=e.getDataName(y1.Raw),x=new h2(f,b,y1.Raw,h);if(d[b]=x,f=x,q4(e)){const t=S5.makeFromEncoding(f,e);t&&(f=t,n3(e)&&(f=new M5(f))),f=null!==(s=t6.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(l=e4.makeFromEncoding(f,e))&&void 0!==l?l:f}q4(e)&&(f=null!==(u=J4.make(f,e))&&void 0!==u?u:f);const w=e.getDataName(y1.Main),_=new h2(f,w,y1.Main,h);d[w]=_,f=_,q4(e)&&function(e,t){e3(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new h2(new o3(t,e,{selection:r}),i,y1.Lookup,e.component.data.outputNodeRefCounts)}))}(e,_);let k=null;if(U4(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(YK(i.sort)){const{field:n,op:r=WK}=i.sort;e=t=new Z5(e,{joinaggregate:[{op:r,field:n,as:x6(i,i.sort,{forAs:!0})}],groupby:[wQ(i)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,k=new $5(f,e,t,_.getSource()),d[t]=k}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:x,main:_,facetRoot:k,ancestorParse:p})}class O6 extends H4{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||TY("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>V6(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=k6(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of YH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return r0(e)?e.vconcat:i0(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){g6(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";y6(e,t),y6(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=L3(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const S6=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},wG),{labelExpr:1,encode:1}),$6=YH(S6);class E6 extends r1{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new E6(jH(this.explicit),jH(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return QY(this.explicit.orient)}}const A6={bottom:"top",top:"bottom",left:"right",right:"left"};function D6(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=C6(n,i)}}}return e}function C6(e,t){for(const n of $6){const r=l1(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return oZ(e,t);case"gridScale":return{explicit:e.explicit,value:cG(e.value,t.value)}}return s1(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function M6(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(QY(n.labelAngle)?n.labelAngle:mG(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===k3(r,i))return!0}return e===n[t]}const j6=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function F6(e,t){var n,r,i;let a=t.axis(e);const o=new E6,s=jQ(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=g3(e,f,c,t.config),h=void 0!==a?!a:v3("disable",u.style,null==a?void 0:a.style,d).configValue;if(o.set("disable",h,void 0!==a),h)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return QY(a)?a:mG(a);{const{configValue:a}=v3("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?mG(a):n!==zG||!zH([bJ,yJ],e.type)||lQ(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,d),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const n of $6){const r=n in b3?b3[n](m):kG(n)?a[n]:void 0,i=void 0!==r,s=M6(r,n,a,t,e);if(i&&s)o.set(n,r,s);else{const{configValue:e,configFrom:t}=kG(n)&&"values"!==n?v3(n,u.style,a.style,d):{},l=void 0!==e;i&&!l?o.set(n,r,s):("vgAxisConfig"!==t||j6.has(n)&&l||vG(e)||QY(e))&&o.set(n,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},y=bG.reduce(((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=H3(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=jQ(i[t]))&&void 0!==r?r:jQ(i[jX(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return TK(u)?Object.assign({text:zK({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||XH(s)||(n[r]={update:s}),n}),{});return XH(y)||o.set("encode",y,!!a.encoding||void 0!==a.labelAngle),o}function T6(e,t,n){const r=eK(e),i=ZQ("orient",r,n);if(r.orient=function(e,t,n){switch(e){case sK:case hK:case pK:case cK:case lK:case aK:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case iK:if(lQ(r)&&(ZX(r.bin)||lQ(i)&&i.aggregate&&!r.aggregate))return"vertical";if(lQ(i)&&(ZX(i.bin)||lQ(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(lQ(r)&&r.type===gJ&&!QX(r.bin)||dQ(r)))return"horizontal";if(!o&&(lQ(i)&&i.type===gJ&&!QX(i.bin)||dQ(i)))return"vertical"}case uK:if(a&&(!lQ(r)||!ZX(r.bin))&&o&&(!lQ(i)||!ZX(i.bin)))return;case rK:if(o)return lQ(i)&&ZX(i.bin)?"horizontal":"vertical";if(a)return lQ(r)&&ZX(r.bin)?"vertical":"horizontal";if(e===uK){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case oK:case fK:{const t=fQ(r),a=fQ(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===vJ,s=a.type===vJ;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&TY(`Specified orient "${r.orient}" overridden with "${i}".`),"bar"===r.type&&r.orient){const e=ZQ("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:kK[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===ZQ("opacity",r,n)&&(r.opacity=function(e,t){if(zH([sK,fK,hK,pK],e)&&!fZ(t))return.7;return}(r.type,t));return void 0===ZQ("cursor",r,n)&&(r.cursor=function(e,t,n){if(t.href||e.href||ZQ("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function N6(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"mid"})),G1("y",e,{defaultPos:"mid"})),V1("size",e)),V1("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return V1("shape",e)}(e,0,t))}function R6(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=ZQ("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;if(e&&ZY(e)&&Rc(e.step))return 3*e.step/4;return 3*c0(n.view,a)/4}}const P6={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"mid"})),G1("y",e,{defaultPos:"mid"})),t2(e,"radius","arc")),t2(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Q1("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),Q1("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),l2(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),t2(e,"x","bar")),t2(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>N6(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&lQ(n)&&n.type===xJ?{field:wQ(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),t2(e,"x","image")),t2(e,"y","image")),z1(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"mid"})),G1("y",e,{defaultPos:"mid"})),V1("size",e,{vgChannel:"strokeWidth"})),l2(e))},point:{vgMark:"symbol",encodeEntry:e=>N6(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),t2(e,"x","rect")),t2(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Q1("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),Q1("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),V1("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>N6(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),G1("x",e,{defaultPos:"mid"})),G1("y",e,{defaultPos:"mid"})),z1(e)),V1("size",e,{vgChannel:"fontSize"})),V1("angle",e)),u2("align",function(e,t,n){if(void 0===ZQ("align",e,n))return"center";return}(e.markDef,0,t))),u2("baseline",function(e,t,n){if(void 0===ZQ("baseline",e,n))return"middle";return}(e.markDef,0,t))),G1("radius",e,{defaultPos:null,isMidPoint:!0})),G1("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"mid",vgChannel:"xc"})),G1("y",e,{defaultPos:"mid",vgChannel:"yc"})),V1("size",e,{defaultValue:R6(e),vgChannel:i})),{[a]:YQ(ZQ("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o2(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"mid"})),G1("y",e,{defaultPos:"mid"})),V1("size",e)),l2(e))}};function z6(e){if(zH([oK,rK,dK],e.mark)){const t=gZ(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:B6+e.requestDataName(y1.Main),data:e.requestDataName(y1.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:L6(e,{fromPrefix:B6})}]}(e,t)}else if(zH([iK],e.mark)){const t=rJ.some((t=>ZQ(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=L6(e,{fromPrefix:I6}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},FH(t.encode.update,["y","yc","y2","height",...rJ])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},TH(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},FH(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},TH(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of rJ){const r=eZ(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=YQ(r)),r&&(t.encode.update[n]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=wQ(s)?[wQ(s)]:[];((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(wQ(s,{binSuffix:"end"}));a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=eZ(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:YQ(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(y1.Main),name:I6+e.requestDataName(y1.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return L6(e)}const B6="faceted_path_";const I6="stack_group_";function L6(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=cG(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=QQ(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!qu(o)&&mQ(o)&&PH(o.value)||!o&&PH(ZQ("order",i,a)))){if((qu(o)||lQ(o))&&!n)return rZ(o,{expr:"datum"});if(gK(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(lQ(r)){const t=r.sort;return qu(t)?{field:wQ(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:YK(t)?{field:wQ({aggregate:fZ(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:XK(t)?{field:wQ(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:wQ(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=YH(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=YH(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),f=ZQ("aria",r,a),d=P6[n].postEncodingTransform?P6[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:P6[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===f?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(y1.Main)},encode:{update:P6[n].encodeEntry(e)}}),d?{transform:d}:{})]}class q6 extends G4{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,o0(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=bK(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=eZ("filled",e,t),i=e.type;return cG(r,i!==sK&&i!==oK&&i!==uK)}(a,i,{graticule:e.data&&g1(e.data)}));const s=this.encoding=hZ(e.encoding||{},o,a.filled,i);this.markDef=T6(a,s,i),this.size=function({encoding:e,size:t}){for(const n of PX){const r=FX(n);a0(t[r])&&fQ(e[n])&&(delete t[r],TY(EY(r)))}return t}({encoding:s,size:o0(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=M0(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===mK,n=e&&vX.some((t=>hQ(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return WX.reduce(((e,n)=>{var r;const i=jQ(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e}),{})}initScale(e){const{domain:t,range:n}=e,r=eK(e);return qu(t)&&(r.domain=t.map(GQ)),qu(n)&&(r.range=n.map(GQ)),r}initAxes(e){return PX.reduce(((t,n)=>{const r=e[n];if(hQ(r)||n===zG&&hQ(e.x2)||n===BG&&hQ(e.y2)){const e=hQ(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t}),{})}initAxis(e){const t=YH(e),n={};for(const r of t){const t=e[r];n[r]=vG(t)?HQ(t):GQ(t)}return n}initLegends(e){return UX.reduce(((t,n)=>{const r=jQ(e[n]);if(r&&function(e){switch(e){case JG:case KG:case QG:case eX:case ZG:case nX:case aX:case oX:return!0;case rX:case iX:case tX:return!1}}(n)){const e=r.legend;t[n]=e?eK(e):e}return t}),{})}parseData(){this.component.data=k6(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of PX){const i=FX(r);if(t[i]){const e=t[i];n.layoutSize.set(i,a0(e)?"step":e,!0)}else{const t=v6(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of YH(null!=t?t:{})){const o=jH(t[a]),s=i[o.type],l=s3(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const u=ZH(a),c=r[u]=Object.assign(Object.assign({},o),{name:u,events:zc(o.on)?Eq(o.on,"scope"):jH(o.on)});R2(c,(n=>{n.has(c)&&n.parse&&n.parse(e,c,o,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=z6(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,PX.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[F6(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;e3(e,((r,i)=>{const a=r.name,o=Hc(a+Y2);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${Q2}(${o}, ${Hc(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),R2(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n&&0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return I2(t)}(this,e)}assembleSignals(){return[...p3(this),...(e=this,t=[],e3(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),R2(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+K2,on:[{events:{signal:n.name+J2},update:`modify(${Hc(n.name+Y2)}, ${a})`}]})})),I2(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return e3(e,(t=>{const r={name:t.name+Y2};if(t.init){const n=t.project.items.map((e=>P2(e,["signals"]))),i=t.init.map((e=>z2(e,!1)));r.values="interval"===t.type?[{unit:t3(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:t3(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+Y2)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return L3(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&W4(this.parent)||(t=B2(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return cZ(this.encoding,e)}fieldDef(e){return MQ(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return pQ(t)?t:null}}class U6 extends H4{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(S0(e))return new U6(e,this,this.getName("layer_"+t),a,i);if(sZ(e))return new q6(e,this,this.getName("layer_"+t),a,i);throw new Error(rY(e))}))}parseData(){this.component.data=k6(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;g6(e=this),y6(e,"width"),y6(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of YH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of YH(t.component.axes))r.axis[i]=X3(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=D6(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of PX){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!QY(t)){if(i[t]>0&&!n){const n=A6[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),p3(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),L3(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)q4(n)&&(t=B2(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),h5(this))}}function V6(e,t,n,r,i){if(ZK(e))return new w6(e,t,n,i);if(S0(e))return new U6(e,t,n,r,i);if(sZ(e))return new q6(e,t,n,r,i);if(function(e){return r0(e)||i0(e)||n0(e)}(e))return new O6(e,t,n,i);throw new Error(rY(e))}var W6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};var H6=Object.freeze({__proto__:null,normalize:Q0,version:"4.17.0",compile:function(e,t={}){var n;t.logger&&(n=t.logger,FY=n),t.fieldTitle&&$Q(t.fieldTitle);try{const n=b0(Wu(t.config,e.config)),r=Q0(e,n),i=V6(r,null,"",void 0,n);i.parse(),function(e,t){a4(e.sources);let n=0,r=0;for(let r=0;r<5&&s4(e,t,!0);r++)n++;e.sources.map(n4);for(let n=0;n<5&&s4(e,t,!1);n++)r++;a4(e.sources),5===Math.max(n,r)&&TY("Maximum optimization runs(5) reached.")}(i.component.data,i);return{spec:function(e,t,n={},r){const i=e.config?k0(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=f6(i);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+o++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let s=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(s++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)));const{params:f}=t,d=W6(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...KZ(f)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):zc(t)&&(t={type:t});if(i&&a&&(o=t.type,"fit"===o||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)TY(sY()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";TY(sY(LX(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${LX(e)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===YH(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),n1(n,!1)),n1(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(FY=jY),t.fieldTitle&&$Q(OQ)}},deepEqual:MH,duplicate:jH,pick:FH,omit:TH,stringify:NH,hash:RH,isNullOrFalse:PH,contains:zH,some:BH,every:IH,mergeDeep:LH,unique:UH,isEqual:function(e,t){const n=YH(e),r=YH(t);if(n.length!==r.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},setEqual:VH,hasIntersection:WH,prefixGenerator:HH,fieldIntersection:GH,isEmpty:XH,keys:YH,vals:JH,entries:KH,isBoolean:QH,varName:ZH,logicalExpr:eG,deleteNestedProperty:tG,titleCase:nG,accessPathWithDatum:rG,flatAccessWithDatum:iG,replacePathInField:oG,replaceAll:sG,removePathFromField:lG,accessPathDepth:uG,getFirstDefined:cG,uniqueId:dG,resetIdCounter:function(){fG=42},internalField:hG,isInternalField:pG,normalizeAngle:mG,isNumeric:gG});function G6(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}const X6="#fff",Y6={background:"#333",title:{color:X6},style:{"guide-label":{fill:X6},"guide-title":{fill:X6}},axis:{domainColor:X6,gridColor:"#888",tickColor:X6}},J6="#4572a7",K6={background:"#fff",arc:{fill:J6},area:{fill:J6},line:{stroke:J6,strokeWidth:2},path:{stroke:J6},rect:{fill:J6},shape:{stroke:J6},symbol:{fill:J6,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},Q6="#30a2da",Z6="#cbcbcb",e7="#f0f0f0",t7="#333",n7={arc:{fill:Q6},area:{fill:Q6},axis:{domainColor:Z6,grid:!0,gridColor:Z6,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:Z6,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:e7,group:{fill:e7},legend:{labelColor:t7,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:t7,titleFontSize:14,titlePadding:10},line:{stroke:Q6,strokeWidth:2},path:{stroke:Q6,strokeWidth:.5},rect:{fill:Q6},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:Q6},bar:{binSpacing:2,fill:Q6,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},r7="#000",i7={group:{fill:"#e5e5e5"},arc:{fill:r7},area:{fill:r7},line:{stroke:r7},path:{stroke:r7},rect:{fill:r7},shape:{stroke:r7},symbol:{fill:r7,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},a7="Benton Gothic, sans-serif",o7="#82c6df",s7="Benton Gothic Bold, sans-serif",l7="normal",u7={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},c7={background:"#ffffff",title:{anchor:"start",color:"#000000",font:s7,fontSize:22,fontWeight:"normal"},arc:{fill:o7},area:{fill:o7},line:{stroke:o7,strokeWidth:2},path:{stroke:o7},rect:{fill:o7},shape:{stroke:o7},symbol:{fill:o7,size:30},axis:{labelFont:a7,labelFontSize:11.5,labelFontWeight:"normal",titleFont:s7,titleFontSize:13,titleFontWeight:l7},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:a7,labelFontSize:11.5,symbolType:"square",titleFont:s7,titleFontSize:13,titleFontWeight:l7},range:{category:u7["category-6"],diverging:u7["fireandice-6"],heatmap:u7["fire-7"],ordinal:u7["fire-7"],ramp:u7["fire-7"]}},f7="#ab5787",d7="#979797",h7={background:"#f9f9f9",arc:{fill:f7},area:{fill:f7},line:{stroke:f7},path:{stroke:f7},rect:{fill:f7},shape:{stroke:f7},symbol:{fill:f7,size:30},axis:{domainColor:d7,domainWidth:.5,gridWidth:.2,labelColor:d7,tickColor:d7,tickWidth:.2,titleColor:d7},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},p7="#3e5c69",m7={background:"#fff",arc:{fill:p7},area:{fill:p7},line:{stroke:p7},path:{stroke:p7},rect:{fill:p7},shape:{stroke:p7},symbol:{fill:p7},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},g7="#1696d2",y7="#000000",v7="Lato",b7="Lato",x7={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},w7={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:v7},axisX:{domain:!0,domainColor:y7,domainWidth:1,grid:!1,labelFontSize:12,labelFont:b7,labelAngle:0,tickColor:y7,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:v7},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:b7,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:v7,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:b7,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:v7,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:x7["six-groups-cat-1"],diverging:x7["diverging-colors"],heatmap:x7["diverging-colors"],ordinal:x7["six-groups-seq"],ramp:x7["shades-blue"]},area:{fill:g7},rect:{fill:g7},line:{color:g7,stroke:g7,strokeWidth:5},trail:{color:g7,stroke:g7,strokeWidth:0,size:1},path:{stroke:g7,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:g7,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:g7,stroke:null}},arc:{fill:g7},shape:{stroke:g7},symbol:{fill:g7,size:30}},_7="#3366CC",k7="#ccc",O7="Arial, sans-serif",S7={arc:{fill:_7},area:{fill:_7},path:{stroke:_7},rect:{fill:_7},shape:{stroke:_7},symbol:{stroke:_7},circle:{fill:_7},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:O7,fontSize:12},"guide-title":{font:O7,fontSize:12},"group-title":{font:O7,fontSize:12}},title:{font:O7,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:k7,tickColor:k7,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},$7="2.9.1";var E7=Object.freeze({__proto__:null,dark:Y6,excel:K6,fivethirtyeight:n7,ggplot2:i7,googlecharts:S7,latimes:c7,quartz:h7,urbaninstitute:w7,version:$7,vox:m7}),A7="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const D7="vg-tooltip-element",C7={offsetX:10,offsetY:10,id:D7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function M7(e,t,n){if(qu(e))return`[${e.map((e=>t(zc(e)?e:j7(e,n)))).join(", ")}]`;if(Uu(e)){let r="";const i=e,{title:a,image:o}=i,s=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(Uu(i)&&(i=j7(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function j7(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class F7{constructor(e){this.options=Object.assign(Object.assign({},C7),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return A7.toString().replace(D7,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=M7(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function T7(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var N7,R7='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function P7(e,...t){for(const n of t)z7(e,n);return e}function z7(e,t){for(const n of Object.keys(t))Hu(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const B7=kH;let I7=H6;const L7="undefined"!=typeof window?window:void 0;void 0===I7&&(null===(N7=null==L7?void 0:L7.vl)||void 0===N7?void 0:N7.compile)&&(I7=L7.vl);const q7={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},U7={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},V7={vega:"Vega","vega-lite":"Vega-Lite"},W7={vega:B7.version,"vega-lite":I7?I7.version:"not available"},H7={vega:e=>e,"vega-lite":(e,t)=>I7.compile(e,{config:t}).spec},G7='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',X7="chart-wrapper";function Y7(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=`${V7[r]} JSON Source`}function J7(e,t,n={}){var r,i,a;return T7(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:B7.loader(n.loader);var s;const l=zc(t)?JSON.parse(yield o.load(t)):t,u=yield K7(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield K7(n,o),f=Object.assign(Object.assign({},P7(c,u)),{config:Wu(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return T7(this,void 0,void 0,(function*(){const c=n.theme?Wu(E7[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=Fc(n.actions)?n.actions:P7({},q7,null!==(a=n.actions)&&void 0!==a?a:{}),d=Object.assign(Object.assign({},U7),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:B7.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?R7.toString():n.defaultStyle,r.appendChild(t)}}const y=function(e,t){var n;if(e.$schema){const r=G6(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${V7[r.library]}, but mode argument sets ${null!==(n=V7[t])&&void 0!==n?n:t}.`);const i=r.library;return Ou.satisfies(W7[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${V7[i]} ${r.version}, but the current version of ${V7[i]} is v${W7[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let v=H7[y](t,c);if("vega-lite"===y&&v.$schema){const e=G6(v.$schema);Ou.satisfies(W7.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${W7.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(f){const e=document.createElement("div");e.classList.add(X7),g.appendChild(e),b=e}const x=n.patch;x&&(v=x instanceof Function?x(v):ss(v,x,!0,!1).newDocument),n.formatLocale&&B7.formatLocale(n.formatLocale),n.timeFormatLocale&&B7.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=B7.parse(v,"vega-lite"===y?{}:c,{ast:w}),k=new B7.View(_,Object.assign({loader:r,logLevel:p,renderer:h},w?{expr:B7.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e=function(e){return"function"==typeof e}(n.tooltip)?n.tooltip:new F7(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(e)}let O,{hover:S}=n;if(void 0===S&&(S="vega"===y),S){const{hoverSet:e,updateSet:t}="boolean"==typeof S?{}:S;k.hover(e,t)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(b,n.bind).runAsync(),!1!==f){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=d.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML=G7,t.append(n),O=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",O)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const e of["svg","png"])if(!0===f||!0===f.export||f.export[e]){const t=d[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${m}.${e}`,i.addEventListener("mousedown",(function(t){return T7(this,void 0,void 0,(function*(){t.preventDefault();const r=yield k.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=d.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;Y7(bs(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),e.preventDefault()})),r.append(e)}if("vega-lite"===y&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=d.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;Y7(bs(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===f||!1!==f.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=d.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:y,renderer:h,spec:bs(t)}),n.preventDefault()})),r.append(i)}}function $(){O&&document.removeEventListener("click",O),k.finalize()}return{view:k,spec:t,vgSpec:v,finalize:$}}))}(e,l,f,o)}))}function K7(e,t){var n;return T7(this,void 0,void 0,(function*(){const r=zc(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=zc(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const Q7={$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:"container",height:500,layer:[{data:{name:"simulated"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]}],layer:[{transform:[{aggregate:[{op:"min",field:"cumNetValue",as:"teamMinNetValue"},{op:"max",field:"cumNetValue",as:"teamMaxNetValue"}],groupby:["rollIndex","turn","activeTeamColor","activeTeamName"]},{joinaggregate:[{op:"min",field:"teamMinNetValue",as:"minNetValue"},{op:"max",field:"teamMaxNetValue",as:"maxNetValue"}]},{calculate:"datum.rollIndex - 0.5",as:"x"},{calculate:"datum.rollIndex + 0.5",as:"x2"}],mark:{type:"rect",opacity:.05},encoding:{x:{field:"x",type:"quantitative"},x2:{field:"x2",type:"quantitative"},y:{field:"minNetValue",type:"quantitative",title:"Net Value"},y2:{field:"maxNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"}]}},{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["activeTeamColor","rollIndex"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"value",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},detail:{field:"prob",type:"nominal"},tooltip:[{field:"activeTeamColor",title:"Active Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}}]},{data:{name:"playHead"},mark:{type:"rule"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}}}},{data:{name:"actual"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]},{calculate:"'#roll-' + datum.rollIndex",as:"url"}],layer:[{mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Active Team",legend:{disable:!0}},detail:{field:"iteration",type:"nominal"}}},{transform:[{flatten:["outcomes","weights"]},{bin:{step:.5,anchor:-.25},field:"outcomes",as:["outcomes_min","outcomes_max"]},{aggregate:[{op:"sum",field:"weights",as:"weight_sum"}],groupby:["rollIndex","activeTeamColor","activeTeamName","outcomes_min","outcomes_max","cumNetValue","netValue","description"]},{calculate:"datum.outcomes_min + datum.cumNetValue - datum.netValue",as:"posNetValue_min"},{calculate:"datum.outcomes_max + datum.cumNetValue - datum.netValue",as:"posNetValue_max"},{calculate:"datum.rollIndex - (datum.weight_sum / 2)",as:"x"},{calculate:"datum.rollIndex + (datum.weight_sum / 2)",as:"x2"},{calculate:"datum.posNetValue_min",as:"y"},{calculate:"datum.posNetValue_max",as:"y2"},{calculate:"join([datum.outcomes_min, datum.outcomes_max], ' - ')",as:"outcomes_range"}],mark:{type:"rect",opacity:.7},encoding:{x:{type:"quantitative",field:"x"},x2:{type:"quantitative",field:"x2"},y:{type:"quantitative",field:"y"},y2:{type:"quantitative",field:"y2"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"description",title:"Roll"},{field:"outcomes_range",title:"Net Value Change"},{field:"weight_sum",title:"Probability",format:".2p"},{field:"activeTeamName",title:"Active Team"}]}},{mark:{type:"point"},selection:{zoom_x:{type:"interval",bind:"scales",encodings:["x"]}},encoding:{x:{type:"quantitative",field:"rollIndex"},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"},{field:"description",title:"Roll"},{field:"valueDescription",title:"Value"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}],href:{field:"url",type:"nominal"}}}]}]};function Z7(t){let n;return{c(){n=k("div"),n.innerHTML='<div id="chart" class="col-sm-12 svelte-1yk3kez"></div>',C(n,"id","results")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}function e8(e,t,n){const r=U();let i,a,{rolls:o}=t,{replayStepIndex:s}=t,{selectedRoll:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return q((()=>(console.log("Results onMount"),function(){const e=o.filter((e=>{const t=e.actual;return isFinite(t.outcomeValue)?!!isFinite(t.expectedValue)||(console.warn("Dice roll with non-finite expected value",{roll:e,dataPoint:t}),!1):(console.warn("Dice roll with non-finite outcome value",{roll:e,dataPoint:t}),!1)})),t=e.map((e=>e.actual));console.log("Valid rolls",e),console.log("Actual points",t),J7("#chart",Q7).then((a=>{a.view.addEventListener("click",(function(e,t){t&&(n(0,l=t.datum.rollIndex),n(1,u=o[l].stepIndex),n(2,c=o[l+1].stepIndex),console.log("Results clicked",{selectedRoll:l,replayStart:u,replayEnd:c}))})),n(5,i=a.view),n(5,i=a.view.insert("actual",t).run()),n(5,i=i.insert("simulated",t).run());var s=0;function f(){for(var t=[],a=0;a<50;a++)s++,t=t.concat(e.map((e=>e.simulated(s))));var o=hg().insert(t);n(5,i=i.change("simulated",o).run()),r("iterationComplete",s),s<1e3&&window.setTimeout(f,200)}f()}))}(),console.log("Results onMount chart rendered"),()=>console.log("destroyed")))),e.$$set=e=>{"rolls"in e&&n(3,o=e.rolls),"replayStepIndex"in e&&n(4,s=e.replayStepIndex),"selectedRoll"in e&&n(0,l=e.selectedRoll),"replayStart"in e&&n(1,u=e.replayStart),"replayEnd"in e&&n(2,c=e.replayEnd)},e.$$.update=()=>{if(120&e.$$.dirty){if(o&&s){let e=o.findIndex((e=>s<e.stepIndex));n(6,a=e>0?o[e-1].rollIndex:0)}if(i&&a){var t=hg().remove((()=>!0)).insert([{rollIndex:a}]);n(5,i=i.change("playHead",t).run())}}},[l,u,c,o,s,i,a]}class t8 extends Ae{constructor(e){super(),Ee(this,e,e8,Z7,s,{rolls:3,replayStepIndex:4,selectedRoll:0,replayStart:1,replayEnd:2})}}function n8(t){let n;return{c(){n=k("p"),n.textContent="Welcome to Diced or Not, the Blood Bowl 2 replay dice analyzer! If you've just\n  had a particularly good or bad game and you want to know if the dice are to\n  blame, this is the site for you. To get started, use the button below to\n  select the replay you want to load. These are .bbrz files that are usually\n  located in My Documents\\BloodBowl2\\Profiles\\(Coach Name or ID)\\Replays. Diced\n  or Not will analyze the replay and extract all the dice rolls, then show them\n  to you along with a bunch of statistics about just how lucky or unlucky you\n  were.",C(n,"id","about")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class r8 extends Ae{constructor(e){super(),Ee(this,e,null,n8,s,{})}}function i8(t){let n;return{c(){n=k("nav"),n.innerHTML='<a class="navbar-brand svelte-gb2y3h" href="/#">Diced or Not</a> \n    <ul class="navbar-nav"><li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#about">About</a></li> \n      <li class="dropdown svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#summary">Replay</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#explanation">Explain?</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#contact">Contact</a></li></ul>',C(n,"class","navbar-dark bg-dark sidenav svelte-gb2y3h")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class a8 extends Ae{constructor(e){super(),Ee(this,e,null,i8,s,{})}}function o8(e){const t=e-1;return t*t*t+1}function s8(e){return-.5*(Math.cos(Math.PI*e)-1)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function l8(e,{delay:n=0,duration:r=400,easing:i=t}){const a=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:i,css:e=>"opacity: "+e*a}}function u8(e){var{fallback:t}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["fallback"]);const i=new Map,a=new Map;function s(e,i,a){return(s,l)=>(e.set(l.key,{rect:s.getBoundingClientRect()}),()=>{if(i.has(l.key)){const{rect:e}=i.get(l.key);return i.delete(l.key),function(e,t,i){const{delay:a=0,duration:s=(e=>30*Math.sqrt(e)),easing:l=o8}=n(n({},r),i),u=t.getBoundingClientRect(),c=e.left-u.left,f=e.top-u.top,d=e.width/u.width,h=e.height/u.height,p=Math.sqrt(c*c+f*f),m=getComputedStyle(t),g="none"===m.transform?"":m.transform,y=+m.opacity;return{delay:a,duration:o(s)?s(p):s,easing:l,css:(e,t)=>`\n\t\t\t\topacity: ${e*y};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${g} translate(${t*c}px,${t*f}px) scale(${e+(1-e)*d}, ${e+(1-e)*h});\n\t\t\t`}}(e,s,l)}return e.delete(l.key),t&&t(s,l,a)})}return[s(a,i,!1),s(i,a,!0)]}function c8(e){let t,n,r,i;const a=e[4].default,o=u(a,e,e[3],null);return{c(){t=k("div"),n=k("div"),o&&o.c(),C(n,"class",r=d(`inner ${e[2]||""}`)+" svelte-190gtax"),C(t,"class","outer svelte-190gtax"),j(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},m(e,r){x(e,t,r),b(t,n),o&&o.m(n,null),i=!0},p(e,[s]){o&&o.p&&8&s&&f(o,a,e,e[3],s,null,null),(!i||4&s&&r!==(r=d(`inner ${e[2]||""}`)+" svelte-190gtax"))&&C(n,"class",r),(!i||3&s)&&j(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},i(e){i||(de(o,e),i=!0)},o(e){he(o,e),i=!1},d(e){e&&w(t),o&&o.d(e)}}}function f8(e,t,n){let{$$slots:r={},$$scope:i}=t,{width:a=1}=t,{height:o=1}=t,{class:s=null}=t;return e.$$set=e=>{"width"in e&&n(0,a=e.width),"height"in e&&n(1,o=e.height),"class"in e&&n(2,s=e.class),"$$scope"in e&&n(3,i=e.$$scope)},[a,o,s,i,r]}class d8 extends Ae{constructor(e){super(),Ee(this,e,f8,c8,s,{width:0,height:1,class:2})}}function h8(e,t,n){const r=e.slice();return r[4]=t[n],r[6]=n,r}function p8(e,t,n){const r=e.slice();return r[7]=t[n],r[9]=n,r}const m8=e=>({row:2&e,column:1&e}),g8=e=>({row:e[6],column:e[9]});function y8(e,t){let n,r;const i=t[2].default,a=u(i,t,t[3],g8),o=a||function(e){let t,n;return{c(){t=k("div"),n=S(),C(t,"class","grid-item svelte-1nrt3l8"),F(t,"row",e[6]),F(t,"column",e[9])},m(e,r){x(e,t,r),x(e,n,r)},p(e,n){2&n&&F(t,"row",e[6]),1&n&&F(t,"column",e[9])},d(e){e&&w(t),e&&w(n)}}}(t);return{key:e,first:null,c(){n=$(),o&&o.c(),this.first=n},m(e,t){x(e,n,t),o&&o.m(e,t),r=!0},p(e,t){a?a.p&&11&t&&f(a,i,e,e[3],t,m8,g8):o&&o.p&&3&t&&o.p(e,t)},i(e){r||(de(o,e),r=!0)},o(e){he(o,e),r=!1},d(e){e&&w(n),o&&o.d(e)}}}function v8(e,t){let n,r,i,a=[],o=new Map,s=Array(t[0]);const l=e=>e[9];for(let e=0;e<s.length;e+=1){let n=p8(t,s,e),r=l(n);o.set(r,a[e]=y8(r,n))}return{key:e,first:null,c(){n=$();for(let e=0;e<a.length;e+=1)a[e].c();r=$(),this.first=n},m(e,t){x(e,n,t);for(let n=0;n<a.length;n+=1)a[n].m(e,t);x(e,r,t),i=!0},p(e,t){if(11&t){const n=Array(e[0]);ce(),a=xe(a,t,l,1,e,n,o,r.parentNode,be,y8,r,p8),fe()}},i(e){if(!i){for(let e=0;e<s.length;e+=1)de(a[e]);i=!0}},o(e){for(let e=0;e<a.length;e+=1)he(a[e]);i=!1},d(e){e&&w(n);for(let t=0;t<a.length;t+=1)a[t].d(e);e&&w(r)}}}function b8(e){let t,n,r=[],i=new Map,a=Array(e[1]);const o=e=>e[6];for(let t=0;t<a.length;t+=1){let n=h8(e,a,t),s=o(n);i.set(s,r[t]=v8(s,n))}return{c(){t=k("div");for(let e=0;e<r.length;e+=1)r[e].c();C(t,"class","grid svelte-1nrt3l8"),j(t,"grid-template-columns","repeat("+e[0]+", minmax(0, 1fr))"),j(t,"grid-template-rows","repeat("+e[1]+", minmax(0, 1fr))")},m(e,i){x(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,a){if(11&a){const n=Array(e[1]);ce(),r=xe(r,a,o,1,e,n,i,t,be,v8,null,h8),fe()}(!n||1&a)&&j(t,"grid-template-columns","repeat("+e[0]+", minmax(0, 1fr))"),(!n||2&a)&&j(t,"grid-template-rows","repeat("+e[1]+", minmax(0, 1fr))")},i(e){if(!n){for(let e=0;e<a.length;e+=1)de(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)he(r[e]);n=!1},d(e){e&&w(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function x8(e){let t,n;return t=new d8({props:{width:e[0],height:e[1],$$slots:{default:[b8]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.width=e[0]),2&n&&(r.height=e[1]),11&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function w8(e,t,n){let{$$slots:r={},$$scope:i}=t,{width:a}=t,{height:o}=t;return e.$$set=e=>{"width"in e&&n(0,a=e.width),"height"in e&&n(1,o=e.height),"$$scope"in e&&n(3,i=e.$$scope)},[a,o,r,i]}class _8 extends Ae{constructor(e){super(),Ee(this,e,w8,x8,s,{width:0,height:1})}}function k8(e){let t,n;return{c(){t=k("img"),t.src!==(n=`/images/skills/${e[5]}.png`)&&C(t,"src",n),C(t,"alt",e[5]),C(t,"class","svelte-28czd8")},m(e,n){x(e,t,n)},p(e,r){32&r&&t.src!==(n=`/images/skills/${e[5]}.png`)&&C(t,"src",n),32&r&&C(t,"alt",e[5])},d(e){e&&w(t)}}}function O8(e){let t,n;return{c(){t=k("div"),C(t,"class",n=d(e[6])+" svelte-28czd8")},m(e,n){x(e,t,n)},p(e,r){64&r&&n!==(n=d(e[6])+" svelte-28czd8")&&C(t,"class",n)},d(e){e&&w(t)}}}function S8(e){let t,n,r,i,a,o,s=e[5]&&k8(e),l=e[6]&&O8(e);return{c(){t=k("div"),s&&s.c(),n=S(),l&&l.c(),C(t,"id",e[10]),C(t,"class",r=d(e[9])+" svelte-28czd8"),F(t,"done",e[0]),F(t,"moving",e[1]),F(t,"stunned",e[2]),F(t,"prone",e[3]),F(t,"blitz",e[4])},m(e,r){x(e,t,r),s&&s.m(t,null),b(t,n),l&&l.m(t,null),o=!0},p(i,[a]){(e=i)[5]?s?s.p(e,a):(s=k8(e),s.c(),s.m(t,n)):s&&(s.d(1),s=null),e[6]?l?l.p(e,a):(l=O8(e),l.c(),l.m(t,null)):l&&(l.d(1),l=null),(!o||1024&a)&&C(t,"id",e[10]),(!o||512&a&&r!==(r=d(e[9])+" svelte-28czd8"))&&C(t,"class",r),513&a&&F(t,"done",e[0]),514&a&&F(t,"moving",e[1]),516&a&&F(t,"stunned",e[2]),520&a&&F(t,"prone",e[3]),528&a&&F(t,"blitz",e[4])},i(n){o||(Z((()=>{a&&a.end(1),i||(i=me(t,e[8],{key:e[10]})),i.start()})),o=!0)},o(n){i&&i.invalidate(),a=ge(t,e[7],{key:e[10]}),o=!1},d(e){e&&w(t),s&&s.d(),l&&l.d(),e&&a&&a.end()}}}function $8(e,t,n){let r,i,{id:a}=t,{race:o}=t,{model:s}=t,{team:l}=t,{done:u=!1}=t,{moving:c=!1}=t,{stunned:f=!1}=t,{prone:d=!1}=t,{blitz:h=!1}=t,{cas:p=null}=t,{stupidity:m=null}=t,{send:g}=t,{receive:y}=t;return e.$$set=e=>{"id"in e&&n(11,a=e.id),"race"in e&&n(12,o=e.race),"model"in e&&n(13,s=e.model),"team"in e&&n(14,l=e.team),"done"in e&&n(0,u=e.done),"moving"in e&&n(1,c=e.moving),"stunned"in e&&n(2,f=e.stunned),"prone"in e&&n(3,d=e.prone),"blitz"in e&&n(4,h=e.blitz),"cas"in e&&n(5,p=e.cas),"stupidity"in e&&n(6,m=e.stupidity),"send"in e&&n(7,g=e.send),"receive"in e&&n(8,y=e.receive)},e.$$.update=()=>{30720&e.$$.dirty&&(n(9,r=[o,s,l,"sprite"].join(" ")),n(10,i=`player_${a}`))},[u,c,f,d,h,p,m,g,y,r,i,a,o,s,l]}class E8 extends Ae{constructor(e){super(),Ee(this,e,$8,S8,s,{id:11,race:12,model:13,team:14,done:0,moving:1,stunned:2,prone:3,blitz:4,cas:5,stupidity:6,send:7,receive:8})}}function A8(e){let t,r;const i=[e[2],{send:e[0]},{receive:e[1]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new E8({props:a}),{c(){Oe(t.$$.fragment)},m(e,n){Se(t,e,n),r=!0},p(e,n){const r=7&n?we(i,[4&n&&_e(e[2]),1&n&&{send:e[0]},2&n&&{receive:e[1]}]):{};t.$set(r)},i(e){r||(de(t.$$.fragment,e),r=!0)},o(e){he(t.$$.fragment,e),r=!1},d(e){$e(t,e)}}}function D8(e){let t,n,r=e[2]&&A8(e);return{c(){t=k("div"),r&&r.c(),C(t,"class","pitch-square svelte-eoi57j")},m(e,i){x(e,t,i),r&&r.m(t,null),n=!0},p(e,[n]){e[2]?r?(r.p(e,n),4&n&&de(r,1)):(r=A8(e),r.c(),de(r,1),r.m(t,null)):r&&(ce(),he(r,1,1,(()=>{r=null})),fe())},i(e){n||(de(r),n=!0)},o(e){he(r),n=!1},d(e){e&&w(t),r&&r.d()}}}function C8(e,t,n){let r,{dugout:i}=t,{row:a}=t,{column:o}=t,{width:s}=t,{height:l}=t,{casType:u}=t,{send:c}=t,{receive:f}=t,d=null;return e.$$set=e=>{"dugout"in e&&n(3,i=e.dugout),"row"in e&&n(4,a=e.row),"column"in e&&n(5,o=e.column),"width"in e&&n(6,s=e.width),"height"in e&&n(7,l=e.height),"casType"in e&&n(8,u=e.casType),"send"in e&&n(0,c=e.send),"receive"in e&&n(1,f=e.receive)},e.$$.update=()=>{1016&e.$$.dirty&&i&&(n(9,r="ko"==u?i.cas.slice(s*l).concat(i[u]):"reserve"==u?i.ko.slice(s*l).concat(i[u]):i[u]),n(2,d=r[o*l+a]))},[c,f,d,i,a,o,s,l,u,r]}class M8 extends Ae{constructor(e){super(),Ee(this,e,C8,D8,s,{dugout:3,row:4,column:5,width:6,height:7,casType:8,send:0,receive:1})}}function j8(e){let t,n;return t=new M8({props:{width:T8,height:N8,send:e[2],receive:e[3],casType:e[0],dugout:e[1],row:e[4],column:e[5]}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.send=e[2]),8&n&&(r.receive=e[3]),1&n&&(r.casType=e[0]),2&n&&(r.dugout=e[1]),16&n&&(r.row=e[4]),32&n&&(r.column=e[5]),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function F8(e){let t,n,r,i;return n=new _8({props:{width:T8,height:N8,$$slots:{default:[j8,({row:e,column:t})=>({4:e,5:t}),({row:e,column:t})=>(e?16:0)|(t?32:0)]},$$scope:{ctx:e}}}),{c(){t=k("div"),Oe(n.$$.fragment),C(t,"class",r=`bench ${e[0]}`)},m(e,r){x(e,t,r),Se(n,t,null),i=!0},p(e,[a]){const o={};127&a&&(o.$$scope={dirty:a,ctx:e}),n.$set(o),(!i||1&a&&r!==(r=`bench ${e[0]}`))&&C(t,"class",r)},i(e){i||(de(n.$$.fragment,e),i=!0)},o(e){he(n.$$.fragment,e),i=!1},d(e){e&&w(t),$e(n)}}}let T8=4,N8=2;function R8(e,t,n){let{casType:r}=t,{dugout:i}=t,{send:a}=t,{receive:o}=t;return e.$$set=e=>{"casType"in e&&n(0,r=e.casType),"dugout"in e&&n(1,i=e.dugout),"send"in e&&n(2,a=e.send),"receive"in e&&n(3,o=e.receive)},[r,i,a,o]}class P8 extends Ae{constructor(e){super(),Ee(this,e,R8,F8,s,{casType:0,dugout:1,send:2,receive:3})}}function z8(e){let t,n,r,i,a,o,s;return n=new P8({props:{casType:"cas",dugout:e[0],send:e[1],receive:e[2]}}),i=new P8({props:{casType:"ko",dugout:e[0],send:e[1],receive:e[2]}}),o=new P8({props:{casType:"reserve",dugout:e[0],send:e[1],receive:e[2]}}),{c(){t=k("div"),Oe(n.$$.fragment),r=S(),Oe(i.$$.fragment),a=S(),Oe(o.$$.fragment),C(t,"class","bench svelte-kd7r5x")},m(e,l){x(e,t,l),Se(n,t,null),b(t,r),Se(i,t,null),b(t,a),Se(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),2&t&&(r.send=e[1]),4&t&&(r.receive=e[2]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),2&t&&(a.send=e[1]),4&t&&(a.receive=e[2]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),2&t&&(s.send=e[1]),4&t&&(s.receive=e[2]),o.$set(s)},i(e){s||(de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),s=!0)},o(e){he(n.$$.fragment,e),he(i.$$.fragment,e),he(o.$$.fragment,e),s=!1},d(e){e&&w(t),$e(n),$e(i),$e(o)}}}function B8(e,t,n){let{dugout:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class I8 extends Ae{constructor(e){super(),Ee(this,e,B8,z8,s,{dugout:0,send:1,receive:2})}}function L8(e){let t,n;return t=new _8({props:{width:10,height:3}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}class q8 extends Ae{constructor(e){super(),Ee(this,e,null,L8,s,{})}}function U8(e){let t;return{c(){t=k("div"),t.innerHTML='<div id="selectedPlayerName"></div> \n    <div><div class="grid_stat">MV</div> \n      <div class="grid_stat" id="selectPlayer-MV"></div> \n      <div class="grid_stat">ST</div> \n      <div class="grid_stat" id="selectPlayer-ST"></div> \n      <div class="grid_stat">AG</div> \n      <div class="grid_stat" id="selectPlayer-AG"></div> \n      <div class="grid_stat">AV</div> \n      <div class="grid_stat" id="selectPlayer-AV"></div></div> \n    <div id="selectedPlayerCAS"></div> \n    <div id="skills"></div>',C(t,"id","selectedPlayerData"),C(t,"class","svelte-dj6vrn")},m(e,n){x(e,t,n)},d(e){e&&w(t)}}}function V8(e){let t,n;return t=new d8({props:{width:207,height:317,$$slots:{default:[U8]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}class W8 extends Ae{constructor(e){super(),Ee(this,e,null,V8,s,{})}}function H8(e){let t,n,r;return{c(){t=k("div"),C(t,"class",n=d(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu"),C(t,"title",r=e[1][e[0]])},m(e,n){x(e,t,n)},p(e,i){1&i&&n!==(n=d(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu")&&C(t,"class",n),1&i&&r!==(r=e[1][e[0]])&&C(t,"title",r)},d(e){e&&w(t)}}}function G8(e){let t,n;return t=new d8({props:{$$slots:{default:[H8]},$$scope:{ctx:e}}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,[n]){const r={};9&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function X8(e,t,n){let{weather:r}=t;const i={[ht]:"perfect blood bowl weather",[pt]:"sweltering heat!",[mt]:"very sunny",[gt]:"pouring rain",[yt]:"blizzard go brrrr"},a={[ht]:"nice",[pt]:"heat",[mt]:"sunny",[gt]:"rain",[yt]:"blizzard"};return e.$$set=e=>{"weather"in e&&n(0,r=e.weather)},[r,i,a]}class Y8 extends Ae{constructor(e){super(),Ee(this,e,X8,G8,s,{weather:0})}}function J8(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,_,$,E,A,D,j,T,N,R,P=e[0].name+"",z=e[0].score+"",B=e[0].turn+"";return n=new I8({props:{dugout:e[0].dugout,send:e[2],receive:e[3]}}),$=new q8({}),D=new W8({}),N=new Y8({props:{weather:e[1]}}),{c(){t=k("div"),Oe(n.$$.fragment),r=S(),i=k("img"),s=S(),l=k("div"),u=O(P),c=S(),f=k("div"),d=k("p"),h=O(z),p=S(),m=k("div"),g=k("p"),y=O(B),v=S(),_=k("div"),Oe($.$$.fragment),E=S(),A=k("div"),Oe(D.$$.fragment),j=S(),T=k("div"),Oe(N.$$.fragment),i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png")&&C(i,"src",a),C(i,"alt",o="Logo: "+e[0].logo),C(i,"class","logo svelte-x8vtg0"),C(l,"class","name svelte-x8vtg0"),C(f,"class","score svelte-x8vtg0"),C(m,"class","turn svelte-x8vtg0"),F(m,"active",e[0].active),C(_,"class","aids svelte-x8vtg0"),C(A,"class","selected svelte-x8vtg0"),C(T,"class","weather svelte-x8vtg0"),C(t,"class","dugout svelte-x8vtg0")},m(e,a){x(e,t,a),Se(n,t,null),b(t,r),b(t,i),b(t,s),b(t,l),b(l,u),b(t,c),b(t,f),b(f,d),b(d,h),b(t,p),b(t,m),b(m,g),b(g,y),b(t,v),b(t,_),Se($,_,null),b(t,E),b(t,A),Se(D,A,null),b(t,j),b(t,T),Se(N,T,null),R=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0].dugout),4&t&&(r.send=e[2]),8&t&&(r.receive=e[3]),n.$set(r),(!R||1&t&&i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png"))&&C(i,"src",a),(!R||1&t&&o!==(o="Logo: "+e[0].logo))&&C(i,"alt",o),(!R||1&t)&&P!==(P=e[0].name+"")&&M(u,P),(!R||1&t)&&z!==(z=e[0].score+"")&&M(h,z),(!R||1&t)&&B!==(B=e[0].turn+"")&&M(y,B),1&t&&F(m,"active",e[0].active);const s={};2&t&&(s.weather=e[1]),N.$set(s)},i(e){R||(de(n.$$.fragment,e),de($.$$.fragment,e),de(D.$$.fragment,e),de(N.$$.fragment,e),R=!0)},o(e){he(n.$$.fragment,e),he($.$$.fragment,e),he(D.$$.fragment,e),he(N.$$.fragment,e),R=!1},d(e){e&&w(t),$e(n),$e($),$e(D),$e(N)}}}function K8(e,t,n){let{homeTeam:r}=t,{weather:i}=t,{send:a}=t,{receive:o}=t;return e.$$set=e=>{"homeTeam"in e&&n(0,r=e.homeTeam),"weather"in e&&n(1,i=e.weather),"send"in e&&n(2,a=e.send),"receive"in e&&n(3,o=e.receive)},[r,i,a,o]}class Q8 extends Ae{constructor(e){super(),Ee(this,e,K8,J8,s,{homeTeam:0,weather:1,send:2,receive:3})}}function Z8(e){let t,n,r,i,a,o,s;return n=new P8({props:{casType:"reserve",dugout:e[0],send:e[1],receive:e[2]}}),i=new P8({props:{casType:"ko",dugout:e[0],send:e[1],receive:e[2]}}),o=new P8({props:{casType:"cas",dugout:e[0],send:e[1],receive:e[2]}}),{c(){t=k("div"),Oe(n.$$.fragment),r=S(),Oe(i.$$.fragment),a=S(),Oe(o.$$.fragment),C(t,"class","bench svelte-4xq83r")},m(e,l){x(e,t,l),Se(n,t,null),b(t,r),Se(i,t,null),b(t,a),Se(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),2&t&&(r.send=e[1]),4&t&&(r.receive=e[2]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),2&t&&(a.send=e[1]),4&t&&(a.receive=e[2]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),2&t&&(s.send=e[1]),4&t&&(s.receive=e[2]),o.$set(s)},i(e){s||(de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),s=!0)},o(e){he(n.$$.fragment,e),he(i.$$.fragment,e),he(o.$$.fragment,e),s=!1},d(e){e&&w(t),$e(n),$e(i),$e(o)}}}function e9(e,t,n){let{dugout:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class t9 extends Ae{constructor(e){super(),Ee(this,e,e9,Z8,s,{dugout:0,send:1,receive:2})}}function n9(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,_,$=e[0].score+"",E=e[0].turn+"",A=e[0].name+"";return r=new q8({props:{reverse:!0}}),v=new t9({props:{dugout:e[0].dugout,send:e[1],receive:e[2]}}),{c(){t=k("div"),n=k("div"),Oe(r.$$.fragment),i=S(),a=k("div"),o=O($),s=S(),l=k("div"),u=O(E),c=S(),f=k("div"),d=O(A),h=S(),p=k("img"),y=S(),Oe(v.$$.fragment),C(n,"class","aids svelte-1dth5by"),C(a,"class","score svelte-1dth5by"),C(l,"class","turn svelte-1dth5by"),F(l,"active",e[0].active),C(f,"class","name svelte-1dth5by"),C(p,"class","logo svelte-1dth5by"),p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png")&&C(p,"src",m),C(p,"alt",g="Logo: "+e[0].logo),C(t,"class","dugout svelte-1dth5by")},m(e,m){x(e,t,m),b(t,n),Se(r,n,null),b(t,i),b(t,a),b(a,o),b(t,s),b(t,l),b(l,u),b(t,c),b(t,f),b(f,d),b(t,h),b(t,p),b(t,y),Se(v,t,null),_=!0},p(e,[t]){(!_||1&t)&&$!==($=e[0].score+"")&&M(o,$),(!_||1&t)&&E!==(E=e[0].turn+"")&&M(u,E),1&t&&F(l,"active",e[0].active),(!_||1&t)&&A!==(A=e[0].name+"")&&M(d,A),(!_||1&t&&p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png"))&&C(p,"src",m),(!_||1&t&&g!==(g="Logo: "+e[0].logo))&&C(p,"alt",g);const n={};1&t&&(n.dugout=e[0].dugout),2&t&&(n.send=e[1]),4&t&&(n.receive=e[2]),v.$set(n)},i(e){_||(de(r.$$.fragment,e),de(v.$$.fragment,e),_=!0)},o(e){he(r.$$.fragment,e),he(v.$$.fragment,e),_=!1},d(e){e&&w(t),$e(r),$e(v)}}}function r9(e,t,n){let{awayTeam:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"awayTeam"in e&&n(0,r=e.awayTeam),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class i9 extends Ae{constructor(e){super(),Ee(this,e,r9,n9,s,{awayTeam:0,send:1,receive:2})}}function a9(t){let n;return{c(){n=k("div"),C(n,"class","logo svelte-5pwedy"),j(n,"background-image","url('/images/logo/256x256/logo_"+t[0]+".png')")},m(e,t){x(e,n,t)},p(e,[t]){1&t&&j(n,"background-image","url('/images/logo/256x256/logo_"+e[0]+".png')")},i:e,o:e,d(e){e&&w(n)}}}function o9(e,t,n){let{logo:r}=t;return e.$$set=e=>{"logo"in e&&n(0,r=e.logo)},[r]}class s9 extends Ae{constructor(e){super(),Ee(this,e,o9,a9,s,{logo:0})}}const l9=[];const u9=function(t,n=e){let r;const i=[];function a(e){if(s(t,e)&&(t=e,r)){const e=!l9.length;for(let e=0;e<i.length;e+=1){const n=i[e];n[1](),l9.push(n,t)}if(e){for(let e=0;e<l9.length;e+=2)l9[e][0](l9[e+1]);l9.length=0}}}return{set:a,update:function(e){a(e(t))},subscribe:function(o,s=e){const l=[o,s];return i.push(l),1===i.length&&(r=n(a)||e),o(t),()=>{const e=i.indexOf(l);-1!==e&&i.splice(e,1),0===i.length&&(r(),r=null)}}}}(300);function c9(e){let t,n,r,i,a,o;return{c(){t=k("div"),C(t,"id",n=`cell_${e[5]}_${e[4]}`),C(t,"class",r=d(`cell sprite ${e[10]}`)+" svelte-1oo7fl9"),F(t,"target",e[1]),F(t,"moved",e[3]),F(t,"active",e[0]),F(t,"pushback-choice",e[2])},m(e,n){x(e,t,n),o=!0},p(i,[a]){e=i,(!o||48&a&&n!==(n=`cell_${e[5]}_${e[4]}`))&&C(t,"id",n),(!o||1024&a&&r!==(r=d(`cell sprite ${e[10]}`)+" svelte-1oo7fl9"))&&C(t,"class",r),1026&a&&F(t,"target",e[1]),1032&a&&F(t,"moved",e[3]),1025&a&&F(t,"active",e[0]),1028&a&&F(t,"pushback-choice",e[2])},i(n){o||(Z((()=>{a&&a.end(1),i||(i=me(t,e[6],e[8])),i.start()})),o=!0)},o(n){i&&i.invalidate(),a=ge(t,e[7],e[9]),o=!1},d(e){e&&w(t),e&&a&&a.end()}}}function f9(e,t,n){let r;l(e,u9,(e=>n(14,r=e)));let i,a,o,s,{plus:u=null}=t,{active:c=!1}=t,{target:f=!1}=t,{pushbackChoice:d=!1}=t,{moved:h=!1}=t,{row:p}=t,{column:m}=t,{send:g}=t,{receive:y}=t,v="";return e.$$set=e=>{"plus"in e&&n(11,u=e.plus),"active"in e&&n(0,c=e.active),"target"in e&&n(1,f=e.target),"pushbackChoice"in e&&n(2,d=e.pushbackChoice),"moved"in e&&n(3,h=e.moved),"row"in e&&n(4,p=e.row),"column"in e&&n(5,m=e.column),"send"in e&&n(12,g=e.send),"receive"in e&&n(13,y=e.receive)},e.$$.update=()=>{30721&e.$$.dirty&&(n(10,v=u?`plus${u}`:""),c?(n(6,i=y),n(7,a=g),n(8,o=n(9,s={key:"active-cell"}))):(n(6,i=n(7,a=l8)),n(8,o=n(9,s={duration:.1*r}))))},[c,f,d,h,p,m,i,a,o,s,v,u,g,y,r]}class d9 extends Ae{constructor(e){super(),Ee(this,e,f9,c9,s,{plus:11,active:0,target:1,pushbackChoice:2,moved:3,row:4,column:5,send:12,receive:13})}}function h9(e){let t,n,r,i;return{c(){t=k("div"),C(t,"id","ball"),C(t,"class","svelte-q0voaj"),F(t,"held",e[0])},m(e,n){x(e,t,n),i=!0},p(e,[n]){1&n&&F(t,"held",e[0])},i(a){i||(Z((()=>{r&&r.end(1),n||(n=me(t,e[2],{key:"ball"})),n.start()})),i=!0)},o(a){n&&n.invalidate(),r=ge(t,e[1],{key:"ball"}),i=!1},d(e){e&&w(t),e&&r&&r.end()}}}function p9(e,t,n){let{held:r=!1}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"held"in e&&n(0,r=e.held),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class m9 extends Ae{constructor(e){super(),Ee(this,e,p9,h9,s,{held:0,send:1,receive:2})}}function g9(e,t,n){const r=e.slice();return r[2]=t[n],r}function y9(e){let t,n=e[0],r=[];for(let t=0;t<n.length;t+=1)r[t]=v9(g9(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=$()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);x(e,t,n)},p(e,i){if(3&i){let a;for(n=e[0],a=0;a<n.length;a+=1){const o=g9(e,n,a);r[a]?r[a].p(o,i):(r[a]=v9(o),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(e){_(r,e),e&&w(t)}}}function v9(e){let t,n;return{c(){t=k("div"),C(t,"class",n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")},m(e,n){x(e,t,n)},p(e,r){1&r&&n!==(n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")&&C(t,"class",n)},d(e){e&&w(t)}}}function b9(t){let n,r=t[0]&&y9(t);return{c(){n=k("div"),r&&r.c(),C(n,"class","dice-container svelte-1cue4bg")},m(e,t){x(e,n,t),r&&r.m(n,null)},p(e,[t]){e[0]?r?r.p(e,t):(r=y9(e),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&w(n),r&&r.d()}}}function x9(e,t,n){let{dice:r}=t;return e.$$set=e=>{"dice"in e&&n(0,r=e.dice)},[r,["attacker-down","both-down","push","defender-stumbles","defender-down"]]}class w9 extends Ae{constructor(e){super(),Ee(this,e,x9,b9,s,{dice:0})}}function _9(t){let n;return{c(){n=k("div"),n.innerHTML='<div class="dice sprite d1h foul svelte-u76c3n"></div>',C(n,"class","dice-container svelte-u76c3n")},m(e,t){x(e,n,t)},p:e,i:e,o:e,d(e){e&&w(n)}}}class k9 extends Ae{constructor(e){super(),Ee(this,e,null,_9,s,{})}}function O9(e){let t,n;return t=new s9({props:{logo:e[2].toLowerCase()}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};4&n&&(r.logo=e[2].toLowerCase()),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function S9(e){let t,n;return t=new s9({props:{logo:e[3].toLowerCase()}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.logo=e[3].toLowerCase()),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function $9(e){let t,r;const i=[e[7],{send:e[4]},{receive:e[5]},{row:e[0]},{column:e[1]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new d9({props:a}),{c(){Oe(t.$$.fragment)},m(e,n){Se(t,e,n),r=!0},p(e,n){const r=179&n?we(i,[128&n&&_e(e[7]),16&n&&{send:e[4]},32&n&&{receive:e[5]},1&n&&{row:e[0]},2&n&&{column:e[1]}]):{};t.$set(r)},i(e){r||(de(t.$$.fragment,e),r=!0)},o(e){he(t.$$.fragment,e),r=!1},d(e){$e(t,e)}}}function E9(e){let t,r;const i=[e[6],{send:e[4]},{receive:e[5]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new E8({props:a}),{c(){Oe(t.$$.fragment)},m(e,n){Se(t,e,n),r=!0},p(e,n){const r=112&n?we(i,[64&n&&_e(e[6]),16&n&&{send:e[4]},32&n&&{receive:e[5]}]):{};t.$set(r)},i(e){r||(de(t.$$.fragment,e),r=!0)},o(e){he(t.$$.fragment,e),r=!1},d(e){$e(t,e)}}}function A9(e){let t,n;return t=new w9({props:{dice:e[9]}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};512&n&&(r.dice=e[9]),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function D9(e){let t,n;return t=new k9({}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function C9(e){let t,r;const i=[e[8],{send:e[4]},{receive:e[5]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new m9({props:a}),{c(){Oe(t.$$.fragment)},m(e,n){Se(t,e,n),r=!0},p(e,n){const r=304&n?we(i,[256&n&&_e(e[8]),16&n&&{send:e[4]},32&n&&{receive:e[5]}]):{};t.$set(r)},i(e){r||(de(t.$$.fragment,e),r=!0)},o(e){he(t.$$.fragment,e),r=!1},d(e){$e(t,e)}}}function M9(e){let t,n,r,i,a,o,s,l,u=0==e[1]&&7==e[0]&&e[2]&&O9(e),c=25==e[1]&&7==e[0]&&e[3]&&S9(e),f=e[7]&&$9(e),d=e[6]&&E9(e),h=e[9]&&A9(e),p=e[10]&&D9(),m=e[8]&&C9(e);return{c(){t=k("div"),u&&u.c(),n=S(),c&&c.c(),r=S(),f&&f.c(),i=S(),d&&d.c(),a=S(),h&&h.c(),o=S(),p&&p.c(),s=S(),m&&m.c(),C(t,"class","pitch-square svelte-124v8fk")},m(e,g){x(e,t,g),u&&u.m(t,null),b(t,n),c&&c.m(t,null),b(t,r),f&&f.m(t,null),b(t,i),d&&d.m(t,null),b(t,a),h&&h.m(t,null),b(t,o),p&&p.m(t,null),b(t,s),m&&m.m(t,null),l=!0},p(e,[l]){0==e[1]&&7==e[0]&&e[2]?u?(u.p(e,l),7&l&&de(u,1)):(u=O9(e),u.c(),de(u,1),u.m(t,n)):u&&(ce(),he(u,1,1,(()=>{u=null})),fe()),25==e[1]&&7==e[0]&&e[3]?c?(c.p(e,l),11&l&&de(c,1)):(c=S9(e),c.c(),de(c,1),c.m(t,r)):c&&(ce(),he(c,1,1,(()=>{c=null})),fe()),e[7]?f?(f.p(e,l),128&l&&de(f,1)):(f=$9(e),f.c(),de(f,1),f.m(t,i)):f&&(ce(),he(f,1,1,(()=>{f=null})),fe()),e[6]?d?(d.p(e,l),64&l&&de(d,1)):(d=E9(e),d.c(),de(d,1),d.m(t,a)):d&&(ce(),he(d,1,1,(()=>{d=null})),fe()),e[9]?h?(h.p(e,l),512&l&&de(h,1)):(h=A9(e),h.c(),de(h,1),h.m(t,o)):h&&(ce(),he(h,1,1,(()=>{h=null})),fe()),e[10]?p?1024&l&&de(p,1):(p=D9(),p.c(),de(p,1),p.m(t,s)):p&&(ce(),he(p,1,1,(()=>{p=null})),fe()),e[8]?m?(m.p(e,l),256&l&&de(m,1)):(m=C9(e),m.c(),de(m,1),m.m(t,null)):m&&(ce(),he(m,1,1,(()=>{m=null})),fe())},i(e){l||(de(u),de(c),de(f),de(d),de(h),de(p),de(m),l=!0)},o(e){he(u),he(c),he(f),he(d),he(h),he(p),he(m),l=!1},d(e){e&&w(t),u&&u.d(),c&&c.d(),f&&f.d(),d&&d.d(),h&&h.d(),p&&p.d(),m&&m.d()}}}function j9(e,t,n){let{row:r}=t,{column:i}=t,{pitch:a}=t,{homeLogo:o}=t,{awayLogo:s}=t,{send:l}=t,{receive:u}=t,c=null,f=null,d=null,h=null,p=!1;return e.$$set=e=>{"row"in e&&n(0,r=e.row),"column"in e&&n(1,i=e.column),"pitch"in e&&n(11,a=e.pitch),"homeLogo"in e&&n(2,o=e.homeLogo),"awayLogo"in e&&n(3,s=e.awayLogo),"send"in e&&n(4,l=e.send),"receive"in e&&n(5,u=e.receive)},e.$$.update=()=>{2051&e.$$.dirty&&n(6,({player:c,cell:f,ball:d,dice:h,foul:p}=a[`${i}-${r}`]||{}),c,(n(7,f),n(11,a),n(1,i),n(0,r)),(n(8,d),n(11,a),n(1,i),n(0,r)),(n(9,h),n(11,a),n(1,i),n(0,r)),(n(10,p),n(11,a),n(1,i),n(0,r)))},[r,i,o,s,l,u,c,f,d,h,p,a]}class F9 extends Ae{constructor(e){super(),Ee(this,e,j9,M9,s,{row:0,column:1,pitch:11,homeLogo:2,awayLogo:3,send:4,receive:5})}}function T9(e){let t,n;return t=new F9({props:{homeLogo:e[3],awayLogo:e[4],pitch:e[0],send:e[1],receive:e[2],row:e[7],column:e[8]}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.homeLogo=e[3]),16&n&&(r.awayLogo=e[4]),1&n&&(r.pitch=e[0]),2&n&&(r.send=e[1]),4&n&&(r.receive=e[2]),128&n&&(r.row=e[7]),256&n&&(r.column=e[8]),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function N9(e){let t,n,r;return n=new _8({props:{width:26,height:15,$$slots:{default:[T9,({row:e,column:t})=>({7:e,8:t}),({row:e,column:t})=>(e?128:0)|(t?256:0)]},$$scope:{ctx:e}}}),{c(){t=k("div"),Oe(n.$$.fragment),C(t,"class","pitch svelte-1d39j5z")},m(e,i){x(e,t,i),Se(n,t,null),r=!0},p(e,[t]){const r={};927&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i(e){r||(de(n.$$.fragment,e),r=!0)},o(e){he(n.$$.fragment,e),r=!1},d(e){e&&w(t),$e(n)}}}function R9(e,t,n){let r,i,{homeTeam:a}=t,{awayTeam:o}=t,{pitch:s}=t,{send:l}=t,{receive:u}=t;return e.$$set=e=>{"homeTeam"in e&&n(5,a=e.homeTeam),"awayTeam"in e&&n(6,o=e.awayTeam),"pitch"in e&&n(0,s=e.pitch),"send"in e&&n(1,l=e.send),"receive"in e&&n(2,u=e.receive)},e.$$.update=()=>{96&e.$$.dirty&&(n(3,r=a.logo),n(4,i=o.logo))},[s,l,u,r,i,a,o]}class P9 extends Ae{constructor(e){super(),Ee(this,e,R9,N9,s,{homeTeam:5,awayTeam:6,pitch:0,send:1,receive:2})}}function z9(e){let t,n;return{c(){t=k("div"),C(t,"class",n=d(`sprite ${e[0]}`)+" svelte-39bs0u")},m(e,n){x(e,t,n)},p(e,r){1&r&&n!==(n=d(`sprite ${e[0]}`)+" svelte-39bs0u")&&C(t,"class",n)},d(e){e&&w(t)}}}function B9(e){let t,n,r;return n=new d8({props:{width:2,height:1,$$slots:{default:[z9]},$$scope:{ctx:e}}}),{c(){t=k("div"),Oe(n.$$.fragment),C(t,"class","banner svelte-39bs0u")},m(e,i){x(e,t,i),Se(n,t,null),r=!0},p(e,[t]){const r={};3&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i(e){r||(de(n.$$.fragment,e),r=!0)},o(e){he(n.$$.fragment,e),r=!1},d(e){e&&w(t),$e(n)}}}function I9(e,t,n){let{banner:r}=t;return e.$$set=e=>{"banner"in e&&n(0,r=e.banner)},[r]}class L9 extends Ae{constructor(e){super(),Ee(this,e,I9,B9,s,{banner:0})}}const{document:q9}=ye;function U9(e,t,n){const r=e.slice();return r[48]=t[n],r}function V9(e,t){let n,r;return{key:e,first:null,c(){n=k("link"),C(n,"rel","stylesheet"),C(n,"href",r="/styles/"+t[48]+".css"),this.first=n},m(e,t){x(e,n,t)},p(e,t){1&t[0]&&r!==(r="/styles/"+e[48]+".css")&&C(n,"href",r)},d(e){e&&w(n)}}}function W9(e){let t,n;return t=new L9({props:{banner:e[4]}}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},p(e,n){const r={};16&n[0]&&(r.banner=e[4]),t.$set(r)},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function H9(e){let t,n,r,i,a,o,s,l,u;n=new Q8({props:{homeTeam:e[1],weather:e[5],send:e[6],receive:e[7]}}),i=new P9({props:{pitch:e[3],homeTeam:e[1],awayTeam:e[2],send:e[6],receive:e[7]}}),o=new i9({props:{awayTeam:e[2],send:e[6],receive:e[7]}});let c=e[4]&&W9(e);return{c(){t=k("div"),Oe(n.$$.fragment),r=S(),Oe(i.$$.fragment),a=S(),Oe(o.$$.fragment),s=S(),c&&c.c(),l=$(),C(t,"class","pitch svelte-70qdsx")},m(e,f){x(e,t,f),Se(n,t,null),b(t,r),Se(i,t,null),b(t,a),Se(o,t,null),x(e,s,f),c&&c.m(e,f),x(e,l,f),u=!0},p(e,t){const r={};2&t[0]&&(r.homeTeam=e[1]),32&t[0]&&(r.weather=e[5]),n.$set(r);const a={};8&t[0]&&(a.pitch=e[3]),2&t[0]&&(a.homeTeam=e[1]),4&t[0]&&(a.awayTeam=e[2]),i.$set(a);const s={};4&t[0]&&(s.awayTeam=e[2]),o.$set(s),e[4]?c?(c.p(e,t),16&t[0]&&de(c,1)):(c=W9(e),c.c(),de(c,1),c.m(l.parentNode,l)):c&&(ce(),he(c,1,1,(()=>{c=null})),fe())},i(e){u||(de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),de(c),u=!0)},o(e){he(n.$$.fragment,e),he(i.$$.fragment,e),he(o.$$.fragment,e),he(c),u=!1},d(e){e&&w(t),$e(n),$e(i),$e(o),e&&w(s),c&&c.d(e),e&&w(l)}}}function G9(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[48];for(let t=0;t<s.length;t+=1){let n=U9(e,s,t),r=l(n);o.set(r,a[t]=V9(r,n))}return r=new d8({props:{width:1335,height:1061,$$slots:{default:[H9]},$$scope:{ctx:e}}}),{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=k("link"),n=S(),Oe(r.$$.fragment),C(t,"rel","stylesheet"),C(t,"href","/styles/sprite.css")},m(e,o){for(let e=0;e<a.length;e+=1)a[e].m(q9.head,null);b(q9.head,t),x(e,n,o),Se(r,e,o),i=!0},p(e,n){if(1&n[0]){const r=e[0];a=xe(a,n,l,1,e,r,o,t.parentNode,ve,V9,t,U9)}const i={};62&n[0]|1048576&n[1]&&(i.$$scope={dirty:n,ctx:e}),r.$set(i)},i(e){i||(de(r.$$.fragment,e),i=!0)},o(e){he(r.$$.fragment,e),i=!1},d(e){for(let e=0;e<a.length;e+=1)a[e].d();w(t),e&&w(n),$e(r,e)}}}function X9(e,t){return{logo:e.Data.Logo.toLowerCase(),dugout:{cas:[],ko:[],reserve:[]},score:e.Touchdown||0,name:e.Data.Name,turn:e.GameTurn||1,active:t}}function Y9(e){return e&&e.length?e:e?[e]:[]}function J9(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}function K9(e){}function Q9(e,t,n){let r;l(e,u9,(e=>n(15,r=e)));let i,a,o,s,u,{replaySteps:c}=t,{replayStepIndex:f}=t,{replayStart:d}=t,{replayEnd:h}=t,p=[],m={},g={},y={};const v={[ft.Reserves]:"reserve",[ft.KO]:"ko",[ft.Casualty]:"cas",[ft.SentOff]:"cas"},[b,x]=u8({duration:.5*r,easing:s8,fallback(e,t){const n=getComputedStyle(e),i="none"===n.transform?"":n.transform;return{duration:.5*r,easing:s8,css:e=>`\n\t\t\t\t\ttransform: ${i} scale(${e});\n\t\t\t\t\topacity: ${e}\n\t\t\t\t`}}});async function w(e,t,r){i=e.slice(t,r),t>0?await _(e[t-1].BoardState):(a=null,n(0,p=[]),n(1,m={}),n(2,g={}),n(3,y={}),n(5,u=ht)),await E(3)}async function _(e){A(),o=e.BlitzerId,n(1,m=X9(e.ListTeams.TeamState[0],1!=e.ActiveTeam)),n(2,g=X9(e.ListTeams.TeamState[1],1==e.ActiveTeam)),n(0,p=e.ListTeams.TeamState.map((e=>tn[e.Data.IdRace])).filter(((e,t,n)=>n.indexOf(e)===t))),function(e){Object.values(y).forEach((e=>{e.player&&(e.player=null)})),e.ListTeams.TeamState[0].ListPitchPlayers.PlayerState.map((e=>S(e,"home"))),e.ListTeams.TeamState[1].ListPitchPlayers.PlayerState.map((e=>S(e,"away")))}(e),function(e){let{x:t,y:n}=e.Ball.Cell;Object.values(y).forEach((e=>{e.ball=null})),-1!=t&&-1!=n&&(k(e.Ball.Cell).ball={held:1==e.Ball.IsHeld})}(e),await Q()}function k(e){return n(3,y[`${e.x||0}-${e.y||0}`]=y[`${e.x||0}-${e.y||0}`]||{},y)}function O(e){let t;return Object.entries(y).forEach((([r,i])=>{i.player&&i.player.id==e&&(n(3,y[r]=i,y),t=i.player)})),t}function S(e,t){let n=function(e,t){switch(t){case 71:case 414:case 459:return{race:"amazon",model:"blitzer"+(e%2+1)};case 70:case 413:case 458:return{race:"amazon",model:"catcher"+(e%2+1)};case 68:case 411:case 456:return{race:"amazon",model:"lineman"+(e%2+1)};case 69:case 457:case 412:return{race:"amazon",model:"thrower"};case 32:case 336:case 355:return{race:"chaos",model:"beastman"+(e%4+1)};case 34:case 338:case 357:return{race:"chaos",model:"minotaur"+(e%3+1)};case 33:case 337:case 356:return{race:"chaos",model:"warrior"+(e%6+1)};case 330:case 363:case 109:return{race:"chaosdwarf",model:"blocker"+(e%4+1)};case 331:case 364:case 110:return{race:"chaosdwarf",model:"bullcentaur"+(e%2+1)};case 329:case 362:case 108:return{race:"chaosdwarf",model:"hobgoblin"+(e%4+1)};case 332:case 365:case 111:return{race:"chaosdwarf",model:"minotaur"};case 47:case 345:case 391:return{race:"darkelf",model:"lineman"};case 48:case 347:case 392:return{race:"darkelf",model:"runner"};case 49:case 346:case 394:return{race:"darkelf",model:"assasin"};case 50:case 344:case 393:return{race:"darkelf",model:"blitzer"};case 51:case 348:case 395:return{race:"darkelf",model:"witchelf"};case 6:case 426:return{race:"dwarf",model:"longbeard"+(e%3+1)};case 8:case 427:return{race:"dwarf",model:"blitzer"+(e%2+1)};case 7:case 429:return{race:"dwarf",model:"runner"+(e%3+1)};case 9:case 428:return{race:"dwarf",model:"trollslayer"+(e%2+1)};case 10:case 430:return{race:"dwarf",model:"deathroller"};case 30:case 372:case 466:case 479:return{race:"goblin",model:"goblin"+(e%7+1)};case 31:case 373:case 467:case 481:return{race:"goblin",model:"looney"+(e%2+1)};case 44:case 377:case 471:case 484:return{race:"goblin",model:"troll"+(e%3+1)};case 45:case 374:case 468:case 482:return{race:"goblin",model:"pogo"+(e%2+1)};case 46:case 376:case 470:case 483:return{race:"goblin",model:"fanatic"+(e%2+1)};case 107:case 375:case 469:case 480:return{race:"goblin",model:"bomber"+(e%2+1)};case 60:case 431:case 485:return{race:"halfling",model:"halfling"+(e%5+1)};case 61:case 432:case 486:return{race:"halfling",model:"treeman"+(e%3+1)};case 77:case 323:case 387:return{race:"highelf",model:"lineman"+(e%2+1)};case 78:case 325:case 390:return{race:"highelf",model:"thrower"};case 79:case 389:case 326:return{race:"highelf",model:"catch"+(e%2+1)};case 80:case 324:case 388:return{race:"highelf",model:"blitzer"};case 1:case 422:case 438:return{race:"human",model:"lineman"+(e%2+1)};case 2:case 423:case 440:return{race:"human",model:"catcher"};case 3:case 424:case 441:return{race:"human",model:"thrower"};case 4:case 421:case 439:return{race:"human",model:"blitzer"};case 5:case 425:case 442:return{race:"human",model:"ogre"};case 81:case 499:return{race:"khemri",model:"lineman"+(e%4+1)};case 82:case 500:return{race:"khemri",model:"thrower"+(e%2+1)};case 83:case 501:return{race:"khemri",model:"blitzer"+(e%2+1)};case 84:case 502:return{race:"khemri",model:"mummy"+(e%2+1)};case 27:case 415:case 472:return{race:"lizardman",model:"skink"+(e%4+1)};case 28:case 416:case 473:return{race:"lizardman",model:"saurus"+(e%4+1)};case 29:case 417:case 474:return{race:"lizardman",model:"kroxigor"+(e%2+1)};case 86:return{race:"necromantic",model:"zombie"+(e%4+1)};case 87:return{race:"necromantic",model:"ghoul"+(e%2+1)};case 88:return{race:"necromantic",model:"wight"+(e%2+1)};case 89:case 498:return{race:"necromantic",model:"golem"+(e%2+1)};case 90:case 497:return{race:"necromantic",model:"werewolf"+(e%2+1)};case 62:case 405:case 450:return{race:"norse",model:"lineman"+(e%4+1)};case 63:case 406:case 452:return{race:"norse",model:"thrower"};case 64:case 407:case 451:return{race:"norse",model:"runner"};case 65:case 408:case 453:return{race:"norse",model:"berserker"+(e%2+1)};case 66:case 409:case 454:return{race:"norse",model:"ulfwerener"+(e%2+1)};case 67:case 410:case 455:return{race:"norse",model:"yhetee"};case 91:case 358:return{race:"nurgle",model:"rotter"+(e%6+1)};case 92:case 359:return{race:"nurgle",model:"pestigor"+(e%4+1)};case 93:case 360:return{race:"nurgle",model:"warrior"+(e%4+1)};case 94:case 361:return{race:"nurgle",model:"beast - of - nurgle"};case 95:case 476:case 478:case 737:return{race:"ogre",model:"snotling"+(e%7+1)};case 96:case 475:case 477:case 738:return{race:"ogre",model:"ogre"+(e%6+1)};case 21:case 366:case 460:return{race:"orc",model:"lineman"+(e%3+1)};case 22:case 369:case 463:return{race:"orc",model:"goblin"+(e%2+1)};case 23:case 368:case 462:return{race:"orc",model:"thrower"+(e%2+1)};case 24:case 370:case 464:return{race:"orc",model:"blocker"+(e%4+1)};case 25:case 367:case 461:return{race:"orc",model:"blitzer"+(e%3+1)};case 26:case 371:case 465:return{race:"orc",model:"troll"};case 72:case 739:return{race:"proelf",model:"lineman"+(e%2+1)};case 73:case 741:return{race:"proelf",model:"thrower"};case 74:case 749:return{race:"proelf",model:"catcher"+(e%2+1)};case 75:case 740:return{race:"proelf",model:"blitzer"+(e%2+1)};case 16:case 339:case 378:return{race:"skaven",model:"lineman"+(e%3+1)};case 17:case 340:case 380:return{race:"skaven",model:"thrower"};case 18:case 341:case 381:return{race:"skaven",model:"runner"+(e%2+1)};case 19:case 342:case 379:return{race:"skaven",model:"blitzer"+(e%2+1)};case 20:case 343:case 382:return{race:"skaven",model:"ratogre"};case 54:case 492:return{race:"undead",model:"skeleton"+(e%3+1)};case 55:case 493:return{race:"undead",model:"zombie"+(e%4+1)};case 56:case 494:return{race:"undead",model:"ghoul"+(e%2+1)};case 57:case 495:return{race:"undead",model:"wight"+(e%2+1)};case 58:case 496:return{race:"undead",model:"mummy"+(e%2+1)};case 123:case 732:return{race:"underworld",model:"goblin"+(e%5+1)};case 124:case 733:return{race:"underworld",model:"lineman"+(e%4+1)};case 125:case 734:return{race:"underworld",model:"thrower"+(e%2+1)};case 126:case 735:return{race:"underworld",model:"blitzer"+(e%2+1)};case 127:case 736:return{race:"underworld",model:"troll"};case 97:case 327:case 327:case 503:return{race:"vampire",model:"thrall"+(e%3+1)};case 98:case 328:case 328:case 504:return{race:"vampire",model:"vampire"+(e%3+1)};case 11:case 396:case 433:return{race:"woodelf",model:"lineman"+(e%4+1)};case 12:case 397:case 434:return{race:"woodelf",model:"catcher"+(e%4+1)};case 13:case 398:case 435:return{race:"woodelf",model:"thrower"+(e%2+1)};case 14:case 399:case 436:return{race:"woodelf",model:"wardancer"+(e%2+1)};case 15:case 400:case 437:return{race:"woodelf",model:"tree"};case 142:case 401:case 446:return{race:"kislev",model:"lineman"+(e%4+1)};case 143:case 403:case 448:return{race:"kislev",model:"catcher"+(e%2+1)};case 144:case 402:case 447:return{race:"kislev",model:"blitzer"+(e%2+1)};case 145:case 404:case 449:return{race:"kislev",model:"bear"};case 139:case 333:case 420:case 443:return{race:"bretonnia",model:"peasant"+(e%3+1)};case 140:case 335:case 419:case 445:return{race:"bretonnia",model:"blocker"+(e%2+1)};case 141:case 334:case 418:case 444:return{race:"bretonnia",model:"knight"+(e%2+1)};case 146:case 239:case 617:case 618:return{model:"barik-farblast",race:"starplayer"};case 293:case 294:case 619:case 620:return{model:"bertha-bigfist",race:"starplayer"};case 133:case 233:case 621:case 622:return{model:"bomber-dribblesnot",race:"starplayer"};case 309:case 310:case 623:case 624:return{model:"boomer-eziasson",race:"starplayer"};case 164:case 256:case 625:case 626:return{model:"brick-farth",race:"starplayer"};case 224:case 59:case 627:case 628:return{model:"count-luthorvon-drakenborg",race:"starplayer"};case 301:case 302:case 629:case 630:return{model:"crazy-igor",race:"starplayer"};case 103:case 229:case 631:case 632:return{model:"deeproot-strongbranch",race:"starplayer"};case 147:case 240:case 633:case 634:return{model:"dolfar-longstride",race:"starplayer"};case 101:case 227:case 635:case 636:return{model:"eldril-sidewinder",race:"starplayer"};case 154:case 247:case 637:case 638:return{model:"fezglitch",race:"starplayer"};case 313:case 314:case 639:case 640:return{model:"flint-churnblade",race:"starplayer"};case 303:case 304:case 641:case 642:return{model:"fungus-the-loon",race:"starplayer"};case 149:case 242:case 643:case 644:return{model:"glart-smashrip-jr",race:"starplayer"};case 214:case 36:case 645:case 646:return{model:"grashnak-blackhoof",race:"starplayer"};case 215:case 37:case 647:case 648:return{model:"griff-oberwald",race:"starplayer"};case 216:case 38:case 649:case 650:return{model:"grim-ironjaw",race:"starplayer"};case 148:case 241:case 651:case 652:return{model:"grotty",race:"starplayer"};case 315:case 316:case 653:case 654:return{model:"hack-enslash",race:"starplayer"};case 138:case 238:case 655:case 656:return{model:"hakflem-skuttlespike",race:"starplayer"};case 217:case 39:case 657:case 658:return{model:"headsplitter",race:"starplayer"};case 317:case 318:case 659:case 660:return{model:"helmut-wulf",race:"starplayer"};case 275:case 276:case 661:case 662:return{model:"hemlock",race:"starplayer"};case 222:case 52:case 663:case 664:return{model:"horkon-heartripper",race:"starplayer"};case 299:case 300:case 665:case 666:return{model:"hthark-the-unstoppable",race:"starplayer"};case 137:case 237:case 667:case 668:return{model:"hubris-rakarth",race:"starplayer"};case 307:case 308:case 669:case 670:return{model:"humerus-carpal",race:"starplayer"};case 106:case 232:case 671:case 672:return{model:"icepelt-hammerblow",race:"starplayer"};case 157:case 250:case 673:case 674:return{model:"ithaca-benoin",race:"starplayer"};case 136:case 236:case 675:case 676:return{model:"j-earlice",race:"starplayer"};case 218:case 40:case 677:case 678:return{model:"jordel-freshbreeze",race:"starplayer"};case 158:case 251:case 679:case 680:return{model:"lewdgrip-whiparm",race:"starplayer"};case 102:case 228:case 683:case 684:return{model:"lord-borak-the-despoiler",race:"starplayer"};case 281:case 282:case 681:case 682:return{model:"lottabottol",race:"starplayer"};case 160:case 252:case 685:case 686:return{model:"max-spleenripper",race:"starplayer"};case 135:case 235:case 687:case 688:return{model:"mighty-zug",race:"starplayer"};case 223:case 53:case 689:case 690:return{model:"morg-n-thorg",race:"starplayer"};case 305:case 306:case 693:case 694:return{model:"nobbla-blackwart",race:"starplayer"};case 150:case 243:case 691:case 692:return{model:"prince-moranion",race:"starplayer"};case 161:case 253:case 695:case 696:return{model:"puggy-baconbreath",race:"starplayer"};case 283:case 284:case 697:case 698:return{model:"quetzal-leap",race:"starplayer"};case 231:case 699:case 700:case 105:return{model:"ramtut-iii",race:"starplayer"};case 295:case 296:case 701:case 702:return{model:"rashnak-backstabber",race:"starplayer"};case 219:case 41:case 703:case 704:return{model:"ripper",race:"starplayer"};case 151:case 244:case 705:case 706:return{model:"roxanna-darknail",race:"starplayer"};case 100:case 226:case 707:case 708:return{model:"scrappa-sorehead",race:"starplayer"};case 104:case 230:case 709:case 710:return{model:"setekh",race:"starplayer"};case 319:case 320:case 711:case 712:return{model:"sinnedbad",race:"starplayer"};case 162:case 254:case 713:case 714:return{model:"skitter-stab-stab",race:"starplayer"};case 220:case 42:case 715:case 716:return{model:"slibli",race:"starplayer"};case 152:case 245:case 717:case 718:return{model:"soaren-hightower",race:"starplayer"};case 163:case 255:case 719:case 720:return{model:"ugroth-bolgrot",race:"starplayer"};case 221:case 43:case 721:case 722:return{model:"varag-ghoul-chewer",race:"starplayer"};case 277:case 278:case 725:case 726:return{model:"wilhelm-chaney",race:"starplayer"};case 279:case 280:case 723:case 724:return{model:"willow-rosebark",race:"starplayer"};case 225:case 727:case 728:case 99:return{model:"zara-the-slayer",race:"starplayer"};case 134:case 234:case 729:case 730:return{model:"zzharg-madeye",race:"starplayer"}}}(e.Id,e.Data.IdPlayerTypes);switch(n.id=e.Id,n.team=t,e.Status){case 1:n.prone=!0;break;case 2:n.stunned=!0}switch(e.disabled&&(e.usedSkills.indexOf(20)>-1?n.disabled="Rooted":e.usedSkills.indexOf(31)>-1?n.disabled="BoneHeaded":e.usedSkills.indexOf(51)>-1&&(n.disabled="Stupid")),e.Situation>=ft.Casualty&&(e.Situation===ft.Casualty?n.cas=nn[Math.max(...J9(e.ListCasualties))].icon:n.cas="Expelled"),e.Situation){case ft.Active:n.done=1!=e.CanAct,k(e.Cell).player=n;break;default:"home"==t?m.dugout[v[e.Situation]].push(n):g.dugout[v[e.Situation]].push(n)}}q((()=>(console.log("Viewer onMount start"),async function(){for(;;){0===i.length&&await w(c,d,h);const e=i.shift();n(10,f=e.index);for(const t of Y9(e.RulesEventBoardAction)){t.ActionType!==vt&&(a=null);for(const e of Y9(t.Results.BoardActionResult)){const n=$[t.ActionType||0];try{await n(t,e),await Q()}catch(e){throw await Q(),console.error("Action failed",{error:e,boardAction:t}),e}await E()}}e.RulesEventEndTurn&&C(e.RulesEventEndTurn),e.BoardState&&await _(e.BoardState)}}(),console.log("Viewer onMount queue started"),()=>console.log("destroyed"))));let $=[M,D,D,async function(e,t){if(!t.IsOrderCompleted)return;let n=k(e.Order.CellFrom);if(n.ball.held=!1,await Q(),t.ResultType===xt){k(e.Order.CellTo.Cell).ball=n.ball,n.ball=null,await E()}},function(e){let t=k(e.Order.CellFrom);k(e.Order.CellTo.Cell).ball=t.ball,t.ball=null},async function(e){k(e.Order.CellTo.Cell).foul=!0,await E()},function(e,t){if(!t.IsOrderCompleted)return;let r,i;switch(Object.entries(y).forEach((([t,a])=>{a.cell&&(a.cell.target=null),a.player&&a.player.id==e.PlayerId&&(r=a.player,n(3,y[t]=a,y),i=t)})),t.RollType){case 3:1===t.ResultType&&(r.prone=!0);break;case 4:if(2===t.SubResultType)r.stunned=!0;else if(3===t.SubResultType){("home"==r.team?m.dugout:g.dugout).ko.push(r),n(3,y[i].player=null,y)}break;case 8:("home"==r.team?m.dugout:g.dugout).cas.push(r),n(3,y[i].player=null,y),n(3,y[i].blood={blood:Math.floor(4*Math.random()+1)},y)}},function(e){k(e.Order.CellTo.Cell).ball={held:!1}},function(e){k(e.Order.CellFrom).ball=null,k(e.Order.CellTo.Cell).ball={held:!1}},function(e,t){if(!t.IsOrderCompleted)return;if(0!==t.ResultType)return;Object.values(y).forEach((e=>e.ball=null)),k(e.Order.CellTo.Cell).ball={held:!0}},async function(){n(4,s="touchdown"),A(),await E(5),n(4,s=null),await Q()},function(e){let t=O(e.PlayerId);t.stunned=!1,t.prone=!0},K9,K9,function(e,t){t.IsOrderCompleted&&t.ResultType===xt&&Object.values(y).forEach((e=>{e.ball&&(e.ball.held=!0)}))},function(e,t){let n=k(e.Order.CellTo.Cell);if(t.ResultType===xt)n.player.stupidity=null;else{const e={[rn.BoneHead]:"BoneHeaded",[rn.ReallyStupid]:"Stupid",[rn.TakeRoot]:"Rooted"};n.player.stupidity=e[t.RollType]}},K9,K9,K9,K9,K9,function(e){M(e)},K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,K9,function(e){A(),Object.entries(y).forEach((([t,r])=>{r.cell&&(r.cell.active=!1),r.player&&(r.player.id==e.ActivePlayerId&&(r.cell||(r.cell={}),r.cell.active=!0,r.player.prone=!1),n(3,y[t]=r,y))}))},K9,K9,K9,K9,function(e,t){const r=J9(t.CoachChoices.ListDices);n(5,u={2:pt,3:mt,11:gt,12:yt}[r[0]+r[1]]||ht)},K9,K9,K9,K9,K9,K9,K9,K9,K9,C];async function E(e){var t;await Q(),await(t=r*(e||1),new Promise((e=>setTimeout(e,t))))}function A(){Object.entries(y).forEach((([e,t])=>{t.dice=null,t.cell=null,t.foul=!1,t.player&&(t.player.moving=!1),n(3,y[e]=t,y)}))}async function D(e,t){let n=k(e.Order.CellFrom);(n.cell=n.cell||{}).active=!0;let r=k(e.Order.CellTo.Cell),i=r.player;if(Object.values(y).forEach((e=>{e.dice=null})),t.RollType===rn.Block){let n=k(e.Order.CellTo.Cell);if(n.cell||(n.cell={}),n.cell.target=!0,t.IsOrderCompleted)n.dice=[J9(t.CoachChoices.ListDices)[0]];else{let e=J9(t.CoachChoices.ListDices);n.dice=e.slice(0,e.length/2)}await E(4)}if(t.RollType===rn.Push)if(t.IsOrderCompleted){Object.values(y).forEach((e=>{e.cell&&(e.cell.pushbackChoice=!1,e.cell.target=!1)}));let e=k(Y9(t.CoachChoices.ListCells.Cell)[0]);a&&(i=a),a=e.player?e.player:null,e.player=i,r.player=null}else Y9(t.CoachChoices.ListCells.Cell).forEach((e=>{let t=k(e);if(t.cell=t.cell||{},t.cell.pushbackChoice=!0,e.x<0||e.x>25||e.y<0||e.y>14)throw"Unexpected surf as a choice"}));if(t.RollType===rn.FollowUp&&t.IsOrderCompleted){const n=k(e.Order.CellFrom);k(Y9(t.CoachChoices.ListCells.Cell)[0]).player=n.player;n.player=null}}async function C(e){e.Turnover&&(n(4,s="turnover"),A(),await E(5),n(4,s=null),await Q())}function M(e,t){let n=O(e.PlayerId),r=k(e.Order.CellFrom),i=k(e.Order.CellTo.Cell);if(n.prone=!1,n.moving=!0,t.IsOrderCompleted&&i!=r&&(r.player=null,i.player=n),r.cell=r.cell||{},r.cell.moved=!0,r.cell.active=!1,t.IsOrderCompleted&&(i.cell=i.cell||{},i.cell.active=!0),t.RollType&&[rn.Dodge,rn.GFI,rn.Leap].includes(t.RollType)&&(i.cell=i.cell||{},i.cell.plus=t.Requirement),n.id==o&&(n.blitz=!0),r.ball){let e=r.ball;r.ball=null,i.ball=e}}return e.$$set=e=>{"replaySteps"in e&&n(11,c=e.replaySteps),"replayStepIndex"in e&&n(10,f=e.replayStepIndex),"replayStart"in e&&n(8,d=e.replayStart),"replayEnd"in e&&n(9,h=e.replayEnd)},e.$$.update=()=>{2816&e.$$.dirty[0]&&(i=[],console.log("About to reset queue",{replayStart:d,replayEnd:h}),n(8,d=d||0),n(9,h=Math.max(h||c.length,d+1)),console.log("Resetting queue",{replayStart:d,replayEnd:h,queue:c.slice(d,h)}))},[p,m,g,y,s,u,b,x,d,h,f,c]}class Z9 extends Ae{constructor(e){super(),Ee(this,e,Q9,G9,s,{replaySteps:11,replayStepIndex:10,replayStart:8,replayEnd:9},[-1,-1])}}function eee(e){let t,n;return t=new Va({}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function tee(e){let t,n;return t=new Ka({}),{c(){Oe(t.$$.fragment)},m(e,r){Se(t,e,r),n=!0},i(e){n||(de(t.$$.fragment,e),n=!0)},o(e){he(t.$$.fragment,e),n=!1},d(e){$e(t,e)}}}function nee(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,_,O,$;function E(t){e[9].call(null,t)}function A(t){e[10].call(null,t)}r=new Ga({props:{gameDetails:e[0].gameDetails,filename:e[0].fullReplay.filename}});let D={rolls:e[0].rolls,replayStepIndex:e[3]};function M(t){e[11].call(null,t)}void 0!==e[4]&&(D.replayStart=e[4]),void 0!==e[5]&&(D.replayEnd=e[5]),s=new t8({props:D}),H.push((()=>ke(s,"replayStart",E))),H.push((()=>ke(s,"replayEnd",A)));let j={replaySteps:e[0]&&e[0].fullReplay.ReplayStep,replayStart:e[4],replayEnd:e[5]};function F(t){e[12].call(null,t)}function T(t){e[13].call(null,t)}void 0!==e[3]&&(j.replayStepIndex=e[3]),f=new Z9({props:j}),H.push((()=>ke(f,"replayStepIndex",M)));let N={rolls:e[0].rolls,replayStepIndex:e[3]};return void 0!==e[4]&&(N.replayStart=e[4]),void 0!==e[5]&&(N.replayEnd=e[5]),m=new qo({props:N}),H.push((()=>ke(m,"replayStart",F))),H.push((()=>ke(m,"replayEnd",T))),O=new Ya({}),{c(){t=k("div"),n=k("div"),Oe(r.$$.fragment),i=S(),a=k("div"),o=k("div"),Oe(s.$$.fragment),c=S(),Oe(f.$$.fragment),h=S(),p=k("div"),Oe(m.$$.fragment),v=S(),_=k("div"),Oe(O.$$.fragment),C(n,"class","row"),C(o,"class","col-8"),C(p,"class","col-4"),C(a,"class","row"),C(t,"class","container-fluid"),C(t,"role","main"),C(_,"class","container"),C(_,"role","main")},m(e,l){x(e,t,l),b(t,n),Se(r,n,null),b(t,i),b(t,a),b(a,o),Se(s,o,null),b(o,c),Se(f,o,null),b(a,h),b(a,p),Se(m,p,null),x(e,v,l),x(e,_,l),Se(O,_,null),$=!0},p(e,t){const n={};1&t&&(n.gameDetails=e[0].gameDetails),1&t&&(n.filename=e[0].fullReplay.filename),r.$set(n);const i={};1&t&&(i.rolls=e[0].rolls),8&t&&(i.replayStepIndex=e[3]),!l&&16&t&&(l=!0,i.replayStart=e[4],ee((()=>l=!1))),!u&&32&t&&(u=!0,i.replayEnd=e[5],ee((()=>u=!1))),s.$set(i);const a={};1&t&&(a.replaySteps=e[0]&&e[0].fullReplay.ReplayStep),16&t&&(a.replayStart=e[4]),32&t&&(a.replayEnd=e[5]),!d&&8&t&&(d=!0,a.replayStepIndex=e[3],ee((()=>d=!1))),f.$set(a);const o={};1&t&&(o.rolls=e[0].rolls),8&t&&(o.replayStepIndex=e[3]),!g&&16&t&&(g=!0,o.replayStart=e[4],ee((()=>g=!1))),!y&&32&t&&(y=!0,o.replayEnd=e[5],ee((()=>y=!1))),m.$set(o)},i(e){$||(de(r.$$.fragment,e),de(s.$$.fragment,e),de(f.$$.fragment,e),de(m.$$.fragment,e),de(O.$$.fragment,e),$=!0)},o(e){he(r.$$.fragment,e),he(s.$$.fragment,e),he(f.$$.fragment,e),he(m.$$.fragment,e),he(O.$$.fragment,e),$=!1},d(e){e&&w(t),$e(r),$e(s),$e(f),$e(m),e&&w(v),e&&w(_),$e(O)}}}function ree(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,v,_,O,$,E,A,D,M,j,F,T,N;g=new a8({}),$=new r8({}),A=new qa({}),A.$on("replayLoaded",e[6]),A.$on("replayLoading",e[7]),A.$on("replayError",e[8]);let R=e[1]&&eee(),P=e[2]&&tee(),z=e[0]&&nee(e);return{c(){t=k("meta"),n=k("meta"),r=k("meta"),i=k("meta"),a=k("meta"),o=k("meta"),s=k("meta"),l=k("meta"),u=k("meta"),c=k("meta"),f=k("meta"),d=k("link"),h=k("link"),p=S(),m=k("body"),Oe(g.$$.fragment),y=S(),v=k("div"),_=k("div"),O=k("div"),Oe($.$$.fragment),E=S(),Oe(A.$$.fragment),D=S(),R&&R.c(),M=S(),P&&P.c(),j=S(),z&&z.c(),F=S(),T=k("footer"),T.innerHTML='<div class="container svelte-n2fmn3"><p class="text-muted svelte-n2fmn3">This website is under active development. If you notice issues, please\n          post the replay and a description of the problem to\n          <a href="https://github.com/cpennington/dicedornot/issues">Diced Or Not Issues</a>.</p></div>',C(t,"charset","utf-8"),C(n,"http-equiv","x-ua-compatible"),C(n,"content","ie=edge"),C(r,"name","viewport"),C(r,"content","width=device-width, initial-scale=1.0"),C(i,"property","og:title"),C(i,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),C(a,"property","og:type"),C(a,"content","website"),C(o,"property","og:url"),C(o,"content","http://vengefulpickle.com/DicedOrNot"),C(s,"property","og:description"),C(s,"content","Blood Bowl 2 replay and luck analyzer. Use it to decide whether you actually got diced."),C(l,"name","twitter:card"),C(l,"content","summary"),C(u,"name","twitter:url"),C(u,"content","http://vengefulpickle.com/DicedOrNot"),C(c,"name","twitter:title"),C(c,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),C(f,"name","twitter:description"),C(f,"content","Blood Bowl 2 replay luck analyzer. Use it to decide whether you actually got diced."),document.title="Diced or Not? - Blood Bowl 2 Replay Luck Analyzer",C(d,"rel","stylesheet"),C(d,"href","https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"),C(d,"integrity","sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="),C(d,"crossorigin","anonymous"),C(h,"rel","stylesheet"),C(h,"href","https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/css/jquery.dataTables.min.css"),C(h,"integrity","sha256-YY1izqyhIj4W3iyJOaGWOpXDSwrHWFL4Nfk+W0LyCHE="),C(h,"crossorigin","anonymous"),C(O,"class","jumbotron svelte-n2fmn3"),C(_,"class","container-flex"),C(T,"class","footer svelte-n2fmn3"),C(T,"id","contact"),C(v,"id","content"),C(v,"class","svelte-n2fmn3")},m(e,w){b(document.head,t),b(document.head,n),b(document.head,r),b(document.head,i),b(document.head,a),b(document.head,o),b(document.head,s),b(document.head,l),b(document.head,u),b(document.head,c),b(document.head,f),b(document.head,d),b(document.head,h),x(e,p,w),x(e,m,w),Se(g,m,null),b(m,y),b(m,v),b(v,_),b(_,O),Se($,O,null),b(O,E),Se(A,O,null),b(_,D),R&&R.m(_,null),b(_,M),P&&P.m(_,null),b(v,j),z&&z.m(v,null),b(v,F),b(v,T),N=!0},p(e,[t]){e[1]?R?2&t&&de(R,1):(R=eee(),R.c(),de(R,1),R.m(_,M)):R&&(ce(),he(R,1,1,(()=>{R=null})),fe()),e[2]?P?4&t&&de(P,1):(P=tee(),P.c(),de(P,1),P.m(_,null)):P&&(ce(),he(P,1,1,(()=>{P=null})),fe()),e[0]?z?(z.p(e,t),1&t&&de(z,1)):(z=nee(e),z.c(),de(z,1),z.m(v,F)):z&&(ce(),he(z,1,1,(()=>{z=null})),fe())},i(e){N||(de(g.$$.fragment,e),de($.$$.fragment,e),de(A.$$.fragment,e),de(R),de(P),de(z),N=!0)},o(e){he(g.$$.fragment,e),he($.$$.fragment,e),he(A.$$.fragment,e),he(R),he(P),he(z),N=!1},d(e){w(t),w(n),w(r),w(i),w(a),w(o),w(s),w(l),w(u),w(c),w(f),w(d),w(h),e&&w(p),e&&w(m),$e(g),$e($),$e(A),R&&R.d(),P&&P.d(),z&&z.d()}}}function iee(e,t,n){let r,i,a,o=!1,s=!1,l=0;return e.$$.update=()=>{1&e.$$.dirty&&console.log("Replay",r)},[r,o,s,l,i,a,e=>{n(1,o=!1),n(0,r=e.detail),n(4,i=null),n(5,a=null),console.log(e)},()=>{n(0,r=null),n(2,s=!1),n(1,o=!0)},()=>{n(1,o=!1),n(2,s=!0),n(0,r=null)},function(e){i=e,n(4,i)},function(e){a=e,n(5,a)},function(e){l=e,n(3,l)},function(e){i=e,n(4,i)},function(e){a=e,n(5,a)}]}return new class extends Ae{constructor(e){super(),Ee(this,e,iee,ree,s,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
