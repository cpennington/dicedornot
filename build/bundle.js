var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function r(){return Object.create(null)}function i(e){e.forEach(n)}function a(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function s(e,n,r,i){return e[1]&&i?t(r.ctx.slice(),e[1](i(n))):r.ctx}function l(e,t,n,r,i,a,o){const l=function(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}(t,r,i,a);if(l){const i=s(t,n,r,o);e.p(i,l)}}function u(e){return null==e?"":e}function c(e,t){e.appendChild(t)}function f(e,t,n){e.insertBefore(t,n||null)}function d(e){e.parentNode.removeChild(e)}function h(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function p(e){return document.createElement(e)}function m(e){return document.createTextNode(e)}function g(){return m(" ")}function y(){return m("")}function v(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function b(e){return function(t){return t.preventDefault(),e.call(this,t)}}function x(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function w(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function _(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function k(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function O(e,t,n){e.classList[n?"add":"remove"](t)}let S;function E(e){S=e}function $(){if(!S)throw new Error("Function called outside component initialization");return S}function A(e){$().$$.on_mount.push(e)}function D(){const e=$();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const i=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);r.slice().forEach((t=>{t.call(e,i)}))}}}function C(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}const M=[],j=[],F=[],T=[],N=Promise.resolve();let R=!1;function P(){R||(R=!0,N.then(U))}function z(){return P(),N}function B(e){F.push(e)}function L(e){T.push(e)}let I=!1;const q=new Set;function U(){if(!I){I=!0;do{for(let e=0;e<M.length;e+=1){const t=M[e];E(t),V(t.$$)}for(E(null),M.length=0;j.length;)j.pop()();for(let e=0;e<F.length;e+=1){const t=F[e];q.has(t)||(q.add(t),t())}F.length=0}while(M.length);for(;T.length;)T.pop()();R=!1,I=!1,q.clear()}}function V(e){if(null!==e.fragment){e.update(),i(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(B)}}const W=new Set;let H;function G(){H={r:0,c:[],p:H}}function X(){H.r||i(H.c),H=H.p}function Y(e,t){e&&e.i&&(W.delete(e),e.i(t))}function J(e,t,n,r){if(e&&e.o){if(W.has(e))return;W.add(e),H.c.push((()=>{W.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const K="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function Q(e,t){e.d(1),t.delete(e.key)}function Z(e,t){J(e,1,1,(()=>{t.delete(e.key)}))}function ee(e,t,n,r,i,a,o,s,l,u,c,f){let d=e.length,h=a.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,v=new Map;for(p=h;p--;){const e=f(i,a,p),s=n(e);let l=o.get(s);l?r&&l.p(e,t):(l=u(s,e),l.c()),y.set(s,g[p]=l),s in m&&v.set(s,Math.abs(p-m[s]))}const b=new Set,x=new Set;function w(e){Y(e,1),e.m(s,c),o.set(e.key,e),c=e.first,h--}for(;d&&h;){const t=g[h-1],n=e[d-1],r=t.key,i=n.key;t===n?(c=t.first,d--,h--):y.has(i)?!o.has(r)||b.has(r)?w(t):x.has(i)?d--:v.get(r)>v.get(i)?(x.add(r),w(t)):(b.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;h;)w(g[h-1]);return g}function te(e,t){const n={},r={},i={$$scope:1};let a=e.length;for(;a--;){const o=e[a],s=t[a];if(s){for(const e in o)e in s||(r[e]=1);for(const e in s)i[e]||(n[e]=s[e],i[e]=1);e[a]=s}else for(const e in o)i[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}function ne(e){return"object"==typeof e&&null!==e?e:{}}function re(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function ie(e){e&&e.c()}function ae(e,t,r){const{fragment:o,on_mount:s,on_destroy:l,after_update:u}=e.$$;o&&o.m(t,r),B((()=>{const t=s.map(n).filter(a);l?l.push(...t):i(t),e.$$.on_mount=[]})),u.forEach(B)}function oe(e,t){const n=e.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function se(t,n,a,o,s,l,u=[-1]){const c=S;E(t);const f=n.props||{},h=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:u,skip_bound:!1};let p=!1;if(h.ctx=a?a(t,f,((e,n,...r)=>{const i=r.length?r[0]:n;return h.ctx&&s(h.ctx[e],h.ctx[e]=i)&&(!h.skip_bound&&h.bound[e]&&h.bound[e](i),p&&function(e,t){-1===e.$$.dirty[0]&&(M.push(e),P(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],h.update(),p=!0,i(h.before_update),h.fragment=!!o&&o(h.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);h.fragment&&h.fragment.l(e),e.forEach(d)}else h.fragment&&h.fragment.c();n.intro&&Y(t.$$.fragment),ae(t,n.target,n.anchor),U()}E(c)}class le{$destroy(){oe(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ue=function(e,t){JSZip.loadAsync(e).then((e=>{e.forEach(((e,n)=>{n.async("string").then((e=>{var n=parser.parse(e,{ignoreAttributes:!0});console.log(n),t(n)}))}))}))},ce=6,fe=7,de=12,he=13,pe=15,me=16,ge=17,ye=20,ve=21,be=22,xe=26,we=27,_e=30,ke=31,Oe=33,Se=34,Ee=38,$e=40,Ae=41,De=47,Ce=48,Me=49,je=51,Fe=56,Te=57,Ne=58,Re=59,Pe=60,ze=61,Be=64,Le=67,Ie=68,qe=74,Ue=75,Ve={[1]:"Strip Ball",[2]:"ST+",[3]:"AG+",[4]:"MA+",[5]:"AV+",[ce]:"Catch",[fe]:"Dodge",[8]:"Sprint",[9]:"Pass Block",[10]:"Foul Appearance",[11]:"Leap",[de]:"Extra Arms",[he]:"Mighty Blow",[14]:"Leader",[pe]:"Horns",[me]:"Two-Heads",[ge]:"Stand Firm",[18]:"Always Hungry",[19]:"Regeneration",[ye]:"Take Root",[ve]:"Accurate",[be]:"Break Tackle",[23]:"Sneaky Git",[25]:"Chainsaw",[xe]:"Dauntless",[we]:"Dirty Player",[28]:"Diving Catch",[29]:"Dump-Off",[_e]:"Block",[ke]:"Bone-Head",[32]:"Very Long Legs",[Oe]:"Disturbing Presence",[Se]:"Diving Tackle",[35]:"Fend",[36]:"Frenzy",[37]:"Grab",[Ee]:"Guard",[39]:"Hail-Mary Pass",[$e]:"Juggernaut",[Ae]:"Jump-Up",[44]:"Loner",[45]:"Nerves Of Steel",[46]:"No Hands",[De]:"Pass",[Ce]:"Piling On",[Me]:"Prehensile Tail",[50]:"Pro",[je]:"Really Stupid",[52]:"Right Stuff",[53]:"Safe Throw",[54]:"Secret Weapon",[55]:"Shadowing",[Fe]:"Side Step",[Te]:"Tackle",[Ne]:"Strong Arm",[Re]:"Stunty",[Pe]:"Sure Feet",[ze]:"Sure Hands",[63]:"Thick Skull",[Be]:"Throw Team Mate",[Le]:"Wild Animal",[Ie]:"Wrestle",[69]:"Tentacles",[70]:"Multiple Block",[71]:"Kick",[72]:"Kick-Off Return",[qe]:"Big Hand",[Ue]:"Claw",[76]:"Ball and Chain",[77]:"Stab",[78]:"Hypnotic Gaze",[79]:"Stakes",[80]:"Bombardier",[81]:"Decay",[82]:"Nurgles Rot",[83]:"Titchy",[84]:"Blood-Lust",[85]:"Fan Favourite",[86]:"Animosity"},We={Active:void 0,Reserves:1,SentOff:5,KO:2,Casualty:4},He={NoStatus:0,RerollTaken:1,RerollNotTaken:2,RerollWithSkill:3,Reroll4:4},Ge=0,Xe=1,Ye=2,Je=3,Ke=4,Qe=1,Ze=5,et=2,tt=1,nt=35,rt=57,it="AD",at="BD",ot="P",st="DS",lt="DD",ut={0:it,1:at,2:ot,3:st,4:lt},ct=1,ft=2,dt=3,ht=4,pt=5,mt=6,gt=7,yt=8,vt=9,bt=10,xt=12,wt=13,_t=14,kt=15,Ot=16,St=17,Et=18,$t=20,At=21,Dt=22,Ct=24,Mt=25,jt=33,Ft={[wt]:"Amazon",[Ct]:"Bretonnian",[yt]:"Chaos",[At]:"Chaos Dwarf",[jt]:"Chaos Pact",[vt]:"Dark Elf",[ft]:"Dwarf",[mt]:"Goblin",[kt]:"High Elf",[ct]:"Human",[Ot]:"Khemri",[Mt]:"Kislev",[pt]:"Lizardman",[St]:"Necromantic",[xt]:"Norse",[Et]:"Nurgle",[ht]:"Orc",[_t]:"Pro Elf",[dt]:"Skaven",[bt]:"Undead",[Dt]:"Underworld",[$t]:"Vampire",[gt]:"Wood Elf"},Tt={[wt]:"amazon",[Ct]:"bretonnia",[yt]:"chaos",[At]:"chaosdwarf",[jt]:"chaospact",[vt]:"darkelf",[ft]:"dwarf",[mt]:"goblin",[kt]:"highelf",[ct]:"human",[Ot]:"khemri",[Mt]:"kislev",[pt]:"lizardman",[St]:"necromantic",[xt]:"norse",[Et]:"nurgle",[ht]:"orc",[_t]:"proelf",[dt]:"skaven",[bt]:"undead",[Dt]:"underworld",[$t]:"vampire",[gt]:"woodelf"};const Nt=[{},{dice:38,icon:"BadlyHurt",result:"Badly Hurt",effect:"No long term effect"},{dice:41,icon:"BrokenRibs",result:"Broken Rib",effect:"Miss next game "},{dice:42,icon:"GroinStrain",result:"Groin Strain",effect:"Miss next game "},{dice:43,icon:"GougedEye",result:"Gouged Eye",effect:"Miss next game"},{dice:44,icon:"BrokenJaw",result:"Broken Jaw",effect:"Miss next game "},{dice:45,icon:"FracturedArm",result:"Fractured Arm",effect:"Miss next game "},{dice:46,icon:"FracturedLeg",result:"Fractured Leg",effect:"Miss next game "},{dice:47,icon:"SmashedHand",result:"Smashed Hand ",effect:"Miss next game "},{dice:48,icon:"PinchedNerve",result:"Pinched Nerve",effect:"Miss next game "},{dice:51,icon:"NigglingInjury2",result:"Damaged Back",effect:"Niggling Injury"},{dice:52,icon:"NigglingInjury2",result:"Smashed Knee",effect:"Niggling Injury"},{dice:53,icon:"MovementBust",result:"Smashed Hip",effect:"-1 MA"},{dice:54,icon:"MovementBust",result:"Smashed Ankle",effect:"-1 MA"},{dice:55,icon:"ArmourBust",result:"Serious Concussion",effect:"-1 AV"},{dice:56,icon:"ArmourBust",result:"Fractured Skull",effect:"-1 AV"},{dice:57,icon:"AgilityBust",result:"Broken Neck",effect:"-1 AG"},{dice:58,icon:"StrengthBust",result:"Smashed Collar Bone",effect:"-1 ST"},{dice:61,icon:"Dead",result:"Dead",effect:"Dead!"}],Rt={GFI:1,Dodge:2,Armor:3,Injury:4,Block:5,StandUp:6,Pickup:7,Casualty:8,Catch:9,KickoffScatter:10,ThrowIn:11,Pass:12,Push:13,FollowUp:14,FoulPenalty:15,Interception:16,WakeUp:17,TouchBack:19,BoneHead:20,ReallyStupid:21,WildAnimal:22,Loner:23,Landing:24,Regeneration:25,InaccuratePassScatter:26,AlwaysHungryRoll:27,EatTeammate:28,Dauntless:29,SafeThrow:30,JumpUp:31,Shadowing:32,Stab:34,Leap:36,FoulAppearance:37,Tentacles:38,ChainsawKickback:39,TakeRoot:40,BallAndChain:41,HailMaryPass:42,DivingTackle:44,Pro:45,HypnoticGaze:46,Animosity:49,Bloodlust:50,Bite:51,Bribe:52,Fireball:54,LightningBolt:55,ThrowTeammate:56,Multiblock:57,KickoffGust:58,PileOnArmorRoll:59,PileOnInjuryRoll:60,Wrestle2:61,DodgePick:62,StandFirm:63,Juggernaut:64,StandFirm2:65,RaiseDead:66,Fans:69,Weather:70,SwealteringHeat:71,BombKD:72,ChainsawArmor:73};function Pt(e){return null!=e&&"function"==typeof e[Symbol.iterator]}class zt{constructor(e){this.name=e}named(e){return this.name=e,this}_flat(){throw new Error("${this.constructor}._flat() missing implementation")}get flat(){return Object.defineProperty(this,"flat",{value:Object.values(this._flat().reduce(((e,t)=>{const n=e[`${t.name}-${t.value}`];return n?n.weight+=t.weight:e[`${t.name}-${t.value}`]=t,e}),{}))}),this.flat}get cdf(){Object.defineProperty(this,"cdf",{value:this.flat.sort(((e,t)=>e.value-t.value)).reduce(((e,t)=>(e.push({weight:e[e.length-1].weight+t.weight,value:t.value}),e)))})}sample(){var e=Math.random();for(const t of this.flat){if(t.weight>e)return t.value;e-=t.weight}return this.flat[this.flat.length-1].value}get singularValue(){const e=this.flat;if(e.length>1)throw new Error("Distribution doesn't have a singular value");return e[0].value}get isSingularValue(){return 1==this.flat.length}get expectedValue(){return Object.defineProperty(this,"expectedValue",{value:this.flat.reduce(((e,t)=>e+t.value*t.weight),0)}),this.expectedValue}add(...e){return(e=e.filter((e=>null!==e))).length>0?new qt([this,...e]):this}product(...e){return(e=e.filter((e=>null!==e))).length>0?new Ut([this,...e]):this}divide(e){return new Vt(this,e)}subtract(e){return new Wt(this,e)}get valueString(){return`[${this.isSingularValue?"V":"EV"}=${this.valueOf().toFixed(2)}]`}valueOf(){return this.expectedValue}max(...e){var t=this;for(var n of e)n.expectedValue>t.expectedValue&&(t=n);return t}min(...e){var t=this;for(var n of e)n.expectedValue<t.expectedValue&&(t=n);return t}}class Bt extends zt{constructor(e,t){super(t);const n=e.map((e=>e.weight)).reduce(((e,t)=>e+t));e.forEach((e=>{e.weight/=n})),this.values=Object.values(e.reduce(((e,t)=>{const n=e[`${t.name}`];if(n){if(n.value!=t.value)throw new Error("Inconsistent values passed to SimpleDistribution");n.weight+=t.weight}else e[`${t.name}`]=t;return e}),{}))}_flat(){return this.values.flatMap((e=>e.value instanceof zt?e.value.flat.map((t=>({name:`${e.name} → ${t.name}`,weight:e.weight*t.weight,value:t.value}))):e))}}class Lt extends zt{constructor(e,t){super(e),this.value=t}_flat(){return this.value instanceof zt?this.value.flat.map((e=>({name:`${this.name} → ${e.name}`,weight:e.weight,value:e.value}))):[{name:this.name,weight:1,value:this.value}]}}class It extends zt{constructor(e,t,n,r,i){if(super(i),this.valFunc=e,this.nameFunc=t,this.distFuncName=n,!Pt(r))throw new Error("values not iterable",r);if(0==r.length)throw new Error("empty values list",r);this.values=r}_combine(e,t){return e instanceof zt?e[this.distFuncName](t):t instanceof zt?t[this.distFuncName](e):this.valFunc(e,t)}_flat(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();t=t?t instanceof zt?new Bt(n instanceof zt?t.flat.flatMap((e=>n.flat.map((t=>({name:this.name||this.nameFunc(e.name,t.name),weight:e.weight*t.weight,value:this.valFunc(e.value,t.value)}))))):t.flat.map((e=>({name:this.name||this.nameFunc(e.name,n),value:this.valFunc(e.value,n),weight:e.weight}))),this.name):n instanceof zt?new Bt(n.flat.map((e=>({name:this.name||this.nameFunc(t,e.name),value:this.valFunc(t,e.value),weight:e.weight}))),this.name):new Lt(this.name||this.nameFunc(t,n),this.valFunc(t,n)):n}return t.flat}}class qt extends It{constructor(e,t){super(((e,t)=>e+t),((e,t)=>`${e} + ${t}`),"add",e,t)}}class Ut extends It{constructor(e,t){super(((e,t)=>e*t),((e,t)=>`${e} * ${t}`),"product",e,t)}}class Vt extends It{constructor(e,t,n){super(((e,t)=>e/t),((e,t)=>`${e} / ${t}`),"divide",[e,t],n)}}class Wt extends It{constructor(e,t,n){super(((e,t)=>e-t),((e,t)=>`${e} - ${t}`),"subtract",[e,t],n)}}class Ht extends zt{constructor(e,t,n){if(super(n),!Pt(t))throw new Error("values not iterable",t);if(0==t.length)throw new Error("empty values list",t);this.better=e,this.values=t}_simple(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();if(t){if(!(t instanceof Bt&&n instanceof Bt))throw new Error("Can only compare simple distributions");t=new Bt(t.values.flatMap((e=>n.values.map((t=>({name:this.better(e.value,t.value)?e.name:t.name,weight:e.weight*t.weight,value:this.better(e.value,t.value)?e.value:t.value}))))))}else t=n}return t}get simple(){return Object.defineProperty(this,"simple",{value:this._simple().named(this.name)}),console.assert(Math.abs(this.simple.expectedValue-this.expectedValue)<1e-4,this),this.simple}_flat(){return this._simple().flat}}class Gt extends Ht{constructor(e,t){super(((e,t)=>e>t),e,t)}}class Xt extends Ht{constructor(e,t){super(((e,t)=>e<t),e,t)}}function Yt(e,t,n,r){n=n||"value",r=r||"weight";const i=e.sort(((e,t)=>e[n]-t[n])),a=e.reduce(((e,t)=>e+t[r]),0);for(var o=0;t>1e-8&&o<i.length;)(t-=i[o][r]/a)>1e-8&&o++;return i[o][n]}var Jt="1.12.0",Kt="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},Qt=Array.prototype,Zt=Object.prototype,en="undefined"!=typeof Symbol?Symbol.prototype:null,tn=Qt.push,nn=Qt.slice,rn=Zt.toString,an=Zt.hasOwnProperty,on="undefined"!=typeof ArrayBuffer,sn="undefined"!=typeof DataView,ln=Array.isArray,un=Object.keys,cn=Object.create,fn=on&&ArrayBuffer.isView,dn=isNaN,hn=isFinite,pn=!{toString:null}.propertyIsEnumerable("toString"),mn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],gn=Math.pow(2,53)-1;function yn(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var a=Array(t+1);for(i=0;i<t;i++)a[i]=arguments[i];return a[t]=r,e.apply(this,a)}}function vn(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function bn(e){return void 0===e}function xn(e){return!0===e||!1===e||"[object Boolean]"===rn.call(e)}function wn(e){var t="[object "+e+"]";return function(e){return rn.call(e)===t}}var _n=wn("String"),kn=wn("Number"),On=wn("Date"),Sn=wn("RegExp"),En=wn("Error"),$n=wn("Symbol"),An=wn("ArrayBuffer"),Dn=wn("Function"),Cn=Kt.document&&Kt.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Cn&&(Dn=function(e){return"function"==typeof e||!1});var Mn=Dn,jn=wn("Object"),Fn=sn&&jn(new DataView(new ArrayBuffer(8))),Tn="undefined"!=typeof Map&&jn(new Map),Nn=wn("DataView");var Rn=Fn?function(e){return null!=e&&Mn(e.getInt8)&&An(e.buffer)}:Nn,Pn=ln||wn("Array");function zn(e,t){return null!=e&&an.call(e,t)}var Bn=wn("Arguments");!function(){Bn(arguments)||(Bn=function(e){return zn(e,"callee")})}();var Ln=Bn;function In(e){return kn(e)&&dn(e)}function qn(e){return function(){return e}}function Un(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=gn}}function Vn(e){return function(t){return null==t?void 0:t[e]}}var Wn=Vn("byteLength"),Hn=Un(Wn),Gn=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var Xn=on?function(e){return fn?fn(e)&&!Rn(e):Hn(e)&&Gn.test(rn.call(e))}:qn(!1),Yn=Vn("length");function Jn(e,t){t=function(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(e){return t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=mn.length,r=e.constructor,i=Mn(r)&&r.prototype||Zt,a="constructor";for(zn(e,a)&&!t.contains(a)&&t.push(a);n--;)(a=mn[n])in e&&e[a]!==i[a]&&!t.contains(a)&&t.push(a)}function Kn(e){if(!vn(e))return[];if(un)return un(e);var t=[];for(var n in e)zn(e,n)&&t.push(n);return pn&&Jn(e,t),t}function Qn(e,t){var n=Kn(t),r=n.length;if(null==e)return!r;for(var i=Object(e),a=0;a<r;a++){var o=n[a];if(t[o]!==i[o]||!(o in i))return!1}return!0}function Zn(e){return e instanceof Zn?e:this instanceof Zn?void(this._wrapped=e):new Zn(e)}function er(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Wn(e))}Zn.VERSION=Jt,Zn.prototype.value=function(){return this._wrapped},Zn.prototype.valueOf=Zn.prototype.toJSON=Zn.prototype.value,Zn.prototype.toString=function(){return String(this._wrapped)};var tr="[object DataView]";function nr(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&rr(e,t,n,r)}function rr(e,t,n,r){e instanceof Zn&&(e=e._wrapped),t instanceof Zn&&(t=t._wrapped);var i=rn.call(e);if(i!==rn.call(t))return!1;if(Fn&&"[object Object]"==i&&Rn(e)){if(!Rn(t))return!1;i=tr}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return en.valueOf.call(e)===en.valueOf.call(t);case"[object ArrayBuffer]":case tr:return rr(er(e),er(t),n,r)}var a="[object Array]"===i;if(!a&&Xn(e)){if(Wn(e)!==Wn(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(Mn(o)&&o instanceof o&&Mn(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!nr(e[l],t[l],n,r))return!1}else{var u,c=Kn(e);if(l=c.length,Kn(t).length!==l)return!1;for(;l--;)if(!zn(t,u=c[l])||!nr(e[u],t[u],n,r))return!1}return n.pop(),r.pop(),!0}function ir(e){if(!vn(e))return[];var t=[];for(var n in e)t.push(n);return pn&&Jn(e,t),t}function ar(e){var t=Yn(e);return function(n){if(null==n)return!1;var r=ir(n);if(Yn(r))return!1;for(var i=0;i<t;i++)if(!Mn(n[e[i]]))return!1;return e!==cr||!Mn(n[or])}}var or="forEach",sr=["clear","delete"],lr=["get","has","set"],ur=sr.concat(or,lr),cr=sr.concat(lr),fr=["add"].concat(sr,or,"has"),dr=Tn?ar(ur):wn("Map"),hr=Tn?ar(cr):wn("WeakMap"),pr=Tn?ar(fr):wn("Set"),mr=wn("WeakSet");function gr(e){for(var t=Kn(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function yr(e){for(var t={},n=Kn(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function vr(e){var t=[];for(var n in e)Mn(e[n])&&t.push(n);return t.sort()}function br(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var a=arguments[i],o=e(a),s=o.length,l=0;l<s;l++){var u=o[l];t&&void 0!==n[u]||(n[u]=a[u])}return n}}var xr=br(ir),wr=br(Kn),_r=br(ir,!0);function kr(e){if(!vn(e))return{};if(cn)return cn(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Or(e){return vn(e)?Pn(e)?e.slice():xr({},e):e}function Sr(e){return Pn(e)?e:[e]}function Er(e){return Zn.toPath(e)}function $r(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function Ar(e,t,n){var r=$r(e,Er(t));return bn(r)?n:r}function Dr(e){return e}function Cr(e){return e=wr({},e),function(t){return Qn(t,e)}}function Mr(e){return e=Er(e),function(t){return $r(t,e)}}function jr(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,a){return e.call(t,n,r,i,a)}}return function(){return e.apply(t,arguments)}}function Fr(e,t,n){return null==e?Dr:Mn(e)?jr(e,t,n):vn(e)&&!Pn(e)?Cr(e):Mr(e)}function Tr(e,t){return Fr(e,t,1/0)}function Nr(e,t,n){return Zn.iteratee!==Tr?Zn.iteratee(e,t):Fr(e,t,n)}function Rr(){}function Pr(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}Zn.toPath=Sr,Zn.iteratee=Tr;var zr=Date.now||function(){return(new Date).getTime()};function Br(e){var t=function(t){return e[t]},n="(?:"+Kn(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}}var Lr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Ir=Br(Lr),qr=Br(yr(Lr)),Ur=Zn.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},Vr=/(.)^/,Wr={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Hr=/\\|'|\r|\n|\u2028|\u2029/g;function Gr(e){return"\\"+Wr[e]}var Xr=0;function Yr(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var a=kr(e.prototype),o=e.apply(a,i);return vn(o)?o:a}var Jr=yn((function(e,t){var n=Jr.placeholder,r=function(){for(var i=0,a=t.length,o=Array(a),s=0;s<a;s++)o[s]=t[s]===n?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return Yr(e,r,this,this,o)};return r}));Jr.placeholder=Zn;var Kr=yn((function(e,t,n){if(!Mn(e))throw new TypeError("Bind must be called on a function");var r=yn((function(i){return Yr(e,r,t,this,n.concat(i))}));return r})),Qr=Un(Yn);function Zr(e,t,n,r){if(r=r||[],t||0===t){if(t<=0)return r.concat(e)}else t=1/0;for(var i=r.length,a=0,o=Yn(e);a<o;a++){var s=e[a];if(Qr(s)&&(Pn(s)||Ln(s)))if(t>1)Zr(s,t-1,n,r),i=r.length;else for(var l=0,u=s.length;l<u;)r[i++]=s[l++];else n||(r[i++]=s)}return r}var ei=yn((function(e,t){var n=(t=Zr(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=Kr(e[r],e)}return e}));var ti=yn((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),ni=Jr(ti,Zn,1);function ri(e){return function(){return!e.apply(this,arguments)}}function ii(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var ai=Jr(ii,2);function oi(e,t,n){t=Nr(t,n);for(var r,i=Kn(e),a=0,o=i.length;a<o;a++)if(t(e[r=i[a]],r,e))return r}function si(e){return function(t,n,r){n=Nr(n,r);for(var i=Yn(t),a=e>0?0:i-1;a>=0&&a<i;a+=e)if(n(t[a],a,t))return a;return-1}}var li=si(1),ui=si(-1);function ci(e,t,n,r){for(var i=(n=Nr(n,r,1))(t),a=0,o=Yn(e);a<o;){var s=Math.floor((a+o)/2);n(e[s])<i?a=s+1:o=s}return a}function fi(e,t,n){return function(r,i,a){var o=0,s=Yn(r);if("number"==typeof a)e>0?o=a>=0?a:Math.max(a+s,o):s=a>=0?Math.min(a+1,s):a+s+1;else if(n&&a&&s)return r[a=n(r,i)]===i?a:-1;if(i!=i)return(a=t(nn.call(r,o,s),In))>=0?a+o:-1;for(a=e>0?o:s-1;a>=0&&a<s;a+=e)if(r[a]===i)return a;return-1}}var di=fi(1,li,ci),hi=fi(-1,ui);function pi(e,t,n){var r=(Qr(e)?li:oi)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function mi(e,t,n){var r,i;if(t=jr(t,n),Qr(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var a=Kn(e);for(r=0,i=a.length;r<i;r++)t(e[a[r]],a[r],e)}return e}function gi(e,t,n){t=Nr(t,n);for(var r=!Qr(e)&&Kn(e),i=(r||e).length,a=Array(i),o=0;o<i;o++){var s=r?r[o]:o;a[o]=t(e[s],s,e)}return a}function yi(e){var t=function(t,n,r,i){var a=!Qr(t)&&Kn(t),o=(a||t).length,s=e>0?0:o-1;for(i||(r=t[a?a[s]:s],s+=e);s>=0&&s<o;s+=e){var l=a?a[s]:s;r=n(r,t[l],l,t)}return r};return function(e,n,r,i){var a=arguments.length>=3;return t(e,jr(n,i,4),r,a)}}var vi=yi(1),bi=yi(-1);function xi(e,t,n){var r=[];return t=Nr(t,n),mi(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function wi(e,t,n){t=Nr(t,n);for(var r=!Qr(e)&&Kn(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(!t(e[o],o,e))return!1}return!0}function _i(e,t,n){t=Nr(t,n);for(var r=!Qr(e)&&Kn(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(t(e[o],o,e))return!0}return!1}function ki(e,t,n,r){return Qr(e)||(e=gr(e)),("number"!=typeof n||r)&&(n=0),di(e,t,n)>=0}var Oi=yn((function(e,t,n){var r,i;return Mn(t)?i=t:(t=Er(t),r=t.slice(0,-1),t=t[t.length-1]),gi(e,(function(e){var a=i;if(!a){if(r&&r.length&&(e=$r(e,r)),null==e)return;a=e[t]}return null==a?a:a.apply(e,n)}))}));function Si(e,t){return gi(e,Mr(t))}function Ei(e,t,n){var r,i,a=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=Qr(e)?e:gr(e)).length;s<l;s++)null!=(r=e[s])&&r>a&&(a=r);else t=Nr(t,n),mi(e,(function(e,n,r){((i=t(e,n,r))>o||i===-1/0&&a===-1/0)&&(a=e,o=i)}));return a}function $i(e,t,n){if(null==t||n)return Qr(e)||(e=gr(e)),e[Pr(e.length-1)];var r=Qr(e)?Or(e):gr(e),i=Yn(r);t=Math.max(Math.min(t,i),0);for(var a=i-1,o=0;o<t;o++){var s=Pr(o,a),l=r[o];r[o]=r[s],r[s]=l}return r.slice(0,t)}function Ai(e,t){return function(n,r,i){var a=t?[[],[]]:{};return r=Nr(r,i),mi(n,(function(t,i){var o=r(t,i,n);e(a,t,o)})),a}}var Di=Ai((function(e,t,n){zn(e,n)?e[n].push(t):e[n]=[t]})),Ci=Ai((function(e,t,n){e[n]=t})),Mi=Ai((function(e,t,n){zn(e,n)?e[n]++:e[n]=1})),ji=Ai((function(e,t,n){e[n?0:1].push(t)}),!0),Fi=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ti(e,t,n){return t in n}var Ni=yn((function(e,t){var n={},r=t[0];if(null==e)return n;Mn(r)?(t.length>1&&(r=jr(r,t[1])),t=ir(e)):(r=Ti,t=Zr(t,!1,!1),e=Object(e));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];r(s,o,e)&&(n[o]=s)}return n})),Ri=yn((function(e,t){var n,r=t[0];return Mn(r)?(r=ri(r),t.length>1&&(n=t[1])):(t=gi(Zr(t,!1,!1),String),r=function(e,n){return!ki(t,n)}),Ni(e,r,n)}));function Pi(e,t,n){return nn.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function zi(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:Pi(e,e.length-t)}function Bi(e,t,n){return nn.call(e,null==t||n?1:t)}var Li=yn((function(e,t){return t=Zr(t,!0,!0),xi(e,(function(e){return!ki(t,e)}))})),Ii=yn((function(e,t){return Li(e,t)}));function qi(e,t,n,r){xn(t)||(r=n,n=t,t=!1),null!=n&&(n=Nr(n,r));for(var i=[],a=[],o=0,s=Yn(e);o<s;o++){var l=e[o],u=n?n(l,o,e):l;t&&!n?(o&&a===u||i.push(l),a=u):n?ki(a,u)||(a.push(u),i.push(l)):ki(i,l)||i.push(l)}return i}var Ui=yn((function(e){return qi(Zr(e,!0,!0))}));function Vi(e){for(var t=e&&Ei(e,Yn).length||0,n=Array(t),r=0;r<t;r++)n[r]=Si(e,r);return n}var Wi=yn(Vi);function Hi(e,t){return e._chain?Zn(t).chain():t}function Gi(e){return mi(vr(e),(function(t){var n=Zn[t]=e[t];Zn.prototype[t]=function(){var e=[this._wrapped];return tn.apply(e,arguments),Hi(this,n.apply(Zn,e))}})),Zn}mi(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=Qt[e];Zn.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),Hi(this,n)}})),mi(["concat","join","slice"],(function(e){var t=Qt[e];Zn.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),Hi(this,e)}}));var Xi=Gi(Object.freeze({__proto__:null,VERSION:Jt,restArguments:yn,isObject:vn,isNull:function(e){return null===e},isUndefined:bn,isBoolean:xn,isElement:function(e){return!(!e||1!==e.nodeType)},isString:_n,isNumber:kn,isDate:On,isRegExp:Sn,isError:En,isSymbol:$n,isArrayBuffer:An,isDataView:Rn,isArray:Pn,isFunction:Mn,isArguments:Ln,isFinite:function(e){return!$n(e)&&hn(e)&&!isNaN(parseFloat(e))},isNaN:In,isTypedArray:Xn,isEmpty:function(e){if(null==e)return!0;var t=Yn(e);return"number"==typeof t&&(Pn(e)||_n(e)||Ln(e))?0===t:0===Yn(Kn(e))},isMatch:Qn,isEqual:function(e,t){return nr(e,t)},isMap:dr,isWeakMap:hr,isSet:pr,isWeakSet:mr,keys:Kn,allKeys:ir,values:gr,pairs:function(e){for(var t=Kn(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:yr,functions:vr,methods:vr,extend:xr,extendOwn:wr,assign:wr,defaults:_r,create:function(e,t){var n=kr(e);return t&&wr(n,t),n},clone:Or,tap:function(e,t){return t(e),e},get:Ar,has:function(e,t){for(var n=(t=Er(t)).length,r=0;r<n;r++){var i=t[r];if(!zn(e,i))return!1;e=e[i]}return!!n},mapObject:function(e,t,n){t=Nr(t,n);for(var r=Kn(e),i=r.length,a={},o=0;o<i;o++){var s=r[o];a[s]=t(e[s],s,e)}return a},identity:Dr,constant:qn,noop:Rr,toPath:Sr,property:Mr,propertyOf:function(e){return null==e?Rr:function(t){return Ar(e,t)}},matcher:Cr,matches:Cr,times:function(e,t,n){var r=Array(Math.max(0,e));t=jr(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:Pr,now:zr,escape:Ir,unescape:qr,templateSettings:Ur,template:function(e,t,n){!t&&n&&(t=n),t=_r({},t,Zn.templateSettings);var r,i=RegExp([(t.escape||Vr).source,(t.interpolate||Vr).source,(t.evaluate||Vr).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(i,(function(t,n,r,i,s){return o+=e.slice(a,s).replace(Hr,Gr),a=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t})),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return r.call(this,e,Zn)},l=t.variable||"obj";return s.source="function("+l+"){\n"+o+"}",s},result:function(e,t,n){var r=(t=Er(t)).length;if(!r)return Mn(n)?n.call(e):n;for(var i=0;i<r;i++){var a=null==e?void 0:e[t[i]];void 0===a&&(a=n,i=r),e=Mn(a)?a.call(e):a}return e},uniqueId:function(e){var t=++Xr+"";return e?e+t:t},chain:function(e){var t=Zn(e);return t._chain=!0,t},iteratee:Tr,partial:Jr,bind:Kr,bindAll:ei,memoize:function(e,t){var n=function(r){var i=n.cache,a=""+(t?t.apply(this,arguments):r);return zn(i,a)||(i[a]=e.apply(this,arguments)),i[a]};return n.cache={},n},delay:ti,defer:ni,throttle:function(e,t,n){var r,i,a,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:zr(),r=null,o=e.apply(i,a),r||(i=a=null)},u=function(){var u=zr();s||!1!==n.leading||(s=u);var c=t-(u-s);return i=this,a=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=u,o=e.apply(i,a),r||(i=a=null)):r||!1===n.trailing||(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),s=0,r=i=a=null},u},debounce:function(e,t,n){var r,i,a=function(t,n){r=null,n&&(i=e.apply(t,n))},o=yn((function(o){if(r&&clearTimeout(r),n){var s=!r;r=setTimeout(a,t),s&&(i=e.apply(this,o))}else r=ti(a,t,this,o);return i}));return o.cancel=function(){clearTimeout(r),r=null},o},wrap:function(e,t){return Jr(t,e)},negate:ri,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:ii,once:ai,findKey:oi,findIndex:li,findLastIndex:ui,sortedIndex:ci,indexOf:di,lastIndexOf:hi,find:pi,detect:pi,findWhere:function(e,t){return pi(e,Cr(t))},each:mi,forEach:mi,map:gi,collect:gi,reduce:vi,foldl:vi,inject:vi,reduceRight:bi,foldr:bi,filter:xi,select:xi,reject:function(e,t,n){return xi(e,ri(Nr(t)),n)},every:wi,all:wi,some:_i,any:_i,contains:ki,includes:ki,include:ki,invoke:Oi,pluck:Si,where:function(e,t){return xi(e,Cr(t))},max:Ei,min:function(e,t,n){var r,i,a=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=Qr(e)?e:gr(e)).length;s<l;s++)null!=(r=e[s])&&r<a&&(a=r);else t=Nr(t,n),mi(e,(function(e,n,r){((i=t(e,n,r))<o||i===1/0&&a===1/0)&&(a=e,o=i)}));return a},shuffle:function(e){return $i(e,1/0)},sample:$i,sortBy:function(e,t,n){var r=0;return t=Nr(t,n),Si(gi(e,(function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")},groupBy:Di,indexBy:Ci,countBy:Mi,partition:ji,toArray:function(e){return e?Pn(e)?nn.call(e):_n(e)?e.match(Fi):Qr(e)?gi(e,Dr):gr(e):[]},size:function(e){return null==e?0:Qr(e)?e.length:Kn(e).length},pick:Ni,omit:Ri,first:zi,head:zi,take:zi,initial:Pi,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:Bi(e,Math.max(0,e.length-t))},rest:Bi,tail:Bi,drop:Bi,compact:function(e){return xi(e,Boolean)},flatten:function(e,t){return Zr(e,t,!1)},without:Ii,uniq:qi,unique:qi,union:Ui,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=Yn(e);r<i;r++){var a=e[r];if(!ki(t,a)){var o;for(o=1;o<n&&ki(arguments[o],a);o++);o===n&&t.push(a)}}return t},difference:Li,unzip:Vi,transpose:Vi,zip:Wi,object:function(e,t){for(var n={},r=0,i=Yn(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),a=0;a<r;a++,e+=n)i[a]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(nn.call(e,r,r+=t));return n},mixin:Gi,default:Zn}));function Yi(e){return e&&e.length?e:e?[e]:[]}function Ji(e){return e[Math.floor(Math.random()*e.length)]}function Ki(e){for(var t=0,n=0;n<e;n++)t+=.9**n;return t}function Qi(e,t){return Math.max(Math.abs((e.x||0)-(t.x||0)),Math.abs((e.y||0)-(t.y||0)))}function Zi(e,t){var n;return n=0==e.id?25-(t.x||0):t.x||0,new Lt(`${n} to goal`,0==n?8:4*.85**(n-1))}Xi._=Xi;const ea="actual",ta="simulated";class na{team;playerState;constructor(e,t,n){this.team=e,this.id=t.Data.Id,this.name=t.Data.Name,this.cell=t.Cell,this.situation=t.Situation,this.playerState=t,this.canAct=1==t.CanAct&&this.situation===We.Active,this.skills=aa.translateStringNumberList(t.Data.ListSkills)||[],this.isBallCarrier=0==Qi(n.Ball.Cell,this.cell)&&1==n.Ball.IsHeld}get skillNames(){return this.skills.map((e=>Ve[e]))}}class ra{teamState;constructor(e,t){this.players=e.ListPitchPlayers.PlayerState.map((e=>new na(this,e,t))),this.name=e.Data.Name,this.id=e.Data.TeamId||0,this.turn=e.GameTurn||0}get shortName(){return this.name.split(/\s+/).map((e=>e[0])).join("")}}class ia{teams;activeTeam;turn;constructor({teams:e,activeTeamId:t,ballCell:n}){this.teams=e,this.activeTeam=e.filter((e=>e.id==t))[0]||e[0],this.turn=this.activeTeam&&this.activeTeam.turn||0,this.ballCell=n}static argsFromXml(e){const t={};return t.teams=e.ListTeams.TeamState.map((t=>new ra(t,e))),t.activeTeamId=e.ActiveTeam,t.ballCell=e.Ball.Cell,t}playerById(e){for(var t of this.teams)for(var n of t.players)if(n.id===e)return n}playerAtPosition(e){for(var t of this.teams)for(var n of t.players)if((n.cell.x||0)===(e.x||0)&&(n.cell.y||0)===(e.y||0))return n;console.log("No player found",{replayStep:this.replayStep,action:this.action,cell:e})}}class aa{static handledSkills=[];static diceSeparator=", ";constructor(e){Object.assign(this,e),this.onPitchValues={},this.onTeamValues={},this.armorRollCache={},this.dependentRolls=[],console.assert(!this.unhandledSkills||0==this.unhandledSkills.length,"Unhandled skills for roll",{roll:this,skills:this.unhandledSkills&&this.unhandledSkills.map((e=>Ve[e.SkillId])),rollName:this.rollName})}static argsFromXml(e){const t={};t.initialBoardState=new ia(ia.argsFromXml(e.initialBoard)),t.finalBoardState=new ia(ia.argsFromXml(e.replayStep.BoardState));var n=e.action.PlayerId;return t.activePlayer=t.initialBoardState.playerById(n),t.rollType=e.boardActionResult.RollType,t.dice=this.dice(e.boardActionResult),t.skillsInEffect=Yi(e.boardActionResult.CoachChoices.ListSkills.SkillInfo),t.unhandledSkills=t.skillsInEffect.filter((e=>!this.handledSkills.includes(e.SkillId))),t.ignore=this.ignore(e),t.actionType=e.action.ActionType,t.rollStatus=e.boardActionResult.RollStatus,t.resultType=e.boardActionResult.ResultType,t.subResultType=e.boardActionResult.SubResultType,t.stepIndex=e.stepIndex,t.resultIndex=e.resultIndex,t.actionIndex=e.actionIndex,t.isReroll=[He.RerollTaken,He.RerollWithSkill].includes(t.rollStatus),t}get activeTeam(){return this.finalBoardState.activeTeam}get teams(){return this.finalBoardState.teams}get turn(){return this.finalBoardState.turn}get rollName(){return this.constructor.rollName}get jointDescription(){return[this.description].concat(this.dependentRolls.map((e=>e.shortDescription||e.description))).join(" → ")}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice}`}get shortDescription(){return`${this.rollName}: ${this.activePlayer.name} - ${this.dice.join(this.constructor.diceSeparator)}`}isDependentRoll(e){return!1}value(e,t){throw"value must be defined by subclass"}get expectedValue(){return this.possibleOutcomes.expectedValue}get possibleOutcomes(){throw`possibleOutcomes must be defined by subclass ${this.constructor.name}`}simulateDice(){throw"simulateDice must be defined by subclass"}static ignore(e){return e.boardActionResult.RollStatus==He.RerollNotTaken||void 0===e.boardActionResult.CoachChoices.ListDices}static dice(e){return this.translateStringNumberList(e.CoachChoices.ListDices)}get actualValue(){const e=this.value(this.dice,!1);return e instanceof zt?e:new Lt(this.rollName,e)}get valueWithDependents(){return this.actualValue.add(...this.dependentRolls.map((e=>e.actualValue)))}get actual(){var e=this.dataPoint(-1,ea);const t=this.possibleOutcomes.flat.map((t=>({value:t.value-e.expectedValue,weight:t.weight})));return Object.assign(e,{turn:this.turn,player:this.activePlayer&&this.activePlayer.name||"",playerSkills:this.activePlayer&&this.activePlayer.skills.map((e=>Ve[e]))||[],rollName:this.rollName,dice:this.dice,dnvMin:Math.min(...t.map((e=>e.value))),dnvq33:Yt(t,.33,"value","weight"),dnvMed:Yt(t,.5,"value","weight"),dnvq67:Yt(t,.67,"value","weight"),dnvMax:Math.max(...t.map((e=>e.value))),outcomes:this.possibleOutcomes.flat.map((t=>t.value-e.expectedValue)),weights:this.possibleOutcomes.flat.map((e=>e.weight)),description:this.jointDescription,valueDescription:`${this.valueWithDependents.valueString} ${this.possibleOutcomes.valueString}`})}simulated(e){return this.dataPoint(e,ta)}dataPoint(e,t){var n;return t==ea?n=this.valueWithDependents.singularValue:t==ta&&(n=this.possibleOutcomes.sample()),{iteration:e,turn:this.turn,activeTeamId:this.activeTeam.id,activeTeamName:this.activeTeam.name,teamId:this.activePlayer?this.activePlayer.team.id:this.activeTeam.id,teamName:this.activePlayer?this.activePlayer.team.name:this.activeTeam.name,outcomeValue:n,type:t,expectedValue:this.expectedValue,netValue:n-this.expectedValue,rollIndex:this.rollIndex}}static translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}static fromReplayStep(e,t,n){for(var r=Yi(n.RulesEventBoardAction),i=[],a=0;a<r.length;a++){var o=r[a];i=i.concat(aa.fromAction(e,t,n,a,o))}return i}static fromAction(e,t,n,r,i){for(var a=Yi(i.Results.BoardActionResult),o=[],s=0;s<a.length;s++){var l=a[s],u=this.fromBoardActionResult(e,t,n,r,i,s,l);u&&o.push(u)}return 0==a.length&&console.warn("Unexpectedly missing boardactionresult",{stepIndex:t,replayStep:n,action:i}),o}static fromBoardActionResult(e,t,n,r,i,a,o){var s;return null===(s=void 0===o.RollType?da:ya[o.RollType])?null:s?new s(s.argsFromXml({initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o})):(console.warn("Unknown roll "+o.RollType,{initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o}),null)}onActiveTeam(e){return e.team.id===this.activeTeam.id}playerValue(e){var t=this.initialBoardState.ballCell;if((t.x||0)<0||(t.y||0)<0)return this.rawPlayerValue(e);var n=Qi(t,e.cell);return 0==n?this.rawPlayerValue(e).product(new Lt("On Ball",2)).named(`PV(${e.name})`):1==n?this.rawPlayerValue(e).product(new Lt("By Ball",1.5)).named(`PV(${e.name})`):this.rawPlayerValue(e)}rawPlayerValue(e){return new Lt(`TV(${e.name})`,1)}teamValue(e,t,n){return new qt(e.players.filter((e=>t.includes(e.situation)||e.id==n.id)).map((e=>this.playerValue(e))),`TV(${e.name})`)}get halfTurnsInGame(){var e=this.teams.map((e=>this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}get halfTurnsInHalf(){var e=this.teams.map((e=>this.turn<=8?8-e.turn:this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}stunTurns(e){return Math.min(this.onActiveTeam(e)?4:3,this.halfTurnsInHalf)}kdTurns(e){return Math.min(this.onActiveTeam(e)?2:1,this.halfTurnsInHalf)}onPitchValue(e){return this.onPitchValues[e.id]||(this.onPitchValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[We.Active],e).named(`TPV(${e.team.name})`)).named(`%PV(${e.name})`))}onTeamValue(e){return this.onTeamValues[e.id]||(this.onTeamValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[We.Active,We.Reserves,We.KO],e).named("Players on Team")).named(e.name))}armorRoll(e){return this.armorRollCache[e.id]||(this.armorRollCache[e.id]=new sa({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:e}))}knockdownValue(e,t){const n=this.onPitchValue(e);var r=this.kdTurns(e),i=Ki(r),a=[new Lt(`TDT(${r/2})`,i)];this.onActiveTeam(e)&&a.push(new Lt("On Active Team",-1));var o=n.product(...a).named(`KD(${e.name})`);return t&&(o=o.add(this.armorRoll(e).possibleOutcomes.named("Armor Roll"))),o}stunValue(e){var t=this.onPitchValue(e),n=this.stunTurns(e),r=Ki(n),i=[new Lt(`TDT(${n/2})`,r)];return this.onActiveTeam(e)&&i.push(new Lt("On Active Team",-1)),t.product(...i).named(`STUN(${e.name})`)}koValue(e){const t=this.onPitchValue(e);var n=this.halfTurnsInHalf,r=this.stunTurns(e),i=[new Lt(`TDT(${n-r})`,Ki(n)-Ki(r))];return this.onActiveTeam(e)&&i.push(new Lt("On Active Team",-1)),t.product(...i).named(`KO(${e.name})`)}casValue(e){const t=this.onTeamValue(e).product(new Lt(`TDT(${this.halfTurnsInGame/2})`,Ki(this.halfTurnsInGame))),n=this.onPitchValue(e).subtract(this.onTeamValue(e)).product(new Lt(`TDT(${this.halfTurnsInHalf/2})`,Ki(this.halfTurnsInHalf))),r=t.add(n).named(`PV(${e.name})`);var i=[];return this.onActiveTeam(e)&&i.push(new Lt("On Active Team",-1)),r.product(...i).subtract(this.stunValue(e)).named(`CAS(${e.name})`)}get dependentMoveValues(){const e=this.dependentRolls.filter((e=>e.constructor==da));return e.length>0?new qt(e.map((e=>e.value())),"Following Moves"):null}get unactivatedPlayers(){return Object.defineProperty(this,"unactivatedPlayers",{value:this.activeTeam.players.filter((e=>e.canAct))}),this.unactivatedPlayers}get turnoverValue(){const e=this.unactivatedPlayers.filter((e=>e!=this.activePlayer)).map((e=>this.onPitchValue(e)));var t;return t=e.length>0?new qt(e).named("Unactivated PV").product(-1).named("Turnover"):new Lt("No Active Players",0),Object.defineProperty(this,"turnoverValue",{value:t}),this.turnoverValue}get rerollValue(){return new Lt("Reroll",0)}}class oa extends aa{static numDice=1;static diceSeparator="+";static canCauseInjury=!1;static includeFollowingMoves=!0;constructor(e){super(e),console.assert(!this.computedTarget||!this.target||this.computedTarget==this.target,"Computed target (%d) doesn't equal target from replay XML (%d)",this.computedTarget,this.target,this),console.assert(void 0===this.computedModifier||void 0===this.modifier||this.computedModifier==this.modifier,"Computed modifier (%d) doesn't equal modifier from replay XML (%d)",this.computedModifier,this.modifier,this),console.assert(void 0===this.dice||this.constructor.numDice==this.dice.length,"Mismatch in number of dice (%d) and expected number of dice (%d)",this.dice&&this.dice.length,this.constructor.numDice,this)}static argsFromXml(e){const t=super.argsFromXml(e);return t.modifier=Yi(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t.target=e.boardActionResult.Requirement,t}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice} (${this.modifiedTarget})`}get actual(){return Object.assign(super.actual,{target:this.modifiedTarget})}get modifiedTarget(){var e=(this.target||this.computedTarget)-(this.modifier||this.computedModifier||0);return 1==this.constructor.numDice?Math.min(6,Math.max(2,e)):e}value(e,t){return e.reduce(((e,t)=>e+t),0)>=this.modifiedTarget?this.passValue(t).add(t?this.dependentMoveValues:null):this.dependentRolls.length>=1&&this.dependentRolls[0].constructor==this.constructor&&this.dependentRolls[0].isReroll?new Lt(`Rerolled ${this.rollName}`,this.rerollValue):this.failValue(t)}get possibleOutcomes(){for(var e=[0],t=0;t<this.constructor.numDice;t++){for(var n=[],r=1;r<=6;r++)for(const t of e)n.push(t+r);e=n}var i=[],a=[];for(const t of e)t>=this.modifiedTarget?i.unshift(t):a.unshift(t);var o=[];if(i.length>0){const e=Math.min(...i),t=Math.max(...i);o.push({name:e===t?e:`${e}-${t}`,value:this.passValue(!0).add(this.dependentMoveValues),weight:i.length/(i.length+a.length)})}if(a.length>0){const e=Math.min(...a),t=Math.max(...a);o.push({name:e===t?e:`${e}-${t}`,value:this.hasSkillReroll?this.reroll.possibleOutcomes:this.failValue(!0),weight:a.length/(i.length+a.length)})}return Object.defineProperty(this,"possibleOutcomes",{value:new Bt(o)}),this.possibleOutcomes}get reroll(){const e=new this.constructor({...this,rollStatus:He.RerollWithSkill});return Object.defineProperty(this,"reroll",{value:e}),this.reroll}get hasSkillReroll(){return this.activePlayer.skills.includes(this.constructor.rerollSkill)&&!this.skillsInEffect.includes(this.constructor.rerollCancelSkill)&&![He.RerollWithSkill,He.RerollTaken].includes(this.rollStatus)}simulateDice(){return this.dice.map((()=>Ji([1,2,3,4,5,6])))}passValue(){return new Lt("Pass",0)}failValue(){return new Lt("Fail",0)}isDependentRoll(e){return e.rollType==this.rollType&&[He.RerollTaken,He.RerollWithSkill].includes(e.rollStatus)||this.constructor.canCauseInjury&&[sa,ca,fa].includes(e.constructor)&&!e.isFoul||this.constructor.includeFollowingMoves&&e.constructor==da}}class sa extends oa{static numDice=2;static handledSkills=[Ue,he,we,Ce];static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=59==n.RollType,t.isPileOn){var r=Yi(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Ce))[0].PlayerId)}}return t.isFoul=e.action.ActionType==Ze,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(Yi(e.replayStep.RulesEventBoardAction)[0].PlayerId),console.log(e,t.finalBoardState.activePlayer,t.foulingPlayer)),t}get description(){if(this.isFoul){var e=this.foulingPlayer.skills.length>0?` (${this.foulingPlayer.skillNames.join(", ")})`:"",t=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.foulingPlayer.team.shortName}] ${this.foulingPlayer.name}${e} against ${this.activePlayer.name}${t} - ${this.dice.join(this.constructor.diceSeparator)}`}return super.description}isDependentRoll(e){return this.isFoul&&([ca,fa].includes(e.constructor)&&e.isFoul&&e.activePlayer.id==this.activePlayer.id||e.constructor==ga)}get rollName(){return this.isFoul?"Foul (Armor)":this.isPileOn?"Pile On (Armor)":"Armor"}get computedTarget(){return this.activePlayer.playerState.Data.Av+1}get computedModifier(){return 0}get injuryRoll(){return Object.defineProperty(this,"injuryRoll",{value:new ca({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:this.activePlayer,modifier:0})}),this.injuryRoll}value(e,t){var n=super.value(e,t);return this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}passValue(e){var t=this.stunValue(this.activePlayer);if(e&&(t=t.add(this.injuryRoll.possibleOutcomes.named("Injury Roll"))),this.isPileOn){const e=this.knockdownValue(this.pilingOnPlayer,!1);return t.add(e)}return t}failValue(){var e=new Lt("No Break",0);return this.isPileOn?e.add(this.knockdownValue(this.pilingOnPlayer,!1)):e}}class la extends oa{static rollName="Intercept";static handledSkills=[de];passValue(){return this.turnoverValue}}class ua extends oa{static rollName="Catch";static handledSkills=[Oe,ce,de];static rerollSkill=ce;failValue(){return this.turnoverValue}}class ca extends aa{static handledSkills=[he,we,Re];static diceSeparator="+";static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=60==n.RollType,t.isPileOn){var r=Yi(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Ce))[0].PlayerId)}}return t.isFoul=e.action.ActionType==Ze,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(Yi(e.replayStep.RulesEventBoardAction)[0].PlayerId)),t.modifier=Yi(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t}get rollName(){return this.isPileOn?"Pile On (Injury)":"Injury"}static ignore(e){return 1!=e.boardActionResult.IsOrderCompleted?(console.log("Ignoring incomplete InjuryRoll",{roll:this}),!0):super.ignore(e)}injuryValue(e){return this.activePlayer.skills.includes(Re)&&(e+=1),e<=7?new Lt("No Injury",0):e<=9?this.koValue(this.activePlayer):this.casValue(this.activePlayer)}value(e){var t=e[0]+e[1]+this.modifier,n=this.injuryValue(t);return this.isPileOn&&(n=n.subtract(this.onPitchValue(this.pilingOnPlayer))),this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}get possibleOutcomes(){for(var e={},t=1;t<=6;t++)for(var n=1;n<=6;n++){var r=e[this.value([t,n],!0).name];r||(r=e[this.value([t,n],!0).name]=[]),r.unshift({name:(t+n).toString(),value:this.value([t,n],!0)})}return Object.defineProperty(this,"possibleOutcomes",{value:new Bt(Object.values(e).map((e=>{const t=Math.min(...e.map((e=>parseInt(e.name)))),n=Math.max(...e.map((e=>parseInt(e.name))));return{name:t===n?t:`${t}-${n}`,weight:e.length,value:e[0].value}})))}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>Ji([1,2,3,4,5,6])))}}class fa extends aa{static rollName="Casualty";static diceSeparator="";static argsFromXml(e){const t=super.argsFromXml(e);return t.isFoul=e.action.ActionType==Ze,t}static dice(e){var t=super.dice(e);return[(t=t.slice(0,t.length/2))[t.length-1]]}value(e){return new Lt("CAS",0)}get possibleOutcomes(){for(var e=[],t=1;t<=6;t++)for(var n=1;n<=8;n++)e.unshift({name:`${t}${n}`,value:this.value(10*t+n,!0),weight:1});return Object.defineProperty(this,"possibleOutcomes",{value:new Bt(e)}),this.possibleOutcomes}simulateDice(){return 10*Ji([1,2,3,4,5,6])+Ji([1,2,3,4,5,6,7,8])}static ignore(e){return e.boardActionResult.ResultType!=et&&e.boardActionResult.SubResultType!=tt&&12!=e.boardActionResult.SubResultType?(console.warn("Ignoring casualty roll, should verify",{roll:this}),!0):super.ignore(e)}}class da extends aa{static rollName="Move";static ignore(e){return 0==Qi(e.action.Order.CellFrom,e.action.Order.CellTo.Cell)}static argsFromXml(e){const t=super.argsFromXml(e);return t.cellFrom=e.action.Order.CellFrom,t.cellTo=e.action.Order.CellTo.Cell,t}get jointDescription(){const e=[this].concat(this.dependentRolls),t=this.cellFrom,n=e[e.length-1].cellTo;return`Move: [${this.activePlayer.team.shortName}] ${this.activePlayer.name} - (${t.x||0}, ${t.y||0}) → (${n.x||0}, ${n.y||0})`}isDependentRoll(e){return e.constructor==da&&this.activePlayer.id==e.activePlayer.id}value(){return this.activePlayer&&this.activePlayer.isBallCarrier?Zi(this.activePlayer.team,this.cellTo).subtract(Zi(this.activePlayer.team,this.cellFrom)):new Lt("Move",0)}get possibleOutcomes(){return this.value().add(...this.dependentRolls.map((e=>e.value())))}}class ha extends aa{static ignore(){return!0}value(){return new Lt("No Value",0)}get expectedValue(){return 0}simulateDice(){return null}get possibleOutcomes(){return[]}}class pa extends ha{static rollName="Push";static handledSkills=[Fe]}class ma extends ha{static rollName="Follow Up"}class ga extends ha{}const ya={1:class extends oa{static rollName="GFI";static handledSkills=[Pe];static rerollSkill=Pe;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},2:class extends oa{static rollName="Dodge";static handledSkills=[be,Re,me,fe,Te,Me,Se];static rerollSkill=fe;static rerollCancelSkill=Te;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},3:sa,4:ca,5:class extends aa{static rollName="Block";static handledSkills=[Te,fe,_e,Ee,pe,ge,Ie,ye];static diceSeparator="/";static argsFromXml(e){const t=super.argsFromXml(e);return t.isRedDice=e.boardActionResult.Requirement<0,t.attacker=t.activePlayer,t.defender=t.finalBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}isDependentRoll(e){return[pa,ma,da].includes(e.constructor)||[sa,ca,fa].includes(e.constructor)&&!e.isFoul||e.rollType===this.rollType&&e.rollStatus==He.RerollTaken}static dice(e){var t=super.dice(e);return t.slice(0,t.length/2).map((e=>ut[e]))}get description(){var e=this.isRedDice?" uphill":"",t=this.attacker.skills.length>0?` (${this.attacker.skillNames.join(", ")})`:"",n=this.defender.skills.length>0?` (${this.defender.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${t} against ${this.defender.name}${n} - ${this.dice.join(this.constructor.diceSeparator)}${e}`}static ignore(e){return e.boardActionResult.ResultType!=et||(e.boardActionResult.SubResultType==nt||(e.boardActionResult.SubResultType==rt||super.ignore(e)))}dieValue(e,t){const n=this.attacker,r=this.defender;var i=n&&n.skills||[],a=r&&r.skills||[];switch(e){case it:return this.knockdownValue(n,t).add(this.turnoverValue);case at:const e=i.includes(_e),u=a.includes(_e);var o=[];if(i.includes(Ie)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));o.push(e)}if(i.includes($e)&&this.isBlitz){const e=this.knockdownValue(r,!1).product(new Lt("Push",.33)).named(`Push(${r.name})`).add(t?this.dependentMoveValues:null);o.push(e)}var s,l=[];if(a.includes(Ie)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));l.push(e)}if(e&&u){s=new Lt("Block/Block",0).add(t?this.dependentMoveValues:null)}else if(e){s=this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}else if(u){s=this.knockdownValue(n,t)}else{s=this.knockdownValue(r,t).add(this.knockdownValue(n,t),this.turnoverValue)}return s.min(...l).max(...o);case ot:return(a.includes(ge)?new Lt("Stand Firm",0):this.knockdownValue(r,!1).product(new Lt("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null);case st:return a.includes(fe)&&!i.includes(Te)?(a.includes(ge)?new Lt("Stand Firm",0):this.knockdownValue(r,!1).product(new Lt("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null):this.knockdownValue(r,t).add(t?this.dependentMoveValues:null);case lt:return this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}}value(e,t){if(this.dependentRolls.length>0&&this.dependentRolls[0].rollType==this.rollType&&this.dependentRolls[0].rollStatus==He.RerollTaken)return this.rerollValue;var n=e.filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>this.dieValue(e,t)));if(1==n.length)return n[0];if(this.isRedDice){var[r,...i]=n;return r.min(...i)}var[r,...i]=n;return r.max(...i)}get possibleOutcomes(){var e;const t=new Bt([{name:ot,weight:1/3,value:this.dieValue(ot,!0)},{name:it,weight:1/6,value:this.dieValue(it,!0)},{name:lt,weight:1/6,value:this.dieValue(lt,!0)},{name:st,weight:1/6,value:this.dieValue(st,!0)},{name:at,weight:1/6,value:this.dieValue(at,!0)}]);return e=1==this.dice.length?t:this.isRedDice?new Xt(new Array(this.dice.length).fill(t)):new Gt(new Array(this.dice.length).fill(t)),Object.defineProperty(this,"possibleOutcomes",{value:e}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>Ji([it,at,ot,ot,st,lt])))}},6:class extends oa{static rollName="Stand Up";failValue(){return this.knockdownValue(this.activePlayer,!1)}},7:class extends oa{static rollName="Pickup";static rerollSkill=ze;static handledSkills=[ze,qe,de];failValue(){return this.turnoverValue}},8:fa,9:ua,10:null,11:null,12:class extends oa{static rollName="Pass";static rerollSkill=De;static handledSkills=[De,Ne,ve];failValue(){return this.turnoverValue}},13:pa,14:ma,15:ga,16:la,17:class extends oa{static rollName="Wake Up";constructor(e){super(e),this.finalBoardState.activeTeam=this.activePlayer.team,this.finalBoardState.turn=this.finalBoardState.activeTeam.turn+1}passValue(){return this.koValue(this.activePlayer).product(-1).named("Wake Up")}},19:null,20:class extends oa{static rollName="Bone Head";static handledSkills=[ke];failValue(){return this.knockdownValue(this.activePlayer,!1)}},21:class extends oa{static rollName="Really Stupid";static handledSkills=[je];failValue(){return this.knockdownValue(this.activePlayer,!1)}},22:class extends oa{static rollName="Wild Animal";static handledSkills=[Le];failValue(){return-this.onPitchValue(this.activePlayer)}},24:class extends oa{static rollName="Landing";static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e)}},26:null,29:class extends oa{static rollName="Dauntless";static handledSkills=[xe]},31:class extends oa{static rollName="Jump-Up";static handledSkills=[Ae];failValue(){return-this.onPitchValue(this.activePlayer)}},36:class extends oa{static rollName="Leap";static canCauseInjury=!0;failValue(){return this.knockdownValue(this.activePlayer).add(this.turnoverValue)}},40:class extends oa{static rollName="Take Root";static handledSkills=[ye];failValue(){return this.knockdownValue(this.activePlayer,!1)}},54:class extends oa{static rollName="Fireball";static canCauseInjury=!0;passValue(e){return this.knockdownValue(this.activePlayer,e)}},55:class extends oa{static rollName="Lightning Bolt";static canCauseInjury=!0;static argsFromXml(e){const t=super.argsFromXml(e);return t.activePlayer=t.initialBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}passValue(e){return this.knockdownValue(this.activePlayer,e)}},56:class extends oa{static rollName="Throw Teammate";static handledSkills=[Be];failValue(){return new Lt("Fail",0)}isDependentRoll(e){return[ua,la].includes(e.constructor)}},58:null,59:sa,60:ca,61:null,64:null,70:null},va=function(e){var t,n,r,i=(n=(t=e).Replay.ReplayStep[0],r=t.Replay.ReplayStep[t.Replay.ReplayStep.length-1],console.log("Full gameinfo:"),console.log(n.GameInfos),{stadiumName:n.GameInfos.NameStadium,stadiumType:n.GameInfos.StructStadium,leagueName:n.GameInfos.RowLeague.Name,homeTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[0].UserId,teamName:n.BoardState.ListTeams.TeamState[0].Data.Name,raceId:n.BoardState.ListTeams.TeamState[0].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.HomeScore||0},awayTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[1].UserId,teamName:n.BoardState.ListTeams.TeamState[1].Data.Name,raceId:n.BoardState.ListTeams.TeamState[1].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.AwayScore||0}});console.log("Extracted game details...",i);for(var a=[],o=0;o<e.Replay.ReplayStep.length;o++){var s=e.Replay.ReplayStep[o];s.index=o,a=a.concat(aa.fromReplayStep(e.Replay.ReplayStep[o-1]&&e.Replay.ReplayStep[o-1].BoardState,o,s))}return console.log("Extracted rolls...",a),(a=(a=a.filter((e=>!e.ignore))).reduce(((e,t)=>(e.length>0&&e[e.length-1].isDependentRoll(t)?e[e.length-1].dependentRolls.push(t):e.push(t),e)),[])).forEach(((e,t)=>e.rollIndex=t)),{fullReplay:e.Replay,gameDetails:i,playerDetails:{},rolls:a,version:1}};function ba(t){let n,r,i,a,o,s,l,u,h,y,b;return{c(){n=p("div"),r=p("span"),i=m("Select Replay\n    "),a=p("input"),o=g(),s=p("script"),u=p("script"),w(a,"type","file"),w(a,"accept",".bbrz,.zip"),w(a,"class","svelte-16kp35q"),w(r,"id","file-input-button"),w(r,"class","btn btn-primary btn-file centered svelte-16kp35q"),w(n,"class","text-center"),s.src!==(l="https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js")&&w(s,"src","https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js"),u.src!==(h="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js")&&w(u,"src","https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js"),w(u,"integrity","sha512-JtZhe+DT2O3VPwzAMhyOpVY75fn92Zm1ebHVgAdXFf/x+7SfbonV/O7OWLsHkj11+yMtZAXavsuMvCaQS3WXrQ=="),w(u,"crossorigin","anonymous")},m(e,l){f(e,n,l),c(n,r),c(r,i),c(r,a),t[2](a),f(e,o,l),c(document.head,s),c(document.head,u),y||(b=v(a,"change",t[1]),y=!0)},p:e,i:e,o:e,d(e){e&&d(n),t[2](null),e&&d(o),d(s),d(u),y=!1,b()}}}function xa(e,t,n){const r=D();let i;return[i,function(){console.log("Preparing to parse XML..."),r("replayLoading");const e=i.files;e.length>0&&ue(e[0],(function(e){console.log("Preparing to process replay json...");const t=va(e);r("replayLoaded",t)}),(function(e){r("replayError"),alert(e)}))},function(e){j[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class wa extends le{constructor(e){super(),se(this,e,xa,ba,o,{})}}function _a(t){let n;return{c(){n=p("div"),n.innerHTML='<div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 110%">Loading...</div>',w(n,"id","loading"),w(n,"class","progress")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class ka extends le{constructor(e){super(),se(this,e,null,_a,o,{})}}function Oa(t){let n,r,i,a,o,s,l,u,h,y,v,b,x,k,O,S,E,$,A,D,C,M,j,F,T,N,R,P,z,B,L,I,q,U,V,W,H,G,X,Y,J,K,Q,Z,ee,te,ne,re,ie,ae,oe,se,le,ue,ce,fe,de,he=t[0].leagueName+"",pe=t[0].homeTeam.teamName+"",me=t[0].homeTeam.coachName+"",ge=(Ft[t[0].homeTeam.raceId]||`Unknown: ${t[0].homeTeam.raceId}`)+"",ye=t[0].homeTeam.score+"",ve=t[0].awayTeam.score+"",be=t[0].awayTeam.teamName+"",xe=t[0].awayTeam.teamName+"",we=(Ft[t[0].awayTeam.raceId]||`Unknown: ${t[0].awayTeam.raceId}`)+"",_e=t[0].stadiumName+"",ke=(t[0].stadiumType||"None")+"";return{c(){n=p("div"),r=p("div"),i=p("div"),a=m("League:\n      "),o=p("span"),s=m(he),l=g(),u=p("div"),h=p("div"),y=p("div"),v=p("div"),b=p("span"),x=m(pe),k=g(),O=p("div"),S=m("Coach:\n          "),E=p("span"),$=m(me),A=g(),D=p("div"),C=m("Race:\n          "),M=p("span"),j=m(ge),F=g(),T=p("div"),N=p("span"),R=m(ye),P=m("\n        -\n        "),z=p("span"),B=m(ve),L=g(),I=p("div"),q=p("div"),U=p("span"),V=m(be),W=g(),H=p("div"),G=m("Coach:\n          "),X=p("span"),Y=m(xe),J=g(),K=p("div"),Q=m("Race:\n          "),Z=p("span"),ee=m(we),te=g(),ne=p("div"),re=p("div"),ie=m("Stadium:\n        "),ae=p("span"),oe=m(_e),se=g(),le=p("div"),ue=p("div"),ce=m("Stadium Enhancement:\n        "),fe=p("span"),de=m(ke),w(o,"id","league-name"),w(i,"class","col-sm-12"),w(r,"class","row league-name svelte-xudoad"),w(b,"id","home-team"),w(v,"class","team-name home svelte-xudoad"),w(E,"id","home-coach"),w(O,"class","coach-name svelte-xudoad"),w(M,"id","home-race"),w(D,"class","race svelte-xudoad"),w(y,"class","col-sm-5 team-details team-details-left svelte-xudoad"),w(N,"id","home-score"),w(N,"class","home svelte-xudoad"),w(z,"id","away-score"),w(z,"class","away svelte-xudoad"),w(T,"class","col-sm-2 score svelte-xudoad"),w(U,"id","away-team"),w(q,"class","team-name away svelte-xudoad"),w(X,"id","away-coach"),w(H,"class","coach-name svelte-xudoad"),w(Z,"id","away-race"),w(K,"class","race svelte-xudoad"),w(I,"class","col-sm-5 team-details team-details-right svelte-xudoad"),w(h,"class","row"),w(ae,"id","stadium-name"),w(re,"class","col-sm-12"),w(ne,"class","row stadium-name svelte-xudoad"),w(fe,"id","stadium-type"),w(ue,"class","col-sm-12"),w(le,"class","row stadium-type svelte-xudoad"),w(u,"id","game-details"),w(n,"id","summary"),w(n,"class","container svelte-xudoad")},m(e,t){f(e,n,t),c(n,r),c(r,i),c(i,a),c(i,o),c(o,s),c(n,l),c(n,u),c(u,h),c(h,y),c(y,v),c(v,b),c(b,x),c(y,k),c(y,O),c(O,S),c(O,E),c(E,$),c(y,A),c(y,D),c(D,C),c(D,M),c(M,j),c(h,F),c(h,T),c(T,N),c(N,R),c(T,P),c(T,z),c(z,B),c(h,L),c(h,I),c(I,q),c(q,U),c(U,V),c(I,W),c(I,H),c(H,G),c(H,X),c(X,Y),c(I,J),c(I,K),c(K,Q),c(K,Z),c(Z,ee),c(u,te),c(u,ne),c(ne,re),c(re,ie),c(re,ae),c(ae,oe),c(u,se),c(u,le),c(le,ue),c(ue,ce),c(ue,fe),c(fe,de)},p(e,[t]){1&t&&he!==(he=e[0].leagueName+"")&&_(s,he),1&t&&pe!==(pe=e[0].homeTeam.teamName+"")&&_(x,pe),1&t&&me!==(me=e[0].homeTeam.coachName+"")&&_($,me),1&t&&ge!==(ge=(Ft[e[0].homeTeam.raceId]||`Unknown: ${e[0].homeTeam.raceId}`)+"")&&_(j,ge),1&t&&ye!==(ye=e[0].homeTeam.score+"")&&_(R,ye),1&t&&ve!==(ve=e[0].awayTeam.score+"")&&_(B,ve),1&t&&be!==(be=e[0].awayTeam.teamName+"")&&_(V,be),1&t&&xe!==(xe=e[0].awayTeam.teamName+"")&&_(Y,xe),1&t&&we!==(we=(Ft[e[0].awayTeam.raceId]||`Unknown: ${e[0].awayTeam.raceId}`)+"")&&_(ee,we),1&t&&_e!==(_e=e[0].stadiumName+"")&&_(oe,_e),1&t&&ke!==(ke=(e[0].stadiumType||"None")+"")&&_(de,ke)},i:e,o:e,d(e){e&&d(n)}}}function Sa(e,t,n){let{gameDetails:r}=t;return e.$$set=e=>{"gameDetails"in e&&n(0,r=e.gameDetails)},[r]}class Ea extends le{constructor(e){super(),se(this,e,Sa,Oa,o,{gameDetails:0})}}function $a(t){let n;return{c(){n=p("div"),n.innerHTML='<div class="col-sm-12"><div><h1>What am I looking at?</h1> \n      <p>Diced or Not has imported your replay, and categorized each of the dice\n        rolls how much value you got out of them, based on whether they passed\n        or failed. It also computed what value you should have expected to get\n        out of those rolls. Finally, it compared the value you got to the\n        expected value, and add up that net value across the game. You can see\n        that trend-line in the graph above.</p> \n      <p>The values attributed to the rolls are based on the following standards:</p> \n      <ul><li>Each teams player positions/activations is worth 1 per turn. This\n          means that a block that results in a knockdown for your opponent will\n          give you fractional points based on that player&#39;s TV value compared to\n          the whole team value, while getting your own player stunned would cost\n          you that same fraction, but times multiple turns.</li> \n        <li>Future player value is time-discounted to account for the uncertainty\n          of future events. So, if first turn of knockdown is worth 0.1, then\n          the second turn of a stun would be worth 0.09, the third 0.081, and so\n          on.</li> \n        <li>Player value is scaled based on vicinity to the ball and goal line.\n          So, having the ball doubles the value of your player, and marking the\n          ball multiplies the value by 1.5. Being within movement distance of\n          the endzone also multiplies player value, by larger amounts as the\n          player is closer to the endzone.</li> \n        <li>Ball-possession and fields position account for another pool of\n          points. Based on the expectation of a team taking 8 turns to score\n          once in a drive, moving the ball all the way up the field and scoring\n          a touchdown should be worth 8 points. We divide that in half: 4 points\n          for actually scoring the touchdown, and 4 points for moving the ball\n          up the field. The 4 field-position points are weighted more heavily\n          toward the endzone, and are awarded by net-position. So, moving the\n          ball one square forward gives you points equal to the value of your\n          new position minus the value of your old position.</li></ul> \n      <p>Once your game was analyzed, Diced or Not simulated rolling those same\n        sets of dice\n        <span id="game-count">0</span>\n        more times, and compared the net value of your game to the net value in\n        the simulated games. The fainter background lines show the 99th, 90th,\n        75th, 50th, 25th, 10th, and 1st percentile cumulative net-values. So, if\n        your line is above the top background line, then your game was better\n        than 99% of games with the same dice, and you most definitely were not\n        diced. If you line was below the 3rd line from the bottom, then your\n        game was worse than 3/4s of games, and you might have a slight argument\n        for having been diced.</p></div> \n    <div><h2>Terminology</h2> \n      <dl><dt id="value-def">Value</dt><dd>An abstraction of how much getting that roll result likely helped your\n          game. For example, getting a Defender Down on a Block roll would be a\n          +1 value, and getting an Attacker Down on a Block roll would be a -1\n          value (because it ends your turn). More details of the values assigned\n          are listed in the\n          <a href="#value-table">Values Table</a>.\n        </dd><dt id="expected-value-def">Expected Value</dt><dd>The average\n          <a href="value-def">Value</a>\n          over all of the possible results of a roll.\n        </dd><dt>Net Value</dt><dd>The difference between the actual value and the expected value on a\n          specific roll.\n        </dd><dt>Cumulative Net Value</dt><dd>The running total of Net Value for all the rolls taken so far by a\n          team.</dd></dl></div> \n    <div><h2>To Do</h2> \n      <div><h3>Value calculation changes</h3> \n        <ul><li>Add points when a touchdown is scored.</li> \n          <li>Count net change in points between rolls.</li> \n          <li>Handle the value of team rerolls, and the expected results of\n            rerolling.</li> \n          <li>Account for Bribe use in Fouls.</li> \n          <li>Compute player value by using actual TV values.</li> \n          <li>Adjust player value based on distance to endzone.</li> \n          <li>Include Piling-On in block expected value calculations.</li> \n          <li>Make sure armor/injury rolls make use of Mighty Blow in expected\n            value calculations.</li> \n          <li>Make sure that Claw is properly accounted for in possible outcome\n            calculations.</li> \n          <li>Make sure that Dirty Player is properly accountef for in possibel\n            outcome calculations.</li></ul></div> \n      <div><h3>Display improvements</h3> \n        <ul><li>Add thumbnails of the board state across the game.</li> \n          <li>Make the Dice logs less verbose by making player stats popups.</li> \n          <li>Display the full range of expected values and their probablities on\n            the graph.</li></ul></div></div></div>',w(n,"id","explanation"),w(n,"class","row")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class Aa extends le{constructor(e){super(),se(this,e,null,$a,o,{})}}function Da(t){let n;return{c(){n=p("div"),n.innerHTML='<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> \n    <span class="sr-only">Error:</span>\n    Could not process saved replay data, it might be a bad URL.',w(n,"class","alert alert-danger svelte-tlpcpu"),w(n,"role","alert"),w(n,"id","data-param-error")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class Ca extends le{constructor(e){super(),se(this,e,null,Da,o,{})}}function Ma(e,t,n){const r=e.slice();return r[7]=t[n],r}function ja(e,t,n){const r=e.slice();return r[7]=t[n],r}function Fa(t){let n;return{c(){n=m(t[0])},m(e,t){f(e,n,t)},p(e,t){1&t&&_(n,e[0])},i:e,o:e,d(e){e&&d(n)}}}function Ta(e){let t,n,r,i,a,o,s,l,u,h,y=e[0].values.reduce(e[5],null)+"",w=e[0].valueString+"",k=e[0].name&&za(e),O=e[1]&&Ba(e);return{c(){t=p("details"),n=p("summary"),k&&k.c(),r=g(),i=m(y),a=g(),o=m(w),s=g(),O&&O.c(),t.open=e[1]},m(d,p){f(d,t,p),c(t,n),k&&k.m(n,null),c(n,r),c(n,i),c(n,a),c(n,o),c(t,s),O&&O.m(t,null),l=!0,u||(h=v(t,"click",x(b(e[6]))),u=!0)},p(e,a){e[0].name?k?k.p(e,a):(k=za(e),k.c(),k.m(n,r)):k&&(k.d(1),k=null),(!l||1&a)&&y!==(y=e[0].values.reduce(e[5],null)+"")&&_(i,y),(!l||1&a)&&w!==(w=e[0].valueString+"")&&_(o,w),e[1]?O?(O.p(e,a),2&a&&Y(O,1)):(O=Ba(e),O.c(),Y(O,1),O.m(t,null)):O&&(G(),J(O,1,1,(()=>{O=null})),X()),(!l||2&a)&&(t.open=e[1])},i(e){l||(Y(O),l=!0)},o(e){J(O),l=!1},d(e){e&&d(t),k&&k.d(),O&&O.d(),u=!1,h()}}}function Na(e){let t,n;return t=new Qa({props:{dist:e[0].simple}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.dist=e[0].simple),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function Ra(e){let t,n,r,i,a,o,s,l,u=e[0].valueString+"",h=e[0].name&&Ua(e),y=e[1]&&Va(e);return{c(){t=p("details"),n=p("summary"),h&&h.c(),r=g(),i=m(u),a=g(),y&&y.c(),t.open=e[1]},m(u,d){f(u,t,d),c(t,n),h&&h.m(n,null),c(n,r),c(n,i),c(t,a),y&&y.m(t,null),o=!0,s||(l=v(t,"click",x(b(e[4]))),s=!0)},p(e,a){e[0].name?h?h.p(e,a):(h=Ua(e),h.c(),h.m(n,r)):h&&(h.d(1),h=null),(!o||1&a)&&u!==(u=e[0].valueString+"")&&_(i,u),e[1]?y?(y.p(e,a),2&a&&Y(y,1)):(y=Va(e),y.c(),Y(y,1),y.m(t,null)):y&&(G(),J(y,1,1,(()=>{y=null})),X()),(!o||2&a)&&(t.open=e[1])},i(e){o||(Y(y),o=!0)},o(e){J(y),o=!1},d(e){e&&d(t),h&&h.d(),y&&y.d(),s=!1,l()}}}function Pa(e){let t,n,r,i;const a=[Ya,Xa],o=[];function s(e,t){return e[0].value instanceof zt?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=y()},m(e,n){o[t].m(e,n),f(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(G(),J(o[l],1,1,(()=>{o[l]=null})),X(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),Y(n,1),n.m(r.parentNode,r))},i(e){i||(Y(n),i=!0)},o(e){J(n),i=!1},d(e){o[t].d(e),e&&d(r)}}}function za(e){let t,n,r=e[0].name+"";return{c(){t=m(r),n=m(" →")},m(e,r){f(e,t,r),f(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&_(t,r)},d(e){e&&d(t),e&&d(n)}}}function Ba(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=qa(Ma(e,a,t));const s=e=>J(o[e],1,1,(()=>{o[e]=null}));return{c(){t=p("ul");for(let e=0;e<o.length;e+=1)o[e].c();w(t,"class","list-group")},m(a,s){f(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=v(t,"click",x(e[3])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Ma(e,a,r);o[r]?(o[r].p(i,n),Y(o[r],1)):(o[r]=qa(i),o[r].c(),Y(o[r],1),o[r].m(t,null))}for(G(),r=a.length;r<o.length;r+=1)s(r);X()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)Y(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);n=!1},d(e){e&&d(t),h(o,e),r=!1,i()}}}function La(t){let n,r,i,a=t[7].toFixed(2)+"";return{c(){n=p("li"),r=m(a),i=g(),w(n,"class","list-group-item list-group-item-action")},m(e,t){f(e,n,t),c(n,r),c(n,i)},p(e,t){1&t&&a!==(a=e[7].toFixed(2)+"")&&_(r,a)},i:e,o:e,d(e){e&&d(n)}}}function Ia(e){let t,n,r,i;return n=new Qa({props:{dist:e[7]}}),{c(){t=p("li"),ie(n.$$.fragment),r=g(),w(t,"class","list-group-item list-group-item-action")},m(e,a){f(e,t,a),ae(n,t,null),c(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7]),n.$set(r)},i(e){i||(Y(n.$$.fragment,e),i=!0)},o(e){J(n.$$.fragment,e),i=!1},d(e){e&&d(t),oe(n)}}}function qa(e){let t,n,r,i;const a=[Ia,La],o=[];function s(e,t){return e[7]instanceof zt?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=y()},m(e,n){o[t].m(e,n),f(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(G(),J(o[l],1,1,(()=>{o[l]=null})),X(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),Y(n,1),n.m(r.parentNode,r))},i(e){i||(Y(n),i=!0)},o(e){J(n),i=!1},d(e){o[t].d(e),e&&d(r)}}}function Ua(e){let t,n,r=e[0].name+"";return{c(){t=m(r),n=m(" →")},m(e,r){f(e,t,r),f(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&_(t,r)},d(e){e&&d(t),e&&d(n)}}}function Va(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=Ga(ja(e,a,t));const s=e=>J(o[e],1,1,(()=>{o[e]=null}));return{c(){t=p("ul");for(let e=0;e<o.length;e+=1)o[e].c();w(t,"class","list-group")},m(a,s){f(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=v(t,"click",x(e[2])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=ja(e,a,r);o[r]?(o[r].p(i,n),Y(o[r],1)):(o[r]=Ga(i),o[r].c(),Y(o[r],1),o[r].m(t,null))}for(G(),r=a.length;r<o.length;r+=1)s(r);X()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)Y(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);n=!1},d(e){e&&d(t),h(o,e),r=!1,i()}}}function Wa(t){let n,r,i,a,o,s,l,u=(100*t[7].weight).toFixed(1)+"",h=t[7].name+"",y=t[7].value+"";return{c(){n=p("li"),r=m(u),i=m("%:\n              "),a=m(h),o=m("\n              →\n              "),s=m(y),l=g(),w(n,"class","list-group-item list-group-item-action")},m(e,t){f(e,n,t),c(n,r),c(n,i),c(n,a),c(n,o),c(n,s),c(n,l)},p(e,t){1&t&&u!==(u=(100*e[7].weight).toFixed(1)+"")&&_(r,u),1&t&&h!==(h=e[7].name+"")&&_(a,h),1&t&&y!==(y=e[7].value+"")&&_(s,y)},i:e,o:e,d(e){e&&d(n)}}}function Ha(e){let t,n,r,i;return n=new Qa({props:{dist:e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)}}),{c(){t=p("li"),ie(n.$$.fragment),r=g(),w(t,"class","list-group-item list-group-item-action")},m(e,a){f(e,t,a),ae(n,t,null),c(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)),n.$set(r)},i(e){i||(Y(n.$$.fragment,e),i=!0)},o(e){J(n.$$.fragment,e),i=!1},d(e){e&&d(t),oe(n)}}}function Ga(e){let t,n,r,i;const a=[Ha,Wa],o=[];function s(e,t){return e[7].value instanceof zt?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=y()},m(e,n){o[t].m(e,n),f(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(G(),J(o[l],1,1,(()=>{o[l]=null})),X(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),Y(n,1),n.m(r.parentNode,r))},i(e){i||(Y(n),i=!0)},o(e){J(n),i=!1},d(e){o[t].d(e),e&&d(r)}}}function Xa(t){let n,r,i,a=t[0].name+"",o=t[0].valueString+"";return{c(){n=m(a),r=g(),i=m(o)},m(e,t){f(e,n,t),f(e,r,t),f(e,i,t)},p(e,t){1&t&&a!==(a=e[0].name+"")&&_(n,a),1&t&&o!==(o=e[0].valueString+"")&&_(i,o)},i:e,o:e,d(e){e&&d(n),e&&d(r),e&&d(i)}}}function Ya(e){let t,n,r;return t=new Qa({props:{dist:e[0].value.named(e[0].name)}}),{c(){ie(t.$$.fragment),n=m(";")},m(e,i){ae(t,e,i),f(e,n,i),r=!0},p(e,n){const r={};1&n&&(r.dist=e[0].value.named(e[0].name)),t.$set(r)},i(e){r||(Y(t.$$.fragment,e),r=!0)},o(e){J(t.$$.fragment,e),r=!1},d(e){oe(t,e),e&&d(n)}}}function Ja(e){let t,n,r,i;const a=[Pa,Ra,Na,Ta,Fa],o=[];function s(e,t){return e[0]instanceof Lt?0:e[0]instanceof Bt?1:e[0]instanceof Ht?2:e[0]instanceof It?3:4}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=y()},m(e,n){o[t].m(e,n),f(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(G(),J(o[l],1,1,(()=>{o[l]=null})),X(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),Y(n,1),n.m(r.parentNode,r))},i(e){i||(Y(n),i=!0)},o(e){J(n),i=!1},d(e){o[t].d(e),e&&d(r)}}}function Ka(e,t,n){let{dist:r}=t,i=!1;return e.$$set=e=>{"dist"in e&&n(0,r=e.dist)},[r,i,function(t){C(e,t)},function(t){C(e,t)},()=>n(1,i=!i),(e,t)=>e?r.nameFunc(e,t.name||t):t.name,()=>n(1,i=!i)]}class Qa extends le{constructor(e){super(),se(this,e,Ka,Ja,o,{dist:0})}}function Za(e,t,n){const r=e.slice();return r[8]=t[n],r}function eo(e){let t,n,r,a,o,s,l,u,h,m,y,_=e[3]&&to(e);return u=new Qa({props:{dist:e[0].possibleOutcomes.named("Possible Outcomes")}}),{c(){t=p("ul"),n=p("li"),r=p("details"),a=p("summary"),a.textContent="Actual Outcomes",o=g(),_&&_.c(),s=g(),l=p("li"),ie(u.$$.fragment),r.open=e[3],w(n,"class","list-group-item list-group-item-action"),w(l,"class","list-group-item list-group-item-action"),w(t,"class","list-group")},m(i,d){f(i,t,d),c(t,n),c(n,r),c(r,a),c(r,o),_&&_.m(r,null),c(t,s),c(t,l),ae(u,l,null),h=!0,m||(y=[v(r,"click",x(b(e[6]))),v(t,"click",x(e[4]))],m=!0)},p(e,t){e[3]?_?(_.p(e,t),8&t&&Y(_,1)):(_=to(e),_.c(),Y(_,1),_.m(r,null)):_&&(G(),J(_,1,1,(()=>{_=null})),X()),(!h||8&t)&&(r.open=e[3]);const n={};1&t&&(n.dist=e[0].possibleOutcomes.named("Possible Outcomes")),u.$set(n)},i(e){h||(Y(_),Y(u.$$.fragment,e),h=!0)},o(e){J(_),J(u.$$.fragment,e),h=!1},d(e){e&&d(t),_&&_.d(),oe(u),m=!1,i(y)}}}function to(e){let t,n,r,i,a=e[1],o=[];for(let t=0;t<a.length;t+=1)o[t]=no(Za(e,a,t));const s=e=>J(o[e],1,1,(()=>{o[e]=null}));return{c(){t=p("ul");for(let e=0;e<o.length;e+=1)o[e].c();w(t,"class","list-group")},m(a,s){f(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=v(t,"click",x(e[5])),r=!0)},p(e,n){if(2&n){let r;for(a=e[1],r=0;r<a.length;r+=1){const i=Za(e,a,r);o[r]?(o[r].p(i,n),Y(o[r],1)):(o[r]=no(i),o[r].c(),Y(o[r],1),o[r].m(t,null))}for(G(),r=a.length;r<o.length;r+=1)s(r);X()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)Y(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)J(o[e]);n=!1},d(e){e&&d(t),h(o,e),r=!1,i()}}}function no(e){let t,n,r,i;return n=new Qa({props:{dist:e[8]}}),{c(){t=p("li"),ie(n.$$.fragment),r=g(),w(t,"class","list-group-item list-group-item-action")},m(e,a){f(e,t,a),ae(n,t,null),c(t,r),i=!0},p(e,t){const r={};2&t&&(r.dist=e[8]),n.$set(r)},i(e){i||(Y(n.$$.fragment,e),i=!0)},o(e){J(n.$$.fragment,e),i=!1},d(e){e&&d(t),oe(n)}}}function ro(e){let t,n,r,i,a,o,s,l,u,h,y,k,O=e[0].jointDescription+"",S=e[0].valueWithDependents.valueString+"",E=e[0].possibleOutcomes.valueString+"",$=e[2]&&eo(e);return{c(){t=p("details"),n=p("summary"),r=m(O),i=g(),a=m(S),o=g(),s=m(E),l=g(),$&&$.c(),t.open=e[2],w(t,"id",u="roll-"+e[0].rollIndex)},m(u,d){f(u,t,d),c(t,n),c(n,r),c(n,i),c(n,a),c(n,o),c(n,s),c(t,l),$&&$.m(t,null),h=!0,y||(k=v(t,"click",x(b(e[7]))),y=!0)},p(e,[n]){(!h||1&n)&&O!==(O=e[0].jointDescription+"")&&_(r,O),(!h||1&n)&&S!==(S=e[0].valueWithDependents.valueString+"")&&_(a,S),(!h||1&n)&&E!==(E=e[0].possibleOutcomes.valueString+"")&&_(s,E),e[2]?$?($.p(e,n),4&n&&Y($,1)):($=eo(e),$.c(),Y($,1),$.m(t,null)):$&&(G(),J($,1,1,(()=>{$=null})),X()),(!h||4&n)&&(t.open=e[2]),(!h||1&n&&u!==(u="roll-"+e[0].rollIndex))&&w(t,"id",u)},i(e){h||(Y($),h=!0)},o(e){J($),h=!1},d(e){e&&d(t),$&&$.d(),y=!1,k()}}}function io(e,t,n){let r,{roll:i}=t,a=!1,o=!1;return e.$$set=e=>{"roll"in e&&n(0,i=e.roll)},e.$$.update=()=>{1&e.$$.dirty&&n(1,r=[i,...i.dependentRolls].map((e=>{const t=e.actualValue;return t.name?t.named(`${e.shortDescription} - ${t.name}`):t.named(e.shortDescription)})))},[i,r,a,o,function(t){C(e,t)},function(t){C(e,t)},()=>n(3,o=!o),()=>n(2,a=!a)]}class ao extends le{constructor(e){super(),se(this,e,io,ro,o,{roll:0})}}function oo(e,t,n){const r=e.slice();return r[7]=t[n],r[8]=t,r[9]=n,r}function so(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[7].rollIndex;for(let t=0;t<s.length;t+=1){let n=oo(e,s,t),r=l(n);o.set(r,a[t]=lo(r,n))}return{c(){t=p("ul");for(let e=0;e<a.length;e+=1)a[e].c();w(t,"class","list-group")},m(o,s){f(o,t,s);for(let e=0;e<a.length;e+=1)a[e].m(t,null);n=!0,r||(i=v(t,"click",x(e[3])),r=!0)},p(e,n){if(3&n){const r=e[0];G(),a=ee(a,n,l,1,e,r,o,t,Z,lo,null,oo),X()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)Y(a[e]);n=!0}},o(e){for(let e=0;e<a.length;e+=1)J(a[e]);n=!1},d(e){e&&d(t);for(let e=0;e<a.length;e+=1)a[e].d();r=!1,i()}}}function lo(e,t){let n,r,i,a,o,s,l;function u(e){t[4].call(null,e,t[7])}let h={roll:t[7]};function m(){return t[5](t[7],t[8],t[9])}return void 0!==t[7].open&&(h.open=t[7].open),r=new ao({props:h}),j.push((()=>re(r,"open",u))),{key:e,first:null,c(){n=p("li"),ie(r.$$.fragment),a=g(),w(n,"class","list-group-item list-group-item-action"),O(n,"active",t[1]==t[7].rollIndex),this.first=n},m(e,t){f(e,n,t),ae(r,n,null),c(n,a),o=!0,s||(l=v(n,"click",x(m)),s=!0)},p(e,a){t=e;const o={};1&a&&(o.roll=t[7]),!i&&1&a&&(i=!0,o.open=t[7].open,L((()=>i=!1))),r.$set(o),3&a&&O(n,"active",t[1]==t[7].rollIndex)},i(e){o||(Y(r.$$.fragment,e),o=!0)},o(e){J(r.$$.fragment,e),o=!1},d(e){e&&d(n),oe(r),s=!1,l()}}}function uo(e){let t,n,r,i,a,o,s,l,u,h=e[0][0].activeTeam.name+"",y=e[0][0].turn+"",w=e[2]&&so(e);return{c(){t=p("details"),n=p("summary"),r=m(h),i=m(" - Turn "),a=m(y),o=g(),w&&w.c(),t.open=e[2]},m(d,h){f(d,t,h),c(t,n),c(n,r),c(n,i),c(n,a),c(t,o),w&&w.m(t,null),s=!0,l||(u=v(t,"click",x(b(e[6]))),l=!0)},p(e,[n]){(!s||1&n)&&h!==(h=e[0][0].activeTeam.name+"")&&_(r,h),(!s||1&n)&&y!==(y=e[0][0].turn+"")&&_(a,y),e[2]?w?(w.p(e,n),4&n&&Y(w,1)):(w=so(e),w.c(),Y(w,1),w.m(t,null)):w&&(G(),J(w,1,1,(()=>{w=null})),X()),(!s||4&n)&&(t.open=e[2])},i(e){s||(Y(w),s=!0)},o(e){J(w),s=!1},d(e){e&&d(t),w&&w.d(),l=!1,u()}}}function co(e,t,n){let{rolls:r}=t,{selectedRoll:i}=t,a=!1;return e.$$set=e=>{"rolls"in e&&n(0,r=e.rolls),"selectedRoll"in e&&n(1,i=e.selectedRoll)},e.$$.update=()=>{7&e.$$.dirty&&n(2,a=a||r&&i&&i>=r[0].rollIndex&&i<=r[r.length-1].rollIndex)},[r,i,a,function(t){C(e,t)},function(e,t){t.open=e,n(0,r)},(e,t,i)=>n(0,t[i].open=!e.open,r),()=>n(2,a=!a)]}class fo extends le{constructor(e){super(),se(this,e,co,uo,o,{rolls:0,selectedRoll:1})}}function ho(e,t,n){const r=e.slice();return r[1]=t[n],r[7]=t,r[8]=n,r}function po(e,t){let n,r,i,a,o,s,l;function u(e){t[3].call(null,e,t[1])}let h={rolls:t[1],selectedRoll:t[0]};function m(){return t[4](t[1],t[7],t[8])}return void 0!==t[1].open&&(h.open=t[1].open),r=new fo({props:h}),j.push((()=>re(r,"open",u))),{key:e,first:null,c(){n=p("li"),ie(r.$$.fragment),a=g(),w(n,"class","list-group-item list-group-item-action"),this.first=n},m(e,t){f(e,n,t),ae(r,n,null),c(n,a),o=!0,s||(l=v(n,"click",x(m)),s=!0)},p(e,n){t=e;const a={};4&n&&(a.rolls=t[1]),1&n&&(a.selectedRoll=t[0]),!i&&4&n&&(i=!0,a.open=t[1].open,L((()=>i=!1))),r.$set(a)},i(e){o||(Y(r.$$.fragment,e),o=!0)},o(e){J(r.$$.fragment,e),o=!1},d(e){e&&d(n),oe(r),s=!1,l()}}}function mo(e){let t,n,r,i=[],a=new Map,o=e[2];const s=e=>e[1][0].rollIndex;for(let t=0;t<o.length;t+=1){let n=ho(e,o,t),r=s(n);a.set(r,i[t]=po(r,n))}return{c(){t=p("div"),n=p("ul");for(let e=0;e<i.length;e+=1)i[e].c();w(t,"class","details-list")},m(e,a){f(e,t,a),c(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);r=!0},p(e,[t]){if(5&t){const r=e[2];G(),i=ee(i,t,s,1,e,r,a,n,Z,po,null,ho),X()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)Y(i[e]);r=!0}},o(e){for(let e=0;e<i.length;e+=1)J(i[e]);r=!1},d(e){e&&d(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function go(e,t,n){let r,{rolls:i}=t,{selectedRoll:a=null}=t;return e.$$set=e=>{"rolls"in e&&n(1,i=e.rolls),"selectedRoll"in e&&n(0,a=e.selectedRoll)},e.$$.update=()=>{3&e.$$.dirty&&(console.log("Roll Details reactive"),function(e,t){n(2,r=e.reduce(((e,t)=>{const n=e[e.length-1],r=n&&n[n.length-1];return n&&r&&r.activeTeam.id==t.activeTeam.id&&r.turn==t.turn?n.push(t):e.push([t]),e}),[]))}(i))},[a,i,r,function(e,t){t.open=e,n(2,r)},(e,t,i)=>n(2,t[i].open=!e.open,r)]}class yo extends le{constructor(e){super(),se(this,e,go,mo,o,{rolls:1,selectedRoll:0})}}
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */var vo,bo=(vo=function(e,t){return(vo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}vo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),xo=Object.prototype.hasOwnProperty;function wo(e,t){return xo.call(e,t)}function _o(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)wo(e,r)&&t.push(r);return t}function ko(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Oo(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function So(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Eo(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function $o(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if($o(e[t]))return!0}else if("object"==typeof e){var r=_o(e),i=r.length;for(t=0;t<i;t++)if($o(e[r[t]]))return!0}return!1}function Ao(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var Do=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,Ao(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=Ao(t,{name:n,index:r,operation:i,tree:a}),s}return bo(t,e),t}(Error),Co=Do,Mo=ko,jo={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=To(n,this.path);r&&(r=ko(r));var i=No(n,{op:"remove",path:this.from}).removed;return No(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=To(n,this.from);return No(n,{op:"add",path:this.path,value:ko(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Bo(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Fo={add:function(e,t,n){return Oo(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:jo.move,copy:jo.copy,test:jo.test,_get:jo._get};function To(e,t){if(""==t)return e;var n={op:"_get",path:t};return No(e,n),n.value}function No(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):Po(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=To(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=Bo(e,t.value),!1===o.test)throw new Co("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new Co("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=ko(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,f=void 0,d=void 0,h=void 0;for(h="function"==typeof n?n:Po;;){if(d=s[u],i&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===l[d]?f=s.slice(0,u).join("/"):u==c-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(n&&!Oo(d))throw new Co("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Oo(d)&&(d=~~d)}if(u>=c){if(n&&"add"===t.op&&d>l.length)throw new Co("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=Fo[t.op].call(t,l,d,e)).test)throw new Co("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(d&&-1!=d.indexOf("~")&&(d=Eo(d)),u>=c){if(!1===(o=jo[t.op].call(t,l,d,e)).test)throw new Co("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[d]}}function Ro(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new Co("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=ko(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=No(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function Po(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new Co("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!jo[e.op])throw new Co("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new Co("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new Co('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new Co("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new Co("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&$o(e.value))throw new Co("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new Co("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new Co("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=zo([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new Co("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function zo(e,t,n){try{if(!Array.isArray(e))throw new Co("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Ro(ko(t),ko(e),n||!0);else{n=n||Po;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof Co)return e;throw e}}function Bo(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!Bo(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!Bo(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var Lo=Object.freeze({__proto__:null,JsonPatchError:Co,deepClone:Mo,getValueByPointer:To,applyOperation:No,applyPatch:Ro,applyReducer:function(e,t,n){var r=No(e,t);if(!1===r.test)throw new Co("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument},validator:Po,validate:zo,_areEquals:Bo}),Io=new WeakMap,qo=function(e){this.observers=new Map,this.obj=e},Uo=function(e,t){this.callback=e,this.observer=t};
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */function Vo(e,t){void 0===t&&(t=!1);var n=Io.get(e.object);Wo(n.value,e.object,e.patches,"",t),e.patches.length&&Ro(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function Wo(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=_o(t),o=_o(e),s=!1,l=o.length-1;l>=0;l--){var u=e[f=o[l]];if(!wo(t,f)||void 0===t[f]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+So(f),value:ko(u)}),n.push({op:"remove",path:r+"/"+So(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[f];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?Wo(u,c,n,r+"/"+So(f),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+So(f),value:ko(u)}),n.push({op:"replace",path:r+"/"+So(f),value:ko(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var f;wo(e,f=a[l])||void 0===t[f]||n.push({op:"add",path:r+"/"+So(f),value:ko(t[f])})}}}var Ho=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){return Io.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new qo(e),Io.set(e,r);if(n)return n;if(n={},r.value=ko(e),t){n.callback=t,n.next=null;var a=function(){Vo(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){Vo(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new Uo(t,n)),n},generate:Vo,compare:function(e,t,n){void 0===n&&(n=!1);var r=[];return Wo(e,t,r,"",n),r}});Object.assign({},Lo,Ho,{JsonPatchError:Do,deepClone:ko,escapePathComponent:So,unescapePathComponent:Eo});var Go=/("(?:[^\\"]|\\.)*")|[:,]/g,Xo=function(e,t){var n,r,i;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),r=""===n?1/0:void 0===t.maxLength?80:t.maxLength,i=t.replacer,function e(t,a,o){var s,l,u,c,f,d,h,p,m,g,y,v;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,i)))return y;if(h=r-a.length-o,y.length<=h&&(m=y.replace(Go,(function(e,t){return t||e+" "}))).length<=h)return m;if(null!=i&&(t=JSON.parse(y),i=void 0),"object"==typeof t&&null!==t){if(p=a+n,u=[],l=0,Array.isArray(t))for(g="[",s="]",h=t.length;l<h;l++)u.push(e(t[l],p,l===h-1?0:1)||"null");else for(g="{",s="}",h=(d=Object.keys(t)).length;l<h;l++)c=d[l],f=JSON.stringify(c)+": ",void 0!==(v=e(t[c],p,f.length+(l===h-1?0:1)))&&u.push(f+v);if(u.length>0)return[g,n+u.join(",\n"+p),s].join("\n"+a)}return y}(e,"",0)};function Yo(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var Jo={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var Ko="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},Qo=Yo((function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=Jo,r=(t=e.exports={}).re=[],i=t.src=[],a=t.t={};let o=0;const s=(e,t,n)=>{const s=o++;Ko(s,t),a[e]=s,i[s]=t,r[s]=new RegExp(t,n?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),s("FULL",`^${i[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),s("LOOSE",`^${i[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),s("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",i[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));const Zo=["includePrerelease","loose","rtl"];var es=e=>e?"object"!=typeof e?{loose:!0}:Zo.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const ts=/^[0-9]+$/,ns=(e,t)=>{const n=ts.test(e),r=ts.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var rs={compareIdentifiers:ns,rcompareIdentifiers:(e,t)=>ns(t,e)};const{MAX_LENGTH:is,MAX_SAFE_INTEGER:as}=Jo,{re:os,t:ss}=Qo,{compareIdentifiers:ls}=rs;class us{constructor(e,t){if(t=es(t),e instanceof us){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>is)throw new TypeError(`version is longer than ${is} characters`);Ko("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?os[ss.LOOSE]:os[ss.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>as||this.major<0)throw new TypeError("Invalid major version");if(this.minor>as||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>as||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<as)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Ko("SemVer.compare",this.version,this.options,e),!(e instanceof us)){if("string"==typeof e&&e===this.version)return 0;e=new us(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof us||(e=new us(e,this.options)),ls(this.major,e.major)||ls(this.minor,e.minor)||ls(this.patch,e.patch)}comparePre(e){if(e instanceof us||(e=new us(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(Ko("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return ls(n,r)}while(++t)}compareBuild(e){e instanceof us||(e=new us(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(Ko("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return ls(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var cs=us;const{MAX_LENGTH:fs}=Jo,{re:ds,t:hs}=Qo;var ps=(e,t)=>{if(t=es(t),e instanceof cs)return e;if("string"!=typeof e)return null;if(e.length>fs)return null;if(!(t.loose?ds[hs.LOOSE]:ds[hs.FULL]).test(e))return null;try{return new cs(e,t)}catch(e){return null}};var ms=(e,t)=>{const n=ps(e,t);return n?n.version:null};var gs=(e,t)=>{const n=ps(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var ys=(e,t,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new cs(e,n).inc(t,r).version}catch(e){return null}};var vs=(e,t,n)=>new cs(e,n).compare(new cs(t,n));var bs=(e,t,n)=>0===vs(e,t,n);var xs=(e,t)=>{if(bs(e,t))return null;{const n=ps(e),r=ps(t),i=n.prerelease.length||r.prerelease.length,a=i?"pre":"",o=i?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return a+e;return o}};var ws=(e,t)=>new cs(e,t).major;var _s=(e,t)=>new cs(e,t).minor;var ks=(e,t)=>new cs(e,t).patch;var Os=(e,t)=>{const n=ps(e,t);return n&&n.prerelease.length?n.prerelease:null};var Ss=(e,t,n)=>vs(t,e,n);var Es=(e,t)=>vs(e,t,!0);var $s=(e,t,n)=>{const r=new cs(e,n),i=new cs(t,n);return r.compare(i)||r.compareBuild(i)};var As=(e,t)=>e.sort(((e,n)=>$s(e,n,t)));var Ds=(e,t)=>e.sort(((e,n)=>$s(n,e,t)));var Cs=(e,t,n)=>vs(e,t,n)>0;var Ms=(e,t,n)=>vs(e,t,n)<0;var js=(e,t,n)=>0!==vs(e,t,n);var Fs=(e,t,n)=>vs(e,t,n)>=0;var Ts=(e,t,n)=>vs(e,t,n)<=0;var Ns=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return bs(e,n,r);case"!=":return js(e,n,r);case">":return Cs(e,n,r);case">=":return Fs(e,n,r);case"<":return Ms(e,n,r);case"<=":return Ts(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const{re:Rs,t:Ps}=Qo;var zs=(e,t)=>{if(e instanceof cs)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=Rs[Ps.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),Rs[Ps.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;Rs[Ps.COERCERTL].lastIndex=-1}else n=e.match(Rs[Ps.COERCE]);return null===n?null:ps(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)},Bs=Ls;function Ls(e){var t=this;if(t instanceof Ls||(t=new Ls),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}function Is(e,t,n){var r=t===e.head?new Vs(n,null,t,e):new Vs(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function qs(e,t){e.tail=new Vs(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Us(e,t){e.head=new Vs(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Vs(e,t,n,r){if(!(this instanceof Vs))return new Vs(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}Ls.Node=Vs,Ls.create=Ls,Ls.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},Ls.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},Ls.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},Ls.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)qs(this,arguments[e]);return this.length},Ls.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Us(this,arguments[e]);return this.length},Ls.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},Ls.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},Ls.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},Ls.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},Ls.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},Ls.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},Ls.prototype.map=function(e,t){t=t||this;for(var n=new Ls,r=this.head;null!==r;)n.push(e.call(t,r.value,this)),r=r.next;return n},Ls.prototype.mapReverse=function(e,t){t=t||this;for(var n=new Ls,r=this.tail;null!==r;)n.push(e.call(t,r.value,this)),r=r.prev;return n},Ls.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},Ls.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},Ls.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},Ls.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},Ls.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new Ls;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;for(;null!==i&&r<t;r++,i=i.next)n.push(i.value);return n},Ls.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new Ls;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;null!==i&&r>t;r--)i=i.prev;for(;null!==i&&r>e;r--,i=i.prev)n.push(i.value);return n},Ls.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;var a=[];for(r=0;i&&r<t;r++)a.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(r=0;r<n.length;r++)i=Is(this,i,n[r]);return a},Ls.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(Ls)}catch(e){}const Ws=Symbol("max"),Hs=Symbol("length"),Gs=Symbol("lengthCalculator"),Xs=Symbol("allowStale"),Ys=Symbol("maxAge"),Js=Symbol("dispose"),Ks=Symbol("noDisposeOnSet"),Qs=Symbol("lruList"),Zs=Symbol("cache"),el=Symbol("updateAgeOnGet"),tl=()=>1;const nl=(e,t,n)=>{const r=e[Zs].get(t);if(r){const t=r.value;if(rl(e,t)){if(al(e,r),!e[Xs])return}else n&&(e[el]&&(r.value.now=Date.now()),e[Qs].unshiftNode(r));return t.value}},rl=(e,t)=>{if(!t||!t.maxAge&&!e[Ys])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[Ys]&&n>e[Ys]},il=e=>{if(e[Hs]>e[Ws])for(let t=e[Qs].tail;e[Hs]>e[Ws]&&null!==t;){const n=t.prev;al(e,t),t=n}},al=(e,t)=>{if(t){const n=t.value;e[Js]&&e[Js](n.key,n.value),e[Hs]-=n.length,e[Zs].delete(n.key),e[Qs].removeNode(t)}};class ol{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const sl=(e,t,n,r)=>{let i=n.value;rl(e,i)&&(al(e,n),e[Xs]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var ll=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[Ws]=e.max||1/0;const t=e.length||tl;if(this[Gs]="function"!=typeof t?tl:t,this[Xs]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[Ys]=e.maxAge||0,this[Js]=e.dispose,this[Ks]=e.noDisposeOnSet||!1,this[el]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[Ws]=e||1/0,il(this)}get max(){return this[Ws]}set allowStale(e){this[Xs]=!!e}get allowStale(){return this[Xs]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[Ys]=e,il(this)}get maxAge(){return this[Ys]}set lengthCalculator(e){"function"!=typeof e&&(e=tl),e!==this[Gs]&&(this[Gs]=e,this[Hs]=0,this[Qs].forEach((e=>{e.length=this[Gs](e.value,e.key),this[Hs]+=e.length}))),il(this)}get lengthCalculator(){return this[Gs]}get length(){return this[Hs]}get itemCount(){return this[Qs].length}rforEach(e,t){t=t||this;for(let n=this[Qs].tail;null!==n;){const r=n.prev;sl(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[Qs].head;null!==n;){const r=n.next;sl(this,e,n,t),n=r}}keys(){return this[Qs].toArray().map((e=>e.key))}values(){return this[Qs].toArray().map((e=>e.value))}reset(){this[Js]&&this[Qs]&&this[Qs].length&&this[Qs].forEach((e=>this[Js](e.key,e.value))),this[Zs]=new Map,this[Qs]=new Bs,this[Hs]=0}dump(){return this[Qs].map((e=>!rl(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[Qs]}set(e,t,n){if((n=n||this[Ys])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[Gs](t,e);if(this[Zs].has(e)){if(i>this[Ws])return al(this,this[Zs].get(e)),!1;const a=this[Zs].get(e).value;return this[Js]&&(this[Ks]||this[Js](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[Hs]+=i-a.length,a.length=i,this.get(e),il(this),!0}const a=new ol(e,t,i,r,n);return a.length>this[Ws]?(this[Js]&&this[Js](e,t),!1):(this[Hs]+=a.length,this[Qs].unshift(a),this[Zs].set(e,this[Qs].head),il(this),!0)}has(e){if(!this[Zs].has(e))return!1;const t=this[Zs].get(e).value;return!rl(this,t)}get(e){return nl(this,e,!0)}peek(e){return nl(this,e,!1)}pop(){const e=this[Qs].tail;return e?(al(this,e),e.value):null}del(e){al(this,this[Zs].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[Zs].forEach(((e,t)=>nl(this,t,!1)))}};class ul{constructor(e,t){if(t=es(t),e instanceof ul)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new ul(e.raw,t);if(e instanceof Tl)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!yl(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&vl(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=fl.get(t);if(n)return n;const r=this.options.loose,i=r?dl[hl.HYPHENRANGELOOSE]:dl[hl.HYPHENRANGE];e=e.replace(i,Cl(this.options.includePrerelease)),Ko("hyphen replace",e),e=e.replace(dl[hl.COMPARATORTRIM],pl),Ko("comparator trim",e,dl[hl.COMPARATORTRIM]),e=(e=(e=e.replace(dl[hl.TILDETRIM],ml)).replace(dl[hl.CARETTRIM],gl)).split(/\s+/).join(" ");const a=r?dl[hl.COMPARATORLOOSE]:dl[hl.COMPARATOR],o=e.split(" ").map((e=>xl(e,this.options))).join(" ").split(/\s+/).map((e=>Dl(e,this.options))).filter(this.options.loose?e=>!!e.match(a):()=>!0).map((e=>new Tl(e,this.options))),s=(o.length,new Map);for(const e of o){if(yl(e))return[e];s.set(e.value,e)}s.size>1&&s.has("")&&s.delete("");const l=[...s.values()];return fl.set(t,l),l}intersects(e,t){if(!(e instanceof ul))throw new TypeError("a Range is required");return this.set.some((n=>bl(n,t)&&e.set.some((e=>bl(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new cs(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Ml(this.set[t],e,this.options))return!0;return!1}}var cl=ul;const fl=new ll({max:1e3}),{re:dl,t:hl,comparatorTrimReplace:pl,tildeTrimReplace:ml,caretTrimReplace:gl}=Qo,yl=e=>"<0.0.0-0"===e.value,vl=e=>""===e.value,bl=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},xl=(e,t)=>(Ko("comp",e,t),e=Ol(e,t),Ko("caret",e),e=_l(e,t),Ko("tildes",e),e=El(e,t),Ko("xrange",e),e=Al(e,t),Ko("stars",e),e),wl=e=>!e||"x"===e.toLowerCase()||"*"===e,_l=(e,t)=>e.trim().split(/\s+/).map((e=>kl(e,t))).join(" "),kl=(e,t)=>{const n=t.loose?dl[hl.TILDELOOSE]:dl[hl.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return Ko("tilde",e,t,n,r,i,a),wl(n)?o="":wl(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:wl(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(Ko("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,Ko("tilde return",o),o}))},Ol=(e,t)=>e.trim().split(/\s+/).map((e=>Sl(e,t))).join(" "),Sl=(e,t)=>{Ko("caret",e,t);const n=t.loose?dl[hl.CARETLOOSE]:dl[hl.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let s;return Ko("caret",e,t,n,i,a,o),wl(n)?s="":wl(i)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:wl(a)?s="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(Ko("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(Ko("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),Ko("caret return",s),s}))},El=(e,t)=>(Ko("replaceXRanges",e,t),e.split(/\s+/).map((e=>$l(e,t))).join(" ")),$l=(e,t)=>{e=e.trim();const n=t.loose?dl[hl.XRANGELOOSE]:dl[hl.XRANGE];return e.replace(n,((n,r,i,a,o,s)=>{Ko("xRange",e,n,r,i,a,o,s);const l=wl(i),u=l||wl(a),c=u||wl(o),f=c;return"="===r&&f&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&f?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(s="-0"),n=`${r+i}.${a}.${o}${s}`):u?n=`>=${i}.0.0${s} <${+i+1}.0.0-0`:c&&(n=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`),Ko("xRange return",n),n}))},Al=(e,t)=>(Ko("replaceStars",e,t),e.trim().replace(dl[hl.STAR],"")),Dl=(e,t)=>(Ko("replaceGTE0",e,t),e.trim().replace(dl[t.includePrerelease?hl.GTE0PRE:hl.GTE0],"")),Cl=e=>(t,n,r,i,a,o,s,l,u,c,f,d,h)=>`${n=wl(r)?"":wl(i)?`>=${r}.0.0${e?"-0":""}`:wl(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=wl(u)?"":wl(c)?`<${+u+1}.0.0-0`:wl(f)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${f}-${d}`:e?`<${u}.${c}.${+f+1}-0`:`<=${l}`}`.trim(),Ml=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(Ko(e[n].semver),e[n].semver!==Tl.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},jl=Symbol("SemVer ANY");class Fl{static get ANY(){return jl}constructor(e,t){if(t=es(t),e instanceof Fl){if(e.loose===!!t.loose)return e;e=e.value}Ko("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===jl?this.value="":this.value=this.operator+this.semver.version,Ko("comp",this)}parse(e){const t=this.options.loose?Nl[Rl.COMPARATORLOOSE]:Nl[Rl.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new cs(n[2],this.options.loose):this.semver=jl}toString(){return this.value}test(e){if(Ko("Comparator.test",e,this.options.loose),this.semver===jl||e===jl)return!0;if("string"==typeof e)try{e=new cs(e,this.options)}catch(e){return!1}return Ns(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Fl))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new cl(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new cl(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=Ns(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),s=Ns(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||i&&a||o||s}}var Tl=Fl;const{re:Nl,t:Rl}=Qo;var Pl=(e,t,n)=>{try{t=new cl(t,n)}catch(e){return!1}return t.test(e)};var zl=(e,t)=>new cl(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));var Bl=(e,t,n)=>{let r=null,i=null,a=null;try{a=new cl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new cs(r,n)))})),r};var Ll=(e,t,n)=>{let r=null,i=null,a=null;try{a=new cl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new cs(r,n)))})),r};var Il=(e,t)=>{e=new cl(e,t);let n=new cs("0.0.0");if(e.test(n))return n;if(n=new cs("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let i=null;r.forEach((e=>{const t=new cs(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!Cs(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||n&&!Cs(n,i)||(n=i)}return n&&e.test(n)?n:null};var ql=(e,t)=>{try{return new cl(e,t).range||"*"}catch(e){return null}};const{ANY:Ul}=Tl;var Vl=(e,t,n,r)=>{let i,a,o,s,l;switch(e=new cs(e,r),t=new cl(t,r),n){case">":i=Cs,a=Ts,o=Ms,s=">",l=">=";break;case"<":i=Ms,a=Fs,o=Cs,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Pl(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let c=null,f=null;if(u.forEach((e=>{e.semver===Ul&&(e=new Tl(">=0.0.0")),c=c||e,f=f||e,i(e.semver,c.semver,r)?c=e:o(e.semver,f.semver,r)&&(f=e)})),c.operator===s||c.operator===l)return!1;if((!f.operator||f.operator===s)&&a(e,f.semver))return!1;if(f.operator===l&&o(e,f.semver))return!1}return!0};var Wl=(e,t,n)=>Vl(e,t,">",n);var Hl=(e,t,n)=>Vl(e,t,"<",n);var Gl=(e,t,n)=>(e=new cl(e,n),t=new cl(t,n),e.intersects(t));const{ANY:Xl}=Tl,Yl=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===Xl)return 1===t.length&&t[0].semver===Xl;const r=new Set;let i,a,o,s,l,u,c;for(const t of e)">"===t.operator||">="===t.operator?i=Jl(i,t,n):"<"===t.operator||"<="===t.operator?a=Kl(a,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&a){if(o=vs(i.semver,a.semver,n),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==a.operator))return null}for(const e of r){if(i&&!Pl(e,String(i),n))return null;if(a&&!Pl(e,String(a),n))return null;for(const r of t)if(!Pl(e,String(r),n))return!1;return!0}for(const e of t){if(c=c||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,i)if(">"===e.operator||">="===e.operator){if(s=Jl(i,e,n),s===e&&s!==i)return!1}else if(">="===i.operator&&!Pl(i.semver,String(e),n))return!1;if(a)if("<"===e.operator||"<="===e.operator){if(l=Kl(a,e,n),l===e&&l!==a)return!1}else if("<="===a.operator&&!Pl(a.semver,String(e),n))return!1;if(!e.operator&&(a||i)&&0!==o)return!1}return!(i&&u&&!a&&0!==o)&&!(a&&c&&!i&&0!==o)},Jl=(e,t,n)=>{if(!e)return t;const r=vs(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},Kl=(e,t,n)=>{if(!e)return t;const r=vs(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var Ql=(e,t,n)=>{if(e===t)return!0;e=new cl(e,n),t=new cl(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=Yl(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},Zl={re:Qo.re,src:Qo.src,tokens:Qo.t,SEMVER_SPEC_VERSION:Jo.SEMVER_SPEC_VERSION,SemVer:cs,compareIdentifiers:rs.compareIdentifiers,rcompareIdentifiers:rs.rcompareIdentifiers,parse:ps,valid:ms,clean:gs,inc:ys,diff:xs,major:ws,minor:_s,patch:ks,prerelease:Os,compare:vs,rcompare:Ss,compareLoose:Es,compareBuild:$s,sort:As,rsort:Ds,gt:Cs,lt:Ms,eq:bs,neq:js,gte:Fs,lte:Ts,cmp:Ns,coerce:zs,Comparator:Tl,Range:cl,satisfies:Pl,toComparators:zl,maxSatisfying:Bl,minSatisfying:Ll,minVersion:Il,validRange:ql,outside:Vl,gtr:Wl,ltr:Hl,intersects:Gl,simplifyRange:(e,t,n)=>{const r=[];let i=null,a=null;const o=e.sort(((e,t)=>vs(e,t,n)));for(const e of o){Pl(e,t,n)?(a=e,i||(i=e)):(a&&r.push([i,a]),a=null,i=null)}i&&r.push([i,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return l.length<u.length?l:t},subset:Ql};function eu(e,t,n){return e.fields=t||[],e.fname=n,e}function tu(e){return null==e?null:e.fname}function nu(e){return null==e?null:e.fields}function ru(e){return 1===e.length?iu(e[0]):au(e)}const iu=e=>function(t){return t[e]},au=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ou(e){throw Error(e)}function su(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||ou("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&ou("Access path missing closing bracket: "+e),o&&ou("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function lu(e,t,n){const r=su(e);return e=1===r.length?r[0]:e,eu((n&&n.get||ru)(r),[e],t||e)}const uu=lu("id"),cu=eu((e=>e),[],"identity"),fu=eu((()=>0),[],"zero"),du=eu((()=>1),[],"one"),hu=eu((()=>!0),[],"true"),pu=eu((()=>!1),[],"false");function mu(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}function gu(e,t){let n=e||0;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=1&&mu(t||"error","ERROR",arguments),this},warn(){return n>=2&&mu(t||"warn","WARN",arguments),this},info(){return n>=3&&mu(t||"log","INFO",arguments),this},debug(){return n>=4&&mu(t||"log","DEBUG",arguments),this}}}var yu=Array.isArray;function vu(e){return e===Object(e)}const bu=e=>"__proto__"!==e;function xu(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=_u(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;wu(e,n,t[n],r)}return e}),{})}function wu(e,t,n,r){if(!bu(t))return;let i,a;if(vu(n)&&!yu(n))for(i in a=vu(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?wu(a,i,n[i]):bu(i)&&(a[i]=n[i]);else e[t]=n}function _u(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function ku(e){return e[e.length-1]}function Ou(e){return null==e||""===e?null:+e}const Su=e=>t=>e*Math.exp(t),Eu=e=>t=>Math.log(e*t),$u=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Au=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Du=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Cu(e,t,n,r){const i=n(e[0]),a=n(ku(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Mu(e,t){return Cu(e,t,Ou,cu)}function ju(e,t){var n=Math.sign(e[0]);return Cu(e,t,Eu(n),Su(n))}function Fu(e,t,n){return Cu(e,t,Du(n),Du(1/n))}function Tu(e,t,n){return Cu(e,t,$u(n),Au(n))}function Nu(e,t,n,r,i){const a=r(e[0]),o=r(ku(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function Ru(e,t,n){return Nu(e,t,n,Ou,cu)}function Pu(e,t,n){const r=Math.sign(e[0]);return Nu(e,t,n,Eu(r),Su(r))}function zu(e,t,n,r){return Nu(e,t,n,Du(r),Du(1/r))}function Bu(e,t,n,r){return Nu(e,t,n,$u(r),Au(r))}function Lu(e){return 1+~~(new Date(e).getMonth()/3)}function Iu(e){return 1+~~(new Date(e).getUTCMonth()/3)}function qu(e){return null!=e?yu(e)?e:[e]:[]}function Uu(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function Vu(e){return"function"==typeof e}function Wu(e,t,n){n=n||{},t=qu(t)||[];const r=[],i=[],a={},o=n.comparator||Gu;return qu(e).forEach(((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=Vu(e)?e:lu(e,null,n)),(nu(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:eu(o(i,r),Object.keys(a))}const Hu=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),Gu=(e,t)=>1===e.length?Xu(e[0],t[0]):Yu(e,t,e.length),Xu=(e,t)=>function(n,r){return Hu(e(n),e(r))*t},Yu=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=Hu(a(r),a(i));return o*t[s]});function Ju(e){return Vu(e)?e:()=>e}function Ku(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function Qu(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function Zu(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function ec(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const tc=Object.prototype.hasOwnProperty;function nc(e,t){return tc.call(e,t)}const rc={};function ic(e){let t,n={};function r(e){return nc(n,e)&&n[e]!==rc}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===rc&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=rc),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===rc||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function ac(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=ku(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function oc(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,Qu(r,n)}function sc(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function lc(e){return"boolean"==typeof e}function uc(e){return"[object Date]"===Object.prototype.toString.call(e)}function cc(e){return e&&Vu(e[Symbol.iterator])}function fc(e){return"number"==typeof e}function dc(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function hc(e){return"string"==typeof e}function pc(e,t,n){e&&(e=t?qu(e).map((e=>e.replace(/\\(.)/g,"$1"))):qu(e));const r=e&&e.length,i=n&&n.get||ru,a=e=>i(t?[e]:su(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return eu(o,e,"key")}function mc(e,t){const n=e[0],r=ku(e),i=+t;return i?1===i?r:n+i*(r-n):n}function gc(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>nc(t,e)||nc(n,e),get:e=>nc(t,e)?t[e]:nc(n,e)?a(e,n[e]):void 0,set:(e,n)=>nc(t,e)?t[e]=n:a(e,n)}}function yc(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function vc(e,t){let n="";for(;--t>=0;)n+=e;return n}function bc(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?vc(i,o)+a:"center"===r?vc(i,~~(o/2))+a+vc(i,Math.ceil(o/2)):a+vc(i,o)}function xc(e){return e&&ku(e)-e[0]||0}function wc(e){return yu(e)?"["+e.map(wc)+"]":vu(e)||hc(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function _c(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}const kc=e=>fc(e)||uc(e)?e:Date.parse(e);function Oc(e,t){return t=t||kc,null==e||""===e?null:t(e)}function Sc(e){return null==e||""===e?null:e+""}function Ec(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function $c(e,t,n,r){const i=null!=r?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function Ac(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const Dc=/^([A-Za-z]+:)?\/\//,Cc=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Mc=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,jc="file://";async function Fc(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function Tc(e,t){t=Qu({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=Cc.test(e.replace(Mc,""));null!=e&&"string"==typeof e&&s||ou("Sanitize failure, invalid URI: "+wc(e));const l=Dc.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(jc))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(jc.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function Nc(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):Rc}async function Rc(){ou("No file system access.")}function Pc(e){return e?async function(t,n){const r=Qu({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?Vu(a[i])?a[i]():a.text():ou(a.status+""+a.statusText)}:zc}async function zc(){ou("No HTTP fetch method available.")}const Bc=e=>null!=e&&e==e,Lc=e=>!(Number.isNaN(+e)||e instanceof Date),Ic={boolean:_c,integer:Ou,number:Ou,date:Oc,string:Sc,unknown:cu},qc=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>Lc(e)&&Number.isInteger(+e),Lc,e=>!Number.isNaN(Date.parse(e))],Uc=["boolean","integer","number","date"];function Vc(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=qc.length,i=qc.map(((e,t)=>t+1));for(let a,o,s=0,l=0;s<n;++s)for(o=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&Bc(o)&&!qc[a](o)&&(i[a]=0,++l,l===qc.length))return"string";return Uc[i.reduce(((e,t)=>0===e?t:e),0)-1]}function Wc(e,t){return t.reduce(((t,n)=>(t[n]=Vc(e,n),t)),{})}var Hc={},Gc={};function Xc(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function Yc(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function Jc(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Kc(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+Jc(-e,6):e>9999?"+"+Jc(e,6):Jc(e,4)}(e.getUTCFullYear())+"-"+Jc(e.getUTCMonth()+1,2)+"-"+Jc(e.getUTCDate(),2)+(i?"T"+Jc(t,2)+":"+Jc(n,2)+":"+Jc(r,2)+"."+Jc(i,3)+"Z":r?"T"+Jc(t,2)+":"+Jc(n,2)+":"+Jc(r,2)+"Z":n||t?"T"+Jc(t,2)+":"+Jc(n,2)+"Z":"")}function Qc(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return Gc;if(u)return u=!1,Hc;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==Gc;){for(var f=[];r!==Hc&&r!==Gc;)f.push(r),r=c();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?Kc(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=Xc(e);return function(r,i){return t(n(r),i,e)}}(e,t):Xc(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=Yc(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=Yc(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}function Zc(e){const t=function(t,n){const r={delimiter:e};return ef(t,n?Qu(n,r):r)};return t.responseType="text",t}function ef(e,t){return t.header&&(e=t.header.map(wc).join(t.delimiter)+"\n"+e),Qc(t.delimiter).parse(e+"")}function tf(e,t){const n=t&&t.property?lu(t.property):cu;return vu(e)&&!function(e){return!("function"!=typeof Buffer||!Vu(Buffer.isBuffer))&&Buffer.isBuffer(e)}(e)?function(e,t){!yu(e)&&cc(e)&&(e=[...e]);return t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t):n(JSON.parse(e))}function nf(e){return e}function rf(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return af(e,t)}))}:af(e,t)}function af(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=of(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function of(e,t){var n=function(e){if(null==e)return nf;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function sf(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1];return t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function lf(e){return of(e,uf.apply(this,arguments))}function uf(e,t,n){var r,i,a;if(arguments.length>1)r=cf(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:sf(e,r)}}function cf(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}ef.responseType="text",tf.responseType="json";const ff={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function df(e,t){let n,r,i,a;return e=tf(e,t),t&&t.feature?(n=rf,i=t.feature):t&&t.mesh?(n=lf,i=t.mesh,a=ff[t.filter]):ou("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):ou("Invalid TopoJSON object: "+i),r&&r.features||[r]}df.responseType="json";const hf={dsv:ef,csv:Zc(","),tsv:Zc("\t"),json:tf,topojson:df};function pf(e,t){return arguments.length>1?(hf[e]=t,this):nc(hf,e)?hf[e]:null}function mf(e){const t=pf(e);return t&&t.responseType||"text"}function gf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function yf(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>gf(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}function vf(e){return null===e?NaN:+e}const bf=yf(gf),xf=bf.right,wf=bf.left;yf(vf).center;class _f{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var kf=Math.sqrt(50),Of=Math.sqrt(10),Sf=Math.sqrt(2);function Ef(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=$f(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a}function $f(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=kf?10:a>=Of?5:a>=Sf?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=kf?10:a>=Of?5:a>=Sf?2:1)}function Af(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=kf?i*=10:a>=Of?i*=5:a>=Sf&&(i*=2),t<e?-i:i}function Df(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function Cf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function Mf(e,t,n=0,r=e.length-1,i=gf){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Mf(e,t,Math.max(n,Math.floor(t-o*l/a+u)),Math.min(r,Math.floor(t+(a-o)*l/a+u)),i)}const a=e[t];let o=n,s=r;for(jf(e,n,t),i(e[r],a)>0&&jf(e,n,r);o<s;){for(jf(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?jf(e,n,s):(++s,jf(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function jf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Ff(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return Cf(e);if(t>=1)return Df(e);var r,i=(r-1)*t,a=Math.floor(i),o=Df(Mf(e,a).subarray(0,a+1));return o+(Cf(e.subarray(a+1))-o)*(i-a)}}function Tf(e,t,n=vf){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function Nf(e,t){return Ff(e,.5,t)}function Rf(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function Pf(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function zf(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function Bf(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Lf(e){return(e=Bf(Math.abs(e)))?e[1]:NaN}var If,qf=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Uf(e){if(!(t=qf.exec(e)))throw new Error("invalid format: "+e);var t;return new Vf({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Vf(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Wf(e,t){var n=Bf(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Uf.prototype=Vf.prototype,Vf.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Hf={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Wf(100*e,t),r:Wf,s:function(e,t){var n=Bf(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(If=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Bf(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Gf(e){return e}var Xf,Yf,Jf,Kf=Array.prototype.map,Qf=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Zf(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Gf:(t=Kf.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Gf:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Kf.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=Uf(e)).fill,n=e.align,f=e.sign,d=e.symbol,h=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):Hf[v]||(void 0===g&&(g=12),y=!0,v="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?a:/[%p]/.test(v)?l:"",w=Hf[v],_=/[defgprs%]/.test(v);function k(e){var i,a,l,d=b,k=x;if("c"===v)k=w(e)+k,e="";else{var O=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),O&&0==+e&&"+"!==f&&(O=!1),d=(O?"("===f?f:u:"-"===f||"("===f?"":f)+d,k=("s"===v?Qf[8+If/3]:"")+k+(O&&"("===f?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}m&&!h&&(e=r(e,1/0));var S=d.length+e.length+k.length,E=S<p?new Array(p-S+1).join(t):"";switch(m&&h&&(e=r(E+e,E.length?p-k.length:1/0),E=""),n){case"<":e=d+e+k+E;break;case"=":e=d+E+e+k;break;case"^":e=E.slice(0,S=E.length>>1)+d+e+k+E.slice(S);break;default:e=E+d+e+k}return s(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:f,formatPrefix:function(e,t){var n=f(((e=Uf(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Lf(t)/3))),i=Math.pow(10,-r),a=Qf[8+r/3];return function(e){return n(i*e)+a}}}}function ed(e){return Math.max(0,-Lf(Math.abs(e)))}function td(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Lf(t)/3)))-Lf(Math.abs(e)))}function nd(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Lf(t)-Lf(e))+1}!function(e){Xf=Zf(e),Yf=Xf.format,Jf=Xf.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var rd=new Date,id=new Date;function ad(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return ad((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return rd.setTime(+t),id.setTime(+r),e(rd),e(id),Math.floor(n(rd,id))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var od=ad((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));od.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?ad((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):od:null};var sd=1e3,ld=6e4,ud=36e5,cd=864e5,fd=6048e5,dd=ad((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*sd)}),(function(e,t){return(t-e)/sd}),(function(e){return e.getUTCSeconds()})),hd=ad((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sd)}),(function(e,t){e.setTime(+e+t*ld)}),(function(e,t){return(t-e)/ld}),(function(e){return e.getMinutes()})),pd=ad((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sd-e.getMinutes()*ld)}),(function(e,t){e.setTime(+e+t*ud)}),(function(e,t){return(t-e)/ud}),(function(e){return e.getHours()})),md=ad((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ld)/cd),(e=>e.getDate()-1));function gd(e){return ad((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ld)/fd}))}var yd=gd(0),vd=gd(1),bd=(gd(2),gd(3),gd(4)),xd=(gd(5),gd(6),ad((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),wd=ad((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));wd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?ad((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var _d=ad((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*ld)}),(function(e,t){return(t-e)/ld}),(function(e){return e.getUTCMinutes()})),kd=ad((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*ud)}),(function(e,t){return(t-e)/ud}),(function(e){return e.getUTCHours()})),Od=ad((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/cd}),(function(e){return e.getUTCDate()-1}));function Sd(e){return ad((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/fd}))}var Ed=Sd(0),$d=Sd(1),Ad=(Sd(2),Sd(3),Sd(4)),Dd=(Sd(5),Sd(6),ad((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}))),Cd=ad((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));Cd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?ad((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const Md="year",jd="quarter",Fd="month",Td="week",Nd="date",Rd="day",Pd="dayofyear",zd="hours",Bd="minutes",Ld="seconds",Id="milliseconds",qd=[Md,jd,Fd,Td,Nd,Rd,Pd,zd,Bd,Ld,Id],Ud=qd.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function Vd(e){const t=qu(e).slice(),n={};t.length||ou("Missing time unit."),t.forEach((e=>{nc(Ud,e)?n[e]=1:ou("Invalid time unit: ".concat(e,"."))}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&ou("Incompatible time units: ".concat(e)),t.sort(((e,t)=>Ud[e]-Ud[t])),t}const Wd={[Md]:"%Y ",[jd]:"Q%q ",[Fd]:"%b ",[Nd]:"%d ",[Td]:"W%U ",[Rd]:"%a ",[Pd]:"%j ",[zd]:"%H:00",[Bd]:"00:%M",[Ld]:":%S",[Id]:".%L",["".concat(Md,"-").concat(Fd)]:"%Y-%m ",["".concat(Md,"-").concat(Fd,"-").concat(Nd)]:"%Y-%m-%d ",["".concat(zd,"-").concat(Bd)]:"%H:%M"};function Hd(e,t){const n=Qu({},Wd,t),r=Vd(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const Gd=new Date;function Xd(e){return Gd.setFullYear(e),Gd.setMonth(0),Gd.setDate(1),Gd.setHours(0,0,0,0),Gd}function Yd(e){return Kd(new Date(e))}function Jd(e){return Qd(new Date(e))}function Kd(e){return md.count(Xd(e.getFullYear())-1,e)}function Qd(e){return yd.count(Xd(e.getFullYear())-1,e)}function Zd(e){return Xd(e).getDay()}function eh(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function th(e){return rh(new Date(e))}function nh(e){return ih(new Date(e))}function rh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Od.count(t-1,e)}function ih(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Ed.count(t-1,e)}function ah(e){return Gd.setTime(Date.UTC(e,0,1)),Gd.getUTCDay()}function oh(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function sh(e,t,n,r,i){const a=t||1,o=ku(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=Ec(e),c=u.year?s(Md):Ju(2012),f=u.month?s(Fd):u.quarter?s(jd):fu,d=u.week&&u.day?s(Rd,1,Td+Rd):u.week?s(Td,1):u.day?s(Rd,1):u.date?s(Nd,1):u.dayofyear?s(Pd,1):du,h=u.hours?s(zd):fu,p=u.minutes?s(Bd):fu,m=u.seconds?s(Ld):fu,g=u.milliseconds?s(Id):fu;return function(e){l.setTime(+e);const t=c(l);return i(t,f(l),d(l,t),h(l),p(l),m(l),g(l))}}function lh(e,t,n){return t+7*e-(n+6)%7}const uh={[Md]:e=>e.getFullYear(),[jd]:e=>Math.floor(e.getMonth()/3),[Fd]:e=>e.getMonth(),[Nd]:e=>e.getDate(),[zd]:e=>e.getHours(),[Bd]:e=>e.getMinutes(),[Ld]:e=>e.getSeconds(),[Id]:e=>e.getMilliseconds(),[Pd]:e=>Kd(e),[Td]:e=>Qd(e),[Td+Rd]:(e,t)=>lh(Qd(e),e.getDay(),Zd(t)),[Rd]:(e,t)=>lh(1,e.getDay(),Zd(t))},ch={[jd]:e=>3*e,[Td]:(e,t)=>lh(e,0,Zd(t))};function fh(e,t){return sh(e,t||1,uh,ch,eh)}const dh={[Md]:e=>e.getUTCFullYear(),[jd]:e=>Math.floor(e.getUTCMonth()/3),[Fd]:e=>e.getUTCMonth(),[Nd]:e=>e.getUTCDate(),[zd]:e=>e.getUTCHours(),[Bd]:e=>e.getUTCMinutes(),[Ld]:e=>e.getUTCSeconds(),[Id]:e=>e.getUTCMilliseconds(),[Pd]:e=>rh(e),[Td]:e=>ih(e),[Rd]:(e,t)=>lh(1,e.getUTCDay(),ah(t)),[Td+Rd]:(e,t)=>lh(ih(e),e.getUTCDay(),ah(t))},hh={[jd]:e=>3*e,[Td]:(e,t)=>lh(e,0,ah(t))};function ph(e,t){return sh(e,t||1,dh,hh,oh)}const mh={[Md]:wd,[jd]:xd.every(3),[Fd]:xd,[Td]:yd,[Nd]:md,[Rd]:md,[Pd]:md,[zd]:pd,[Bd]:hd,[Ld]:dd,[Id]:od},gh={[Md]:Cd,[jd]:Dd.every(3),[Fd]:Dd,[Td]:Ed,[Nd]:Od,[Rd]:Od,[Pd]:Od,[zd]:kd,[Bd]:_d,[Ld]:dd,[Id]:od};function yh(e){return mh[e]}function vh(e){return gh[e]}function bh(e,t,n){return e?e.offset(t,n):void 0}function xh(e,t,n){return bh(yh(e),t,n)}function wh(e,t,n){return bh(vh(e),t,n)}function _h(e,t,n,r){return e?e.range(t,n,r):void 0}function kh(e,t,n,r){return _h(yh(e),t,n,r)}function Oh(e,t,n,r){return _h(vh(e),t,n,r)}const Sh=1e3,Eh=6e4,$h=36e5,Ah=864e5,Dh=2592e6,Ch=31536e6,Mh=[Md,Fd,Nd,zd,Bd,Ld,Id],jh=Mh.slice(0,-1),Fh=jh.slice(0,-1),Th=Fh.slice(0,-1),Nh=Th.slice(0,-1),Rh=[Md,Fd],Ph=[Md],zh=[[jh,1,Sh],[jh,5,5e3],[jh,15,15e3],[jh,30,3e4],[Fh,1,Eh],[Fh,5,3e5],[Fh,15,9e5],[Fh,30,18e5],[Th,1,$h],[Th,3,108e5],[Th,6,216e5],[Th,12,432e5],[Nh,1,Ah],[[Md,Td],1,6048e5],[Rh,1,Dh],[Rh,3,7776e6],[Ph,1,Ch]];function Bh(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(xc(t))/n;let i,a,o=yf((e=>e[2])).right(zh,r);return o===zh.length?(i=Ph,a=Af(t[0]/Ch,t[1]/Ch,n)):o?(o=zh[r/zh[o-1][2]<zh[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=Mh,a=Math.max(Af(t[0],t[1],n),1)),{units:i,step:a}}function Lh(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ih(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function qh(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function Uh(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=tp(i),c=np(i),f=tp(a),d=np(a),h=tp(o),p=np(o),m=tp(s),g=np(s),y=tp(l),v=np(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:kp,e:kp,f:Ap,g:Bp,G:Ip,H:Op,I:Sp,j:Ep,L:$p,m:Dp,M:Cp,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:cm,s:fm,S:Mp,u:jp,U:Fp,V:Np,w:Rp,W:Pp,x:null,X:null,y:zp,Y:Lp,Z:qp,"%":um},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:Up,e:Up,f:Xp,g:am,G:sm,H:Vp,I:Wp,j:Hp,L:Gp,m:Yp,M:Jp,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:cm,s:fm,S:Kp,u:Qp,U:Zp,V:tm,w:nm,W:rm,x:null,X:null,y:im,Y:om,Z:lm,"%":um},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=y.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return O(e,t,n,r)},d:hp,e:hp,f:bp,g:up,G:lp,H:mp,I:mp,j:pp,L:vp,m:dp,M:gp,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:fp,Q:wp,s:_p,S:yp,u:ip,U:ap,V:op,w:rp,W:sp,x:function(e,t,r){return O(e,n,t,r)},X:function(e,t,n){return O(e,r,t,n)},y:up,Y:lp,Z:cp,"%":xp};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=Yh[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=qh(1900,void 0,1);if(O(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=Ih(qh(a.y,0,1))).getUTCDay(),r=i>4||0===i?$d.ceil(r):$d(r),r=Od.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=Lh(qh(a.y,0,1))).getDay(),r=i>4||0===i?vd.ceil(r):vd(r),r=md.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?Ih(qh(a.y,0,1)).getUTCDay():Lh(qh(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,Ih(a)):Lh(a)}}function O(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in Yh?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var Vh,Wh,Hh,Gh,Xh,Yh={"-":"",_:" ",0:"0"},Jh=/^\s*\d+/,Kh=/^%/,Qh=/[\\^$*+?|[\]().{}]/g;function Zh(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function ep(e){return e.replace(Qh,"\\$&")}function tp(e){return new RegExp("^(?:"+e.map(ep).join("|")+")","i")}function np(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function rp(e,t,n){var r=Jh.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function ip(e,t,n){var r=Jh.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function ap(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function op(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function sp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function lp(e,t,n){var r=Jh.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function up(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function cp(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function fp(e,t,n){var r=Jh.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function dp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function hp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function pp(e,t,n){var r=Jh.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function mp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function gp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function yp(e,t,n){var r=Jh.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function vp(e,t,n){var r=Jh.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function bp(e,t,n){var r=Jh.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function xp(e,t,n){var r=Kh.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function wp(e,t,n){var r=Jh.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function _p(e,t,n){var r=Jh.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function kp(e,t){return Zh(e.getDate(),t,2)}function Op(e,t){return Zh(e.getHours(),t,2)}function Sp(e,t){return Zh(e.getHours()%12||12,t,2)}function Ep(e,t){return Zh(1+md.count(wd(e),e),t,3)}function $p(e,t){return Zh(e.getMilliseconds(),t,3)}function Ap(e,t){return $p(e,t)+"000"}function Dp(e,t){return Zh(e.getMonth()+1,t,2)}function Cp(e,t){return Zh(e.getMinutes(),t,2)}function Mp(e,t){return Zh(e.getSeconds(),t,2)}function jp(e){var t=e.getDay();return 0===t?7:t}function Fp(e,t){return Zh(yd.count(wd(e)-1,e),t,2)}function Tp(e){var t=e.getDay();return t>=4||0===t?bd(e):bd.ceil(e)}function Np(e,t){return e=Tp(e),Zh(bd.count(wd(e),e)+(4===wd(e).getDay()),t,2)}function Rp(e){return e.getDay()}function Pp(e,t){return Zh(vd.count(wd(e)-1,e),t,2)}function zp(e,t){return Zh(e.getFullYear()%100,t,2)}function Bp(e,t){return Zh((e=Tp(e)).getFullYear()%100,t,2)}function Lp(e,t){return Zh(e.getFullYear()%1e4,t,4)}function Ip(e,t){var n=e.getDay();return Zh((e=n>=4||0===n?bd(e):bd.ceil(e)).getFullYear()%1e4,t,4)}function qp(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Zh(t/60|0,"0",2)+Zh(t%60,"0",2)}function Up(e,t){return Zh(e.getUTCDate(),t,2)}function Vp(e,t){return Zh(e.getUTCHours(),t,2)}function Wp(e,t){return Zh(e.getUTCHours()%12||12,t,2)}function Hp(e,t){return Zh(1+Od.count(Cd(e),e),t,3)}function Gp(e,t){return Zh(e.getUTCMilliseconds(),t,3)}function Xp(e,t){return Gp(e,t)+"000"}function Yp(e,t){return Zh(e.getUTCMonth()+1,t,2)}function Jp(e,t){return Zh(e.getUTCMinutes(),t,2)}function Kp(e,t){return Zh(e.getUTCSeconds(),t,2)}function Qp(e){var t=e.getUTCDay();return 0===t?7:t}function Zp(e,t){return Zh(Ed.count(Cd(e)-1,e),t,2)}function em(e){var t=e.getUTCDay();return t>=4||0===t?Ad(e):Ad.ceil(e)}function tm(e,t){return e=em(e),Zh(Ad.count(Cd(e),e)+(4===Cd(e).getUTCDay()),t,2)}function nm(e){return e.getUTCDay()}function rm(e,t){return Zh($d.count(Cd(e)-1,e),t,2)}function im(e,t){return Zh(e.getUTCFullYear()%100,t,2)}function am(e,t){return Zh((e=em(e)).getUTCFullYear()%100,t,2)}function om(e,t){return Zh(e.getUTCFullYear()%1e4,t,4)}function sm(e,t){var n=e.getUTCDay();return Zh((e=n>=4||0===n?Ad(e):Ad.ceil(e)).getUTCFullYear()%1e4,t,4)}function lm(){return"+0000"}function um(){return"%"}function cm(e){return+e}function fm(e){return Math.floor(+e/1e3)}function dm(e){const t={};return n=>t[n]||(t[n]=e(n))}function hm(e){const t=dm(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=Uf(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=Uf(null==a?",f":a);const o=Af(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=td(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=nd(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=ed(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let pm,mm;function gm(){return pm=hm({format:Yf,formatPrefix:Jf})}function ym(e){return hm(Zf(e))}function vm(e){return arguments.length?pm=ym(e):pm}function bm(e,t,n){vu(n=n||{})||ou("Invalid time multi-format specifier: ".concat(n));const r=t(Ld),i=t(Bd),a=t(zd),o=t(Nd),s=t(Td),l=t(Fd),u=t(jd),c=t(Md),f=e(n.milliseconds||".%L"),d=e(n.seconds||":%S"),h=e(n.minutes||"%I:%M"),p=e(n.hours||"%I %p"),m=e(n.date||n.day||"%a %d"),g=e(n.week||"%b %d"),y=e(n.month||"%B"),v=e(n.quarter||"%B"),b=e(n.year||"%Y");return e=>(r(e)<e?f:i(e)<e?d:a(e)<e?h:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?y:v:b)(e)}function xm(e){const t=dm(e.format),n=dm(e.utcFormat);return{timeFormat:e=>hc(e)?t(e):bm(t,yh,e),utcFormat:e=>hc(e)?n(e):bm(n,vh,e),timeParse:dm(e.parse),utcParse:dm(e.utcParse)}}function wm(){return mm=xm({format:Wh,parse:Hh,utcFormat:Gh,utcParse:Xh})}function _m(e){return xm(Uh(e))}function km(e){return arguments.length?mm=_m(e):mm}!function(e){Vh=Uh(e),Wh=Vh.format,Hh=Vh.parse,Gh=Vh.utcFormat,Xh=Vh.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),gm(),wm();const Om=(e,t)=>Qu({},e,t);function Sm(e,t){const n=e?ym(e):vm(),r=t?_m(t):km();return Om(n,r)}function Em(e,t){const n=arguments.length;return n&&2!==n&&ou("defaultLocale expects either zero or two arguments."),n?Om(vm(e),km(t)):Om(vm(),km())}function $m(e,t,n,r){const i=pf((t=t||{}).type||"json");return i||ou("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=km();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,f=e.columns||Object.keys(e[0]);"auto"===t&&(t=Wc(e,f));f=Object.keys(t);const d=f.map((e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1));return("utc"===a[0]?r:n)(o)}if(!Ic[i])throw Error("Illegal format pattern: "+e+":"+i);return Ic[i]}));for(s=0,u=e.length,c=f.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=f[l],a[o]=d[l](a[o])}(e,t.parse,n,r),nc(e,"columns")&&delete e.columns,e}const Am=function(e,t){return n=>({options:n||{},sanitize:Tc,load:Fc,fileAccess:!!t,file:Nc(t),http:Pc(e)})}("undefined"!=typeof fetch&&fetch,null);function Dm(e){const t=e||cu,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function Cm(e,t){try{await t(e)}catch(t){e.error(t)}}const Mm=Symbol("vega_id");let jm=1;function Fm(e){return!(!e||!Tm(e))}function Tm(e){return e[Mm]}function Nm(e,t){return e[Mm]=t,e}function Rm(e){const t=e===Object(e)?e:{data:e};return Tm(t)?t:Nm(t,jm++)}function Pm(e){return zm(e,Rm({}))}function zm(e,t){for(const n in e)t[n]=e[n];return t}function Bm(e,t){return Nm(t,Tm(e))}function Lm(e,t){return e?t?(n,r)=>e(n,r)||Tm(t(n))-Tm(t(r)):(t,n)=>e(t,n)||Tm(t)-Tm(n):null}function Im(e){return e&&e.constructor===qm}function qm(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:qm,insert(t){const n=qu(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=Vu(e)?r:t,i=qu(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:Ju(r)};return Vu(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return Vu(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let f,d,h,p,m,g;for(f=0,d=l.length;f<d;++f)u[Tm(l[f])]=1;for(f=0,d=t.length;f<d;++f)m=t[f],u[Tm(m)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],l.forEach((e=>{p(e)&&(u[Tm(e)]=-1)}));for(f=0,d=e.length;f<d;++f)m=e[f],g=Tm(m),u[g]?u[g]=1:s.add.push(Rm(e[f]));for(f=0,d=l.length;f<d;++f)m=l[f],u[Tm(m)]<0&&s.rem.push(m);function y(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[Tm(e)]=e)}for(f=0,d=n.length;f<d;++f)h=n[f],m=h.tuple,p=h.field,g=u[Tm(m)],g>0&&(y(m,p,h.value),s.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,l.forEach((e=>{p(e)&&u[Tm(e)]>0&&y(e,h.field,h.value)})),s.modifies(h.field);if(o)s.mod=t.length||r.length?l.filter((e=>u[Tm(e)]>0)):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const Um="_:mod:_";function Vm(){Object.defineProperty(this,Um,{writable:!0,value:{}})}Vm.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[Um];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=yu(n)?1+n.length:-1),i},modified(e,t){const n=this[Um];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(yu(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[Um]={},this}};let Wm=0;const Hm=new Vm;function Gm(e,t,n,r){this.id=++Wm,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function Xm(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}Gm.prototype={targets(){return this._targets||(this._targets=Dm(uu))},set(e){return this.value!==e?(this.value=e,1):0},skip:Xm(1),modified:Xm(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new Vm,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof Gm?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)qu(s).forEach((e=>{e instanceof Gm?e!==this&&(e.targets().add(this),a.push(e)):ou("Pulse parameters must be operator instances.")})),this.source=s;else if(yu(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||Hm,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let Ym=0;function Jm(e,t,n){this.id=++Ym,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function Km(e,t,n){return new Jm(e,t,n)}Jm.prototype={_filter:hu,_apply:cu,targets(){return this._targets||(this._targets=Dm(uu))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=Km(e);return this.targets().add(t),t},apply(e){const t=Km(null,e);return this.targets().add(t),t},merge(){const e=Km();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=Km();return this.targets().add(Km(null,null,Ku(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(Km(null,null,(()=>n=!0))),t.targets().add(Km(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){}};const Qm={skip:!0};function Zm(e,t,n,r,i,a){const o=Qu({},a,Qm);let s,l;Vu(n)||(n=Ju(n)),void 0===r?s=t=>e.touch(n(t)):Vu(r)?(l=new Gm(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;Im(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function eg(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new Gm(null,function(e,t){return t=Vu(t)?t:Ju(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const tg={};function ng(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function rg(e,t){const n=[];return Ac(e,t,(e=>n.push(e))),n}function ig(e,t){const n={};return e.visit(t,(e=>{n[Tm(e)]=1})),e=>n[Tm(e)]?null:e}function ag(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function og(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(o|=i.ADD),r.changed(i.REM)&&(o|=i.REM),r.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function sg(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}ng.prototype={StopPropagation:tg,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new ng(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new ng(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,ig(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return yu(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?yu(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=ag(n.addF,t)),2&e&&(n.remF=ag(n.remF,t)),4&e&&(n.modF=ag(n.modF,t)),16&e&&(n.srcF=ag(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=rg(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=rg(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=rg(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Ac(n.source,n.srcF,r),n;1&e&&Ac(n.add,n.addF,r),2&e&&Ac(n.rem,n.remF,r),4&e&&Ac(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||Ac(i,e?ig(n,5):n.srcF,r)}return n}},oc(og,ng,{fork(e){const t=new ng(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?yu(e)?e.some((e=>n[e])):n[e]:0},filter(){ou("MultiPulse does not support filtering.")},materialize(){ou("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const lg={skip:!1,force:!1};function ug(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),cg(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,cg(e,r,t,n)}(t,0,e)):r=n,r}}}function cg(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function fg(){this.logger(gu()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=Em();try{this._loader=Am()}catch(e){}this._touched=Dm(uu),this._input={},this._pulse=null,this._heap=ug(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function dg(e){return function(){return this._log[e].apply(this,arguments)}}function hg(e,t){Gm.call(this,e,null,t)}fg.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:dg("error"),warn:dg("warn"),info:dg("info"),debug:dg("debug"),logLevel:dg("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof Gm?i=e:e&&e.prototype instanceof Gm?i=new e:Vu(e)?i=new Gm(null,e):(a=0,i=new Gm(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&ou("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||lg);const r=new ng(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||lg;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||lg;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:qm,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return $m(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(hu).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:mf(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=Km(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):qu(e);const l=s.length;for(let e=0;e<l;++e)s[e].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof Gm?eg:Zm)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return sg(r);if(r._pending&&await r._pending,t&&await Cm(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new ng(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=Dm(uu);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=tg),s!==tg&&o._targets&&o._targets.forEach((e=>r._enqueue(e))),++u):r._enqueue(o,!0)}catch(e){r._heap.clear(),l=e}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await Cm(r,e[t].callback)}return n&&await Cm(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?sg(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&yu(n)?new og(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){if(t&&t.stamp===e.stamp)return t;e=e.fork(),t&&t!==tg&&(e.source=t.source);return e}(this._pulse,n&&n.pulse)}},oc(hg,Gm,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const pg={};function mg(e){const t=gg(e);return t&&t.Definition||null}function gg(e){return e=e&&e.toLowerCase(),nc(pg,e)?pg[e]:null}function*yg(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function vg(e,t,n){const r=Float64Array.from(yg(e,n));return r.sort(gf),t.map((e=>Tf(r,e)))}function bg(e,t){return vg(e,[.25,.5,.75],t)}function xg(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=bg(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function wg(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,f=e.extent[0],d=e.extent[1];const h=e.span||d-f||Math.abs(f)||1;if(e.step)a=e.step;else if(e.steps){for(l=h/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(h)/r)-o));Math.ceil(h/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&h/l<=t&&(a=l)}l=Math.log(a);const p=l>=0?0:1+~~(-l/r),m=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(f/a+m)*a,f=f<l?l-a:l,d=Math.ceil(d/a)*a),{start:f,stop:d===f?f+a:d,step:a}}var _g=Math.random;function kg(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(yg(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(_g()*a)];c[u]=s/a}return c.sort(gf),[Ff(c,n/2),Ff(c,1-n/2)]}function Og(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,f=u+t;for(;l<i;++l){if(o=r(e[l]),o>=f){for(c=(u+c)/2;s<l;++s)a[s]=c;f=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}const Sg=Math.sqrt(2*Math.PI),Eg=Math.SQRT2;let $g=NaN;function Ag(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if($g==$g)i=$g,$g=NaN;else{do{i=2*_g()-1,a=2*_g()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,$g=a*r}return e+i*t}function Dg(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Sg)}function Cg(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function Mg(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Eg*function(e){let t,n=-Math.log((1-e)*(1+e));n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0;return t*e}(2*e-1)}function jg(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Ag(n,r),pdf:e=>Dg(e,n,r),cdf:e=>Cg(e,n,r),icdf:e=>Mg(e,n,r)};return i.mean(e).stdev(t)}function Fg(e,t){const n=jg();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=xg(e)),i):t},sample:()=>e[~~(_g()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Tg(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Ag()*t)}function Ng(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Sg*e)}function Rg(e,t,n){return Cg(Math.log(e),t,n)}function Pg(e,t,n){return Math.exp(Mg(e,t,n))}function zg(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Tg(n,r),pdf:e=>Ng(e,n,r),cdf:e=>Rg(e,n,r),icdf:e=>Pg(e,n,r)};return i.mean(e).stdev(t)}function Bg(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=_g();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function Lg(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*_g()}function Ig(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function qg(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function Ug(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function Vg(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Lg(n,r),pdf:e=>Ig(e,n,r),cdf:e=>qg(e,n,r),icdf:e=>Ug(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function Wg(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function Hg(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,f=0,d=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,f+=(s-f)/c,d+=(l-d)/c;for(c=0;c<i;++c)a[c]-=f,o[c]-=d;return[a,o,f,d]}function Gg(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function Xg(e,t,n,r,i){let a=0,o=0;return Gg(e,t,n,((e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function Yg(e,t,n){let r=0,i=0,a=0,o=0,s=0;Gg(e,t,n,((e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=Wg(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:Xg(e,t,n,i,u)}}function Jg(e,t,n){let r=0,i=0,a=0,o=0,s=0;Gg(e,t,n,((e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=Wg(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:Xg(e,t,n,i,u)}}function Kg(e,t,n){const[r,i,a,o]=Hg(e,t,n);let s,l,u,c=0,f=0,d=0,h=0,p=0;Gg(e,t,n,((e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,f+=(u-f)/p,d+=(u*l-d)/p,h+=(s*u-h)/p}));const[m,g]=Wg(f/o,c/o,d/o,h/o),y=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:y,rSquared:Xg(e,t,n,o,y)}}function Qg(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;Gg(e,t,n,((e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l}));const u=Wg(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:Xg(e,t,n,s,c)}}function Zg(e,t,n){const[r,i,a,o]=Hg(e,t,n),s=r.length;let l,u,c,f,d=0,h=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],f=u*u,d+=(f-d)/l,h+=(f*u-h)/l,p+=(f*f-p)/l,m+=(u*c-m)/l,g+=(f*c-g)/l;const y=p-d*d,v=d*y-h*h,b=(g*d-m*h)/v,x=(m*y-g*h)/v,w=-b*d,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:Xg(e,t,n,o,_)}}function ey(e,t,n,r){if(1===r)return Yg(e,t,n);if(2===r)return Zg(e,t,n);const[i,a,o,s]=Hg(e,t,n),l=i.length,u=[],c=[],f=r+1;let d,h,p,m,g;for(d=0;d<f;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*a[p];for(u.push(m),g=new Float64Array(f),h=0;h<f;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+h);g[h]=m}c.push(g)}c.push(u);const y=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),v=e=>{e-=o;let t=s+y[0]+y[1]*e+y[2]*e*e;for(d=3;d<f;++d)t+=y[d]*Math.pow(e,d);return t};return{coef:ty(f,y,-o,s),predict:v,rSquared:Xg(e,t,n,s,v)}}function ty(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function ny(e,t,n,r){const[i,a,o,s]=Hg(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let e=-1;++e<=2;){const t=[0,u-1];for(let e=0;e<l;++e){const n=i[e],r=t[0],o=t[1],s=n-i[r]>i[o]-n?r:o;let l=0,u=0,h=0,p=0,m=0;const g=1/Math.abs(i[s]-n||1);for(let e=r;e<=o;++e){const t=i[e],r=a[e],o=ry(Math.abs(n-t)*g)*d[e],s=t*o;l+=o,u+=s,h+=r*o,p+=r*s,m+=t*s}const[y,v]=Wg(u/l,h/l,p/l,m/l);c[e]=y+v*n,f[e]=Math.abs(a[e]-c[e]),iy(i,e+1,t)}if(2===e)break;const n=Nf(f);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<l;++r)e=f[r]/(6*n),d[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function ry(e){return(e=1-e*e*e)*e*e}function iy(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const ay=.1*Math.PI/180;function oy(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let e=n;--e>0;)c.push(i(a+e/n*s));let f=u[0],d=c[c.length-1];for(;d;){const e=i((f[0]+d[0])/2);e[0]-f[0]>=l&&sy(f,e,d)>ay?c.push(e):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function sy(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function ly(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function uy(e,t,n){return n||e+(t?"_"+t:"")}const cy=()=>{},fy={init:cy,add:cy,rem:cy,idx:0},dy={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},hy=Object.keys(dy);function py(e,t){return dy[e](t)}function my(e,t){return e.idx-t.idx}function gy(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function yy(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function vy(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function by(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function xy(e,t){const n=t||cu,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=dy[e]())}))};return e.forEach(n),Object.values(t).sort(my)}(e),i=e.slice().sort(my);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=gy,a.prototype.add=yy,a.prototype.rem=vy,a.prototype.set=by,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function wy(e){this._key=e?lu(e):Tm,this.reset()}hy.forEach((e=>{dy[e]=function(e,t){return n=>Qu({name:e,out:n||e},fy,t)}(e,dy[e])}));const _y=wy.prototype;function ky(e){hg.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}_y.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},_y.add=function(e){this._add.push(e)},_y.rem=function(e){this._rem.push(e)},_y.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},_y.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",nc(n,r)||(n[r]=1,++a);return a},_y.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=ec(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},_y.argmin=function(e){return this.extent(e)[0]||{}},_y.argmax=function(e){return this.extent(e)[1]||{}},_y.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},_y.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},_y.quartile=function(e){return this._get===e&&this._q||(this._q=bg(this.values(),e),this._get=e),this._q},_y.q1=function(e){return this.quartile(e)[0]},_y.q2=function(e){return this.quartile(e)[1]},_y.q3=function(e){return this.quartile(e)[2]},_y.ci=function(e){return this._get===e&&this._ci||(this._ci=kg(this.values(),1e3,.05,e),this._get=e),this._ci},_y.ci0=function(e){return this.ci(e)[0]},_y.ci1=function(e){return this.ci(e)[1]},ky.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:hy},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},oc(ky,hg,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=qu(nu(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=qu(e.groupby),this._dnames=this._dims.map((e=>{const t=tu(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:ly(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,f,d,h,p,m;for(l!==o.length&&ou("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],f=o[m],null==c&&"count"!==f&&ou("Null aggregate field specified."),h=tu(c),p=uy(f,h,s[m]),n.push(p),"count"!==f?(d=u[h],d||(i(c),d=u[h]=[],d.field=c,this._measures.push(d)),"count"!==f&&(this._countOnly=!1),d.push(py(f,p))):this._counts.push(p);return this._measures=this._measures.map((e=>xy(e,e.field))),{}},cellkey:ly(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new wy),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?Bm(t.tuple,a):Rm(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,f;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Oy(e){hg.call(this,null,e)}function Sy(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter((e=>!o[r(e)])),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?yc(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function Ey(e){hg.call(this,[],e)}function $y(e){Gm.call(this,null,Ay,e)}function Ay(e){return this.value&&!e.modified()?this.value:Wu(e.fields,e.orders)}function Dy(e){hg.call(this,null,e)}function Cy(e){hg.call(this,null,e)}Oy.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},oc(Oy,hg,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(nu(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=wg(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=Ou(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=eu(l,nu(t),e.name||"bin_"+tu(t))}}),Ey.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},oc(Ey,hg,{transform(e,t){const n=t.fork(t.ALL),r=Sy(Tm,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(Lm(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),oc($y,Gm),Dy.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},oc(Dy,hg,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n((e=>i[e]=1+(i[e]||0))),c=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=Rm({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),Cy.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},oc(Cy,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push(Rm(s)),(s={})[t]=a);return o}(s,i,a,e.filter||hu)):n.mod=s,n.source=this.value,n.modifies(r)}});const My={kde:Fg,mixture:Bg,normal:jg,lognormal:zg,uniform:Vg},jy="function";function Fy(e,t){const n=e.function;nc(My,n)||ou("Unknown distribution function: "+n);const r=My[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>Fy(e,t)))):typeof r[n]===jy&&r[n](e[n]);return r}function Ty(e){hg.call(this,null,e)}const Ny=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Ry={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Ny},{name:"weights",type:"number",array:!0}]};function Py(e,t){return e?e.map(((e,n)=>t[n]||tu(e))):null}function zy(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}Ty.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Ny.concat(Ry)},{name:"as",type:"string",array:!0,default:["value","density"]}]},oc(Ty,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Fy(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&ou("Invalid density method: "+o),e.extent||r.data||ou("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=oy(o,e.extent||Zu(r.data()),i,a).map((e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],Rm(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function By(e){hg.call(this,null,e)}By.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function Ly(e){Gm.call(this,null,Iy,e),this.modified(!0)}function Iy(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:eu((n=>t(n,e)),nu(t),tu(t))}function qy(e){hg.call(this,[void 0,void 0],e)}function Uy(e,t){Gm.call(this,e),this.parent=t,this.count=0}function Vy(e){hg.call(this,{},e),this._keys=ic();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function Wy(e){Gm.call(this,null,Hy,e)}function Hy(e){return this.value&&!e.modified()?this.value:yu(e.name)?qu(e.name).map((e=>lu(e))):lu(e.name,e.as)}function Gy(e){hg.call(this,ic(),e)}function Xy(e){hg.call(this,[],e)}function Yy(e){hg.call(this,[],e)}function Jy(e){hg.call(this,null,e)}function Ky(e){hg.call(this,[],e)}oc(By,hg,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=zy(t.source,e.groupby,cu),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>xc(Zu(e,t))/30)(n,a),s=Lm(((e,t)=>a(e)-a(t))),l=e.as||"bin",u=r.length;let c,f=1/0,d=-1/0,h=0;for(;h<u;++h){const e=r[h].sort(s);c=-1;for(const t of Og(e,o,i,a))t<f&&(f=t),t>d&&(d=t),e[++c][l]=t}return this.value={start:f,stop:d,step:o},t.reflow(!0).modifies(l)}}),oc(Ly,Gm),qy.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},oc(qy,hg,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=Ou(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=tu(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),oc(Uy,Gm,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),oc(Vy,hg,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=nc(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new Uy(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=Tm(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(Tm(e),t),s(t).add(e)})),o||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=Tm(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{s(a.get(Tm(e))).mod(e)})),o&&t.visit(t.REFLOW,(e=>{const t=Tm(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),oc(Wy,Gm),Gy.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},oc(Gy,hg,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=Tm(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(e=>{const t=Tm(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(t=>{l(t,e)?a.push(t):r.set(Tm(t),1)})),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),Xy.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},oc(Xy,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Py(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),s=t.reduce(((e,t)=>Math.max(e,t.length)),0);let l,u,c,f=0;for(;f<s;++f){for(u=Pm(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][f])?null:c;a&&(u[a]=f),n.add.push(u)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),Yy.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},oc(Yy,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(tu),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<l;++a)t=Pm(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),Jy.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},oc(Jy,hg,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),oc(Ky,hg,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=Rm(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const Qy={value:"value",median:Nf,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:Cf,max:Df},Zy=[];function ev(e){hg.call(this,[],e)}function tv(e){ky.call(this,e)}function nv(e){hg.call(this,null,e)}function rv(e){Gm.call(this,null,iv,e)}function iv(e){return this.value&&!e.modified()?this.value:pc(e.fields,e.flat)}function av(e){hg.call(this,[],e),this._pending=null}function ov(e,t,n){n.forEach(Rm);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function sv(e){hg.call(this,{},e)}function lv(e){Gm.call(this,null,uv,e)}function uv(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function cv(e){Gm.call(this,null,fv,e)}function fv(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function dv(e){hg.call(this,null,e)}function hv(e){ky.call(this,e)}function pv(e){Vy.call(this,e)}function mv(e){hg.call(this,null,e)}function gv(e){hg.call(this,null,e)}function yv(e){hg.call(this,null,e)}ev.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},oc(ev,hg,{transform(e,t){var n,r,i,a,o,s,l,u,c,f,d=t.fork(t.ALL),h=function(e){var t,n=e.method||Qy.value;if(null!=Qy[n])return n===Qy.value?(t=void 0!==e.value?e.value:0,()=>t):Qy[n];ou("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=tu(e.field),g=tu(e.key),y=(e.groupby||[]).map(tu),v=function(e,t,n,r){var i,a,o,s,l,u,c,f,d=e=>e(f),h=[],p=r?r.slice():[],m={},g={};for(p.forEach(((e,t)=>m[e]=t+1)),s=0,c=e.length;s<c;++s)u=n(f=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(d):Zy)+""])||(o=g[a]=[],h.push(o),o.values=i),o[l-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(o=0,u=v.length;o<u;++o)for(i=(n=v[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=v.domain[l],f={_impute:!0},s=0,c=i.length;s<c;++s)f[y[s]]=i[s];f[g]=a,f[m]=Number.isNaN(r)?r=h(n,p):r,b.push(Rm(f))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d}}),tv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:hy},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},oc(tv,ky,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{Qu(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),nv.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},oc(nv,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=zy(r,e.groupby,e.field),a=(e.groupby||[]).map(tu),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&ou("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=Zu(r,e.field)),f=d=e.steps||d),i.forEach((t=>{const n=Fg(t,o)[s],r=e.counts?t.length:1;oy(n,c||Zu(t),f,d).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push(Rm(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),oc(rv,Gm),oc(av,hg,{transform(e,t){const n=t.dataflow;if(this._pending)return ov(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return ov(this,t,n.parse(e.values,e.format));if(e.async){return{async:n.request(e.url,e.format).then((e=>(this._pending=qu(e.data),e=>e.touch(this))))}}return n.request(e.url,e.format).then((e=>ov(this,t,qu(e.data))))}}),sv.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},oc(sv,hg,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,f=o?t.SOURCE:t.ADD,d=t,h=e.as;return i?(u=i.length,s>1&&!h&&ou('Multi-field lookup requires explicit "as" parameter.'),h&&h.length!==s*u&&ou('The "as" parameter has too few output field names.'),h=h||i.map(tu),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[h[c]]=a;else for(t=0;t<u;++t,++c)e[h[c]]=i[t](o)}):(h||ou("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[h[i]]=null==t?a:t}),o?d=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),f|=c?t.MOD:0),t.visit(f,l),d.modifies(h)}}),oc(lv,Gm),oc(cv,Gm),oc(dv,hg,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),hv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:hy,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},oc(hv,ky,{_transform:ky.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=nu(n).concat(nu(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(Hu),t?i.slice(0,t):i}(n,e.limit||0,t);t.changed()&&e.set("__pivot__",null,null,!0);return{key:e.key,groupby:e.groupby,ops:o.map((()=>i)),fields:o.map((e=>function(e,t,n,r){return eu((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:o.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),oc(pv,Vy,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(Tm(e),n,t,e);return(e.modified("field")||r&&t.modified(nu(r)))&&ou("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(Rm(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),mv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},oc(mv,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=Py(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):zm;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,(e=>{const t=Tm(e);n.rem.push(o[t]),o[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,Rm({}));o[Tm(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,o[Tm(e)]))})),n}}),oc(gv,hg,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),yv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function vv(e){hg.call(this,null,e)}function bv(e){hg.call(this,[],e),this.count=0}function xv(e){hg.call(this,null,e)}function wv(e){hg.call(this,null,e),this.modified(!0)}function _v(e){hg.call(this,null,e)}oc(yv,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=zy(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(tu),o=[],s=e.step||.01,l=e.probs||Pf(s/2,1-1e-14,s),u=l.length;return i.forEach((e=>{const t=vg(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push(Rm(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),oc(vv,hg,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=Tm(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=Pm(e);r[Tm(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[Tm(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),bv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},oc(bv,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[Tm(t)]=1,e)),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*_g()),r<o.length&&r>=l&&(t=o[r],a[Tm(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=Tm(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((e=>-1!==a[Tm(e)]))),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,(e=>{a[Tm(e)]||u(e)})),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[Tm(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[Tm(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter((e=>!a[Tm(e)]))),this.count=s,this.value=n.source=o,n}}),xv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},oc(xv,hg,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=Pf(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,Rm(t)})),n.add=t.add.concat(this.value),n}}),oc(wv,hg,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const kv=["unit0","unit1"];function Ov(e){hg.call(this,ic(),e)}function Sv(e){hg.call(this,null,e)}_v.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:qd,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:kv}]},oc(_v,hg,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?vh:yh)(a.unit).offset,s=e.as||kv,l=s[0],u=s[1],c=a.step;let f=a.start||1/0,d=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(nu(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,d=-1/0),t.visit(h,(e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<f&&(f=i),s>d&&(d=s))})),a.start=f,a.stop=d,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:Bh({extent:e.extent||Zu(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=Vd(r),o=this.value||{},s=(n?ph:fh)(a,i);return s.unit=ku(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),oc(Ov,hg,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),oc(Sv,hg,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(Lm(e.sort)):t.source).map(e.field))}});const Ev={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Ev.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||ou("ntile num must be greater than zero.");const n=Ev.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||ou("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n){if(null!=e(t[n]))return n}return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};const $v=Object.keys(Ev);function Av(e){const t=qu(e.ops),n=qu(e.fields),r=qu(e.params),i=qu(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let f=!0;function d(e){qu(nu(e)).forEach((e=>s[e]=1))}d(e.sort),t.forEach(((e,t)=>{const s=n[t],h=tu(s),p=uy(e,h,i[t]);if(d(s),a.push(p),nc(Ev,e))o.push(function(e,t,n,r){const i=Ev[e](t,n);return{init:i.init||fu,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&ou("Null aggregate field specified."),"count"===e)return void u.push(p);f=!1;let t=l[h];t||(t=l[h]=[],t.field=s,c.push(t)),t.push(py(e,p))}})),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>xy(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new wy;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,f)),this.inputs=Object.keys(s)}const Dv=Av.prototype;function Cv(e){hg.call(this,{},e),this._mlen=0,this._mods=[]}function Mv(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?yf(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||Ju(-1)};t.init();for(let e=0;e<l;++e)jv(c,o,e,l),a&&Fv(c,u),t.update(c,s[e])}function jv(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Fv(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}Dv.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},Dv.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},Cv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:$v.concat(hy)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},oc(Cv,hg,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=Lm(e.sort),i=ly(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new Av(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)Mv(this._mods[t],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Sy(Tm),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});var Tv=Object.freeze({__proto__:null,aggregate:ky,bin:Oy,collect:Ey,compare:$y,countpattern:Dy,cross:Cy,density:Ty,dotbin:By,expression:Ly,extent:qy,facet:Vy,field:Wy,filter:Gy,flatten:Xy,fold:Yy,formula:Jy,generate:Ky,impute:ev,joinaggregate:tv,kde:nv,key:rv,load:av,lookup:sv,multiextent:lv,multivalues:cv,params:dv,pivot:hv,prefacet:pv,project:mv,proxy:gv,quantile:yv,relay:vv,sample:bv,sequence:xv,sieve:wv,subflow:Uy,timeunit:_v,tupleindex:Ov,values:Sv,window:Cv});const Nv=Math.PI,Rv=2*Nv,Pv=1e-6,zv=Rv-Pv;function Bv(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function Lv(){return new Bv}function Iv(e){return function(){return e}}Bv.prototype=Lv.prototype={constructor:Bv,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,l=r-t,u=a-e,c=o-t,f=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>Pv)if(Math.abs(c*s-l*u)>Pv&&i){var d=n-a,h=r-o,p=s*s+l*l,m=d*d+h*h,g=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((Nv-Math.acos((p+f-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>Pv&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>Pv||Math.abs(this._y1-u)>Pv)&&(this._+="L"+l+","+u),n&&(f<0&&(f=f%Rv+Rv),f>zv?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>Pv&&(this._+="A"+n+","+n+",0,"+ +(f>=Nv)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var qv=Math.abs,Uv=Math.atan2,Vv=Math.cos,Wv=Math.max,Hv=Math.min,Gv=Math.sin,Xv=Math.sqrt,Yv=1e-12,Jv=Math.PI,Kv=Jv/2,Qv=2*Jv;function Zv(e){return e>1?0:e<-1?Jv:Math.acos(e)}function eb(e){return e>=1?Kv:e<=-1?-Kv:Math.asin(e)}function tb(e){return e.innerRadius}function nb(e){return e.outerRadius}function rb(e){return e.startAngle}function ib(e){return e.endAngle}function ab(e){return e&&e.padAngle}function ob(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,f=s-a,d=f*l-c*u;if(!(d*d<Yv))return[e+(d=(c*(t-a)-f*(e-i))/d)*l,t+d*u]}function sb(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/Xv(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,m=r+f,g=(d+p)/2,y=(h+m)/2,v=p-d,b=m-h,x=v*v+b*b,w=i-a,_=d*m-p*h,k=(b<0?-1:1)*Xv(Wv(0,w*w*x-_*_)),O=(_*b-v*k)/x,S=(-_*v-b*k)/x,E=(_*b+v*k)/x,$=(-_*v+b*k)/x,A=O-g,D=S-y,C=E-g,M=$-y;return A*A+D*D>C*C+M*M&&(O=E,S=$),{cx:O,cy:S,x01:-c,y01:-f,x11:O*(i/w-1),y11:S*(i/w-1)}}function lb(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function ub(e){this._context=e}function cb(e){return new ub(e)}function fb(e){return e[0]}function db(e){return e[1]}function hb(e,t){var n=Iv(!0),r=null,i=cb,a=null;function o(o){var s,l,u,c=(o=lb(o)).length,f=!1;for(null==r&&(a=i(u=Lv())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?fb:Iv(e),t="function"==typeof t?t:void 0===t?db:Iv(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:Iv(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:Iv(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:Iv(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o}function pb(e,t,n){var r=null,i=Iv(!0),a=null,o=cb,s=null;function l(l){var u,c,f,d,h,p=(l=lb(l)).length,m=!1,g=new Array(p),y=new Array(p);for(null==a&&(s=o(h=Lv())),u=0;u<=p;++u){if(!(u<p&&i(d=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=u-1;f>=c;--f)s.point(g[f],y[f]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(d,u,l),y[u]=+t(d,u,l),s.point(r?+r(d,u,l):g[u],n?+n(d,u,l):y[u]))}if(h)return s=null,h+""||null}function u(){return hb().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?fb:Iv(+e),t="function"==typeof t?t:Iv(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?db:Iv(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:Iv(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:Iv(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Iv(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:Iv(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:Iv(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:Iv(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:Iv(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l}ub.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var mb={draw:function(e,t){var n=Math.sqrt(t/Jv);e.moveTo(n,0),e.arc(0,0,n,0,Qv)}};function gb(){}function yb(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function vb(e){this._context=e}function bb(e){this._context=e}function xb(e){this._context=e}function wb(e,t){this._basis=new vb(e),this._beta=t}vb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:yb(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:yb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},bb.prototype={areaStart:gb,areaEnd:gb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:yb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},xb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:yb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},wb.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)r=l/n,this._basis.point(this._beta*e[l]+(1-this._beta)*(i+r*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var _b=function e(t){function n(e){return 1===t?new vb(e):new wb(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function kb(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Ob(e,t){this._context=e,this._k=(1-t)/6}Ob.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:kb(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:kb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Sb=function e(t){function n(e){return new Ob(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Eb(e,t){this._context=e,this._k=(1-t)/6}Eb.prototype={areaStart:gb,areaEnd:gb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:kb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var $b=function e(t){function n(e){return new Eb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Ab(e,t){this._context=e,this._k=(1-t)/6}Ab.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:kb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Db=function e(t){function n(e){return new Ab(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Cb(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>Yv){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>Yv){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function Mb(e,t){this._context=e,this._alpha=t}Mb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Cb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var jb=function e(t){function n(e){return t?new Mb(e,t):new Ob(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Fb(e,t){this._context=e,this._alpha=t}Fb.prototype={areaStart:gb,areaEnd:gb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Cb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Tb=function e(t){function n(e){return t?new Fb(e,t):new Eb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Nb(e,t){this._context=e,this._alpha=t}Nb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Cb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Rb=function e(t){function n(e){return t?new Nb(e,t):new Ab(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Pb(e){this._context=e}function zb(e){return e<0?-1:1}function Bb(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(zb(a)+zb(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function Lb(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function Ib(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function qb(e){this._context=e}function Ub(e){this._context=new Vb(e)}function Vb(e){this._context=e}function Wb(e){this._context=e}function Hb(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function Gb(e,t){this._context=e,this._t=t}function Xb(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}Pb.prototype={areaStart:gb,areaEnd:gb,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},qb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ib(this,this._t0,Lb(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Ib(this,Lb(this,n=Bb(this,e,t)),n);break;default:Ib(this,this._t0,n=Bb(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(Ub.prototype=Object.create(qb.prototype)).point=function(e,t){qb.prototype.point.call(this,t,e)},Vb.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},Wb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=Hb(e),i=Hb(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},Gb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const Yb=()=>"undefined"!=typeof Image?Image:null;function Jb(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Kb(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const Qb=Symbol("implicit");function Zb(){var e=new Map,t=[],n=[],r=Qb;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==Qb)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return Zb(t,n).unknown(r)},Jb.apply(i,arguments),i}function ex(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function tx(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function nx(){}var rx=.7,ix=1/rx,ax="\\s*([+-]?\\d+)\\s*",ox="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",sx="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lx=/^#([0-9a-f]{3,8})$/,ux=new RegExp("^rgb\\("+[ax,ax,ax]+"\\)$"),cx=new RegExp("^rgb\\("+[sx,sx,sx]+"\\)$"),fx=new RegExp("^rgba\\("+[ax,ax,ax,ox]+"\\)$"),dx=new RegExp("^rgba\\("+[sx,sx,sx,ox]+"\\)$"),hx=new RegExp("^hsl\\("+[ox,sx,sx]+"\\)$"),px=new RegExp("^hsla\\("+[ox,sx,sx,ox]+"\\)$"),mx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function gx(){return this.rgb().formatHex()}function yx(){return this.rgb().formatRgb()}function vx(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=lx.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?bx(t):3===n?new kx(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?xx(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?xx(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=ux.exec(e))?new kx(t[1],t[2],t[3],1):(t=cx.exec(e))?new kx(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=fx.exec(e))?xx(t[1],t[2],t[3],t[4]):(t=dx.exec(e))?xx(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=hx.exec(e))?$x(t[1],t[2]/100,t[3]/100,1):(t=px.exec(e))?$x(t[1],t[2]/100,t[3]/100,t[4]):mx.hasOwnProperty(e)?bx(mx[e]):"transparent"===e?new kx(NaN,NaN,NaN,0):null}function bx(e){return new kx(e>>16&255,e>>8&255,255&e,1)}function xx(e,t,n,r){return r<=0&&(e=t=n=NaN),new kx(e,t,n,r)}function wx(e){return e instanceof nx||(e=vx(e)),e?new kx((e=e.rgb()).r,e.g,e.b,e.opacity):new kx}function _x(e,t,n,r){return 1===arguments.length?wx(e):new kx(e,t,n,null==r?1:r)}function kx(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Ox(){return"#"+Ex(this.r)+Ex(this.g)+Ex(this.b)}function Sx(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Ex(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function $x(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Cx(e,t,n,r)}function Ax(e){if(e instanceof Cx)return new Cx(e.h,e.s,e.l,e.opacity);if(e instanceof nx||(e=vx(e)),!e)return new Cx;if(e instanceof Cx)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Cx(o,s,l,e.opacity)}function Dx(e,t,n,r){return 1===arguments.length?Ax(e):new Cx(e,t,n,null==r?1:r)}function Cx(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Mx(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}ex(nx,vx,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:gx,formatHex:gx,formatHsl:function(){return Ax(this).formatHsl()},formatRgb:yx,toString:yx}),ex(kx,_x,tx(nx,{brighter:function(e){return e=null==e?ix:Math.pow(ix,e),new kx(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?rx:Math.pow(rx,e),new kx(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ox,formatHex:Ox,formatRgb:Sx,toString:Sx})),ex(Cx,Dx,tx(nx,{brighter:function(e){return e=null==e?ix:Math.pow(ix,e),new Cx(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?rx:Math.pow(rx,e),new Cx(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new kx(Mx(e>=240?e-240:e+120,i,r),Mx(e,i,r),Mx(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const jx=Math.PI/180,Fx=180/Math.PI,Tx=.96422,Nx=.82521,Rx=4/29,Px=6/29,zx=3*Px*Px;function Bx(e){if(e instanceof Ix)return new Ix(e.l,e.a,e.b,e.opacity);if(e instanceof Xx)return Yx(e);e instanceof kx||(e=wx(e));var t,n,r=Wx(e.r),i=Wx(e.g),a=Wx(e.b),o=qx((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=qx((.4360747*r+.3850649*i+.1430804*a)/Tx),n=qx((.0139322*r+.0971045*i+.7141733*a)/Nx)),new Ix(116*o-16,500*(t-o),200*(o-n),e.opacity)}function Lx(e,t,n,r){return 1===arguments.length?Bx(e):new Ix(e,t,n,null==r?1:r)}function Ix(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function qx(e){return e>.008856451679035631?Math.pow(e,1/3):e/zx+Rx}function Ux(e){return e>Px?e*e*e:zx*(e-Rx)}function Vx(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Wx(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Hx(e){if(e instanceof Xx)return new Xx(e.h,e.c,e.l,e.opacity);if(e instanceof Ix||(e=Bx(e)),0===e.a&&0===e.b)return new Xx(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Fx;return new Xx(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function Gx(e,t,n,r){return 1===arguments.length?Hx(e):new Xx(e,t,n,null==r?1:r)}function Xx(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Yx(e){if(isNaN(e.h))return new Ix(e.l,0,0,e.opacity);var t=e.h*jx;return new Ix(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}ex(Ix,Lx,tx(nx,{brighter:function(e){return new Ix(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new Ix(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new kx(Vx(3.1338561*(t=Tx*Ux(t))-1.6168667*(e=1*Ux(e))-.4906146*(n=Nx*Ux(n))),Vx(-.9787684*t+1.9161415*e+.033454*n),Vx(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),ex(Xx,Gx,tx(nx,{brighter:function(e){return new Xx(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new Xx(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return Yx(this).rgb()}}));var Jx=-.14861,Kx=1.78277,Qx=-.29227,Zx=-.90649,ew=1.97294,tw=ew*Zx,nw=ew*Kx,rw=Kx*Qx-Zx*Jx;function iw(e){if(e instanceof ow)return new ow(e.h,e.s,e.l,e.opacity);e instanceof kx||(e=wx(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(rw*r+tw*t-nw*n)/(rw+tw-nw),a=r-i,o=(ew*(n-i)-Qx*a)/Zx,s=Math.sqrt(o*o+a*a)/(ew*i*(1-i)),l=s?Math.atan2(o,a)*Fx-120:NaN;return new ow(l<0?l+360:l,s,i,e.opacity)}function aw(e,t,n,r){return 1===arguments.length?iw(e):new ow(e,t,n,null==r?1:r)}function ow(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function sw(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function lw(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return sw((n-r/t)*t,o,i,a,s)}}function uw(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return sw((n-r/t)*t,i,a,o,s)}}ex(ow,aw,tx(nx,{brighter:function(e){return e=null==e?ix:Math.pow(ix,e),new ow(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?rx:Math.pow(rx,e),new ow(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*jx,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new kx(255*(t+n*(Jx*r+Kx*i)),255*(t+n*(Qx*r+Zx*i)),255*(t+n*(ew*r)),this.opacity)}}));var cw=e=>()=>e;function fw(e,t){return function(n){return e+n*t}}function dw(e,t){var n=t-e;return n?fw(e,n>180||n<-180?n-360*Math.round(n/360):n):cw(isNaN(e)?t:e)}function hw(e){return 1==(e=+e)?pw:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):cw(isNaN(t)?n:t)}}function pw(e,t){var n=t-e;return n?fw(e,n):cw(isNaN(e)?t:e)}var mw=function e(t){var n=hw(t);function r(e,t){var r=n((e=_x(e)).r,(t=_x(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=pw(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function gw(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=_x(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var yw=gw(lw),vw=gw(uw);function bw(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function xw(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ww(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Aw(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function _w(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function kw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ow(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Aw(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Sw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ew=new RegExp(Sw.source,"g");function $w(e,t){var n,r,i,a=Sw.lastIndex=Ew.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=Sw.exec(e))&&(r=Ew.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:kw(n,r)})),a=Ew.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Aw(e,t){var n,r=typeof t;return null==t||"boolean"===r?cw(t):("number"===r?kw:"string"===r?(n=vx(t))?(t=n,mw):$w:t instanceof vx?mw:t instanceof Date?_w:xw(t)?bw:Array.isArray(t)?ww:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Ow:kw)(e,t)}function Dw(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Cw,Mw=180/Math.PI,jw={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Fw(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Mw,skewX:Math.atan(l)*Mw,scaleX:o,scaleY:s}}function Tw(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:kw(e,i)},{i:l-2,x:kw(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:kw(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:kw(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:kw(e,n)},{i:s-2,x:kw(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var Nw=Tw((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?jw:Fw(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),Rw=Tw((function(e){return null==e?jw:(Cw||(Cw=document.createElementNS("http://www.w3.org/2000/svg","g")),Cw.setAttribute("transform",e),(e=Cw.transform.baseVal.consolidate())?Fw((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):jw)}),", ",")",")");function Pw(e){return((e=Math.exp(e))+1/e)/2}var zw=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[0],f=i[1],d=i[2],h=c-s,p=f-l,m=h*h+p*p;if(m<1e-12)o=Math.log(d/u)/t,a=function(e){return[s+e*h,l+e*p,u*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),y=(d*d-u*u+r*m)/(2*u*n*g),v=(d*d-u*u-r*m)/(2*d*n*g),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);o=(x-b)/t,a=function(e){var r=e*o,i=Pw(b),a=u/(n*g)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,l+a*p,u*i/Pw(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function Bw(e){return function(t,n){var r=e((t=Dx(t)).h,(n=Dx(n)).h),i=pw(t.s,n.s),a=pw(t.l,n.l),o=pw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var Lw=Bw(dw),Iw=Bw(pw);function qw(e){return function(t,n){var r=e((t=Gx(t)).h,(n=Gx(n)).h),i=pw(t.c,n.c),a=pw(t.l,n.l),o=pw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var Uw=qw(dw),Vw=qw(pw);function Ww(e){return function t(n){function r(t,r){var i=e((t=aw(t)).h,(r=aw(r)).h),a=pw(t.s,r.s),o=pw(t.l,r.l),s=pw(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}var Hw=Ww(dw),Gw=Ww(pw);function Xw(e,t){void 0===t&&(t=e,e=Aw);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var Yw=Object.freeze({__proto__:null,interpolate:Aw,interpolateArray:function(e,t){return(xw(t)?bw:ww)(e,t)},interpolateBasis:lw,interpolateBasisClosed:uw,interpolateDate:_w,interpolateDiscrete:function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},interpolateHue:function(e,t){var n=dw(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},interpolateNumber:kw,interpolateNumberArray:bw,interpolateObject:Ow,interpolateRound:Dw,interpolateString:$w,interpolateTransformCss:Nw,interpolateTransformSvg:Rw,interpolateZoom:zw,interpolateRgb:mw,interpolateRgbBasis:yw,interpolateRgbBasisClosed:vw,interpolateHsl:Lw,interpolateHslLong:Iw,interpolateLab:function(e,t){var n=pw((e=Lx(e)).l,(t=Lx(t)).l),r=pw(e.a,t.a),i=pw(e.b,t.b),a=pw(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}},interpolateHcl:Uw,interpolateHclLong:Vw,interpolateCubehelix:Hw,interpolateCubehelixLong:Gw,piecewise:Xw,quantize:function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}});function Jw(e){return+e}var Kw=[0,1];function Qw(e){return e}function Zw(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function e_(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=Zw(i,r),a=n(o,a)):(r=Zw(r,i),a=n(a,o)),function(e){return a(r(e))}}function t_(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Zw(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=xf(e,t,1,r)-1;return a[n](i[n](t))}}function n_(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function r_(){var e,t,n,r,i,a,o=Kw,s=Kw,l=Aw,u=Qw;function c(){var e=Math.min(o.length,s.length);return u!==Qw&&(u=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?t_:e_,i=a=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return f.invert=function(n){return u(t((a||(a=r(s,o.map(e),kw)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,Jw),c()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),l=Dw,c()},f.clamp=function(e){return arguments.length?(u=!!e||Qw,c()):u!==Qw},f.interpolate=function(e){return arguments.length?(l=e,c()):l},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function i_(){return r_()(Qw,Qw)}function a_(e,t,n,r){var i,a=Af(e,t,n);switch((r=Uf(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=td(a,o))||(r.precision=i),Jf(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=nd(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=ed(a))||(r.precision=i-2*("%"===r.type))}return Yf(r)}function o_(e){var t=e.domain;return e.ticks=function(e){var n=t();return Ef(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return a_(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=$f(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function s_(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function l_(e){return Math.log(e)}function u_(e){return Math.exp(e)}function c_(e){return-Math.log(-e)}function f_(e){return-Math.exp(-e)}function d_(e){return isFinite(e)?+("1e"+e):e<0?0:e}function h_(e){return function(t){return-e(-t)}}function p_(e){var t,n,r=e(l_,u_),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?d_:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=h_(t),n=h_(n),e(c_,f_)):e(l_,u_),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(d=s,s=l,l=d);var u,c,f,d=t(s),h=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(c=1,u=n(d);c<a;++c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}}else for(;d<=h;++d)for(c=a-1,u=n(d);c>=1;--c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}2*m.length<p&&(m=Ef(s,l,p))}else m=Ef(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=Yf(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(s_(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function m_(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function g_(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function y_(e){var t=1,n=e(m_(t),g_(t));return n.constant=function(n){return arguments.length?e(m_(t=+n),g_(t)):t},o_(n)}function v_(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function b_(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function x_(e){return e<0?-e*e:e*e}function w_(e){var t=e(Qw,Qw),n=1;function r(){return 1===n?e(Qw,Qw):.5===n?e(b_,x_):e(v_(n),v_(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},o_(t)}function __(){var e=w_(r_());return e.copy=function(){return n_(e,__()).exponent(e.exponent())},Jb.apply(e,arguments),e}var k_=1e3,O_=6e4,S_=36e5,E_=864e5,$_=2592e6,A_=31536e6;function D_(e){return new Date(e)}function C_(e){return e instanceof Date?+e:+new Date(+e)}function M_(e,t,n,r,i,a,o,s,l){var u=i_(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),y=l("%b %d"),v=l("%B"),b=l("%Y"),x=[[o,1,k_],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,O_],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,S_],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,E_],[r,2,1728e5],[n,1,6048e5],[t,1,$_],[t,3,7776e6],[e,1,A_]];function w(s){return(o(s)<s?d:a(s)<s?h:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:y:e(s)<s?v:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=yf((function(e){return e[2]})).right(x,a);return o===x.length?(i=Af(n/A_,r/A_,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(Af(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?f(Array.from(e,C_)):f().map(D_)},u.ticks=function(e){var t,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=f();return(e=_(e,t[0],t[t.length-1]))?f(s_(t,e)):u},u.copy=function(){return n_(u,M_(e,t,n,r,i,a,o,s,l))},u}function j_(){var e,t,n,r,i,a=0,o=1,s=Qw,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(Aw),u.rangeRound=c(Dw),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function F_(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function T_(){var e=o_(j_()(Qw));return e.copy=function(){return F_(e,T_())},Kb.apply(e,arguments)}function N_(){var e=w_(j_());return e.copy=function(){return F_(e,N_()).exponent(e.exponent())},Kb.apply(e,arguments)}function R_(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,f=Qw,d=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),f(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,f=Xw(e,[n,r,i]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h):[s,l,u]},h.clamp=function(e){return arguments.length?(d=!!e,h):d},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=p(Aw),h.rangeRound=p(Dw),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h}}function P_(){var e=w_(R_());return e.copy=function(){return F_(e,P_()).exponent(e.exponent())},Kb.apply(e,arguments)}function z_(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const B_="linear",L_="log",I_="pow",q_="sqrt",U_="symlog",V_="time",W_="utc",H_="sequential",G_="diverging",X_="quantile",Y_="quantize",J_="threshold",K_="ordinal",Q_="point",Z_="band",ek="bin-ordinal",tk="continuous",nk="discrete",rk="discretizing",ik="interpolating",ak="temporal";function ok(){const e=Zb().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],f=a[1-c],d=z_(e,s,l);let h=a[c-0];r=(f-h)/(d||1),o&&(r=Math.floor(r)),h+=(f-h-r*(e-s))*u,i=r*(1-s),o&&(h=Math.round(h),i=Math.round(i));const p=Pf(e).map((e=>h+r*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,f=+e[0],d=+e[1];return f!=f||d!=d||(d<f&&(c=f,f=d,d=c),d<o[0]||f>a[1-r])?void 0:(l=Math.max(0,xf(o,f)-1),u=f===d?l:xf(o,d)-1,f-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return ok().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function sk(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return sk(t())},e}var lk=Array.prototype.map;function uk(e){return lk.call(e,Ou)}const ck=Array.prototype.slice;const fk={};function dk(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?function(e){return function(t){let n,r=t[0],i=t[1];return i<r&&(n=r,r=i,i=n),[e.invert(r),e.invert(i)]}}(n):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n};return r.metadata=Ec(qu(n)),r}function hk(e,t,n){return arguments.length>1?(fk[e]=dk(e,t,n),this):pk(e)?fk[e]:void 0}function pk(e){return nc(fk,e)}function mk(e,t){const n=fk[e];return n&&n.metadata[t]}function gk(e){return mk(e,tk)}function yk(e){return mk(e,nk)}function vk(e){return mk(e,rk)}function bk(e){return mk(e,L_)}function xk(e){return mk(e,ik)}function wk(e){return mk(e,X_)}hk("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,Jw),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,Jw):[0,1],o_(r)})),hk(B_,(function e(){var t=i_();return t.copy=function(){return n_(t,e())},Jb.apply(t,arguments),o_(t)}),tk),hk(L_,(function e(){var t=p_(r_()).domain([1,10]);return t.copy=function(){return n_(t,e()).base(t.base())},Jb.apply(t,arguments),t}),[tk,L_]),hk(I_,__,tk),hk(q_,(function(){return __.apply(null,arguments).exponent(.5)}),tk),hk(U_,(function e(){var t=y_(r_());return t.copy=function(){return n_(t,e()).constant(t.constant())},Jb.apply(t,arguments)}),tk),hk(V_,(function(){return Jb.apply(M_(wd,xd,yd,md,pd,hd,dd,od,Wh).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[tk,ak]),hk(W_,(function(){return Jb.apply(M_(Cd,Dd,Ed,Od,kd,_d,dd,od,Gh).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[tk,ak]),hk(H_,T_,[tk,ik]),hk("".concat(H_,"-").concat(B_),T_,[tk,ik]),hk("".concat(H_,"-").concat(L_),(function e(){var t=p_(j_()).domain([1,10]);return t.copy=function(){return F_(t,e()).base(t.base())},Kb.apply(t,arguments)}),[tk,ik,L_]),hk("".concat(H_,"-").concat(I_),N_,[tk,ik]),hk("".concat(H_,"-").concat(q_),(function(){return N_.apply(null,arguments).exponent(.5)}),[tk,ik]),hk("".concat(H_,"-").concat(U_),(function e(){var t=y_(j_());return t.copy=function(){return F_(t,e()).constant(t.constant())},Kb.apply(t,arguments)}),[tk,ik]),hk("".concat(G_,"-").concat(B_),(function e(){var t=o_(R_()(Qw));return t.copy=function(){return F_(t,e())},Kb.apply(t,arguments)}),[tk,ik]),hk("".concat(G_,"-").concat(L_),(function e(){var t=p_(R_()).domain([.1,1,10]);return t.copy=function(){return F_(t,e()).base(t.base())},Kb.apply(t,arguments)}),[tk,ik,L_]),hk("".concat(G_,"-").concat(I_),P_,[tk,ik]),hk("".concat(G_,"-").concat(q_),(function(){return P_.apply(null,arguments).exponent(.5)}),[tk,ik]),hk("".concat(G_,"-").concat(U_),(function e(){var t=y_(R_());return t.copy=function(){return F_(t,e()).constant(t.constant())},Kb.apply(t,arguments)}),[tk,ik]),hk(X_,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=Tf(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[xf(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(gf),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},Jb.apply(o,arguments)}),[rk,X_]),hk(Y_,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[xf(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},Jb.apply(o_(s),arguments)}),rk),hk(J_,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[xf(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},Jb.apply(a,arguments)}),rk),hk(ek,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(xf(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=uk(e),r):t.slice()},r.range=function(e){return arguments.length?(n=ck.call(e),r):n.slice()},r.tickFormat=function(e,n){return a_(t[0],ku(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[nk,rk]),hk(K_,Zb,nk),hk(Z_,ok,nk),hk(Q_,(function(){return sk(ok().paddingInner(1))}),nk);const _k=["clamp","base","constant","exponent"];function kk(e,t){const n=t[0],r=ku(t)-n;return function(t){return e(n+t*r)}}function Ok(e,t,n){return Xw($k(t||"rgb",n),e)}function Sk(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Ek(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=hk(a)().domain([t,n]).range([0,1]),_k.forEach((t=>e[t]?o[t](e[t]()):0)),o):Ju(.5)}function $k(e,t){const n=Yw[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Ak(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Dk(e,t){for(const n in e)Mk(n,t(e[n]))}const Ck={};function Mk(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Ck[e]=t,this):Ck[e]}Dk({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Ak),Dk({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>Ok(Ak(e))));const jk="symbol",Fk=e=>yu(e)?e.map((e=>String(e))):String(e),Tk=(e,t)=>e[1]-t[1],Nk=(e,t)=>t[1]-e[1];function Rk(e,t,n){let r;return fc(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(xc(e.domain())/n||1)))),vu(t)&&(r=t.step,t=t.interval),hc(t)&&(t=e.type===V_?yh(t):e.type==W_?vh(t):ou("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function Pk(e,t,n){let r=e.range(),i=r[0],a=ku(r),o=Tk;if(i>a&&(r=a,a=i,i=r,o=Nk),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(o).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],ku(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function zk(e,t){return e.bins?Pk(e,e.bins):e.ticks?e.ticks(t):e.domain()}function Bk(e,t,n,r,i,a){const o=t.type;let s=Fk;if(o===V_||i===V_)s=e.timeFormat(r);else if(o===W_||i===W_)s=e.utcFormat(r);else if(bk(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=Lk(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function Lk(e,t,n){const r=zk(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const Ik={[X_]:"quantiles",[Y_]:"thresholds",[J_]:"domain"},qk={[X_]:"quantiles",[Y_]:"domain"};function Uk(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=ku(e),t}(e.bins):e.type===L_?Lk(e,t,!0):Ik[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[Ik[e.type]]()):zk(e,t)}function Vk(e,t,n,r,i,a,o){const s=qk[t.type]&&a!==V_&&a!==W_?function(e,t,n){const r=t[qk[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):Bk(e,t,n,i,a,o);return r===jk&&(e=>Ik[e.type]||e.bins)(t)?Wk(s):"discrete"===r?Gk(s):Xk(s)}const Wk=e=>(t,n,r)=>{const i=Hk(r[n+1],Hk(r.max,1/0)),a=Yk(t,e),o=Yk(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a},Hk=(e,t)=>null!=e?e:t,Gk=e=>(t,n)=>n?e(t):null,Xk=e=>t=>e(t),Yk=(e,t)=>Number.isFinite(e)?t(e):null;function Jk(e,t,n,r){const i=r||t.type;return hc(n)&&function(e){return mk(e,ak)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==V_?n||i!==W_?Vk(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function Kk(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=Jk(e,t,n.format,n.formatType);if(vk(t.type)){const e=Uk(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(yk(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(ku(e)))}}let Qk=0;const Zk="p_";function eO(e){return e&&e.gradient}function tO(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?Zk:"";return i||(i=e.id="gradient_"+Qk++,"radial"===r?(e.x1=nO(e.x1,.5),e.y1=nO(e.y1,.5),e.r1=nO(e.r1,0),e.x2=nO(e.x2,.5),e.y2=nO(e.y2,.5),e.r2=nO(e.r2,.5),a=Zk):(e.x1=nO(e.x1,0),e.y1=nO(e.y1,0),e.x2=nO(e.x2,1),e.y2=nO(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function nO(e,t){return null!=e?e:t}function rO(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const iO={basis:{curve:function(e){return new vb(e)}},"basis-closed":{curve:function(e){return new bb(e)}},"basis-open":{curve:function(e){return new xb(e)}},bundle:{curve:_b,tension:"beta",value:.85},cardinal:{curve:Sb,tension:"tension",value:0},"cardinal-open":{curve:Db,tension:"tension",value:0},"cardinal-closed":{curve:$b,tension:"tension",value:0},"catmull-rom":{curve:jb,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Tb,tension:"alpha",value:.5},"catmull-rom-open":{curve:Rb,tension:"alpha",value:.5},linear:{curve:cb},"linear-closed":{curve:function(e){return new Pb(e)}},monotone:{horizontal:function(e){return new Ub(e)},vertical:function(e){return new qb(e)}},natural:{curve:function(e){return new Wb(e)}},step:{curve:function(e){return new Gb(e,.5)}},"step-after":{curve:function(e){return new Gb(e,1)}},"step-before":{curve:function(e){return new Gb(e,0)}}};function aO(e,t,n){var r=nc(iO,e)&&iO[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const oO={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},sO=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function lO(e){const t=[];let n,r,i,a,o,s,l,u,c,f;const d=e.slice().replace(sO[0],"###$1").split(sO[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],r=n.slice(1).trim().replace(sO[2],"$1###$2").replace(sO[3],"$1###$2").split(sO[4]),o=n.charAt(0),i=[o],u=0,f=r.length;u<f;++u)(a=+r[u])===a&&i.push(a);if(s=oO[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const uO=Math.PI/180,cO=Math.PI/2,fO=2*Math.PI,dO=Math.sqrt(3)/2;var hO={},pO={},mO=[].join;function gO(e){const t=mO.call(e);if(pO[t])return pO[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*m,_=r+m+x*p,k=n+g,O=r+y,S=k+x*y,E=O-x*g;return pO[t]=[c*w+f*_,d*w+h*_,c*S+f*E,d*S+h*E,c*k+f*O,d*k+h*O]}const yO=["l",0,0,0,0,0,0,0];function vO(e,t,n){const r=yO[0]=e[0];if("a"===r||"A"===r)yO[1]=t*e[1],yO[2]=n*e[2],yO[3]=e[3],yO[4]=e[4],yO[5]=e[5],yO[6]=t*e[6],yO[7]=n*e[7];else if("h"===r||"H"===r)yO[1]=t*e[1];else if("v"===r||"V"===r)yO[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)yO[i]=(i%2==1?t:n)*e[i];return yO}function bO(e,t,n,r,i,a){var o,s,l,u,c,f=null,d=0,h=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(o=t[g],1===i&&1===a||(o=vO(o,i,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+r);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+r);break;case"h":d+=o[1],e.lineTo(d+n,h+r);break;case"H":d=o[1],e.lineTo(d+n,h+r);break;case"v":h+=o[1],e.lineTo(d+n,h+r);break;case"V":h=o[1],e.lineTo(d+n,h+r);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+r);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+r);break;case"c":s=d+o[5],l=h+o[6],p=d+o[3],m=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+r,p+n,m+r,s+n,l+r),d=s,h=l;break;case"C":d=o[5],h=o[6],p=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,p+n,m+r,d+n,h+r);break;case"s":s=d+o[3],l=h+o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,d+o[1]+n,h+o[2]+r,s+n,l+r),p=d+o[1],m=h+o[2],d=s,h=l;break;case"S":s=o[3],l=o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"q":s=d+o[3],l=h+o[4],p=d+o[1],m=h+o[2],e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"Q":s=o[3],l=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"t":s=d+o[1],l=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,m=h):"t"===f[0]?(p=2*d-u,m=2*h-c):"q"===f[0]&&(p=2*d-p,m=2*h-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),h=l,p=(d=s)+o[1],m=h+o[2];break;case"T":s=o[1],l=o[2],p=2*d-p,m=2*h-m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"a":xO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+r]),d+=o[6],h+=o[7];break;case"A":xO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function xO(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=mO.call(arguments);if(hO[u])return hO[u];const c=o*uO,f=Math.sin(c),d=Math.cos(c),h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5;let m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=d/n,y=f/n,v=-f/r,b=d/r,x=g*s+y*l,w=v*s+b*l,_=g*e+y*t,k=v*e+b*t;let O=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;O<0&&(O=0);let S=Math.sqrt(O);a==i&&(S=-S);const E=.5*(x+_)-S*(k-w),$=.5*(w+k)+S*(_-x),A=Math.atan2(w-$,x-E);let D=Math.atan2(k-$,_-E)-A;D<0&&1===a?D+=fO:D>0&&0===a&&(D-=fO);const C=Math.ceil(Math.abs(D/(cO+.001))),M=[];for(let e=0;e<C;++e){const t=A+e*D/C,i=A+(e+1)*D/C;M[e]=[E,$,t,i,n,r,f,d]}return hO[u]=M}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=gO(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const wO=.5773502691896257,_O={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,fO)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n,i=r-n*wO,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n,i=r-n*wO;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=dO*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function kO(e){return nc(_O,e)?_O[e]:function(e){if(!nc(OO,e)){const t=lO(e);OO[e]={draw:function(e,n){bO(e,t,0,0,Math.sqrt(n)/2)}}}return OO[e]}(e)}var OO={};const SO=.448084975506;function EO(e){return e.x}function $O(e){return e.y}function AO(e){return e.width}function DO(e){return e.height}function CO(e){return"function"==typeof e?e:()=>+e}function MO(e,t,n){return Math.max(t,Math.min(e,n))}function jO(){var e=EO,t=$O,n=AO,r=DO,i=CO(0),a=i,o=i,s=i,l=null;function u(u,c,f){var d,h=null!=c?c:+e.call(this,u),p=null!=f?f:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),y=Math.min(m,g)/2,v=MO(+i.call(this,u),0,y),b=MO(+a.call(this,u),0,y),x=MO(+o.call(this,u),0,y),w=MO(+s.call(this,u),0,y);if(l||(l=d=Lv()),v<=0&&b<=0&&x<=0&&w<=0)l.rect(h,p,m,g);else{var _=h+m,k=p+g;l.moveTo(h+v,p),l.lineTo(_-b,p),l.bezierCurveTo(_-SO*b,p,_,p+SO*b,_,p+b),l.lineTo(_,k-w),l.bezierCurveTo(_,k-SO*w,_-SO*w,k,_-w,k),l.lineTo(h+x,k),l.bezierCurveTo(h+SO*x,k,h,k-SO*x,h,k-x),l.lineTo(h,p+v),l.bezierCurveTo(h,p+SO*v,h+SO*v,p,h+v,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(t){return arguments.length?(e=CO(t),u):e},u.y=function(e){return arguments.length?(t=CO(e),u):t},u.width=function(e){return arguments.length?(n=CO(e),u):n},u.height=function(e){return arguments.length?(r=CO(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=CO(e),a=null!=t?CO(t):i,s=null!=n?CO(n):i,o=null!=r?CO(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function FO(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var f=Math.sqrt(u*u+c*c),d=(u/=f)*s,h=(c/=f)*s,p=Math.atan2(c,u);l.moveTo(a-d,o-h),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+d,o+h),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,fO);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,f=a.length,d=!1;for(null==l&&(l=c=Lv()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===d&&(d=!d)&&(i=0),d&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function TO(e,t){return null!=e?e:t}const NO=e=>e.x||0,RO=e=>e.y||0,PO=e=>!(!1===e.defined),zO=function(){var e=tb,t=nb,n=Iv(0),r=null,i=rb,a=ib,o=ab,s=null;function l(){var l,u,c=+e.apply(this,arguments),f=+t.apply(this,arguments),d=i.apply(this,arguments)-Kv,h=a.apply(this,arguments)-Kv,p=qv(h-d),m=h>d;if(s||(s=l=Lv()),f<c&&(u=f,f=c,c=u),f>Yv)if(p>Qv-Yv)s.moveTo(f*Vv(d),f*Gv(d)),s.arc(0,0,f,d,h,!m),c>Yv&&(s.moveTo(c*Vv(h),c*Gv(h)),s.arc(0,0,c,h,d,m));else{var g,y,v=d,b=h,x=d,w=h,_=p,k=p,O=o.apply(this,arguments)/2,S=O>Yv&&(r?+r.apply(this,arguments):Xv(c*c+f*f)),E=Hv(qv(f-c)/2,+n.apply(this,arguments)),$=E,A=E;if(S>Yv){var D=eb(S/c*Gv(O)),C=eb(S/f*Gv(O));(_-=2*D)>Yv?(x+=D*=m?1:-1,w-=D):(_=0,x=w=(d+h)/2),(k-=2*C)>Yv?(v+=C*=m?1:-1,b-=C):(k=0,v=b=(d+h)/2)}var M=f*Vv(v),j=f*Gv(v),F=c*Vv(w),T=c*Gv(w);if(E>Yv){var N,R=f*Vv(b),P=f*Gv(b),z=c*Vv(x),B=c*Gv(x);if(p<Jv&&(N=ob(M,j,z,B,R,P,F,T))){var L=M-N[0],I=j-N[1],q=R-N[0],U=P-N[1],V=1/Gv(Zv((L*q+I*U)/(Xv(L*L+I*I)*Xv(q*q+U*U)))/2),W=Xv(N[0]*N[0]+N[1]*N[1]);$=Hv(E,(c-W)/(V-1)),A=Hv(E,(f-W)/(V+1))}}k>Yv?A>Yv?(g=sb(z,B,M,j,f,A,m),y=sb(R,P,F,T,f,A,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),A<E?s.arc(g.cx,g.cy,A,Uv(g.y01,g.x01),Uv(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,A,Uv(g.y01,g.x01),Uv(g.y11,g.x11),!m),s.arc(0,0,f,Uv(g.cy+g.y11,g.cx+g.x11),Uv(y.cy+y.y11,y.cx+y.x11),!m),s.arc(y.cx,y.cy,A,Uv(y.y11,y.x11),Uv(y.y01,y.x01),!m))):(s.moveTo(M,j),s.arc(0,0,f,v,b,!m)):s.moveTo(M,j),c>Yv&&_>Yv?$>Yv?(g=sb(F,T,R,P,c,-$,m),y=sb(M,j,z,B,c,-$,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),$<E?s.arc(g.cx,g.cy,$,Uv(g.y01,g.x01),Uv(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,$,Uv(g.y01,g.x01),Uv(g.y11,g.x11),!m),s.arc(0,0,c,Uv(g.cy+g.y11,g.cx+g.x11),Uv(y.cy+y.y11,y.cx+y.x11),m),s.arc(y.cx,y.cy,$,Uv(y.y11,y.x11),Uv(y.y01,y.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(F,T)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-Jv/2;return[Vv(r)*n,Gv(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:Iv(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:Iv(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:Iv(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:Iv(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:Iv(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:Iv(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:Iv(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),BO=pb().x(NO).y1(RO).y0((e=>(e.y||0)+(e.height||0))).defined(PO),LO=pb().y(RO).x1(NO).x0((e=>(e.x||0)+(e.width||0))).defined(PO),IO=hb().x(NO).y(RO).defined(PO),qO=jO().x(NO).y(RO).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>TO(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>TO(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>TO(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>TO(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),UO=function(e,t){var n=null;function r(){var r;if(n||(n=r=Lv()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:Iv(e||mb),t="function"==typeof t?t:Iv(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:Iv(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:Iv(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>kO(e.shape||"circle"))).size((e=>TO(e.size,64))),VO=FO().x(NO).y(RO).defined(PO).size((e=>e.size||1));function WO(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function HO(e,t,n,r){return qO.context(e)(t,n,r)}var GO=1;function XO(){GO=1}function YO(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+GO++),o=i.clipping[a]||(i.clipping[a]={id:a});return Vu(r)?o.path=r(null):WO(n)?o.path=HO(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function JO(e){this.clear(),e&&this.union(e)}function KO(e){this.mark=e,this.bounds=this.bounds||new JO}function QO(e){KO.call(this,e),this.items=this.items||[]}function ZO(e){this._pending=0,this._loader=e||Am()}function eS(e){e._pending+=1}function tS(e){e._pending-=1}function nS(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}JO.prototype={clone(){return new JO(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},oc(QO,KO),ZO.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return eS(t),t._loader.sanitize(e,{context:"href"}).then((e=>(tS(t),e))).catch((()=>(tS(t),null)))},loadImage(e){const t=this,n=Yb();return eS(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=nc(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>tS(t),i.onerror=()=>tS(t),i.src=r,i})).catch((e=>(tS(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const rS=fO-1e-8;let iS,aS,oS,sS,lS,uS,cS,fS;const dS=(e,t)=>iS.add(e,t),hS=(e,t)=>dS(aS=e,oS=t),pS=e=>dS(e,iS.y1),mS=e=>dS(iS.x1,e),gS=(e,t)=>lS*e+cS*t,yS=(e,t)=>uS*e+fS*t,vS=(e,t)=>dS(gS(e,t),yS(e,t)),bS=(e,t)=>hS(gS(e,t),yS(e,t));function xS(e,t){return iS=e,t?(sS=t*uO,lS=fS=Math.cos(sS),uS=Math.sin(sS),cS=-uS):(lS=fS=1,sS=uS=cS=0),wS}const wS={beginPath(){},closePath(){},moveTo:bS,lineTo:bS,rect(e,t,n,r){sS?(vS(e+n,t),vS(e+n,t+r),vS(e,t+r),bS(e,t)):(dS(e+n,t+r),hS(e,t))},quadraticCurveTo(e,t,n,r){const i=gS(e,t),a=yS(e,t),o=gS(n,r),s=yS(n,r);_S(aS,i,o,pS),_S(oS,a,s,mS),hS(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=gS(e,t),s=yS(e,t),l=gS(n,r),u=yS(n,r),c=gS(i,a),f=yS(i,a);kS(aS,o,l,c,pS),kS(oS,s,u,f,mS),hS(c,f)},arc(e,t,n,r,i,a){if(r+=sS,i+=sS,aS=n*Math.cos(i)+e,oS=n*Math.sin(i)+t,Math.abs(i-r)>rS)dS(e-n,t-n),dS(e+n,t+n);else{const o=r=>dS(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=fO)<0&&(r+=fO),(i%=fO)<0&&(i+=fO),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=fO,s=r-r%cO,l=0;l<4&&s>i;++l,s-=cO)o(s);else for(s=r-r%cO+cO,l=0;l<4&&s<i;++l,s+=cO)o(s)}}};function _S(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function kS(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(OS(u,e,t,n,r)),0<c&&c<1&&i(OS(c,e,t,n,r))}function OS(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var SS=(SS=Xb(1,1))?SS.getContext("2d"):null;const ES=new JO;function $S(e){return function(t,n){if(!SS)return!0;e(SS,t),ES.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=ES;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(SS.isPointInPath(t,e))return!0;return!1}}function AS(e,t){return t.contains(e.x||0,e.y||0)}function DS(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(ES.set(n,r,n+i,r+a))}function CS(e,t){const n=e.x||0,r=e.y||0;return MS(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function MS(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let f,d,h,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(f=-u,d=-(a-t)),1===p&&(f=u,d=s-t),2===p&&(f=-c,d=-(o-n)),3===p&&(f=c,d=l-n),Math.abs(f)<1e-10&&d<0)return!1;if(h=d/f,f<0){if(h>g)return!1;h>m&&(m=h)}else if(f>0){if(h<m)return!1;h<g&&(g=h)}}return!0}function jS(e,t){e.globalCompositeOperation=t.blend||"source-over"}function FS(e,t){return null==e?t:e}function TS(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function NS(e,t,n){return eO(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+FS(t.x1,.5)*r,n.y1+FS(t.y1,.5)*i,Math.max(r,i)*FS(t.r1,0),n.x1+FS(t.x2,.5)*r,n.y1+FS(t.y2,.5)*i,Math.max(r,i)*FS(t.r2,.5));else{const o=FS(t.x1,0),s=FS(t.y1,0),l=FS(t.x2,1),u=FS(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=Xb(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=TS(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return TS(a,t.stops)}(e,n,t.bounds):n}function RS(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=NS(e,t,t.fill),!0)}var PS=[];function zS(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&((n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=NS(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||PS),e.lineDashOffset=t.strokeDashOffset||0),!0))}function BS(e,t){return e.zindex-t.zindex||e.index-t.index}function LS(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(BS)}function IS(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=LS(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function qS(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=LS(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function US(e){return function(t,n,r){IS(n,(n=>{r&&!r.intersects(n.bounds)||WS(e,t,n,n)}))}}function VS(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||WS(e,t,n.items[0],n.items)}}function WS(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(jS(t,n),n.fill&&RS(t,n,i)&&t.fill(),n.stroke&&zS(t,n,i)&&t.stroke()))}function HS(e){return e=e||hu,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,qS(n,(n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function GS(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(o=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function XS(e){return HS(GS(e))}function YS(e,t){return"translate("+e+","+t+")"}function JS(e){return"rotate("+e+")"}function KS(e){return YS(e.x||0,e.y||0)}function QS(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=uO),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return YS(e.x||0,e.y||0)+(e.angle?" "+JS(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(xS(e,n.angle),n),nS(e,n).translate(n.x||0,n.y||0)},draw:US(r),pick:XS(r),isect:n||$S(r)}}var ZS=QS("arc",(function(e,t){return zO.context(e)(t)}));function eE(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=GS(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(xS(e),r),nS(e,r[0]))},draw:VS(r),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:AS,tip:n}}var tE=eE("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?LO:BO).curve(aO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function nE(e,t){e.beginPath(),WO(t)?HO(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function rE(e){const t=FS(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function iE(e,t){const n=rE(t);e("d",HO(null,t,n,n))}function aE(e,t,n,r){const i=rE(t);e.beginPath(),HO(e,t,(n||0)+i,(r||0)+i)}const oE=GS(aE),sE=GS(aE,!1),lE=GS(aE,!0);var uE={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",KS(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),nS(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){IS(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(aE(e,t,r,i),jS(e,t),t.fill&&RS(e,t,o)&&e.fill(),t.stroke&&!a&&zS(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&nE(e,t),n&&n.translate(-r,-i),IS(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(aE(e,t,r,i),jS(e,t),zS(e,t,o)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return qS(t,(l=>{let u,c,f;const d=l.bounds;if(d&&!d.contains(i,a))return;c=l.x||0,f=l.y||0;const h=c+(l.width||0),p=f+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<f||a>p))return;if(e.save(),e.translate(c,f),c=i-c,f=a-f,m&&WO(l)&&!lE(e,l,o,s))return e.restore(),null;const g=l.strokeForeground,y=!1!==t.interactive;return y&&g&&l.stroke&&sE(e,l,o,s)?(e.restore(),l):(u=qS(l,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,f)?this.pick(e,n,r,c,f):null)),!u&&y&&(l.fill||!g&&l.stroke)&&oE(e,l,o,s)&&(u=l),e.restore(),u||null)}))},isect:DS,content:function(e,t,n){e("clip-path",t.clip?YO(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),iE(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?iE(e,t):e("d","")}},cE={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function fE(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function dE(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function hE(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function pE(e,t){return"center"===e?t/2:"right"===e?t:0}function mE(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var gE={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=fE(t,n),i=dE(t,r),a=hE(t,r),o=(t.x||0)-pE(t.align,i),s=(t.y||0)-mE(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",cE["xmlns:xlink"],"xlink:href"),e("transform",YS(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=dE(t,n),i=hE(t,n),a=(t.x||0)-pE(t.align,r),o=(t.y||0)-mE(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){IS(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=fE(t,this);let i,a,o,s,l=dE(t,r),u=hE(t,r),c=(t.x||0)-pE(t.align,l),f=(t.y||0)-mE(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,f+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(jS(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,f,l,u))}))},pick:HS(),isect:hu,get:fE,xOffset:pE,yOffset:mE},yE=eE("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return IO.curve(aO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function vE(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*uO,l=t.pathCache;l&&l.path===n||((t.pathCache=l=lO(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),bO(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):bO(e,l,r,i,a,o)}var bE={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return YS(e.x||0,e.y||0)+(e.angle?" "+JS(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return vE(xS(e,t.angle),t)?e.set(0,0,0,0):nS(e,t,!0)},draw:US(vE),pick:XS(vE),isect:$S(vE)};function xE(e,t){e.beginPath(),HO(e,t)}var wE={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",HO(null,t))},bound:function(e,t){var n,r;return nS(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:US(xE),pick:XS(xE),isect:DS};function _E(e,t,n){var r,i,a,o;return!(!t.stroke||!zS(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var kE={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",KS(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return nS(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){IS(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&_E(e,t,r)&&(jS(e,t),e.stroke())}}))},pick:HS((function(e,t,n,r){return!!e.isPointInStroke&&(_E(e,t,1)&&e.isPointInStroke(n,r))})),isect:CS},OE=QS("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),SE=QS("symbol",(function(e,t){return UO.context(e)(t)}),AS);const EE=gc();var $E={height:FE,measureWidth:ME,estimateWidth:DE,width:DE,canvas:AE};function AE(e){$E.width=e&&SS?ME:DE}function DE(e,t){return CE(PE(e,t),FE(e))}function CE(e,t){return~~(.8*e.length*t)}function ME(e,t){return FE(e)<=0||!(t=PE(e,t))?0:jE(t,BE(e))}function jE(e,t){const n="(".concat(t,") ").concat(e);let r=EE.get(n);return void 0===r&&(SS.font=t,r=SS.measureText(e).width,EE.set(n,r)),r}function FE(e){return null!=e.fontSize?+e.fontSize||0:11}function TE(e){return null!=e.lineHeight?e.lineHeight:FE(e)+2}function NE(e){return function(e){return yu(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!yu(e.text)?e.text.split(e.lineBreak):e.text)}function RE(e){const t=NE(e);return(yu(t)?t.length-1:0)*TE(e)}function PE(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if($E.width===ME){const t=BE(e);return e=>jE(e,t)}{const t=FE(e);return e=>CE(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"…",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)i=s+l>>>1,r(t.slice(i))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)i=1+(s+l>>>1),r(t.slice(0,i))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function zE(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function BE(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+FE(e)+"px "+zE(e,t)}function LE(e){var t=e.baseline,n=FE(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*TE(e):"line-bottom"===t?.29*n-.5*TE(e):0)}AE(!0);const IE={left:"start",center:"middle",right:"end"},qE=new JO;function UE(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-cO,n+=i*Math.cos(t),r+=i*Math.sin(t)),qE.x1=n,qE.y1=r,qE}function VE(e,t,n){var r,i=$E.height(t),a=t.align,o=UE(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+LE(t)-Math.round(.8*i),f=NE(t);if(yu(f)?(i+=TE(t)*(f.length-1),r=f.reduce(((e,n)=>Math.max(e,$E.width(t,n))),0)):r=$E.width(t,f),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*uO,s,l);else if(2===n)return e.rotatedPoints(t.angle*uO,s,l);return e}var WE={arc:ZS,area:tE,group:uE,image:gE,line:yE,path:bE,rect:wE,rule:kE,shape:OE,symbol:SE,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+LE(t),a=UE(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",IE[t.align]||"start"),l?(n=YS(o,s)+" "+JS(l),(r||i)&&(n+=" "+YS(r,i))):n=YS(o+r,s+i),e("transform",n)},bound:VE,draw:function(e,t,n){IS(t,(t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=BE(t),e.textAlign=t.align||"left",i=(r=UE(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*uO),i=a=0),i+=t.dx||0,a+=(t.dy||0)+LE(t),l=NE(t),jS(e,t),yu(l))for(s=TE(t),o=0;o<l.length;++o)u=PE(t,l[o]),t.fill&&RS(e,t,c)&&e.fillText(u,i,a),t.stroke&&zS(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=PE(t,l),t.fill&&RS(e,t,c)&&e.fillText(u,i,a),t.stroke&&zS(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}}))},pick:HS((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=UE(t),s=o.x1,l=o.y1,u=VE(qE,t,1),c=-t.angle*uO,f=Math.cos(c),d=Math.sin(c),h=f*i-d*a+(s-f*s+d*l),p=d*i+f*a+(l-d*s-f*l);return u.contains(h,p)})),isect:function(e,t){const n=VE(qE,e,2);return MS(t,n[0],n[1],n[2],n[3])||MS(t,n[0],n[1],n[4],n[5])||MS(t,n[4],n[5],n[6],n[7])||MS(t,n[2],n[3],n[6],n[7])}},trail:eE("trail",(function(e,t){return VO.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function HE(e,t,n){var r=WE[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new JO),e,n)}var GE={mark:null};function XE(e,t,n){var r,i,a,o,s=WE[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(GE.mark=e,a=GE),o=HE(a,l,n),t=t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new JO,c)for(r=0,i=u.length;r<i;++r)t.union(HE(u[r],l,n));return e.bounds=t}const YE=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function JE(e,t){return JSON.stringify(e,YE,t)}function KE(e){return QE("string"==typeof e?JSON.parse(e):e)}function QE(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&QE(a[n]);return i&&XE(e),e}function ZE(e){arguments.length?this.root=KE(e):(this.root=e$({marktype:"group",name:"root",role:"frame"}),this.root.items=[new QO(this.root)])}function e$(e,t){const n={bounds:new JO,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function t$(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function n$(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function r$(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=t$(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function i$(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function a$(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function o$(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function s$(e,t){this._active=null,this._handlers={},this._loader=e||Am(),this._tooltip=t||l$}function l$(e,t,n,r){e.element().setAttribute("title",r||"")}function u$(e){this._el=null,this._bgcolor=null,this._loader=new ZO(e)}ZE.prototype={toJSON(e){return JE(this.root,e||0)},mark(e,t,n){const r=e$(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},s$.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=t$(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=WE[o.marktype]).tip){for((a=o$(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},u$.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const c$="dragenter",f$="dragleave",d$="dragover",h$="mousedown",p$="mousemove",m$="mouseout",g$="mouseover",y$="click",v$="mousewheel",b$="touchstart",x$="touchmove",w$="touchend",_$=p$,k$=m$,O$=y$;function S$(e,t){s$.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function E$(e,t){(e=>e===b$||e===x$||e===w$?[b$,x$,w$]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function $$(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function A$(e){return function(t){this.fire(e,t),this._active=null}}oc(S$,s$,{initialize(e,t,n){return this._canvas=e&&n$(e,"canvas"),[y$,h$,p$,m$,f$].forEach((e=>E$(this,e))),s$.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",c$,f$,d$,h$,"mouseup",p$,m$,g$,y$,"dblclick","wheel",v$,b$,x$,w$],DOMMouseScroll(e){this.fire(v$,e)},mousemove:$$(p$,g$,m$),dragover:$$(d$,c$,f$),mouseout:A$(m$),dragleave:A$(f$),mousedown(e){this._down=this._active,this.fire(h$,e)},click(e){this._down===this._active&&(this.fire(y$,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(b$,e,!0)},touchmove(e){this.fire(x$,e,!0)},touchend(e){this.fire(w$,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===O$&&r&&r.href?this.handleHref(t,r,r.href):e!==_$&&e!==k$||this.handleTooltip(t,r,e!==k$),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(E$(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=o$(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return WE[e.marktype].pick.call(this,a,e,t,n,r,i)}});var D$="undefined"!=typeof window&&window.devicePixelRatio||1;function C$(e){u$.call(this,e),this._options={},this._redraw=!1,this._dirty=new JO,this._tempb=new JO}const M$=u$.prototype;function j$(e,t){s$.call(this,e,t);const n=this;n._hrefHandler=F$(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=F$(n,((e,t)=>{n.handleTooltip(e,t,e.type!==k$)}))}oc(C$,u$,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:Xb(1,1,this._options.type),e&&this._canvas&&(i$(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),M$.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(M$.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?D$:i;e.width=t*l,e.height=n*l;for(const e in a)s[e]=a[e];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||ou("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((e,t,n)=>(new JO).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=WE[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),Vu(n)?(e.beginPath(),n(e),e.clip()):nE(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const F$=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};oc(j$,s$,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(O$,this._hrefHandler),r.removeEventListener(_$,this._tooltipHandler),r.removeEventListener(k$,this._tooltipHandler)),this._svg=r=e&&n$(e,"svg"),r&&(r.addEventListener(O$,this._hrefHandler),r.addEventListener(_$,this._tooltipHandler),r.addEventListener(k$,this._tooltipHandler)),s$.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:F$(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const T$="aria-hidden",N$="aria-label",R$="role",P$="aria-roledescription",z$="graphics-object",B$="graphics-symbol",L$=(e,t,n)=>({[R$]:e,[P$]:t,[N$]:n||void 0}),I$=Ec(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),q$={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?G$(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(yk(s)?"discrete":s," scale")+" with ".concat(Kk(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?G$(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return u=r,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+ku(e)}(a))+" with ".concat(Kk(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(H$(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(H$(e),"'")}},U$={ariaRole:R$,ariaRoleDescription:P$,description:N$};function V$(e,t){const n=!1===t.aria;if(e(T$,n||void 0),n||null==t.description)for(const t in U$)e(U$[t],void 0);else{const n=t.mark.marktype;e(N$,t.description),e(R$,t.ariaRole||("group"===n?z$:B$)),e(P$,t.ariaRoleDescription||"".concat(n," mark"))}}function W$(e){return!1===e.aria?{[T$]:!0}:I$[e.role]?null:q$[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return L$(t.role||B$,t.desc,n.description||r(n))}catch(e){return null}}(e,q$[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return L$(n?z$:B$,"".concat(t," mark container"),e.description)}(e)}function H$(e){return qu(e.text).join(" ")}function G$(e){try{return qu(ku(e.items).items[0].text).join(" ")}catch(e){return null}}const X$=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function Y$(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(X$(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=X$(e),o),toString:()=>e};return o}const J$=e=>K$(Y$(),e)+"";function K$(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):K$(e,r)}}return e.close()}const Q$={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},Z$={fill:"none","stroke-miterlimit":10},eA=cE.xmlns;function tA(e){u$.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const nA=u$.prototype;function rA(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function iA(e,t,n){let r,i,a;if("radial"===t.gradient){let r=r$(e,n++,"pattern",eA);dA(r,{id:Zk+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=r$(r,0,"rect",eA),dA(r,{width:1,height:1,fill:"url(".concat(pA(),"#").concat(t.id,")")}),dA(e=r$(e,n++,"radialGradient",eA),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else dA(e=r$(e,n++,"linearGradient",eA),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=r$(e,r,"stop",eA),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return i$(e,r),n}function aA(e,t,n){let r;return(e=r$(e,n,"clipPath",eA)).setAttribute("id",t.id),t.path?(r=r$(e,0,"path",eA),r.setAttribute("d",t.path)):(r=r$(e,0,"rect",eA),dA(r,{x:0,y:0,width:t.width,height:t.height})),i$(e,1),n+1}function oA(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=t$(a,r,eA),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=t$(a,"path",eA);o.appendChild(t),t.__data__=e;const n=t$(a,"g",eA);o.appendChild(n),n.__data__=e;const r=t$(a,"path",eA);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}oc(tA,u$,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=r$(e,0,"svg",eA),dA(this._svg,cE),this._svg.setAttribute("class","marks"),i$(e,1),this._root=r$(this._svg,0,"g",eA),dA(this._root,Z$),i$(this._svg,1)),this.background(this._bgcolor),nA.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),nA.background.apply(this,arguments)},resize(e,t,n,r){return nA.resize.call(this,e,t,n,r),this._svg&&(dA(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=r$(e,0,"rect",eA),dA(n,{width:this._width,height:this._height,fill:t}));const r=J$(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),i$(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=WE[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,rA(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,rA(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=WE[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=oA(t,e,n,"g",r);u.setAttribute("class",a$(t));const c=W$(t);for(const e in c)hA(u,e,c[e]);o||hA(u,"pointer-events",a),hA(u,"clip-path",t.clip?YO(this,t,t.group):null);const f=e=>{const t=this.isDirty(e),n=oA(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;IS(n,(n=>{r=e.mark(t,n,r),++i})),i$(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&f(t.items[0]):IS(t,f),i$(u,l),u},_update(e,t,n){sA=t,lA=t.__values__,V$(cA,n),e.attr(cA,n,this);const r=uA[e.type];r&&r.call(this,e,t,n),sA&&this.style(sA,n)},style(e,t){if(null!=t)for(const n in Q$){let r="font"===n?zE(t):t[n];if(r===lA[n])continue;const i=Q$[n];null==r?e.removeAttribute(i):(eO(r)&&(r=tO(r,this._defs.gradient,pA())),e.setAttribute(i,r+"")),lA[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=r$(e,1,"defs",eA)),r=iA(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=r$(e,1,"defs",eA)),r=aA(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):i$(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let sA=null,lA=null;const uA={group(e,t,n){const r=sA=t.childNodes[2];lA=r.__values__,e.foreground(cA,n,this),lA=t.__values__,sA=t.childNodes[1],e.content(cA,n,this);const i=sA=t.childNodes[0];e.background(cA,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==lA.events&&(hA(r,"pointer-events",a),hA(i,"pointer-events",a),lA.events=a),n.strokeForeground&&n.stroke){const e=n.fill;hA(r,"display",null),this.style(i,n),hA(i,"stroke",null),e&&(n.fill=null),lA=r.__values__,this.style(r,n),e&&(n.fill=e),sA=null}else hA(r,"display","none")},image(e,t,n){!1===n.smooth?(fA(t,"image-rendering","optimizeSpeed"),fA(t,"image-rendering","pixelated")):fA(t,"image-rendering",null)},text(e,t,n){const r=NE(n);let i,a,o,s;yu(r)?(a=r.map((e=>PE(n,e))),i=a.join("\n"),i!==lA.text&&(i$(t,0),o=t.ownerDocument,s=TE(n),a.forEach(((e,r)=>{const i=t$(o,"tspan",eA);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)})),lA.text=i)):(a=PE(n,r),a!==lA.text&&(t.textContent=a,lA.text=a)),hA(t,"font-family",zE(n)),hA(t,"font-size",FE(n)+"px"),hA(t,"font-style",n.fontStyle),hA(t,"font-variant",n.fontVariant),hA(t,"font-weight",n.fontWeight)}};function cA(e,t,n){t!==lA[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(sA,e,t,n):hA(sA,e,t),lA[e]=t)}function fA(e,t,n){n!==lA[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),lA[t]=n)}function dA(e,t){for(const n in t)hA(e,n,t[n])}function hA(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function pA(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function mA(e){u$.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}oc(mA,u$,{svg(){return this._text},_render(e){const t=Y$();t.open("svg",Qu({},cE,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",Z$,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=WE[t.marktype],r=n.tag,i=[V$,n.attr];e.open("g",{class:a$(t),"clip-path":t.clip?YO(this,t,t.group):null},W$(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=NE(a);if(yu(t)){const n={x:0,dy:TE(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(PE(a,t[r])).close()}else e.text(PE(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),IS(a,(t=>this.mark(e,t))),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):IS(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;"bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===r&&(e["font-family"]=zE(t),e["font-size"]=FE(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in Q$){let r=t[n];const a=Q$[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(eO(r)&&(r=tO(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:Zk+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const gA="canvas",yA="none",vA={Canvas:gA,PNG:"png",SVG:"svg",None:yA},bA={};function xA(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(bA[e]=t,this):bA[e]}function wA(e,t,n){const r=[],i=(new JO).union(t),a=e.marktype;return a?_A(e,i,n,r):"group"===a?kA(e,i,n,r):ou("Intersect scene must be mark node or group item.")}function _A(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)kA(i[s],t,n,r);else for(const e=WE[a].isect;s<o;++s){const n=i[s];OA(n,t,e)&&r.push(n)}}return r}function kA(e,t,n,r){n&&n(e.mark)&&OA(e,t,WE.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)_A(i[e],t,n,r);t.translate(o,s)}return r}function OA(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}bA.canvas=bA.png={renderer:C$,headless:C$,handler:S$},bA.svg={renderer:tA,headless:mA,handler:j$},bA.none={};const SA=new JO;function EA(e){const t=e.clip;if(Vu(t))t(xS(SA.clear()));else{if(!t)return;SA.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(SA)}function $A(e,t,n){return e===t||("path"===n?AA(e,t):e instanceof Date&&t instanceof Date?+e==+t:fc(e)&&fc(t)?Math.abs(e-t)<=1e-9:e&&t&&(vu(e)||vu(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!$A(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function AA(e,t){return $A(lO(e),lO(t))}const DA="top",CA="left",MA="right",jA="bottom",FA="start",TA="middle",NA="end",RA="group",PA="axis",zA="title",BA="frame",LA="scope",IA="legend",qA="row-header",UA="row-footer",VA="row-title",WA="column-header",HA="column-footer",GA="column-title",XA="padding",YA="fit",JA="fit-x",KA="fit-y",QA="none",ZA="all",eD="each",tD="flush",nD="column",rD="row";function iD(e){hg.call(this,null,e)}function aD(e,t,n){return t(e.bounds.clear(),e,n)}oc(iD,hg,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=WE[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=aD(r,o),r.items.forEach((e=>{e.bounds.clear().union(l)}));else if(i===RA||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),l.clear(),r.items.forEach((e=>l.union(aD(e,o)))),r.role){case PA:case IA:case zA:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,(e=>{l.union(aD(e,o))})),t.visit(t.MOD,(e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(aD(e,o))})),s&&(l.clear(),r.items.forEach((e=>l.union(e.bounds))));return EA(r),t.modifies("bounds")}});const oD=":vega_identifier:";function sD(e){hg.call(this,0,e)}function lD(e){hg.call(this,null,e)}function uD(e){hg.call(this,null,e)}sD.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},oc(sD,hg,{transform(e,t){const n=(i=t.dataflow)._signals[oD]||(i._signals[oD]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),oc(lD,hg,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===RA?QO:KO;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const cD={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&fD(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},fD=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),dD=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(fD(a,n=e[r].bounds,t))return!0},hD=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},pD=e=>(e.forEach((e=>e.opacity=1)),e),mD=(e,t)=>e.reflow(t.modified()).modifies("opacity");function gD(e){hg.call(this,null,e)}oc(uD,hg,{transform(e,t){const n=cD[e.method]||cD.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(pD(o),t=mD(t,e)),t;if(o=o.filter(hD),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=pD(o),t=mD(t,e),i.length>=3&&dD(i,r)){do{i=n(i,r)}while(i.length>=3&&dD(i,r));i.length<3&&!ku(o).opacity&&(i.length>1&&(ku(i).opacity=0),ku(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new JO;return t===DA||t===jA?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((e=>{a(e)||(e.opacity=0)})));const s=i[0].mark.bounds.clear();return o.forEach((e=>{e.opacity&&s.union(e.bounds)})),t}}),oc(gD,hg,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const yD=new JO;function vD(e,t,n){return e[t]===n?0:(e[t]=n,1)}function bD(e){var t=e.items[0].orient;return t===CA||t===MA}function xD(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=g&&RE(g),x=0,w=0;switch(yD.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(o.items[i].bounds),(i=c[1])>-1&&v.union(o.items[i].bounds),u){case DA:x=h||0,w=-d,a=Math.max(p,Math.min(m,-v.y1)),v.add(0,-a).add(f,0),g&&wD(e,g,a,y,b,0,-1,v);break;case CA:x=-d,w=h||0,a=Math.max(p,Math.min(m,-v.x1)),v.add(-a,0).add(0,f),g&&wD(e,g,a,y,b,1,-1,v);break;case MA:x=n+d,w=h||0,a=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(a,f),g&&wD(e,g,a,y,b,1,1,v);break;case jA:x=h||0,w=r+d,a=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(f,a),g&&wD(e,g,a,y,0,0,1,v);break;default:x=o.x,w=o.y}return nS(v.translate(x,w),o),vD(o,"x",x+l)|vD(o,"y",w+l)&&(o.bounds=yD,e.dirty(o),o.bounds=v,e.dirty(o)),o.mark.bounds.clear().union(v)}function wD(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const _D=(e,t)=>Math.floor(Math.min(e,t)),kD=(e,t)=>Math.ceil(Math.max(e,t));function OD(e){return(new JO).set(0,0,e.width||0,e.height||0)}function SD(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function ED(e,t,n){const r=vu(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function $D(e){return e<0?Math.ceil(-e):0}function AD(e,t,n){var r,i,a,o,s,l,u,c,f,d,h,p=!n.nodirty,m=n.bounds===tD?OD:SD,g=yD.set(0,0,0,0),y=ED(n.align,nD),v=ED(n.align,rD),b=ED(n.padding,nD),x=ED(n.padding,rD),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,O=Array(k),S=Array(w),E=0,$=Array(k),A=Array(_),D=0,C=Array(k),M=Array(k),j=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)A[i]=0;for(i=0;i<k;++i)l=t[i],s=j[i]=m(l),l.x=l.x||0,C[i]=0,l.y=l.y||0,M[i]=0,a=i%w,o=~~(i/w),E=Math.max(E,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),A[o]=Math.max(A[o],c),O[i]=b+$D(s.x1),$[i]=x+$D(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(O[i]=0),i<w&&($[i]=0);if(y===eD)for(a=1;a<w;++a){for(h=0,i=a;i<k;i+=w)h<O[i]&&(h=O[i]);for(i=a;i<k;i+=w)O[i]=h+S[a-1]}else if(y===ZA){for(h=0,i=0;i<k;++i)i%w&&h<O[i]&&(h=O[i]);for(i=0;i<k;++i)i%w&&(O[i]=h+E)}else for(y=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)O[i]+=S[a-1];if(v===eD)for(o=1;o<_;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<$[i]&&(h=$[i]);for(i=o*w;i<r;++i)$[i]=h+A[o-1]}else if(v===ZA){for(h=0,i=w;i<k;++i)h<$[i]&&(h=$[i]);for(i=w;i<k;++i)$[i]=h+D}else for(v=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)$[i]+=A[o-1];for(f=0,i=0;i<k;++i)f=O[i]+(i%w?f:0),C[i]+=f-t[i].x;for(a=0;a<w;++a)for(d=0,i=a;i<k;i+=w)d+=$[i],M[i]+=d-t[i].y;if(y&&ED(n.center,nD)&&_>1)for(i=0;i<k;++i)(f=(s=y===ZA?E:S[i%w])-j[i].x2-t[i].x-C[i])>0&&(C[i]+=f/2);if(v&&ED(n.center,rD)&&1!==w)for(i=0;i<k;++i)(d=(s=v===ZA?D:A[~~(i/w)])-j[i].y2-t[i].y-M[i])>0&&(M[i]+=d/2);for(i=0;i<k;++i)g.union(j[i].translate(C[i],M[i]));switch(f=ED(n.anchor,"x"),d=ED(n.anchor,"y"),ED(n.anchor,nD)){case NA:f-=g.width();break;case TA:f-=g.width()/2}switch(ED(n.anchor,rD)){case NA:d-=g.height();break;case TA:d-=g.height()/2}for(f=Math.round(f),d=Math.round(d),g.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(l=t[i]).x+=C[i]+=f,l.y+=M[i]+=d,g.union(l.mark.bounds.union(l.bounds.translate(C[i],M[i]))),p&&e.dirty(l);return g}function DD(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===RA)switch(t.role){case PA:case IA:case zA:break;case qA:o.rowheaders.push(...n);break;case UA:o.rowfooters.push(...n);break;case WA:o.colheaders.push(...n);break;case HA:o.colfooters.push(...n);break;case VA:o.rowtitle=n[0];break;case GA:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),f=c.marks,d=n.bounds===tD?CD:MD,h=n.offset,p=n.columns||f.length,m=p<=0?1:Math.ceil(f.length/p),g=m*p;const y=AD(e,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=ED(n.headerBand,rD,null),r=jD(e,c.rowheaders,f,p,m,-ED(h,"rowHeader"),_D,0,d,"x1",0,p,1,l)),c.colheaders&&(l=ED(n.headerBand,nD,null),i=jD(e,c.colheaders,f,p,p,-ED(h,"columnHeader"),_D,1,d,"y1",0,1,p,l)),c.rowfooters&&(l=ED(n.footerBand,rD,null),a=jD(e,c.rowfooters,f,p,m,ED(h,"rowFooter"),kD,0,d,"x2",p-1,p,1,l)),c.colfooters&&(l=ED(n.footerBand,nD,null),o=jD(e,c.colfooters,f,p,p,ED(h,"columnFooter"),kD,1,d,"y2",g-p,1,p,l)),c.rowtitle&&(s=ED(n.titleAnchor,rD),u=ED(h,"rowTitle"),u=s===NA?a+u:r-u,l=ED(n.titleBand,rD,.5),FD(e,c.rowtitle,u,0,y,l)),c.coltitle&&(s=ED(n.titleAnchor,nD),u=ED(h,"columnTitle"),u=s===NA?o+u:i-u,l=ED(n.titleBand,nD,.5),FD(e,c.coltitle,u,1,y,l))}function CD(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function MD(e,t){return e.bounds[t]}function jD(e,t,n,r,i,a,o,s,l,u,c,f,d,h){var p,m,g,y,v,b,x,w,_,k=n.length,O=0,S=0;if(!k)return O;for(p=c;p<k;p+=f)n[p]&&(O=o(O,l(n[p],u)));if(!t.length)return O;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),O+=a,m=0,y=t.length;m<y;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,y=t.length;m<y;++m,p+=f){for(v=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=d);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),_=O):(w=O,_=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,v[u])}return S}function FD(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function TD(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",FA),c=u===NA?1:u===TA?.5:0,f={align:eD,bounds:s("bounds",tD),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case CA:f.anchor={x:Math.floor(r.x1)-l,column:NA,y:c*(o||r.height()+2*r.y1),row:u};break;case MA:f.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case DA:f.anchor={y:Math.floor(i.y1)-l,row:NA,x:c*(a||i.width()+2*i.x1),column:u};break;case jA:f.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":f.anchor={x:l,y:l};break;case"top-right":f.anchor={x:a-l,y:l,column:NA};break;case"bottom-left":f.anchor={x:l,y:o-l,row:NA};break;case"bottom-right":f.anchor={x:a-l,y:o-l,column:NA,row:NA}}return f}function ND(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case CA:i+=Math.ceil(o.bounds.width())+l;break;case MA:case jA:break;default:a+=o.bounds.height()+l}switch((i||a)&&PD(e,n,i,a),o.orient){case CA:c+=RD(t,n,o,s,1,1);break;case MA:u+=RD(t,n,o,NA,0,0)+l,c+=RD(t,n,o,s,1,1);break;case jA:u+=RD(t,n,o,s,0,0),c+=RD(t,n,o,NA,-1,0,1)+l;break;default:u+=RD(t,n,o,s,0,0)}(u||c)&&PD(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(PD(e,n,-u,0),PD(e,o,-u,0))}else(i||a)&&PD(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==QA&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,nS(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function RD(e,t,n,r,i,a,o){const s="symbol"!==e.datum.type,l=n.datum.vgrad,u=(!s||!a&&l||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,c=l&&a?u:0,f=l&&a?0:u,d=i<=0?0:RE(n);return Math.round(r===FA?c:r===NA?f-d:.5*(u-d))}function PD(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function zD(e){hg.call(this,null,e)}oc(zD,hg,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&DD(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),f=(new JO).set(0,0,u,c),d=f.clone(),h=f.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case PA:(bD(i)?d:h).union(xD(e,i,u,c));break;case zA:r=i;break;case IA:p.push(ND(e,i));break;case BA:case LA:case qA:case UA:case VA:case WA:case HA:case GA:d.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const t={};p.forEach((e=>{(a=e.orient||MA)!==QA&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];AD(e,i,TD(i,r,n.legends,d,h,u,c))}p.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&n.autosize.type===YA)switch(t.orient){case CA:case MA:f.add(r.x1,0).add(r.x2,0);break;case DA:case jA:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(d).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,l=o.orient,u=o.anchor,c=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=l===CA||l===MA?r:n,m=0,g=0,y=0,v=0,b=0;if(s!==RA?l===CA?(m=i.y2,p=i.y1):l===MA?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):l===CA&&(m=r,p=0),a=u===FA?m:u===NA?p:(m+p)/2,h&&h.text){switch(l){case DA:case jA:b=d.bounds.height()+f;break;case CA:v=d.bounds.width()+f;break;case MA:v=-d.bounds.width()-f}yD.clear().union(h.bounds),yD.translate(v-(h.x||0),b-(h.y||0)),vD(h,"x",v)|vD(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(yD),h.mark.bounds.clear().union(yD),e.dirty(h)),yD.clear().union(h.bounds)}else yD.clear();switch(yD.union(d.bounds),l){case DA:g=a,y=i.y1-yD.height()-c;break;case CA:g=i.x1-yD.width()-c,y=a;break;case MA:g=i.x2+yD.width()+c,y=a;break;case jA:g=a,y=i.y2+c;break;default:g=o.x,y=o.y}return vD(o,"x",g)|vD(o,"y",y)&&(yD.translate(g,y),e.dirty(o),o.bounds.clear().union(yD),t.bounds.clear().union(yD),e.dirty(o)),o.bounds}(e,r,u,c,f));t.clip&&f.set(0,0,t.width||0,t.height||0);!function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,Math.ceil(n.y2-c));if(i.contains===XA){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===QA?(u=0,f=0,l=o,c=s):a===YA?(l=Math.max(0,o-u-d),c=Math.max(0,s-f-h)):a===JA?(l=Math.max(0,o-u-d),s=c+f+h):a===KA?(o=l+u+d,c=Math.max(0,s-f-h)):"pad"===a&&(o=l+u+d,s=c+f+h);e._resizeView(o,s,l,c,[u,f],i.resize)}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}});var BD=Object.freeze({__proto__:null,bound:iD,identifier:sD,mark:lD,overlap:uD,render:gD,viewlayout:zD});function LD(e){hg.call(this,null,e)}function ID(e){hg.call(this,null,e)}function qD(){return Rm({})}function UD(e){hg.call(this,null,e)}function VD(e){hg.call(this,[],e)}oc(LD,hg,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=Rk(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||Bk(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?Pk(a,e.values,o):zk(a,o);return i&&(r.rem=i),i=l.map(((e,t)=>Rm({index:t/(l.length-1||1),value:e,label:s(e)}))),e.extra&&i.length&&i.push(Rm({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),oc(ID,hg,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||qD,a=e.key||Tm,o=this.value;return yu(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&ou("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=ic().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),oc(UD,hg,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(yu(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||pu,l=i.enter||pu,u=i.exit||pu,c=(a&&!o?i[a]:s)||pu;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{l(t,e),s(t,e)})),n.modifies(l.output),n.modifies(s.output),c!==pu&&c!==s&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&u!==pu&&(t.visit(t.REM,(t=>{u(t,e)})),n.modifies(u.output)),o||c!==pu){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,(t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)):t.visit(i,(t=>{(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),oc(VD,hg,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||jk,f=e.scale,d=+e.limit,h=Rk(f,null==e.count?5:e.count,e.minstep),p=!!e.values||c===jk,m=e.format||Vk(s,f,h,c,e.formatSpecifier,e.formatType,p),g=e.values||Uk(f,h);return u&&(l.rem=u),c===jk?(d&&g.length>d?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,d-1),o=!0):u=g,Vu(i=e.size)?(e.values||0!==f(u[0])||(u=u.slice(1)),a=u.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=Ju(a=i||8),u=u.map(((t,n)=>Rm({index:n,label:m(t,n,u),value:t,offset:a,size:i(t,e)}))),o&&(o=g[u.length],u.push(Rm({index:u.length,label:"…".concat(g.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=f.domain(),r=Ek(f,n[0],ku(n)),g.length<3&&!e.values&&n[0]!==ku(n)&&(g=[n[0],ku(n)]),u=g.map(((e,t)=>Rm({index:t,label:m(e,t,g),value:e,perc:r(e)})))):(i=g.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+ku(t),a=i-r;if(e.type===J_){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(f),u=g.map(((e,t)=>Rm({index:t,label:m(e,t,g),value:e,perc:t?r(e):0,perc2:t===i?1:r(g[t+1])})))),l.source=u,l.add=u,this.value=u,l}});const WD=e=>e.source.x,HD=e=>e.source.y,GD=e=>e.target.x,XD=e=>e.target.y;function YD(e){hg.call(this,{},e)}YD.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},oc(YD,hg,{transform(e,t){var n=e.sourceX||WD,r=e.sourceY||HD,i=e.targetX||GD,a=e.targetY||XD,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=ZD.get(l+"-"+s)||ZD.get(l);return u||ou("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[o]=u(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});const JD=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,KD=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},QD=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},ZD=ic({line:JD,"line-radial":(e,t,n,r)=>JD(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:KD,"arc-radial":(e,t,n,r)=>KD(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:QD,"curve-radial":(e,t,n,r)=>QD(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function eC(e){hg.call(this,null,e)}eC.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},oc(eC,hg,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.field||du,u=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(l),h=d.length,p=u,m=(c-u)/zf(d),g=Pf(h);for(e.sort&&g.sort(((e,t)=>d[e]-d[t])),n=0;n<h;++n)i=d[g[n]],(r=f[g[n]])[o]=p,r[s]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)}});function tC(e){return gk(e)&&e!==H_}const nC=Ec(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function rC(e){hg.call(this,null,e),this.modified(!0)}function iC(e,t,n){bk(e)&&(Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+wc(t)));return t}function aC(e,t,n){return Vu(e)&&(t||n)?kk(e,oC(t||[0,1],n)):e}function oC(e,t){return t?e.slice().reverse():e}function sC(e){hg.call(this,null,e)}oc(rC,hg,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";if(n===H_)return"sequential-linear";(function(e){const t=e.type;return gk(t)&&t!==V_&&t!==W_&&(e.scheme||e.range&&e.range.length&&e.range.every(hc))})(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":"");return(r+n||B_).toLowerCase()}(e);for(i in r&&i===r.type||(this.value=r=hk(i)()),e)if(!nC[i]){if("padding"===i&&tC(r.type))continue;Vu(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==Z_&&e!==Q_&&ou("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===Q_?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*z_(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;yu(t.scheme)?r=Ok(t.scheme,t.interpolate,t.interpolateGamma):(r=Mk(t.scheme.toLowerCase()))||ou("Unrecognized scheme name: ".concat(t.scheme));return n=e===J_?n+1:e===ek?n-1:e===X_||e===Y_?+t.schemeCount||5:n,xk(e)?aC(r,i,t.reverse):Vu(r)?Sk(aC(r,i),n):e===K_?r:r.slice(0,n)}(r,t,n),Vu(a))){if(e.interpolator)return e.interpolator(a);ou("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&xk(r))return e.interpolator(Ok(oC(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate($k(t.interpolate,t.interpolateGamma)):Vu(e.round)?e.round(i):Vu(e.rangeRound)&&e.interpolate(i?Dw:Aw);a&&e.range(oC(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!yu(r)){const t=e.domain(),n=t[0],i=ku(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||ou("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=Pf(o,s+a/2,a)}r?e.bins=r:e.bins&&delete e.bins;e.type===ek&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain());return n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(iC(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===B_||t===I_||t===q_)}(e);if(!o)return 0;tC(s)&&t.padding&&o[0]!==ku(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(ku(n)-n[0]),s=o/(o-2*r),l=e===L_?Pu(t,null,s):e===q_?zu(t,null,s,.5):e===I_?zu(t,null,s,i||1):e===U_?Bu(t,null,s,a||1):Ru(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant));if((l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}e.domain(iC(s,o,n)),s===K_&&e.unknown(t.domainImplicit?Qb:void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&Rk(e,t.nice)||null);return o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),oc(sC,hg,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(Lm(e.sort)),this.modified(n),t}});const lC="zero",uC="center",cC="normalize",fC=["y0","y1"];function dC(e){hg.call(this,null,e)}function hC(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function pC(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function mC(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}dC.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:lC,values:[lC,uC,cC]},{name:"as",type:"string",array:!0,length:2,default:fC}]},oc(dC,hg,{transform(e,t){var n,r,i,a,o=e.as||fC,s=o[0],l=o[1],u=Lm(e.sort),c=e.field||du,f=e.offset===uC?hC:e.offset===cC?pC:mC;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,f,d,h=[],p=e=>e(l);if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],h.push(c)),c.push(l);for(u=0,d=0,s=h.length;u<s;++u){for(a=0,f=0,o=(c=h[u]).length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,f>d&&(d=f),n&&c.sort(n)}return h.max=d,h}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var gC=Object.freeze({__proto__:null,axisticks:LD,datajoin:ID,encode:UD,legendentries:VD,linkpath:YD,pie:eC,scale:rC,sortitems:sC,stack:dC}),yC=1e-6,vC=1e-12,bC=Math.PI,xC=bC/2,wC=bC/4,_C=2*bC,kC=180/bC,OC=bC/180,SC=Math.abs,EC=Math.atan,$C=Math.atan2,AC=Math.cos,DC=Math.ceil,CC=Math.exp,MC=Math.hypot,jC=Math.log,FC=Math.pow,TC=Math.sin,NC=Math.sign||function(e){return e>0?1:e<0?-1:0},RC=Math.sqrt,PC=Math.tan;function zC(e){return e>1?0:e<-1?bC:Math.acos(e)}function BC(e){return e>1?xC:e<-1?-xC:Math.asin(e)}function LC(){}function IC(e,t){e&&UC.hasOwnProperty(e.type)&&UC[e.type](e,t)}var qC={Feature:function(e,t){IC(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)IC(n[r].geometry,t)}},UC={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){VC(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)VC(n[r],t,0)},Polygon:function(e,t){WC(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)WC(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)IC(n[r],t)}};function VC(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function WC(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)VC(e[n],t,1);t.polygonEnd()}function HC(e,t){e&&qC.hasOwnProperty(e.type)?qC[e.type](e,t):IC(e,t)}var GC,XC,YC,JC,KC,QC,ZC,eM,tM,nM,rM,iM,aM,oM,sM,lM,uM=new _f,cM=new _f,fM={point:LC,lineStart:LC,lineEnd:LC,polygonStart:function(){uM=new _f,fM.lineStart=dM,fM.lineEnd=hM},polygonEnd:function(){var e=+uM;cM.add(e<0?_C+e:e),this.lineStart=this.lineEnd=this.point=LC},sphere:function(){cM.add(_C)}};function dM(){fM.point=pM}function hM(){mM(GC,XC)}function pM(e,t){fM.point=mM,GC=e,XC=t,YC=e*=OC,JC=AC(t=(t*=OC)/2+wC),KC=TC(t)}function mM(e,t){var n=(e*=OC)-YC,r=n>=0?1:-1,i=r*n,a=AC(t=(t*=OC)/2+wC),o=TC(t),s=KC*o,l=JC*a+s*AC(i),u=s*r*TC(i);uM.add($C(u,l)),YC=e,JC=a,KC=o}function gM(e){return[$C(e[1],e[0]),BC(e[2])]}function yM(e){var t=e[0],n=e[1],r=AC(n);return[r*AC(t),r*TC(t),TC(n)]}function vM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function bM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function xM(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function wM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function _M(e){var t=RC(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var kM,OM,SM,EM,$M,AM,DM,CM,MM,jM,FM,TM,NM,RM,PM,zM,BM={point:LM,lineStart:qM,lineEnd:UM,polygonStart:function(){BM.point=VM,BM.lineStart=WM,BM.lineEnd=HM,oM=new _f,fM.polygonStart()},polygonEnd:function(){fM.polygonEnd(),BM.point=LM,BM.lineStart=qM,BM.lineEnd=UM,uM<0?(QC=-(eM=180),ZC=-(tM=90)):oM>yC?tM=90:oM<-1e-6&&(ZC=-90),lM[0]=QC,lM[1]=eM},sphere:function(){QC=-(eM=180),ZC=-(tM=90)}};function LM(e,t){sM.push(lM=[QC=e,eM=e]),t<ZC&&(ZC=t),t>tM&&(tM=t)}function IM(e,t){var n=yM([e*OC,t*OC]);if(aM){var r=bM(aM,n),i=bM([r[1],-r[0],0],r);_M(i),i=gM(i);var a,o=e-nM,s=o>0?1:-1,l=i[0]*kC*s,u=SC(o)>180;u^(s*nM<l&&l<s*e)?(a=i[1]*kC)>tM&&(tM=a):u^(s*nM<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*kC)<ZC&&(ZC=a):(t<ZC&&(ZC=t),t>tM&&(tM=t)),u?e<nM?GM(QC,e)>GM(QC,eM)&&(eM=e):GM(e,eM)>GM(QC,eM)&&(QC=e):eM>=QC?(e<QC&&(QC=e),e>eM&&(eM=e)):e>nM?GM(QC,e)>GM(QC,eM)&&(eM=e):GM(e,eM)>GM(QC,eM)&&(QC=e)}else sM.push(lM=[QC=e,eM=e]);t<ZC&&(ZC=t),t>tM&&(tM=t),aM=n,nM=e}function qM(){BM.point=IM}function UM(){lM[0]=QC,lM[1]=eM,BM.point=LM,aM=null}function VM(e,t){if(aM){var n=e-nM;oM.add(SC(n)>180?n+(n>0?360:-360):n)}else rM=e,iM=t;fM.point(e,t),IM(e,t)}function WM(){fM.lineStart()}function HM(){VM(rM,iM),fM.lineEnd(),SC(oM)>yC&&(QC=-(eM=180)),lM[0]=QC,lM[1]=eM,aM=null}function GM(e,t){return(t-=e)<0?t+360:t}function XM(e,t){return e[0]-t[0]}function YM(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var JM={sphere:LC,point:KM,lineStart:ZM,lineEnd:nj,polygonStart:function(){JM.lineStart=rj,JM.lineEnd=ij},polygonEnd:function(){JM.lineStart=ZM,JM.lineEnd=nj}};function KM(e,t){e*=OC;var n=AC(t*=OC);QM(n*AC(e),n*TC(e),TC(t))}function QM(e,t,n){++kM,SM+=(e-SM)/kM,EM+=(t-EM)/kM,$M+=(n-$M)/kM}function ZM(){JM.point=ej}function ej(e,t){e*=OC;var n=AC(t*=OC);RM=n*AC(e),PM=n*TC(e),zM=TC(t),JM.point=tj,QM(RM,PM,zM)}function tj(e,t){e*=OC;var n=AC(t*=OC),r=n*AC(e),i=n*TC(e),a=TC(t),o=$C(RC((o=PM*a-zM*i)*o+(o=zM*r-RM*a)*o+(o=RM*i-PM*r)*o),RM*r+PM*i+zM*a);OM+=o,AM+=o*(RM+(RM=r)),DM+=o*(PM+(PM=i)),CM+=o*(zM+(zM=a)),QM(RM,PM,zM)}function nj(){JM.point=KM}function rj(){JM.point=aj}function ij(){oj(TM,NM),JM.point=KM}function aj(e,t){TM=e,NM=t,e*=OC,t*=OC,JM.point=oj;var n=AC(t);RM=n*AC(e),PM=n*TC(e),zM=TC(t),QM(RM,PM,zM)}function oj(e,t){e*=OC;var n=AC(t*=OC),r=n*AC(e),i=n*TC(e),a=TC(t),o=PM*a-zM*i,s=zM*r-RM*a,l=RM*i-PM*r,u=MC(o,s,l),c=BC(u),f=u&&-c/u;MM.add(f*o),jM.add(f*s),FM.add(f*l),OM+=c,AM+=c*(RM+(RM=r)),DM+=c*(PM+(PM=i)),CM+=c*(zM+(zM=a)),QM(RM,PM,zM)}function sj(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function lj(e,t){return[SC(e)>bC?e+Math.round(-e/_C)*_C:e,t]}function uj(e,t,n){return(e%=_C)?t||n?sj(fj(e),dj(t,n)):fj(e):t||n?dj(t,n):lj}function cj(e){return function(t,n){return[(t+=e)>bC?t-_C:t<-bC?t+_C:t,n]}}function fj(e){var t=cj(e);return t.invert=cj(-e),t}function dj(e,t){var n=AC(e),r=TC(e),i=AC(t),a=TC(t);function o(e,t){var o=AC(t),s=AC(e)*o,l=TC(e)*o,u=TC(t),c=u*n+s*r;return[$C(l*i-c*a,s*n-u*r),BC(c*i+l*a)]}return o.invert=function(e,t){var o=AC(t),s=AC(e)*o,l=TC(e)*o,u=TC(t),c=u*i-l*a;return[$C(l*i+u*a,s*n+c*r),BC(c*n-s*r)]},o}function hj(e,t){(t=yM(t))[0]-=e,_M(t);var n=zC(-t[1]);return((-t[2]<0?-n:n)+_C-yC)%_C}function pj(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:LC,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function mj(e,t){return SC(e[0]-t[0])<yC&&SC(e[1]-t[1])<yC}function gj(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function yj(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(mj(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new gj(r,e,null,!0)),l.push(n.o=new gj(r,null,n,!1)),s.push(n=new gj(o,e,null,!1)),l.push(n.o=new gj(o,null,n,!0))}})),s.length){for(l.sort(t),vj(s),vj(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,f=s[0];;){for(var d=f,h=!0;d.v;)if((d=d.n)===f)return;u=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(u=d.p.z,a=u.length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}u=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}}function vj(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function bj(e){return SC(e[0])<=bC?e[0]:NC(e[0])*((SC(e[0])+bC)%_C-bC)}function xj(e,t,n,r){return function(i){var a,o,s,l=t(i),u=pj(),c=t(u),f=!1,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,o=[],a=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,o=Rf(o);var e=function(e,t){var n=bj(t),r=t[1],i=TC(r),a=[TC(n),-AC(n),0],o=0,s=0,l=new _f;1===i?r=xC+yC:-1===i&&(r=-xC-yC);for(var u=0,c=e.length;u<c;++u)if(d=(f=e[u]).length)for(var f,d,h=f[d-1],p=bj(h),m=h[1]/2+wC,g=TC(m),y=AC(m),v=0;v<d;++v,p=x,g=_,y=k,h=b){var b=f[v],x=bj(b),w=b[1]/2+wC,_=TC(w),k=AC(w),O=x-p,S=O>=0?1:-1,E=S*O,$=E>bC,A=g*_;if(l.add($C(A*S*TC(E),y*k+A*AC(E))),o+=$?O+S*_C:O,$^p>=n^x>=n){var D=bM(yM(h),yM(b));_M(D);var C=bM(a,D);_M(C);var M=($^O>=0?-1:1)*BC(C[2]);(r>M||r===M&&(D[0]||D[1]))&&(s+=$^O>=0?1:-1)}}return(o<-1e-6||o<yC&&l<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),yj(o,_j,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){d.point=p,l.lineStart()}function g(){d.point=h,l.lineEnd()}function y(e,t){s.push([e,t]),c.point(e,t)}function v(){c.lineStart(),s=[]}function b(){y(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),d=u.result(),h=d.length;if(s.pop(),a.push(s),s=null,h)if(1&l){if((t=(n=d[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(wj))}return d}}function wj(e){return e.length>1}function _j(e,t){return((e=e.x)[0]<0?e[1]-xC-yC:xC-e[1])-((t=t.x)[0]<0?t[1]-xC-yC:xC-t[1])}lj.invert=lj;var kj=xj((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?bC:-bC,l=SC(a-n);SC(l-bC)<yC?(e.point(n,r=(r+o)/2>0?xC:-xC),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=bC&&(SC(n-i)<yC&&(n-=i*yC),SC(a-s)<yC&&(a-=s*yC),r=function(e,t,n,r){var i,a,o=TC(e-n);return SC(o)>yC?EC((TC(t)*(a=AC(r))*TC(n)-TC(r)*(i=AC(t))*TC(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*xC,r.point(-bC,i),r.point(0,i),r.point(bC,i),r.point(bC,0),r.point(bC,-i),r.point(0,-i),r.point(-bC,-i),r.point(-bC,0),r.point(-bC,i);else if(SC(e[0]-t[0])>yC){var a=e[0]<t[0]?bC:-bC;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-bC,-xC]);function Oj(e){var t=AC(e),n=6*OC,r=t>0,i=SC(t)>yC;function a(e,n){return AC(e)*AC(n)>t}function o(e,n,r){var i=[1,0,0],a=bM(yM(e),yM(n)),o=vM(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,f=bM(i,a),d=wM(i,u);xM(d,wM(a,c));var h=f,p=vM(d,h),m=vM(h,h),g=p*p-m*(vM(d,d)-1);if(!(g<0)){var y=RC(g),v=wM(h,(-p-y)/m);if(xM(v,d),v=gM(v),!r)return v;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var O=w-x,S=SC(O-bC)<yC;if(!S&&k<_&&(b=_,_=k,k=b),S||O<yC?S?_+k>0^v[1]<(SC(v[0]-x)<yC?_:k):_<=v[1]&&v[1]<=k:O>bC^(x<=v[0]&&v[0]<=w)){var E=wM(h,(-p+y)/m);return xM(E,d),[v,gM(E)]}}}function s(t,n){var i=r?e:bC-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return xj(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(f,d){var h,p=[f,d],m=a(f,d),g=r?m?0:s(f,d):m?s(f+(f<0?bC:-bC),d):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(h=o(t,p))||mj(t,h)||mj(p,h))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),h=o(p,t),e.point(h[0],h[1])):(h=o(t,p),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var y;g&n||!(y=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!m||t&&mj(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=AC(t),s=TC(t),l=r*n;null==i?(i=t+r*_C,a=t-l/2):(i=hj(o,i),a=hj(o,a),(r>0?i<a:i>a)&&(i+=r*_C));for(var u,c=i;r>0?c>a:c<a;c-=l)u=gM([o,-s*AC(c),-s*TC(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-bC,e-bC])}var Sj=1e9,Ej=-Sj;function $j(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,f=0;if(null==i||(c=o(i,s))!==(f=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==f);else u.point(a[0],a[1])}function o(r,i){return SC(r[0]-e)<yC?i>0?0:3:SC(r[0]-n)<yC?i>0?2:1:SC(r[1]-t)<yC?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,f,d,h,p,m,g,y,v,b=o,x=pj(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]);y=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(k(f,d),h&&g&&x.rejoin(),l.push(x.result()));w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,f=s[0],d=f[0],h=f[1];l<c;++l)a=d,o=h,d=(f=s[l])[0],h=f[1],o<=r?h>r&&(d-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(d-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=v&&t,i=(l=Rf(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&yj(l,s,t,a,o),o.polygonEnd());b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(u&&c.push([a,o]),y)f=a,d=o,h=s,y=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(Ej,Math.min(Sj,p)),m=Math.max(Ej,Math.min(Sj,m))],x=[a=Math.max(Ej,Math.min(Sj,a)),o=Math.max(Ej,Math.min(Sj,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,f=t[0]-s,d=t[1]-l;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<u)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>u&&(u=o)}else if(f>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*f,e[1]=l+u*d),c<1&&(t[0]=s+c*f,t[1]=l+c*d),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),v=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),v=!1)}p=a,m=o,g=s}return w}}function Aj(e,t,n){var r=Pf(e,t-yC,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function Dj(e,t,n){var r=Pf(e,t-yC,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var Cj,Mj,jj,Fj,Tj=e=>e,Nj=new _f,Rj=new _f,Pj={point:LC,lineStart:LC,lineEnd:LC,polygonStart:function(){Pj.lineStart=zj,Pj.lineEnd=Ij},polygonEnd:function(){Pj.lineStart=Pj.lineEnd=Pj.point=LC,Nj.add(SC(Rj)),Rj=new _f},result:function(){var e=Nj/2;return Nj=new _f,e}};function zj(){Pj.point=Bj}function Bj(e,t){Pj.point=Lj,Cj=jj=e,Mj=Fj=t}function Lj(e,t){Rj.add(Fj*e-jj*t),jj=e,Fj=t}function Ij(){Lj(Cj,Mj)}var qj=1/0,Uj=qj,Vj=-qj,Wj=Vj,Hj={point:function(e,t){e<qj&&(qj=e);e>Vj&&(Vj=e);t<Uj&&(Uj=t);t>Wj&&(Wj=t)},lineStart:LC,lineEnd:LC,polygonStart:LC,polygonEnd:LC,result:function(){var e=[[qj,Uj],[Vj,Wj]];return Vj=Wj=-(Uj=qj=1/0),e}};var Gj,Xj,Yj,Jj,Kj=0,Qj=0,Zj=0,eF=0,tF=0,nF=0,rF=0,iF=0,aF=0,oF={point:sF,lineStart:lF,lineEnd:fF,polygonStart:function(){oF.lineStart=dF,oF.lineEnd=hF},polygonEnd:function(){oF.point=sF,oF.lineStart=lF,oF.lineEnd=fF},result:function(){var e=aF?[rF/aF,iF/aF]:nF?[eF/nF,tF/nF]:Zj?[Kj/Zj,Qj/Zj]:[NaN,NaN];return Kj=Qj=Zj=eF=tF=nF=rF=iF=aF=0,e}};function sF(e,t){Kj+=e,Qj+=t,++Zj}function lF(){oF.point=uF}function uF(e,t){oF.point=cF,sF(Yj=e,Jj=t)}function cF(e,t){var n=e-Yj,r=t-Jj,i=RC(n*n+r*r);eF+=i*(Yj+e)/2,tF+=i*(Jj+t)/2,nF+=i,sF(Yj=e,Jj=t)}function fF(){oF.point=sF}function dF(){oF.point=pF}function hF(){mF(Gj,Xj)}function pF(e,t){oF.point=mF,sF(Gj=Yj=e,Xj=Jj=t)}function mF(e,t){var n=e-Yj,r=t-Jj,i=RC(n*n+r*r);eF+=i*(Yj+e)/2,tF+=i*(Jj+t)/2,nF+=i,rF+=(i=Jj*e-Yj*t)*(Yj+e),iF+=i*(Jj+t),aF+=3*i,sF(Yj=e,Jj=t)}function gF(e){this._context=e}gF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,_C)}},result:LC};var yF,vF,bF,xF,wF,_F=new _f,kF={point:LC,lineStart:function(){kF.point=OF},lineEnd:function(){yF&&SF(vF,bF),kF.point=LC},polygonStart:function(){yF=!0},polygonEnd:function(){yF=null},result:function(){var e=+_F;return _F=new _f,e}};function OF(e,t){kF.point=SF,vF=xF=e,bF=wF=t}function SF(e,t){xF-=e,wF-=t,_F.add(RC(xF*xF+wF*wF)),xF=e,wF=t}function EF(){this._string=[]}function $F(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function AF(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),HC(e,n(r))),r.result()}return a.area=function(e){return HC(e,n(Pj)),Pj.result()},a.measure=function(e){return HC(e,n(kF)),kF.result()},a.bounds=function(e){return HC(e,n(Hj)),Hj.result()},a.centroid=function(e){return HC(e,n(oF)),oF.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,Tj):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new EF):new gF(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function DF(e){return function(t){var n=new CF;for(var r in e)n[r]=e[r];return n.stream=t,n}}function CF(){}function MF(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),HC(n,e.stream(Hj)),t(Hj.result()),null!=r&&e.clipExtent(r),e}function jF(e,t,n){return MF(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function FF(e,t,n){return jF(e,[[0,0],t],n)}function TF(e,t,n){return MF(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function NF(e,t,n){return MF(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}EF.prototype={_radius:4.5,_circle:$F(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=$F(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}},CF.prototype={constructor:CF,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var RF=AC(30*OC);function PF(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var x=o+d,w=s+h,_=l+p,k=RC(x*x+w*w+_*_),O=BC(_/=k),S=SC(SC(_)-1)<yC||SC(a-f)<yC?(a+f)/2:$C(w,x),E=e(S,O),$=E[0],A=E[1],D=$-r,C=A-i,M=v*D-y*C;(M*M/b>t||SC((y*D+v*C)/b-.5)>.3||o*d+s*h+l*p<RF)&&(n(r,i,a,o,s,l,$,A,S,x/=k,w/=k,_,m,g),g.point($,A),n($,A,S,x,w,_,u,c,f,d,h,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,f,d,h,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){c=NaN,m.point=v,t.lineStart()}function v(r,i){var a=yM([r,i]),o=e(r,i);n(c,f,u,d,h,p,c=o[0],f=o[1],u=r,d=a[0],h=a[1],p=a[2],16,t),t.point(c,f)}function b(){m.point=g,t.lineEnd()}function x(){y(),m.point=w,m.lineEnd=_}function w(e,t){v(r=e,t),i=c,a=f,o=d,s=h,l=p,m.point=v}function _(){n(c,f,u,d,h,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return DF({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var zF=DF({point:function(e,t){this.stream.point(e*OC,t*OC)}});function BF(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=AC(a),s=TC(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-f*t+d),i*(h-f*e-c*t)]},p}function LF(e){return IF((function(){return e}))()}function IF(e){var t,n,r,i,a,o,s,l,u,c,f=150,d=480,h=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,w=1,_=null,k=kj,O=null,S=Tj,E=.5;function $(e){return l(e[0]*OC,e[1]*OC)}function A(e){return(e=l.invert(e[0],e[1]))&&[e[0]*kC,e[1]*kC]}function D(){var e=BF(f,0,0,x,w,b).apply(null,t(p,m)),r=BF(f,d-e[0],h-e[1],x,w,b);return n=uj(g,y,v),s=sj(t,r),l=sj(n,s),o=PF(s,E),C()}function C(){return u=c=null,$}return $.stream=function(e){return u&&c===e?u:u=zF(function(e){return DF({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(c=e)))))},$.preclip=function(e){return arguments.length?(k=e,_=void 0,C()):k},$.postclip=function(e){return arguments.length?(S=e,O=r=i=a=null,C()):S},$.clipAngle=function(e){return arguments.length?(k=+e?Oj(_=e*OC):(_=null,kj),C()):_*kC},$.clipExtent=function(e){return arguments.length?(S=null==e?(O=r=i=a=null,Tj):$j(O=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),C()):null==O?null:[[O,r],[i,a]]},$.scale=function(e){return arguments.length?(f=+e,D()):f},$.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],D()):[d,h]},$.center=function(e){return arguments.length?(p=e[0]%360*OC,m=e[1]%360*OC,D()):[p*kC,m*kC]},$.rotate=function(e){return arguments.length?(g=e[0]%360*OC,y=e[1]%360*OC,v=e.length>2?e[2]%360*OC:0,D()):[g*kC,y*kC,v*kC]},$.angle=function(e){return arguments.length?(b=e%360*OC,D()):b*kC},$.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},$.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},$.precision=function(e){return arguments.length?(o=PF(s,E=e*e),C()):RC(E)},$.fitExtent=function(e,t){return jF($,e,t)},$.fitSize=function(e,t){return FF($,e,t)},$.fitWidth=function(e,t){return TF($,e,t)},$.fitHeight=function(e,t){return NF($,e,t)},function(){return t=e.apply(this,arguments),$.invert=t.invert&&A,D()}}function qF(e){var t=0,n=bC/3,r=IF(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*OC,n=e[1]*OC):[t*kC,n*kC]},i}function UF(e,t){var n=TC(e),r=(n+TC(t))/2;if(SC(r)<yC)return function(e){var t=AC(e);function n(e,n){return[e*t,TC(n)/t]}return n.invert=function(e,n){return[e/t,BC(n*t)]},n}(e);var i=1+n*(2*r-n),a=RC(i)/r;function o(e,t){var n=RC(i-2*r*TC(t))/r;return[n*TC(e*=r),a-n*AC(e)]}return o.invert=function(e,t){var n=a-t,o=$C(e,SC(n))*NC(n);return n*r<0&&(o-=bC*NC(e)*NC(n)),[o/r,BC((i-(e*e+n*n)*r*r)/(2*r))]},o}function VF(){return qF(UF).scale(155.424).center([0,33.6442])}function WF(){return VF().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function HF(e){return function(t,n){var r=AC(t),i=AC(n),a=e(r*i);return a===1/0?[2,0]:[a*i*TC(t),a*TC(n)]}}function GF(e){return function(t,n){var r=RC(t*t+n*n),i=e(r),a=TC(i),o=AC(i);return[$C(t*a,r*o),BC(r&&n*a/r)]}}var XF=HF((function(e){return RC(2/(1+e))}));XF.invert=GF((function(e){return 2*BC(e/2)}));var YF=HF((function(e){return(e=zC(e))&&e/TC(e)}));function JF(e,t){return[e,jC(PC((xC+t)/2))]}function KF(e){var t,n,r,i=LF(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=bC*o(),s=i(function(e){function t(t){return(t=e(t[0]*OC,t[1]*OC))[0]*=kC,t[1]*=kC,t}return e=uj(e[0]*OC,e[1]*OC,e.length>2?e[2]*OC:0),t.invert=function(t){return(t=e.invert(t[0]*OC,t[1]*OC))[0]*=kC,t[1]*=kC,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===JF?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function QF(e){return PC((xC+e)/2)}function ZF(e,t){var n=AC(e),r=e===t?TC(e):jC(n/AC(t))/jC(QF(t)/QF(e)),i=n*FC(QF(e),r)/r;if(!r)return JF;function a(e,t){i>0?t<-xC+yC&&(t=-xC+yC):t>xC-yC&&(t=xC-yC);var n=i/FC(QF(t),r);return[n*TC(r*e),i-n*AC(r*e)]}return a.invert=function(e,t){var n=i-t,a=NC(r)*RC(e*e+n*n),o=$C(e,SC(n))*NC(n);return n*r<0&&(o-=bC*NC(e)*NC(n)),[o/r,2*EC(FC(i/a,1/r))-xC]},a}function eT(e,t){return[e,t]}function tT(e,t){var n=AC(e),r=e===t?TC(e):(n-AC(t))/(t-e),i=n/r+e;if(SC(r)<yC)return eT;function a(e,t){var n=i-t,a=r*e;return[n*TC(a),i-n*AC(a)]}return a.invert=function(e,t){var n=i-t,a=$C(e,SC(n))*NC(n);return n*r<0&&(a-=bC*NC(e)*NC(n)),[a/r,i-NC(r)*RC(e*e+n*n)]},a}YF.invert=GF((function(e){return e})),JF.invert=function(e,t){return[e,2*EC(CC(t))-xC]},eT.invert=eT;var nT=1.340264,rT=-.081106,iT=893e-6,aT=.003796,oT=RC(3)/2;function sT(e,t){var n=BC(oT*TC(t)),r=n*n,i=r*r*r;return[e*AC(n)/(oT*(nT+3*rT*r+i*(7*iT+9*aT*r))),n*(nT+rT*r+i*(iT+aT*r))]}function lT(e,t){var n=AC(t),r=AC(e)*n;return[n*TC(e)/r,TC(t)/r]}function uT(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function cT(e,t){return[AC(t)*TC(e),TC(t)]}function fT(e,t){var n=AC(t),r=1+AC(e)*n;return[n*TC(e)/r,TC(t)/r]}function dT(e,t){return[jC(PC((xC+t)/2)),-e]}sT.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(nT+rT*i+a*(iT+aT*i))-t)/(nT+3*rT*i+a*(7*iT+9*aT*i)))*r)*i*i,!(SC(n)<vC));++o);return[oT*e*(nT+3*rT*i+a*(7*iT+9*aT*i))/AC(r),BC(TC(r)/oT)]},lT.invert=GF(EC),uT.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(SC(n)>yC&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},cT.invert=GF(BC),fT.invert=GF((function(e){return 2*EC(e)})),dT.invert=function(e,t){return[-t,2*EC(CC(e))-xC]};var hT=Math.abs,pT=Math.cos,mT=Math.sin,gT=Math.PI,yT=gT/2,vT=function(e){return e>0?Math.sqrt(e):0}(2);function bT(e){return e>1?yT:e<-1?-yT:Math.asin(e)}function xT(e,t){var n,r=e*mT(t),i=30;do{t-=n=(t+mT(t)-r)/(1+pT(t))}while(hT(n)>1e-6&&--i>0);return t/2}var wT=function(e,t,n){function r(r,i){return[e*r*pT(i=xT(n,i)),t*mT(i)]}return r.invert=function(r,i){return i=bT(i/t),[r/(e*pT(i)),bT((2*i+mT(2*i))/n)]},r}(vT/yT,vT,gT);const _T=AF(),kT=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function OT(e,t){return function n(){const r=t();return r.type=e,r.path=AF().projection(r),r.copy=r.copy||function(){const e=n();return kT.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function ST(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?($T[e]=OT(e,t),this):$T[e]||null}function ET(e){return e&&e.path||_T}const $T={albers:WF,albersusa:function(){var e,t,n,r,i,a,o=WF(),s=VF().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=VF().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),f()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+yC,c+.12*t+yC],[a-.214*t-yC,c+.234*t-yC]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+yC,c+.166*t+yC],[a-.115*t-yC,c+.234*t-yC]]).stream(u),f()},c.fitExtent=function(e,t){return jF(c,e,t)},c.fitSize=function(e,t){return FF(c,e,t)},c.fitWidth=function(e,t){return TF(c,e,t)},c.fitHeight=function(e,t){return NF(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return LF(XF).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return LF(YF).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return qF(ZF).scale(109.5).parallels([30,30])},conicequalarea:VF,conicequidistant:function(){return qF(tT).scale(131.154).center([0,13.9389])},equalEarth:function(){return LF(sT).scale(177.158)},equirectangular:function(){return LF(eT).scale(152.63)},gnomonic:function(){return LF(lT).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,f=1,d=0,h=null,p=1,m=1,g=DF({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=Tj;function v(){return p=s*c,m=s*f,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(d){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(y(o=e))},b.postclip=function(e){return arguments.length?(y=e,h=n=r=i=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(h=n=r=i=null,Tj):$j(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),v()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,v()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],v()):[l,u]},b.angle=function(n){return arguments.length?(t=TC(d=n%360*OC),e=AC(d),v()):d*kC},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,v()):f<0},b.fitExtent=function(e,t){return jF(b,e,t)},b.fitSize=function(e,t){return FF(b,e,t)},b.fitWidth=function(e,t){return TF(b,e,t)},b.fitHeight=function(e,t){return NF(b,e,t)},b},mercator:function(){return KF(JF).scale(961/_C)},mollweide:function(){return LF(wT).scale(169.529)},naturalEarth1:function(){return LF(uT).scale(175.295)},orthographic:function(){return LF(cT).scale(249.5).clipAngle(90.000001)},stereographic:function(){return LF(fT).scale(250).clipAngle(142)},transversemercator:function(){var e=KF(dT),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in $T)ST(e,$T[e]);function AT(){}const DT=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function CT(){var e=1,t=1,n=o;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,f,d=new Array,h=new Array;o=s=-1,u=n[0]>=r,DT[u<<1].forEach(p);for(;++o<e-1;)l=u,u=n[o+1]>=r,DT[l|u<<1].forEach(p);DT[u<<0].forEach(p);for(;++s<t-1;){for(o=-1,u=n[s*e+e]>=r,c=n[s*e]>=r,DT[u<<1|c<<2].forEach(p);++o<e-1;)l=u,u=n[s*e+e+o+1]>=r,f=c,c=n[s*e+o+1]>=r,DT[l|u<<1|c<<2|f<<3].forEach(p);DT[u|c<<3].forEach(p)}o=-1,c=n[s*e]>=r,DT[c<<2].forEach(p);for(;++o<e-1;)f=c,c=n[s*e+o+1]>=r,DT[c<<2|f<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}DT[c<<3].forEach(p)}(r,i,(e=>{n(e,r,i),function(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==MT((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(a=r[u*e+l-1],n[0]=o+(i-a)/(c-a)-.5),s>0&&s<t&&u===s&&(a=r[(u-1)*e+l],n[1]=s+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||ou("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:AT,r):n===o},r}function MT(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=jT(e,t[r]))return n;return 0}function jT(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(FT(l,f,t))return 0;c>r!=h>r&&n<(d-u)*(r-c)/(h-c)+u&&(i=-i)}return i}function FT(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function TT(e,t,n){return function(r){var i=Zu(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?Af(a,o,e):s/(e+1);return Pf(a+l,o,l)}}function NT(e){hg.call(this,null,e)}function RT(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function PT(e,t,n){const r=e>=0?e:xg(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function zT(e){return Vu(e)?e:Ju(+e)}function BT(){var e=e=>e[0],t=e=>e[1],n=du,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=PT(r[0],s,e)>>o,c=PT(r[1],s,t)>>o,f=u?u+2:0,d=c?c+2:0,h=2*f+(i>>o),p=2*d+(a>>o),m=new Float32Array(h*p),g=new Float32Array(h*p);let y=m;s.forEach((r=>{const i=f+(+e(r)>>o),a=d+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<p&&(m[i+a*h]+=+n(r))})),u>0&&c>0?(LT(h,p,m,g,u),IT(h,p,g,m,c),LT(h,p,m,g,u),IT(h,p,g,m,c),LT(h,p,m,g,u),IT(h,p,g,m,c)):u>0?(LT(h,p,m,g,u),LT(h,p,g,m,u),LT(h,p,m,g,u),y=g):c>0&&(IT(h,p,m,g,c),IT(h,p,g,m,c),IT(h,p,m,g,c),y=g);const v=l?Math.pow(2,-2*o):1/zf(y);for(let e=0,t=h*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(i>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=zT(t),s):e},s.y=function(e){return arguments.length?(t=zT(e),s):t},s.weight=function(e){return arguments.length?(n=zT(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||ou("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||ou("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=qu(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&ou("invalid bandwidth"),r=e,s):r},s}function LT(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function IT(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function qT(e){hg.call(this,null,e)}NT.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},oc(NT,hg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||cu,a=CT().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=TT(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>Df(t(e).values))))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,yu(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;Vu(i)&&(i=i(n,r));Vu(a)&&(a=a(n,r));if((1===i||null==i)&&!a)return;const o=(fc(i)?i:i[0])||1,s=(fc(i)?i:i[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(RT(t,o,s,l,u))}(r,n,t,e),r.forEach((e=>{l.push(zm(t,Rm(null!=s?{[s]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),qT.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const UT=["x","y","weight","size","cellSize","bandwidth"];function VT(e,t){return UT.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function WT(e){hg.call(this,null,e)}oc(qT,hg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(tu),o=VT(BT(),e),s=e.as||"grid";return n=i.map((t=>Rm(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),WT.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},oc(WT,hg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=CT().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||TT(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=RT(n=VT(BT(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=yu(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(Rm),i}});const HT="Feature",GT="FeatureCollection";function XT(e){hg.call(this,null,e)}function YT(e){hg.call(this,null,e)}function JT(e){hg.call(this,null,e)}function KT(e){hg.call(this,null,e)}function QT(e){hg.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,f,d=10,h=d,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return Pf(DC(r/p)*p,n,p).map(c).concat(Pf(DC(s/m)*m,o,m).map(f)).concat(Pf(DC(t/d)*d,e,d).filter((function(e){return SC(e%p)>yC})).map(l)).concat(Pf(DC(a/h)*h,i,h).filter((function(e){return SC(e%m)>yC})).map(u))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(o).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),y.precision(g)):[[r,s],[n,o]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),y.precision(g)):[[t,a],[e,i]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],y):[p,m]},y.stepMinor=function(e){return arguments.length?(d=+e[0],h=+e[1],y):[d,h]},y.precision=function(d){return arguments.length?(g=+d,l=Aj(a,i,90),u=Dj(t,e,g),c=Aj(s,o,90),f=Dj(r,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function ZT(e){hg.call(this,null,e)}function eN(e){if(!Vu(e))return!1;const t=Ec(nu(e));return t.$x||t.$y||t.$value||t.$max}function tN(e){hg.call(this,null,e),this.modified(!0)}function nN(e,t,n){Vu(e[t])&&e[t](n)}XT.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},oc(XT,hg,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&cu,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(nu(l))||o&&t.modified(nu(o))||s&&t.modified(nu(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,(e=>r.push(l(e)))),o&&s&&(t.visit(u,(e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:HT,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:GT,features:r}}}),YT.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},oc(YT,hg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||cu,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=ET(e.projection),n.materialize().reflow()):o=i===cu||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(r,e.pointRadius);return n.visit(o,(e=>e[a]=r(i(e)))),r.pointRadius(s),n.modifies(a)}}),JT.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},oc(JT,hg,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),KT.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},oc(KT,hg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(ET(e.projection),e.field||lu("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),QT.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},oc(QT,hg,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)Vu(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(Bm(r[0],n)):t.add.push(Rm(n)),r[0]=n,t}}),ZT.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},oc(ZT,hg,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||cu,a=function(e,t){let n;Vu(e)?(n=n=>e(n,t),n.dep=eN(e)):e?n=Ju(e):(n=e=>e.$value/e.$max||0,n.dep=!0);return n}(e.opacity,e),o=function(e,t){let n;Vu(e)?(n=n=>_x(e(n,t)),n.dep=eN(e)):n=Ju(_x(e||"#888"));return n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?Df(n.map((e=>Df(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=Qu({},e,l);r||(n.$max=Df(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||i,u=e.y2||a,c=e.values,f=c?e=>c[e]:fu,d=Xb(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),m=p.data;for(let e=s,a=0;e<u;++e){t.$y=e-s;for(let s=o,u=e*i;s<l;++s,a+=4){t.$x=s-o,t.$value=f(s+u);const e=n(t);m[a+0]=e.r,m[a+1]=e.g,m[a+2]=e.b,m[a+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}(t,n,o.dep?o:Ju(o(n)),a.dep?a:Ju(a(n)))})),t.reflow(!0).modifies(s)}}),oc(tN,hg,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=ST((e||"mercator").toLowerCase());t||ou("Unrecognized projection type: "+e);return t()}(e.type),kT.forEach((t=>{null!=e[t]&&nN(n,t,e[t])}))):kT.forEach((t=>{e.modified(t)&&nN(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=qu(e)).length?e[0]:{type:GT,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===GT?e.features:qu(e).filter((e=>null!=e)).map((e=>e.type===HT?e:{type:HT,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var rN=Object.freeze({__proto__:null,contour:WT,geojson:XT,geopath:YT,geopoint:JT,geoshape:KT,graticule:QT,heatmap:ZT,isocontour:NT,kde2d:qT,projection:tN});function iN(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,f,d,h=e._root,p={data:r},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o,i=h,!(h=h[f=c<<1|u]))return i[f]=p,e;if(s=+e._x.call(null,h.data),l=+e._y.call(null,h.data),t===s&&n===l)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o}while((f=c<<1|u)==(d=(l>=o)<<1|s>=a));return i[d]=h,i[f]=p,e}function aN(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function oN(e){return e[0]}function sN(e){return e[1]}function lN(e,t,n){var r=new uN(null==t?oN:t,null==n?sN:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function uN(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function cN(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var fN=lN.prototype=uN.prototype;function dN(e){return function(){return e}}function hN(e){return 1e-6*(e()-.5)}function pN(e){return e.x+e.vx}function mN(e){return e.y+e.vy}function gN(e){return e.index}function yN(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}fN.copy=function(){var e,t,n=new uN(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=cN(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=cN(t));return n},fN.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return iN(this.cover(t,n),t,n,e)},fN.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>f&&(f=i));if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<a;++n)iN(this,o[n],s[n],e[n]);return this},fN.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n||1,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},fN.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},fN.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},fN.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],m=this._root;for(m&&p.push(new aN(m,c,f,d,h)),null==n?n=1/0:(c=e-n,f=t-n,d=e+n,h=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(a=l.y0)>h||(o=l.x1)<c||(s=l.y1)<f))if(m.length){var g=(i+o)/2,y=(a+s)/2;p.push(new aN(m[3],g,y,o,s),new aN(m[2],i,y,g,s),new aN(m[1],g,a,o,y),new aN(m[0],i,a,g,y)),(u=(t>=y)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,f=t-w,d=e+w,h=t+w,r=m.data}}return r},fN.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,f,d,h=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!h)return this;if(h.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+y)/2))?m=l:y=l,t=h,!(h=h[f=c<<1|u]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},fN.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},fN.root=function(){return this._root},fN.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},fN.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new aN(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new aN(n,u,c,a,o)),(n=l[2])&&s.push(new aN(n,r,c,u,o)),(n=l[1])&&s.push(new aN(n,u,i,a,c)),(n=l[0])&&s.push(new aN(n,r,i,u,c))}return this},fN.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new aN(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,f=(s+u)/2;(a=i[0])&&n.push(new aN(a,o,s,c,f)),(a=i[1])&&n.push(new aN(a,c,s,l,f)),(a=i[2])&&n.push(new aN(a,o,f,c,u)),(a=i[3])&&n.push(new aN(a,c,f,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},fN.x=function(e){return arguments.length?(this._x=e,this):this._x},fN.y=function(e){return arguments.length?(this._y=e,this):this._y};var vN={value:()=>{}};function bN(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new xN(r)}function xN(e){this._=e}function wN(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function _N(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function kN(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=vN,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}xN.prototype=bN.prototype={constructor:xN,on:function(e,t){var n,r=this._,i=wN(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=kN(r[n],e.name,t);else if(null==t)for(n in r)r[n]=kN(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=_N(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new xN(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var ON,SN,EN=0,$N=0,AN=0,DN=0,CN=0,MN=0,jN="object"==typeof performance&&performance.now?performance:Date,FN="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function TN(){return CN||(FN(NN),CN=jN.now()+MN)}function NN(){CN=0}function RN(){this._call=this._time=this._next=null}function PN(e,t,n){var r=new RN;return r.restart(e,t,n),r}function zN(){CN=(DN=jN.now())+MN,EN=$N=0;try{!function(){TN(),++EN;for(var e,t=ON;t;)(e=CN-t._time)>=0&&t._call.call(null,e),t=t._next;--EN}()}finally{EN=0,function(){var e,t,n=ON,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:ON=t);SN=e,LN(r)}(),CN=0}}function BN(){var e=jN.now(),t=e-DN;t>1e3&&(MN-=t,DN=e)}function LN(e){EN||($N&&($N=clearTimeout($N)),e-CN>24?(e<1/0&&($N=setTimeout(zN,e-jN.now()-MN)),AN&&(AN=clearInterval(AN))):(AN||(DN=jN.now(),AN=setInterval(BN,1e3)),EN=1,FN(zN)))}RN.prototype=PN.prototype={constructor:RN,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?TN():+n)+(null==t?0:+t),this._next||SN===this||(SN?SN._next=this:ON=this,SN=this),this._call=e,this._time=n,LN()},stop:function(){this._call&&(this._call=null,this._time=1/0,LN())}};const IN=4294967296;function qN(e){return e.x}function UN(e){return e.y}var VN=Math.PI*(3-Math.sqrt(5));function WN(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=PN(f),u=bN("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%IN)/IN}();function f(){d(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function d(r){var l,u,c=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*VN;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}const HN={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,f,d,h=t.length,p=0;p<a;++p)for(o=lN(t,pN,mN).visitAfter(s),e=0;e<h;++e)l=t[e],f=n[l.index],d=f*f,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,p=f+h;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,y=m*m+g*g;y<p*p&&(0===m&&(y+=(m=hN(r))*m),0===g&&(y+=(g=hN(r))*g),y=(p-(y=Math.sqrt(y)))/y*i,l.vx+=(m*=y)*(p=(h*=h)/(d+h)),l.vy+=(g*=y)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=dN(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:dN(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=dN(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=lN(e,qN,UN).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,a,u,c){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=c-a,p=f*f+d*d;if(h*h/l<p)return p<s&&(0===f&&(p+=(f=hN(n))*f),0===d&&(p+=(d=hN(n))*d),p<o&&(p=Math.sqrt(o*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=hN(n))*f),0===d&&(p+=(d=hN(n))*d),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:dN(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=gN,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=dN(30),c=1;function f(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,f,d,h,p,m,g=0;g<s;++g)u=(l=e[g]).source,d=(f=l.target).x+f.vx-u.x-u.vx||hN(o),h=f.y+f.vy-u.y-u.vy||hN(o),d*=p=((p=Math.sqrt(d*d+h*h))-n[g])/p*r*t[g],h*=p,f.vx-=d*(m=a[g]),f.vy-=h*m,u.vx+=d*(m=1-m),u.vy+=h*m}function d(){if(r){var o,l,u=r.length,c=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=yN(f,l.source)),"object"!=typeof l.target&&(l.target=yN(f,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)l=e[o],a[o]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),h(),n=new Array(c),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(c=+e,f):c},f.strength=function(e){return arguments.length?(l="function"==typeof e?e:dN(+e),h(),f):l},f.distance=function(e){return arguments.length?(u="function"==typeof e?e:dN(+e),p(),f):u},f},x:function(e){var t,n,r,i=dN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=dN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:dN(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:dN(+t),o(),a):e},a},y:function(e){var t,n,r,i=dN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=dN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:dN(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:dN(+t),o(),a):e},a}},GN="forces",XN=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],YN=["static","iterations"],JN=["x","y","vx","vy"];function KN(e){hg.call(this,null,e)}function QN(e,t,n,r){var i,a,o,s,l=qu(t.forces);for(i=0,a=XN.length;i<a;++i)(o=XN[i])!==GN&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=GN+i,(o=n||t.modified(GN,i)?eR(l[i]):r&&ZN(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(GN+i,null);return e.numForces=l.length,e}function ZN(e,t){var n,r;for(n in e)if(Vu(r=e[n])&&t.modified(nu(r)))return 1;return 0}function eR(e){var t,n;for(n in nc(HN,e.force)||ou("Unrecognized force: "+e.force),t=HN[e.force](),e)Vu(t[n])&&tR(t[n],e[n],e);return t}function tR(e,t,n){e(Vu(t)?e=>t(e,n):t)}KN.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:JN}]},oc(KN,hg,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(XN),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&QN(i,e,0,t)):(this.value=i=function(e,t){const n=WN(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),QN(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(YN)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,s=0,l=t.length;s<l;++s)if(e=t[s],e.name===GN&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(JN)}});var nR=Object.freeze({__proto__:null,force:KN});function rR(e,t){return e.parent===t.parent?1:2}function iR(e,t){return e+t.x}function aR(e,t){return Math.max(e,t.y)}function oR(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function sR(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=uR)):void 0===t&&(t=lR);for(var n,r,i,a,o,s=new dR(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new dR(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(fR)}function lR(e){return e.children}function uR(e){return Array.isArray(e)?e[1]:null}function cR(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function fR(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function dR(e){this.data=e,this.depth=this.height=0,this.parent=null}function hR(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&gR(n,t)?++r:(n=vR(a=pR(a,t)),r=0);return n}function pR(e,t){var n,r;if(yR(t,e))return[t];for(n=0;n<e.length;++n)if(mR(t,e[n])&&yR(bR(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(mR(bR(e[n],e[r]),t)&&mR(bR(e[n],t),e[r])&&mR(bR(e[r],t),e[n])&&yR(xR(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function mR(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function gR(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function yR(e,t){for(var n=0;n<t.length;++n)if(!gR(e,t[n]))return!1;return!0}function vR(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return bR(e[0],e[1]);case 3:return xR(e[0],e[1],e[2])}}function bR(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(r+o+u/f*c)/2,r:(f+i+s)/2}}function xR(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=r-o,h=r-u,p=i-s,m=i-c,g=l-a,y=f-a,v=r*r+i*i-a*a,b=v-o*o-s*s+l*l,x=v-u*u-c*c+f*f,w=h*p-d*m,_=(p*x-m*b)/(2*w)-r,k=(m*g-p*y)/w,O=(h*b-d*x)/(2*w)-i,S=(d*y-h*g)/w,E=k*k+S*S-1,$=2*(a+_*k+O*S),A=_*_+O*O-a*a,D=-(E?($+Math.sqrt($*$-4*E*A))/(2*E):A/$);return{x:r+_+k*D,y:i+O+S*D,r:D}}function wR(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function _R(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function kR(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function OR(e){this._=e,this.next=null,this.previous=null}function SR(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,o,s,l,u,c,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;wR(n,t,r=e[2]),t=new OR(t),n=new OR(n),r=new OR(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){wR(t._,n._,r=e[s]),r=new OR(r),l=n.next,u=t.previous,c=n._.r,f=t._.r;do{if(c<=f){if(_R(l._,r._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(_R(u._,r._)){(t=u).next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}}while(l!==u.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=kR(t);(r=r.next)!==n;)(o=kR(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=hR(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function ER(e){return null==e?null:$R(e)}function $R(e){if("function"!=typeof e)throw new Error;return e}function AR(){return 0}function DR(e){return function(){return e}}function CR(e){return Math.sqrt(e.value)}function MR(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function jR(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=SR(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function FR(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function TR(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function NR(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u}dR.prototype=sR.prototype={constructor:dR,count:function(){return this.eachAfter(oR)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop(),t=r.pop();for(;e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return sR(this).eachBefore(cR)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var RR={depth:-1},PR={};function zR(e){return e.id}function BR(e){return e.parentId}function LR(){var e=zR,t=BR;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),f=c.length,d=new Map;for(i=0;i<f;++i)r=c[i],s=c[i]=new dR(r),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,d.set(u,d.has(u)?PR:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<f;++i)if(l=(s=c[i]).parent){if(!(o=d.get(l)))throw new Error("missing: "+l);if(o===PR)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=RR,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(fR),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=$R(t),n):e},n.parentId=function(e){return arguments.length?(t=$R(e),n):t},n}function IR(e,t){return e.parent===t.parent?1:2}function qR(e){var t=e.children;return t?t[0]:e.t}function UR(e){var t=e.children;return t?t[t.length-1]:e.t}function VR(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function WR(e,t,n){return e.a.parent===t.parent?e.a:n}function HR(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function GR(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u}HR.prototype=Object.create(dR.prototype);var XR=(1+Math.sqrt(5))/2;function YR(e,t,n,r,i,a){for(var o,s,l,u,c,f,d,h,p,m,g,y=[],v=t.children,b=0,x=0,w=v.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=v[x++].value}while(!c&&x<w);for(f=d=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(d/g,g/f);x<w;++x){if(c+=s=v[x].value,s<f&&(f=s),s>d&&(d=s),g=c*c*m,(h=Math.max(d/g,g/f))>p){c-=s;break}p=h}y.push(o={value:c,dice:l<u,children:v.slice(b,x)}),o.dice?NR(o,n,r,i,_?r+=u*c/_:a):GR(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return y}var JR=function e(t){function n(e,n,r,i,a){YR(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(XR);var KR=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,f=-1,d=o.length,h=e.value;++f<d;){for(l=(s=o[f]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?NR(s,n,r,i,h?r+=(a-r)*s.value/h:a):GR(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=YR(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(XR);function QR(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function ZR(e){hg.call(this,null,e)}ZR.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const eP=e=>e.values;function tP(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],o={},s={};let l,u,c,f=-1;for(;++f<i;)l=a(u=t[f])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=n(o[l],r);return s}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function nP(e){hg.call(this,null,e)}oc(ZR,hg,{transform(e,t){t.source||ou("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&Fm(e.data)&&i.rem.push(e.data)})),this.value=a=sR({values:qu(e.keys).reduce(((e,t)=>(e.key(t),e)),tP()).entries(i.source)},eP),n&&a.each((e=>{e.children&&(e=Rm(e.data),i.add.push(e),i.source.push(e))})),QR(a,Tm,Tm)),i.source.root=a,i}});const rP=(e,t)=>e.parent===t.parent?1:2;oc(nP,hg,{transform(e,t){t.source&&t.source.root||ou(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(Lm(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?rP:du);try{this.value=n(i)}catch(e){ou(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const iP=["x","y","r","depth","children"];function aP(e){nP.call(this,e)}aP.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:iP.length,default:iP}]},oc(aP,nP,{layout:function(){var e=null,t=1,n=1,r=AR;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(MR(e)).eachAfter(jR(r,.5)).eachBefore(FR(1)):i.eachBefore(MR(CR)).eachAfter(jR(AR,1)).eachAfter(jR(r,i.r/Math.min(t,n))).eachBefore(FR(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=ER(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:DR(+e),i):r},i},params:["radius","size","padding"],fields:iP});const oP=["x0","y0","x1","y1","depth","children"];function sP(e){nP.call(this,e)}function lP(e){hg.call(this,null,e)}sP.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:oP.length,default:oP}]},oc(sP,nP,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&NR(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(TR),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:oP}),lP.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},oc(lP,hg,{transform(e,t){t.source||ou("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?QR(LR().id(e.key).parentId(e.parentKey)(i.source),e.key,hu):QR(LR()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const uP={tidy:function(){var e=IR,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new HR(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new HR(r[i],i)),n.parent=t;return(o.parent=new HR(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,f=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>f.depth&&(f=e)}));var d=u===c?1:e(u,c)/2,h=d-u.x,p=t/(c.x+d+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,f=s.m,d=l.m;s=UR(s),a=qR(a),s&&a;)l=qR(l),(o=UR(o)).a=t,(i=s.z+f-a.z-u+e(s._,a._))>0&&(VR(WR(s,t,r),t,i),u+=i,c+=i),f+=s.m,u+=a.m,d+=l.m,c+=o.m;s&&!UR(o)&&(o.t=s,o.m+=f-c),a&&!qR(l)&&(l.t=a,l.m+=u-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=rR,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(iR,0)/e.length}(n),t.y=function(e){return 1+e.reduce(aR,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},cP=["x","y","depth","children"];function fP(e){nP.call(this,e)}function dP(e){hg.call(this,[],e)}fP.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:cP.length,default:cP}]},oc(fP,nP,{layout(e){const t=e||"tidy";if(nc(uP,t))return uP[t]();ou("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:cP}),dP.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},oc(dP,hg,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||ou("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[Tm(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[Tm(t)]&&a[Tm(n)]&&i.add.push(Rm({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[Tm(e)]=1)),n.forEach((e=>{(a[Tm(e.source)]||a[Tm(e.target)])&&i.mod.push(e)}))),i}});const hP={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}var f=u[t],d=r/2+f,h=t+1,p=n-1;for(;h<p;){var m=h+p>>>1;u[m]<d?h=m+1:p=m}d-u[h-1]<u[h]-d&&t+1<h&&--h;var g=u[h]-f,y=r-g;if(o-i>l-a){var v=r?(i*y+o*g)/r:o;e(t,h,g,i,a,v,l),e(h,n,y,v,a,o,l)}else{var b=r?(a*y+l*g)/r:l;e(t,h,g,i,a,o,b),e(h,n,y,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:NR,slice:GR,slicedice:function(e,t,n,r,i){(1&e.depth?GR:NR)(e,t,n,r,i)},squarify:JR,resquarify:KR},pP=["x0","y0","x1","y1","depth","children"];function mP(e){nP.call(this,e)}mP.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:pP.length,default:pP}]},oc(mP,nP,{layout(){const e=function(){var e=JR,t=!1,n=1,r=1,i=[0],a=AR,o=AR,s=AR,l=AR,u=AR;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(TR),e}function f(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,f=t.x1-n,d=t.y1-n;f<r&&(r=f=(r+f)/2),d<c&&(c=d=(c+d)/2),t.x0=r,t.y0=c,t.x1=f,t.y1=d,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(d-=l(t)-n)<c&&(c=d=(c+d)/2),e(t,r,c,f,d))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=$R(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:DR(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:DR(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:DR(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:DR(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:DR(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{nc(hP,t)?e.tile(hP[t]):ou("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:pP});var gP=Object.freeze({__proto__:null,nest:ZR,pack:aP,partition:sP,stratify:lP,tree:fP,treelinks:dP,treemap:mP});function yP(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=Xb(i,a).getContext("2d");t.forEach((e=>vP(s,e,o)));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let f,d,h,p,m;for(d=0;d<a;++d)for(f=0;f<i;++f)m=4278190080&l[d*i+f],m&&(h=e(f),p=e(d),r||u.set(h,p),o&&268435456^m&&c.set(h,p));return[u,c]}function vP(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>vP(e,t.items,n)))})):WE[r].draw(e,{items:n?t.map(bP):t})}function bP(e){const t=zm(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const xP=31,wP=new Uint32Array(33),_P=new Uint32Array(33);_P[0]=0,wP[0]=~_P[0];for(let e=1;e<=32;++e)_P[e]=_P[e-1]<<1|1,wP[e]=~_P[e];function kP(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&xP)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&xP))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&xP)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&wP[o&xP]&_P[1+(s&xP)])return!0}else{if(n[l]&wP[o&xP])return!0;if(n[u]&_P[1+(s&xP)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,wP[o&xP]&_P[1+(s&xP)]);else for(r(l,wP[o&xP]),r(u,_P[1+(s&xP)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,_P[o&xP]|wP[1+(s&xP)]);else for(i(l,_P[o&xP]),i(u,wP[1+(s&xP)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function OP(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function SP(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),f=e(n-(a/=2)),d=e(n+a);return o.outOfBounds(u,f,c,d)||o.getRange(u,f,c,d)||s&&s.getRange(u,f,c,d)}const EP=[-1,-1,1,1],$P=[-1,1,-1,1];const AP=["right","center","left"],DP=["bottom","middle","top"];function CP(e,t,n,r,i,a,o,s,l,u,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const MP={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},jP={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=$E.width(e.datum,e.datum.text);let l,u,c,f,d,h,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,f=void 0===t[r].y2?c:t[r].y2,d=(l+u)/2,h=(c+f)/2,p=Math.abs(u-l+f-c),p>=m&&(m=p,e.x=d,e.y=h);return d=s/2,h=o/2,l=e.x-d,u=e.x+d,c=e.y-h,f=e.y+h,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&f<=a?e.baseline="top":0<=c&&a<f&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),f=e.invert(n);let d,h=r,p=a;if(!OP(c,f,l,u,i,a)&&!SP(e,c,f,u,l,h,o,s)&&!SP(e,c,f,u,l,u,o,null)){for(;p-h>=1;)d=(h+p)/2,SP(e,c,f,u,l,d,o,s)?p=d:h=d;if(h>r)return[c,f,h,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,f=$E.width(t.datum,t.datum.text);let d,h,p,m,g,y,v,b,x,w,_,k,O,S,E,$,A,D=n?c:0,C=!1,M=!1,j=0;for(let r=0;r<u;++r){for(d=s[r].x,p=s[r].y,h=void 0===s[r].x2?d:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,d>h&&(A=d,d=h,h=A),p>m&&(A=p,p=m,m=A),x=e(d),_=e(h),w=~~((x+_)/2),k=e(p),S=e(m),O=~~((k+S)/2),v=w;v>=x;--v)for(b=O;b>=k;--b)$=l(v,b,D,f,c),$&&([t.x,t.y,D,C]=$);for(v=w;v<=_;++v)for(b=O;b<=S;++b)$=l(v,b,D,f,c),$&&([t.x,t.y,D,C]=$);C||n||(E=Math.abs(h-d+m-p),g=(d+h)/2,y=(p+m)/2,E>=j&&!OP(g,y,f,c,i,a)&&!SP(e,g,y,c,f,c,o,null)&&(j=E,t.x=g,t.y=y,M=!0))}return!(!C&&!M)&&(g=f/2,y=c/2,o.setRange(e(t.x-g),e(t.y-y),e(t.x+g),e(t.y+y)),t.align="center",t.baseline="middle",!0)}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,f=t.datum.fontSize,d=$E.width(t.datum,t.datum.text),h=[];let p,m,g,y,v,b,x,w,_,k,O,S,E=n?f:0,$=!1,A=!1,D=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,y=void 0===u[r].y2?g:u[r].y2,h.push([e((p+m)/2),e((g+y)/2)]);h.length;)if([x,w]=h.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)v=x+EP[e],b=w+$P[e],l.outOfBounds(v,b,v,b)||h.push([v,b]);if(v=e.invert(x),b=e.invert(w),_=E,k=a,!OP(v,b,d,f,i,a)&&!SP(e,v,b,f,d,_,o,s)&&!SP(e,v,b,f,d,f,o,null)){for(;k-_>=1;)O=(_+k)/2,SP(e,v,b,f,d,O,o,s)?k=O:_=O;_>E&&(t.x=v,t.y=b,E=_,$=!0)}}$||n||(S=Math.abs(m-p+y-g),v=(p+m)/2,b=(g+y)/2,S>=D&&!OP(v,b,d,f,i,a)&&!SP(e,v,b,f,d,f,o,null)&&(D=S,t.x=v,t.y=b,A=!0))}return!(!$&&!A)&&(v=d/2,b=f/2,o.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",!0)}}};function FP(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const f=Math.max(r.length,i.length),d=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,f),h=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=MP[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,f),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,y=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),v=kP(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let _;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<h.length&&!t;++e)t=5===h[e]||d[e]<0;p&&(o||g)&&(a=[e.map((e=>e.datum))].concat(a)),_=a.length?yP(v,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,o&&w)}const k=g?jP[c](v,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let f,d,h,p,m,g,y,v,b,x,w,_,k,O,S,E=0;for(let i=0;i<l;++i){if(f=(3&n[i])-1,d=(n[i]>>>2&3)-1,h=0===f&&0===d||r[i]<0,p=f&&d?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+f]+r[i]*f*p,w=u[4+d]+m*c*d/2+r[i]*d*p,v=w-c/2,b=w+c/2,_=e(g),O=e(v),S=e(b),!E){if(!CP(_,_,O,S,o,s,g,g,v,b,u,h))continue;E=$E.width(t.datum,t.datum.text)}if(x=g+m*E*f/2,g=x-E/2,y=x+E/2,_=e(g),k=e(y),CP(_,k,O,S,o,s,g,y,v,b,u,h))return t.x=f?f*m<0?y:g:x,t.y=d?d*m<0?b:v:w,t.align=AP[f*m+1],t.baseline=DP[d*m+1],o.setRange(_,O,k,S),!0}return!1}}(v,_,h,d);return w.forEach((e=>e.opacity=+k(e))),w}const TP=["x","y","opacity","align","baseline"],NP=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function RP(e){hg.call(this,null,e)}RP.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:NP},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:TP.length,default:TP}]},oc(RP,hg,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e[n];return Vu(r)&&t.modified(r.fields)}("sort")))return;e.size&&2===e.size.length||ou("Size parameter should be specified as a [width, height] array.");const r=e.as||TP;return FP(t.materialize(t.SOURCE).source,e.size,e.sort,qu(e.offset||1),qu(e.anchor||NP),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}});var PP=Object.freeze({__proto__:null,label:RP});function zP(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function BP(e){hg.call(this,null,e)}BP.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},oc(BP,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=zP(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(tu),a=i.length,o=e.as||[tu(e.x),tu(e.y)],s=[];r.forEach((t=>{ny(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[o[0]]=e[0],n[o[1]]=e[1],s.push(Rm(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const LP={linear:Yg,log:Jg,exp:Kg,pow:Qg,quad:Zg,poly:ey};function IP(e){hg.call(this,null,e)}IP.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(LP)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},oc(IP,hg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=zP(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(tu),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[tu(e.x),tu(e.y)],u=LP[a],c=[];let f=e.extent;nc(LP,a)||ou("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push(Rm({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const d=f||Zu(n,e.x),h=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[l[0]]=e[0],t[l[1]]=e[1],c.push(Rm(t))};"linear"===a?d.forEach((e=>h([e,r.predict(e)]))):oy(r.predict,d,25,200).forEach(h)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});var qP=Object.freeze({__proto__:null,loess:BP,regression:IP});const UP=Math.pow(2,-52),VP=new Uint32Array(512);class WP{static from(e,t=ZP,n=ez){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new WP(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>l&&(l=n),r>u&&(u=r),this._ids[t]=t}const c=(o+l)/2,f=(s+u)/2;let d,h,p,m=1/0;for(let t=0;t<a;t++){const n=HP(c,f,e[2*t],e[2*t+1]);n<m&&(d=t,m=n)}const g=e[2*d],y=e[2*d+1];m=1/0;for(let t=0;t<a;t++){if(t===d)continue;const n=HP(g,y,e[2*t],e[2*t+1]);n<m&&n>0&&(h=t,m=n)}let v=e[2*h],b=e[2*h+1],x=1/0;for(let t=0;t<a;t++){if(t===d||t===h)continue;const n=JP(g,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];KP(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(XP(g,y,v,b,w,_)){const e=h,t=v,n=b;h=p,v=w,b=_,p=e,w=t,_=n}const k=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*f)*d,y:t+(o*f-l*c)*d}}(g,y,v,b,w,_);this._cx=k.x,this._cy=k.y;for(let t=0;t<a;t++)this._dists[t]=HP(e[2*t],e[2*t+1],k.x,k.y);KP(this._ids,this._dists,0,a-1),this._hullStart=d;let O=3;n[d]=t[p]=h,n[h]=t[d]=p,n[p]=t[h]=d,r[d]=0,r[h]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(v,b)]=h,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(d,h,p,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const l=this._ids[s],u=e[2*l],c=e[2*l+1];if(s>0&&Math.abs(u-a)<=UP&&Math.abs(c-o)<=UP)continue;if(a=u,o=c,l===d||l===h||l===p)continue;let f=0;for(let e=0,t=this._hashKey(u,c);e<this._hashSize&&(f=i[(t+e)%this._hashSize],-1===f||f===n[f]);e++);f=t[f];let m,g=f;for(;m=n[g],!XP(u,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,l,n[g],-1,-1,r[g]);r[l]=this._legalize(y+2),r[g]=y,O++;let v=n[g];for(;m=n[v],XP(u,c,e[2*v],e[2*v+1],e[2*m],e[2*m+1]);)y=this._addTriangle(v,l,m,r[l],-1,r[v]),r[l]=this._legalize(y+2),n[v]=v,O--,v=m;if(g===f)for(;m=t[g],XP(u,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)y=this._addTriangle(m,l,g,-1,r[g],r[m]),this._legalize(y+2),r[m]=y,n[g]=g,O--,g=m;this._hullStart=t[l]=g,n[g]=t[v]=l,n[l]=v,i[this._hashKey(u,c)]=l,i[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(O);for(let e=0,t=this._hullStart;e<O;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=VP[--i];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c];if(YP(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1])){t[e]=p,t[o]=f;const r=n[c];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,c);const s=l+(o+1)%3;i<VP.length&&(VP[i++]=s)}else{if(0===i)break;e=VP[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function HP(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function GP(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function XP(e,t,n,r,i,a){return(GP(i,a,e,t,n,r)||GP(e,t,n,r,i,a)||GP(n,r,i,a,e,t))<0}function YP(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,f=r-s,d=i-o,h=a-s,p=c*c+f*f,m=d*d+h*h;return l*(f*m-p*h)-u*(c*m-p*d)+(l*l+u*u)*(c*h-f*d)<0}function JP(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function KP(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;QP(e,n+r>>1,i),t[e[n]]>t[e[r]]&&QP(e,n,r),t[e[i]]>t[e[r]]&&QP(e,i,r),t[e[n]]>t[e[i]]&&QP(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;QP(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(KP(e,t,i,r),KP(e,t,n,a-1)):(KP(e,t,n,a-1),KP(e,t,i,r))}}function QP(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function ZP(e){return e[0]}function ez(e){return e[1]}const tz=1e-6;class nz{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>tz||Math.abs(this._y1-i)>tz)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class rz{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class iz{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,o=0,s=n.length;a<s;a+=3,o+=2){const s=2*n[a],l=2*n[a+1],u=2*n[a+2],c=e[s],f=e[s+1],d=e[l],h=e[l+1],p=e[u],m=e[u+1],g=d-c,y=h-f,v=p-c,b=m-f,x=g*g+y*y,w=v*v+b*b,_=2*(g*b-y*v);if(_)if(Math.abs(_)<1e-8)t=(c+p)/2,r=(f+m)/2;else{const e=1/_;t=c+(b*x-y*w)*e,r=f+(g*w-v*x)*e}else t=(c+p)/2-1e8*b,r=(f+m)/2+1e8*v;i[o]=t,i[o+1]=r}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],f=e[2*l+1];r.fill(0);for(let n=0;n<t.length;++n)l=t[n],a=u,o=c,s=f,u=4*l,c=e[2*l],f=e[2*l+1],r[a+2]=r[u]=s-f,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new nz:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),o=2*Math.floor(r/3),s=a[i],l=a[i+1],u=a[o],c=a[o+1];this._renderSegment(s,l,u,c,e)}let s,l=i[i.length-1];for(let t=0;t<i.length;++t){s=l,l=i[t];const n=2*Math.floor(r[l]/3),u=a[n],c=a[n+1],f=4*s,d=this._project(u,c,o[f+2],o[f+3]);d&&this._renderSegment(u,c,d[0],d[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new nz:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new nz:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new rz;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],f=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(r=u,i=c,u=t[d],c=t[d+1],a=f,f=this._regioncode(u,c),0===a&&0===f)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,d,h,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,f)))continue;[n,d,h,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,f,a)))continue;[h,p,n,d]=t,o=s,s=this._edgecode(n,d),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,d):l=[n,d]}o=s,s=this._edgecode(h,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(h,p):l=[h,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let t,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)t=i,i=this._edgecode(s[n],s[n+1]),t&&i&&(n=this._edge(e,t,i,s,n),r=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const az=2*Math.PI,oz=Math.pow;function sz(e){return e[0]}function lz(e){return e[1]}function uz(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class cz{static from(e,t=sz,n=lz,r){return new cz("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new WP(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=uz(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new WP(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new iz(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=oz(t-l[2*e],2)+oz(n-l[2*e+1],2);const f=r[e];let d=f;do{let r=s[d];const f=oz(t-l[2*r],2)+oz(n-l[2*r+1],2);if(f<c&&(c=f,u=r),d=d%3==2?d-2:d+1,s[d]!==e)break;if(d=o[d],-1===d){if(d=i[(a[e]+1)%i.length],d!==r&&oz(t-l[2*d],2)+oz(n-l[2*d+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=null==e?e=new nz:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const o=2*i[t],s=2*i[a];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new nz:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,az)}return n&&n.value()}renderHull(e){const t=null==e?e=new nz:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new rz;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new nz:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new rz;return this.renderTriangle(e,t),t.value()}}function fz(e){hg.call(this,null,e)}fz.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const dz=[-1e5,-1e5,1e5,1e5];function hz(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}oc(fz,hg,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:dz;const a=this.value=cz.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?hz(t):null}return t.reflow(e.modified()).modifies(n)}});var pz=Object.freeze({__proto__:null,voronoi:fz}),mz=Math.PI/180,gz=2048;function yz(){var e,t,n,r,i,a,o,s=[256,256],l=_z,u=[],c=Math.random,f={};function d(e,t,n){for(var r,i,a,o=t.x,u=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=l(s),h=c()<.5?1:-1,p=-h;(r=d(p+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=u+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!bz(t,e,s[0]))&&(!n||wz(t,n))){for(var m,g=t.sprite,y=t.width>>5,v=s[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,_=t.y1-t.y0,k=(t.y+t.y0)*v+(b>>5),O=0;O<_;O++){m=0;for(var S=0;S<=y;S++)e[k+S]|=m<<w|(S<y?(m=g[O*y+S])>>>x:0);k+=v}return t.sprite=null,!0}return!1}return f.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=gz/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(Xb()),f=function(e){var t=[],n=-1;for(;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,p=u.length,m=-1,g=[],y=u.map((s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((e,t)=>t.size-e.size));++m<p;){var v=y[m];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,vz(l,v,y,m),v.hasText&&d(f,v,h)&&(g.push(v),h?xz(h,v):h=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return g},f.words=function(e){return arguments.length?(u=e,f):u},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=kz(e),f):t},f.fontStyle=function(e){return arguments.length?(r=kz(e),f):r},f.fontWeight=function(e){return arguments.length?(i=kz(e),f):i},f.rotate=function(e){return arguments.length?(a=kz(e),f):a},f.text=function(t){return arguments.length?(e=kz(t),f):e},f.spiral=function(e){return arguments.length?(l=Oz[e]||e,f):l},f.fontSize=function(e){return arguments.length?(n=kz(e),f):n},f.padding=function(e){return arguments.length?(o=kz(e),f):o},f.random=function(e){return arguments.length?(c=e,f):c},f}function vz(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,gz/a);var o,s,l,u,c,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*mz),g=Math.cos(t.rotate*mz),y=o*g,v=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,l=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(l>h&&(h=l),f+o>=2048&&(f=0,d+=h,h=0),d+l>=gz)break;i.translate((f+(o>>1))/a,(d+(l>>1))/a),t.rotate&&i.rotate(t.rotate*mz),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,2048/a,gz/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,O=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=s*c+(u>>5),E=w[2048*(d+c)+(f+u)<<2]?1<<31-u%32:0;_[S]|=E,k|=E}k?O=c:(t.y0++,l--,c--,d++)}t.y1=t.y0+O,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function bz(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*n+(o>>5),f=0;f<u;f++){r=0;for(var d=0;d<=a;d++)if((r<<l|(d<a?(r=i[f*a+d])>>>s:0))&t[c+d])return!0;c+=n}return!1}function xz(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function wz(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function _z(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function kz(e){return"function"==typeof e?e:function(){return e}}var Oz={archimedean:_z,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const Sz=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Ez=["text","font","rotate","fontSize","fontStyle","fontWeight"];function $z(e){hg.call(this,yz(),e)}$z.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Sz}]},oc($z,hg,{transform(e,t){!e.size||e.size[0]&&e.size[1]||ou("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||Ez.some((function(n){const r=e[n];return Vu(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||Sz;let o,s=e.fontSize||14;if(Vu(s)?o=e.fontSizeRange:s=Ju(s),o){const e=s,t=hk("sqrt")().domain(Zu(r,e)).range(o);s=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(_g).layout(),u=i.size(),c=u[0]>>1,f=u[1]>>1,d=l.length;for(let e,t,n=0;n<d;++n)e=l[n],t=e.datum,t[a[0]]=e.x+c,t[a[1]]=e.y+f,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});var Az=Object.freeze({__proto__:null,wordcloud:$z});const Dz=e=>new Uint8Array(e),Cz=e=>new Uint16Array(e),Mz=e=>new Uint32Array(e);function jz(e,t,n){const r=(t<257?Dz:t<65537?Cz:Mz)(e);return n&&r.set(n),r}function Fz(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function Tz(){let e=Mz(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=Mz(s);let u,c,f,d=Array(s);for(f=0;f<s;++f)d[f]=r(i[f]),l[f]=f;if(d=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(d,l),o)u=t,c=e,t=Array(o+s),e=Mz(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,f=0;for(u=0;c<r&&f<o;++u)t[c]<i[f]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[f],l[u]=a[f++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;f<o;++f,++u)s[u]=i[f],l[u]=a[f]+e}(a,u,c,o,d,l,s,t,e);else{if(a>0)for(f=0;f<s;++f)l[f]+=a;t=d,e=l}return n=o+s,{index:l,value:d}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[wf(r,e[0],0,i),xf(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function Nz(e){hg.call(this,function(){let e=8,t=[],n=Mz(0),r=jz(0,e),i=jz(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=jz(t,e,r),i=jz(t,e))}}}(),e),this._indices=null,this._dims=null}function Rz(e){hg.call(this,null,e)}Nz.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},oc(Nz,hg,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=Tz()),a.push(Fz(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let m,g,y,v,b,x,w,_,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,_=v.length;w<_;++w)x[v[w]._index]=1;for(w=0;w<h;++w)k=r[w],(!o[w]||e.modified("fields",w)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(a[y]=g=Tz(),p[y]=m=g.insert(k,t.source,0)),o[w]=Fz(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?f.push(w):x[w]&&l[w]!==c&&d.push(w));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,f=a.length;let d,h,p,m=i.size();i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),v=i.all();for(d=0;d<f;++d)h=s[d].fname,p=l[h]||(l[h]=o[h].insert(s[d],r,m)),a[d].onAdd(p,g);for(;m<c;++m)y[m]=v,g[m]!==v&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in r)r[h].remove(d,l);return this.reindex(t,d,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],m=e.one;let g,y,v;if(f<h)for(g=f,y=Math.min(h,d);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(f>h)for(g=h,y=Math.min(f,p);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;if(d>p)for(g=Math.max(f,p),y=d;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(d<p)for(g=Math.max(h,d),y=p;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],f=o[1],d=e.one;let h,p,m;if(l<c)for(h=l,p=Math.min(c,u);h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(l>c)for(h=c,p=Math.min(l,f);h<p;++h)m=a[h],i[m]^=d,r.push(m);if(u>f)for(h=Math.max(l,f),p=u;h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(u<f)for(h=Math.max(c,u),p=f;h<p;++h)m=a[h],i[m]^=d,r.push(m);e.range=t.slice()}}),Rz.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},oc(Rz,hg,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,(e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null})),a.filter(a.REM,(e=>{const t=s[e]&n;return t&&!(t^t^l[e]&n)?o[e]:null}))):(a.filter(a.ADD,u),a.filter(a.REM,(e=>(s[e]&n)===i?o[e]:null))),a.filter(a.SOURCE,(e=>u(e._index)))}});var Pz=Object.freeze({__proto__:null,crossfilter:Nz,resolvefilter:Rz});const zz="RawCode",Bz="Literal",Lz="Property",Iz="Identifier",qz="ArrayExpression",Uz="BinaryExpression",Vz="CallExpression",Wz="ConditionalExpression",Hz="LogicalExpression",Gz="MemberExpression",Xz="ObjectExpression",Yz="UnaryExpression";function Jz(e){this.type=e}var Kz,Qz,Zz,eB,tB;Jz.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case qz:return e.elements;case Uz:case Hz:return[e.left,e.right];case Vz:return[e.callee].concat(e.arguments);case Wz:return[e.test,e.consequent,e.alternate];case Gz:return[e.object,e.property];case Xz:return e.properties;case Lz:return[e.key,e.value];case Yz:return[e.argument];case Iz:case Bz:case zz:default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};(Kz={})[1]="Boolean",Kz[2]="<end>",Kz[3]="Identifier",Kz[4]="Keyword",Kz[5]="Null",Kz[6]="Numeric",Kz[7]="Punctuator",Kz[8]="String",Kz[9]="RegularExpression";var nB="Identifier",rB="Unexpected token %0",iB="Invalid regular expression",aB="Invalid regular expression: missing /",oB="Octal literals are not allowed in strict mode.",sB="ILLEGAL",lB="Disabled.",uB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),cB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function fB(e,t){if(!e)throw new Error("ASSERT: "+t)}function dB(e){return e>=48&&e<=57}function hB(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function pB(e){return"01234567".indexOf(e)>=0}function mB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function gB(e){return 10===e||13===e||8232===e||8233===e}function yB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&uB.test(String.fromCharCode(e))}function vB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&cB.test(String.fromCharCode(e))}const bB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function xB(){for(;Zz<eB;){const e=Qz.charCodeAt(Zz);if(!mB(e)&&!gB(e))break;++Zz}}function wB(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)Zz<eB&&hB(Qz[Zz])?(r=Qz[Zz++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):PB({},rB,sB);return String.fromCharCode(i)}function _B(){var e,t,n,r;for(t=0,"}"===(e=Qz[Zz])&&PB({},rB,sB);Zz<eB&&hB(e=Qz[Zz++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&PB({},rB,sB),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function kB(){var e,t;for(e=Qz.charCodeAt(Zz++),t=String.fromCharCode(e),92===e&&(117!==Qz.charCodeAt(Zz)&&PB({},rB,sB),++Zz,(e=wB("u"))&&"\\"!==e&&yB(e.charCodeAt(0))||PB({},rB,sB),t=e);Zz<eB&&vB(e=Qz.charCodeAt(Zz));)++Zz,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Qz.charCodeAt(Zz)&&PB({},rB,sB),++Zz,(e=wB("u"))&&"\\"!==e&&vB(e.charCodeAt(0))||PB({},rB,sB),t+=e);return t}function OB(){var e,t;return e=Zz,{type:1===(t=92===Qz.charCodeAt(Zz)?kB():function(){var e,t;for(e=Zz++;Zz<eB;){if(92===(t=Qz.charCodeAt(Zz)))return Zz=e,kB();if(!vB(t))break;++Zz}return Qz.slice(e,Zz)}()).length?3:bB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:Zz}}function SB(){var e,t,n,r,i=Zz,a=Qz.charCodeAt(Zz),o=Qz[Zz];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Zz,{type:7,value:String.fromCharCode(a),start:i,end:Zz};default:if(61===(e=Qz.charCodeAt(Zz+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Zz+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:Zz};case 33:case 61:return Zz+=2,61===Qz.charCodeAt(Zz)&&++Zz,{type:7,value:Qz.slice(i,Zz),start:i,end:Zz}}}return">>>="===(r=Qz.substr(Zz,4))?{type:7,value:r,start:i,end:Zz+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:Zz+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:Zz+=2}:("//"===t&&PB({},rB,sB),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++Zz}:void PB({},rB,sB))}function EB(){var e,t,n;if(fB(dB((n=Qz[Zz]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=Zz,e="","."!==n){if(e=Qz[Zz++],n=Qz[Zz],"0"===e){if("x"===n||"X"===n)return++Zz,function(e){let t="";for(;Zz<eB&&hB(Qz[Zz]);)t+=Qz[Zz++];return 0===t.length&&PB({},rB,sB),yB(Qz.charCodeAt(Zz))&&PB({},rB,sB),{type:6,value:parseInt("0x"+t,16),start:e,end:Zz}}(t);if(pB(n))return function(e){let t="0"+Qz[Zz++];for(;Zz<eB&&pB(Qz[Zz]);)t+=Qz[Zz++];return(yB(Qz.charCodeAt(Zz))||dB(Qz.charCodeAt(Zz)))&&PB({},rB,sB),{type:6,value:parseInt(t,8),octal:!0,start:e,end:Zz}}(t);n&&dB(n.charCodeAt(0))&&PB({},rB,sB)}for(;dB(Qz.charCodeAt(Zz));)e+=Qz[Zz++];n=Qz[Zz]}if("."===n){for(e+=Qz[Zz++];dB(Qz.charCodeAt(Zz));)e+=Qz[Zz++];n=Qz[Zz]}if("e"===n||"E"===n)if(e+=Qz[Zz++],"+"!==(n=Qz[Zz])&&"-"!==n||(e+=Qz[Zz++]),dB(Qz.charCodeAt(Zz)))for(;dB(Qz.charCodeAt(Zz));)e+=Qz[Zz++];else PB({},rB,sB);return yB(Qz.charCodeAt(Zz))&&PB({},rB,sB),{type:6,value:parseFloat(e),start:t,end:Zz}}function $B(){var e,t,n,r;return tB=null,xB(),e=Zz,t=function(){var e,t,n,r;for(fB("/"===(e=Qz[Zz]),"Regular expression literal must start with a slash"),t=Qz[Zz++],n=!1,r=!1;Zz<eB;)if(t+=e=Qz[Zz++],"\\"===e)gB((e=Qz[Zz++]).charCodeAt(0))&&PB({},aB),t+=e;else if(gB(e.charCodeAt(0)))PB({},aB);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||PB({},aB),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";Zz<eB&&vB((e=Qz[Zz]).charCodeAt(0));)++Zz,"\\"===e&&Zz<eB?PB({},rB,sB):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&PB({},iB,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";PB({},iB)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){PB({},iB)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Zz}}function AB(){if(xB(),Zz>=eB)return{type:2,start:Zz,end:Zz};const e=Qz.charCodeAt(Zz);return yB(e)?OB():40===e||41===e||59===e?SB():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(fB("'"===(e=Qz[Zz])||'"'===e,"String literal must starts with a quote"),t=Zz,++Zz;Zz<eB;){if((n=Qz[Zz++])===e){e="";break}if("\\"===n)if((n=Qz[Zz++])&&gB(n.charCodeAt(0)))"\r"===n&&"\n"===Qz[Zz]&&++Zz;else switch(n){case"u":case"x":"{"===Qz[Zz]?(++Zz,i+=_B()):i+=wB(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:pB(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),Zz<eB&&pB(Qz[Zz])&&(a=!0,r=8*r+"01234567".indexOf(Qz[Zz++]),"0123".indexOf(n)>=0&&Zz<eB&&pB(Qz[Zz])&&(r=8*r+"01234567".indexOf(Qz[Zz++]))),i+=String.fromCharCode(r)):i+=n}else{if(gB(n.charCodeAt(0)))break;i+=n}}return""!==e&&PB({},rB,sB),{type:8,value:i,octal:a,start:t,end:Zz}}():46===e?dB(Qz.charCodeAt(Zz+1))?EB():SB():dB(e)?EB():SB()}function DB(){const e=tB;return Zz=e.end,tB=AB(),Zz=e.end,e}function CB(){const e=Zz;tB=AB(),Zz=e}function MB(e,t,n){const r=new Jz("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function jB(e,t){const n=new Jz("CallExpression");return n.callee=e,n.arguments=t,n}function FB(e){const t=new Jz(nB);return t.name=e,t}function TB(e){const t=new Jz("Literal");return t.value=e.value,t.raw=Qz.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function NB(e,t,n){const r=new Jz("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function RB(e,t,n){const r=new Jz("Property");return r.key=t,r.value=n,r.kind=e,r}function PB(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(fB(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=Zz,n.description=i,n}function zB(e){2===e.type&&PB(e,"Unexpected end of input"),6===e.type&&PB(e,"Unexpected number"),8===e.type&&PB(e,"Unexpected string"),3===e.type&&PB(e,"Unexpected identifier"),4===e.type&&PB(e,"Unexpected reserved word"),PB(e,rB,e.value)}function BB(e){const t=DB();7===t.type&&t.value===e||zB(t)}function LB(e){return 7===tB.type&&tB.value===e}function IB(e){return 4===tB.type&&tB.value===e}function qB(){const e=[];for(Zz=tB.start,BB("[");!LB("]");)LB(",")?(DB(),e.push(null)):(e.push(eL()),LB("]")||BB(","));return DB(),function(e){const t=new Jz("ArrayExpression");return t.elements=e,t}(e)}function UB(){Zz=tB.start;const e=DB();return 8===e.type||6===e.type?(e.octal&&PB(e,oB),TB(e)):FB(e.value)}function VB(){var e,t,n;return Zz=tB.start,3===(e=tB).type?(n=UB(),BB(":"),RB("init",n,eL())):2!==e.type&&7!==e.type?(t=UB(),BB(":"),RB("init",t,eL())):void zB(e)}function WB(){var e,t,n=[],r={},i=String;for(Zz=tB.start,BB("{");!LB("}");)t="$"+((e=VB()).key.type===nB?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?PB({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),LB("}")||BB(",");return BB("}"),function(e){const t=new Jz("ObjectExpression");return t.properties=e,t}(n)}const HB={if:1};function GB(){var e,t,n;if(LB("("))return function(){BB("(");const e=tL();return BB(")"),e}();if(LB("["))return qB();if(LB("{"))return WB();if(e=tB.type,Zz=tB.start,3===e||HB[tB.value])n=FB(DB().value);else if(8===e||6===e)tB.octal&&PB(tB,oB),n=TB(DB());else{if(4===e)throw new Error(lB);1===e?((t=DB()).value="true"===t.value,n=TB(t)):5===e?((t=DB()).value=null,n=TB(t)):LB("/")||LB("/=")?(n=TB($B()),CB()):zB(DB())}return n}function XB(){const e=[];if(BB("("),!LB(")"))for(;Zz<eB&&(e.push(eL()),!LB(")"));)BB(",");return BB(")"),e}function YB(){return BB("."),function(){Zz=tB.start;const e=DB();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||zB(e),FB(e.value)}()}function JB(){BB("[");const e=tL();return BB("]"),e}function KB(){const e=function(){var e;for(e=GB();;)if(LB("."))e=NB(".",e,YB());else if(LB("("))e=jB(e,XB());else{if(!LB("["))break;e=NB("[",e,JB())}return e}();if(7===tB.type&&(LB("++")||LB("--")))throw new Error(lB);return e}function QB(){var e,t;if(7!==tB.type&&4!==tB.type)t=KB();else{if(LB("++")||LB("--"))throw new Error(lB);if(LB("+")||LB("-")||LB("~")||LB("!"))e=DB(),t=QB(),t=function(e,t){const n=new Jz("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(IB("delete")||IB("void")||IB("typeof"))throw new Error(lB);t=KB()}}return t}function ZB(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function eL(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=tB,l=QB(),0===(i=ZB(r=tB)))return l;for(r.prec=i,DB(),t=[e,tB],a=[l,r,o=QB()];(i=ZB(tB))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=MB(s,l,o),a.push(n);(r=DB()).prec=i,a.push(r),t.push(tB),n=QB(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=MB(a[u-1].value,a[u-2],n),u-=2;return n}(),LB("?")&&(DB(),t=eL(),BB(":"),e=function(e,t,n){const r=new Jz("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,eL())),e}function tL(){const e=eL();if(LB(","))throw new Error(lB);return e}function nL(e){Zz=0,eB=(Qz=e).length,tB=null,CB();const t=tL();if(2!==tB.type)throw new Error("Unexpect token after expression.");return t}var rL={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function iL(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&ou("Missing arguments to clamp function."),t.length>3&&ou("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),replace:t("replace",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&ou("Missing arguments to if function."),t.length>3&&ou("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}const aL="intersect",oL="union";var sL="index:unit";function lL(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=lu.getter||lu(r.field),uc(n=r.getter(e))&&(n=Ou(n)),uc(a[s])&&(a[s]=Ou(a[s])),uc(a[s][0])&&(a[s]=a[s].map(Ou)),"E"===r.type){if(yu(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!sc(n,a[s]))return!1}else if("R-RE"===r.type){if(!sc(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!sc(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!sc(n,a[s],!1,!0))return!1;return!0}var uL={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=Ou(t[0]),r=Ou(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Ou(t[0]),r=Ou(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function cL(e,t,n,r){t[0].type!==Bz&&ou("First argument to selection functions must be a string literal.");const i=t[0].value,a="unit",o="@unit",s=":"+i;(t.length>=2&&ku(t).value)!==aL||nc(r,o)||(r["@unit"]=n.getData(i).indataRef(n,a)),nc(r,s)||(r[s]=n.getData(i).tuplesRef())}function fL(e){const t=this.context.data[e];return t?t.values.value:[]}const dL=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},hL=dL("format"),pL=dL("timeFormat"),mL=dL("utcFormat"),gL=dL("timeParse"),yL=dL("utcParse"),vL=new Date(2e3,0,1);function bL(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(vL.setYear(2e3),vL.setMonth(e),vL.setDate(t),pL.call(this,vL,n)):""}function xL(e,t,n,r){t[0].type!==Bz&&ou("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!nc(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function wL(e,t,n,r){if(t[0].type===Bz)_L(n,r,t[0].value);else for(e in n.scales)_L(n,r,e)}function _L(e,t,n){const r="%"+n;if(!nc(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function kL(e,t){let n;return Vu(e)?e:hc(e)?(n=t.scales[e])&&n.value:void 0}function OL(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=wL,n._range=wL,n._scale=wL;const r=t=>"_["+(t.type===Bz?wc("%"+t.value):wc("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}function SL(e,t){return function(n,r,i){if(n){const t=kL(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const EL=SL("area",(function(e){return cM=new _f,HC(e,fM),2*cM})),$L=SL("bounds",(function(e){var t,n,r,i,a,o,s;if(tM=eM=-(QC=ZC=1/0),sM=[],HC(e,BM),n=sM.length){for(sM.sort(XM),t=1,a=[r=sM[0]];t<n;++t)YM(r,(i=sM[t])[0])||YM(r,i[1])?(GM(r[0],i[1])>GM(r[0],r[1])&&(r[1]=i[1]),GM(i[0],r[1])>GM(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=GM(r[1],i[0]))>o&&(o=s,QC=i[0],eM=r[1])}return sM=lM=null,QC===1/0||ZC===1/0?[[NaN,NaN],[NaN,NaN]]:[[QC,ZC],[eM,tM]]})),AL=SL("centroid",(function(e){kM=OM=SM=EM=$M=AM=DM=CM=0,MM=new _f,jM=new _f,FM=new _f,HC(e,JM);var t=+MM,n=+jM,r=+FM,i=MC(t,n,r);return i<vC&&(t=AM,n=DM,r=CM,OM<yC&&(t=SM,n=EM,r=$M),(i=MC(t,n,r))<vC)?[NaN,NaN]:[$C(n,t)*kC,BC(r/i)*kC]}));function DL(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function CL(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ML(e){const t=_x(e);return.2126*CL(t.r)+.7152*CL(t.g)+.0722*CL(t.b)}function jL(e,t){return e===t||e!=e&&t!=t||(yu(e)?!(!yu(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!jL(e[n],t[n]))return!1;return!0}(e,t):!(!vu(e)||!vu(t))&&FL(e,t))}function FL(e,t){for(const n in e)if(!jL(e[n],t[n]))return!1;return!0}function TL(e){return t=>FL(e,t)}const NL=e=>e.data;function RL(e,t){const n=fL.call(t,e);return n.root&&n.root.lookup||{}}const PL=()=>"undefined"!=typeof window&&window||null;const zL={random:()=>_g(),cumulativeNormal:Cg,cumulativeLogNormal:Rg,cumulativeUniform:qg,densityNormal:Dg,densityLogNormal:Ng,densityUniform:Ig,quantileNormal:Mg,quantileLogNormal:Pg,quantileUniform:Ug,sampleNormal:Ag,sampleLogNormal:Tg,sampleUniform:Lg,isArray:yu,isBoolean:lc,isDate:uc,isDefined:e=>void 0!==e,isNumber:fc,isObject:vu,isRegExp:dc,isString:hc,isTuple:Fm,isValid:e=>null!=e&&e==e,toBoolean:_c,toDate:Oc,toNumber:Ou,toString:Sc,flush:ac,lerp:mc,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),Qu(...e)},pad:bc,peek:ku,span:xc,inrange:sc,truncate:$c,rgb:_x,lab:Lx,hcl:Gx,hsl:Dx,luminance:ML,contrast:function(e,t){const n=ML(e),r=ML(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:Pf,format:hL,utcFormat:mL,utcParse:yL,utcOffset:wh,utcSequence:Oh,timeFormat:pL,timeParse:gL,timeOffset:xh,timeSequence:kh,timeUnitSpecifier:Hd,monthFormat:function(e){return bL.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return bL.call(this,e,1,"%b")},dayFormat:function(e){return bL.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return bL.call(this,0,2+e,"%a")},quarter:Lu,utcquarter:Iu,week:Jd,utcweek:nh,dayofyear:Yd,utcdayofyear:th,warn:function(){return DL(this.context.dataflow,"warn",arguments)},info:function(){return DL(this.context.dataflow,"info",arguments)},debug:function(){return DL(this.context.dataflow,"debug",arguments)},extent:Zu,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new JO).set(r[0],r[1],i[0],i[1]);return wA(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=qu(e.marktype),r=qu(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:Uu,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=PL();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=PL();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return z_(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(hu).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?bO(n,t=t||lO(e)):e}},panLinear:Mu,panLog:ju,panPow:Fu,panSymlog:Tu,zoomLinear:Ru,zoomLog:Pu,zoomPow:zu,zoomSymlog:Bu,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,f,d=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!d||d.stamp<u)&&(s.changes=d=o.changeset(),d.stamp=u,o.runAfter((()=>{s.modified=!0,o.pulse(l,d).run()}),!0,1)),n&&(c=!0===n?hu:yu(n)||Fm(n)?n:TL(n),d.remove(c)),t&&d.insert(t),r&&(c=TL(r),l.value.some(c)?d.remove(c):d.insert(r)),i)for(f in a)d.modify(i,f,a[f]);return 1}},BL=["view","item","group","xy","x","y"],LL="this.",IL={},qL={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(wc("$"+e),"]"),functions:function(e){const t=iL(e);BL.forEach((e=>t[e]="event.vega."+e));for(const e in zL)t[e]=LL+e;return Qu(t,OL(e,zL,IL)),t},constants:rL,visitors:IL},UL=function(e){const t=(e=e||{}).allowed?Ec(e.allowed):{},n=e.forbidden?Ec(e.forbidden):{},r=e.constants||rL,i=(e.functions||iL)(f),a=e.globalvar,o=e.fieldvar,s=Vu(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function f(e){if(hc(e))return e;const t=d[e.type];return null==t&&ou("Unsupported type: "+e.type),t(e)}const d={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:nc(n,i)?ou("Illegal identifier: "+i):nc(r,i)?r[i]:nc(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(c+=1);const r=f(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&ou("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=nc(i,t)&&i[t];return r||ou("Unrecognized function: "+t),Vu(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{c+=1;const t=f(e.key);return c-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return h.functions=i,h.constants=r,h}(qL);function VL(e,t,n){return 1===arguments.length?zL[e]:(zL[e]=t,n&&(IL[e]=n),UL&&(UL.functions[e]=LL+e),this)}function WL(e,t){const n={};let r;try{r=nL(e=hc(e)?e:wc(e)+"")}catch(t){ou("Expression parse error: "+e)}r.visit((e=>{if(e.type!==Vz)return;const r=e.callee.name,i=qL.visitors[r];i&&i(r,e.arguments,t,n)}));const i=UL(r);return i.globals.forEach((e=>{const r="$"+e;!nc(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:Qu({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}VL("bandwidth",(function(e,t){const n=kL(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),wL),VL("copy",(function(e,t){const n=kL(e,(t||this).context);return n?n.copy():void 0}),wL),VL("domain",(function(e,t){const n=kL(e,(t||this).context);return n?n.domain():[]}),wL),VL("range",(function(e,t){const n=kL(e,(t||this).context);return n&&n.range?n.range():[]}),wL),VL("invert",(function(e,t,n){const r=kL(e,(n||this).context);return r?yu(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),wL),VL("scale",(function(e,t,n){const r=kL(e,(n||this).context);return r?r(t):void 0}),wL),VL("gradient",(function(e,t,n,r,i){e=kL(e,(i||this).context);const a=rO(t,n);let o=e.domain(),s=o[0],l=ku(o),u=cu;return l-s?u=Ek(e,s,l):e=(e.interpolator?hk("sequential")().interpolator(e.interpolator()):hk("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==ku(o)&&o.push(l)),o.forEach((t=>a.stop(u(t),e(t)))),a}),wL),VL("geoArea",EL,wL),VL("geoBounds",$L,wL),VL("geoCentroid",AL,wL),VL("geoShape",(function(e,t,n){const r=kL(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),wL),VL("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==Bz&&ou("First argument to indata must be a string literal."),t[1].type!==Bz&&ou("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;nc(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),VL("data",fL,xL),VL("treePath",(function(e,t,n){const r=RL(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(NL):void 0}),xL),VL("treeAncestors",(function(e,t){const n=RL(e,this)[t];return n?n.ancestors().map(NL):void 0}),xL),VL("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[sL]&&l[sL].value:void 0,f=n===aL,d=u.length,h=0;h<d;++h)if(r=u[h],c&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=lL(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(f^(s=lL(t,r)))return s;return d&&f}),cL),VL("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,f,d,h,p=this.context.data[e],m=p?p.values.value:[],g={},y={},v={},b=m.length,x=0;x<b;++x){for(o=(r=m[x]).unit,i=r.fields,a=r.values,d=0,h=i.length;d<h;++d)s=i[d],u=(l=g[s.field]||(g[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),f=uL[c+"_union"],l[o]=f(u,qu(a[d]));n&&(u=y[o]||(y[o]=[])).push(qu(a).reduce(((e,t,n)=>(e[i[n].field]=t,e)),{}))}return t=t||oL,Object.keys(g).forEach((e=>{g[e]=Object.keys(g[e]).map((t=>g[e][t])).reduce(((n,r)=>void 0===n?r:uL[v[e]+"_"+t](n,r)))})),m=Object.keys(y),n&&m.length&&(g.vlMulti=t===oL?{or:m.reduce(((e,t)=>(e.push(...y[t]),e)),[])}:{and:m.map((e=>({or:y[e]})))}),g}),cL);const HL=Ec(["rule"]),GL=Ec(["group","image","rect"]);function XL(e){return(e+"").toLowerCase()}function YL(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var JL={operator:(e,t)=>YL(e,["_"],t.code),parameter:(e,t)=>YL(e,["datum","_"],t.code),event:(e,t)=>YL(e,["event"],t.code),handler:(e,t)=>YL(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+wc(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return HL[t]||(e.x2&&(e.x?(GL[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(GL[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",YL(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(wc).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function KL(e,t,n){if(!e||!vu(e))return e;for(let r,i=0,a=QL.length;i<a;++i)if(r=QL[i],nc(e,r.key))return r.parse(e,t,n);return e}var QL=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||ou("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=pc(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=eu(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=lu(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=eu(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=qu(e.$compare).map((e=>e&&e.$tupleid?Tm:e));return t.fn[n]||(t.fn[n]=Wu(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return Tm}}];const ZL={skip:!0};function eI(e,t,n,r){return new tI(e,t,n,r)}function tI(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||JL,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function nI(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function rI(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}tI.prototype=nI.prototype={fork(){const e=new nI(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(e){return"collect"===XL(e)}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[XL(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;!function(e){return"operator"===XL(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||ou("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=yu(i)?i.map((e=>KL(e,n,t))):KL(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&ou("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=vu(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||ou("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],ZL)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(hu).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const iI="default";function aI(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function oI(e,t){var n=e._runtime.data;return nc(n,t)||ou("Unrecognized data set: "+t),n[t]}function sI(e,t){Im(t)||ou("Second argument to changes must be a changeset.");const n=oI(this,e);return n.modified=!0,this.pulse(n.input,t)}function lI(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function uI(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function cI(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function fI(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=cI(e),(r=o$(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;hc(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:Ju(e),item:Ju(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}const dI="view",hI={trap:!1};function pI(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||vu(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function mI(e){return e.item}function gI(e){return e.item.mark.source}function yI(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function vI(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}const bI="vega-bind",xI="vega-bind-name";function wI(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=Ku(r.debounce,i.update))),function(e,t,n,r){const i=vI("div",{class:bI}),a="radio"===n.input?i:i.appendChild(vI("label"));a.appendChild(vI("span",{class:xI},n.name||n.signal)),t.appendChild(i);let o=_I;switch(n.input){case"checkbox":o=kI;break;case"select":o=OI;break;case"radio":o=SI;break;case"range":o=EI}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0),i}function _I(e,t,n,r){const i=vI("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function kI(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=vI("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function OI(e,t,n,r){const i=vI("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};$I(e,r)&&(n.selected=!0),i.appendChild(vI("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if($I(n.options[t],e))return void(i.selectedIndex=t)}}function SI(e,t,n,r){const i=vI("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,o)=>{const s={type:"radio",name:n.signal,value:t};$I(t,r)&&(s.checked=!0);const l=vI("input",s);l.addEventListener("change",(()=>e.update(t)));const u=vI("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)$I(n[e].value,t)&&(n[e].checked=!0)}}function EI(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Af(a,i,100),s=vI("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=vI("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function $I(e,t){return e===t||e+""==t+""}function AI(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,lI(e),uI(e),cI(e),i,a).background(e.background())}function DI(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function CI(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const MI=e=>+e||0;function jI(e){return vu(e)?{top:MI(e.top),bottom:MI(e.bottom),left:MI(e.left),right:MI(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(MI(e))}async function FI(e,t,n,r){const i=xA(t),a=i&&i.headless;return a||ou("Unrecognized renderer type: "+t),await e.runAsync(),AI(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var TI="width",NI="height",RI="padding",PI={skip:!0};function zI(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===RI?r.left+r.right:0)}function BI(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===RI?r.top+r.bottom:0)}function LI(e,t){return t.modified&&yu(t.input.value)&&e.indexOf("_:vega:_")}function II(e,t){return!("parent"===e||t instanceof pg.proxy)}function qI(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":yu(e)?UI(e):vu(e)&&!uc(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(yu(n)?UI(n):VI(n))})).join("\n")):e+"";var t}(r))}function UI(e){return"["+e.map(VI).join(", ")+"]"}function VI(e){return yu(e)?"[…]":vu(e)&&!uc(e)?"{…}":e}function WI(e,t){const n=this;if(t=t||{},fg.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=Qu({},e.locale,t.locale);n.locale(Sm(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||vA.Canvas,n._scenegraph=new ZE;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||qI,n._redraw=!0,n._handler=(new S$).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=Qu({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{yu(e[t])&&(e[t]=Ec(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return eI(e,pg,zL,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:Qu({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=zI(n,n._width),n._viewHeight=BI(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=zI(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=BI(e,t.size),a()}),{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:iI,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?hc(r)?r:r.user:iI,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return hc(n)||(r=n.item,n=n.user),aI(e,n&&n!==iI?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function HI(e,t){return nc(e._signals,t)?e._signals[t]:ou("Unrecognized signal name: "+wc(t))}function GI(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function XI(e,t,n,r){let i=GI(n,r);return i||(i=DI(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function YI(e,t,n){const r=GI(t,n);return r&&t._targets.remove(r),e}oc(WI,fg,{async evaluate(e,t,n){if(await fg.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(e){var t=cI(e),n=lI(e),r=uI(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach((t=>{try{t(n,r)}catch(t){e.error(t)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}return n&&Cm(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&rI(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=HI(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",jI(e)):jI(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(xA(e)||ou("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(fg.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(HI(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(TI,n,PI),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(NI,r,PI),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=DI(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return XI(this,e,HI(this,e),t)},removeSignalListener(e,t){return YI(this,HI(this,e),t)},addDataListener(e,t){return XI(this,e,oI(this,e).values,t)},removeDataListener(e,t){return YI(this,oI(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=aI(this,null);this._globalCursor=!!e,t&&aI(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new RN,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?TN():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new Jm(n),o=function(n,r){i.runAsync(null,(()=>{e===dI&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(fI(i,n,r))}))};if("timer"===e)pI(i,"timer",t)&&i.timer(o,t);else if(e===dI)pI(i,"view",t)&&i.addEventListener(t,o,hI);else if("window"===e?pI(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&pI(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",mI),gI,yI(e)),this.on(this.events("view","mouseout",mI),gI,yI(t)),this},data:function(e,t){return arguments.length<2?oI(this,e).values.value:sI.call(this,e,qm().remove(hu).insert(t))},change:sI,insert:function(e,t){return sI.call(this,e,qm().insert(t))},remove:function(e,t){return sI.call(this,e,qm().remove(t))},scale:function(e){var t=this._runtime.scales;return nc(t,e)||ou("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=xA(r);e=n._el=e?CI(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),rI(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||S$,s=e?a.renderer:a.headless;return n._renderer=s?AI(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),DI(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,cI(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=CI(n,t):e.appendChild(vI("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=CI(n,e.param.element))})),n._bind.forEach((e=>{wI(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==vA.Canvas&&e!==vA.SVG&&e!==vA.PNG&&ou("Unrecognized image type: "+e);const n=await FI(this,e,t);return e===vA.SVG?function(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await FI(this,vA.Canvas,e,t)).canvas()},toSVG:async function(e){return(await FI(this,vA.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:LI,signals:II,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const JI="[",KI="]",QI=/[[\]{}]/,ZI={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let eq,tq;function nq(e,t,n){return eq=t||"view",tq=n||ZI,iq(e.trim()).map(aq)}function rq(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function iq(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=rq(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function aq(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=rq(e,r,KI,JI,KI),r===t)throw"Empty between selector: "+e;if(n=iq(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(aq);const i=aq(e.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(e):function(e){const t={source:eq},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(u+1,l-1))}catch(t){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;"@"===e[0]&&(o=++u);r=rq(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r);if(u=rq(e,u,JI),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=rq(e,u,KI),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&e[++u]!==JI)throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||QI.test(n[l-1]))throw"Invalid event selector: "+e;l>1?(t.type=n[1],o?t.markname=n[0].slice(1):!function(e){return tq[e]}(n[0])?t.source=n[0]:t.marktype=n[0]):t.type=n[0];"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1));null!=i&&(t.filter=i);a[0]&&(t.throttle=a[0]);a[1]&&(t.debounce=a[1]);return t}(e)}function oq(e){return vu(e)?e:{type:e||"pad"}}const sq=e=>+e||0;function lq(e){return vu(e)?e.signal?e:{top:sq(e.top),bottom:sq(e.bottom),left:sq(e.left),right:sq(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(sq(e))}const uq=e=>vu(e)&&!yu(e)?Qu({},e):{value:e};function cq(e,t,n,r){if(null!=n){return vu(n)&&!yu(n)||yu(n)&&n.length&&vu(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1}return 0}function fq(e,t,n){for(const n in t)cq(e,n,t[n]);for(const t in n)cq(e,t,n[t],"update")}function dq(e,t,n){for(const r in t)n&&nc(n,r)||(e[r]=Qu(e[r]||{},t[r]));return e}function hq(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const pq="mark",mq="frame",gq="scope",yq="legend-label",vq="title-text",bq="title-subtitle";function xq(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const wq=e=>hc(e)?wc(e):e.signal?"(".concat(e.signal,")"):Sq(e);function _q(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:wc(e)));for(;t.length&&null==ku(t);)t.pop();return t.unshift(wq(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?kq("hcl",e.h,e.c,e.l):e.h||e.s?kq("hsl",e.h,e.s,e.l):e.l||e.a?kq("lab",e.l,e.a,e.b):e.r||e.g||e.b?kq("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?Sq(e.field):void 0!==e.value?wc(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=wq(e.scale);null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+Oq(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0"));return t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(Oq(e.exponent),")")),null!=e.mult&&(t+="*".concat(Oq(e.mult))),null!=e.offset&&(t+="+".concat(Oq(e.offset))),e.round&&(t="round(".concat(t,")")),t}const kq=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(_q).join(","),")+'')");function Oq(e){return vu(e)?"("+_q(e)+")":e}function Sq(e){return Eq(vu(e)?e:{datum:e})}function Eq(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):ou("Invalid field reference: "+wc(e));return e.signal||(r=hc(r)?su(r).map(wc).join("]["):Eq(r)),t+"["+r+"]"}function $q(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||hq(l,e)||xq(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===mq?i.group:n===pq?Qu({},i.mark,i[t]):null,c)u=hq(l,e)||("fill"===l||"stroke"===l)&&(hq("fill",e)||hq("stroke",e)),u||xq(a,l,c[l]);for(l in qu(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)hq(t,e)||xq(a,t,n[t])})),e=Qu({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=Qu(o,e.enter),s&&(e.update=Qu(s,e.update)),e}(e,t,n,r,i.config);for(const n in e)o[n]=Aq(e[n],t,a,i);return a}function Aq(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=Dq((o=e[t],yu(o)?function(e){let t="";return e.forEach((e=>{const n=_q(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n})),":"===ku(t)&&(t+="null"),t}(o):_q(o)),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function Dq(e,t,n,r){const i=WL(e,t);return i.$fields.forEach((e=>r[e]=1)),Qu(n,i.$params),i.$expr}const Cq=["value","update","init","react","bind"];function Mq(e,t){ou(e+' for "outer" push: '+wc(t))}function jq(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||Mq("No prior signal definition",n),Cq.forEach((t=>{void 0!==e[t]&&Mq("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Fq(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Tq(e,t,n,r){return new Fq(e,t,n,r)}function Nq(e,t){return Tq("operator",e,t)}function Rq(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function Pq(e,t){return t?{$field:e,$name:t}:{$field:e}}const zq=Pq("key");function Bq(e,t){return{$compare:e,$order:t}}function Lq(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const Iq="scope",qq="view";function Uq(e){return e&&e.signal}function Vq(e){if(Uq(e))return!0;if(vu(e))for(const t in e)if(Vq(e[t]))return!0;return!1}function Wq(e,t){return null!=e?e:t}function Hq(e){return e&&e.signal||e}const Gq="timer";function Xq(e,t){return(e.merge?Yq:e.stream?Jq:e.type?Kq:ou("Invalid stream specification: "+wc(e)))(e,t)}function Yq(e,t){const n=Qq({merge:e.merge.map((e=>Xq(e,t)))},e,t);return t.addStream(n).id}function Jq(e,t){const n=Qq({stream:Xq(e.stream,t)},e,t);return t.addStream(n).id}function Kq(e,t){let n;e.type===Gq?(n=t.event(Gq,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===Iq?qq:e||qq}(e.source),e.type);const r=Qq({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function Qq(e,t,n){let r=t.between;return r&&(2!==r.length&&ou('Stream "between" parameter must have 2 entries: '+wc(t)),e.between=[Xq(r[0],n),Xq(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===Iq&&r.push("inScope(event.item)"),r.length&&(e.filter=WL("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const Zq={code:"_.$value",ast:{type:"Identifier",value:"value"}};function eU(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||ou("Signal update missing events specification."),hc(a)&&(a=nq(a,t.isSubscope()?Iq:qq)),a=qu(a).filter((e=>e.signal||e.scale?(s.push(e),0):1)),s.length>1&&(s=[tU(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&ou("Signal encode and update are mutually exclusive."),o="encode(item(),"+wc(r)+")"),i.update=hc(o)?WL(o,t):null!=o.expr?WL(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:Zq,$params:{$value:t.signalRef(o.signal)}}:ou("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((e=>t.addUpdate(Qu(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):Xq(e,t)}}(e,t),i))))}function tU(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const nU=e=>(t,n,r)=>Tq(e,n,t||void 0,r),rU=nU("aggregate"),iU=nU("axisticks"),aU=nU("bound"),oU=nU("collect"),sU=nU("compare"),lU=nU("datajoin"),uU=nU("encode"),cU=nU("expression"),fU=nU("facet"),dU=nU("field"),hU=nU("key"),pU=nU("legendentries"),mU=nU("load"),gU=nU("mark"),yU=nU("multiextent"),vU=nU("multivalues"),bU=nU("overlap"),xU=nU("params"),wU=nU("prefacet"),_U=nU("projection"),kU=nU("proxy"),OU=nU("relay"),SU=nU("render"),EU=nU("scale"),$U=nU("sieve"),AU=nU("sortitems"),DU=nU("viewlayout"),CU=nU("values");let MU=0;const jU={min:"min",max:"max",count:"sum"};function FU(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=PU(e.domain,e,t),null!=e.range&&(n.range=WU(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=TU(e.type||e),null!=e.gamma&&(t.interpolateGamma=TU(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return vu(e)?{interval:TU(e.interval),step:TU(e.step)}:TU(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||yu(e)?NU(e,t):t.objectProperty(e)}(e.bins,t)),e)nc(n,r)||"name"===r||(n[r]=TU(e[r],t))}function TU(e,t){return vu(e)?e.signal?t.signalRef(e.signal):ou("Unsupported object: "+wc(e)):e}function NU(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>TU(e,t)))}function RU(e){ou("Can not find data set: "+wc(e))}function PU(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(yu(e)?zU:e.fields?LU:BU)(e,t,n);null==t.domainMin&&null==t.domainMax||ou("No scale domain defined for domainMin/domainMax to override.")}function zU(e,t,n){return e.map((e=>TU(e,n)))}function BU(e,t,n){const r=n.getData(e.data);return r||RU(e.data),yk(t.type)?r.valuesRef(n,e.field,qU(e.sort,!1)):wk(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function LU(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=hc(t)?{data:r,field:t}:yu(t)||t.signal?function(e,t){const n="_:vega:_"+MU++,r=oU({});if(yu(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+wc(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,$U({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(yk(t.type)?IU:wk(t.type)?UU:VU)(e,n,i)}function IU(e,t,n){const r=qU(e.sort,!0);let i,a;const o=n.map((e=>{const n=t.getData(e.data);return n||RU(e.data),n.countsRef(t,e.field,r)})),s={groupby:zq,pulse:o};r&&(i=r.op||"count",a=r.field?Lq(i,r.field):"count",s.ops=[jU[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(rU(s));const l=t.add(oU({pulse:Rq(i)}));return a=t.add(CU({field:zq,sort:t.sortRef(r),pulse:Rq(l)})),Rq(a)}function qU(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!jU[e.op]&&ou("Multiple domain scales can not be sorted using "+e.op):ou("No field provided for sort aggregate op: "+e.op):vu(e)?e.field="key":e={field:"key"}),e}function UU(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||RU(e.data),n.domainRef(t,e.field)}));return Rq(t.add(vU({values:r})))}function VU(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||RU(e.data),n.extentRef(t,e.field)}));return Rq(t.add(yU({extents:r})))}function WU(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(hc(i)){if(r&&nc(r,i))return WU(e=Qu({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=yk(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:ou("Unrecognized scale range value: "+wc(i))}else{if(i.scheme)return n.scheme=yu(i.scheme)?NU(i.scheme,t):TU(i.scheme,t),i.extent&&(n.schemeExtent=NU(i.extent,t)),void(i.count&&(n.schemeCount=TU(i.count,t)));if(i.step)return void(n.rangeStep=TU(i.step,t));if(yk(e.type)&&!yu(i))return PU(i,e,t);yu(i)||ou("Unsupported range type: "+wc(i))}return i.map((e=>(yu(e)?NU:TU)(e,t)))}function HU(e,t,n){return yu(e)?e.map((e=>HU(e,t,n))):vu(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:ou("Unsupported parameter object: "+wc(e)):e}const GU="top",XU="left",YU="right",JU="bottom",KU="center",QU="index",ZU="label",eV="perc",tV="value",nV="guide-label",rV="guide-title",iV="group-title",aV="group-subtitle",oV="symbol",sV="gradient",lV="discrete",uV="size",cV=[uV,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],fV={name:1,style:1,interactive:1},dV={value:0},hV={value:1},pV="group",mV="rect",gV="rule",yV="text";function vV(e){return e.type=pV,e.interactive=e.interactive||!1,e}function bV(e,t){const n=(n,r)=>Wq(e[n],Wq(t[n],r));return n.isVertical=n=>"vertical"===Wq(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>Wq(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>Wq(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>Wq(e.columns,Wq(t.columns,+n.isVertical(!0))),n}function xV(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function wV(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const _V=wV(wc(XU),wc(YU),wc(KU));function kV(e,t){return t?e?vu(e)?Object.assign({},e,{offset:kV(e.offset,t)}):{value:e,offset:t}:t:e}function OV(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=dq(e.encode,t,fV)):e.interactive=!1,e}function SV(e,t,n,r){const i=bV(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,f,d;a?(u=[0,1],c=[0,0],f=o,d=s):(u=[0,0],c=[1,0],f=s,d=o);const h={enter:l={opacity:dV,x:dV,y:dV,width:uq(f),height:uq(d)},update:Qu({},l,{opacity:hV,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:dV}};return fq(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),OV({type:mV,role:"legend-gradient",encode:h},r)}function EV(e,t,n,r,i){const a=bV(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,f,d,h="";o?(u="y",f="y2",c="x",d="width",h="1-"):(u="x",f="x2",c="y",d="height");const p={opacity:dV,fill:{scale:t,field:tV}};p[u]={signal:h+"datum."+eV,mult:l},p[c]=dV,p[f]={signal:h+"datum.perc2",mult:l},p[d]=uq(s);const m={enter:p,update:Qu({},p,{opacity:hV}),exit:{opacity:dV}};return fq(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),OV({type:mV,role:"legend-band",key:tV,from:i,encode:m},r)}const $V="datum.".concat(eV,'<=0?"').concat(XU,'":datum.').concat(eV,'>=1?"').concat(YU,'":"').concat(KU,'"'),AV="datum.".concat(eV,'<=0?"').concat(JU,'":datum.').concat(eV,'>=1?"').concat(GU,'":"').concat("middle",'"');function DV(e,t,n,r){const i=bV(e,t),a=i.isVertical(),o=uq(i.gradientThickness()),s=i.gradientLength();let l,u,c,f,d=i("labelOverlap"),h="";const p={enter:l={opacity:dV},update:u={opacity:hV,text:{field:ZU}},exit:{opacity:dV}};return fq(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:Wq(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:AV},c="y",f="x",h="1-"):(l.align=u.align={signal:$V},l.baseline={value:"top"},c="x",f="y"),l[c]=u[c]={signal:h+"datum."+eV,mult:s},l[f]=u[f]=o,o.offset=Wq(e.labelOffset,t.gradientLabelOffset)||0,d=d?{separation:i("labelSeparation"),method:d,order:"datum.index"}:void 0,OV({type:yV,role:yq,style:nV,key:tV,from:r,encode:p,overlap:d},n)}function CV(e,t,n,r,i){const a=bV(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(uV),h=u?uq(u):{field:uV},p="datum.".concat(QU),m="max(1, ".concat(i,")");let g,y,v,b,x;h.mult=.5,g={enter:y={opacity:dV,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:hV,x:y.x,y:y.y},exit:{opacity:dV}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),fq(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),cV.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:tV})}));const k=OV({type:"symbol",role:"legend-symbol",key:tV,from:f,clip:!!u||void 0,encode:g},n.symbols),O=uq(c);O.offset=a("labelOffset"),g={enter:y={opacity:dV,x:{signal:d,offset:O},y:h},update:v={opacity:hV,text:{field:ZU},x:y.x,y:y.y},exit:{opacity:dV}},fq(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const S=OV({type:yV,role:yq,style:nV,key:tV,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:dV,height:u?uq(u):dV,opacity:dV},exit:{opacity:dV},update:v={opacity:hV,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(m,")"),v.column.signal="".concat(p," % ").concat(m),x={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),vV({role:gq,from:r={facet:{data:r,name:"value",groupby:QU}},encode:dq(g,o,fV),marks:[k,S],name:l,interactive:s,sort:x})}const MV='item.orient === "left"',jV='item.orient === "right"',FV="(".concat(MV," || ").concat(jV,")"),TV="datum.vgrad && ".concat(FV),NV=wV('"top"','"bottom"','"middle"'),RV=wV('"right"','"left"','"center"'),PV="datum.vgrad && ".concat(jV," ? (").concat(RV,") : (").concat(FV," && !(datum.vgrad && ").concat(MV,')) ? "left" : ').concat(_V),zV="item._anchor || (".concat(FV,' ? "middle" : "start")'),BV="".concat(TV," ? (").concat(MV," ? -90 : 90) : 0"),LV="".concat(FV," ? (datum.vgrad ? (").concat(jV,' ? "bottom" : "top") : ').concat(NV,') : "top"');function IV(e,t){let n;return vu(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+qV(e.path)+")":e.sphere&&(n="geoShape("+qV(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function qV(e){return vu(e)&&e.signal?e.signal:wc(e)}function UV(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===pV?gq:t||pq:t}function VV(e){return{marktype:e.type,name:e.name||void 0,role:e.role||UV(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function WV(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function HV(e,t){const n=mg(e.type);n||ou("Unrecognized transform type: "+wc(e.type));const r=Tq(n.type.toLowerCase(),null,GV(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function GV(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=XV(i,t,n)}return r}function XV(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){hc(t.from)||ou('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(yu(r)||ou("Expected an array of sub-parameters. Instead: "+wc(r)),r.map((t=>JV(e,t,n)))):JV(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!Uq(i)?i.map((t=>YV(e,t,n))):YV(e,i,n):void(e.required&&ou("Missing required "+wc(t.type)+" parameter: "+wc(e.name)))}function YV(e,t,n){const r=e.type;if(Uq(t))return eW(r)?ou("Expression references can not be signals."):tW(r)?n.fieldRef(t):nW(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||tW(r);return i&&KV(t)?n.exprRef(t.expr,t.as):i&&QV(t)?Pq(t.field,t.as):eW(r)?WL(t,n):ZV(r)?Rq(n.getData(t).values):tW(r)?Pq(t):nW(r)?n.compareRef(t):t}}function JV(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||ou("Unsupported parameter: "+wc(t));const a=Qu(GV(i,t,n),i.key);return Rq(n.add(xU(a)))}const KV=e=>e&&e.expr,QV=e=>e&&e.field,ZV=e=>"data"===e,eW=e=>"expr"===e,tW=e=>"field"===e,nW=e=>"compare"===e;function rW(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Rq(t.getData(e.data).output)}function iW(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function aW(e){return hc(e)?e:null}function oW(e,t,n){const r=Lq(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function sW(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return vu(e)?("descending"===e.order?"-":"+")+Lq(e.op,e.field):""}(a);let u,c,f=aW(i);if(null!=f&&(e=t.scope,f+=l?"|"+l:"",u=s[f]),!u){const n=a?{field:zq,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:Rq(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(Tq(r,void 0,n)),o&&(t.index[i]=c),u=Rq(c),null!=f&&(s[f]=u)}return u}function lW(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(Nq()),u=WL("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function uW(e,t){const n=UV(e),r=e.type===pV,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,f,d,h=e.layout||n===gq||n===mq;const p=n===pq||h||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||ou("Only group marks can be faceted."),null!=r.field?o=s=rW(r,n):(e.data?s=Rq(n.getData(e.data).aggregate):(a=HV(Qu({type:"aggregate",groupby:qu(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=rW(r,n),o=s=Rq(n.add(a))),i=n.keyRef(r.groupby,!0))):o=Rq(n.add(oU(null,[{}]))),o||(o=rW(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(lU({key:m.key||(e.key?Pq(e.key):void 0),pulse:m.pulse,clean:!r}));const g=Rq(s);s=l=t.add(oU({pulse:g})),s=t.add(gU({markdef:VV(e),interactive:WV(e.interactive,t),clip:IV(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Rq(s)}));const y=Rq(s);s=u=t.add(uU($q(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=HV(e,t),r=n.metadata;(r.generates||r.changes)&&ou("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=Rq(s),t.add(s=n)})),e.sort&&(s=t.add(AU({sort:t.compareRef(e.sort),pulse:Rq(s)})));const v=Rq(s);(i||h)&&(h=t.add(DU({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),f=Rq(h));const b=t.add(aU({mark:y,pulse:f||v}));d=Rq(b),r&&(p&&(o=t.operators,o.pop(),h&&o.pop()),t.pushState(v,f||d,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=rW(r,t);let o;r.name||ou("Facet must have a name: "+wc(r)),r.data||ou("Facet must reference a data set: "+wc(r)),r.field?o=t.add(wU({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(fU({key:t.keyRef(r.groupby),group:Rq(t.proxy(n.parent)),pulse:a})):ou("Facet must specify groupby or field: "+wc(r));const s=t.fork(),l=s.add(oU()),u=s.add($U({pulse:Rq(l)}));s.addData(i,new iW(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(wU({pulse:n.pulse})),i=t.fork();i.add($U()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(h&&o.push(h),o.push(b))),a&&(d=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:Uq(a)?n.signalRef(a.signal):a,method:Uq(r)?n.signalRef(r.signal):r,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(i){const e=i.tolerance;o.boundTolerance=Uq(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return Rq(n.add(bU(o)))}(a,d,t));const x=t.add(SU({pulse:d})),w=t.add($U({pulse:Rq(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new iW(t,l,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&ou("Marks only support modify triggers."),lW(e,t,c)})))}function cW(e,t){const n=t.config.legend,r=e.encode||{},i=bV(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,f,d,h=0;cV.forEach((t=>e[t]?(u[t]=e[t],h=h||e[t]):0)),h||ou("Missing valid scale for legend.");const p=function(e,t){let n=e.type||oV;e.type||1!==function(e){return cV.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=gk(t)?sV:vk(t)?lV:oV);return n!==sV?n:vk(t)?lV:sV}(e,t.scaleType(h)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=Rq(t.add(oU(null,[m]))),y=Rq(t.add(pU(f={type:p,scale:t.scaleRef(h),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===sV?(d=[SV(e,h,n,r.gradient),DV(e,n,r.labels,y)],f.count=f.count||t.signalRef("max(2,2*floor((".concat(Hq(i.gradientLength()),")/100))"))):p===lV?d=[EV(e,h,n,r.gradient,y),DV(e,n,r.labels,y)]:(c=function(e,t){const n=bV(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),d=[CV(e,n,r,y,Hq(c.columns))],f.size=function(e,t,n){const r=Hq(dW("size",e,n)),i=Hq(dW("strokeWidth",e,n)),a=Hq(function(e,t,n){return xV("fontSize",e)||function(e,t,n){const r=t.config.style[n];return r&&r[e]}("fontSize",t,n)}(n[1].encode,t,nV));return WL("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,d[0].marks)),d=[vV({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:c,interactive:s})],m.title&&d.push(function(e,t,n,r){const i=bV(e,t),a={enter:{opacity:dV},update:{opacity:hV,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:dV}};return fq(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:zV},angle:{signal:BV},align:{signal:PV},baseline:{signal:LV},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),OV({type:yV,role:"legend-title",style:rV,from:r,encode:a},n)}(e,n,r.title,g)),uW(vV({role:"legend",from:g,encode:dq(fW(i,e,n),a,fV),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}function fW(e,t,n){const r={enter:{},update:{}};return fq(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function dW(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):xV(e,n[0].encode)}iW.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=Rq(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new iW(e,a,i,r,o)},iW.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=aW(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&oW(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:Rq(r.output)},n&&n.field&&oW(e,l,n),s=e.add(rU(l)),o=e.add(oU({pulse:Rq(s)})),o={agg:s,ref:Rq(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return Rq(this.values)},extentRef(e,t){return sW(e,this,"extent","extent",t,!1)},domainRef(e,t){return sW(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return sW(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return sW(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return sW(e,this,"indata","tupleindex",t,!0,!0)}};const hW='item.orient==="'.concat(XU,'"?-90:item.orient==="').concat(YU,'"?90:0');function pW(e,t){const n=bV(e=hc(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=Rq(t.add(oU(null,[{}])));return l.push(function(e,t,n,r){const i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return fq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),OV({type:yV,role:vq,style:iV,from:r,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||Qu({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return fq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),OV({type:yV,role:bq,style:aV,from:r,encode:o},n)}(e,n,r.subtitle,u)),uW(vV({role:"title",from:u,encode:mW(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function mW(e,t){const n={enter:{},update:{}};return fq(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:_V},angle:{signal:hW},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),dq(n,t,fV)}function gW(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(HV(e,t))})),e.on&&e.on.forEach((n=>{lW(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,f=!1;e.values?Vq(e.values)||Vq(e.format)?(r.push(vW(t,e)),r.push(u=yW())):r.push(u=yW({$ingest:e.values,$format:e.format})):e.url?Vq(e.url)||Vq(e.format)?(r.push(vW(t,e)),r.push(u=yW())):r.push(u=yW({$request:e.url,$format:e.format})):e.source&&(u=i=qu(e.source).map((e=>Rq(t.getData(e).output))),r.push(null));for(a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=yW()),r.push(s),l.generates&&(f=!0),l.modifies&&!f&&(c=!0),l.source?u=s:l.changes&&(u=null);i&&(o=i.length-1,r[0]=OU({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,yW()));u||r.push(yW());return r.push($U({})),r}(e,t,n))}function yW(e){const t=oU({},e);return t.metadata={source:!0},t}function vW(e,t){return mU({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const bW=e=>e===JU||e===GU,xW=(e,t,n)=>Uq(e)?EW(e.signal,t,n):e===XU||e===GU?t:n,wW=(e,t,n)=>Uq(e)?OW(e.signal,t,n):bW(e)?t:n,_W=(e,t,n)=>Uq(e)?SW(e.signal,t,n):bW(e)?n:t,kW=(e,t,n)=>Uq(e)?$W(e.signal,t,n):e===GU?{value:t}:{value:n},OW=(e,t,n)=>DW("".concat(e," === '").concat(GU,"' || ").concat(e," === '").concat(JU,"'"),t,n),SW=(e,t,n)=>DW("".concat(e," !== '").concat(GU,"' && ").concat(e," !== '").concat(JU,"'"),t,n),EW=(e,t,n)=>MW("".concat(e," === '").concat(XU,"' || ").concat(e," === '").concat(GU,"'"),t,n),$W=(e,t,n)=>MW("".concat(e," === '").concat(GU,"'"),t,n),AW=(e,t,n)=>MW("".concat(e," === '").concat(YU,"'"),t,n),DW=(e,t,n)=>(t=null!=t?uq(t):t,n=null!=n?uq(n):n,CW(t)&&CW(n)?(t=t?t.signal||wc(t.value):null,n=n?n.signal||wc(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[Qu({test:e},t)].concat(n||[])),CW=e=>null==e||1===Object.keys(e).length,MW=(e,t,n)=>({signal:"".concat(e," ? (").concat(FW(t),") : (").concat(FW(n),")")}),jW=(e,t,n,r,i)=>({signal:(null!=r?"".concat(e," === '").concat(XU,"' ? (").concat(FW(r),") : "):"")+(null!=n?"".concat(e," === '").concat(JU,"' ? (").concat(FW(n),") : "):"")+(null!=i?"".concat(e," === '").concat(YU,"' ? (").concat(FW(i),") : "):"")+(null!=t?"".concat(e," === '").concat(GU,"' ? (").concat(FW(t),") : "):"")+"(null)"}),FW=e=>Uq(e)?e.signal:null==e?null:wc(e),TW=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function NW(e,t,n,r){let i;if(t&&nc(t,e))return t[e];if(nc(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function RW(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function PW(e,t){return{scale:e.scale,range:t}}function zW(e,t,n,r,i){const a=bV(e,t),o=e.orient,s=e.gridScale,l=xW(o,1,-1),u=function(e,t){if(1===t);else if(vu(e)){let n=e=Qu({},e);for(;null!=n.mult;){if(!vu(n.mult))return n.mult=Uq(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=Qu({},n.mult)}n.mult=t}else e=Uq(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,f,d;const h={enter:c={opacity:dV},update:d={opacity:hV},exit:f={opacity:dV}};fq(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:tV,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=wW(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:Qu(m,{mult:l,offset:u});return c.x=d.x=wW(o,p,g),c.y=d.y=_W(o,p,g),c.x2=d.x2=_W(o,y),c.y2=d.y2=wW(o,y),f.x=wW(o,p),f.y=_W(o,p),OV({type:gV,role:"axis-grid",key:tV,from:r,encode:h},n)}function BW(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function LW(e,t,n,r,i,a){const o=bV(e,t),s=e.orient,l=e.scale,u=xW(s,-1,1),c=Hq(o("labelFlush")),f=Hq(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p,m=0===c||!!c;const g=uq(i);g.mult=u,g.offset=uq(o("labelPadding")||0),g.offset.mult=u;const y={scale:l,field:tV,band:.5,offset:kV(a.offset,o("labelOffset"))},v=wW(s,m?BW(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>Uq(e)?AW(e.signal,t,n):e===YU?{value:t}:{value:n})(s,"left","right")),b=wW(s,kW(s,"bottom","top"),m?BW(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=BW(l,c,"-(".concat(f,")"),f,0);m=m&&f;const w={opacity:dV,x:wW(s,y,g),y:_W(s,y,g)},_={enter:w,update:p={opacity:hV,text:{field:ZU},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:dV,x:w.x,y:w.y}};fq(_,{dx:!d&&m?wW(s,x):null,dy:!h&&m?_W(s,x):null}),fq(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const k=o("labelBound");let O=o("labelOverlap");return O=O||k?{separation:o("labelSeparation"),method:O,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=TW(p.align,v)),p.baseline!==b&&(p.baseline=TW(p.baseline,b)),OV({type:yV,role:"axis-label",style:nV,key:tV,from:r,encode:_,overlap:O},n)}function IW(e,t,n,r){const i=bV(e,t),a=e.orient,o=xW(a,-1,1);let s,l;const u={enter:s={opacity:dV,anchor:uq(i("titleAnchor",null)),align:{signal:_V}},update:l=Qu({},s,{opacity:hV,text:uq(e.title)}),exit:{opacity:dV}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(wV(0,1,.5),")")};return l.x=wW(a,c),l.y=_W(a,c),s.angle=wW(a,dV,((e,t)=>0===t?0:Uq(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t})(o,90)),s.baseline=wW(a,kW(a,JU,GU),{value:JU}),l.angle=s.angle,l.baseline=s.baseline,fq(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=TW(uq(e),n.update[t]),!1):!hq(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?uq(o):wW(t,uq(o),uq(a))}(i,a,u,n),u.update.align=TW(u.update.align,s.align),u.update.angle=TW(u.update.angle,s.angle),u.update.baseline=TW(u.update.baseline,s.baseline),OV({type:yV,role:"axis-title",style:rV,from:r,encode:u},n)}function qW(e,t){const n=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,l="band"===t.scaleType(e.scale)&&a.axisBand,u=e.orient;if(Uq(u)){const e=RW([a.axisX,a.axisY]),t=RW([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=wW(u,NW(i,a.axisX,s,o),NW(i,a.axisY,s,o));for(i of(r={},t))r[i]=jW(u.signal,NW(i,a.axisTop,s,o),NW(i,a.axisBottom,s,o),NW(i,a.axisLeft,s,o),NW(i,a.axisRight,s,o))}else n=u===GU||u===JU?a.axisX:a.axisY,r=a["axis"+u[0].toUpperCase()+u.slice(1)];return n||r||l?Qu({},s,n,r,l):s}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=bV(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},vu(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},f=Rq(t.add(oU({},[c]))),d=Rq(t.add(iU({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let p;return c.grid&&h.push(zW(e,n,r.grid,d,u)),c.ticks&&(p=l("tickSize"),h.push(function(e,t,n,r,i,a){const o=bV(e,t),s=e.orient,l=xW(s,-1,1);let u,c,f;const d={enter:u={opacity:dV},update:f={opacity:hV},exit:c={opacity:dV}};fq(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=uq(i);h.mult=l;const p={scale:e.scale,field:tV,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=u.y=wW(s,dV,p),f.y2=u.y2=wW(s,h),c.x=wW(s,p),f.x=u.x=_W(s,dV,p),f.x2=u.x2=_W(s,h),c.y=_W(s,p),OV({type:gV,role:"axis-tick",key:tV,from:r,encode:d},n)}(e,n,r.ticks,d,p,u))),c.labels&&(p=c.ticks?p:0,h.push(LW(e,n,r.labels,d,p,u))),c.domain&&h.push(function(e,t,n,r){const i=bV(e,t),a=e.orient;let o,s;const l={enter:o={opacity:dV},update:s={opacity:hV},exit:{opacity:dV}};fq(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=PW(e,0),c=PW(e,1);return o.x=s.x=wW(a,u,dV),o.x2=s.x2=wW(a,c),o.y=s.y=_W(a,u,dV),o.y2=s.y2=_W(a,c),OV({type:gV,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,f)),c.title&&h.push(IW(e,n,r.title,f)),uW(vV({role:"axis",from:f,encode:dq(UW(l,e),i,fV),marks:h,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function UW(e,t){const n={enter:{},update:{}};return fq(n,{orient:e("orient"),offset:e("offset")||0,position:Wq(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function VW(e,t,n){const r=qu(e.signals),i=qu(e.scales);return n||r.forEach((e=>jq(e,t))),qu(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=HU(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=HU(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";pk(n)||ou("Unrecognized scale type: "+wc(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),qu(e.data).forEach((e=>gW(e,t))),i.forEach((e=>FU(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?ou("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=WL(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>eU(e,t,n.id)))}(e,t))),qu(e.axes).forEach((e=>qW(e,t))),qu(e.marks).forEach((e=>uW(e,t))),qu(e.legends).forEach((e=>cW(e,t))),e.title&&pW(e.title,t),t.parseLambdas(),t}function WW(e,t){const n=t.config,r=Rq(t.root=t.add(Nq())),i=function(e,t){const n=n=>Wq(e[n],t[n]),r=[HW("background",n("background")),HW("autosize",oq(n("autosize"))),HW("padding",lq(n("padding"))),HW("width",n("width")||0),HW("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return qu(e.signals).forEach((e=>{nc(i,e.name)?e=Qu(i[e.name],e):r.push(e),a[e.name]=e})),qu(t.signals).forEach((e=>{nc(a,e.name)||nc(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>jq(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(oU()),o=t.add(uU($q((e=>dq({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),pV,mq,e.style,t,{pulse:Rq(a)}))),s=t.add(DU({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Rq(o)}));t.operators.pop(),t.pushState(Rq(o),Rq(s),null),VW(e,t,i),t.operators.push(s);let l=t.add(aU({mark:r,pulse:Rq(s)}));return l=t.add(SU({pulse:Rq(l)})),l=t.add($U({pulse:Rq(l)})),t.addData("root",new iW(t,a,a,l)),t}function HW(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function GW(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function XW(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function YW(e){return(yu(e)?JW:KW)(e)}function JW(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(vu(t)?t.signal||YW(t):wc(t))}return n+"]"}function KW(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+wc(t)+":"+(vu(n)?n.signal||YW(n):wc(n));return r+"}"}GW.prototype=XW.prototype={parse(e){return VW(e,this)},fork(){return new XW(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof Fq?Rq(e):e;return this.add(kU({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Rq(this.add($U({pulse:e})))),this._parent.push(t),this._lookup.push(n?Rq(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return ku(this._parent)},encode(){return ku(this._encode)},lookup(){return ku(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(hc(e))return Pq(e,t);e.signal||ou("Unsupported field reference: "+wc(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=Rq(this.add(dU(e)))}return r},compareRef(e){let t=!1;const n=e=>Uq(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=qu(e.field).map(n),i=qu(e.order).map(n);return t?Rq(this.add(sU({fields:r,orders:i}))):Bq(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=qu(e).map((e=>Uq(e)?(n=!0,Rq(r[e.signal])):e)),n?Rq(this.add(hU({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=Lq(e.op,e.field),n=e.order||"ascending";return n.signal?Rq(this.add(sU({fields:t,orders:this.signalRef(n.signal)}))):Bq(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return nc(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&ou("Duplicate signal name: "+wc(e));const n=t instanceof Fq?t:this.add(Nq(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||ou("Unrecognized signal name: "+wc(e)),this.signals[e]},signalRef(e){return this.signals[e]?Rq(this.signals[e]):(nc(this.lambdas,e)||(this.lambdas[e]=this.add(Nq(null))),Rq(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=WL(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&vu(e)?this.signalRef(e.signal||YW(e)):e},exprRef(e,t){const n={expr:WL(e,this)};return t&&(n.expr.$name=t),Rq(this.add(cU(n)))},addBinding(e,t){this.bindings||ou("Nested signals do not support binding: "+wc(e)),this.bindings.push(Qu({signal:e},t))},addScaleProj(e,t){nc(this.scales,e)&&ou("Duplicate scale or projection name: "+wc(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,EU(t))},addProjection(e,t){this.addScaleProj(e,_U(t))},getScale(e){return this.scales[e]||ou("Unrecognized scale name: "+wc(e)),this.scales[e]},scaleRef(e){return Rq(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return nc(this.data,e)&&ou("Duplicate data set name: "+wc(e)),this.data[e]=t},getData(e){return this.data[e]||ou("Undefined data set name: "+wc(e)),this.data[e]},addDataPipeline(e,t){return nc(this.data,e)&&ou("Duplicate data set name: "+wc(e)),this.addData(e,iW.fromEntries(this,t))}};Qu(pg,Tv,BD,gC,rN,nR,PP,gP,qP,pz,Az,Pz);var QW=Object.freeze({__proto__:null,version:"5.17.1",Dataflow:fg,EventStream:Jm,MultiPulse:og,Operator:Gm,Parameters:Vm,Pulse:ng,Transform:hg,changeset:qm,definition:mg,ingest:Rm,isTuple:Fm,transform:gg,transforms:pg,tupleid:Tm,interpolate:$k,interpolateColors:Ok,interpolateRange:kk,quantizeInterpolator:Sk,scale:hk,scheme:Mk,projection:ST,View:WI,defaultLocale:Em,formatLocale:vm,locale:Sm,resetDefaultLocale:function(){return gm(),wm(),Em()},timeFormatLocale:km,expressionFunction:VL,parse:function(e,t,n){return vu(e)||ou("Input Vega specification must be an object."),WW(e,new GW(t=xu(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()},runtimeContext:eI,Debug:4,Error:1,Info:3,None:0,Warn:2,accessor:eu,accessorFields:nu,accessorName:tu,array:qu,ascending:Hu,clampRange:Uu,compare:Wu,constant:Ju,debounce:Ku,error:ou,extend:Qu,extent:Zu,extentIndex:ec,falsy:pu,fastmap:ic,field:lu,flush:ac,hasOwnProperty:nc,id:uu,identity:cu,inherits:oc,inrange:sc,isArray:yu,isBoolean:lc,isDate:uc,isFunction:Vu,isIterable:cc,isNumber:fc,isObject:vu,isRegExp:dc,isString:hc,key:pc,lerp:mc,logger:gu,lruCache:gc,merge:yc,mergeConfig:xu,one:du,pad:bc,panLinear:Mu,panLog:ju,panPow:Fu,panSymlog:Tu,peek:ku,quarter:Lu,repeat:vc,span:xc,splitAccessPath:su,stringValue:wc,toBoolean:_c,toDate:Oc,toNumber:Ou,toSet:Ec,toString:Sc,truncate:$c,truthy:hu,utcquarter:Iu,visitArray:Ac,writeConfig:wu,zero:fu,zoomLinear:Ru,zoomLog:Pu,zoomPow:zu,zoomSymlog:Bu,bandwidthNRD:xg,bin:wg,bootstrapCI:kg,cumulativeLogNormal:Rg,cumulativeNormal:Cg,cumulativeUniform:qg,densityLogNormal:Ng,densityNormal:Dg,densityUniform:Ig,dotbin:Og,quantileLogNormal:Pg,quantileNormal:Mg,quantileUniform:Ug,quantiles:vg,quartiles:bg,get random(){return _g},randomInteger:function(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*_g()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)},randomKDE:Fg,randomLCG:function(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}},randomLogNormal:zg,randomMixture:Bg,randomNormal:jg,randomUniform:Vg,regressionExp:Kg,regressionLinear:Yg,regressionLoess:ny,regressionLog:Jg,regressionPoly:ey,regressionPow:Qg,regressionQuad:Zg,sampleCurve:oy,sampleLogNormal:Tg,sampleNormal:Ag,sampleUniform:Lg,setRandom:function(e){_g=e},DATE:Nd,DAY:Rd,DAYOFYEAR:Pd,HOURS:zd,MILLISECONDS:Id,MINUTES:Bd,MONTH:Fd,QUARTER:jd,SECONDS:Ld,TIME_UNITS:qd,WEEK:Td,YEAR:Md,dayofyear:Yd,timeBin:Bh,timeFloor:fh,timeInterval:yh,timeOffset:xh,timeSequence:kh,timeUnitSpecifier:Hd,timeUnits:Vd,utcFloor:ph,utcInterval:vh,utcOffset:wh,utcSequence:Oh,utcdayofyear:th,utcweek:nh,week:Jd,read:$m,inferType:Vc,inferTypes:Wc,typeParsers:Ic,format:hf,formats:pf,responseType:mf,loader:Am,Bounds:JO,CanvasHandler:S$,CanvasRenderer:C$,Gradient:rO,GroupItem:QO,Handler:s$,Item:KO,Marks:WE,RenderType:vA,Renderer:u$,ResourceLoader:ZO,SVGHandler:j$,SVGRenderer:tA,SVGStringRenderer:mA,Scenegraph:ZE,boundClip:EA,boundContext:xS,boundItem:HE,boundMark:XE,boundStroke:nS,domChild:r$,domClear:i$,domCreate:t$,domFind:n$,font:BE,fontFamily:zE,fontSize:FE,intersect:wA,intersectBoxLine:MS,intersectPath:$S,intersectPoint:AS,intersectRule:CS,lineHeight:TE,markup:Y$,multiLineOffset:RE,pathCurves:aO,pathEqual:AA,pathParse:lO,pathRectangle:jO,pathRender:bO,pathSymbols:kO,pathTrail:FO,point:o$,renderModule:xA,resetSVGClipId:XO,resetSVGDefIds:function(){XO(),Qk=0},sceneEqual:$A,sceneFromJSON:KE,scenePickVisit:qS,sceneToJSON:JE,sceneVisit:IS,sceneZOrder:LS,serializeXML:J$,textMetrics:$E});Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var ZW=Yo((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var f=[],d=[],h="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(h&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var y=f.indexOf(l);if(-1!=y)return d[y];f.push(l),d.push(m)}for(var v in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,v)),b&&null==b.set||(m[v]=a(l[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(v=0;v<x.length;v++){var w=x[v];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(m[w]=a(l[w],p-1),k.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(v=0;v<_.length;v++){var k,O=_[v];(k=Object.getOwnPropertyDescriptor(l,O))&&k.enumerable||(m[O]=a(l[O],p-1),Object.defineProperty(m,O,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)})),eH=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)};function tH(e){return!!e.or}function nH(e){return!!e.and}function rH(e){return!!e.not}function iH(e,t){if(rH(e))iH(e.not,t);else if(nH(e))for(const n of e.and)iH(n,t);else if(tH(e))for(const n of e.or)iH(n,t);else t(e)}function aH(e,t){return rH(e)?{not:aH(e.not,t)}:nH(e)?{and:e.and.map((e=>aH(e,t)))}:tH(e)?{or:e.or.map((e=>aH(e,t)))}:t(e)}const oH=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n},sH=ZW;function lH(e,t){const n={};for(const r of t)nc(e,r)&&(n[r]=e[r]);return n}function uH(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>eH(e))).join(",")})`};const cH=eH;function fH(e){if(fc(e))return e;const t=hc(e)?e:eH(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function dH(e){return!1===e||null===e}function hH(e,t){return e.indexOf(t)>-1}function pH(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function mH(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function gH(e,...t){for(const n of t)yH(e,null!=n?n:{});return e}function yH(e,t){for(const n of OH(t))wu(e,n,t[n],!0)}function vH(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function bH(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function xH(e,t){for(const n of e)if(t.has(n))return!0;return!1}function wH(e){const t=new Set;for(const n of e){const e=su(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function _H(e,t){return void 0===e||void 0===t||xH(wH(e),wH(t))}function kH(e){return 0===OH(e).length}const OH=Object.keys,SH=Object.values,EH=Object.entries;function $H(e){return!0===e||!1===e}function AH(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function DH(e,t){return rH(e)?"!("+DH(e.not,t)+")":nH(e)?"("+e.and.map((e=>DH(e,t))).join(") && (")+")":tH(e)?"("+e.or.map((e=>DH(e,t))).join(") || (")+")":t(e)}function CH(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&CH(e[n],t)&&delete e[n],kH(e)}function MH(e){return e.charAt(0).toUpperCase()+e.substr(1)}function jH(e,t="datum"){const n=su(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(wc).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function FH(e,t="datum"){return`${t}[${wc(su(e).join("."))}]`}function TH(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function NH(e){return`${su(e).map(TH).join("\\.")}`}function RH(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function PH(e){return`${su(e).join(".")}`}function zH(e){return e?su(e).length:0}function BH(...e){for(const t of e)if(void 0!==t)return t}let LH=42;function IH(e){const t=++LH;return e?String(e)+t:t}function qH(e){return UH(e)?e:`__${e}`}function UH(e){return 0===e.indexOf("__")}function VH(e){if(void 0!==e)return(e%360+360)%360}function WH(e){return!!fc(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const HH={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function GH(e){return e&&e.condition}const XH=["domain","grid","labels","ticks","title"],YH={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},JH={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},KH=Object.assign(Object.assign({},JH),{style:1,labelExpr:1,encoding:1});function QH(e){return!!KH[e]}const ZH=OH({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),eG={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},tG={count:1,min:1,max:1};function nG(e){return!!e&&!!e.argmin}function rG(e){return!!e&&!!e.argmax}function iG(e){return hc(e)&&!!eG[e]}const aG=["count","valid","missing","distinct"];function oG(e){return hc(e)&&hH(aG,e)}const sG=["count","sum","distinct","valid","missing"],lG=Ec(["mean","average","median","q1","q3","min","max"]);var uG=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const cG="row",fG="column",dG="facet",hG="x",pG="y",mG="x2",gG="y2",yG="radius",vG="radius2",bG="theta",xG="theta2",wG="latitude",_G="longitude",kG="latitude2",OG="longitude2",SG="color",EG="fill",$G="stroke",AG="shape",DG="size",CG="angle",MG="opacity",jG="fillOpacity",FG="strokeOpacity",TG="strokeWidth",NG="strokeDash",RG="text",PG="order",zG="detail",BG="key",LG="tooltip",IG="href",qG="url",UG="description",VG={theta:1,theta2:1,radius:1,radius2:1};function WG(e){return e in VG}const HG={longitude:1,longitude2:1,latitude:1,latitude2:1};const GG=OH(HG),XG=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),VG),HG),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function YG(e){return e===SG||e===EG||e===$G}const JG={row:1,column:1,facet:1},KG=OH(JG),QG=Object.assign(Object.assign({},XG),JG),ZG=OH(QG),eX=uG(QG,["order","detail","tooltip"]),tX=uG(eX,["row","column","facet"]);function nX(e){return!!QG[e]}const rX=[mG,gG,kG,OG,xG,vG];function iX(e){return aX(e)!==e}function aX(e){switch(e){case mG:return hG;case gG:return pG;case kG:return wG;case OG:return _G;case xG:return bG;case vG:return yG}return e}function oX(e){if(WG(e))switch(e){case bG:return"startAngle";case xG:return"endAngle";case yG:return"outerRadius";case vG:return"innerRadius"}return e}function sX(e){switch(e){case hG:return mG;case pG:return gG;case wG:return kG;case _G:return OG;case bG:return xG;case yG:return vG}}function lX(e){switch(e){case hG:case mG:return"width";case pG:case gG:return"height"}}const uX=uG(XG,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),cX=OH(uX),fX={x:1,y:1},dX=OH(fX);function hX(e){return e in fX}const pX={theta:1,radius:1},mX=OH(pX);function gX(e){return"width"===e?hG:pG}const yX=uG(uX,["text","tooltip","href","url","description","detail","key","order"]),vX=OH(yX);const bX=Object.assign(Object.assign(Object.assign({},fX),pX),yX),xX=OH(bX);function wX(e){return!!bX[e]}function _X(e,t){return function(e){switch(e){case SG:case EG:case $G:case UG:case zG:case BG:case LG:case IG:case PG:case MG:case jG:case FG:case TG:case dG:case cG:case fG:return kX;case hG:case pG:case wG:case _G:return OX;case mG:case gG:case kG:case OG:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case DG:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case NG:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case AG:return{point:"always",geoshape:"always"};case RG:return{text:"always"};case CG:return{point:"always",square:"always",text:"always"};case qG:return{image:"always"};case bG:case yG:return{text:"always",arc:"always"};case xG:case vG:return{arc:"always"}}}(e)[t]}const kX={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},OX=uG(kX,["geoshape"]);function SX(e){switch(e){case hG:case pG:case bG:case yG:case DG:case CG:case TG:case MG:case jG:case FG:case mG:case gG:case xG:case vG:return;case dG:case cG:case fG:case AG:case NG:case RG:case LG:case IG:case qG:case UG:return"discrete";case SG:case EG:case $G:return"flexible";case wG:case _G:case kG:case OG:case zG:case BG:case PG:return}}function EX(e){return lc(e)&&(e=fQ(e,void 0)),"bin"+OH(e).map((t=>CX(e[t])?AH(`_${t}_${EH(e[t])}`):AH(`_${t}_${e[t]}`))).join("")}function $X(e){return!0===e||DX(e)&&!e.binned}function AX(e){return"binned"===e||DX(e)&&!0===e.binned}function DX(e){return vu(e)}function CX(e){return null==e?void 0:e.selection}function MX(e){switch(e){case cG:case fG:case DG:case SG:case EG:case $G:case TG:case MG:case jG:case FG:case AG:return 6;case NG:return 4;default:return 10}}function jX(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const FX='Autosize "fit" only works for single views and layered views.';function TX(e){return`${"width"==e?"Width":"Height"} "container" only works for single views and layered views.`}function NX(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function RX(e){return e?`Dropping "fit-${e}" because spec has discrete ${lX(e)}.`:'Dropping "fit" because spec has discrete size.'}function PX(e){return`Unknown field for ${e}. Cannot calculate view size.`}function zX(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function BX(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function LX(e){return`Selection not supported for ${e} yet.`}const IX="The same selection must be used to override scale domains in a layered view.";function qX(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function UX(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function VX(e){return`Ignoring an invalid transform: ${cH(e)}.`}function WX(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function HX(e){return`Invalid field type "${e}".`}function GX(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function XX(e,t){return`Dropping ${cH(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function YX(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function JX(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function KX(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function QX(e){return`Using unaggregated domain with raw field has no effect (${cH(e)}).`}function ZX(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function eY(e){return`Unaggregated domain is currently unsupported for log scale (${cH(e)}).`}function tY(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function nY(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const rY="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function iY(e,t){return`Invalid ${e}: ${cH(t)}.`}function aY(e){return`1D error band does not support ${e}.`}function oY(e){return`Channel ${e} is required for "binned" bin.`}const sY=gu(2);let lY=sY;function uY(...e){lY.warn(...e)}function cY(e){if(e&&vu(e))for(const t of bY)if(t in e)return!0;return!1}const fY=["january","february","march","april","may","june","july","august","september","october","november","december"],dY=fY.map((e=>e.substr(0,3))),hY=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],pY=hY.map((e=>e.substr(0,3)));function mY(e,t){const n=[];if(t&&void 0!==e.day&&OH(e).length>1&&(uY(function(e){return`Dropping day from datetime ${cH(e)} as day cannot be combined with other units.`}(e)),delete(e=sH(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(WH(e)&&(e=+e),fc(e))return e-1;{const t=e.toLowerCase(),n=fY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=dY.indexOf(r);if(-1!==i)return i;throw new Error(iY("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(WH(e)&&(e=+e),fc(e))return e>4&&uY(iY("quarter",e)),e-1;throw new Error(iY("quarter",e))}(e.quarter):e.quarter;n.push(fc(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(WH(e)&&(e=+e),fc(e))return e%7;{const t=e.toLowerCase(),n=hY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=pY.indexOf(r);if(-1!==i)return i;throw new Error(iY("day",e))}}(e.day):e.day;n.push(fc(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function gY(e){const t=mY(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}var yY=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const vY={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},bY=OH(vY);function xY(e){return e.startsWith("utc")}const wY={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function _Y(e){const t=[];for(const n of bY)kY(e,n)&&t.push(n);return t}function kY(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function OY(e,t,{end:n}={end:!1}){const r=jH(t),i=xY(e)?"utc":"";let a;const o={};for(const t of bY)kY(e,t)&&(o[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=t);var s;return n&&(o[a]+="+1"),function(e){const t=mY(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}function SY(e){if(!e)return;const t=_Y(e);return`timeUnitSpecifier(${eH(t)}, ${eH(wY)})`}function EY(e){if(!e)return;let t;return hc(e)?t={unit:e}:vu(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),xY(t.unit)&&(t.utc=!0,t.unit=function(e){return e.substr(3)}(t.unit)),t}function $Y(e){return e&&!!e.signal}function AY(e){return!!e.step}function DY(e){return!yu(e)&&("field"in e&&"data"in e)}const CY=OH({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),MY={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},jY=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function FY(e){return e&&!!e.field&&void 0!==e.equal}function TY(e){return e&&!!e.field&&void 0!==e.lt}function NY(e){return e&&!!e.field&&void 0!==e.lte}function RY(e){return e&&!!e.field&&void 0!==e.gt}function PY(e){return e&&!!e.field&&void 0!==e.gte}function zY(e){if(e&&e.field){if(yu(e.range)&&2===e.range.length)return!0;if($Y(e.range))return!0}return!1}function BY(e){return e&&!!e.field&&(yu(e.oneOf)||yu(e.in))}function LY(e){return BY(e)||FY(e)||zY(e)||TY(e)||RY(e)||NY(e)||PY(e)}function IY(e,t){return pQ(e,{timeUnit:t,wrapTime:!0})}function qY(e,t=!0){var n;const{field:r}=e,i=null===(n=EY(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+OY(i,r)+")":JK(e,{expr:"datum"});if(FY(e))return a+"==="+IY(e.equal,i);if(TY(e)){return`${a}<${IY(e.lt,i)}`}if(RY(e)){return`${a}>${IY(e.gt,i)}`}if(NY(e)){return`${a}<=${IY(e.lte,i)}`}if(PY(e)){return`${a}>=${IY(e.gte,i)}`}if(BY(e))return`indexof([${function(e,t){return e.map((e=>IY(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return UY(a,e.valid);if(zY(e)){const{range:n}=e,r=$Y(n)?{signal:`${n.signal}[0]`}:n[0],o=$Y(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+IY(r,i)+", "+IY(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${IY(r,i)}`),null!==o&&s.push(`${a} <= ${IY(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function UY(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function VY(e){var t;return LY(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=EY(e.timeUnit))||void 0===t?void 0:t.unit}):e}const WY="quantitative",HY="ordinal",GY="temporal",XY="nominal",YY="geojson";var JY=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const KY="linear",QY="log",ZY="pow",eJ="sqrt",tJ="symlog",nJ="time",rJ="utc",iJ="quantile",aJ="quantize",oJ="threshold",sJ="point",lJ="band",uJ={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function cJ(e,t){const n=uJ[e],r=uJ[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const fJ={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function dJ(e){return fJ[e]}const hJ=["linear","log","pow","sqrt","symlog","time","utc"],pJ=Ec(hJ),mJ=Ec(["linear","log","pow","sqrt","symlog"]);const gJ=Ec(["quantile","quantize","threshold"]),yJ=Ec(hJ.concat(["quantile","quantize","threshold","sequential","identity"])),vJ=Ec(["ordinal","bin-ordinal","point","band"]);function bJ(e){return e in vJ}function xJ(e){return e in yJ}function wJ(e){return e in pJ}function _J(e){return e in gJ}function kJ(e){return null==e?void 0:e.selection}const OJ=JY({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),SJ=OH(OJ);function EJ(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!hH(["point","band","identity"],e);case"bins":return!hH(["point","band","identity","ordinal"],e);case"round":return wJ(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return wJ(e)||hH(["point","band"],e);case"paddingOuter":case"align":return hH(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return wJ(e);case"nice":return wJ(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return xJ(e)&&!hH(["log","time","utc","threshold","quantile"],e)}}function $J(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return YG(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function AJ(e){return e&&!!e.expr}function DJ(e){const t=OH(e||{}),n={};for(const r of t)n[r]=_Q(e[r]);return n}const CJ={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},MJ=CJ.arc,jJ=CJ.area,FJ=CJ.bar,TJ=CJ.image,NJ=CJ.line,RJ=CJ.point,PJ=CJ.rect,zJ=CJ.rule,BJ=CJ.text,LJ=CJ.tick,IJ=CJ.trail,qJ=CJ.circle,UJ=CJ.square,VJ=CJ.geoshape;function WJ(e){return hH(["line","area","trail"],e)}function HJ(e){return hH(["rect","bar","image","arc"],e)}const GJ=OH(CJ);function XJ(e){return e.type}Ec(GJ);const YJ=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],JJ=OH({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),KJ=OH({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),QJ={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},ZJ={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},eK={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function tK(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=sK(e);return PK(n)&&!oG(n.aggregate)&&i&&wJ(i.get("type"))&&!1===i.get("zero")?nK({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function nK({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){if(WJ(n.type))return r;return null===AQ("invalid",n,i)?r:[rK(e,t),r]}function rK(e,t){const n=iK(e,!0),r="y"===aX(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function iK(e,t=!0){return UY(hc(e)?e:JK(e,{expr:"datum"}),!t)}function aK(e,t,n,r){const i={};if(t&&(i.scale=t),BK(e)){const{datum:t}=e;cY(t)?i.signal=gY(t):$Y(t)?i.signal=t.signal:AJ(t)?i.signal=t.expr:i.value=t}else i.field=JK(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function oK({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=JK(t,{expr:o,suffix:i}),l=void 0!==n?JK(n,{expr:o}):JK(t,{suffix:"end",expr:o}),u={};if(0===a||1===a){u.scale=e;const t=0===a?s:l;u.field=t}else{const t=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${t})`}return r&&(u.offset=r),u}function sK({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(qK(t)){if(UK(t)){c=null!=c?c:jK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:f}=t;if($X(o)||c&&u&&f===GY)return s&&s.impute?aK(t,a,{binSuffix:"mid"},{offset:l}):c?oK({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):aK(t,a,gQ(t,e)?{binSuffix:"range"}:{},{offset:l});if(AX(o)){if(PK(n))return oK({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});uY(oY(e===hG?mG:gG))}}const u=null==o?void 0:o.get("type");return aK(t,a,bJ(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(VK(t)){const n=t.value,r=l?{offset:l}:{};return Object.assign(Object.assign({},lK(e,n)),r)}}return Vu(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function lK(e,t){return hH(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:hH(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:OQ(t)}function uK(e){return e&&"number"!==e&&"time"!==e}function cK(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function fK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(uK(n))return hK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=dK(e,r,i);if(hQ(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=hc(n)?n:r}')`:function(e,t,n){if(!e)return;const r=SY(e);return`${n||xY(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,PK(e)?null===(o=EY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,WK(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===rJ);return n?{signal:n}:void 0}if(t=gK(zK(e),t,a),PK(e)&&$X(e.bin)){return{signal:bK(l,JK(e,{expr:r,binSuffix:"end"}),t,n,a)}}return t||"quantitative"===zK(e)?{signal:`${yK(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function dK(e,t,n){return PK(e)?n?`${JK(e,{expr:t,suffix:"end"})}-${JK(e,{expr:t,suffix:"start"})}`:JK(e,{expr:t}):function(e){const{datum:t}=e;return cY(t)?gY(t):`${JSON.stringify(t)}`}(e)}function hK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){if(o=null!=o?o:dK(e,r,i),PK(e)&&$X(e.bin)){return{signal:bK(o,JK(e,{expr:r,binSuffix:"end"}),t,n,a)}}return{signal:cK(n,o,t)}}function pK(e,t,n,r,i,a){var o;if(!uK(r)){if(hQ(e)){return function(e,t,n,r){if(e)return e;if(t)return{signal:SY(t)};return r?void 0:n.timeFormat}(n,PK(e)?null===(o=EY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a)}return gK(t,n,i)}}function mK(e,t,n){return e&&($Y(e)||"number"===e||"time"===e)?e:hQ(t)&&"time"!==n&&"utc"!==n?"time":void 0}function gK(e,t,n){return hc(t)?t:e===WY?n.numberFormat:void 0}function yK(e,t){return`format(${e}, "${t||""}")`}function vK(e,t,n,r){var i;return uK(n)?cK(n,e,t):yK(e,null!==(i=hc(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function bK(e,t,n,r,i){const a=vK(e,n,r,i),o=vK(t,n,r,i);return`${UY(e,!1)} ? "null" : ${a} + " – " + ${o}`}const xK="min",wK={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function _K(e){return e in wK}function kK(e){return!!e&&!!e.encoding}function OK(e){return!(!e||"count"!==e.op&&!e.field)}function SK(e){return!!e&&yu(e)}function EK(e){return"row"in e||"column"in e}function $K(e){return!!e&&"header"in e}function AK(e){return"facet"in e}var DK=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function CK(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function MK(e){return"sort"in e}function jK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(qK(t)&&void 0!==t.band)return t.band;if(PK(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?DQ("timeUnitBandPosition",r,a):HJ(r.type)?DQ("timeUnitBand",r,a):0;if($X(i))return HJ(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function FK(e,t,n,r,i,a){return!!($X(t.bin)||t.timeUnit&&UK(t)&&"temporal"===t.type)&&!!jK({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function TK(e){return!!e&&"condition"in e}function NK(e){const t=e&&e.condition;return!!t&&!yu(t)&&PK(t)}function RK(e){const t=e&&e.condition;return!!t&&!yu(t)&&qK(t)}function PK(e){return!(!e||!e.field&&"count"!==e.aggregate)}function zK(e){return e&&e.type}function BK(e){return!!e&&"datum"in e}function LK(e){return UK(e)&&QK(e)||IK(e)}function IK(e){return BK(e)&&fc(e.datum)}function qK(e){return PK(e)||BK(e)}function UK(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function VK(e){return e&&"value"in e&&"value"in e}function WK(e){return!!e&&("scale"in e||"sort"in e)}function HK(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function GK(e){return!!e&&"legend"in e}function XK(e){return!!e&&("format"in e||"formatType"in e)}function YK(e){return uH(e,["legend","axis","header","scale"])}function JK(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=qH("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:f}=e;$X(u)?(o=EX(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?rG(c)?(l=`["${a}"]`,a=`argmax_${c.argmax}`):nG(c)?(l=`["${a}"]`,a=`argmin_${c.argmin}`):o=String(c):f&&(o=function(e){const t=EY(e),{utc:n}=t,r=yY(t,["utc"]);return r.unit?(n?"utc":"")+OH(r).map((e=>AH(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+OH(r).map((e=>AH(`_${e}_${r[e]}`))).join("")}(f),s=(!hH(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?PH(a):t.expr?FH(a,t.expr)+l:NH(a)+l}function KK(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return PK(e)&&!!e.bin;case"temporal":return!1}throw new Error(HX(e.type))}function QK(e){return!KK(e)}const ZK=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(rG(t))return`${i} for argmax(${t.argmax})`;if(nG(t))return`${i} for argmin(${t.argmin})`;const a=EY(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||$X(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if($X(i))return`${r} (binned)`;if(a){const e=null===(n=EY(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${_Y(e).join("-")})`}else if(o)return rG(o)?`${r} for max ${o.argmax}`:nG(o)?`${r} for min ${o.argmin}`:`${MH(o)} of ${r}`;return r}(e,t)}};let eQ=ZK;function tQ(e){eQ=e}function nQ(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=rQ(e))||void 0===i?void 0:i.title;if(!PK(e))return o;const s=e,l=r?iQ(s,t):void 0;return n?BH(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function rQ(e){return HK(e)&&e.axis?e.axis:GK(e)&&e.legend?e.legend:$K(e)&&e.header?e.header:void 0}function iQ(e,t){return eQ(e,t)}function aQ(e){var t;if(XK(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=rQ(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function oQ(e){return PK(e)?e:NK(e)?e.condition:void 0}function sQ(e){return qK(e)?e:RK(e)?e.condition:void 0}function lQ(e,t,n,r={}){if(hc(e)||fc(e)||lc(e)){return uY(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${cH(n)}}.`}(t,hc(e)?"string":fc(e)?"number":"boolean",e)),{value:e}}return qK(e)?uQ(e,t,n,r):RK(e)?Object.assign(Object.assign({},e),{condition:uQ(e.condition,t,n,r)}):e}function uQ(e,t,n,r){if(XK(e)){const{format:i,formatType:a}=e,o=DK(e,["format","formatType"]);if(uK(a)&&!n.customFormatTypes)return uY(WX(t)),uQ(o,t,n,r)}else{const i=HK(e)?"axis":GK(e)?"legend":$K(e)?"header":null;if(i&&e[i]){const a=e[i],{format:o,formatType:s}=a,l=DK(a,["format","formatType"]);if(uK(s)&&!n.customFormatTypes)return uY(WX(t)),uQ(Object.assign(Object.assign({},e),{[i]:l}),t,n,r)}}return PK(e)?cQ(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=fc(n)?"quantitative":hc(n)?"nominal":cY(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function cQ(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||iG(r)||rG(r)||nG(r)||(uY(function(e){return`Invalid aggregation operator "${e}".`}(r)),delete s.aggregate),i&&(s.timeUnit=EY(i)),o&&(s.field=`${o}`),$X(a)&&(s.bin=fQ(a,t)),AX(a)&&!hX(t)&&uY(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),UK(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case WY:return"quantitative";case"t":case GY:return"temporal";case"o":case HY:return"ordinal";case"n":case XY:return"nominal";case YY:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&oG(r)&&(uY(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,r)),s.type="quantitative")}else if(!iX(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(MK(e)&&yu(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!rG(r)&&!nG(r))return"quantitative";if(WK(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(uJ[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(UK(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case cG:case fG:case dG:return QK(e)?{compatible:!1,warning:JX(t)}:dQ;case hG:case pG:case SG:case EG:case $G:case RG:case zG:case BG:case LG:case IG:case qG:case CG:case bG:case yG:case UG:return dQ;case _G:case OG:case wG:case kG:return n!==WY?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:dQ;case MG:case jG:case FG:case TG:case DG:case xG:case vG:case mG:case gG:return"nominal"!==n||e.sort?dQ:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case NG:return hH(["ordinal","nominal"],e.type)?dQ:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case AG:return hH(["ordinal","nominal","geojson"],e.type)?dQ:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case PG:return"nominal"!==e.type||"sort"in e?dQ:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&uY(n)}if(MK(s)&&hc(s.sort)){const{sort:e}=s;if(_K(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&_K(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if($K(s)){const{header:e}=s,{orient:t}=e,n=DK(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function fQ(e,t){return lc(e)?{maxbins:MX(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:MX(t)})}const dQ={compatible:!0};function hQ(e){const{formatType:t}=aQ(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||PK(e)&&!!e.timeUnit)}(e)}function pQ(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=EY(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return AJ(e)?s=e.expr:$Y(e)?s=e.signal:cY(e)?(l=!0,s=gY(e)):(hc(e)||fc(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!vY[e]}(o)&&(fc(e)&&e<1e4||hc(e)&&isNaN(Date.parse(e)))&&(s=gY({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function mQ(e,t){const{type:n}=e;return t.map((t=>{const r=pQ(t,{timeUnit:PK(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function gQ(e,t){return $X(e.bin)?wX(t)&&hH(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var yQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function vQ(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=yQ(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:lH(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function bQ(e){return hc(e)||yu(e)&&hc(e[0])}var xQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function wQ(e){const t=yu(e.condition)?e.condition.map(kQ):kQ(e.condition);return Object.assign(Object.assign({},_Q(e)),{condition:t})}function _Q(e){if(AJ(e)){const{expr:t}=e,n=xQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function kQ(e){if(AJ(e)){const{expr:t}=e,n=xQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function OQ(e){if(AJ(e)){const{expr:t}=e,n=xQ(e,["expr"]);return Object.assign({signal:t},n)}return $Y(e)?e:void 0!==e?{value:e}:void 0}function SQ(e){return $Y(e)?e.signal:wc(e.value)}function EQ(e){return $Y(e)?e.signal:null==e?null:wc(e)}function $Q(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function AQ(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?DQ(e,t,n,r):void 0}function DQ(e,t,n,{vgChannel:r}={}){return BH(r?CQ(e,t,n.style):void 0,CQ(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function CQ(e,t,n){return MQ(e,$Q(t),n)}function MQ(e,t,n){let r;t=qu(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function jQ(e,t){return qu(e).reduce(((e,n)=>{var r;return e.field.push(JK(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function FQ(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(oH(t,e))return;n.push(e)})),n}function TQ(e,t){return oH(e,t)||!t?e:e?[...qu(e),...qu(t)].join(", "):t}function NQ(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((bQ(n)||$Y(n))&&(bQ(r)||$Y(r)))return{explicit:e.explicit,value:TQ(n,r)};if(bQ(n)||$Y(n))return{explicit:e.explicit,value:n};if(bQ(r)||$Y(r))return{explicit:e.explicit,value:r};if(!(bQ(n)||$Y(n)||bQ(r)||$Y(r)))return{explicit:e.explicit,value:FQ(n,r)};throw new Error("It should never reach here")}function RQ(e){return"mark"in e}class PQ{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!RQ(e)&&function(e){return XJ(e)?e.type:e}(e.mark)===this.name}}var zQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function BQ(e,t){const n=e&&e[t];return!!n&&(yu(n)?pH(n,(e=>!!e.field)):PK(n)||NK(n))}function LQ(e){return pH(ZG,(t=>{if(BQ(e,t)){const n=e[t];if(yu(n))return pH(n,(e=>!!e.aggregate));{const e=oQ(n);return e&&!!e.aggregate}}return!1}))}function IQ(e,t){const n=[],r=[],i=[],a=[],o={};return VQ(e,((s,l)=>{if(PK(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=zQ(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=rQ(s),p=e&&e.title;let m=JK(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:nQ(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let e;if(rG(c)?(e="argmax",m=JK({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):nG(c)?(e="argmin",m=JK({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),UK(s)&&$X(f)){if(r.push({bin:f,field:u,as:m}),n.push(JK(s,{binSuffix:"end"})),gQ(s,l)&&n.push(JK(s,{binSuffix:"range"})),hX(l)){const e={field:m+"_end"};o[l+"2"]=e}g.bin="binned",iX(l)||(g.type=WY)}else if(d){i.push({timeUnit:d,field:u,as:m});const e=UK(s)&&s.type!==GY&&"time";e&&(l===RG||l===LG?g.formatType=e:!function(e){return!!uX[e]}(l)?hX(l)&&(g.axis=Object.assign({formatType:e},g.axis)):g.legend=Object.assign({formatType:e},g.legend))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function qQ(e,t,n,r){return OH(e).reduce(((i,a)=>{if(!nX(a))return uY(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||(uY("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=bG),!function(e,t,n){const r=_X(t,n);if(!r)return!1;if("binned"===r){const n=e[t===mG?hG:pG];return!!(PK(n)&&PK(e[t])&&AX(n.bin))}return!0}(e,a,t))return uY(YX(a,t)),i;if(a===DG&&"line"===t){const t=oQ(e[a]);if(null==t?void 0:t.aggregate)return uY("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===SG&&(n?"fill"in e:"stroke"in e))return uY(GX("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===zG||a===PG&&!yu(o)&&!VK(o)||a===LG&&yu(o))o&&(i[a]=qu(o).reduce(((e,t)=>(PK(t)?e.push(cQ(t,a)):uY(XX(t,a)),e)),[]));else{if(a===LG&&null===o)i[a]=null;else if(!(PK(o)||BK(o)||VK(o)||TK(o)||$Y(o)))return uY(XX(o,a)),i;i[a]=lQ(o,a,r)}return i}),{})}function UQ(e,t){const n={};for(const r of OH(e)){const i=lQ(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function VQ(e,t,n){if(e)for(const r of OH(e)){const i=e[r];if(yu(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function WQ(e,t){return OH(t).reduce(((n,r)=>{switch(r){case hG:case pG:case IG:case UG:case qG:case mG:case gG:case bG:case xG:case yG:case vG:case wG:case _G:case kG:case OG:case RG:case AG:case CG:case LG:return n;case PG:if("line"===e||"trail"===e)return n;case zG:case BG:{const e=t[r];if(yu(e)||PK(e))for(const t of qu(e))t.aggregate||n.push(JK(t,{}));return n}case DG:if("trail"===e)return n;case SG:case EG:case $G:case MG:case jG:case FG:case NG:case TG:{const e=oQ(t[r]);return e&&!e.aggregate&&n.push(JK(e,{})),n}}}),[])}var HQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function GQ(e,t,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${XQ(t)}`:"";return{field:e+t.field,type:t.type,title:$Y(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...vH(function(e){const t=[];for(const n of OH(e))if(BQ(e,n)){const r=qu(e[n]);for(const e of r)PK(e)?t.push(e):NK(e)&&t.push(e.condition)}return t}(n).map(YK),fH)]}}function XQ(e){const{title:t,field:n}=e;return BH(t,n)}function YQ(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:f={}})=>{const d=XQ(n);return JQ(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},hc(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),f)})}}function JQ(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),XJ(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),lc(e[t])?{}:e[t])})]:[]}function KQ(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],l=r[i+"Error2"];return{continuousAxisChannelDef:QQ(a,n),continuousAxisChannelDef2:QQ(o,n),continuousAxisChannelDefError:QQ(s,n),continuousAxisChannelDefError2:QQ(l,n),continuousAxis:i}}function QQ(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=HQ(e,["aggregate"]);return n!==t&&uY(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function ZQ(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(XJ(n)&&n.orient)return n.orient;if(LK(i)){if(LK(a)){const e=PK(i)&&i.aggregate,n=PK(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return hQ(a)&&!hQ(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(LK(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var eZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const tZ="boxplot",nZ=new PQ(tZ,iZ);function rZ(e){return fc(e)?"tukey":e}function iZ(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:UQ(e.encoding,t)});const{mark:i,encoding:a,selection:o,projection:s}=e,l=eZ(e,["mark","encoding","selection","projection"]),u=XJ(i)?i:{type:i};o&&uY(LX("boxplot"));const c=null!==(n=u.extent)&&void 0!==n?n:t.boxplot.extent,f=AQ("size",u,t),d=rZ(c),{bins:h,timeUnits:p,transform:m,continuousAxisChannelDef:g,continuousAxis:y,groupby:v,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:w,boxOrient:_,customTooltipWithoutAggregatedField:k}=function(e,t,n){const r=ZQ(e,tZ),{continuousAxisChannelDef:i,continuousAxis:a}=KQ(e,r,tZ),o=i.field,s=rZ(t),l=[...aZ(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=(c[f],eZ(c,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=HQ(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(yu(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return yu(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(d),{bins:m,timeUnits:g,aggregate:y,groupby:v,encoding:b}=IQ(p,n),x="vertical"===r?"horizontal":"vertical",w=r,_=[...m,...g,{aggregate:[...y,...l],groupby:v},...u];return{bins:m,timeUnits:g,transform:_,groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:h}}(e,c,t),{color:O,size:S}=x,E=eZ(x,["color","size"]),$=e=>YQ(u,y,g,e,t.boxplot),A=$(E),D=$(x),C=$(Object.assign(Object.assign({},E),S?{size:S}:{})),M=GQ([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],g,x),j={type:"tick",color:"black",opacity:1,orient:w,invalid:null,aria:!1},F="min-max"===d?M:GQ([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,x),T=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"lower_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"upper_whisker",extraEncoding:F})],N=[..."tukey"!==d?T:[],...D({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},vu(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:w,aria:!1}),positionPrefix:"mid_box",extraEncoding:M})];if("min-max"===d)return Object.assign(Object.assign({},l),{transform:(null!==(r=l.transform)&&void 0!==r?r:[]).concat(m),layer:N});const R=`datum["lower_box_${g.field}"]`,P=`datum["upper_box_${g.field}"]`,z=`(${P} - ${R})`,B=`${R} - ${c} * ${z}`,L=`${P} + ${c} * ${z}`,I=`datum["${g.field}"]`,q={joinaggregate:aZ(g.field),groupby:v},U={transform:[{filter:`(${B} <= ${I}) && (${I} <= ${L})`},{aggregate:[{op:"min",field:g.field,as:"lower_whisker_"+g.field},{op:"max",field:g.field,as:"upper_whisker_"+g.field},{op:"min",field:"lower_box_"+g.field,as:"lower_box_"+g.field},{op:"max",field:"upper_box_"+g.field,as:"upper_box_"+g.field},...b],groupby:v}],layer:T},V=eZ(E,["tooltip"]),{scale:W,axis:H}=g,G=XQ(g),X=uH(H,["title"]),Y=JQ(u,"outliers",t.boxplot,{transform:[{filter:`(${I} < ${B}) || (${I} > ${L})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},void 0!==G?{title:G}:{}),void 0!==W?{scale:W}:{}),kH(X)?{}:{axis:X})},V),O?{color:O}:{}),k?{tooltip:k}:{})})[0];let J;const K=[...h,...p,q];return Y?J={transform:K,layer:[Y,U]}:(J=U,J.transform.unshift(...K)),Object.assign(Object.assign({},l),{layer:[J,{transform:m,layer:N}]})}function aZ(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var oZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const sZ="errorbar",lZ=new PQ(sZ,uZ);function uZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:UQ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=fZ(e,sZ,t);delete a.size;const c=YQ(s,i,r,a,t.errorbar),f=s.thickness,d=s.size,h=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==f?{thickness:f}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==f?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function cZ(e,t){const{encoding:n}=e;if(function(e){return(qK(e.x)||qK(e.y))&&!qK(e.x2)&&!qK(e.y2)&&!qK(e.xError)&&!qK(e.xError2)&&!qK(e.yError)&&!qK(e.yError2)}(n))return{orient:ZQ(e,t),inputType:"raw"};const r=function(e){return qK(e.x2)||qK(e.y2)}(n),i=function(e){return qK(e.xError)||qK(e.xError2)||qK(e.yError)||qK(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(qK(e)&&qK(r))throw new Error(`${t} cannot have both x2 and y2`);if(qK(e)){if(LK(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(qK(r)){if(LK(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(qK(r)&&!qK(e))throw new Error(`${t} cannot have xError2 without xError`);if(qK(s)&&!qK(i))throw new Error(`${t} cannot have yError2 without yError`);if(qK(e)&&qK(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(qK(e)){if(LK(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(qK(i)){if(LK(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function fZ(e,t,n){var r;const{mark:i,encoding:a,selection:o,projection:s}=e,l=oZ(e,["mark","encoding","selection","projection"]),u=XJ(i)?i:{type:i};o&&uY(LX(t));const{orient:c,inputType:f}=cZ(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=KQ(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&uY(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:MH(t)},{fieldPrefix:"upper_",titlePrefix:dZ(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:dZ(t,n,"-")}],d=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:nQ({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:nQ({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:nQ({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&uY(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?u.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:RH(RH(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}(u,d,h,p,m,f,t,n),w=a,_=g,k=(w[_],"x"===g?"x2":"y2"),O=(w[k],"x"===g?"xError":"yError"),S=(w[O],"x"===g?"xError2":"yError2"),E=(w[S],oZ(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof O?O:O+"","symbol"==typeof S?S:S+""])),{bins:$,timeUnits:A,aggregate:D,groupby:C,encoding:M}=IQ(E,n),j=[...D,...y],F="raw"!==f?[]:C,T=GQ(b,d,M,x);return{transform:[...null!==(r=l.transform)&&void 0!==r?r:[],...$,...A,...0===j.length?[]:[{aggregate:j,groupby:F}],...v],groupby:F,continuousAxisChannelDef:d,continuousAxis:g,encodingWithoutContinuousAxis:M,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:T}}function dZ(e,t,n){return MH(e)+" "+n+" "+t}const hZ="errorband",pZ=new PQ(hZ,mZ);function mZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:UQ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=fZ(e,hZ,t),u=o,c=YQ(u,i,r,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),p),{aria:!1})):u.interpolate?uY(aY("interpolate")):u.tension&&uY(aY("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:l})]})}const gZ={};function yZ(e,t,n){const r=new PQ(e,t);gZ[e]={normalizer:r,parts:n}}yZ(tZ,iZ,["box","median","outliers","rule","ticks"]),yZ(sZ,uZ,["ticks","rule"]),yZ(hZ,mZ,["band","borders"]);const vZ=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],bZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},xZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},wZ=OH(bZ),_Z=OH(xZ),kZ=OH({header:1,headerRow:1,headerColumn:1,headerFacet:1}),OZ=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var SZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function EZ(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=SZ(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const $Z="_vgsid_",AZ={single:{on:"click",fields:[$Z],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[$Z],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function DZ(e){return!(!e||"legend"!==e&&!e.legend)}function CZ(e){return DZ(e)&&vu(e)}function MZ(e){return"concat"in e}function jZ(e){return"vconcat"in e}function FZ(e){return"hconcat"in e}function TZ(e){return vu(e)&&void 0!==e.step}function NZ(e){return e.view||e.width||e.height}const RZ=OH({align:1,bounds:1,center:1,columns:1,spacing:1});var PZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zZ(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function BZ(e,t){const n=LZ(e,t);return TZ(n)?n.step:IZ}function LZ(e,t){var n;return BH(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const IZ=20,qZ={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:IZ},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:ZJ,circle:{},geoshape:{},image:{},line:{},point:{},rect:eK,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:AZ,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},UZ=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],VZ={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},WZ={blue:UZ[0],orange:UZ[1],red:UZ[2],teal:UZ[3],green:UZ[4],yellow:UZ[5],purple:UZ[6],pink:UZ[7],brown:UZ[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function HZ(e){const t=OH(e||{}),n={};for(const r of t){const t=e[r];n[r]=GH(t)?wQ(t):_Q(t)}return n}const GZ=[...KJ,...ZH,...kZ,"background","padding","legend","lineBreak","scale","style","title","view"];function XZ(e={}){const{color:t,font:n,fontSize:r}=e,i=PZ(e,["color","font","fontSize"]),a=xu({},qZ,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:vu(e)?Object.assign(Object.assign({},WZ),e):WZ}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:vu(e)?Object.assign(Object.assign({},VZ),e):VZ}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=uH(a,GZ);for(const e of["background","lineBreak","padding"])a[e]&&(o[e]=_Q(a[e]));for(const e of KJ)a[e]&&(o[e]=DJ(a[e]));for(const e of ZH)a[e]&&(o[e]=HZ(a[e]));for(const e of kZ)a[e]&&(o[e]=DJ(a[e]));return a.legend&&(o.legend=DJ(a.legend)),a.scale&&(o.scale=DJ(a.scale)),a.style&&(o.style=function(e){const t=OH(e),n={};for(const r of t)n[r]=HZ(e[r]);return n}(a.style)),a.title&&(o.title=DJ(a.title)),a.view&&(o.view=DJ(a.view)),o}const YZ=["view",...GJ],JZ=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],KZ=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function QZ(e){e=sH(e);for(const t of JZ)delete e[t];if(e.axis)for(const t in e.axis)GH(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of vZ)delete e.legend[t];if(e.mark){for(const t of JJ)delete e.mark[t];e.mark.tooltip&&vu(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(EZ(e.params)),delete e.params);for(const t of YZ){for(const n of JJ)delete e[t][n];const n=KZ[t];if(n)for(const r of n)delete e[t][r];ZZ(e,t)}for(const t of OH(gZ))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=vQ(e.title);kH(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));kH(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));kH(r)?delete e.title:e.title=r}(e);for(const t in e)vu(e[t])&&kH(e[t])&&delete e[t];return kH(e)?void 0:e}function ZZ(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);kH(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function e0(e){return"layer"in e}var t0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const n0={zero:1,center:1,normalize:1};const r0=new Set([MJ,FJ,jJ,zJ,RJ,qJ,UJ,NJ,BJ,LJ]),i0=new Set([FJ,jJ,MJ]);function a0(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(PK(a)&&PK(o))if("quantitative"===zK(a)&&"quantitative"===zK(o)){if(a.stack)return t;if(o.stack)return i;const e=PK(a)&&!!a.aggregate;if(e!==(PK(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===zK(a))return t;if("quantitative"===zK(o))return i}else{if("quantitative"===zK(a))return t;if("quantitative"===zK(o))return i}}function o0(e,t,n={}){const r=XJ(e)?e.type:e;if(!r0.has(r))return null;const i=a0(t,"x")||a0(t,"theta");if(!i)return null;const a=t[i],o=PK(a)?JK(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=PK(l)?JK(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=cX.reduce(((e,n)=>{if("tooltip"!==n&&BQ(t,n)){const r=t[n];for(const t of qu(r)){const r=oQ(t);if(r.aggregate)continue;const i=JK(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e}),[]);let f;if(void 0!==a.stack?f=lc(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&i0.has(r)&&(f="zero"),!f||!(f in n0))return null;var d;if(LQ(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==KY){if(n.disallowNonLinearStack)return null;uY(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return qK(t[sX(i)])?(void 0!==a.stack&&uY(`Cannot stack "${d=i}" if there is already "${d}2".`),null):(PK(a)&&a.aggregate&&!hH(sG,a.aggregate)&&uY(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&WJ(r),stackBy:c,offset:f})}var s0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function l0(e){const t=s0(e,["point","line"]);return OH(t).length>1?t:t.type}function u0(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:uH(e[t],["point","line"])}));return e}function c0(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?vu(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?vu(t.point)?t.point:{}:void 0}function f0(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class d0{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(RQ(e)){const{mark:n,encoding:r}=e,i=XJ(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!c0(i,t[i.type],r);case"area":return!!c0(i,t[i.type],r)||!!f0(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=s0(e,["selection","projection","mark","encoding"]),u=UQ(s,r),c=XJ(o)?o:{type:o},f=c0(c,r[c.type],u),d="area"===c.type&&f0(c,r[c.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:l0(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:uH(u,["shape"])})],p=o0(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},lH(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),f&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},lH(c,["clip","tooltip"])),f),encoding:m})),n(Object.assign(Object.assign({},l),{layer:h}),Object.assign(Object.assign({},t),{config:u0(r)}))}}var h0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class p0{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(RQ(e)&&e.encoding)for(const n of dX){const r=e.encoding[n];if(r&&qK(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of dX){const i=lX(e),a=r[e];if(a&&qK(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=h0(a,["scale"]),s=h0(t,["rangeStep"]);n[i]={step:t.rangeStep},uY('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},o),kH(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}var m0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function g0(e,t){return t?EK(e)?_0(e,t):b0(e,t):e}function y0(e,t){return t?_0(e,t):e}function v0(e,t,n){const r=t[e];return function(e){return e&&!hc(e)&&"repeat"in e}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void uY(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t}function b0(e,t){if(void 0!==(e=v0("field",e,t))){if(null===e)return null;if(MK(e)&&OK(e.sort)){const n=v0("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function x0(e,t){if(PK(e))return b0(e,t);{const n=v0("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function w0(e,t){if(!qK(e)){if(RK(e)){const n=x0(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return m0(e,["condition"])}return e}{const n=x0(e,t);if(n)return n;if(TK(e))return{condition:e.condition}}}function _0(e,t){const n={};for(const r in e)if(nc(e,r)){const i=e[r];if(yu(i))n[r]=i.map((e=>w0(e,t))).filter((e=>e));else{const e=w0(i,t);void 0!==e&&(n[r]=e)}}return n}class k0{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(RQ(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of rX){const n=t[aX(e)];if(t[e]&&(PK(n)&&!AX(n.bin)||BK(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return uY((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var O0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function S0({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...OH(e),...OH(t)]);for(const a of i){const i=t[a],o=e[a];if(qK(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else RK(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||VK(o)||$Y(o)||qK(o)||yu(o))&&(r[a]=o)}}else r=t;return!r||kH(r)?void 0:r}function E0(e){const{parentProjection:t,projection:n}=e;return t&&n&&uY(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${cH(t)} is overridden by a child projection ${cH(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function $0(e,t){void 0===t&&(t=XZ(e.config));const n=function(e,t={}){return A0.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=RQ(e)||e0(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(uY(TX("width")),r=void 0),"container"==i&&(uY(TX("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?D0(n.autosize):{}),D0(e.autosize));"fit"!==s.type||a||(uY(FX),s.type="pad");"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&uY(NX("width"));"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&uY(NX("height"));if(oH(s,{type:"pad"}))return;return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const A0=new class extends class{map(e,t){return AK(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):FZ(e)?this.mapHConcat(e,t):jZ(e)?this.mapVConcat(e,t):MZ(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(e0(e))return this.mapLayer(e,t);if(RQ(e))return this.mapUnit(e,t);throw new Error(jX(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=t0(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[nZ,lZ,pZ,new d0,new k0,new p0]}map(e,t){if(RQ(e)){const n=BQ(e.encoding,cG),r=BQ(e.encoding,fG),i=BQ(e.encoding,dG);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=y0(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(a,t.config))return e.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!yu(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=O0(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map((e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+`child__layer_${AH(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=O0(e,["repeat","spec","data"]);!yu(r)&&e.columns&&(e=uH(e,["columns"]),uY(qX("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!yu(r)&&r.row||[l?l.row:null],f=!yu(r)&&r.column||[l?l.column:null],d=yu(r)&&r||[l?l.repeat:null];for(const e of d)for(const n of c)for(const a of f){const o={repeat:e,row:n,column:a,layer:l.layer},c=(i.name||"")+u+"child__"+(yu(r)?`${AH(e)}`:(r.row?`row_${AH(n)}`:"")+(r.column?`column_${AH(a)}`:"")),f=this.map(i,Object.assign(Object.assign({},t),{repeater:o,repeaterPrefix:c}));f.name=c,s.push(uH(f,["data"]))}const h=yu(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return EK(n)&&e.columns&&(e=uH(e,["columns"]),uY(qX("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=E0({parentProjection:a,projection:r}),l=S0({parentEncoding:i,encoding:y0(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=O0(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=O0(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),y=y0(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:y}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&uY(`Facet encoding dropped as ${(o=[...r?[cG]:[],...i?[fG]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const t={},s={};for(const r of[cG,fG]){const i=e[r];if(i){const e=O0(i,["align","center","spacing","columns"]);t[r]=e;for(const e of["align","center","spacing"])void 0!==i[e]&&(s[e]=null!==(n=s[e])&&void 0!==n?n:{},s[e][r]=i[e])}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:g0(O0(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var o}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=O0(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=O0(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:S0({parentEncoding:n,encoding:a,layer:!0}),parentProjection:E0({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function D0(e){return hc(e)?{type:e}:null!=e?e:{}}const C0=["background","padding"];function M0(e,t){const n={};for(const t of C0)e&&void 0!==e[t]&&(n[t]=_Q(e[t]));return t&&(n.params=e.params),n}class j0{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new j0(sH(this.explicit),sH(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return BH(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of OH(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function F0(e){return{explicit:!0,value:e}}function T0(e){return{explicit:!1,value:e}}function N0(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:R0(t,n,r,i)}}function R0(e,t,n,r){return e.explicit&&t.explicit&&uY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${cH(n)} and ${cH(r)}). Using ${cH(n)}.`}(n,r,e.value,t.value)),e}function P0(e,t,n,r,i=R0){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:oH(e.value,t.value)?e:i(e,t,n,r)}class z0 extends j0{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function B0(e){return"url"in e}function L0(e){return"values"in e}function I0(e){return"name"in e&&!B0(e)&&!L0(e)&&!q0(e)}function q0(e){return e&&(U0(e)||V0(e)||W0(e))}function U0(e){return"sequence"in e}function V0(e){return"sphere"in e}function W0(e){return"graticule"in e}var H0;function G0(e){return"filter"in e}function X0(e){return void 0!==(null==e?void 0:e.stop)}function Y0(e){return"lookup"in e}function J0(e){return"pivot"in e}function K0(e){return"density"in e}function Q0(e){return"quantile"in e}function Z0(e){return"regression"in e}function e1(e){return"loess"in e}function t1(e){return"sample"in e}function n1(e){return"window"in e}function r1(e){return"joinaggregate"in e}function i1(e){return"flatten"in e}function a1(e){return"calculate"in e}function o1(e){return"bin"in e}function s1(e){return"impute"in e}function l1(e){return"timeUnit"in e}function u1(e){return"aggregate"in e}function c1(e){return"stack"in e}function f1(e){return"fold"in e}function d1(e,t,n,r){const i=TK(t)&&t.condition,a=r(t);if(i){return{[n]:[...qu(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?P2(e,t.selection):B2(e,t.test);return Object.assign({test:i},n)})),...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function h1(e,t="text"){const n=e.encoding[t];return d1(e,n,t,(t=>p1(t,e.config)))}function p1(e,t,n="datum"){if(e){if(VK(e))return OQ(e.value);if(qK(e)){const{format:r,formatType:i}=aQ(e);return fK({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function m1(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(yu(o))return{tooltip:y1({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return d1(e,o,"tooltip",(e=>{const o=p1(e,i,s);if(o)return o;if(null===e)return;let l=AQ("tooltip",r,i);return!0===l&&(l={content:"encoding"}),hc(l)?{value:l}:vu(l)?$Y(l)?l:"encoding"===l.content?y1(n,a,i,t):{signal:s}:void 0}))}}function g1(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=aX(s),u=UK(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=qu(u.title||iQ(u,n)).join(", ");let f;if(hX(s)){const r="x"===s?"x2":"y2",o=oQ(e[r]);if(AX(u.bin)&&o){const e=JK(u,{expr:a}),t=JK(o,{expr:a}),{format:s,formatType:l}=aQ(u);f=bK(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=aQ(u);f=fK({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}f=null!=f?f:p1(u,n,a).signal,o.push({channel:s,key:c,value:f})}VQ(e,((e,t)=>{PK(e)?s(e,t):NK(e)&&s(e.condition,t)}));const l={};for(const{channel:e,key:t,value:n}of o)i[e]||l[t]||(l[t]=n);return l}function y1(e,t,n,{reactiveGeom:r}={}){const i=g1(e,t,n,{reactiveGeom:r}),a=EH(i).map((([e,t])=>`"${e}": ${t}`));return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function v1(e){const{markDef:t,config:n}=e,r=AQ("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=AQ("ariaRoleDescription",n,r);if(null!=i)return{ariaRoleDescription:{value:i}};return t in MY?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return d1(e,a,"description",(t=>p1(t,e.config)));const o=AQ("description",n,r);if(null!=o)return{description:OQ(o)};if(!1===r.aria)return{};const s=g1(t,i,r);if(kH(s))return;return{description:{signal:EH(s).map((([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`)).join(" + ")}}}(e))}function b1(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;void 0===s&&(l=null!=l?l:AQ(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=OQ(l)));const u=i[e];return d1(t,u,null!=o?o:e,(n=>sK({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function x1(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:AQ("filled",o,l),f=hH(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(i=null!==(r=AQ(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:f,h=null!==(a=AQ(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:OQ(d)}:{}),h?{stroke:OQ(h)}:{});return o.color&&(c?o.fill:o.stroke)&&uY(GX("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),b1("color",e,{vgChannel:p,defaultValue:c?d:h})),b1("fill",e,{defaultValue:s.fill?d:void 0})),b1("stroke",e,{defaultValue:s.stroke?h:void 0}))}function w1(e,t){const n=t[function(e){switch(e){case hG:return"xOffset";case pG:return"yOffset";case mG:return"x2Offset";case gG:return"y2Offset";case bG:return"thetaOffset";case yG:return"radiusOffset";case xG:return"theta2Offset";case vG:return"radius2Offset"}}(e)];if(n)return n}function _1(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[sX(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=w1(e,o),p=k1({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!u&&hX(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(qK(n)&&a&&t===a.fieldChannel){if(PK(n)){const e=jK({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return oK({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return aK(n,i,{suffix:"end"},{offset:o})}return tK(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return m?{[r||e]:m}:void 0}function k1({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=aX(n),l=oX(n),u=AQ(n,a,o,{vgChannel:l});if(void 0!==u)return lK(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(hH([QY,nJ,rJ],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[lX(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(H0||(H0={}));const O1={left:"x",center:"xc",right:"x2"},S1={top:"y",middle:"yc",bottom:"y2"};function E1(e,t,n,r="middle"){if("radius"===e||"theta"===e)return oX(e);const i="x"===e?"align":"baseline",a=AQ(i,t,n);let o;return $Y(a)?(uY(function(e){return`The ${e} for range marks cannot be an expression`}(i)),o=void 0):o=a,"x"===e?O1[o||("top"===r?"left":"center")]:S1[o||r]}function $1(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?A1(e,t,{defaultPos:n,defaultPos2:r}):_1(e,t,{defaultPos:n})}function A1(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=sX(e),s=lX(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=aX(n),u=lX(n),c=oX(n),f=r[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=w1(n in r||n in a?n:l,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){if(qK(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0))return aK(t,a,{suffix:"start"},{offset:l});return tK({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return D1(n,a)||D1(n,{[n]:CQ(n,a,s.style),[u]:CQ(u,a,s.style)})||D1(n,s[i])||D1(n,s.mark)||{[c]:k1({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}(t,r,o),u=l[s]?E1(e,i,a):oX(e);return Object.assign(Object.assign({},_1(e,t,{defaultPos:n,vgChannel:u})),l)}function D1(e,t){const n=lX(e),r=oX(e);return void 0!==t[r]?{[r]:lK(e,t[r])}:void 0!==t[e]?{[r]:lK(e,t[e])}:t[n]?{[n]:lK(e,t[n])}:void 0}function C1(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=sX(t),d=lX(t),h=l[t],p=l[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),v=u.orient,b=null!==(i=null!==(r=l[d])&&void 0!==r?r:l.size)&&void 0!==i?i:AQ("size",u,s,{vgChannel:d}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(PK(h)&&($X(h.bin)||AX(h.bin)||h.timeUnit&&!p)&&!b&&!bJ(g)){const n=jK({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=sX(n),f=oX(n),d=oX(c),h=w1(n,a);if($X(e.bin)||e.timeUnit)return{[d]:F1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:j1(c,o,l,s,h),config:u}),[f]:F1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:j1(n,o,l,s,h),config:u})};if(AX(e.bin)){const r=aK(e,i,{},{offset:j1(c,o,l,s,h)});if(PK(t))return{[d]:r,[f]:aK(t,i,{},{offset:j1(n,o,l,s,h)})};if(DX(e.bin)&&e.bin.step)return{[d]:r,[f]:{signal:`scale("${i}", ${JK(e,{expr:"datum"})} + ${e.bin.step})`,offset:j1(n,o,l,s,h)}}}return void uY(oY(c))}({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:y,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:hX(t)?AQ("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(qK(h)&&bJ(g)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),f=r.getScaleComponent(n),d=lX(n),h=sX(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=AQ(p?"size":d,a,s,{vgChannel:d});let g;(o.size||void 0!==m)&&(p?g=b1("size",r,{vgChannel:d,defaultValue:m}):uY(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const y=null!==(i=qK(t)?jK({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[d]:M1(e,d,c,f,s,y)};const v="band"!==(null==f?void 0:f.get("type"))||!("band"in g[d]),b=E1(n,a,s,v?"middle":"top"),x=w1(n,a),w=tK({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:x,defaultRef:k1({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-y)/2});if(d)return Object.assign({[b]:w},g);{const e=oX(h),t=g[d],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:yu(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,h,t,e):A1(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function M1(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===sJ){const e=r.get("range");return AY(e)&&fc(e.step)?{value:e.step-2}:{value:IZ-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=BZ(i.view,t),s=BH(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function j1(e,t,n,r,i){if(WG(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if($Y(n)||$Y(i)||$Y(r)){const e=EQ(n),t=EQ(i),o=EQ(r);return{signal:(o?`${o} + `:"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function F1({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return nK({fieldDef:t,channel:e,markDef:r,ref:oK({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const T1=new Set(["aria"]);function N1(e,t){const{fill:n,stroke:r}="include"===t.color?x1(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return CY.reduce(((n,r)=>(T1.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=OQ(e[r])),n)),{})}(e.markDef,t)),R1(e,"fill",n)),R1(e,"stroke",r)),b1("opacity",e)),b1("fillOpacity",e)),b1("strokeOpacity",e)),b1("strokeWidth",e)),b1("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!WJ(n)&&VK(r)?d1(e,r,"zindex",(e=>OQ(e.value))):{}}(e)),m1(e)),h1(e,"href")),v1(e))}function R1(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===AQ("invalid",a,r)&&n&&!WJ(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&xJ(i)&&(t[a]=!0)}return t}),{}),i=OH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>iK(e,t))).join(` ${e} `)}return}(e,{invalid:!0,channels:xX});if(r)return{[t]:[{test:r,value:null},...qu(n)]}}return n?{[t]:n}:{}}function P1(e){const{config:t,markDef:n}=e;if(AQ("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&xJ(i)&&(t[a]=!0)}return t}),{}),i=OH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>iK(e,t))).join(` ${e} `)}return}(e,{channels:dX});if(t)return{defined:{signal:t}}}return{}}function z1(e,t){if(void 0!==t)return{[e]:OQ(t)}}const B1="voronoi",L1={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(B1)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(WJ(a))return uY(`The "nearest" transform is not supported for ${a} marks.`),n;const o={name:e.getName(B1),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},m1(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(B1)>=0&&(l=!0)})),l||n.splice(s+1,0,o),n}};class I1{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?uY("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class q1 extends I1{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${IH()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var U1=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class V1 extends I1{constructor(e,t){super(e),this.formula=t}clone(){return new V1(null,sH(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,o=y4(t)?t.encoding[sX(r)]:void 0,s=y4(t)&&FK(r,n,o,t.stack,t.markDef,t.config);if(a){const t=JK(n,{forAs:!0});e[fH({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return kH(n)?null:new V1(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=U1(n,["timeUnit"]),a=EY(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new V1(e,{[fH(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of EH(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(SH(this.formula).map((e=>e.as)))}dependentFields(){return new Set(SH(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${fH(this.formula)}`}assemble(){const e=[];for(const t of SH(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=EY(i),{unit:o,utc:s}=a,l=U1(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:NH(n),type:"timeunit"},o?{units:_Y(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return e}}var W1=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const H1="_tuple_fields";class G1{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const X1={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!DZ(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=L1.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var l,u;const c=AH(`${r}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:h2(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${wc(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+S2))[0],o=r+H1,s=i.items.map((e=>AH(`${r}_${e.field}`))),l=s.map((e=>`${e} !== null`)).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},Y1="_toggle",J1={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Y1,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+S2,r=t.name+Y1;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${C2(e)}}, `)+`${r} ? ${n} : null`}},K1={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=hc(n.clear)?nq(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(X1.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===AH(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));if(r(t,"[0, 0]"),-1===t){r(n.findIndex((t=>t.name===e.signals.data)),"null")}}else{let e=n.findIndex((e=>e.name===t.name+S2));r(e,"null"),J1.has(t)&&(e=n.findIndex((e=>e.name===t.name+Y1)),r(e,"false"))}return n}},Q1={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!wX(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!xJ(o)){uY("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:t.name,field:r.field};a.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||e2(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf($2)>=0)i.update=`{${r.map((e=>`${wc(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${wc(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!e2(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function Z1(e,t){return`domain(${wc(e.scaleName(t))})`}function e2(e){var t;return e.parent&&x4(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:e2(e.parent.parent))}const t2={has:e=>{const t="global"===e.resolve&&e.bind&&DZ(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==$Z;return t&&!n&&uY("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=qu(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=CZ(t.bind)?t.bind.legend:"click",o=hc(a)?nq(a,"view"):qu(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=CZ(t.bind)&&t.bind.legend,a=e=>t=>{const n=sH(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const o=`${AH(e.field)}_legend`,s=`${r}_${o}`;if(0===n.filter((e=>e.name===s)).length){const e=i.merge.map(a(`${o}_symbols`)).concat(i.merge.map(a(`${o}_labels`))).concat(i.merge.map(a(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+S2)),o=r+H1,s=i.items.filter((e=>e.hasLegend)).map((e=>AH(`${r}_${AH(e.field)}_legend`))),l=`${s.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map((e=>({signal:e}))),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find((e=>e.name===r+Y1)),c=CZ(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}};const n2="_translate_anchor",r2="_translate_delta",i2={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=Q1.has(t),a=r+n2,{x:o,y:s}=t.project.hasChannel;let l=nq(t.translate,"scope");return i||(l=l.map((e=>(e.between[0].markname=r+y2,e)))),n.push({name:a,value:{},on:[{events:l.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?Z1(e,hG):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?Z1(e,pG):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+r2,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&a2(e,t,o,"width",n),void 0!==s&&a2(e,t,s,"height",n),n}};function a2(e,t,n,r,i){var a;const o=t.name,s=o+n2,l=o+r2,u=n.channel,c=Q1.has(t),f=i.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],d=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(u),p=h.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===hG?"-":""}${l}.${u} / `+(c?`${d}`:`span(${m})`)}`+(c&&"pow"===p?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${d})`})}const o2="_zoom_anchor",s2="_zoom_delta",l2={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=Q1.has(t),a=r+s2,{x:o,y:s}=t.project.hasChannel,l=wc(e.scaleName(hG)),u=wc(e.scaleName(pG));let c=nq(t.zoom,"scope");return i||(c=c.map((e=>(e.markname=r+y2,e)))),n.push({name:r+o2,on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&u2(e,t,o,"width",n),void 0!==s&&u2(e,t,s,"height",n),n}};function u2(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=Q1.has(t),u=i.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?Z1(e,s):u.name,p=o+s2,m=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${h}, ${`${o}${o2}.${s}`}, ${p}`+(l&&"pow"===d?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const c2=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new G1,l={},u={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=AH(`${o}_${n}`);for(let e=1;c.has(r);e++)r=AH(`${o}_${n}_${e}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of qu(n.init))for(const r of OH(e))tX[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(uY('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),s.items.push(t),s.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){uY(BX(r,n.aggregate));continue}if(!i){uY(zX(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};u[fH(t)]=t}if(!l[i]){let a="E";if("interval"===t.type){xJ(e.getScaleComponent(r).get("type"))&&(a="R")}else n.bin&&(a="R-RE");const o={field:i,channel:r,type:a};o.signals=Object.assign(Object.assign({},f(o,"data")),f(o,"visual")),s.items.push(l[i]=o),s.hasField[i]=s.hasChannel[r]=l[i]}}else uY(zX(r))}if(n.init){const e=e=>s.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=qu(n.init);t.init=r.map(e)}}kH(u)||(s.timeUnit=new V1(null,u))},signals:(e,t,n)=>{const r=t.name+H1;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const t=W1(e,["signals","hasLegend"]);return t.field=NH(t.field),t}))})}},J1,Q1,t2,i2,l2,X1,L1,K1];function f2(e,t){for(const n of c2)n.has(e)&&t(n)}var d2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function h2(e,t=!0,n=cu){if(yu(e)){const r=e.map((e=>h2(e,t,n)));return t?`[${r.join(", ")}]`:r}return cY(e)?n(t?gY(e):function(e){const t=mY(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function p2(e,t){return D2(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,f2(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function m2(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}var g2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const y2="_brush",v2="_scale_trigger",b2={signals:(e,t)=>{const n=t.name,r=n+H1,i=Q1.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${wc(n+y2)}`;x2(t,((t,n)=>{var r;const i=qu(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==hG&&i!==pG)return void uY("Interval selections only support x and y encoding channels.");const l=t.init?t.init[r]:null,u=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=Q1.has(t),l=wc(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,f=e=>`scale(${l}, ${e})`,d=e.getSizeSignalRef(i===hG?"width":"height").signal,h=`${i}(unit)`,p=x2(t,((e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]));return p.push({events:{signal:t.name+v2},update:xJ(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:h2(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:h2(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,l),c=n.signals.data,f=n.signals.visual,d=wc(e.scaleName(i)),h=xJ(e.getScaleComponent(i).get("type"))?"+":"";a.push(...u),o.push(c),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${c}) || (${h}invert(${d}, ${f})[0] === ${h}${c}[0] && ${h}invert(${d}, ${f})[1] === ${h}${c}[1]))`})})),i||a.push({name:n+v2,value:{},on:[{events:s.map((e=>({scale:e.scaleName}))),update:s.map((e=>e.expr)).join(" && ")+` ? ${n+v2} : {}`}]});const l=t.init,u=`unit: ${C2(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+S2},l?{init:`{${u}: ${h2(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+S2+", "+("global"===t.resolve?"true":`{unit: ${C2(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${wc(t.name+O2)})`;if(Q1.has(t))return n;const u={x:void 0!==i?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of OH(u))u[t]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${C2(e)}`},u[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=g2(c,["fill","fillOpacity","cursor"]),m=OH(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:r+y2+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:r+y2,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function x2(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(uY(`${n} is not an ordered event stream for interval selections.`),e)),[])}function w2(e,t){const n=t.name,r=n+H1,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${wc(e.vgField(t.channel,{}))}], ${a}[${wc(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${wc(t.field)}]`})).join(", "),s=`unit: ${C2(e)}, fields: ${r}, values`,l=t.events;return[{name:n+S2,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const _2={signals:w2,modifyExpr:(e,t)=>t.name+S2+", "+("global"===t.resolve?"null":`{unit: ${C2(e)}}`)},k2={signals:w2,modifyExpr:(e,t)=>t.name+S2+", "+("global"===t.resolve?"true":`{unit: ${C2(e)}}`)},O2="_store",S2="_tuple",E2="_modify",$2="vlSelectionResolve",A2={single:k2,multi:_2,interval:b2};function D2(e,t){const n=e.component.selection;if(n)for(const e of SH(n)){if(!0===t(e,A2[e.type]))break}}function C2(e,{escape:t}={escape:!0}){let n=t?wc(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!v4(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of KG)e[t]&&(n+=` + '__facet_${t}_' + (facet[${wc(r.vgField(t))}])`)}return n}function M2(e){let t=!1;return D2(e,(e=>{t=t||e.project.items.some((e=>e.field===$Z))})),t}function j2(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...j2(e.object)),t.push(...j2(e.property))),t)}function F2(e){return"MemberExpression"===e.object.type?F2(e.object):"datum"===e.object.name}function T2(e){const t=nL(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&F2(e)&&n.add(j2(e).slice(1).join("."))})),n}class N2 extends I1{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=B2(this.model,this.filter,this),this._dependentFields=T2(this.expr)}clone(){return new N2(null,this.model,sH(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var R2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function P2(e,t,n,r="datum"){const i=[];const a=DH(t,(function(t){const a=AH(t),o=e.getSelectionComponent(a,t),s=wc(a+O2);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${wc(o.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function z2(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,uY((i.length?"Multiple ":"No ")+`matching ${wc(n)} encoding found for selection ${wc(t.selection)}. `+`Using "field": ${wc(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&uY(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${wc(r)}.`);return`${e.name}[${wc(r)}]`}function B2(e,t,n){return DH(t,(t=>hc(t)?t:function(e){return null==e?void 0:e.selection}(t)?P2(e,t.selection,n):qY(t)))}var L2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function I2(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function q2(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=L2(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in h){const n=YH[e],r=h[e];if(n&&n!==t&&"both"!==n)delete h[e];else if(GH(r)){const{condition:t}=r,n=L2(r,["condition"]),i=qu(t),a=HH[e];if(a){const{vgProp:t,part:r}=a;I2(h,r,t,[...i.map((e=>{const{test:t}=e,n=L2(e,["test"]);return Object.assign({test:B2(null,t)},n)})),n]),delete h[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=L2(e,["test"]);return`${B2(null,t)} ? ${SQ(n)} : `})).join("")+SQ(n)};h[e]=t}}else if($Y(r)){const t=HH[e];if(t){const{vgProp:n,part:i}=t;I2(h,i,n,r),delete h[e]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),kH(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:BH(d,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=h.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&$Y(h.encode.labels.update.text)&&(e=RH(c,"datum.label",h.encode.labels.update.text.signal)),I2(h,"labels","text",{signal:e})}if(null===h.labelAlign&&delete h.labelAlign,h.encode){for(const t of XH)e.hasAxisPart(t)||delete h.encode[t];kH(h.encode)&&delete h.encode}const t=function(e,t){if(e)return yu(e)&&!bQ(e)?e.map((e=>iQ(e,t))).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),h),!1===n.aria?{aria:!1}:{}),{zindex:BH(d,0)})}}}function U2(e){const{axes:t}=e.component,n=[];for(const r of dX)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function V2(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...OH(i),...OH(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${EQ(i[t])} : ${EQ(a[t])}`};return s}return t[e]}))])}function W2(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:function(e){return e in mJ}(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=$Y(n)?"axisOrient":"axis"+MH(n),s=[...i,...i.map((e=>a+e.substr(4)))],l=["axis",o,a];return{vlOnlyAxisConfig:V2(s,r,e,n),vgAxisConfig:V2(l,r,e,n),axisConfigStyle:H2([...l,...s],r)}}function H2(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=qu(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function G2(e,t,n,r={}){var i;const a=MQ(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const X2={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return pK(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return mK(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!PK(e)||!AX(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!bJ(e)&&PK(t)&&!$X(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||K2(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||J2(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&hH(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!vu(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy";return}(t.type,n,PK(t)&&!!t.timeUnit,PK(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!bJ(t)&&"log"!==t){if(PK(e)){if($X(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&hH(["month","hours","day","quarter"],null===(i=EY(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=Q2(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",o=t.fieldDef(a);return FQ(i?[CK(i)]:[],PK(o)?[CK(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(yu(n))return mQ(t,n);if($Y(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){if("rect"===e&&KK(t))return 1;return 0}(n,t)}};function Y2(e){return`(((${e.signal} % 360) + 360) % 360)`}function J2(e,t,n,r){if(void 0!==e){if("x"===n){if($Y(e)){const n=Y2(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${$Y(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if($Y(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if($Y(e)){const n=Y2(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${$Y(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if($Y(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function K2(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if($Y(e)){const n=Y2(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${$Y(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if($Y(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${n} "${a}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function Q2(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?TQ(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}class Z2 extends I1{constructor(e,t){super(e),this.transform=t,this._dependentFields=T2(this.transform.calculate)}clone(){return new Z2(null,sH(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(WK(t)&&SK(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map(((e,t)=>`${qY({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new Z2(e,{calculate:o,as:e3(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${fH(this.transform)}`}}function e3(e,t,n){return JK(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function t3(e,t){return hH(["top","bottom"],t)?"column":hH(["left","right"],t)||"row"===e?"row":"column"}function n3(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return BH((t||{})[e],i[e],n.header[e])}function r3(e,t,n,r){const i={};for(const a of e){const e=n3(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const i3=["row","column"],a3=["header","footer"];function o3(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=r3(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=t3(t,s),u=VH(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),l3(u,l)),s3(l,u,a)),m3(r,i,t,wZ,bZ))}}function s3(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=K2(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function l3(e,t){const n=J2(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function u3(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of a3)if(n[i])for(const a of n[i]){const o=d3(e,t,i,n,a);null!=o&&r.push(o)}return r}function c3(e,t){var n;const{sort:r}=e;return OK(r)?{field:JK(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:yu(r)?{field:e3(e,t,{expr:"datum"}),order:"ascending"}:{field:JK(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function f3(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=r3(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=fK({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=t3(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?RH(RH(l,"datum.label",u),"datum.value",JK(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),l3(a,c)),s3(c,a,o)),m3(n,e,t,_Z,xZ))}function d3(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=r3(["labelOrient"],o.header,s,t);("row"===t&&!hH(["top","bottom"],e)||"column"===t&&!hH(["left","right"],e))&&(a=f3(o,t,s))}const l=v4(e)&&!EK(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:c3(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const h3={column:{start:0,end:1},row:{start:1,end:0}};function p3(e,t){return h3[t][e]}function m3(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=n3(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function g3(e){return[...y3(e,"width"),...y3(e,"height"),...y3(e,"childWidth"),...y3(e,"childHeight")]}function y3(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(bJ(r)&&AY(a)){const r=e.scaleName(n);if(v4(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[v3(r,a)]}return[v3(r,a),{name:i,update:b3(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${zZ(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function v3(e,t){return{name:e+"_step",value:t.step}}function b3(e,t,n){const r=t.get("type"),i=t.get("padding"),a=BH(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${EQ(o)}, ${EQ(a)}) * ${e}_step`}function x3(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function w3(e,t){return OH(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),d1(t,i,r,(e=>OQ(e.value))))}),{})}function _3(e,t){if(x4(t)||v4(t))return"shared";if(b4(t))return hX(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function k3(e,t){const n=e.scale[t],r=hX(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&uY(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const O3=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),S3=OH(O3);class E3 extends j0{}const $3={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,f,d,h;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:y}=n,v=p.filled&&"trail"!==y;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=DQ(r,t.markDef,t.config);void 0!==n&&(e[r]=OQ(n))}return e}({},n,YJ)),x1(n,{filled:v}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,k=void 0===x?null!==(u=A3(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||v&&r===SG)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=OQ(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=OQ(null!=k?k:1));else if(yu(b.fill)){const e=null!==(h=null!==(d=D3(null!==(f=m.fill)&&void 0!==f?f:m.color))&&void 0!==d?d:p.fill)&&void 0!==h?h:v&&p.color;e&&(b.fill=OQ(e))}if(b.stroke)if("stroke"===r||!v&&r===SG)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(yu(b.stroke)){const e=BH(D3(m.stroke||m.color),p.stroke,v?p.color:void 0);e&&(b.stroke={value:e})}if(r!==MG){const e=PK(t)&&M3(n,i,t);e?b.opacity=[Object.assign({test:e},OQ(null!=k?k:1)),OQ(g.legend.unselectedOpacity)]:k&&(b.opacity=OQ(k))}return b=Object.assign(Object.assign({},b),e),kH(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?A3(s.opacity)||o.opacity:void 0;u&&(l.opacity=OQ(u));return l=Object.assign(Object.assign({},l),e),kH(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=PK(t)?M3(n,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=uK(c)?hK({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return kH(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function A3(e){return C3(e,((e,t)=>Math.max(e,t.value)))}function D3(e){return C3(e,((e,t)=>BH(e,t.value)))}function C3(e,t){return function(e){const t=e&&e.condition;return!!t&&(yu(t)||VK(t))}(e)?qu(e.condition).reduce(t,e.value):VK(e)?e.value:void 0}function M3(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=wc(n.field);return r.map((e=>`(!length(data(${wc(AH(e)+O2)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const j3={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return pK(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return mK(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(wJ(i))return"horizontal"===n?"top"===r||"bottom"===r?N3(t,"width",o,a):o:N3(t,"height",l,s);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(hH(["quantile","threshold","log","symlog"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=D3(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>nQ(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(YG(n)&&wJ(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(yu(n))return mQ(t,n);if($Y(n))return n;return}(t,e)};function F3(e){const{legend:t}=e;return BH(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(YG(e)){if(hH(["quarter","month","day"],t))return"symbol";if(wJ(n))return"gradient"}return"symbol"}(e))}function T3({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function N3(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function R3(e){const t=y4(e)?function(e){const{encoding:t}=e,n={};for(const r of[SG,...OZ]){const i=sQ(t[r]);i&&e.getScaleComponent(r)&&(r===AG&&PK(i)&&i.type===YY||(n[r]=z3(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){R3(r);for(const i of OH(r.component.legends))n.legend[i]=k3(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=B3(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of OH(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function P3(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function z3(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new E3({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;D2(e,(e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&t2.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}}))}(e,t,c);const f=void 0!==a?!a:u.disable;if(c.set("disable",f,void 0!==a),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=sQ(s[t]),p=PK(h)?null===(n=EY(h.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=F3({legend:a,channel:t,timeUnit:p,scaleType:d}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:m,legendType:g,direction:T3({legend:a,legendType:g,orient:m,legendConfig:u})};for(const n of S3){if("gradient"===g&&n.startsWith("symbol")||"symbol"===g&&n.startsWith("gradient"))continue;const r=n in j3?j3[n](y):a[n];if(void 0!==r){const i=P3(r,n,a,e.fieldDef(t));(i||void 0===l.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=w3(null!==(i=v[t])&&void 0!==i?i:{},e),r=t in $3?$3[t](n,w):n;void 0===r||kH(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&PK(h)?{name:`${AH(h.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return kH(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function B3(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const n of S3){const r=P0(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return L3(e,t);case"title":return NQ(e,t);case"type":return l=!0,T0("symbol")}return R0(e,t,n,"legend")}));e.setWithExplicit(n,r)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&CH(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&CH(e.explicit,["encode","gradient"])),e}function L3(e,t){return"circle"===t.value?t:e}var I3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function q3(e){const t=e.component.legends,n={};for(const r of OH(t)){const i=e.getScaleComponent(r),a=cH(i.get("domains"));if(n[a])for(const e of n[a]){B3(e,t[r])||n[a].push(t[r])}else n[a]=[t[r].clone()]}return SH(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=I3(a,["disable","labelExpr","selections"]);if(o)return;!1===t.aria&&null==u.aria&&(u.aria=!1);if(null===(n=u.encode)||void 0===n?void 0:n.symbols){const e=u.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||u.stroke||(e.stroke={value:"transparent"});for(const t of OZ)u[t]&&delete e[t]}u.title||delete u.title;if(void 0!==s){let e=s;(null===(i=null===(r=u.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&$Y(u.encode.labels.update.text)&&(e=RH(s,"datum.label",u.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}(u,"labels","text",{signal:e})}return u}(t,e.config))).filter((e=>void 0!==e))}function U3(e){return x4(e)||b4(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),V3(e))}(e):V3(e)}function V3(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=$Y(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return hH(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const W3=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class H3 extends j0{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function G3(e){e.component.projection=y4(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[_G,wG],[OG,kG]])(sQ(n[r[0]])||sQ(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});e.channelHasField(AG)&&e.typedFieldDef(AG).type===YY&&t.push({signal:e.getName(`geojson_${t.length}`)});0===t.length&&t.push(e.requestDataName(H0.Main));return t}(e):void 0;return new H3(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)G3(t);const n=mH(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=mH(W3,(n=>!nc(e.explicit,n)&&!nc(t.explicit,n)||!(!nc(e.explicit,n)||!nc(t.explicit,n)||cH(e.get(n))!==cH(t.get(n)))));if(cH(e.size)===cH(t.size)){if(n)return e;if(cH(e.explicit)===cH({}))return t;if(cH(t.explicit)===cH({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new H3(n,t.specifiedProjection,t.size,sH(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}return}(e)}var X3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Y3(e,t){return`${EX(e)}_${t}`}function J3(e,t,n){var r;const i=Y3(null!==(r=fQ(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function K3(e,t,n){let r,i;r=function(e){return"as"in e}(e)?hc(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[JK(e,{forAs:!0}),JK(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},fQ(t,void 0)),o=Y3(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,o);if(CX(a.extent)){const e=a.extent,t=e.selection;i=z2(n.getSelectionComponent(AH(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class Q3 extends I1{constructor(e,t){super(e),this.bins=t}clone(){return new Q3(null,sH(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(UK(n)&&$X(n.bin)){const{key:i,binComponent:a}=K3(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(gQ(t,n)){const o=y4(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=JK(t,{expr:"datum"}),l=JK(t,{expr:"datum",binSuffix:"end"});return{formulaAs:JK(t,{binSuffix:"range",forAs:!0}),formula:bK(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return kH(n)?null:new Q3(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=K3(t,t.bin,n);return new Q3(e,{[r]:i})}merge(e,t){for(const n of OH(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=vH([...this.bins[n].as,...e.bins[n].as],fH)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(SH(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(SH(this.bins).map((e=>e.field)))}hash(){return`Bin ${fH(this.bins)}`}assemble(){return SH(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=X3(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:NH(e.field),as:n,signal:e.signal},CX(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:NH(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:JK({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}function Z3(e,t,n,r){const i=y4(r)?r.encoding[sX(t)]:void 0;if(UK(n)&&y4(r)&&FK(t,n,i,r.stack,r.markDef,r.config))e.add(JK(n,{})),e.add(JK(n,{suffix:"end"})),n.bin&&gQ(n,t)&&e.add(JK(n,{binSuffix:"range"}));else if(function(e){return e in HG}(t)){const n=function(e){switch(e){case wG:return"y";case kG:return"y2";case _G:return"x";case OG:return"x2"}}(t);e.add(r.getName(n))}else e.add(JK(n));return e}class e5 extends I1{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new e5(null,new Set(this.dimensions),sH(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([JK(e,{forAs:!0})]);else{if(nG(u)||rG(u)){const e=nG(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([JK({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([JK(e,{forAs:!0})]);wX(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([JK({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([JK({field:c,aggregate:"max"},{forAs:!0})]))}else Z3(i,n,e,t)})),i.size+OH(r).length===0?null:new e5(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([a||JK(e,{forAs:!0})])):(o[i]=null!==(r=o[i])&&void 0!==r?r:{},o[i][t]=new Set([a||JK(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+OH(o).length===0?null:new e5(e,a,o)}merge(e){return bH(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of OH(t)){const i=t[r];for(const t of OH(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){lY.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...OH(this.measures)])}producedFields(){const e=new Set;for(const t of OH(this.measures))for(const n of OH(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${fH({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of OH(this.measures))for(const i of OH(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:NH(r));return{type:"aggregate",groupby:[...this.dimensions].map(NH),ops:e,fields:t,as:n}}}class t5 extends I1{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of KG){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[JK(n),...$X(r)?[JK(n,{binSuffix:"end"})]:[]]},OK(i)?{sortField:i}:yu(i)?{sortIndexField:e3(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of KG)this[t]&&(e+=` ${t.charAt(0)}:${fH(this[t])}`);return e}get fields(){var e;const t=[];for(const n of KG)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of KG)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of dX){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(bJ(r)&&AY(i)){const n=X5(Y5(this.childModel,t));n?e[t]=n:uY(PX(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=xK,field:t}=s;i.push(t),a.push(e),o.push(JK(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const e of i3){for(const r of a3){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[e]=!0;break}}if(o[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const e of[fG,cG])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function n5(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function r5(e){const t={};return iH(e.filter,(e=>{var n;if(LY(e)){let r=null;FY(e)?r=_Q(e.equal):NY(e)?r=_Q(e.lte):TY(e)?r=_Q(e.lt):RY(e)?r=_Q(e.gt):PY(e)?r=_Q(e.gte):zY(e)?r=e.range[0]:BY(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(cY(r)?t[e.field]="date":fc(r)?t[e.field]="number":hc(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}function i5(e){const t={};function n(e){var n;hQ(e)?t[e.field]="date":"quantitative"===e.type&&(hc(n=e.aggregate)&&hH(["min","max"],n))?t[e.field]="number":zH(e.field)>1?e.field in t||(t[e.field]="flatten"):WK(e)&&OK(e.sort)&&zH(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((y4(e)||v4(e))&&e.forEachFieldDef(((t,r)=>{if(UK(t))n(t);else{const i=aX(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),y4(e)){const{mark:n,markDef:r,encoding:i}=e;if(WJ(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];PK(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class a5 extends I1{constructor(e,t){super(e),this._parse=t}clone(){return new a5(null,sH(this._parse))}hash(){return`Parse ${fH(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!q0(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of OH(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:uY(UX(e,n[e],t.value)))}for(const e of OH(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:uY(UX(e,t[e],n)))}const i=new j0(t,n);r.copyAll(i);const a={};for(const e of OH(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===OH(a).length||r.parseNothing?null:new a5(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of OH(this._parse)){const n=this._parse[t];1===zH(t)&&(e[t]=n)}return e}producedFields(){return new Set(OH(this._parse))}dependentFields(){return new Set(OH(this._parse))}assembleTransforms(e=!1){return OH(this._parse).filter((t=>!e||zH(t)>1)).map((e=>{const t=function(e,t){const n=jH(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:"))return`timeParse(${n},'${n5(t.slice(5,t.length))}')`;if(0===t.indexOf("utc:"))return`utcParse(${n},'${n5(t.slice(4,t.length))}')`;return uY(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:PH(e)}})).filter((e=>null!==e))}}class o5 extends I1{clone(){return new o5(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([$Z])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:$Z}}}class s5 extends I1{constructor(e,t){super(e),this.params=t}clone(){return new s5(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${fH(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class l5 extends I1{constructor(e,t){super(e),this.params=t}clone(){return new l5(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${fH(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class u5 extends I1{constructor(e){let t;if(super(null),q0(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},uH(e.format,["parse"])):{}),L0(e))this._data={values:e.values};else if(B0(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];hH(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else V0(e)?this._data={values:[{type:"Sphere"}]}:(I0(e)||q0(e))&&(this._data={});this._generator=q0(e),e.name&&(this._name=e.name),t&&!kH(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var c5,f5=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},d5=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};function h5(e){return e instanceof u5||e instanceof s5||e instanceof l5}class p5{constructor(){c5.set(this,void 0),f5(this,c5,!1)}setModified(){f5(this,c5,!0)}get modifiedFlag(){return d5(this,c5)}}c5=new WeakMap;class m5 extends p5{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort(((e,t)=>t[1]-e[1]));for(const e of t)this.run(e[0]);return this.modifiedFlag}}class g5 extends p5{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class y5 extends g5{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of OH(n))n[t].length>1&&(this.setModified(),this.mergeNodes(e,n[t]))}}class v5 extends g5{constructor(e){super(),this.requiresSelectionId=e&&M2(e)}run(e){e instanceof o5&&(this.requiresSelectionId&&(h5(e.parent)||e.parent instanceof e5||e.parent instanceof a5)||(this.setModified(),e.remove()))}}class b5 extends p5{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof V1&&(n=e.producedFields(),xH(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class x5 extends g5{constructor(){super()}run(e){e instanceof q1&&!e.isRequired()&&(this.setModified(),e.remove())}}class w5 extends m5{run(e){if(!(h5(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof a5)if(e instanceof a5)this.setModified(),e.merge(t);else{if(_H(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class _5 extends m5{run(e){const t=[...e.children],n=e.children.filter((e=>e instanceof a5));if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of OH(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!kH(r)){this.setModified();const n=new a5(e,r);for(const i of t){if(i instanceof a5)for(const e of OH(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof a5&&0===OH(i.parse).length&&i.remove()}}}}}class k5 extends m5{run(e){e instanceof q1||e.numChildren()>0||e instanceof t5||e instanceof u5||(this.setModified(),e.remove())}}class O5 extends m5{run(e){const t=e.children.filter((e=>e instanceof V1)),n=t.pop();for(const e of t)this.setModified(),n.merge(e)}}class S5 extends m5{run(e){const t=e.children.filter((e=>e instanceof e5)),n={};for(const e of t){const t=fH(e.groupBy);t in n||(n[t]=[]),n[t].push(e)}for(const t of OH(n)){const r=n[t];if(r.length>1){const t=r.pop();for(const n of r)t.merge(n)&&(e.removeChild(n),n.parent=t,n.remove(),this.setModified())}}}}class E5 extends m5{constructor(e){super(),this.model=e}run(e){const t=!(h5(e)||e instanceof N2||e instanceof a5||e instanceof o5),n=[],r=[];for(const i of e.children)i instanceof Q3&&(t&&!_H(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof Q3?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class $5 extends m5{run(e){const t=[...e.children];if(!pH(t,(e=>e instanceof q1))||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof q1){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof q1))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class A5 extends I1{constructor(e,t){super(e),this.transform=t}clone(){return new A5(null,sH(this.transform))}addDimensions(e){this.transform.groupby=vH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:JK(e)}hash(){return`JoinAggregateTransform ${fH(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class D5 extends I1{constructor(e,t){super(e),this._stack=t}clone(){return new D5(null,sH(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const e of t.sort)o.push(e.field),s.push(BH(e.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return yu(e)&&e.every((e=>hc(e)))&&e.length>1}(i)?i:hc(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new D5(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;if(i){l=oQ(r[i])}const u=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=JK(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let f;return f=yu(c)||PK(c)?jQ(c):u.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new D5(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${fH(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[JK(e,{binSuffix:"mid"})]:[JK(e,{}),JK(e,{binSuffix:"end"})]:[JK(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+JK(n,{expr:"datum"})+`+${1-a}*`+JK(n,{expr:"datum",binSuffix:"end"}),as:JK(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:JK(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class C5 extends I1{constructor(e,t){super(e),this.transform=t}clone(){return new C5(null,sH(this.transform))}addDimensions(e){this.transform.groupby=vH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:JK(e)}hash(){return`WindowTransform ${fH(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>iG(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)s.push(t.field),l.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:u},void 0!==c?{ignorePeers:c}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function M5(e){if(e instanceof t5)if(1!==e.numChildren()||e.children[0]instanceof q1){const n=e.model.component.data.main;j5(n);const r=(t=e,function e(n){if(!(n instanceof t5)){const r=n.clone();if(r instanceof q1){const e=F5+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof e5||r instanceof D5||r instanceof C5||r instanceof A5)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof e5||t instanceof D5||t instanceof C5||t instanceof A5)&&t.addDimensions(e.fields),t.swapWithParent(),M5(e)}else e.children.map(M5);var t}function j5(e){if(e instanceof q1&&e.type===H0.Main&&1===e.numChildren()){const t=e.children[0];t instanceof t5||(t.swapWithParent(),j5(e))}}const F5="scale_";function T5(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!T5(t.children))return!1}return!0}function N5(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function R5(e,t,n){let r=e.sources,i=!1;return i=N5(new x5,r)||i,i=N5(new v5(t),r)||i,r=r.filter((e=>e.numChildren()>0)),i=N5(new k5,r)||i,r=r.filter((e=>e.numChildren()>0)),n||(i=N5(new w5,r)||i,i=N5(new E5(t),r)||i,i=N5(new b5,r)||i,i=N5(new _5,r)||i,i=N5(new S5,r)||i,i=N5(new O5,r)||i,i=N5(new y5,r)||i,i=N5(new $5,r)||i),e.sources=r,i}class P5{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new P5((()=>e(t)))}}var z5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function B5(e){y4(e)?function(e){const t=e.component.scales;for(const n of OH(t)){const r=L5(e,n);if(t[n].setWithExplicit("domains",r),V5(e,n),e.component.data.isFaceted){let t=e;for(;!v4(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)DY(e)&&(e.data=F5+e.data.replace(F5,""))}}}(e):function(e){for(const t of e.children)B5(t);const t=e.component.scales;for(const n of OH(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):P0(r,e.getWithExplicit("domains"),"domains","scale",H5);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&uY(IX),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function L5(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=W5(t,n);if(!e)return void uY(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=W5(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&sQ(r.x2)?sQ(r.x)?P0(q5(n,i,e,"x"),q5(n,i,e,"x2"),"domain","scale",H5):q5(n,i,e,"x2"):"y"===t&&sQ(r.y2)?sQ(r.y)?P0(q5(n,i,e,"y"),q5(n,i,e,"y2"),"domain","scale",H5):q5(n,i,e,"y2"):q5(n,i,e,t)}function I5(e,t,n){var r;const i=null===(r=EY(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${pQ(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function q5(e,t,n,r){const{encoding:i}=n,a=sQ(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=q5(e,void 0,n,r),a=I5(t.unionWith,o,s);return F0([...i.value,...a])}if($Y(t))return F0([t]);if(t&&"unaggregated"!==t&&!kJ(t))return F0(I5(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return T0([[0,1]]);const e=n.requestDataName(H0.Main);return T0([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=wX(r)&&PK(a)?function(e,t,n){if(!bJ(n))return;const r=e.fieldDef(t),i=r.sort;if(SK(i))return{op:"min",field:e3(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(OK(i)){return U5(i,a&&!hH(o,i.field))}if(kK(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!hH(o,l);if(nG(s)||rG(s))return U5({field:JK(r),order:n},u);if(iG(s)||!s)return U5({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(hH(["ascending",void 0],i))return!0}return}(n,r,e):void 0;if(BK(a)){return T0(I5([a.datum],o,s))}const c=a;if("unaggregated"===t){const e=n.requestDataName(H0.Main),{field:t}=a;return T0([{data:e,field:JK({field:t,aggregate:"min"})},{data:e,field:JK({field:t,aggregate:"max"})}])}if($X(c.bin)){if(bJ(e))return T0("bin-ordinal"===e?[]:[{data:$H(u)?n.requestDataName(H0.Main):n.requestDataName(H0.Raw),field:n.vgField(r,gQ(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&vu(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if($X(e)){const t=J3(n,c.field,e);return T0([new P5((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return T0([{data:n.requestDataName(H0.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&hH(["time","utc"],e)&&FK(r,c,y4(n)?n.encoding[sX(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(H0.Main);return T0([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return T0(u?[{data:$H(u)?n.requestDataName(H0.Main):n.requestDataName(H0.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(H0.Main),field:n.vgField(r)}])}function U5(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":xK},r?{field:NH(r)}:{}),i?{order:i}:{})}function V5(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=kJ(i)&&i,s=DX(a)&&CX(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function W5(e,t){const{aggregate:n,type:r}=e;return n?hc(n)&&!lG[n]?{valid:!1,reason:ZX(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:eY(e)}:{valid:!0}:{valid:!1,reason:QX(e)}}function H5(e,t,n,r){return e.explicit&&t.explicit&&uY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${cH(n)} and ${cH(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function G5(e){const t=vH(e.map((e=>{if(DY(e)){return z5(e,["sort"])}return e})),fH),n=vH(e.map((e=>{if(DY(e)){const t=e.sort;return void 0===t||$H(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),fH);if(0===t.length)return;if(1===t.length){const t=e[0];if(DY(t)&&n.length>0){let e=n[0];if(n.length>1)uY(rY),e=!0;else if(vu(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=vH(n.map((e=>$H(e)||!("op"in e)||hc(e.op)&&e.op in tG?e:(uY(function(e){return`Dropping sort property ${cH(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),fH);let i;1===r.length?i=r[0]:r.length>1&&(uY(rY),i=!0);const a=vH(e.map((e=>DY(e)?e.data:null)),(e=>e));if(1===a.length&&null!==a[0]){return Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{})}return Object.assign({fields:t},i?{sort:i}:{})}function X5(e){if(DY(e)&&hc(e.field))return e.field;if(function(e){return!yu(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(DY(n)&&hc(n.field))if(t){if(t!==n.field)return uY("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return uY("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!yu(e)&&"fields"in e&&"data"in e}(e)){uY("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return hc(t)?t:void 0}}function Y5(e,t){return G5(e.component.scales[t].get("domains").map((t=>(DY(t)&&(t.data=e.lookupDataSource(t.data)),t))))}var J5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function K5(e){return x4(e)||b4(e)?e.children.reduce(((e,t)=>e.concat(K5(t))),Q5(e)):Q5(e)}function Q5(e){return OH(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=i,f=J5(i,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,t,n,r){if(hX(n)){if(AY(e))return{step:{signal:t+"_step"}}}else if(vu(e)&&DY(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let h;s&&(h=function(e,t){const n=t.selection;return{signal:z2(e.getSelectionComponent(n,AH(n)),t)}}(e,s));const p=Y5(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),void 0!==c?{reverse:c}:{}),f)),t}),[])}class Z5 extends j0{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||pH(this.get("domains"),(e=>yu(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const e4=["range","scheme"];function t4(e){return"x"===e?"width":"y"===e?"height":void 0}function n4(e,t){const n=e.fieldDef(t);if(n&&n.bin&&$X(n.bin)){const r=J3(e,n.field,n.bin),i=t4(t),a=e.getName(i);return new P5((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function r4(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of e4)if(void 0!==n[r]){const a=EJ(i,r),o=$J(e,r);if(a)if(o)uY(o);else switch(r){case"range":{const r=n.range;if(yu(r)){if(hX(e))return F0(r.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return P5.fromName(r,n)}return e})))}else if(vu(r))return F0({data:t.requestDataName(H0.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return F0(r)}case"scheme":return F0(i4(n[r]))}else uY(tY(i,r,e))}if(e===hG||e===pG){const t=e===hG?"width":"height",n=r[t];if(TZ(n)){if(bJ(i))return F0({step:n.step});uY(nY(t))}}const{rangeMin:a,rangeMax:o}=n,s=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=sQ(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case hG:case pG:{if(hH(["point","band"],l))if(e!==hG||n.width){if(e===pG&&!n.height){const e=LZ(r.view,"height");if(TZ(e))return e}}else{const e=LZ(r.view,"width");if(TZ(e))return e}const i=t4(e),a=t.getName(i);return e===pG&&xJ(l)?[P5.fromName(o,a),0]:[0,P5.fromName(o,a)]}case DG:{const a=a4(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:n4(n,"x"),y:n4(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=s4(t,i,r.view);return fc(e)?e-1:new P5((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=s4(t,i,r.view);return fc(e)?Math.pow(o4*e,2):new P5((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(YX("size",e))}(i,n,t,r);return _J(l)?function(e,t,n){const r=()=>{const r=EQ(t),i=EQ(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return $Y(t)?new P5(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&yu(n)?n.length+1:(uY(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(l,r,u,e)):[a,o]}case bG:return[0,2*Math.PI];case CG:return[0,360];case yG:return[0,new P5((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case TG:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case NG:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case AG:return"symbol";case SG:case EG:case $G:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case MG:case jG:case FG:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t);return(void 0!==a||void 0!==o)&&EJ(i,"rangeMin")&&yu(s)&&2===s.length?F0([null!=a?a:s[0],null!=o?o:s[1]]):T0(s)}function i4(e){return function(e){return!hc(e)&&!!e.name}(e)?Object.assign({scheme:e.name},uH(e,["name"])):{scheme:e}}function a4(e,t,n){if(t)return $Y(t)?{signal:`${t.signal} ? 0 : ${a4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(YX("size",e))}const o4=.95;function s4(e,t,n){const r=TZ(e.width)?e.width.step:BZ(n,"width"),i=TZ(e.height)?e.height.step:BZ(n,"height");return t.x||t.y?new P5((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function l4(e,t){y4(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of OH(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=sQ(i[s]),d=l[t],h=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=EJ(h,t),y=$J(s,t);if(void 0!==d&&(g?y&&uY(y):uY(tY(h,t,s))),g&&void 0===y)if(void 0!==d){const e=f.timeUnit,n=f.type;switch(t){case"domainMax":case"domainMin":cY(l[t])||"temporal"===n||e?u.set(t,{signal:pQ(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in u4?u4[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):f4(e,t)}const u4={bins:({model:e,fieldOrDatumDef:t})=>PK(t)?function(e,t){const n=t.bin;if($X(n)){const r=J3(e,t.field,n);return new P5((()=>e.getSignalName(r)))}if(AX(n)&&DX(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(hH([SG,EG,$G],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if((null===(r=oQ(n))||void 0===r?void 0:r.bin)||hH([nJ,rJ],e))return;return t in fX||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in fX){if(wJ(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!PK(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===sJ)return n.pointPadding}return}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0!==e)return;if(t in fX){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return BH(e,"bar"===n?t:i)}return}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0!==e)return;if(t in fX&&n===lJ){const{bandPaddingOuter:e}=a;return BH(e,$Y(i)?{signal:`${i.signal}/2`}:i/2)}return}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){if("x"===n&&void 0!==r.xReverse)return xJ(e)&&"descending"===t?$Y(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(xJ(e)&&"descending"===t)return!0;return}(t,PK(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&xJ(i)){if(yu(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!_J(i))return!0;if((!PK(t)||!t.bin)&&hH([...dX,...mX],e)){const{orient:t,type:n}=r;return!hH(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function c4(e){y4(e)?function(e){const t=e.component.scales;for(const n of xX){const r=t[n];if(!r)continue;const i=r4(n,e);r.setWithExplicit("range",i)}}(e):f4(e,"range")}function f4(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?c4(n):l4(n,t);for(const r of OH(n)){let i;for(const n of e.children){const e=n.component.scales[r];if(e){i=P0(i,e.getWithExplicit(t),t,"scale",N0(((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}}n[r].setWithExplicit(t,i)}}function d4(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(YG(e)||"discrete"===SX(e))return"shape"===e&&"ordinal"===t.type&&uY(KX(e,"ordinal")),"ordinal";if(e in fX){if(hH(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in pX)return"band";return void 0!==t.band||HK(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return YG(e)?"time":"discrete"===SX(e)?(uY(KX(e,"temporal")),"ordinal"):PK(t)&&t.timeUnit&&EY(t.timeUnit).utc?"utc":"time";case"quantitative":return YG(e)?PK(t)&&$X(t.bin)?"bin-ordinal":"linear":"discrete"===SX(e)?(uY(KX(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(HX(t.type))}(t,n,r),{type:a}=e;return wX(t)?void 0!==a?function(e,t){if(!wX(e))return!1;switch(e){case hG:case pG:case bG:case yG:return wJ(t)||hH(["band","point"],t);case DG:case TG:case MG:case jG:case FG:case CG:return wJ(t)||_J(t)||hH(["band","point","ordinal"],t);case SG:case EG:case $G:return"band"!==t;case NG:return"ordinal"===t||_J(t);case AG:return"ordinal"===t}}(t,a)?PK(n)&&(o=a,s=n.type,!(hH([HY,XY],s)?void 0===o||bJ(o):s===GY?hH([nJ,rJ,void 0],o):s!==WY||hH([QY,ZY,eJ,tJ,iJ,aJ,oJ,KY,void 0],o)))?(uY(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:(uY(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null;var o,s}function h4(e){y4(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return xX.reduce(((r,i)=>{const a=sQ(t[i]);if(a&&n===VJ&&i===AG&&a.type===YY)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=d4(o,i,a,n);r[i]=new Z5(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){h4(n);for(const a of OH(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:_3(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?cJ(e.value,t.value)?r[a]=P0(e,t,"type","scale",p4):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of OH(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new Z5(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const p4=N0(((e,t)=>dJ(e)-dJ(t)));var m4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class g4{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function y4(e){return"unit"===(null==e?void 0:e.type)}function v4(e){return"facet"===(null==e?void 0:e.type)}function b4(e){return"concat"===(null==e?void 0:e.type)}function x4(e){return"layer"===(null==e?void 0:e.type)}class w4{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=DJ(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=bQ(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new g4,this.projectionNameMap=n?n.projectionNameMap:new g4,this.signalNameMap=n?n.signalNameMap:new g4,this.data=e.data,this.description=e.description,this.transforms=function(e){return e.map((e=>G0(e)?{filter:aH(e.filter,VY)}:e))}(null!==(l=e.transform)&&void 0!==l?l:[]),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(AK(e)&&!EK(e.facet)||MZ(e))&&(o.columns=l),jZ(e)&&(o.columns=1);for(const t of RZ)if(void 0!==e[t])if("spacing"===t){const n=e[t];o[t]=fc(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else o[t]=e[t];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:AK(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new j0,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?sH(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=OH(e),n={text:_Q(e.text)};for(const r of t)n[r]=_Q(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){h4(e),B5(e);for(const t of SJ)l4(e,t);t||c4(e)}(this)}parseProjection(){G3(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){R3(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=m4(e,["style"]),n={};for(const e of OH(t)){const r=t[e];void 0!==r&&(n[e]=OQ(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=OQ(this.description)),"unit"!==this.type&&"layer"!==this.type)?kH(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=m4(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of KG){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=r3(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=t3(r,a),s=p3(e,o);void 0!==s&&(n[o]=s)}}return kH(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of KG)e[n].title&&t.push(o3(this,n));for(const e of i3)t=t.concat(u3(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>q2(e,"grid",t))),...r.map((e=>q2(e,"grid",t))),...n.map((e=>q2(e,"main",t))),...r.map((e=>q2(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return q3(this)}assembleProjections(){return U3(this)}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=m4(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},vQ(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return hH(["unit","layer"],this.type)?hH(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",kH(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||v4(this.parent)?K5(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return AH((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(H0[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(v4(this.parent)){const t=gX(x3(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(bJ(e)&&AY(r)){const e=n.get("name"),r=X5(Y5(this,t));if(r){return{signal:b3(e,n,JK({aggregate:"distinct",field:r},{expr:"datum"}))}}return uY(PX(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):nX(e)&&wX(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return`Cannot find a selection named "${e}".`}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class _4 extends w4{vgField(e,t={}){const n=this.fieldDef(e);if(n)return JK(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?OH(e).reduce(((n,i)=>{const a=e[i];return yu(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}(this.getMapping(),((t,n,r)=>{const i=oQ(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){VQ(this.getMapping(),((t,n)=>{const r=oQ(t);r&&e(r,n)}),t)}}var k4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class O4 extends I1{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=sH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new O4(null,sH(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${fH(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=k4(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class S4 extends I1{constructor(e,t){super(e),this.filter=t}clone(){return new S4(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==AQ("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=wX(i)&&t.getScaleComponent(i);if(a){xJ(a.get("type"))&&"count"!==n.aggregate&&!WJ(r)&&(e[n.field]=n)}return e}),{});return OH(a).length?new S4(e,a):null}dependentFields(){return new Set(OH(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${fH(this.filter)}`}assemble(){const e=OH(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=JK(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class E4 extends I1{constructor(e,t){super(e),this.transform=t,this.transform=sH(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new E4(this.parent,sH(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${fH(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class $4 extends I1{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=sH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new $4(null,sH(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${fH(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class A4 extends I1{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new A4(null,sH(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[_G,wG],[OG,kG]]){const i=r.map((e=>{const n=sQ(t.encoding[e]);return PK(n)?n.field:BK(n)?{expr:`${n.datum}`}:VK(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new A4(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(AG)){const r=t.typedFieldDef(AG);r.type===YY&&(e=new A4(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(hc);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${fH(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class D4 extends I1{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new D4(null,this.projection,sH(this.fields),sH(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[_G,wG],[OG,kG]]){const r=n.map((e=>{const n=sQ(t.encoding[e]);return PK(n)?n.field:BK(n)?{expr:`${n.datum}`}:VK(n)?{expr:`${n.value}`}:void 0})),i=n[0]===OG?"2":"";(r[0]||r[1])&&(e=new D4(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(hc))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${fH(this.fields)} ${fH(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class C4 extends I1{constructor(e,t){super(e),this.transform=t}clone(){return new C4(null,sH(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new C4(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(PK(r)&&PK(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=WQ(t.mark,n);return new C4(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${fH(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:X0(n)?this.processSequence(n):n}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});if(r&&"value"!==r){return[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[s]}}var M4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class j4 extends I1{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=sH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new j4(null,sH(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${fH(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=M4(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class F4 extends I1{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new F4(null,sH(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=K4(a.data,i);e||(e=new u5(a.data),i.push(e));const n=t.getName(`lookup_${r}`);o=new q1(e,n,H0.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(AH(e),e).materialized,!o)throw new Error(function(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}(e))}return new F4(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?qu(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${fH({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:qu(this.transform.as)}:{});else{let t=this.transform.as;hc(t)||(uY('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}var T4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class N4 extends I1{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=sH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new N4(null,sH(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${fH(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=T4(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}var R4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class P4 extends I1{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=sH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new P4(null,sH(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${fH(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=R4(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class z4 extends I1{constructor(e,t){super(e),this.transform=t}clone(){return new z4(null,sH(this.transform))}addDimensions(e){var t;this.transform.groupby=vH((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${fH(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class B4 extends I1{constructor(e,t){super(e),this.transform=t}clone(){return new B4(null,sH(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${fH(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function L4(e){let t=0;return function n(r,i){var a;if(r instanceof u5&&!r.isGenerator&&!B0(r.data)){e.push(i);i={name:null,source:i.name,transform:[]}}if(r instanceof a5&&(r.parent instanceof u5&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof t5){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else{if((r instanceof s5||r instanceof l5||r instanceof S4||r instanceof N2||r instanceof Z2||r instanceof D4||r instanceof A4||r instanceof e5||r instanceof F4||r instanceof C5||r instanceof A5||r instanceof $4||r instanceof E4||r instanceof O4||r instanceof j4||r instanceof N4||r instanceof P4||r instanceof o5||r instanceof B4||r instanceof z4)&&i.transform.push(r.assemble()),(r instanceof Q3||r instanceof V1||r instanceof C4||r instanceof D5)&&i.transform.push(...r.assemble()),r instanceof q1)if(i.source&&0===i.transform.length)r.setSource(i.source);else if(r.parent instanceof q1)r.setSource(i.name);else if(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()){e.push(i);i={name:null,source:i.name,transform:[]}}switch(r.numChildren()){case 0:r instanceof q1&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children){n(e,{name:null,source:a,transform:[]})}break}}}}}function I4(e){return"top"===e||"left"===e||$Y(e)?"header":"footer"}function q4(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=n3("title",null,i,t);let u=nQ(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=yu(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=n3("labelOrient",s,i,t),f=BH((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=hH(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[d]:"facet"===t?[]:[U4(e,t,f)]}}}function U4(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function V4(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=k3(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=i[a];for(const i of r.component.axes[t]){const t=I4(i.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[U4(e,a,!1)];const r=q2(i,"main",e.config,{header:!0});r&&o[t][0].axes.push(r),i.mainExtracted=!0}}}}function W4(e){for(const t of e.children)t.parseLayoutSize()}function H4(e,t){const n=x3(t),r=gX(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){o=void 0;break}if(o){if("independent"===a&&o.value!==e.value){o=void 0;break}o=P0(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function G4(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(bJ(e)){const e=LZ(r.view,t);return AY(n)||TZ(e)?"step":e}return zZ(r.view,t)}if(e.hasProjection||"arc"===e.mark)return zZ(r.view,t);{const e=LZ(r.view,t);return TZ(e)?e.step:e}}var X4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Y4(e,t,n){return JK(t,Object.assign({suffix:`by_${JK(e)}`},null!=n?n:{}))}class J4 extends _4{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=b6(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!EK(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=OH(e),n={};for(const r of t){if(!hH([cG,fG],r)){uY(YX(r,"facet"));break}const t=e[r];if(void 0===t.field){uY(XX(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=cQ(X4(e,["header"]),t);return n&&(r.header=DJ(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=Q4(this),this.child.parseData()}parseLayoutSize(){W4(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of KG)q4(e,t);V4(e,"x"),V4(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of KG)for(const a of a3){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=n3("titleOrient",l.header,this.config,i);if(hH(["right","bottom"],t)){const n=t3(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof J4)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof J4?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:JK(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof J4){if(this.child.channelHasField("column")){const r=JK(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of dX){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(bJ(a)&&AY(o)){const i=X5(Y5(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):uY(PX(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const e of KG){const t=this.facet[e];if(t){s.push(JK(t));const{bin:l,sort:u}=t;if($X(l)&&s.push(JK(t,{binSuffix:"end"})),OK(u)){const{field:e,op:s=xK}=u,l=Y4(t,u);n&&r?(i.push(l),a.push("max"),o.push(l)):(i.push(e),a.push(s),o.push(l))}else if(yu(u)){const n=e3(t,e);i.push(n),a.push("max"),o.push(n)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?OK(n.sort)?[Y4(n,n.sort,{expr:"datum"})]:yu(n.sort)?[e3(n,e,{expr:"datum"})]:[JK(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(OK(e)?e.order:!yu(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return f3(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of i3)if(t[i]){const a=n3("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(hH(r[i],a))return f3(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=L4(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:KG.map((e=>this.facetSortFields(e))).flat(),order:KG.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&OH(e.component.selection).length){const n=wc(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:nq("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return m2(t)}(this,[])))]}getMapping(){return this.facet}}function K4(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(L0(e)&&L0(t)){if(oH(e.values,t.values))return o}else if(B0(e)&&B0(t)){if(e.url===t.url)return o}else if(I0(e)&&e.name===o.dataName)return o}return null}function Q4(e){var t,n,r,i,a,o,s,l,u,c;let f=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new u5({values:[]});return t.push(e),e}const n=K4(e.data,t);if(n)return q0(e.data)||(n.data.format=gH({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new u5(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new z0,m=e.data;q0(m)?(U0(m)?f=new l5(f,m.sequence):W0(m)&&(f=new s5(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=a5.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new o5(f);const g=e.parent&&x4(e.parent);(y4(e)||v4(e))&&g&&(f=null!==(r=Q3.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l;if(a1(o))l=e=new Z2(e,o),s="derived";else if(G0(o)){const i=r5(o);l=e=null!==(r=a5.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new N2(e,t,o.filter)}else if(o1(o))l=e=Q3.makeFromTransform(e,o,t),s="number";else if(l1(o))s="date",void 0===n.getWithExplicit(o.field).value&&(e=new a5(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=V1.makeFromTransform(e,o);else if(u1(o))l=e=e5.makeFromTransform(e,o),s="number",M2(t)&&(e=new o5(e));else if(Y0(o))l=e=F4.make(e,t,o,a++),s="derived";else if(n1(o))l=e=new C5(e,o),s="number";else if(r1(o))l=e=new A5(e,o),s="number";else if(c1(o))l=e=D5.makeFromTransform(e,o),s="derived";else if(f1(o))l=e=new $4(e,o),s="derived";else if(i1(o))l=e=new E4(e,o),s="derived";else if(J0(o))l=e=new z4(e,o),s="derived";else if(t1(o))e=new B4(e,o);else if(s1(o))l=e=C4.makeFromTransform(e,o),s="derived";else if(K0(o))l=e=new O4(e,o),s="derived";else if(Q0(o))l=e=new N4(e,o),s="derived";else if(Z0(o))l=e=new P4(e,o),s="derived";else{if(!e1(o)){uY(VX(o));continue}l=e=new j4(e,o),s="derived"}if(l&&void 0!==s)for(const e of null!==(i=l.producedFields())&&void 0!==i?i:[])n.set(e,s,!1)}return e}(f,e,p));const y=function(e){const t={};if(y4(e)&&e.component.selection)for(const n of OH(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&zH(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=i5(e);f=null!==(i=a5.makeWithAncestors(f,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:f,y4(e)&&(f=A4.parseAll(f,e),f=D4.parseAll(f,e)),(y4(e)||v4(e))&&(g||(f=null!==(a=Q3.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=V1.makeFromEncoding(f,e))&&void 0!==o?o:f,f=Z2.parseAllForSortIndex(f,e));const b=e.getDataName(H0.Raw),x=new q1(f,b,H0.Raw,h);if(d[b]=x,f=x,y4(e)){const t=e5.makeFromEncoding(f,e);t&&(f=t,M2(e)&&(f=new o5(f))),f=null!==(s=C4.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(l=D5.makeFromEncoding(f,e))&&void 0!==l?l:f}y4(e)&&(f=null!==(u=S4.make(f,e))&&void 0!==u?u:f);const w=e.getDataName(H0.Main),_=new q1(f,w,H0.Main,h);d[w]=_,f=_,y4(e)&&function(e,t){D2(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new q1(new N2(t,e,{selection:r}),i,H0.Lookup,e.component.data.outputNodeRefCounts)}))}(e,_);let k=null;if(v4(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(OK(i.sort)){const{field:n,op:r=xK}=i.sort;e=t=new A5(e,{joinaggregate:[{op:r,field:n,as:Y4(i,i.sort,{forAs:!0})}],groupby:[JK(i)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,k=new t5(f,e,t,_.getSource()),d[t]=k}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:x,main:_,facetRoot:k,ancestorParse:p})}class Z4 extends w4{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||uY("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>b6(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=Q4(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of OH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return jZ(e)?e.vconcat:FZ(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){W4(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";H4(e,t),H4(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=g3(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const e6=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},JH),{labelExpr:1,encode:1}),t6=OH(e6);class n6 extends j0{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new n6(sH(this.explicit),sH(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return $Y(this.explicit.orient)}}const r6={bottom:"top",top:"bottom",left:"right",right:"left"};function i6(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=a6(n,i)}}}return e}function a6(e,t){for(const n of t6){const r=P0(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return NQ(e,t);case"gridScale":return{explicit:e.explicit,value:BH(e.value,t.value)}}return R0(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function o6(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===($Y(n.labelAngle)?n.labelAngle:VH(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Q2(r,i))return!0}return e===n[t]}const s6=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function l6(e,t){var n,r,i;let a=t.axis(e);const o=new n6,s=sQ(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=W2(e,f,c,t.config),h=void 0!==a?!a:G2("disable",u.style,null==a?void 0:a.style,d).configValue;if(o.set("disable",h,void 0!==a),h)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return $Y(a)?a:VH(a);{const{configValue:a}=G2("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?VH(a):n!==hG||!hH([XY,HY],e.type)||PK(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,d),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const n of t6){const r=n in X2?X2[n](m):QH(n)?a[n]:void 0,i=void 0!==r,s=o6(r,n,a,t,e);if(i&&s)o.set(n,r,s);else{const{configValue:e,configFrom:t}=QH(n)&&"values"!==n?G2(n,u.style,a.style,d):{},l=void 0!==e;i&&!l?o.set(n,r,s):("vgAxisConfig"!==t||s6.has(n)&&l||GH(e)||$Y(e))&&o.set(n,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},y=XH.reduce(((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=w3(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=sQ(i[t]))&&void 0!==r?r:sQ(i[sX(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return uK(u)?Object.assign({text:hK({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||kH(s)||(n[r]={update:s}),n}),{});return kH(y)||o.set("encode",y,!!a.encoding||void 0!==a.labelAngle),o}function u6(e,t,n){const r=DJ(e),i=AQ("orient",r,n);if(r.orient=function(e,t,n){switch(e){case RJ:case qJ:case UJ:case BJ:case PJ:case TJ:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case FJ:if(PK(r)&&(AX(r.bin)||PK(i)&&i.aggregate&&!r.aggregate))return"vertical";if(PK(i)&&(AX(i.bin)||PK(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(PK(r)&&r.type===WY&&!$X(r.bin)||IK(r)))return"horizontal";if(!o&&(PK(i)&&i.type===WY&&!$X(i.bin)||IK(i)))return"vertical"}case zJ:if(a&&(!PK(r)||!AX(r.bin))&&o&&(!PK(i)||!AX(i.bin)))return;case jJ:if(o)return PK(i)&&AX(i.bin)?"horizontal":"vertical";if(a)return PK(r)&&AX(r.bin)?"vertical":"horizontal";if(e===zJ){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case NJ:case LJ:{const t=LK(r),a=LK(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===GY,s=a.type===GY;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&uY(`Specified orient "${r.orient}" overridden with "${i}".`),"bar"===r.type&&r.orient){const e=AQ("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:QJ[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===AQ("opacity",r,n)&&(r.opacity=function(e,t){if(hH([RJ,LJ,qJ,UJ],e)&&!LQ(t))return.7;return}(r.type,t));return void 0===AQ("cursor",r,n)&&(r.cursor=function(e,t,n){if(t.href||e.href||AQ("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function c6(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),_1("x",e,{defaultPos:"mid"})),_1("y",e,{defaultPos:"mid"})),b1("size",e)),b1("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return b1("shape",e)}(e,0,t))}function f6(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=AQ("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;if(e&&AY(e)&&fc(e.step))return 3*e.step/4;return 3*BZ(n.view,a)/4}}const d6={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),_1("x",e,{defaultPos:"mid"})),_1("y",e,{defaultPos:"mid"})),C1(e,"radius","arc")),C1(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),$1("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),$1("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),P1(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),C1(e,"x","bar")),C1(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>c6(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&PK(n)&&n.type===YY?{field:JK(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),C1(e,"x","image")),C1(e,"y","image")),h1(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),_1("x",e,{defaultPos:"mid"})),_1("y",e,{defaultPos:"mid"})),b1("size",e,{vgChannel:"strokeWidth"})),P1(e))},point:{vgMark:"symbol",encodeEntry:e=>c6(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),C1(e,"x","rect")),C1(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),$1("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),$1("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),b1("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>c6(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),_1("x",e,{defaultPos:"mid"})),_1("y",e,{defaultPos:"mid"})),h1(e)),b1("size",e,{vgChannel:"fontSize"})),b1("angle",e)),z1("align",function(e,t,n){if(void 0===AQ("align",e,n))return"center";return}(e.markDef,0,t))),z1("baseline",function(e,t,n){if(void 0===AQ("baseline",e,n))return"middle";return}(e.markDef,0,t))),_1("radius",e,{defaultPos:null,isMidPoint:!0})),_1("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),_1("x",e,{defaultPos:"mid",vgChannel:"xc"})),_1("y",e,{defaultPos:"mid",vgChannel:"yc"})),b1("size",e,{defaultValue:f6(e),vgChannel:i})),{[a]:OQ(AQ("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},N1(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),_1("x",e,{defaultPos:"mid"})),_1("y",e,{defaultPos:"mid"})),b1("size",e)),P1(e))}};function h6(e){if(hH([NJ,jJ,IJ],e.mark)){const t=WQ(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:p6+e.requestDataName(H0.Main),data:e.requestDataName(H0.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:g6(e,{fromPrefix:p6})}]}(e,t)}else if(hH([FJ],e.mark)){const t=jY.some((t=>AQ(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=g6(e,{fromPrefix:m6}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},lH(t.encode.update,["y","yc","y2","height",...jY])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},uH(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},lH(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},uH(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of jY){const r=DQ(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=OQ(r)),r&&(t.encode.update[n]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=JK(s)?[JK(s)]:[];((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(JK(s,{binSuffix:"end"}));a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=DQ(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:OQ(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(H0.Main),name:m6+e.requestDataName(H0.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return g6(e)}const p6="faceted_path_";const m6="stack_group_";function g6(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=BH(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=$Q(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!yu(o)&&VK(o)&&dH(o.value)||!o&&dH(AQ("order",i,a)))){if((yu(o)||PK(o))&&!n)return jQ(o,{expr:"datum"});if(WJ(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(PK(r)){const t=r.sort;return yu(t)?{field:JK(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:OK(t)?{field:JK({aggregate:LQ(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:kK(t)?{field:JK(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:JK(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=OH(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=OH(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),f=AQ("aria",r,a),d=d6[n].postEncodingTransform?d6[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:d6[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===f?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(H0.Main)},encode:{update:d6[n].encodeEntry(e)}}),d?{transform:d}:{})]}class y6 extends _4{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,NZ(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=XJ(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=DQ("filled",e,t),i=e.type;return BH(r,i!==RJ&&i!==NJ&&i!==zJ)}(a,i,{graticule:e.data&&W0(e.data)}));const s=this.encoding=qQ(e.encoding||{},o,a.filled,i);this.markDef=u6(a,s,i),this.size=function({encoding:e,size:t}){for(const n of dX){const r=lX(n);TZ(t[r])&&LK(e[n])&&(delete t[r],uY(nY(r)))}return t}({encoding:s,size:NZ(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=o0(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===VJ,n=e&&GG.some((t=>qK(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return xX.reduce(((e,n)=>{var r;const i=sQ(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e}),{})}initScale(e){const{domain:t,range:n}=e,r=DJ(e);return yu(t)&&(r.domain=t.map(_Q)),yu(n)&&(r.range=n.map(_Q)),r}initAxes(e){return dX.reduce(((t,n)=>{const r=e[n];if(qK(r)||n===hG&&qK(e.x2)||n===pG&&qK(e.y2)){const e=qK(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t}),{})}initAxis(e){const t=OH(e),n={};for(const r of t){const t=e[r];n[r]=GH(t)?wQ(t):_Q(t)}return n}initLegends(e){return vX.reduce(((t,n)=>{const r=sQ(e[n]);if(r&&function(e){switch(e){case SG:case EG:case $G:case DG:case AG:case MG:case TG:case NG:return!0;case jG:case FG:case CG:return!1}}(n)){const e=r.legend;t[n]=e?DJ(e):e}return t}),{})}parseData(){this.component.data=Q4(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of dX){const i=lX(r);if(t[i]){const e=t[i];n.layoutSize.set(i,TZ(e)?"step":e,!0)}else{const t=G4(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of OH(null!=t?t:{})){const o=sH(t[a]),s=i[o.type],l=R2(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const u=AH(a),c=r[u]=Object.assign(Object.assign({},o),{name:u,events:hc(o.on)?nq(o.on,"scope"):sH(o.on)});f2(c,(n=>{n.has(c)&&n.parse&&n.parse(e,c,o,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=h6(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,dX.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[l6(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;D2(e,((r,i)=>{const a=r.name,o=wc(a+O2);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${$2}(${o}, ${wc(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),f2(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n&&0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return m2(t)}(this,e)}assembleSignals(){return[...U2(this),...(e=this,t=[],D2(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),f2(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+E2,on:[{events:{signal:n.name+S2},update:`modify(${wc(n.name+O2)}, ${a})`}]})})),m2(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return D2(e,(t=>{const r={name:t.name+O2};if(t.init){const n=t.project.items.map((e=>d2(e,["signals"]))),i=t.init.map((e=>h2(e,!1)));r.values="interval"===t.type?[{unit:C2(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:C2(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+O2)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return g3(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&x4(this.parent)||(t=p2(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return BQ(this.encoding,e)}fieldDef(e){return oQ(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return UK(t)?t:null}}class v6 extends w4{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(e0(e))return new v6(e,this,this.getName("layer_"+t),a,i);if(RQ(e))return new y6(e,this,this.getName("layer_"+t),a,i);throw new Error(jX(e))}))}parseData(){this.component.data=Q4(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;W4(e=this),H4(e,"width"),H4(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of OH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of OH(t.component.axes))r.axis[i]=k3(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=i6(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of dX){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!$Y(t)){if(i[t]>0&&!n){const n=r6[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),U2(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),g3(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)y4(n)&&(t=p2(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),q3(this))}}function b6(e,t,n,r,i){if(AK(e))return new J4(e,t,n,i);if(e0(e))return new v6(e,t,n,r,i);if(RQ(e))return new y6(e,t,n,r,i);if(function(e){return jZ(e)||FZ(e)||MZ(e)}(e))return new Z4(e,t,n,i);throw new Error(jX(e))}var x6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};var w6=Object.freeze({__proto__:null,normalize:$0,version:"4.17.0",compile:function(e,t={}){var n;t.logger&&(n=t.logger,lY=n),t.fieldTitle&&tQ(t.fieldTitle);try{const n=XZ(xu(t.config,e.config)),r=$0(e,n),i=b6(r,null,"",void 0,n);i.parse(),function(e,t){T5(e.sources);let n=0,r=0;for(let r=0;r<5&&R5(e,t,!0);r++)n++;e.sources.map(M5);for(let n=0;n<5&&R5(e,t,!1);n++)r++;T5(e.sources),5===Math.max(n,r)&&uY("Maximum optimization runs(5) reached.")}(i.component.data,i);return{spec:function(e,t,n={},r){const i=e.config?QZ(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=L4(i);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+o++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let s=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(s++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)));const{params:f}=t,d=x6(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...EZ(f)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):hc(t)&&(t={type:t});if(i&&a&&(o=t.type,"fit"===o||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)uY(RX()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";uY(RX(gX(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${gX(e)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===OH(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),M0(n,!1)),M0(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(lY=sY),t.fieldTitle&&tQ(ZK)}},deepEqual:oH,duplicate:sH,pick:lH,omit:uH,stringify:cH,hash:fH,isNullOrFalse:dH,contains:hH,some:pH,every:mH,mergeDeep:gH,unique:vH,isEqual:function(e,t){const n=OH(e),r=OH(t);if(n.length!==r.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},setEqual:bH,hasIntersection:xH,prefixGenerator:wH,fieldIntersection:_H,isEmpty:kH,keys:OH,vals:SH,entries:EH,isBoolean:$H,varName:AH,logicalExpr:DH,deleteNestedProperty:CH,titleCase:MH,accessPathWithDatum:jH,flatAccessWithDatum:FH,replacePathInField:NH,replaceAll:RH,removePathFromField:PH,accessPathDepth:zH,getFirstDefined:BH,uniqueId:IH,resetIdCounter:function(){LH=42},internalField:qH,isInternalField:UH,normalizeAngle:VH,isNumeric:WH});function _6(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}const k6="#fff",O6={background:"#333",title:{color:k6},style:{"guide-label":{fill:k6},"guide-title":{fill:k6}},axis:{domainColor:k6,gridColor:"#888",tickColor:k6}},S6="#4572a7",E6={background:"#fff",arc:{fill:S6},area:{fill:S6},line:{stroke:S6,strokeWidth:2},path:{stroke:S6},rect:{fill:S6},shape:{stroke:S6},symbol:{fill:S6,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},$6="#30a2da",A6="#cbcbcb",D6="#f0f0f0",C6="#333",M6={arc:{fill:$6},area:{fill:$6},axis:{domainColor:A6,grid:!0,gridColor:A6,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:A6,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:D6,group:{fill:D6},legend:{labelColor:C6,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:C6,titleFontSize:14,titlePadding:10},line:{stroke:$6,strokeWidth:2},path:{stroke:$6,strokeWidth:.5},rect:{fill:$6},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:$6},bar:{binSpacing:2,fill:$6,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},j6="#000",F6={group:{fill:"#e5e5e5"},arc:{fill:j6},area:{fill:j6},line:{stroke:j6},path:{stroke:j6},rect:{fill:j6},shape:{stroke:j6},symbol:{fill:j6,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},T6="Benton Gothic, sans-serif",N6="#82c6df",R6="Benton Gothic Bold, sans-serif",P6="normal",z6={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},B6={background:"#ffffff",title:{anchor:"start",color:"#000000",font:R6,fontSize:22,fontWeight:"normal"},arc:{fill:N6},area:{fill:N6},line:{stroke:N6,strokeWidth:2},path:{stroke:N6},rect:{fill:N6},shape:{stroke:N6},symbol:{fill:N6,size:30},axis:{labelFont:T6,labelFontSize:11.5,labelFontWeight:"normal",titleFont:R6,titleFontSize:13,titleFontWeight:P6},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:T6,labelFontSize:11.5,symbolType:"square",titleFont:R6,titleFontSize:13,titleFontWeight:P6},range:{category:z6["category-6"],diverging:z6["fireandice-6"],heatmap:z6["fire-7"],ordinal:z6["fire-7"],ramp:z6["fire-7"]}},L6="#ab5787",I6="#979797",q6={background:"#f9f9f9",arc:{fill:L6},area:{fill:L6},line:{stroke:L6},path:{stroke:L6},rect:{fill:L6},shape:{stroke:L6},symbol:{fill:L6,size:30},axis:{domainColor:I6,domainWidth:.5,gridWidth:.2,labelColor:I6,tickColor:I6,tickWidth:.2,titleColor:I6},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},U6="#3e5c69",V6={background:"#fff",arc:{fill:U6},area:{fill:U6},line:{stroke:U6},path:{stroke:U6},rect:{fill:U6},shape:{stroke:U6},symbol:{fill:U6},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},W6="#1696d2",H6="#000000",G6="Lato",X6="Lato",Y6={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},J6={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:G6},axisX:{domain:!0,domainColor:H6,domainWidth:1,grid:!1,labelFontSize:12,labelFont:X6,labelAngle:0,tickColor:H6,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:G6},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:X6,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:G6,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:X6,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:G6,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:Y6["six-groups-cat-1"],diverging:Y6["diverging-colors"],heatmap:Y6["diverging-colors"],ordinal:Y6["six-groups-seq"],ramp:Y6["shades-blue"]},area:{fill:W6},rect:{fill:W6},line:{color:W6,stroke:W6,strokeWidth:5},trail:{color:W6,stroke:W6,strokeWidth:0,size:1},path:{stroke:W6,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:W6,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:W6,stroke:null}},arc:{fill:W6},shape:{stroke:W6},symbol:{fill:W6,size:30}},K6="#3366CC",Q6="#ccc",Z6="Arial, sans-serif",e7={arc:{fill:K6},area:{fill:K6},path:{stroke:K6},rect:{fill:K6},shape:{stroke:K6},symbol:{stroke:K6},circle:{fill:K6},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:Z6,fontSize:12},"guide-title":{font:Z6,fontSize:12},"group-title":{font:Z6,fontSize:12}},title:{font:Z6,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:Q6,tickColor:Q6,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},t7="2.9.1";var n7=Object.freeze({__proto__:null,dark:O6,excel:E6,fivethirtyeight:M6,ggplot2:F6,googlecharts:e7,latimes:B6,quartz:q6,urbaninstitute:J6,version:t7,vox:V6}),r7="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const i7="vg-tooltip-element",a7={offsetX:10,offsetY:10,id:i7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function o7(e,t,n){if(yu(e))return`[${e.map((e=>t(hc(e)?e:s7(e,n)))).join(", ")}]`;if(vu(e)){let r="";const i=e,{title:a,image:o}=i,s=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(vu(i)&&(i=s7(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function s7(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class l7{constructor(e){this.options=Object.assign(Object.assign({},a7),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return r7.toString().replace(i7,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=o7(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function u7(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var c7,f7='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function d7(e,...t){for(const n of t)h7(e,n);return e}function h7(e,t){for(const n of Object.keys(t))wu(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const p7=QW;let m7=w6;const g7="undefined"!=typeof window?window:void 0;void 0===m7&&(null===(c7=null==g7?void 0:g7.vl)||void 0===c7?void 0:c7.compile)&&(m7=g7.vl);const y7={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},v7={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},b7={vega:"Vega","vega-lite":"Vega-Lite"},x7={vega:p7.version,"vega-lite":m7?m7.version:"not available"},w7={vega:e=>e,"vega-lite":(e,t)=>m7.compile(e,{config:t}).spec},_7='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',k7="chart-wrapper";function O7(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=`${b7[r]} JSON Source`}function S7(e,t,n={}){var r,i,a;return u7(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:p7.loader(n.loader);var s;const l=hc(t)?JSON.parse(yield o.load(t)):t,u=yield E7(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield E7(n,o),f=Object.assign(Object.assign({},d7(c,u)),{config:xu(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return u7(this,void 0,void 0,(function*(){const c=n.theme?xu(n7[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=lc(n.actions)?n.actions:d7({},y7,null!==(a=n.actions)&&void 0!==a?a:{}),d=Object.assign(Object.assign({},v7),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:p7.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?f7.toString():n.defaultStyle,r.appendChild(t)}}const y=function(e,t){var n;if(e.$schema){const r=_6(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${b7[r.library]}, but mode argument sets ${null!==(n=b7[t])&&void 0!==n?n:t}.`);const i=r.library;return Zl.satisfies(x7[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${b7[i]} ${r.version}, but the current version of ${b7[i]} is v${x7[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let v=w7[y](t,c);if("vega-lite"===y&&v.$schema){const e=_6(v.$schema);Zl.satisfies(x7.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${x7.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(f){const e=document.createElement("div");e.classList.add(k7),g.appendChild(e),b=e}const x=n.patch;x&&(v=x instanceof Function?x(v):Ro(v,x,!0,!1).newDocument),n.formatLocale&&p7.formatLocale(n.formatLocale),n.timeFormatLocale&&p7.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=p7.parse(v,"vega-lite"===y?{}:c,{ast:w}),k=new p7.View(_,Object.assign({loader:r,logLevel:p,renderer:h},w?{expr:p7.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e=function(e){return"function"==typeof e}(n.tooltip)?n.tooltip:new l7(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(e)}let O,{hover:S}=n;if(void 0===S&&(S="vega"===y),S){const{hoverSet:e,updateSet:t}="boolean"==typeof S?{}:S;k.hover(e,t)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(b,n.bind).runAsync(),!1!==f){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=d.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML=_7,t.append(n),O=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",O)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const e of["svg","png"])if(!0===f||!0===f.export||f.export[e]){const t=d[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${m}.${e}`,i.addEventListener("mousedown",(function(t){return u7(this,void 0,void 0,(function*(){t.preventDefault();const r=yield k.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=d.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;O7(Xo(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),e.preventDefault()})),r.append(e)}if("vega-lite"===y&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=d.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;O7(Xo(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===f||!1!==f.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=d.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:y,renderer:h,spec:Xo(t)}),n.preventDefault()})),r.append(i)}}function E(){O&&document.removeEventListener("click",O),k.finalize()}return{view:k,spec:t,vgSpec:v,finalize:E}}))}(e,l,f,o)}))}function E7(e,t){var n;return u7(this,void 0,void 0,(function*(){const r=hc(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=hc(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const $7={$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:"container",height:500,layer:[{data:{name:"simulated"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]}],layer:[{transform:[{aggregate:[{op:"min",field:"cumNetValue",as:"teamMinNetValue"},{op:"max",field:"cumNetValue",as:"teamMaxNetValue"}],groupby:["rollIndex","turn","activeTeamColor","activeTeamName"]},{joinaggregate:[{op:"min",field:"teamMinNetValue",as:"minNetValue"},{op:"max",field:"teamMaxNetValue",as:"maxNetValue"}]},{calculate:"datum.rollIndex - 0.5",as:"x"},{calculate:"datum.rollIndex + 0.5",as:"x2"}],mark:{type:"rect",opacity:.05},encoding:{x:{field:"x",type:"quantitative"},x2:{field:"x2",type:"quantitative"},y:{field:"minNetValue",type:"quantitative",title:"Net Value"},y2:{field:"maxNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"}]}},{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["activeTeamColor","rollIndex"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"value",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},detail:{field:"prob",type:"nominal"},tooltip:[{field:"activeTeamColor",title:"Active Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}}]},{data:{name:"playHead"},mark:{type:"rule"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}}}},{data:{name:"actual"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]},{calculate:"'#roll-' + datum.rollIndex",as:"url"}],layer:[{mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Active Team",legend:{disable:!0}},detail:{field:"iteration",type:"nominal"}}},{transform:[{flatten:["outcomes","weights"]},{bin:{step:.5,anchor:-.25},field:"outcomes",as:["outcomes_min","outcomes_max"]},{aggregate:[{op:"sum",field:"weights",as:"weight_sum"}],groupby:["rollIndex","activeTeamColor","activeTeamName","outcomes_min","outcomes_max","cumNetValue","netValue","description"]},{calculate:"datum.outcomes_min + datum.cumNetValue - datum.netValue",as:"posNetValue_min"},{calculate:"datum.outcomes_max + datum.cumNetValue - datum.netValue",as:"posNetValue_max"},{calculate:"datum.rollIndex - (datum.weight_sum / 2)",as:"x"},{calculate:"datum.rollIndex + (datum.weight_sum / 2)",as:"x2"},{calculate:"datum.posNetValue_min",as:"y"},{calculate:"datum.posNetValue_max",as:"y2"},{calculate:"join([datum.outcomes_min, datum.outcomes_max], ' - ')",as:"outcomes_range"}],mark:{type:"rect",opacity:.7},encoding:{x:{type:"quantitative",field:"x"},x2:{type:"quantitative",field:"x2"},y:{type:"quantitative",field:"y"},y2:{type:"quantitative",field:"y2"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"description",title:"Roll"},{field:"outcomes_range",title:"Net Value Change"},{field:"weight_sum",title:"Probability",format:".2p"},{field:"activeTeamName",title:"Active Team"}]}},{mark:{type:"point"},selection:{zoom_x:{type:"interval",bind:"scales",encodings:["x"]}},encoding:{x:{type:"quantitative",field:"rollIndex"},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"},{field:"description",title:"Roll"},{field:"valueDescription",title:"Value"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}],href:{field:"url",type:"nominal"}}}]}]};function A7(t){let n;return{c(){n=p("div"),n.innerHTML='<div id="chart" class="col-sm-12 svelte-1yk3kez"></div>',w(n,"id","results")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}function D7(e,t,n){const r=D();let i,a,{rolls:o}=t,{replayStepIndex:s}=t,{selectedRoll:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return A((()=>(console.log("Results onMount"),function(){const e=o.filter((e=>{const t=e.actual;return isFinite(t.outcomeValue)?!!isFinite(t.expectedValue)||(console.warn("Dice roll with non-finite expected value",{roll:e,dataPoint:t}),!1):(console.warn("Dice roll with non-finite outcome value",{roll:e,dataPoint:t}),!1)})),t=e.map((e=>e.actual));console.log("Valid rolls",e),console.log("Actual points",t),S7("#chart",$7).then((a=>{a.view.addEventListener("click",(function(e,t){t&&(n(0,l=t.datum.rollIndex),n(1,u=o[l].stepIndex),n(2,c=o[l+1].stepIndex),console.log("Results clicked",{selectedRoll:l,replayStart:u,replayEnd:c}))})),n(5,i=a.view),n(5,i=a.view.insert("actual",t).run()),n(5,i=i.insert("simulated",t).run());var s=0;function f(){for(var t=[],a=0;a<50;a++)s++,t=t.concat(e.map((e=>e.simulated(s))));var o=qm().insert(t);n(5,i=i.change("simulated",o).run()),r("iterationComplete",s),s<1e3&&window.setTimeout(f,200)}f()}))}(),console.log("Results onMount chart rendered"),()=>console.log("destroyed")))),e.$$set=e=>{"rolls"in e&&n(3,o=e.rolls),"replayStepIndex"in e&&n(4,s=e.replayStepIndex),"selectedRoll"in e&&n(0,l=e.selectedRoll),"replayStart"in e&&n(1,u=e.replayStart),"replayEnd"in e&&n(2,c=e.replayEnd)},e.$$.update=()=>{if(120&e.$$.dirty){if(console.log("Results reactive"),o&&s){let e=o.findIndex((e=>s<e.stepIndex));n(6,a=e>0?o[e-1].rollIndex:0)}if(i&&a){var t=qm().remove((()=>!0)).insert([{rollIndex:a}]);n(5,i=i.change("playHead",t).run())}}},[l,u,c,o,s,i,a]}class C7 extends le{constructor(e){super(),se(this,e,D7,A7,o,{rolls:3,replayStepIndex:4,selectedRoll:0,replayStart:1,replayEnd:2})}}function M7(t){let n;return{c(){n=p("p"),n.textContent="Welcome to Diced or Not, the Blood Bowl 2 replay dice analyzer! If you've just\n  had a particularly good or bad game and you want to know if the dice are to\n  blame, this is the site for you. To get started, use the button below to\n  select the replay you want to load. These are .bbrz files that are usually\n  located in My Documents\\BloodBowl2\\Profiles\\(Coach Name or ID)\\Replays. Diced\n  or Not will analyze the replay and extract all the dice rolls, then show them\n  to you along with a bunch of statistics about just how lucky or unlucky you\n  were.",w(n,"id","about")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class j7 extends le{constructor(e){super(),se(this,e,null,M7,o,{})}}function F7(t){let n;return{c(){n=p("nav"),n.innerHTML='<a class="navbar-brand svelte-gb2y3h" href="/#">Diced or Not</a> \n    <ul class="navbar-nav"><li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#about">About</a></li> \n      <li class="dropdown svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#summary">Replay</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#explanation">Explain?</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#contact">Contact</a></li></ul>',w(n,"class","navbar-dark bg-dark sidenav svelte-gb2y3h")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class T7 extends le{constructor(e){super(),se(this,e,null,F7,o,{})}}function N7(e){let t,n,r,i,a,o,s;return n=new l8({props:{casType:"reserve",dugout:e[0]}}),i=new l8({props:{casType:"ko",dugout:e[0]}}),o=new l8({props:{casType:"cas",dugout:e[0]}}),{c(){t=p("div"),ie(n.$$.fragment),r=g(),ie(i.$$.fragment),a=g(),ie(o.$$.fragment),w(t,"class","bench svelte-4xq83r")},m(e,l){f(e,t,l),ae(n,t,null),c(t,r),ae(i,t,null),c(t,a),ae(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),o.$set(s)},i(e){s||(Y(n.$$.fragment,e),Y(i.$$.fragment,e),Y(o.$$.fragment,e),s=!0)},o(e){J(n.$$.fragment,e),J(i.$$.fragment,e),J(o.$$.fragment,e),s=!1},d(e){e&&d(t),oe(n),oe(i),oe(o)}}}function R7(e,t,n){let{dugout:r}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout)},[r]}class P7 extends le{constructor(e){super(),se(this,e,R7,N7,o,{dugout:0})}}function z7(e){let t,n,r,i;const a=e[4].default,o=function(e,t,n,r){if(e){const i=s(e,t,n,r);return e[0](i)}}(a,e,e[3],null);return{c(){t=p("div"),n=p("div"),o&&o.c(),w(n,"class",r=u(`inner ${e[2]||""}`)+" svelte-190gtax"),w(t,"class","outer svelte-190gtax"),k(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},m(e,r){f(e,t,r),c(t,n),o&&o.m(n,null),i=!0},p(e,[s]){o&&o.p&&8&s&&l(o,a,e,e[3],s,null,null),(!i||4&s&&r!==(r=u(`inner ${e[2]||""}`)+" svelte-190gtax"))&&w(n,"class",r),(!i||3&s)&&k(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},i(e){i||(Y(o,e),i=!0)},o(e){J(o,e),i=!1},d(e){e&&d(t),o&&o.d(e)}}}function B7(e,t,n){let{$$slots:r={},$$scope:i}=t,{width:a=1}=t,{height:o=1}=t,{class:s=null}=t;return e.$$set=e=>{"width"in e&&n(0,a=e.width),"height"in e&&n(1,o=e.height),"class"in e&&n(2,s=e.class),"$$scope"in e&&n(3,i=e.$$scope)},[a,o,s,i,r]}class L7 extends le{constructor(e){super(),se(this,e,B7,z7,o,{width:0,height:1,class:2})}}function I7(e,t,n){const r=e.slice();return r[5]=t[n],r[7]=n,r}function q7(e,t,n){const r=e.slice();return r[8]=t[n],r[10]=n,r}function U7(t){let n,r;return{c(){n=p("div"),w(n,"class","grid-item svelte-1gz3er0"),w(n,"id",r=t[0]+"_"+t[10]+"_"+t[7])},m(e,t){f(e,n,t)},p(e,t){7&t&&r!==(r=e[0]+"_"+e[10]+"_"+e[7])&&w(n,"id",r)},i:e,o:e,d(e){e&&d(n)}}}function V7(e){let n,r,i;const a=[{row:e[7]},{column:e[10]},{width:e[1]},{height:e[2]},e[4],{id:e[0]+"_"+e[10]+"_"+e[7]}];var o=e[3];function s(e){let n={};for(let e=0;e<a.length;e+=1)n=t(n,a[e]);return{props:n}}return o&&(n=new o(s())),{c(){n&&ie(n.$$.fragment),r=y()},m(e,t){n&&ae(n,e,t),f(e,r,t),i=!0},p(e,t){const i=23&t?te(a,[4&t&&{row:e[7]},2&t&&{column:e[10]},2&t&&{width:e[1]},4&t&&{height:e[2]},16&t&&ne(e[4]),7&t&&{id:e[0]+"_"+e[10]+"_"+e[7]}]):{};if(o!==(o=e[3])){if(n){G();const e=n;J(e.$$.fragment,1,0,(()=>{oe(e,1)})),X()}o?(n=new o(s()),ie(n.$$.fragment),Y(n.$$.fragment,1),ae(n,r.parentNode,r)):n=null}else o&&n.$set(i)},i(e){i||(n&&Y(n.$$.fragment,e),i=!0)},o(e){n&&J(n.$$.fragment,e),i=!1},d(e){e&&d(r),n&&oe(n,e)}}}function W7(e,t){let n,r,i,a,o;const s=[V7,U7],l=[];function u(e,t){return e[3]?0:1}return r=u(t),i=l[r]=s[r](t),{key:e,first:null,c(){n=y(),i.c(),a=y(),this.first=n},m(e,t){f(e,n,t),l[r].m(e,t),f(e,a,t),o=!0},p(e,t){let n=r;r=u(e),r===n?l[r].p(e,t):(G(),J(l[n],1,1,(()=>{l[n]=null})),X(),i=l[r],i?i.p(e,t):(i=l[r]=s[r](e),i.c()),Y(i,1),i.m(a.parentNode,a))},i(e){o||(Y(i),o=!0)},o(e){J(i),o=!1},d(e){e&&d(n),l[r].d(e),e&&d(a)}}}function H7(e,t){let n,r,i,a=[],o=new Map,s=Array(t[1]);const l=e=>e[10];for(let e=0;e<s.length;e+=1){let n=q7(t,s,e),r=l(n);o.set(r,a[e]=W7(r,n))}return{key:e,first:null,c(){n=y();for(let e=0;e<a.length;e+=1)a[e].c();r=y(),this.first=n},m(e,t){f(e,n,t);for(let n=0;n<a.length;n+=1)a[n].m(e,t);f(e,r,t),i=!0},p(e,t){if(31&t){const n=Array(e[1]);G(),a=ee(a,t,l,1,e,n,o,r.parentNode,Z,W7,r,q7),X()}},i(e){if(!i){for(let e=0;e<s.length;e+=1)Y(a[e]);i=!0}},o(e){for(let e=0;e<a.length;e+=1)J(a[e]);i=!1},d(e){e&&d(n);for(let t=0;t<a.length;t+=1)a[t].d(e);e&&d(r)}}}function G7(e){let t,n,r=[],i=new Map,a=Array(e[2]);const o=e=>e[7];for(let t=0;t<a.length;t+=1){let n=I7(e,a,t),s=o(n);i.set(s,r[t]=H7(s,n))}return{c(){t=p("div");for(let e=0;e<r.length;e+=1)r[e].c();w(t,"class","grid svelte-1gz3er0"),k(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),k(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},m(e,i){f(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,a){if(31&a){const n=Array(e[2]);G(),r=ee(r,a,o,1,e,n,i,t,Z,H7,null,I7),X()}(!n||2&a)&&k(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),(!n||4&a)&&k(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},i(e){if(!n){for(let e=0;e<a.length;e+=1)Y(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)J(r[e]);n=!1},d(e){e&&d(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function X7(e){let t,n;return t=new L7({props:{width:e[1],height:e[2],$$slots:{default:[G7]},$$scope:{ctx:e}}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,[n]){const r={};2&n&&(r.width=e[1]),4&n&&(r.height=e[2]),2079&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function Y7(e,t,n){let{prefix:r}=t,{width:i}=t,{height:a}=t,{component:o=null}=t,{componentProps:s={}}=t;return e.$$set=e=>{"prefix"in e&&n(0,r=e.prefix),"width"in e&&n(1,i=e.width),"height"in e&&n(2,a=e.height),"component"in e&&n(3,o=e.component),"componentProps"in e&&n(4,s=e.componentProps)},[r,i,a,o,s]}class J7 extends le{constructor(e){super(),se(this,e,Y7,X7,o,{prefix:0,width:1,height:2,component:3,componentProps:4})}}function K7(e){let t,n;return{c(){t=p("img"),t.src!==(n=`/images/skills/${e[6]}.png`)&&w(t,"src",n),w(t,"alt",e[6]),w(t,"class","svelte-28czd8")},m(e,n){f(e,t,n)},p(e,r){64&r&&t.src!==(n=`/images/skills/${e[6]}.png`)&&w(t,"src",n),64&r&&w(t,"alt",e[6])},d(e){e&&d(t)}}}function Q7(t){let n,r,i,a=t[6]&&K7(t);return{c(){n=p("div"),a&&a.c(),w(n,"id",r="player_"+t[0]),w(n,"class",i=u(t[7])+" svelte-28czd8"),O(n,"done",t[1]),O(n,"moving",t[2]),O(n,"stunned",t[3]),O(n,"prone",t[4]),O(n,"blitz",t[5])},m(e,t){f(e,n,t),a&&a.m(n,null)},p(e,[t]){e[6]?a?a.p(e,t):(a=K7(e),a.c(),a.m(n,null)):a&&(a.d(1),a=null),1&t&&r!==(r="player_"+e[0])&&w(n,"id",r),128&t&&i!==(i=u(e[7])+" svelte-28czd8")&&w(n,"class",i),130&t&&O(n,"done",e[1]),132&t&&O(n,"moving",e[2]),136&t&&O(n,"stunned",e[3]),144&t&&O(n,"prone",e[4]),160&t&&O(n,"blitz",e[5])},i:e,o:e,d(e){e&&d(n),a&&a.d()}}}function Z7(e,t,n){let r,{id:i}=t,{race:a}=t,{model:o}=t,{team:s}=t,{done:l=!1}=t,{moving:u=!1}=t,{stunned:c=!1}=t,{prone:f=!1}=t,{blitz:d=!1}=t,{cas:h=null}=t,{stupidity:p=null}=t;return e.$$set=e=>{"id"in e&&n(0,i=e.id),"race"in e&&n(8,a=e.race),"model"in e&&n(9,o=e.model),"team"in e&&n(10,s=e.team),"done"in e&&n(1,l=e.done),"moving"in e&&n(2,u=e.moving),"stunned"in e&&n(3,c=e.stunned),"prone"in e&&n(4,f=e.prone),"blitz"in e&&n(5,d=e.blitz),"cas"in e&&n(6,h=e.cas),"stupidity"in e&&n(11,p=e.stupidity)},e.$$.update=()=>{3840&e.$$.dirty&&n(7,r=[a,o,s,"sprite"].concat(p?[p]:[]).join(" "))},[i,l,u,c,f,d,h,r,a,o,s,p]}class e8 extends le{constructor(e){super(),se(this,e,Z7,Q7,o,{id:0,race:8,model:9,team:10,done:1,moving:2,stunned:3,prone:4,blitz:5,cas:6,stupidity:11})}}function t8(e){let n,r;const i=[e[1]];let a={};for(let e=0;e<i.length;e+=1)a=t(a,i[e]);return n=new e8({props:a}),{c(){ie(n.$$.fragment)},m(e,t){ae(n,e,t),r=!0},p(e,t){const r=2&t?te(i,[ne(e[1])]):{};n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){oe(n,e)}}}function n8(e){let t,n,r=e[1]&&t8(e);return{c(){t=p("div"),r&&r.c(),w(t,"id",e[0]),w(t,"class","pitch-square svelte-eoi57j")},m(e,i){f(e,t,i),r&&r.m(t,null),n=!0},p(e,[i]){e[1]?r?(r.p(e,i),2&i&&Y(r,1)):(r=t8(e),r.c(),Y(r,1),r.m(t,null)):r&&(G(),J(r,1,1,(()=>{r=null})),X()),(!n||1&i)&&w(t,"id",e[0])},i(e){n||(Y(r),n=!0)},o(e){J(r),n=!1},d(e){e&&d(t),r&&r.d()}}}function r8(e,t,n){let r,{dugout:i}=t,{id:a}=t,{row:o}=t,{column:s}=t,{width:l}=t,{height:u}=t,{casType:c}=t,f=null;return e.$$set=e=>{"dugout"in e&&n(2,i=e.dugout),"id"in e&&n(0,a=e.id),"row"in e&&n(3,o=e.row),"column"in e&&n(4,s=e.column),"width"in e&&n(5,l=e.width),"height"in e&&n(6,u=e.height),"casType"in e&&n(7,c=e.casType)},e.$$.update=()=>{508&e.$$.dirty&&i&&(n(8,r="ko"==c?i.cas.slice(l*u).concat(i[c]):"reserve"==c?i.ko.slice(l*u).concat(i[c]):i[c]),n(1,f=r[s*u+o]))},[a,f,i,o,s,l,u,c,r]}class i8 extends le{constructor(e){super(),se(this,e,r8,n8,o,{dugout:2,id:0,row:3,column:4,width:5,height:6,casType:7})}}function a8(e){let t;return{c(){t=p("div"),t.innerHTML='<div id="player_14" class="vampire thrall3 sprite home"><img src="ArmourBust.png" width="20" height="20"/><img src="ArmourBust.png" width="20" height="20"/></div>',w(t,"class","grid_item"),w(t,"id","home_cas_0_0")},m(e,n){f(e,t,n)},d(e){e&&d(t)}}}function o8(e){let t,n,r,i;return n=new J7({props:{width:4,height:2,prefix:e[0],component:i8,componentProps:{casType:e[0],dugout:e[1]},$$slots:{default:[a8]},$$scope:{ctx:e}}}),{c(){t=p("div"),ie(n.$$.fragment),w(t,"class",r=`bench ${e[0]}`)},m(e,r){f(e,t,r),ae(n,t,null),i=!0},p(e,[a]){const o={};1&a&&(o.prefix=e[0]),3&a&&(o.componentProps={casType:e[0],dugout:e[1]}),4&a&&(o.$$scope={dirty:a,ctx:e}),n.$set(o),(!i||1&a&&r!==(r=`bench ${e[0]}`))&&w(t,"class",r)},i(e){i||(Y(n.$$.fragment,e),i=!0)},o(e){J(n.$$.fragment,e),i=!1},d(e){e&&d(t),oe(n)}}}function s8(e,t,n){let{casType:r}=t,{dugout:i}=t;return e.$$set=e=>{"casType"in e&&n(0,r=e.casType),"dugout"in e&&n(1,i=e.dugout)},[r,i]}class l8 extends le{constructor(e){super(),se(this,e,s8,o8,o,{casType:0,dugout:1})}}function u8(e){let t,n,r,i,a,o,s;return n=new l8({props:{casType:"cas",dugout:e[0]}}),i=new l8({props:{casType:"ko",dugout:e[0]}}),o=new l8({props:{casType:"reserve",dugout:e[0]}}),{c(){t=p("div"),ie(n.$$.fragment),r=g(),ie(i.$$.fragment),a=g(),ie(o.$$.fragment),w(t,"class","bench svelte-kd7r5x")},m(e,l){f(e,t,l),ae(n,t,null),c(t,r),ae(i,t,null),c(t,a),ae(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),o.$set(s)},i(e){s||(Y(n.$$.fragment,e),Y(i.$$.fragment,e),Y(o.$$.fragment,e),s=!0)},o(e){J(n.$$.fragment,e),J(i.$$.fragment,e),J(o.$$.fragment,e),s=!1},d(e){e&&d(t),oe(n),oe(i),oe(o)}}}function c8(e,t,n){let{dugout:r}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout)},[r]}class f8 extends le{constructor(e){super(),se(this,e,c8,u8,o,{dugout:0})}}function d8(e){let t,n,r,i,a;return{c(){t=p("div"),t.innerHTML='<div class="inducement wizard svelte-ulwshi"></div>',n=g(),r=p("div"),r.innerHTML='<div class="inducement apo svelte-ulwshi"></div>',i=g(),a=p("div"),a.innerHTML='<div class="reroll svelte-ulwshi"></div>',w(t,"class","grid_item_dice"),w(r,"class","grid_item_dice"),w(a,"class","grid_item_dice")},m(e,o){f(e,t,o),f(e,n,o),f(e,r,o),f(e,i,o),f(e,a,o)},d(e){e&&d(t),e&&d(n),e&&d(r),e&&d(i),e&&d(a)}}}function h8(e){let t,n;return t=new J7({props:{width:10,height:3,prefix:"dice",$$slots:{default:[d8]},$$scope:{ctx:e}}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}class p8 extends le{constructor(e){super(),se(this,e,null,h8,o,{})}}function m8(e){let t;return{c(){t=p("div"),t.innerHTML='<div id="selectedPlayerName"></div> \n    <div><div class="grid_stat">MV</div> \n      <div class="grid_stat" id="selectPlayer-MV"></div> \n      <div class="grid_stat">ST</div> \n      <div class="grid_stat" id="selectPlayer-ST"></div> \n      <div class="grid_stat">AG</div> \n      <div class="grid_stat" id="selectPlayer-AG"></div> \n      <div class="grid_stat">AV</div> \n      <div class="grid_stat" id="selectPlayer-AV"></div></div> \n    <div id="selectedPlayerCAS"></div> \n    <div id="skills"></div>',w(t,"id","selectedPlayerData"),w(t,"class","svelte-dj6vrn")},m(e,n){f(e,t,n)},d(e){e&&d(t)}}}function g8(e){let t,n;return t=new L7({props:{width:207,height:317,$$slots:{default:[m8]},$$scope:{ctx:e}}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}class y8 extends le{constructor(e){super(),se(this,e,null,g8,o,{})}}function v8(e){let t,n,r;return{c(){t=p("div"),w(t,"class",n=u(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu"),w(t,"title",r=e[1][e[0]])},m(e,n){f(e,t,n)},p(e,i){1&i&&n!==(n=u(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu")&&w(t,"class",n),1&i&&r!==(r=e[1][e[0]])&&w(t,"title",r)},d(e){e&&d(t)}}}function b8(e){let t,n;return t=new L7({props:{$$slots:{default:[v8]},$$scope:{ctx:e}}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,[n]){const r={};9&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function x8(e,t,n){let{weather:r}=t;const i={[Ge]:"perfect blood bowl weather",[Xe]:"sweltering heat!",[Ye]:"very sunny",[Je]:"pouring rain",[Ke]:"blizzard go brrrr"},a={[Ge]:"nice",[Xe]:"heat",[Ye]:"sunny",[Je]:"rain",[Ke]:"blizzard"};return e.$$set=e=>{"weather"in e&&n(0,r=e.weather)},[r,i,a]}class w8 extends le{constructor(e){super(),se(this,e,x8,b8,o,{weather:0})}}function _8(e){let t,n,r,i,a,o,s,l,u,h,y,v,b,x,k,S,E,$,A,D,C,M,j,F,T,N,R,P=e[0].name+"",z=e[0].score+"",B=e[0].turn+"";return n=new f8({props:{dugout:e[0].dugout}}),D=new p8({}),j=new y8({}),N=new w8({props:{weather:e[1]}}),{c(){t=p("div"),ie(n.$$.fragment),r=g(),i=p("img"),s=g(),l=p("div"),u=m(P),h=g(),y=p("div"),v=p("p"),b=m(z),x=g(),k=p("div"),S=p("p"),E=m(B),$=g(),A=p("div"),ie(D.$$.fragment),C=g(),M=p("div"),ie(j.$$.fragment),F=g(),T=p("div"),ie(N.$$.fragment),i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png")&&w(i,"src",a),w(i,"alt",o="Logo: "+e[0].logo),w(i,"class","logo svelte-x8vtg0"),w(l,"class","name svelte-x8vtg0"),w(y,"class","score svelte-x8vtg0"),w(k,"class","turn svelte-x8vtg0"),O(k,"active",e[0].active),w(A,"class","aids svelte-x8vtg0"),w(M,"class","selected svelte-x8vtg0"),w(T,"class","weather svelte-x8vtg0"),w(t,"class","dugout svelte-x8vtg0")},m(e,a){f(e,t,a),ae(n,t,null),c(t,r),c(t,i),c(t,s),c(t,l),c(l,u),c(t,h),c(t,y),c(y,v),c(v,b),c(t,x),c(t,k),c(k,S),c(S,E),c(t,$),c(t,A),ae(D,A,null),c(t,C),c(t,M),ae(j,M,null),c(t,F),c(t,T),ae(N,T,null),R=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0].dugout),n.$set(r),(!R||1&t&&i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png"))&&w(i,"src",a),(!R||1&t&&o!==(o="Logo: "+e[0].logo))&&w(i,"alt",o),(!R||1&t)&&P!==(P=e[0].name+"")&&_(u,P),(!R||1&t)&&z!==(z=e[0].score+"")&&_(b,z),(!R||1&t)&&B!==(B=e[0].turn+"")&&_(E,B),1&t&&O(k,"active",e[0].active);const s={};2&t&&(s.weather=e[1]),N.$set(s)},i(e){R||(Y(n.$$.fragment,e),Y(D.$$.fragment,e),Y(j.$$.fragment,e),Y(N.$$.fragment,e),R=!0)},o(e){J(n.$$.fragment,e),J(D.$$.fragment,e),J(j.$$.fragment,e),J(N.$$.fragment,e),R=!1},d(e){e&&d(t),oe(n),oe(D),oe(j),oe(N)}}}function k8(e,t,n){let{homeTeam:r}=t,{weather:i}=t;return e.$$set=e=>{"homeTeam"in e&&n(0,r=e.homeTeam),"weather"in e&&n(1,i=e.weather)},[r,i]}class O8 extends le{constructor(e){super(),se(this,e,k8,_8,o,{homeTeam:0,weather:1})}}function S8(e){let t,n,r,i,a,o,s,l,u,h,y,v,b,x,k,S,E,$,A,D=e[0].score+"",C=e[0].turn+"",M=e[0].name+"";return r=new p8({props:{reverse:!0}}),$=new P7({props:{dugout:e[0].dugout}}),{c(){t=p("div"),n=p("div"),ie(r.$$.fragment),i=g(),a=p("div"),o=m(D),s=g(),l=p("div"),u=m(C),h=g(),y=p("div"),v=m(M),b=g(),x=p("img"),E=g(),ie($.$$.fragment),w(n,"class","aids svelte-1dth5by"),w(a,"class","score svelte-1dth5by"),w(l,"class","turn svelte-1dth5by"),O(l,"active",e[0].active),w(y,"class","name svelte-1dth5by"),w(x,"class","logo svelte-1dth5by"),x.src!==(k="/images/logo/256x256/logo_"+e[0].logo+".png")&&w(x,"src",k),w(x,"alt",S="Logo: "+e[0].logo),w(t,"class","dugout svelte-1dth5by")},m(e,d){f(e,t,d),c(t,n),ae(r,n,null),c(t,i),c(t,a),c(a,o),c(t,s),c(t,l),c(l,u),c(t,h),c(t,y),c(y,v),c(t,b),c(t,x),c(t,E),ae($,t,null),A=!0},p(e,[t]){(!A||1&t)&&D!==(D=e[0].score+"")&&_(o,D),(!A||1&t)&&C!==(C=e[0].turn+"")&&_(u,C),1&t&&O(l,"active",e[0].active),(!A||1&t)&&M!==(M=e[0].name+"")&&_(v,M),(!A||1&t&&x.src!==(k="/images/logo/256x256/logo_"+e[0].logo+".png"))&&w(x,"src",k),(!A||1&t&&S!==(S="Logo: "+e[0].logo))&&w(x,"alt",S);const n={};1&t&&(n.dugout=e[0].dugout),$.$set(n)},i(e){A||(Y(r.$$.fragment,e),Y($.$$.fragment,e),A=!0)},o(e){J(r.$$.fragment,e),J($.$$.fragment,e),A=!1},d(e){e&&d(t),oe(r),oe($)}}}function E8(e,t,n){let{awayTeam:r}=t;return e.$$set=e=>{"awayTeam"in e&&n(0,r=e.awayTeam)},[r]}class $8 extends le{constructor(e){super(),se(this,e,E8,S8,o,{awayTeam:0})}}function A8(t){let n;return{c(){n=p("div"),w(n,"class","logo svelte-5pwedy"),k(n,"background-image","url('/images/logo/256x256/logo_"+t[0]+".png')")},m(e,t){f(e,n,t)},p(e,[t]){1&t&&k(n,"background-image","url('/images/logo/256x256/logo_"+e[0]+".png')")},i:e,o:e,d(e){e&&d(n)}}}function D8(e,t,n){let{logo:r}=t;return e.$$set=e=>{"logo"in e&&n(0,r=e.logo)},[r]}class C8 extends le{constructor(e){super(),se(this,e,D8,A8,o,{logo:0})}}function M8(t){let n,r;return{c(){n=p("div"),w(n,"class",r=u(`cell sprite ${t[4]}`)+" svelte-1t9kenh"),O(n,"active",t[0]),O(n,"target",t[1]),O(n,"moved",t[3]),O(n,"pushback-choice",t[2])},m(e,t){f(e,n,t)},p(e,[t]){16&t&&r!==(r=u(`cell sprite ${e[4]}`)+" svelte-1t9kenh")&&w(n,"class",r),17&t&&O(n,"active",e[0]),18&t&&O(n,"target",e[1]),24&t&&O(n,"moved",e[3]),20&t&&O(n,"pushback-choice",e[2])},i:e,o:e,d(e){e&&d(n)}}}function j8(e,t,n){let r,{plus:i=null}=t,{active:a=!1}=t,{target:o=!1}=t,{pushbackChoice:s=!1}=t,{moved:l=!1}=t;return e.$$set=e=>{"plus"in e&&n(5,i=e.plus),"active"in e&&n(0,a=e.active),"target"in e&&n(1,o=e.target),"pushbackChoice"in e&&n(2,s=e.pushbackChoice),"moved"in e&&n(3,l=e.moved)},e.$$.update=()=>{33&e.$$.dirty&&n(4,r=!a&&i?`plus${i}`:"")},[a,o,s,l,r,i]}class F8 extends le{constructor(e){super(),se(this,e,j8,M8,o,{plus:5,active:0,target:1,pushbackChoice:2,moved:3})}}function T8(t){let n;return{c(){n=p("div"),w(n,"id","ball"),w(n,"class","svelte-q0voaj"),O(n,"held",t[0])},m(e,t){f(e,n,t)},p(e,[t]){1&t&&O(n,"held",e[0])},i:e,o:e,d(e){e&&d(n)}}}function N8(e,t,n){let{held:r=!1}=t;return e.$$set=e=>{"held"in e&&n(0,r=e.held)},[r]}class R8 extends le{constructor(e){super(),se(this,e,N8,T8,o,{held:0})}}function P8(e,t,n){const r=e.slice();return r[2]=t[n],r}function z8(e){let t,n=e[0],r=[];for(let t=0;t<n.length;t+=1)r[t]=B8(P8(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=y()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);f(e,t,n)},p(e,i){if(3&i){let a;for(n=e[0],a=0;a<n.length;a+=1){const o=P8(e,n,a);r[a]?r[a].p(o,i):(r[a]=B8(o),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(e){h(r,e),e&&d(t)}}}function B8(e){let t,n;return{c(){t=p("div"),w(t,"class",n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")},m(e,n){f(e,t,n)},p(e,r){1&r&&n!==(n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")&&w(t,"class",n)},d(e){e&&d(t)}}}function L8(t){let n,r=t[0]&&z8(t);return{c(){n=p("div"),r&&r.c(),w(n,"class","dice-container svelte-1cue4bg")},m(e,t){f(e,n,t),r&&r.m(n,null)},p(e,[t]){e[0]?r?r.p(e,t):(r=z8(e),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&d(n),r&&r.d()}}}function I8(e,t,n){let{dice:r}=t;return e.$$set=e=>{"dice"in e&&n(0,r=e.dice)},[r,["attacker-down","both-down","push","defender-stumbles","defender-down"]]}class q8 extends le{constructor(e){super(),se(this,e,I8,L8,o,{dice:0})}}function U8(t){let n;return{c(){n=p("div"),n.innerHTML='<div class="dice sprite d1h foul svelte-u76c3n"></div>',w(n,"class","dice-container svelte-u76c3n")},m(e,t){f(e,n,t)},p:e,i:e,o:e,d(e){e&&d(n)}}}class V8 extends le{constructor(e){super(),se(this,e,null,U8,o,{})}}function W8(e){let t,n;return t=new C8({props:{logo:e[3].toLowerCase()}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.logo=e[3].toLowerCase()),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function H8(e){let t,n;return t=new C8({props:{logo:e[4].toLowerCase()}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.logo=e[4].toLowerCase()),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function G8(e){let n,r;const i=[e[6]];let a={};for(let e=0;e<i.length;e+=1)a=t(a,i[e]);return n=new F8({props:a}),{c(){ie(n.$$.fragment)},m(e,t){ae(n,e,t),r=!0},p(e,t){const r=64&t?te(i,[ne(e[6])]):{};n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){oe(n,e)}}}function X8(e){let n,r;const i=[e[5]];let a={};for(let e=0;e<i.length;e+=1)a=t(a,i[e]);return n=new e8({props:a}),{c(){ie(n.$$.fragment)},m(e,t){ae(n,e,t),r=!0},p(e,t){const r=32&t?te(i,[ne(e[5])]):{};n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){oe(n,e)}}}function Y8(e){let t,n;return t=new q8({props:{dice:e[8]}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,n){const r={};256&n&&(r.dice=e[8]),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function J8(e){let t,n;return t=new V8({}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function K8(e){let n,r;const i=[e[7]];let a={};for(let e=0;e<i.length;e+=1)a=t(a,i[e]);return n=new R8({props:a}),{c(){ie(n.$$.fragment)},m(e,t){ae(n,e,t),r=!0},p(e,t){const r=128&t?te(i,[ne(e[7])]):{};n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){oe(n,e)}}}function Q8(e){let t,n,r,i,a,o,s,l,u=0==e[2]&&7==e[1]&&e[3]&&W8(e),h=25==e[2]&&7==e[1]&&e[4]&&H8(e),m=e[6]&&G8(e),y=e[5]&&X8(e),v=e[8]&&Y8(e),b=e[9]&&J8(),x=e[7]&&K8(e);return{c(){t=p("div"),u&&u.c(),n=g(),h&&h.c(),r=g(),m&&m.c(),i=g(),y&&y.c(),a=g(),v&&v.c(),o=g(),b&&b.c(),s=g(),x&&x.c(),w(t,"id",e[0]),w(t,"class","pitch-square svelte-124v8fk")},m(e,d){f(e,t,d),u&&u.m(t,null),c(t,n),h&&h.m(t,null),c(t,r),m&&m.m(t,null),c(t,i),y&&y.m(t,null),c(t,a),v&&v.m(t,null),c(t,o),b&&b.m(t,null),c(t,s),x&&x.m(t,null),l=!0},p(e,[c]){0==e[2]&&7==e[1]&&e[3]?u?(u.p(e,c),14&c&&Y(u,1)):(u=W8(e),u.c(),Y(u,1),u.m(t,n)):u&&(G(),J(u,1,1,(()=>{u=null})),X()),25==e[2]&&7==e[1]&&e[4]?h?(h.p(e,c),22&c&&Y(h,1)):(h=H8(e),h.c(),Y(h,1),h.m(t,r)):h&&(G(),J(h,1,1,(()=>{h=null})),X()),e[6]?m?(m.p(e,c),64&c&&Y(m,1)):(m=G8(e),m.c(),Y(m,1),m.m(t,i)):m&&(G(),J(m,1,1,(()=>{m=null})),X()),e[5]?y?(y.p(e,c),32&c&&Y(y,1)):(y=X8(e),y.c(),Y(y,1),y.m(t,a)):y&&(G(),J(y,1,1,(()=>{y=null})),X()),e[8]?v?(v.p(e,c),256&c&&Y(v,1)):(v=Y8(e),v.c(),Y(v,1),v.m(t,o)):v&&(G(),J(v,1,1,(()=>{v=null})),X()),e[9]?b?512&c&&Y(b,1):(b=J8(),b.c(),Y(b,1),b.m(t,s)):b&&(G(),J(b,1,1,(()=>{b=null})),X()),e[7]?x?(x.p(e,c),128&c&&Y(x,1)):(x=K8(e),x.c(),Y(x,1),x.m(t,null)):x&&(G(),J(x,1,1,(()=>{x=null})),X()),(!l||1&c)&&w(t,"id",e[0])},i(e){l||(Y(u),Y(h),Y(m),Y(y),Y(v),Y(b),Y(x),l=!0)},o(e){J(u),J(h),J(m),J(y),J(v),J(b),J(x),l=!1},d(e){e&&d(t),u&&u.d(),h&&h.d(),m&&m.d(),y&&y.d(),v&&v.d(),b&&b.d(),x&&x.d()}}}function Z8(e,t,n){let{id:r}=t,{row:i}=t,{column:a}=t,{width:o}=t,{height:s}=t,{pitch:l}=t,{homeLogo:u}=t,{awayLogo:c}=t,f=null,d=null,h=null,p=null,m=!1;return e.$$set=e=>{"id"in e&&n(0,r=e.id),"row"in e&&n(1,i=e.row),"column"in e&&n(2,a=e.column),"width"in e&&n(10,o=e.width),"height"in e&&n(11,s=e.height),"pitch"in e&&n(12,l=e.pitch),"homeLogo"in e&&n(3,u=e.homeLogo),"awayLogo"in e&&n(4,c=e.awayLogo)},e.$$.update=()=>{4102&e.$$.dirty&&n(5,({player:f,cell:d,ball:h,dice:p,foul:m}=l[`${a}-${i}`]||{}),f,(n(6,d),n(12,l),n(2,a),n(1,i)),(n(7,h),n(12,l),n(2,a),n(1,i)),(n(8,p),n(12,l),n(2,a),n(1,i)),(n(9,m),n(12,l),n(2,a),n(1,i)))},[r,i,a,u,c,f,d,h,p,m,o,s,l]}class e9 extends le{constructor(e){super(),se(this,e,Z8,Q8,o,{id:0,row:1,column:2,width:10,height:11,pitch:12,homeLogo:3,awayLogo:4})}}function t9(e){let t,n,r;return n=new J7({props:{width:26,height:15,prefix:"pos",component:e9,componentProps:{homeLogo:e[1],awayLogo:e[2],pitch:e[0]}}}),{c(){t=p("div"),ie(n.$$.fragment),w(t,"class","pitch svelte-1d39j5z")},m(e,i){f(e,t,i),ae(n,t,null),r=!0},p(e,[t]){const r={};7&t&&(r.componentProps={homeLogo:e[1],awayLogo:e[2],pitch:e[0]}),n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){e&&d(t),oe(n)}}}function n9(e,t,n){let r,i,{homeTeam:a}=t,{awayTeam:o}=t,{pitch:s}=t;return e.$$set=e=>{"homeTeam"in e&&n(3,a=e.homeTeam),"awayTeam"in e&&n(4,o=e.awayTeam),"pitch"in e&&n(0,s=e.pitch)},e.$$.update=()=>{24&e.$$.dirty&&(n(1,r=a.logo),n(2,i=o.logo))},[s,r,i,a,o]}class r9 extends le{constructor(e){super(),se(this,e,n9,t9,o,{homeTeam:3,awayTeam:4,pitch:0})}}function i9(e){let t,n;return{c(){t=p("div"),w(t,"class",n=u(`sprite ${e[0]}`)+" svelte-39bs0u")},m(e,n){f(e,t,n)},p(e,r){1&r&&n!==(n=u(`sprite ${e[0]}`)+" svelte-39bs0u")&&w(t,"class",n)},d(e){e&&d(t)}}}function a9(e){let t,n,r;return n=new L7({props:{width:2,height:1,$$slots:{default:[i9]},$$scope:{ctx:e}}}),{c(){t=p("div"),ie(n.$$.fragment),w(t,"class","banner svelte-39bs0u")},m(e,i){f(e,t,i),ae(n,t,null),r=!0},p(e,[t]){const r={};3&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i(e){r||(Y(n.$$.fragment,e),r=!0)},o(e){J(n.$$.fragment,e),r=!1},d(e){e&&d(t),oe(n)}}}function o9(e,t,n){let{banner:r}=t;return e.$$set=e=>{"banner"in e&&n(0,r=e.banner)},[r]}class s9 extends le{constructor(e){super(),se(this,e,o9,a9,o,{banner:0})}}const{document:l9}=K;function u9(e,t,n){const r=e.slice();return r[44]=t[n],r}function c9(e,t){let n,r;return{key:e,first:null,c(){n=p("link"),w(n,"rel","stylesheet"),w(n,"href",r="/styles/"+t[44]+".css"),this.first=n},m(e,t){f(e,n,t)},p(e,t){1&t[0]&&r!==(r="/styles/"+e[44]+".css")&&w(n,"href",r)},d(e){e&&d(n)}}}function f9(e){let t,n;return t=new s9({props:{banner:e[4]}}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},p(e,n){const r={};16&n[0]&&(r.banner=e[4]),t.$set(r)},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function d9(e){let t,n,r,i,a,o,s,l,u;n=new O8({props:{homeTeam:e[1],weather:e[5]}}),i=new r9({props:{pitch:e[3],homeTeam:e[1],awayTeam:e[2]}}),o=new $8({props:{awayTeam:e[2]}});let h=e[4]&&f9(e);return{c(){t=p("div"),ie(n.$$.fragment),r=g(),ie(i.$$.fragment),a=g(),ie(o.$$.fragment),s=g(),h&&h.c(),l=y(),w(t,"class","pitch svelte-70qdsx")},m(e,d){f(e,t,d),ae(n,t,null),c(t,r),ae(i,t,null),c(t,a),ae(o,t,null),f(e,s,d),h&&h.m(e,d),f(e,l,d),u=!0},p(e,t){const r={};2&t[0]&&(r.homeTeam=e[1]),32&t[0]&&(r.weather=e[5]),n.$set(r);const a={};8&t[0]&&(a.pitch=e[3]),2&t[0]&&(a.homeTeam=e[1]),4&t[0]&&(a.awayTeam=e[2]),i.$set(a);const s={};4&t[0]&&(s.awayTeam=e[2]),o.$set(s),e[4]?h?(h.p(e,t),16&t[0]&&Y(h,1)):(h=f9(e),h.c(),Y(h,1),h.m(l.parentNode,l)):h&&(G(),J(h,1,1,(()=>{h=null})),X())},i(e){u||(Y(n.$$.fragment,e),Y(i.$$.fragment,e),Y(o.$$.fragment,e),Y(h),u=!0)},o(e){J(n.$$.fragment,e),J(i.$$.fragment,e),J(o.$$.fragment,e),J(h),u=!1},d(e){e&&d(t),oe(n),oe(i),oe(o),e&&d(s),h&&h.d(e),e&&d(l)}}}function h9(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[44];for(let t=0;t<s.length;t+=1){let n=u9(e,s,t),r=l(n);o.set(r,a[t]=c9(r,n))}return r=new L7({props:{width:1335,height:1061,$$slots:{default:[d9]},$$scope:{ctx:e}}}),{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=p("link"),n=g(),ie(r.$$.fragment),w(t,"rel","stylesheet"),w(t,"href","/styles/sprite.css")},m(e,o){for(let e=0;e<a.length;e+=1)a[e].m(l9.head,null);c(l9.head,t),f(e,n,o),ae(r,e,o),i=!0},p(e,n){if(1&n[0]){const r=e[0];a=ee(a,n,l,1,e,r,o,t.parentNode,Q,c9,t,u9)}const i={};62&n[0]|65536&n[1]&&(i.$$scope={dirty:n,ctx:e}),r.$set(i)},i(e){i||(Y(r.$$.fragment,e),i=!0)},o(e){J(r.$$.fragment,e),i=!1},d(e){for(let e=0;e<a.length;e+=1)a[e].d();d(t),e&&d(n),oe(r,e)}}}function p9(e,t){return{logo:e.Data.Logo.toLowerCase(),dugout:{cas:[],ko:[],reserve:[]},score:e.Touchdown||0,name:e.Data.Name,turn:e.GameTurn||1,active:t}}function m9(e){return e&&e.length?e:e?[e]:[]}function g9(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}function y9(e){}function v9(e){let t=document.getElementById("ball");t.classList.remove("held");document.getElementById(`pos_${action.Order.CellTo.Cell.x}_${action.Order.CellTo.Cell.y}`).appendChild(t)}function b9(e){this.handleMove(e)}function x9(e){if(!e.Results.BoardActionResult.IsOrderCompleted)return;let t=document.getElementById("ball");if(t.classList.remove("held"),0!==e.Results.BoardActionResult.ResultType);else{document.getElementById(`pos_${e.Order.CellTo.Cell.x}_${e.Order.CellTo.Cell.y}`).appendChild(t)}}function w9(e,t,n){let r,i,a,o,s,l,{replaySteps:u}=t,{replayStepIndex:c}=t,{replayStart:f}=t,{replayEnd:d}=t,h=[],p={},m={},g={};const y={[We.Reserves]:"reserve",[We.KO]:"ko",[We.Casualty]:"cas",[We.SentOff]:"cas"};async function v(e,t,o){r=e.slice(t,o),t>0?await b(e[t-1].BoardState):(i=0,a=null,n(0,h=[]),n(1,p={}),n(2,m={}),n(3,g={}),n(5,l=Ge))}async function b(e){S(),o=e.BlitzerId,n(1,p=p9(e.ListTeams.TeamState[0],1!=e.ActiveTeam)),n(2,m=p9(e.ListTeams.TeamState[1],1==e.ActiveTeam)),n(0,h=e.ListTeams.TeamState.map((e=>Tt[e.Data.IdRace])).filter(((e,t,n)=>n.indexOf(e)===t))),function(e){Object.values(g).forEach((e=>{e.player&&(e.player=null)})),e.ListTeams.TeamState[0].ListPitchPlayers.PlayerState.map((e=>_(e,"home"))),e.ListTeams.TeamState[1].ListPitchPlayers.PlayerState.map((e=>_(e,"away")))}(e),function(e){let{x:t,y:n}=e.Ball.Cell;Object.values(g).forEach((e=>{e.ball=null})),-1!=t&&-1!=n&&(x(t,n).ball={held:1==e.Ball.IsHeld})}(e),await z()}function x(e,t){return n(3,g[`${e}-${t}`]=g[`${e}-${t}`]||{},g)}function w(e){let t;return Object.entries(g).forEach((([r,i])=>{i.player&&i.player.id==e&&(n(3,g[r]=i,g),t=i.player)})),t}function _(e,t){let n=function(e,t){switch(t){case 71:case 414:case 459:return{race:"amazon",model:"blitzer"+(e%2+1)};case 70:case 413:case 458:return{race:"amazon",model:"catcher"+(e%2+1)};case 68:case 411:case 456:return{race:"amazon",model:"lineman"+(e%2+1)};case 69:case 457:case 412:return{race:"amazon",model:"thrower"};case 32:case 336:case 355:return{race:"chaos",model:"beastman"+(e%4+1)};case 34:case 338:case 357:return{race:"chaos",model:"minotaur"+(e%3+1)};case 33:case 337:case 356:return{race:"chaos",model:"warrior"+(e%6+1)};case 330:case 363:case 109:return{race:"chaosdwarf",model:"blocker"+(e%4+1)};case 331:case 364:case 110:return{race:"chaosdwarf",model:"bullcentaur"+(e%2+1)};case 329:case 362:case 108:return{race:"chaosdwarf",model:"hobgoblin"+(e%4+1)};case 332:case 365:case 111:return{race:"chaosdwarf",model:"minotaur"};case 47:case 345:case 391:return{race:"darkelf",model:"lineman"};case 48:case 347:case 392:return{race:"darkelf",model:"runner"};case 49:case 346:case 394:return{race:"darkelf",model:"assasin"};case 50:case 344:case 393:return{race:"darkelf",model:"blitzer"};case 51:case 348:case 395:return{race:"darkelf",model:"witchelf"};case 6:case 426:return{race:"dwarf",model:"longbeard"+(e%3+1)};case 8:case 427:return{race:"dwarf",model:"blitzer"+(e%2+1)};case 7:case 429:return{race:"dwarf",model:"runner"+(e%3+1)};case 9:case 428:return{race:"dwarf",model:"trollslayer"+(e%2+1)};case 10:case 430:return{race:"dwarf",model:"deathroller"};case 30:case 372:case 466:case 479:return{race:"goblin",model:"goblin"+(e%7+1)};case 31:case 373:case 467:case 481:return{race:"goblin",model:"looney"+(e%2+1)};case 44:case 377:case 471:case 484:return{race:"goblin",model:"troll"+(e%3+1)};case 45:case 374:case 468:case 482:return{race:"goblin",model:"pogo"+(e%2+1)};case 46:case 376:case 470:case 483:return{race:"goblin",model:"fanatic"+(e%2+1)};case 107:case 375:case 469:case 480:return{race:"goblin",model:"bomber"+(e%2+1)};case 60:case 431:case 485:return{race:"halfling",model:"halfling"+(e%5+1)};case 61:case 432:case 486:return{race:"halfling",model:"treeman"+(e%3+1)};case 77:case 323:case 387:return{race:"highelf",model:"lineman"+(e%2+1)};case 78:case 325:case 390:return{race:"highelf",model:"thrower"};case 79:case 389:case 326:return{race:"highelf",model:"catch"+(e%2+1)};case 80:case 324:case 388:return{race:"highelf",model:"blitzer"};case 1:case 422:case 438:return{race:"human",model:"lineman"+(e%2+1)};case 2:case 423:case 440:return{race:"human",model:"catcher"};case 3:case 424:case 441:return{race:"human",model:"thrower"};case 4:case 421:case 439:return{race:"human",model:"blitzer"};case 5:case 425:case 442:return{race:"human",model:"ogre"};case 81:case 499:return{race:"khemri",model:"lineman"+(e%4+1)};case 82:case 500:return{race:"khemri",model:"thrower"+(e%2+1)};case 83:case 501:return{race:"khemri",model:"blitzer"+(e%2+1)};case 84:case 502:return{race:"khemri",model:"mummy"+(e%2+1)};case 27:case 415:case 472:return{race:"lizardman",model:"skink"+(e%4+1)};case 28:case 416:case 473:return{race:"lizardman",model:"saurus"+(e%4+1)};case 29:case 417:case 474:return{race:"lizardman",model:"kroxigor"+(e%2+1)};case 86:return{race:"necromantic",model:"zombie"+(e%4+1)};case 87:return{race:"necromantic",model:"ghoul"+(e%2+1)};case 88:return{race:"necromantic",model:"wight"+(e%2+1)};case 89:case 498:return{race:"necromantic",model:"golem"+(e%2+1)};case 90:case 497:return{race:"necromantic",model:"werewolf"+(e%2+1)};case 62:case 405:case 450:return{race:"norse",model:"lineman"+(e%4+1)};case 63:case 406:case 452:return{race:"norse",model:"thrower"};case 64:case 407:case 451:return{race:"norse",model:"runner"};case 65:case 408:case 453:return{race:"norse",model:"berserker"+(e%2+1)};case 66:case 409:case 454:return{race:"norse",model:"ulfwerener"+(e%2+1)};case 67:case 410:case 455:return{race:"norse",model:"yhetee"};case 91:case 358:return{race:"nurgle",model:"rotter"+(e%6+1)};case 92:case 359:return{race:"nurgle",model:"pestigor"+(e%4+1)};case 93:case 360:return{race:"nurgle",model:"warrior"+(e%4+1)};case 94:case 361:return{race:"nurgle",model:"beast - of - nurgle"};case 95:case 476:case 478:case 737:return{race:"ogre",model:"snotling"+(e%7+1)};case 96:case 475:case 477:case 738:return{race:"ogre",model:"ogre"+(e%6+1)};case 21:case 366:case 460:return{race:"orc",model:"lineman"+(e%3+1)};case 22:case 369:case 463:return{race:"orc",model:"goblin"+(e%2+1)};case 23:case 368:case 462:return{race:"orc",model:"thrower"+(e%2+1)};case 24:case 370:case 464:return{race:"orc",model:"blocker"+(e%4+1)};case 25:case 367:case 461:return{race:"orc",model:"blitzer"+(e%3+1)};case 26:case 371:case 465:return{race:"orc",model:"troll"};case 72:case 739:return{race:"proelf",model:"lineman"+(e%2+1)};case 73:case 741:return{race:"proelf",model:"thrower"};case 74:case 749:return{race:"proelf",model:"catcher"+(e%2+1)};case 75:case 740:return{race:"proelf",model:"blitzer"+(e%2+1)};case 16:case 339:case 378:return{race:"skaven",model:"lineman"+(e%3+1)};case 17:case 340:case 380:return{race:"skaven",model:"thrower"};case 18:case 341:case 381:return{race:"skaven",model:"runner"+(e%2+1)};case 19:case 342:case 379:return{race:"skaven",model:"blitzer"+(e%2+1)};case 20:case 343:case 382:return{race:"skaven",model:"ratogre"};case 54:case 492:return{race:"undead",model:"skeleton"+(e%3+1)};case 55:case 493:return{race:"undead",model:"zombie"+(e%4+1)};case 56:case 494:return{race:"undead",model:"ghoul"+(e%2+1)};case 57:case 495:return{race:"undead",model:"wight"+(e%2+1)};case 58:case 496:return{race:"undead",model:"mummy"+(e%2+1)};case 123:case 732:return{race:"underworld",model:"goblin"+(e%5+1)};case 124:case 733:return{race:"underworld",model:"lineman"+(e%4+1)};case 125:case 734:return{race:"underworld",model:"thrower"+(e%2+1)};case 126:case 735:return{race:"underworld",model:"blitzer"+(e%2+1)};case 127:case 736:return{race:"underworld",model:"troll"};case 97:case 327:case 327:case 503:return{race:"vampire",model:"thrall"+(e%3+1)};case 98:case 328:case 328:case 504:return{race:"vampire",model:"vampire"+(e%3+1)};case 11:case 396:case 433:return{race:"woodelf",model:"lineman"+(e%4+1)};case 12:case 397:case 434:return{race:"woodelf",model:"catcher"+(e%4+1)};case 13:case 398:case 435:return{race:"woodelf",model:"thrower"+(e%2+1)};case 14:case 399:case 436:return{race:"woodelf",model:"wardancer"+(e%2+1)};case 15:case 400:case 437:return{race:"woodelf",model:"tree"};case 142:case 401:case 446:return{race:"kislev",model:"lineman"+(e%4+1)};case 143:case 403:case 448:return{race:"kislev",model:"catcher"+(e%2+1)};case 144:case 402:case 447:return{race:"kislev",model:"blitzer"+(e%2+1)};case 145:case 404:case 449:return{race:"kislev",model:"bear"};case 139:case 333:case 420:case 443:return{race:"bretonnia",model:"peasant"+(e%3+1)};case 140:case 335:case 419:case 445:return{race:"bretonnia",model:"blocker"+(e%2+1)};case 141:case 334:case 418:case 444:return{race:"bretonnia",model:"knight"+(e%2+1)};case 146:case 239:case 617:case 618:return{model:"barik-farblast",race:"starplayer"};case 293:case 294:case 619:case 620:return{model:"bertha-bigfist",race:"starplayer"};case 133:case 233:case 621:case 622:return{model:"bomber-dribblesnot",race:"starplayer"};case 309:case 310:case 623:case 624:return{model:"boomer-eziasson",race:"starplayer"};case 164:case 256:case 625:case 626:return{model:"brick-farth",race:"starplayer"};case 224:case 59:case 627:case 628:return{model:"count-luthorvon-drakenborg",race:"starplayer"};case 301:case 302:case 629:case 630:return{model:"crazy-igor",race:"starplayer"};case 103:case 229:case 631:case 632:return{model:"deeproot-strongbranch",race:"starplayer"};case 147:case 240:case 633:case 634:return{model:"dolfar-longstride",race:"starplayer"};case 101:case 227:case 635:case 636:return{model:"eldril-sidewinder",race:"starplayer"};case 154:case 247:case 637:case 638:return{model:"fezglitch",race:"starplayer"};case 313:case 314:case 639:case 640:return{model:"flint-churnblade",race:"starplayer"};case 303:case 304:case 641:case 642:return{model:"fungus-the-loon",race:"starplayer"};case 149:case 242:case 643:case 644:return{model:"glart-smashrip-jr",race:"starplayer"};case 214:case 36:case 645:case 646:return{model:"grashnak-blackhoof",race:"starplayer"};case 215:case 37:case 647:case 648:return{model:"griff-oberwald",race:"starplayer"};case 216:case 38:case 649:case 650:return{model:"grim-ironjaw",race:"starplayer"};case 148:case 241:case 651:case 652:return{model:"grotty",race:"starplayer"};case 315:case 316:case 653:case 654:return{model:"hack-enslash",race:"starplayer"};case 138:case 238:case 655:case 656:return{model:"hakflem-skuttlespike",race:"starplayer"};case 217:case 39:case 657:case 658:return{model:"headsplitter",race:"starplayer"};case 317:case 318:case 659:case 660:return{model:"helmut-wulf",race:"starplayer"};case 275:case 276:case 661:case 662:return{model:"hemlock",race:"starplayer"};case 222:case 52:case 663:case 664:return{model:"horkon-heartripper",race:"starplayer"};case 299:case 300:case 665:case 666:return{model:"hthark-the-unstoppable",race:"starplayer"};case 137:case 237:case 667:case 668:return{model:"hubris-rakarth",race:"starplayer"};case 307:case 308:case 669:case 670:return{model:"humerus-carpal",race:"starplayer"};case 106:case 232:case 671:case 672:return{model:"icepelt-hammerblow",race:"starplayer"};case 157:case 250:case 673:case 674:return{model:"ithaca-benoin",race:"starplayer"};case 136:case 236:case 675:case 676:return{model:"j-earlice",race:"starplayer"};case 218:case 40:case 677:case 678:return{model:"jordel-freshbreeze",race:"starplayer"};case 158:case 251:case 679:case 680:return{model:"lewdgrip-whiparm",race:"starplayer"};case 102:case 228:case 683:case 684:return{model:"lord-borak-the-despoiler",race:"starplayer"};case 281:case 282:case 681:case 682:return{model:"lottabottol",race:"starplayer"};case 160:case 252:case 685:case 686:return{model:"max-spleenripper",race:"starplayer"};case 135:case 235:case 687:case 688:return{model:"mighty-zug",race:"starplayer"};case 223:case 53:case 689:case 690:return{model:"morg-n-thorg",race:"starplayer"};case 305:case 306:case 693:case 694:return{model:"nobbla-blackwart",race:"starplayer"};case 150:case 243:case 691:case 692:return{model:"prince-moranion",race:"starplayer"};case 161:case 253:case 695:case 696:return{model:"puggy-baconbreath",race:"starplayer"};case 283:case 284:case 697:case 698:return{model:"quetzal-leap",race:"starplayer"};case 231:case 699:case 700:case 105:return{model:"ramtut-iii",race:"starplayer"};case 295:case 296:case 701:case 702:return{model:"rashnak-backstabber",race:"starplayer"};case 219:case 41:case 703:case 704:return{model:"ripper",race:"starplayer"};case 151:case 244:case 705:case 706:return{model:"roxanna-darknail",race:"starplayer"};case 100:case 226:case 707:case 708:return{model:"scrappa-sorehead",race:"starplayer"};case 104:case 230:case 709:case 710:return{model:"setekh",race:"starplayer"};case 319:case 320:case 711:case 712:return{model:"sinnedbad",race:"starplayer"};case 162:case 254:case 713:case 714:return{model:"skitter-stab-stab",race:"starplayer"};case 220:case 42:case 715:case 716:return{model:"slibli",race:"starplayer"};case 152:case 245:case 717:case 718:return{model:"soaren-hightower",race:"starplayer"};case 163:case 255:case 719:case 720:return{model:"ugroth-bolgrot",race:"starplayer"};case 221:case 43:case 721:case 722:return{model:"varag-ghoul-chewer",race:"starplayer"};case 277:case 278:case 725:case 726:return{model:"wilhelm-chaney",race:"starplayer"};case 279:case 280:case 723:case 724:return{model:"willow-rosebark",race:"starplayer"};case 225:case 727:case 728:case 99:return{model:"zara-the-slayer",race:"starplayer"};case 134:case 234:case 729:case 730:return{model:"zzharg-madeye",race:"starplayer"}}}(e.Id,e.Data.IdPlayerTypes);switch(n.id=e.Id,n.team=t,e.Status){case 1:n.prone=!0;break;case 2:n.stunned=!0}switch(e.disabled&&(e.usedSkills.indexOf(20)>-1?n.disabled="Rooted":e.usedSkills.indexOf(31)>-1?n.disabled="BoneHeaded":e.usedSkills.indexOf(51)>-1&&(n.disabled="Stupid")),e.Situation>=We.Casualty&&(e.Situation===We.Casualty?n.cas=Nt[Math.max(...g9(e.ListCasualties))].icon:n.cas="Expelled"),e.Situation){case We.Active:n.done=1!=e.CanAct,x(e.Cell.x,e.Cell.y).player=n;break;default:"home"==t?p.dugout[y[e.Situation]].push(n):m.dugout[y[e.Situation]].push(n)}}A((()=>(console.log("Viewer onMount start"),async function(){for(;;){0===r.length&&await v(u,f,d);const e=r.shift();n(8,c=e.index);for(const t of m9(e.RulesEventBoardAction)){t.ActionType!==Qe&&(a=null);const e=k[t.ActionType||0];try{e(t),await z()}catch(e){throw await z(),console.error("Action failed",{error:e,boardAction:t}),e}await O()}e.RulesEventEndTurn&&$(e.RulesEventEndTurn),e.BoardState&&await b(e.BoardState)}}(),console.log("Viewer onMount queue started"),()=>console.log("destroyed"))));let k=[function(e){let t=w(e.PlayerId),n=x(e.Order.CellFrom.x,e.Order.CellFrom.y),r=x(e.Order.CellTo.Cell.x,e.Order.CellTo.Cell.y);t.prone=!1,t.moving=!0,e.Results.BoardActionResult.IsOrderCompleted&&r!=n&&(r.player=t,n.player=null);n.cell=n.cell||{},n.cell.moved=!0,n.cell.active=!1,e.Results.BoardActionResult.IsOrderCompleted&&(r.cell=r.cell||{},r.cell.active=!0);e.Results.BoardActionResult.RollType&&[Rt.Dodge,Rt.GFI,Rt.Leap].includes(e.Results.BoardActionResult.RollType)&&(r.cell=r.cell||{},r.cell.plus=e.Results.BoardActionResult.Requirement);t.id==o&&(t.blitz=!0);n.ball&&(r.ball=n.ball,n.ball=null)},E,E,x9,v9,async function(e){x(e.Order.CellTo.Cell.x,e.Order.CellTo.Cell.y).foul=!0,await O()},function(e){if(!e.Results.BoardActionResult.IsOrderCompleted)return;let t,r;switch(Object.entries(g).forEach((([i,a])=>{a.cell&&(a.cell.target=null),a.player&&a.player.id==e.PlayerId&&(t=a.player,n(3,g[i]=a,g),r=i)})),e.Results.BoardActionResult.RollType){case 3:1===e.Results.BoardActionResult.ResultType&&(t.prone=!0);break;case 4:if(2===e.Results.BoardActionResult.SubResultType)t.stunned=!0;else if(3===e.Results.BoardActionResult.SubResultType){("home"==t.team?p.dugout:m.dugout).ko.push(t),n(3,g[r].player=null,g)}break;case 8:("home"==t.team?p.dugout:m.dugout).cas.push(t),n(3,g[r].player=null,g),n(3,g[r].blood={blood:Math.floor(4*Math.random()+1)},g)}},function(e){let{x:t,y:n}=e.Order.CellTo.Cell;x(t,n).ball={held:!1}},function(e){x(e.Order.CellFrom.x,e.Order.CellFrom.y).ball=null;let t=e.Order.CellTo.Cell;x(t.x,t.y).ball={held:!1}},function(e){if(!e.Results.BoardActionResult.IsOrderCompleted)return;if(0!==e.Results.BoardActionResult.ResultType)return;Object.values(g).forEach((e=>e.ball=null)),x(e.Order.CellTo.Cell.x,e.Order.CellTo.Cell.y).ball={held:!0}},async function(){n(4,s="touchdown"),S(),await O(5),n(4,s=null),await z()},function(e){let t=w(e.PlayerId);t.stunned=!1,t.prone=!0},y9,y9,function(e){e.Results.BoardActionResult.IsOrderCompleted&&0===e.Results.BoardActionResult.ResultType&&Object.values(g).forEach((e=>{e.ball&&(e.ball.held=!0)}))},function(e){let t=x(e.Order.CellTo.Cell.x,e.Order.CellTo.Cell.y);if(0===e.Results.BoardActionResult.ResultType)return void(t.player.stupidity=null);{const n={[Rt.BoneHead]:"BoneHeaded",[Rt.ReallyStupid]:"Stupid",[Rt.TakeRoot]:"Rooted"};t.player.stupidity=n[e.Results.BoardActionResult.RollType]}},y9,y9,y9,y9,y9,b9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,y9,function(e){S(),Object.entries(g).forEach((([t,r])=>{r.cell&&(r.cell.active=!1),r.player&&(r.player.id==e.ActivePlayerId&&(r.cell||(r.cell={}),r.cell.active=!0,r.player.prone=!1),r.player.id==i&&(r.player.done=!0),n(3,g[t]=r,g))})),i=e.PlayerId},y9,y9,y9,y9,function(e){const t=g9(e.Results.BoardActionResult.CoachChoices.ListDices);n(5,l={2:Xe,3:Ye,11:Je,12:Ke}[t[0]+t[1]]||Ge)},y9,y9,y9,y9,y9,y9,y9,y9,y9,$];async function O(e){var t;await z(),await(t=300*(e||1),new Promise((e=>setTimeout(e,t))))}function S(){Object.entries(g).forEach((([e,t])=>{t.dice=null,t.cell=null,t.foul=!1,t.player&&(t.player.moving=!1),n(3,g[e]=t,g)}))}function E(e){let t=e.Order.CellFrom,n=x(t.x,t.y);(n.cell=n.cell||{}).active=!0;let r=e.Order.CellTo.Cell,i=x(r.x,r.y),o=i.player;if(Object.values(g).forEach((e=>{e.dice=null})),e.Results.BoardActionResult.RollType===Rt.Block){let t=x(e.Order.CellTo.Cell.x,e.Order.CellTo.Cell.y);if(t.cell||(t.cell={}),t.cell.target=!0,e.Results.BoardActionResult.IsOrderCompleted)t.dice=[g9(e.Results.BoardActionResult.CoachChoices.ListDices)[0]];else{let n=g9(e.Results.BoardActionResult.CoachChoices.ListDices);t.dice=n.slice(0,n.length/2)}}if(e.Results.BoardActionResult.RollType===Rt.Push)if(e.Results.BoardActionResult.IsOrderCompleted){Object.values(g).forEach((e=>{e.cell&&(e.cell.pushbackChoice=!1,e.cell.target=!1)}));let t=m9(e.Results.BoardActionResult.CoachChoices.ListCells.Cell)[0],n=x(t.x,t.y);a&&(o=a),a=n.player?n.player:null,n.player=o,i.player=null}else m9(e.Results.BoardActionResult.CoachChoices.ListCells.Cell).forEach((e=>{let t=x(e.x,e.y);if(t.cell=t.cell||{},t.cell.pushbackChoice=!0,e.x<0||e.x>25||e.y<0||e.y>14)throw"Unexpected surf as a choice"}));if(e.Results.BoardActionResult.RollType===Rt.FollowUp&&e.Results.BoardActionResult.IsOrderCompleted){const t=e.Order.CellFrom,n=x(t.x,t.y),r=m9(e.Results.BoardActionResult.CoachChoices.ListCells.Cell)[0];x(r.x,r.y).player=n.player;n.player=null}}async function $(e){e.Turnover&&(n(4,s="turnover"),S(),await O(5),n(4,s=null),await z())}return e.$$set=e=>{"replaySteps"in e&&n(9,u=e.replaySteps),"replayStepIndex"in e&&n(8,c=e.replayStepIndex),"replayStart"in e&&n(6,f=e.replayStart),"replayEnd"in e&&n(7,d=e.replayEnd)},e.$$.update=()=>{704&e.$$.dirty[0]&&(r=[],console.log("About to reset queue",{replayStart:f,replayEnd:d}),n(6,f=f||0),n(7,d=Math.max(d||u.length,f+1)),console.log("Resetting queue",{replayStart:f,replayEnd:d,queue:u.slice(f,d)}))},[h,p,m,g,s,l,f,d,c,u]}class _9 extends le{constructor(e){super(),se(this,e,w9,h9,o,{replaySteps:9,replayStepIndex:8,replayStart:6,replayEnd:7},[-1,-1])}}function k9(e){let t,n;return t=new ka({}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function O9(e){let t,n;return t=new Ca({}),{c(){ie(t.$$.fragment)},m(e,r){ae(t,e,r),n=!0},i(e){n||(Y(t.$$.fragment,e),n=!0)},o(e){J(t.$$.fragment,e),n=!1},d(e){oe(t,e)}}}function S9(e){let t,n,r,i,a,o,s,l,u,h,m,y,v,b,x,_,k,O,S,E;function $(t){e[10].call(null,t)}function A(t){e[11].call(null,t)}function D(t){e[12].call(null,t)}r=new Ea({props:{gameDetails:e[0].gameDetails}});let C={rolls:e[0].rolls,replayStepIndex:e[4]};function M(t){e[13].call(null,t)}void 0!==e[5]&&(C.replayStart=e[5]),void 0!==e[6]&&(C.replayEnd=e[6]),void 0!==e[3]&&(C.selectedRoll=e[3]),s=new C7({props:C}),j.push((()=>re(s,"replayStart",$))),j.push((()=>re(s,"replayEnd",A))),j.push((()=>re(s,"selectedRoll",D)));let F={replaySteps:e[0]&&e[0].fullReplay.ReplayStep,replayStart:e[5],replayEnd:e[6]};return void 0!==e[4]&&(F.replayStepIndex=e[4]),y=new _9({props:F}),j.push((()=>re(y,"replayStepIndex",M))),_=new yo({props:{rolls:e[0].rolls,selectedRoll:e[3]}}),S=new Aa({}),{c(){t=p("div"),n=p("div"),ie(r.$$.fragment),i=g(),a=p("div"),o=p("div"),ie(s.$$.fragment),m=g(),ie(y.$$.fragment),b=g(),x=p("div"),ie(_.$$.fragment),k=g(),O=p("div"),ie(S.$$.fragment),w(n,"class","row"),w(o,"class","col-8"),w(x,"class","col-4"),w(a,"class","row"),w(t,"class","container-fluid"),w(t,"role","main"),w(O,"class","container"),w(O,"role","main")},m(e,l){f(e,t,l),c(t,n),ae(r,n,null),c(t,i),c(t,a),c(a,o),ae(s,o,null),c(o,m),ae(y,o,null),c(a,b),c(a,x),ae(_,x,null),f(e,k,l),f(e,O,l),ae(S,O,null),E=!0},p(e,t){const n={};1&t&&(n.gameDetails=e[0].gameDetails),r.$set(n);const i={};1&t&&(i.rolls=e[0].rolls),16&t&&(i.replayStepIndex=e[4]),!l&&32&t&&(l=!0,i.replayStart=e[5],L((()=>l=!1))),!u&&64&t&&(u=!0,i.replayEnd=e[6],L((()=>u=!1))),!h&&8&t&&(h=!0,i.selectedRoll=e[3],L((()=>h=!1))),s.$set(i);const a={};1&t&&(a.replaySteps=e[0]&&e[0].fullReplay.ReplayStep),32&t&&(a.replayStart=e[5]),64&t&&(a.replayEnd=e[6]),!v&&16&t&&(v=!0,a.replayStepIndex=e[4],L((()=>v=!1))),y.$set(a);const o={};1&t&&(o.rolls=e[0].rolls),8&t&&(o.selectedRoll=e[3]),_.$set(o)},i(e){E||(Y(r.$$.fragment,e),Y(s.$$.fragment,e),Y(y.$$.fragment,e),Y(_.$$.fragment,e),Y(S.$$.fragment,e),E=!0)},o(e){J(r.$$.fragment,e),J(s.$$.fragment,e),J(y.$$.fragment,e),J(_.$$.fragment,e),J(S.$$.fragment,e),E=!1},d(e){e&&d(t),oe(r),oe(s),oe(y),oe(_),e&&d(k),e&&d(O),oe(S)}}}function E9(e){let t,n,r,i,a,o,s,l,u,h,m,y,v,b,x,_,k,O,S,E,$,A,D,C,M,j,F,T,N;_=new T7({}),$=new j7({}),D=new wa({}),D.$on("replayLoaded",e[7]),D.$on("replayLoading",e[8]),D.$on("replayError",e[9]);let R=e[1]&&k9(),P=e[2]&&O9(),z=e[0]&&S9(e);return{c(){t=p("meta"),n=p("meta"),r=p("meta"),i=p("meta"),a=p("meta"),o=p("meta"),s=p("meta"),l=p("meta"),u=p("meta"),h=p("meta"),m=p("meta"),y=p("link"),v=p("link"),b=g(),x=p("body"),ie(_.$$.fragment),k=g(),O=p("div"),S=p("div"),E=p("div"),ie($.$$.fragment),A=g(),ie(D.$$.fragment),C=g(),R&&R.c(),M=g(),P&&P.c(),j=g(),z&&z.c(),F=g(),T=p("footer"),T.innerHTML='<div class="container svelte-n2fmn3"><p class="text-muted svelte-n2fmn3">This website is under active development. If you notice issues, please\n          post the replay and a description of the problem to\n          <a href="https://github.com/cpennington/dicedornot/issues">Diced Or Not Issues</a>.</p></div>',w(t,"charset","utf-8"),w(n,"http-equiv","x-ua-compatible"),w(n,"content","ie=edge"),w(r,"name","viewport"),w(r,"content","width=device-width, initial-scale=1.0"),w(i,"property","og:title"),w(i,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),w(a,"property","og:type"),w(a,"content","website"),w(o,"property","og:url"),w(o,"content","http://vengefulpickle.com/DicedOrNot"),w(s,"property","og:description"),w(s,"content","Blood Bowl 2 replay and luck analyzer. Use it to decide whether you actually got diced."),w(l,"name","twitter:card"),w(l,"content","summary"),w(u,"name","twitter:url"),w(u,"content","http://vengefulpickle.com/DicedOrNot"),w(h,"name","twitter:title"),w(h,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),w(m,"name","twitter:description"),w(m,"content","Blood Bowl 2 replay luck analyzer. Use it to decide whether you actually got diced."),document.title="Diced or Not? - Blood Bowl 2 Replay Luck Analyzer",w(y,"rel","stylesheet"),w(y,"href","https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"),w(y,"integrity","sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="),w(y,"crossorigin","anonymous"),w(v,"rel","stylesheet"),w(v,"href","https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/css/jquery.dataTables.min.css"),w(v,"integrity","sha256-YY1izqyhIj4W3iyJOaGWOpXDSwrHWFL4Nfk+W0LyCHE="),w(v,"crossorigin","anonymous"),w(E,"class","jumbotron svelte-n2fmn3"),w(S,"class","container-flex"),w(T,"class","footer svelte-n2fmn3"),w(T,"id","contact"),w(O,"id","content"),w(O,"class","svelte-n2fmn3")},m(e,d){c(document.head,t),c(document.head,n),c(document.head,r),c(document.head,i),c(document.head,a),c(document.head,o),c(document.head,s),c(document.head,l),c(document.head,u),c(document.head,h),c(document.head,m),c(document.head,y),c(document.head,v),f(e,b,d),f(e,x,d),ae(_,x,null),c(x,k),c(x,O),c(O,S),c(S,E),ae($,E,null),c(E,A),ae(D,E,null),c(S,C),R&&R.m(S,null),c(S,M),P&&P.m(S,null),c(O,j),z&&z.m(O,null),c(O,F),c(O,T),N=!0},p(e,[t]){e[1]?R?2&t&&Y(R,1):(R=k9(),R.c(),Y(R,1),R.m(S,M)):R&&(G(),J(R,1,1,(()=>{R=null})),X()),e[2]?P?4&t&&Y(P,1):(P=O9(),P.c(),Y(P,1),P.m(S,null)):P&&(G(),J(P,1,1,(()=>{P=null})),X()),e[0]?z?(z.p(e,t),1&t&&Y(z,1)):(z=S9(e),z.c(),Y(z,1),z.m(O,F)):z&&(G(),J(z,1,1,(()=>{z=null})),X())},i(e){N||(Y(_.$$.fragment,e),Y($.$$.fragment,e),Y(D.$$.fragment,e),Y(R),Y(P),Y(z),N=!0)},o(e){J(_.$$.fragment,e),J($.$$.fragment,e),J(D.$$.fragment,e),J(R),J(P),J(z),N=!1},d(e){d(t),d(n),d(r),d(i),d(a),d(o),d(s),d(l),d(u),d(h),d(m),d(y),d(v),e&&d(b),e&&d(x),oe(_),oe($),oe(D),R&&R.d(),P&&P.d(),z&&z.d()}}}function $9(e,t,n){let r,i,a,o,s=!1,l=!1,u=0;return e.$$.update=()=>{1&e.$$.dirty&&console.log("Replay",r)},[r,s,l,i,u,a,o,e=>{n(1,s=!1),n(0,r=e.detail),n(5,a=null),n(6,o=null),console.log(e)},()=>{n(0,r=null),n(2,l=!1),n(1,s=!0)},()=>{n(1,s=!1),n(2,l=!0),n(0,r=null)},function(e){a=e,n(5,a)},function(e){o=e,n(6,o)},function(e){i=e,n(3,i)},function(e){u=e,n(4,u)}]}return new class extends le{constructor(e){super(),se(this,e,$9,E9,o,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
