var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function i(){return Object.create(null)}function a(e){e.forEach(r)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(t,n,r){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const r=t.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}(n,r))}function u(e,t,r,i){return e[1]&&i?n(r.ctx.slice(),e[1](i(t))):r.ctx}function c(e,t,n,r,i,a,o){const s=function(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}(t,r,i,a);if(s){const i=u(t,n,r,o);e.p(i,s)}}function f(e){return null==e?"":e}const d="undefined"!=typeof window;let h=d?()=>window.performance.now():()=>Date.now(),p=d?e=>requestAnimationFrame(e):e;const m=new Set;function g(e){m.forEach((t=>{t.c(e)||(m.delete(t),t.f())})),0!==m.size&&p(g)}function y(e){let t;return 0===m.size&&p(g),{promise:new Promise((n=>{m.add(t={c:e,f:n})})),abort(){m.delete(t)}}}function v(e,t){e.appendChild(t)}function b(e,t,n){e.insertBefore(t,n||null)}function x(e){e.parentNode.removeChild(e)}function w(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function _(e){return document.createElement(e)}function k(e){return document.createTextNode(e)}function O(){return k(" ")}function S(){return k("")}function E(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function $(e){return function(t){return t.preventDefault(),e.call(this,t)}}function A(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function D(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function C(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function M(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function j(e,t,n){e.classList[n?"add":"remove"](t)}function F(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const T=new Set;let N,R=0;function P(e,t,n,r,i,a,o,s=0){const l=16.666/r;let u="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*a(e);u+=100*e+`%{${o(r,1-r)}}\n`}const c=u+`100% {${o(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(c)}_${s}`,d=e.ownerDocument;T.add(d);const h=d.__svelte_stylesheet||(d.__svelte_stylesheet=d.head.appendChild(_("style")).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[f]||(p[f]=!0,h.insertRule(`@keyframes ${f} ${c}`,h.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${f} ${r}ms linear ${i}ms 1 both`,R+=1,f}function z(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-r.length;i&&(e.style.animation=r.join(", "),R-=i,R||p((()=>{R||(T.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),T.clear())})))}function B(e){N=e}function I(){if(!N)throw new Error("Function called outside component initialization");return N}function L(e){I().$$.on_mount.push(e)}function q(){const e=I();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const i=F(t,n);r.slice().forEach((t=>{t.call(e,i)}))}}}function U(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}const V=[],W=[],H=[],G=[],X=Promise.resolve();let Y=!1;function J(){Y||(Y=!0,X.then(ne))}function K(){return J(),X}function Q(e){H.push(e)}function Z(e){G.push(e)}let ee=!1;const te=new Set;function ne(){if(!ee){ee=!0;do{for(let e=0;e<V.length;e+=1){const t=V[e];B(t),re(t.$$)}for(B(null),V.length=0;W.length;)W.pop()();for(let e=0;e<H.length;e+=1){const t=H[e];te.has(t)||(te.add(t),t())}H.length=0}while(V.length);for(;G.length;)G.pop()();Y=!1,ee=!1,te.clear()}}function re(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Q)}}let ie;function ae(){return ie||(ie=Promise.resolve(),ie.then((()=>{ie=null}))),ie}function oe(e,t,n){e.dispatchEvent(F(`${t?"intro":"outro"}${n}`))}const se=new Set;let le;function ue(){le={r:0,c:[],p:le}}function ce(){le.r||a(le.c),le=le.p}function fe(e,t){e&&e.i&&(se.delete(e),e.i(t))}function de(e,t,n,r){if(e&&e.o){if(se.has(e))return;se.add(e),le.c.push((()=>{se.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const he={duration:0};function pe(n,r,i){let a,s,l=r(n,i),u=!1,c=0;function f(){a&&z(n,a)}function d(){const{delay:r=0,duration:i=300,easing:o=t,tick:d=e,css:p}=l||he;p&&(a=P(n,0,1,i,r,o,p,c++)),d(0,1);const m=h()+r,g=m+i;s&&s.abort(),u=!0,Q((()=>oe(n,!0,"start"))),s=y((e=>{if(u){if(e>=g)return d(1,0),oe(n,!0,"end"),f(),u=!1;if(e>=m){const t=o((e-m)/i);d(t,1-t)}}return u}))}let p=!1;return{start(){p||(z(n),o(l)?(l=l(),ae().then(d)):d())},invalidate(){p=!1},end(){u&&(f(),u=!1)}}}function me(n,r,i){let s,l=r(n,i),u=!0;const c=le;function f(){const{delay:r=0,duration:i=300,easing:o=t,tick:f=e,css:d}=l||he;d&&(s=P(n,1,0,i,r,o,d));const p=h()+r,m=p+i;Q((()=>oe(n,!1,"start"))),y((e=>{if(u){if(e>=m)return f(0,1),oe(n,!1,"end"),--c.r||a(c.c),!1;if(e>=p){const t=o((e-p)/i);f(1-t,t)}}return u}))}return c.r+=1,o(l)?ae().then((()=>{l=l(),f()})):f(),{end(e){e&&l.tick&&l.tick(1,0),u&&(s&&z(n,s),u=!1)}}}const ge="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function ye(e,t){e.d(1),t.delete(e.key)}function ve(e,t){de(e,1,1,(()=>{t.delete(e.key)}))}function be(e,t,n,r,i,a,o,s,l,u,c,f){let d=e.length,h=a.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,v=new Map;for(p=h;p--;){const e=f(i,a,p),s=n(e);let l=o.get(s);l?r&&l.p(e,t):(l=u(s,e),l.c()),y.set(s,g[p]=l),s in m&&v.set(s,Math.abs(p-m[s]))}const b=new Set,x=new Set;function w(e){fe(e,1),e.m(s,c),o.set(e.key,e),c=e.first,h--}for(;d&&h;){const t=g[h-1],n=e[d-1],r=t.key,i=n.key;t===n?(c=t.first,d--,h--):y.has(i)?!o.has(r)||b.has(r)?w(t):x.has(i)?d--:v.get(r)>v.get(i)?(x.add(r),w(t)):(b.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;h;)w(g[h-1]);return g}function xe(e,t){const n={},r={},i={$$scope:1};let a=e.length;for(;a--;){const o=e[a],s=t[a];if(s){for(const e in o)e in s||(r[e]=1);for(const e in s)i[e]||(n[e]=s[e],i[e]=1);e[a]=s}else for(const e in o)i[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}function we(e){return"object"==typeof e&&null!==e?e:{}}function _e(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function ke(e){e&&e.c()}function Oe(e,t,n){const{fragment:i,on_mount:s,on_destroy:l,after_update:u}=e.$$;i&&i.m(t,n),Q((()=>{const t=s.map(r).filter(o);l?l.push(...t):a(t),e.$$.on_mount=[]})),u.forEach(Q)}function Se(e,t){const n=e.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ee(t,n,r,o,s,l,u=[-1]){const c=N;B(t);const f=n.props||{},d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:i(),dirty:u,skip_bound:!1};let h=!1;if(d.ctx=r?r(t,f,((e,n,...r)=>{const i=r.length?r[0]:n;return d.ctx&&s(d.ctx[e],d.ctx[e]=i)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](i),h&&function(e,t){-1===e.$$.dirty[0]&&(V.push(e),J(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],d.update(),h=!0,a(d.before_update),d.fragment=!!o&&o(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(x)}else d.fragment&&d.fragment.c();n.intro&&fe(t.$$.fragment),Oe(t,n.target,n.anchor),ne()}B(c)}class $e{$destroy(){Se(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Ae=function(e,t){JSZip.loadAsync(e).then((e=>{e.forEach(((e,n)=>{n.async("string").then((e=>{var n=parser.parse(e,{ignoreAttributes:!0});console.log(n),t(n)}))}))}))},De=6,Ce=7,Me=12,je=13,Fe=15,Te=16,Ne=17,Re=20,Pe=21,ze=22,Be=26,Ie=27,Le=30,qe=31,Ue=33,Ve=34,We=38,He=40,Ge=41,Xe=47,Ye=48,Je=49,Ke=51,Qe=56,Ze=57,et=58,tt=59,nt=60,rt=61,it=64,at=67,ot=68,st=74,lt=75,ut={[1]:"Strip Ball",[2]:"ST+",[3]:"AG+",[4]:"MA+",[5]:"AV+",[De]:"Catch",[Ce]:"Dodge",[8]:"Sprint",[9]:"Pass Block",[10]:"Foul Appearance",[11]:"Leap",[Me]:"Extra Arms",[je]:"Mighty Blow",[14]:"Leader",[Fe]:"Horns",[Te]:"Two-Heads",[Ne]:"Stand Firm",[18]:"Always Hungry",[19]:"Regeneration",[Re]:"Take Root",[Pe]:"Accurate",[ze]:"Break Tackle",[23]:"Sneaky Git",[25]:"Chainsaw",[Be]:"Dauntless",[Ie]:"Dirty Player",[28]:"Diving Catch",[29]:"Dump-Off",[Le]:"Block",[qe]:"Bone-Head",[32]:"Very Long Legs",[Ue]:"Disturbing Presence",[Ve]:"Diving Tackle",[35]:"Fend",[36]:"Frenzy",[37]:"Grab",[We]:"Guard",[39]:"Hail-Mary Pass",[He]:"Juggernaut",[Ge]:"Jump-Up",[44]:"Loner",[45]:"Nerves Of Steel",[46]:"No Hands",[Xe]:"Pass",[Ye]:"Piling On",[Je]:"Prehensile Tail",[50]:"Pro",[Ke]:"Really Stupid",[52]:"Right Stuff",[53]:"Safe Throw",[54]:"Secret Weapon",[55]:"Shadowing",[Qe]:"Side Step",[Ze]:"Tackle",[et]:"Strong Arm",[tt]:"Stunty",[nt]:"Sure Feet",[rt]:"Sure Hands",[63]:"Thick Skull",[it]:"Throw Team Mate",[at]:"Wild Animal",[ot]:"Wrestle",[69]:"Tentacles",[70]:"Multiple Block",[71]:"Kick",[72]:"Kick-Off Return",[st]:"Big Hand",[lt]:"Claw",[76]:"Ball and Chain",[77]:"Stab",[78]:"Hypnotic Gaze",[79]:"Stakes",[80]:"Bombardier",[81]:"Decay",[82]:"Nurgles Rot",[83]:"Titchy",[84]:"Blood-Lust",[85]:"Fan Favourite",[86]:"Animosity"},ct={Active:void 0,Reserves:1,SentOff:5,KO:2,Casualty:4},ft={NoStatus:0,RerollTaken:1,RerollNotTaken:2,RerollWithSkill:3,Reroll4:4},dt=0,ht=1,pt=2,mt=3,gt=4,yt=1,vt=5,bt=0,xt=2,wt=1,_t=35,kt=57,Ot="AD",St="BD",Et="P",$t="DS",At="DD",Dt={0:Ot,1:St,2:Et,3:$t,4:At},Ct=1,Mt=2,jt=3,Ft=4,Tt=5,Nt=6,Rt=7,Pt=8,zt=9,Bt=10,It=12,Lt=13,qt=14,Ut=15,Vt=16,Wt=17,Ht=18,Gt=20,Xt=21,Yt=22,Jt=24,Kt=25,Qt=33,Zt={[Lt]:"Amazon",[Jt]:"Bretonnian",[Pt]:"Chaos",[Xt]:"Chaos Dwarf",[Qt]:"Chaos Pact",[zt]:"Dark Elf",[Mt]:"Dwarf",[Nt]:"Goblin",[Ut]:"High Elf",[Ct]:"Human",[Vt]:"Khemri",[Kt]:"Kislev",[Tt]:"Lizardman",[Wt]:"Necromantic",[It]:"Norse",[Ht]:"Nurgle",[Ft]:"Orc",[qt]:"Pro Elf",[jt]:"Skaven",[Bt]:"Undead",[Yt]:"Underworld",[Gt]:"Vampire",[Rt]:"Wood Elf"},en={[Lt]:"amazon",[Jt]:"bretonnia",[Pt]:"chaos",[Xt]:"chaosdwarf",[Qt]:"chaospact",[zt]:"darkelf",[Mt]:"dwarf",[Nt]:"goblin",[Ut]:"highelf",[Ct]:"human",[Vt]:"khemri",[Kt]:"kislev",[Tt]:"lizardman",[Wt]:"necromantic",[It]:"norse",[Ht]:"nurgle",[Ft]:"orc",[qt]:"proelf",[jt]:"skaven",[Bt]:"undead",[Yt]:"underworld",[Gt]:"vampire",[Rt]:"woodelf"};const tn=[{},{dice:38,icon:"BadlyHurt",result:"Badly Hurt",effect:"No long term effect"},{dice:41,icon:"BrokenRibs",result:"Broken Rib",effect:"Miss next game "},{dice:42,icon:"GroinStrain",result:"Groin Strain",effect:"Miss next game "},{dice:43,icon:"GougedEye",result:"Gouged Eye",effect:"Miss next game"},{dice:44,icon:"BrokenJaw",result:"Broken Jaw",effect:"Miss next game "},{dice:45,icon:"FracturedArm",result:"Fractured Arm",effect:"Miss next game "},{dice:46,icon:"FracturedLeg",result:"Fractured Leg",effect:"Miss next game "},{dice:47,icon:"SmashedHand",result:"Smashed Hand ",effect:"Miss next game "},{dice:48,icon:"PinchedNerve",result:"Pinched Nerve",effect:"Miss next game "},{dice:51,icon:"NigglingInjury2",result:"Damaged Back",effect:"Niggling Injury"},{dice:52,icon:"NigglingInjury2",result:"Smashed Knee",effect:"Niggling Injury"},{dice:53,icon:"MovementBust",result:"Smashed Hip",effect:"-1 MA"},{dice:54,icon:"MovementBust",result:"Smashed Ankle",effect:"-1 MA"},{dice:55,icon:"ArmourBust",result:"Serious Concussion",effect:"-1 AV"},{dice:56,icon:"ArmourBust",result:"Fractured Skull",effect:"-1 AV"},{dice:57,icon:"AgilityBust",result:"Broken Neck",effect:"-1 AG"},{dice:58,icon:"StrengthBust",result:"Smashed Collar Bone",effect:"-1 ST"},{dice:61,icon:"Dead",result:"Dead",effect:"Dead!"}],nn={GFI:1,Dodge:2,Armor:3,Injury:4,Block:5,StandUp:6,Pickup:7,Casualty:8,Catch:9,KickoffScatter:10,ThrowIn:11,Pass:12,Push:13,FollowUp:14,FoulPenalty:15,Interception:16,WakeUp:17,TouchBack:19,BoneHead:20,ReallyStupid:21,WildAnimal:22,Loner:23,Landing:24,Regeneration:25,InaccuratePassScatter:26,AlwaysHungryRoll:27,EatTeammate:28,Dauntless:29,SafeThrow:30,JumpUp:31,Shadowing:32,Stab:34,Leap:36,FoulAppearance:37,Tentacles:38,ChainsawKickback:39,TakeRoot:40,BallAndChain:41,HailMaryPass:42,DivingTackle:44,Pro:45,HypnoticGaze:46,Animosity:49,Bloodlust:50,Bite:51,Bribe:52,Fireball:54,LightningBolt:55,ThrowTeammate:56,Multiblock:57,KickoffGust:58,PileOnArmorRoll:59,PileOnInjuryRoll:60,Wrestle2:61,DodgePick:62,StandFirm:63,Juggernaut:64,StandFirm2:65,RaiseDead:66,Fans:69,Weather:70,SwealteringHeat:71,BombKD:72,ChainsawArmor:73};function rn(e){return null!=e&&"function"==typeof e[Symbol.iterator]}class an{constructor(e){this.name=e}named(e){return this.name=e,this}_flat(){throw new Error("${this.constructor}._flat() missing implementation")}get flat(){return Object.defineProperty(this,"flat",{value:Object.values(this._flat().reduce(((e,t)=>{const n=e[`${t.name}-${t.value}`];return n?n.weight+=t.weight:e[`${t.name}-${t.value}`]=t,e}),{}))}),this.flat}get cdf(){Object.defineProperty(this,"cdf",{value:this.flat.sort(((e,t)=>e.value-t.value)).reduce(((e,t)=>(e.push({weight:e[e.length-1].weight+t.weight,value:t.value}),e)))})}sample(){var e=Math.random();for(const t of this.flat){if(t.weight>e)return t.value;e-=t.weight}return this.flat[this.flat.length-1].value}get singularValue(){const e=this.flat;if(e.length>1)throw new Error("Distribution doesn't have a singular value");return e[0].value}get isSingularValue(){return 1==this.flat.length}get expectedValue(){return Object.defineProperty(this,"expectedValue",{value:this.flat.reduce(((e,t)=>e+t.value*t.weight),0)}),this.expectedValue}add(...e){return(e=e.filter((e=>null!==e))).length>0?new un([this,...e]):this}product(...e){return(e=e.filter((e=>null!==e))).length>0?new cn([this,...e]):this}divide(e){return new fn(this,e)}subtract(e){return new dn(this,e)}get valueString(){return`[${this.isSingularValue?"V":"EV"}=${this.valueOf().toFixed(2)}]`}valueOf(){return this.expectedValue}max(...e){var t=this;for(var n of e)n.expectedValue>t.expectedValue&&(t=n);return t}min(...e){var t=this;for(var n of e)n.expectedValue<t.expectedValue&&(t=n);return t}}class on extends an{constructor(e,t){super(t);const n=e.map((e=>e.weight)).reduce(((e,t)=>e+t));e.forEach((e=>{e.weight/=n})),this.values=Object.values(e.reduce(((e,t)=>{const n=e[`${t.name}`];if(n){if(n.value!=t.value)throw new Error("Inconsistent values passed to SimpleDistribution");n.weight+=t.weight}else e[`${t.name}`]=t;return e}),{}))}_flat(){return this.values.flatMap((e=>e.value instanceof an?e.value.flat.map((t=>({name:`${e.name} → ${t.name}`,weight:e.weight*t.weight,value:t.value}))):e))}}class sn extends an{constructor(e,t){super(e),this.value=t}_flat(){return this.value instanceof an?this.value.flat.map((e=>({name:`${this.name} → ${e.name}`,weight:e.weight,value:e.value}))):[{name:this.name,weight:1,value:this.value}]}}class ln extends an{constructor(e,t,n,r,i){if(super(i),this.valFunc=e,this.nameFunc=t,this.distFuncName=n,!rn(r))throw new Error("values not iterable",r);if(0==r.length)throw new Error("empty values list",r);this.values=r}_combine(e,t){return e instanceof an?e[this.distFuncName](t):t instanceof an?t[this.distFuncName](e):this.valFunc(e,t)}_flat(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();t=t?t instanceof an?new on(n instanceof an?t.flat.flatMap((e=>n.flat.map((t=>({name:this.name||this.nameFunc(e.name,t.name),weight:e.weight*t.weight,value:this.valFunc(e.value,t.value)}))))):t.flat.map((e=>({name:this.name||this.nameFunc(e.name,n),value:this.valFunc(e.value,n),weight:e.weight}))),this.name):n instanceof an?new on(n.flat.map((e=>({name:this.name||this.nameFunc(t,e.name),value:this.valFunc(t,e.value),weight:e.weight}))),this.name):new sn(this.name||this.nameFunc(t,n),this.valFunc(t,n)):n}return t.flat}}class un extends ln{constructor(e,t){super(((e,t)=>e+t),((e,t)=>`${e} + ${t}`),"add",e,t)}}class cn extends ln{constructor(e,t){super(((e,t)=>e*t),((e,t)=>`${e} * ${t}`),"product",e,t)}}class fn extends ln{constructor(e,t,n){super(((e,t)=>e/t),((e,t)=>`${e} / ${t}`),"divide",[e,t],n)}}class dn extends ln{constructor(e,t,n){super(((e,t)=>e-t),((e,t)=>`${e} - ${t}`),"subtract",[e,t],n)}}class hn extends an{constructor(e,t,n){if(super(n),!rn(t))throw new Error("values not iterable",t);if(0==t.length)throw new Error("empty values list",t);this.better=e,this.values=t}_simple(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();if(t){if(!(t instanceof on&&n instanceof on))throw new Error("Can only compare simple distributions");t=new on(t.values.flatMap((e=>n.values.map((t=>({name:this.better(e.value,t.value)?e.name:t.name,weight:e.weight*t.weight,value:this.better(e.value,t.value)?e.value:t.value}))))))}else t=n}return t}get simple(){return Object.defineProperty(this,"simple",{value:this._simple().named(this.name)}),console.assert(Math.abs(this.simple.expectedValue-this.expectedValue)<1e-4,this),this.simple}_flat(){return this._simple().flat}}class pn extends hn{constructor(e,t){super(((e,t)=>e>t),e,t)}}class mn extends hn{constructor(e,t){super(((e,t)=>e<t),e,t)}}function gn(e,t,n,r){n=n||"value",r=r||"weight";const i=e.sort(((e,t)=>e[n]-t[n])),a=e.reduce(((e,t)=>e+t[r]),0);for(var o=0;t>1e-8&&o<i.length;)(t-=i[o][r]/a)>1e-8&&o++;return i[o][n]}var yn="1.12.0",vn="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},bn=Array.prototype,xn=Object.prototype,wn="undefined"!=typeof Symbol?Symbol.prototype:null,_n=bn.push,kn=bn.slice,On=xn.toString,Sn=xn.hasOwnProperty,En="undefined"!=typeof ArrayBuffer,$n="undefined"!=typeof DataView,An=Array.isArray,Dn=Object.keys,Cn=Object.create,Mn=En&&ArrayBuffer.isView,jn=isNaN,Fn=isFinite,Tn=!{toString:null}.propertyIsEnumerable("toString"),Nn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Rn=Math.pow(2,53)-1;function Pn(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var a=Array(t+1);for(i=0;i<t;i++)a[i]=arguments[i];return a[t]=r,e.apply(this,a)}}function zn(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function Bn(e){return void 0===e}function In(e){return!0===e||!1===e||"[object Boolean]"===On.call(e)}function Ln(e){var t="[object "+e+"]";return function(e){return On.call(e)===t}}var qn=Ln("String"),Un=Ln("Number"),Vn=Ln("Date"),Wn=Ln("RegExp"),Hn=Ln("Error"),Gn=Ln("Symbol"),Xn=Ln("ArrayBuffer"),Yn=Ln("Function"),Jn=vn.document&&vn.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Jn&&(Yn=function(e){return"function"==typeof e||!1});var Kn=Yn,Qn=Ln("Object"),Zn=$n&&Qn(new DataView(new ArrayBuffer(8))),er="undefined"!=typeof Map&&Qn(new Map),tr=Ln("DataView");var nr=Zn?function(e){return null!=e&&Kn(e.getInt8)&&Xn(e.buffer)}:tr,rr=An||Ln("Array");function ir(e,t){return null!=e&&Sn.call(e,t)}var ar=Ln("Arguments");!function(){ar(arguments)||(ar=function(e){return ir(e,"callee")})}();var or=ar;function sr(e){return Un(e)&&jn(e)}function lr(e){return function(){return e}}function ur(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=Rn}}function cr(e){return function(t){return null==t?void 0:t[e]}}var fr=cr("byteLength"),dr=ur(fr),hr=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var pr=En?function(e){return Mn?Mn(e)&&!nr(e):dr(e)&&hr.test(On.call(e))}:lr(!1),mr=cr("length");function gr(e,t){t=function(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(e){return t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=Nn.length,r=e.constructor,i=Kn(r)&&r.prototype||xn,a="constructor";for(ir(e,a)&&!t.contains(a)&&t.push(a);n--;)(a=Nn[n])in e&&e[a]!==i[a]&&!t.contains(a)&&t.push(a)}function yr(e){if(!zn(e))return[];if(Dn)return Dn(e);var t=[];for(var n in e)ir(e,n)&&t.push(n);return Tn&&gr(e,t),t}function vr(e,t){var n=yr(t),r=n.length;if(null==e)return!r;for(var i=Object(e),a=0;a<r;a++){var o=n[a];if(t[o]!==i[o]||!(o in i))return!1}return!0}function br(e){return e instanceof br?e:this instanceof br?void(this._wrapped=e):new br(e)}function xr(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,fr(e))}br.VERSION=yn,br.prototype.value=function(){return this._wrapped},br.prototype.valueOf=br.prototype.toJSON=br.prototype.value,br.prototype.toString=function(){return String(this._wrapped)};var wr="[object DataView]";function _r(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&kr(e,t,n,r)}function kr(e,t,n,r){e instanceof br&&(e=e._wrapped),t instanceof br&&(t=t._wrapped);var i=On.call(e);if(i!==On.call(t))return!1;if(Zn&&"[object Object]"==i&&nr(e)){if(!nr(t))return!1;i=wr}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return wn.valueOf.call(e)===wn.valueOf.call(t);case"[object ArrayBuffer]":case wr:return kr(xr(e),xr(t),n,r)}var a="[object Array]"===i;if(!a&&pr(e)){if(fr(e)!==fr(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(Kn(o)&&o instanceof o&&Kn(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!_r(e[l],t[l],n,r))return!1}else{var u,c=yr(e);if(l=c.length,yr(t).length!==l)return!1;for(;l--;)if(!ir(t,u=c[l])||!_r(e[u],t[u],n,r))return!1}return n.pop(),r.pop(),!0}function Or(e){if(!zn(e))return[];var t=[];for(var n in e)t.push(n);return Tn&&gr(e,t),t}function Sr(e){var t=mr(e);return function(n){if(null==n)return!1;var r=Or(n);if(mr(r))return!1;for(var i=0;i<t;i++)if(!Kn(n[e[i]]))return!1;return e!==Cr||!Kn(n[Er])}}var Er="forEach",$r=["clear","delete"],Ar=["get","has","set"],Dr=$r.concat(Er,Ar),Cr=$r.concat(Ar),Mr=["add"].concat($r,Er,"has"),jr=er?Sr(Dr):Ln("Map"),Fr=er?Sr(Cr):Ln("WeakMap"),Tr=er?Sr(Mr):Ln("Set"),Nr=Ln("WeakSet");function Rr(e){for(var t=yr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function Pr(e){for(var t={},n=yr(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function zr(e){var t=[];for(var n in e)Kn(e[n])&&t.push(n);return t.sort()}function Br(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var a=arguments[i],o=e(a),s=o.length,l=0;l<s;l++){var u=o[l];t&&void 0!==n[u]||(n[u]=a[u])}return n}}var Ir=Br(Or),Lr=Br(yr),qr=Br(Or,!0);function Ur(e){if(!zn(e))return{};if(Cn)return Cn(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Vr(e){return zn(e)?rr(e)?e.slice():Ir({},e):e}function Wr(e){return rr(e)?e:[e]}function Hr(e){return br.toPath(e)}function Gr(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function Xr(e,t,n){var r=Gr(e,Hr(t));return Bn(r)?n:r}function Yr(e){return e}function Jr(e){return e=Lr({},e),function(t){return vr(t,e)}}function Kr(e){return e=Hr(e),function(t){return Gr(t,e)}}function Qr(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,a){return e.call(t,n,r,i,a)}}return function(){return e.apply(t,arguments)}}function Zr(e,t,n){return null==e?Yr:Kn(e)?Qr(e,t,n):zn(e)&&!rr(e)?Jr(e):Kr(e)}function ei(e,t){return Zr(e,t,1/0)}function ti(e,t,n){return br.iteratee!==ei?br.iteratee(e,t):Zr(e,t,n)}function ni(){}function ri(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}br.toPath=Wr,br.iteratee=ei;var ii=Date.now||function(){return(new Date).getTime()};function ai(e){var t=function(t){return e[t]},n="(?:"+yr(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}}var oi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},si=ai(oi),li=ai(Pr(oi)),ui=br.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},ci=/(.)^/,fi={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},di=/\\|'|\r|\n|\u2028|\u2029/g;function hi(e){return"\\"+fi[e]}var pi=0;function mi(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var a=Ur(e.prototype),o=e.apply(a,i);return zn(o)?o:a}var gi=Pn((function(e,t){var n=gi.placeholder,r=function(){for(var i=0,a=t.length,o=Array(a),s=0;s<a;s++)o[s]=t[s]===n?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return mi(e,r,this,this,o)};return r}));gi.placeholder=br;var yi=Pn((function(e,t,n){if(!Kn(e))throw new TypeError("Bind must be called on a function");var r=Pn((function(i){return mi(e,r,t,this,n.concat(i))}));return r})),vi=ur(mr);function bi(e,t,n,r){if(r=r||[],t||0===t){if(t<=0)return r.concat(e)}else t=1/0;for(var i=r.length,a=0,o=mr(e);a<o;a++){var s=e[a];if(vi(s)&&(rr(s)||or(s)))if(t>1)bi(s,t-1,n,r),i=r.length;else for(var l=0,u=s.length;l<u;)r[i++]=s[l++];else n||(r[i++]=s)}return r}var xi=Pn((function(e,t){var n=(t=bi(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=yi(e[r],e)}return e}));var wi=Pn((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),_i=gi(wi,br,1);function ki(e){return function(){return!e.apply(this,arguments)}}function Oi(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var Si=gi(Oi,2);function Ei(e,t,n){t=ti(t,n);for(var r,i=yr(e),a=0,o=i.length;a<o;a++)if(t(e[r=i[a]],r,e))return r}function $i(e){return function(t,n,r){n=ti(n,r);for(var i=mr(t),a=e>0?0:i-1;a>=0&&a<i;a+=e)if(n(t[a],a,t))return a;return-1}}var Ai=$i(1),Di=$i(-1);function Ci(e,t,n,r){for(var i=(n=ti(n,r,1))(t),a=0,o=mr(e);a<o;){var s=Math.floor((a+o)/2);n(e[s])<i?a=s+1:o=s}return a}function Mi(e,t,n){return function(r,i,a){var o=0,s=mr(r);if("number"==typeof a)e>0?o=a>=0?a:Math.max(a+s,o):s=a>=0?Math.min(a+1,s):a+s+1;else if(n&&a&&s)return r[a=n(r,i)]===i?a:-1;if(i!=i)return(a=t(kn.call(r,o,s),sr))>=0?a+o:-1;for(a=e>0?o:s-1;a>=0&&a<s;a+=e)if(r[a]===i)return a;return-1}}var ji=Mi(1,Ai,Ci),Fi=Mi(-1,Di);function Ti(e,t,n){var r=(vi(e)?Ai:Ei)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function Ni(e,t,n){var r,i;if(t=Qr(t,n),vi(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var a=yr(e);for(r=0,i=a.length;r<i;r++)t(e[a[r]],a[r],e)}return e}function Ri(e,t,n){t=ti(t,n);for(var r=!vi(e)&&yr(e),i=(r||e).length,a=Array(i),o=0;o<i;o++){var s=r?r[o]:o;a[o]=t(e[s],s,e)}return a}function Pi(e){var t=function(t,n,r,i){var a=!vi(t)&&yr(t),o=(a||t).length,s=e>0?0:o-1;for(i||(r=t[a?a[s]:s],s+=e);s>=0&&s<o;s+=e){var l=a?a[s]:s;r=n(r,t[l],l,t)}return r};return function(e,n,r,i){var a=arguments.length>=3;return t(e,Qr(n,i,4),r,a)}}var zi=Pi(1),Bi=Pi(-1);function Ii(e,t,n){var r=[];return t=ti(t,n),Ni(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function Li(e,t,n){t=ti(t,n);for(var r=!vi(e)&&yr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(!t(e[o],o,e))return!1}return!0}function qi(e,t,n){t=ti(t,n);for(var r=!vi(e)&&yr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(t(e[o],o,e))return!0}return!1}function Ui(e,t,n,r){return vi(e)||(e=Rr(e)),("number"!=typeof n||r)&&(n=0),ji(e,t,n)>=0}var Vi=Pn((function(e,t,n){var r,i;return Kn(t)?i=t:(t=Hr(t),r=t.slice(0,-1),t=t[t.length-1]),Ri(e,(function(e){var a=i;if(!a){if(r&&r.length&&(e=Gr(e,r)),null==e)return;a=e[t]}return null==a?a:a.apply(e,n)}))}));function Wi(e,t){return Ri(e,Kr(t))}function Hi(e,t,n){var r,i,a=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=vi(e)?e:Rr(e)).length;s<l;s++)null!=(r=e[s])&&r>a&&(a=r);else t=ti(t,n),Ni(e,(function(e,n,r){((i=t(e,n,r))>o||i===-1/0&&a===-1/0)&&(a=e,o=i)}));return a}function Gi(e,t,n){if(null==t||n)return vi(e)||(e=Rr(e)),e[ri(e.length-1)];var r=vi(e)?Vr(e):Rr(e),i=mr(r);t=Math.max(Math.min(t,i),0);for(var a=i-1,o=0;o<t;o++){var s=ri(o,a),l=r[o];r[o]=r[s],r[s]=l}return r.slice(0,t)}function Xi(e,t){return function(n,r,i){var a=t?[[],[]]:{};return r=ti(r,i),Ni(n,(function(t,i){var o=r(t,i,n);e(a,t,o)})),a}}var Yi=Xi((function(e,t,n){ir(e,n)?e[n].push(t):e[n]=[t]})),Ji=Xi((function(e,t,n){e[n]=t})),Ki=Xi((function(e,t,n){ir(e,n)?e[n]++:e[n]=1})),Qi=Xi((function(e,t,n){e[n?0:1].push(t)}),!0),Zi=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ea(e,t,n){return t in n}var ta=Pn((function(e,t){var n={},r=t[0];if(null==e)return n;Kn(r)?(t.length>1&&(r=Qr(r,t[1])),t=Or(e)):(r=ea,t=bi(t,!1,!1),e=Object(e));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];r(s,o,e)&&(n[o]=s)}return n})),na=Pn((function(e,t){var n,r=t[0];return Kn(r)?(r=ki(r),t.length>1&&(n=t[1])):(t=Ri(bi(t,!1,!1),String),r=function(e,n){return!Ui(t,n)}),ta(e,r,n)}));function ra(e,t,n){return kn.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function ia(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:ra(e,e.length-t)}function aa(e,t,n){return kn.call(e,null==t||n?1:t)}var oa=Pn((function(e,t){return t=bi(t,!0,!0),Ii(e,(function(e){return!Ui(t,e)}))})),sa=Pn((function(e,t){return oa(e,t)}));function la(e,t,n,r){In(t)||(r=n,n=t,t=!1),null!=n&&(n=ti(n,r));for(var i=[],a=[],o=0,s=mr(e);o<s;o++){var l=e[o],u=n?n(l,o,e):l;t&&!n?(o&&a===u||i.push(l),a=u):n?Ui(a,u)||(a.push(u),i.push(l)):Ui(i,l)||i.push(l)}return i}var ua=Pn((function(e){return la(bi(e,!0,!0))}));function ca(e){for(var t=e&&Hi(e,mr).length||0,n=Array(t),r=0;r<t;r++)n[r]=Wi(e,r);return n}var fa=Pn(ca);function da(e,t){return e._chain?br(t).chain():t}function ha(e){return Ni(zr(e),(function(t){var n=br[t]=e[t];br.prototype[t]=function(){var e=[this._wrapped];return _n.apply(e,arguments),da(this,n.apply(br,e))}})),br}Ni(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=bn[e];br.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),da(this,n)}})),Ni(["concat","join","slice"],(function(e){var t=bn[e];br.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),da(this,e)}}));var pa=ha(Object.freeze({__proto__:null,VERSION:yn,restArguments:Pn,isObject:zn,isNull:function(e){return null===e},isUndefined:Bn,isBoolean:In,isElement:function(e){return!(!e||1!==e.nodeType)},isString:qn,isNumber:Un,isDate:Vn,isRegExp:Wn,isError:Hn,isSymbol:Gn,isArrayBuffer:Xn,isDataView:nr,isArray:rr,isFunction:Kn,isArguments:or,isFinite:function(e){return!Gn(e)&&Fn(e)&&!isNaN(parseFloat(e))},isNaN:sr,isTypedArray:pr,isEmpty:function(e){if(null==e)return!0;var t=mr(e);return"number"==typeof t&&(rr(e)||qn(e)||or(e))?0===t:0===mr(yr(e))},isMatch:vr,isEqual:function(e,t){return _r(e,t)},isMap:jr,isWeakMap:Fr,isSet:Tr,isWeakSet:Nr,keys:yr,allKeys:Or,values:Rr,pairs:function(e){for(var t=yr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:Pr,functions:zr,methods:zr,extend:Ir,extendOwn:Lr,assign:Lr,defaults:qr,create:function(e,t){var n=Ur(e);return t&&Lr(n,t),n},clone:Vr,tap:function(e,t){return t(e),e},get:Xr,has:function(e,t){for(var n=(t=Hr(t)).length,r=0;r<n;r++){var i=t[r];if(!ir(e,i))return!1;e=e[i]}return!!n},mapObject:function(e,t,n){t=ti(t,n);for(var r=yr(e),i=r.length,a={},o=0;o<i;o++){var s=r[o];a[s]=t(e[s],s,e)}return a},identity:Yr,constant:lr,noop:ni,toPath:Wr,property:Kr,propertyOf:function(e){return null==e?ni:function(t){return Xr(e,t)}},matcher:Jr,matches:Jr,times:function(e,t,n){var r=Array(Math.max(0,e));t=Qr(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:ri,now:ii,escape:si,unescape:li,templateSettings:ui,template:function(e,t,n){!t&&n&&(t=n),t=qr({},t,br.templateSettings);var r,i=RegExp([(t.escape||ci).source,(t.interpolate||ci).source,(t.evaluate||ci).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(i,(function(t,n,r,i,s){return o+=e.slice(a,s).replace(di,hi),a=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t})),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return r.call(this,e,br)},l=t.variable||"obj";return s.source="function("+l+"){\n"+o+"}",s},result:function(e,t,n){var r=(t=Hr(t)).length;if(!r)return Kn(n)?n.call(e):n;for(var i=0;i<r;i++){var a=null==e?void 0:e[t[i]];void 0===a&&(a=n,i=r),e=Kn(a)?a.call(e):a}return e},uniqueId:function(e){var t=++pi+"";return e?e+t:t},chain:function(e){var t=br(e);return t._chain=!0,t},iteratee:ei,partial:gi,bind:yi,bindAll:xi,memoize:function(e,t){var n=function(r){var i=n.cache,a=""+(t?t.apply(this,arguments):r);return ir(i,a)||(i[a]=e.apply(this,arguments)),i[a]};return n.cache={},n},delay:wi,defer:_i,throttle:function(e,t,n){var r,i,a,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:ii(),r=null,o=e.apply(i,a),r||(i=a=null)},u=function(){var u=ii();s||!1!==n.leading||(s=u);var c=t-(u-s);return i=this,a=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=u,o=e.apply(i,a),r||(i=a=null)):r||!1===n.trailing||(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),s=0,r=i=a=null},u},debounce:function(e,t,n){var r,i,a=function(t,n){r=null,n&&(i=e.apply(t,n))},o=Pn((function(o){if(r&&clearTimeout(r),n){var s=!r;r=setTimeout(a,t),s&&(i=e.apply(this,o))}else r=wi(a,t,this,o);return i}));return o.cancel=function(){clearTimeout(r),r=null},o},wrap:function(e,t){return gi(t,e)},negate:ki,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:Oi,once:Si,findKey:Ei,findIndex:Ai,findLastIndex:Di,sortedIndex:Ci,indexOf:ji,lastIndexOf:Fi,find:Ti,detect:Ti,findWhere:function(e,t){return Ti(e,Jr(t))},each:Ni,forEach:Ni,map:Ri,collect:Ri,reduce:zi,foldl:zi,inject:zi,reduceRight:Bi,foldr:Bi,filter:Ii,select:Ii,reject:function(e,t,n){return Ii(e,ki(ti(t)),n)},every:Li,all:Li,some:qi,any:qi,contains:Ui,includes:Ui,include:Ui,invoke:Vi,pluck:Wi,where:function(e,t){return Ii(e,Jr(t))},max:Hi,min:function(e,t,n){var r,i,a=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=vi(e)?e:Rr(e)).length;s<l;s++)null!=(r=e[s])&&r<a&&(a=r);else t=ti(t,n),Ni(e,(function(e,n,r){((i=t(e,n,r))<o||i===1/0&&a===1/0)&&(a=e,o=i)}));return a},shuffle:function(e){return Gi(e,1/0)},sample:Gi,sortBy:function(e,t,n){var r=0;return t=ti(t,n),Wi(Ri(e,(function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")},groupBy:Yi,indexBy:Ji,countBy:Ki,partition:Qi,toArray:function(e){return e?rr(e)?kn.call(e):qn(e)?e.match(Zi):vi(e)?Ri(e,Yr):Rr(e):[]},size:function(e){return null==e?0:vi(e)?e.length:yr(e).length},pick:ta,omit:na,first:ia,head:ia,take:ia,initial:ra,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:aa(e,Math.max(0,e.length-t))},rest:aa,tail:aa,drop:aa,compact:function(e){return Ii(e,Boolean)},flatten:function(e,t){return bi(e,t,!1)},without:sa,uniq:la,unique:la,union:ua,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=mr(e);r<i;r++){var a=e[r];if(!Ui(t,a)){var o;for(o=1;o<n&&Ui(arguments[o],a);o++);o===n&&t.push(a)}}return t},difference:oa,unzip:ca,transpose:ca,zip:fa,object:function(e,t){for(var n={},r=0,i=mr(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),a=0;a<r;a++,e+=n)i[a]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(kn.call(e,r,r+=t));return n},mixin:ha,default:br}));function ma(e){return e&&e.length?e:e?[e]:[]}function ga(e){return e[Math.floor(Math.random()*e.length)]}function ya(e){for(var t=0,n=0;n<e;n++)t+=.9**n;return t}function va(e,t){return Math.max(Math.abs((e.x||0)-(t.x||0)),Math.abs((e.y||0)-(t.y||0)))}function ba(e,t){var n;return n=0==e.id?25-(t.x||0):t.x||0,new sn(`${n} to goal`,0==n?8:4*.85**(n-1))}pa._=pa;const xa="actual",wa="simulated";class _a{team;playerState;constructor(e,t,n){this.team=e,this.id=t.Data.Id,this.name=t.Data.Name,this.cell=t.Cell,this.situation=t.Situation,this.playerState=t,this.canAct=1==t.CanAct&&this.situation===ct.Active,this.skills=Sa.translateStringNumberList(t.Data.ListSkills)||[],this.isBallCarrier=0==va(n.Ball.Cell,this.cell)&&1==n.Ball.IsHeld}get skillNames(){return this.skills.map((e=>ut[e]))}}class ka{teamState;constructor(e,t){this.players=e.ListPitchPlayers.PlayerState.map((e=>new _a(this,e,t))),this.name=e.Data.Name,this.id=e.Data.TeamId||0,this.turn=e.GameTurn||0}get shortName(){return this.name.split(/\s+/).map((e=>e[0])).join("")}}class Oa{teams;activeTeam;turn;constructor({teams:e,activeTeamId:t,ballCell:n}){this.teams=e,this.activeTeam=e.filter((e=>e.id==t))[0]||e[0],this.turn=this.activeTeam&&this.activeTeam.turn||0,this.ballCell=n}static argsFromXml(e){const t={};return t.teams=e.ListTeams.TeamState.map((t=>new ka(t,e))),t.activeTeamId=e.ActiveTeam,t.ballCell=e.Ball.Cell,t}playerById(e){for(var t of this.teams)for(var n of t.players)if(n.id===e)return n}playerAtPosition(e){for(var t of this.teams)for(var n of t.players)if((n.cell.x||0)===(e.x||0)&&(n.cell.y||0)===(e.y||0))return n;console.log("No player found",{replayStep:this.replayStep,action:this.action,cell:e})}}class Sa{static handledSkills=[];static diceSeparator=", ";constructor(e){Object.assign(this,e),this.onPitchValues={},this.onTeamValues={},this.armorRollCache={},this.dependentRolls=[],console.assert(!this.unhandledSkills||0==this.unhandledSkills.length,"Unhandled skills for roll",{roll:this,skills:this.unhandledSkills&&this.unhandledSkills.map((e=>ut[e.SkillId])),rollName:this.rollName})}static argsFromXml(e){const t={};t.initialBoardState=new Oa(Oa.argsFromXml(e.initialBoard)),t.finalBoardState=new Oa(Oa.argsFromXml(e.replayStep.BoardState));var n=e.action.PlayerId;return t.activePlayer=t.initialBoardState.playerById(n),t.rollType=e.boardActionResult.RollType,t.dice=this.dice(e.boardActionResult),t.skillsInEffect=ma(e.boardActionResult.CoachChoices.ListSkills.SkillInfo),t.unhandledSkills=t.skillsInEffect.filter((e=>!this.handledSkills.includes(e.SkillId))),t.ignore=this.ignore(e),t.actionType=e.action.ActionType,t.rollStatus=e.boardActionResult.RollStatus,t.resultType=e.boardActionResult.ResultType,t.subResultType=e.boardActionResult.SubResultType,t.stepIndex=e.stepIndex,t.resultIndex=e.resultIndex,t.actionIndex=e.actionIndex,t.isReroll=[ft.RerollTaken,ft.RerollWithSkill].includes(t.rollStatus),t}get activeTeam(){return this.finalBoardState.activeTeam}get teams(){return this.finalBoardState.teams}get turn(){return this.finalBoardState.turn}get rollName(){return this.constructor.rollName}get jointDescription(){return[this.description].concat(this.dependentRolls.map((e=>e.shortDescription||e.description))).join(" → ")}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice}`}get shortDescription(){return`${this.rollName}: ${this.activePlayer.name} - ${this.dice.join(this.constructor.diceSeparator)}`}isDependentRoll(e){return!1}value(e,t){throw"value must be defined by subclass"}get expectedValue(){return this.possibleOutcomes.expectedValue}get possibleOutcomes(){throw`possibleOutcomes must be defined by subclass ${this.constructor.name}`}simulateDice(){throw"simulateDice must be defined by subclass"}static ignore(e){return e.boardActionResult.RollStatus==ft.RerollNotTaken||void 0===e.boardActionResult.CoachChoices.ListDices}static dice(e){return this.translateStringNumberList(e.CoachChoices.ListDices)}get actualValue(){const e=this.value(this.dice,!1);return e instanceof an?e:new sn(this.rollName,e)}get valueWithDependents(){return this.actualValue.add(...this.dependentRolls.map((e=>e.actualValue)))}get actual(){var e=this.dataPoint(-1,xa);const t=this.possibleOutcomes.flat.map((t=>({value:t.value-e.expectedValue,weight:t.weight})));return Object.assign(e,{turn:this.turn,player:this.activePlayer&&this.activePlayer.name||"",playerSkills:this.activePlayer&&this.activePlayer.skills.map((e=>ut[e]))||[],rollName:this.rollName,dice:this.dice,dnvMin:Math.min(...t.map((e=>e.value))),dnvq33:gn(t,.33,"value","weight"),dnvMed:gn(t,.5,"value","weight"),dnvq67:gn(t,.67,"value","weight"),dnvMax:Math.max(...t.map((e=>e.value))),outcomes:this.possibleOutcomes.flat.map((t=>t.value-e.expectedValue)),weights:this.possibleOutcomes.flat.map((e=>e.weight)),description:this.jointDescription,valueDescription:`${this.valueWithDependents.valueString} ${this.possibleOutcomes.valueString}`})}simulated(e){return this.dataPoint(e,wa)}dataPoint(e,t){var n;return t==xa?n=this.valueWithDependents.singularValue:t==wa&&(n=this.possibleOutcomes.sample()),{iteration:e,turn:this.turn,activeTeamId:this.activeTeam.id,activeTeamName:this.activeTeam.name,teamId:this.activePlayer?this.activePlayer.team.id:this.activeTeam.id,teamName:this.activePlayer?this.activePlayer.team.name:this.activeTeam.name,outcomeValue:n,type:t,expectedValue:this.expectedValue,netValue:n-this.expectedValue,rollIndex:this.rollIndex}}static translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}static fromReplayStep(e,t,n){for(var r=ma(n.RulesEventBoardAction),i=[],a=0;a<r.length;a++){var o=r[a];i=i.concat(Sa.fromAction(e,t,n,a,o))}return i}static fromAction(e,t,n,r,i){for(var a=ma(i.Results.BoardActionResult),o=[],s=0;s<a.length;s++){var l=a[s],u=this.fromBoardActionResult(e,t,n,r,i,s,l);u&&o.push(u)}return 0==a.length&&console.warn("Unexpectedly missing boardactionresult",{stepIndex:t,replayStep:n,action:i}),o}static fromBoardActionResult(e,t,n,r,i,a,o){var s;return null===(s=void 0===o.RollType?ja:Pa[o.RollType])?null:s?new s(s.argsFromXml({initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o})):(console.warn("Unknown roll "+o.RollType,{initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o}),null)}onActiveTeam(e){return e.team.id===this.activeTeam.id}playerValue(e){var t=this.initialBoardState.ballCell;if((t.x||0)<0||(t.y||0)<0)return this.rawPlayerValue(e);var n=va(t,e.cell);return 0==n?this.rawPlayerValue(e).product(new sn("On Ball",2)).named(`PV(${e.name})`):1==n?this.rawPlayerValue(e).product(new sn("By Ball",1.5)).named(`PV(${e.name})`):this.rawPlayerValue(e)}rawPlayerValue(e){return new sn(`TV(${e.name})`,1)}teamValue(e,t,n){return new un(e.players.filter((e=>t.includes(e.situation)||e.id==n.id)).map((e=>this.playerValue(e))),`TV(${e.name})`)}get halfTurnsInGame(){var e=this.teams.map((e=>this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}get halfTurnsInHalf(){var e=this.teams.map((e=>this.turn<=8?8-e.turn:this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}stunTurns(e){return Math.min(this.onActiveTeam(e)?4:3,this.halfTurnsInHalf)}kdTurns(e){return Math.min(this.onActiveTeam(e)?2:1,this.halfTurnsInHalf)}onPitchValue(e){return this.onPitchValues[e.id]||(this.onPitchValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[ct.Active],e).named(`TPV(${e.team.name})`)).named(`%PV(${e.name})`))}onTeamValue(e){return this.onTeamValues[e.id]||(this.onTeamValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[ct.Active,ct.Reserves,ct.KO],e).named("Players on Team")).named(e.name))}armorRoll(e){return this.armorRollCache[e.id]||(this.armorRollCache[e.id]=new $a({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:e}))}knockdownValue(e,t){const n=this.onPitchValue(e);var r=this.kdTurns(e),i=ya(r),a=[new sn(`TDT(${r/2})`,i)];this.onActiveTeam(e)&&a.push(new sn("On Active Team",-1));var o=n.product(...a).named(`KD(${e.name})`);return t&&(o=o.add(this.armorRoll(e).possibleOutcomes.named("Armor Roll"))),o}stunValue(e){var t=this.onPitchValue(e),n=this.stunTurns(e),r=ya(n),i=[new sn(`TDT(${n/2})`,r)];return this.onActiveTeam(e)&&i.push(new sn("On Active Team",-1)),t.product(...i).named(`STUN(${e.name})`)}koValue(e){const t=this.onPitchValue(e);var n=this.halfTurnsInHalf,r=this.stunTurns(e),i=[new sn(`TDT(${n-r})`,ya(n)-ya(r))];return this.onActiveTeam(e)&&i.push(new sn("On Active Team",-1)),t.product(...i).named(`KO(${e.name})`)}casValue(e){const t=this.onTeamValue(e).product(new sn(`TDT(${this.halfTurnsInGame/2})`,ya(this.halfTurnsInGame))),n=this.onPitchValue(e).subtract(this.onTeamValue(e)).product(new sn(`TDT(${this.halfTurnsInHalf/2})`,ya(this.halfTurnsInHalf))),r=t.add(n).named(`PV(${e.name})`);var i=[];return this.onActiveTeam(e)&&i.push(new sn("On Active Team",-1)),r.product(...i).subtract(this.stunValue(e)).named(`CAS(${e.name})`)}get dependentMoveValues(){const e=this.dependentRolls.filter((e=>e.constructor==ja));return e.length>0?new un(e.map((e=>e.value())),"Following Moves"):null}get unactivatedPlayers(){return Object.defineProperty(this,"unactivatedPlayers",{value:this.activeTeam.players.filter((e=>e.canAct))}),this.unactivatedPlayers}get turnoverValue(){const e=this.unactivatedPlayers.filter((e=>e!=this.activePlayer)).map((e=>this.onPitchValue(e)));var t;return t=e.length>0?new un(e).named("Unactivated PV").product(-1).named("Turnover"):new sn("No Active Players",0),Object.defineProperty(this,"turnoverValue",{value:t}),this.turnoverValue}get rerollValue(){return new sn("Reroll",0)}}class Ea extends Sa{static numDice=1;static diceSeparator="+";static canCauseInjury=!1;static includeFollowingMoves=!0;constructor(e){super(e),console.assert(!this.computedTarget||!this.target||this.computedTarget==this.target,"Computed target (%d) doesn't equal target from replay XML (%d)",this.computedTarget,this.target,this),console.assert(void 0===this.computedModifier||void 0===this.modifier||this.computedModifier==this.modifier,"Computed modifier (%d) doesn't equal modifier from replay XML (%d)",this.computedModifier,this.modifier,this),console.assert(void 0===this.dice||this.constructor.numDice==this.dice.length,"Mismatch in number of dice (%d) and expected number of dice (%d)",this.dice&&this.dice.length,this.constructor.numDice,this)}static argsFromXml(e){const t=super.argsFromXml(e);return t.modifier=ma(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t.target=e.boardActionResult.Requirement,t}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice} (${this.modifiedTarget})`}get actual(){return Object.assign(super.actual,{target:this.modifiedTarget})}get modifiedTarget(){var e=(this.target||this.computedTarget)-(this.modifier||this.computedModifier||0);return 1==this.constructor.numDice?Math.min(6,Math.max(2,e)):e}value(e,t){return e.reduce(((e,t)=>e+t),0)>=this.modifiedTarget?this.passValue(t).add(t?this.dependentMoveValues:null):this.dependentRolls.length>=1&&this.dependentRolls[0].constructor==this.constructor&&this.dependentRolls[0].isReroll?new sn(`Rerolled ${this.rollName}`,this.rerollValue):this.failValue(t)}get possibleOutcomes(){for(var e=[0],t=0;t<this.constructor.numDice;t++){for(var n=[],r=1;r<=6;r++)for(const t of e)n.push(t+r);e=n}var i=[],a=[];for(const t of e)t>=this.modifiedTarget?i.unshift(t):a.unshift(t);var o=[];if(i.length>0){const e=Math.min(...i),t=Math.max(...i);o.push({name:e===t?e:`${e}-${t}`,value:this.passValue(!0).add(this.dependentMoveValues),weight:i.length/(i.length+a.length)})}if(a.length>0){const e=Math.min(...a),t=Math.max(...a);o.push({name:e===t?e:`${e}-${t}`,value:this.hasSkillReroll?this.reroll.possibleOutcomes:this.failValue(!0),weight:a.length/(i.length+a.length)})}return Object.defineProperty(this,"possibleOutcomes",{value:new on(o)}),this.possibleOutcomes}get reroll(){const e=new this.constructor({...this,rollStatus:ft.RerollWithSkill});return Object.defineProperty(this,"reroll",{value:e}),this.reroll}get hasSkillReroll(){return this.activePlayer.skills.includes(this.constructor.rerollSkill)&&!this.skillsInEffect.includes(this.constructor.rerollCancelSkill)&&![ft.RerollWithSkill,ft.RerollTaken].includes(this.rollStatus)}simulateDice(){return this.dice.map((()=>ga([1,2,3,4,5,6])))}passValue(){return new sn("Pass",0)}failValue(){return new sn("Fail",0)}isDependentRoll(e){return e.rollType==this.rollType&&[ft.RerollTaken,ft.RerollWithSkill].includes(e.rollStatus)||this.constructor.canCauseInjury&&[$a,Ca,Ma].includes(e.constructor)&&!e.isFoul||this.constructor.includeFollowingMoves&&e.constructor==ja}}class $a extends Ea{static numDice=2;static handledSkills=[lt,je,Ie,Ye];static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=59==n.RollType,t.isPileOn){var r=ma(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Ye))[0].PlayerId)}}return t.isFoul=e.action.ActionType==vt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(ma(e.replayStep.RulesEventBoardAction)[0].PlayerId),console.log(e,t.finalBoardState.activePlayer,t.foulingPlayer)),t}get description(){if(this.isFoul){var e=this.foulingPlayer.skills.length>0?` (${this.foulingPlayer.skillNames.join(", ")})`:"",t=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.foulingPlayer.team.shortName}] ${this.foulingPlayer.name}${e} against ${this.activePlayer.name}${t} - ${this.dice.join(this.constructor.diceSeparator)}`}return super.description}isDependentRoll(e){return this.isFoul&&([Ca,Ma].includes(e.constructor)&&e.isFoul&&e.activePlayer.id==this.activePlayer.id||e.constructor==Ra)}get rollName(){return this.isFoul?"Foul (Armor)":this.isPileOn?"Pile On (Armor)":"Armor"}get computedTarget(){return this.activePlayer.playerState.Data.Av+1}get computedModifier(){return 0}get injuryRoll(){return Object.defineProperty(this,"injuryRoll",{value:new Ca({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:this.activePlayer,modifier:0})}),this.injuryRoll}value(e,t){var n=super.value(e,t);return this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}passValue(e){var t=this.stunValue(this.activePlayer);if(e&&(t=t.add(this.injuryRoll.possibleOutcomes.named("Injury Roll"))),this.isPileOn){const e=this.knockdownValue(this.pilingOnPlayer,!1);return t.add(e)}return t}failValue(){var e=new sn("No Break",0);return this.isPileOn?e.add(this.knockdownValue(this.pilingOnPlayer,!1)):e}}class Aa extends Ea{static rollName="Intercept";static handledSkills=[Me];passValue(){return this.turnoverValue}}class Da extends Ea{static rollName="Catch";static handledSkills=[Ue,De,Me];static rerollSkill=De;failValue(){return this.turnoverValue}}class Ca extends Sa{static handledSkills=[je,Ie,tt];static diceSeparator="+";static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=60==n.RollType,t.isPileOn){var r=ma(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==Ye))[0].PlayerId)}}return t.isFoul=e.action.ActionType==vt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(ma(e.replayStep.RulesEventBoardAction)[0].PlayerId)),t.modifier=ma(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t}get rollName(){return this.isPileOn?"Pile On (Injury)":"Injury"}static ignore(e){return 1!=e.boardActionResult.IsOrderCompleted?(console.log("Ignoring incomplete InjuryRoll",{roll:this}),!0):super.ignore(e)}injuryValue(e){return this.activePlayer.skills.includes(tt)&&(e+=1),e<=7?new sn("No Injury",0):e<=9?this.koValue(this.activePlayer):this.casValue(this.activePlayer)}value(e){var t=e[0]+e[1]+this.modifier,n=this.injuryValue(t);return this.isPileOn&&(n=n.subtract(this.onPitchValue(this.pilingOnPlayer))),this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}get possibleOutcomes(){for(var e={},t=1;t<=6;t++)for(var n=1;n<=6;n++){var r=e[this.value([t,n],!0).name];r||(r=e[this.value([t,n],!0).name]=[]),r.unshift({name:(t+n).toString(),value:this.value([t,n],!0)})}return Object.defineProperty(this,"possibleOutcomes",{value:new on(Object.values(e).map((e=>{const t=Math.min(...e.map((e=>parseInt(e.name)))),n=Math.max(...e.map((e=>parseInt(e.name))));return{name:t===n?t:`${t}-${n}`,weight:e.length,value:e[0].value}})))}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ga([1,2,3,4,5,6])))}}class Ma extends Sa{static rollName="Casualty";static diceSeparator="";static argsFromXml(e){const t=super.argsFromXml(e);return t.isFoul=e.action.ActionType==vt,t}static dice(e){var t=super.dice(e);return[(t=t.slice(0,t.length/2))[t.length-1]]}value(e){return new sn("CAS",0)}get possibleOutcomes(){for(var e=[],t=1;t<=6;t++)for(var n=1;n<=8;n++)e.unshift({name:`${t}${n}`,value:this.value(10*t+n,!0),weight:1});return Object.defineProperty(this,"possibleOutcomes",{value:new on(e)}),this.possibleOutcomes}simulateDice(){return 10*ga([1,2,3,4,5,6])+ga([1,2,3,4,5,6,7,8])}static ignore(e){return e.boardActionResult.ResultType!=xt&&e.boardActionResult.SubResultType!=wt&&12!=e.boardActionResult.SubResultType?(console.warn("Ignoring casualty roll, should verify",{roll:this}),!0):super.ignore(e)}}class ja extends Sa{static rollName="Move";static ignore(e){return 0==va(e.action.Order.CellFrom,e.action.Order.CellTo.Cell)}static argsFromXml(e){const t=super.argsFromXml(e);return t.cellFrom=e.action.Order.CellFrom,t.cellTo=e.action.Order.CellTo.Cell,t}get jointDescription(){const e=[this].concat(this.dependentRolls),t=this.cellFrom,n=e[e.length-1].cellTo;return`Move: [${this.activePlayer.team.shortName}] ${this.activePlayer.name} - (${t.x||0}, ${t.y||0}) → (${n.x||0}, ${n.y||0})`}isDependentRoll(e){return e.constructor==ja&&this.activePlayer.id==e.activePlayer.id}value(){return this.activePlayer&&this.activePlayer.isBallCarrier?ba(this.activePlayer.team,this.cellTo).subtract(ba(this.activePlayer.team,this.cellFrom)):new sn("Move",0)}get possibleOutcomes(){return this.value().add(...this.dependentRolls.map((e=>e.value())))}}class Fa extends Sa{static ignore(){return!0}value(){return new sn("No Value",0)}get expectedValue(){return 0}simulateDice(){return null}get possibleOutcomes(){return[]}}class Ta extends Fa{static rollName="Push";static handledSkills=[Qe]}class Na extends Fa{static rollName="Follow Up"}class Ra extends Fa{}const Pa={1:class extends Ea{static rollName="GFI";static handledSkills=[nt];static rerollSkill=nt;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},2:class extends Ea{static rollName="Dodge";static handledSkills=[ze,tt,Te,Ce,Ze,Je,Ve];static rerollSkill=Ce;static rerollCancelSkill=Ze;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},3:$a,4:Ca,5:class extends Sa{static rollName="Block";static handledSkills=[Ze,Ce,Le,We,Fe,Ne,ot,Re];static diceSeparator="/";static argsFromXml(e){const t=super.argsFromXml(e);return t.isRedDice=e.boardActionResult.Requirement<0,t.attacker=t.activePlayer,t.defender=t.finalBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}isDependentRoll(e){return[Ta,Na,ja].includes(e.constructor)||[$a,Ca,Ma].includes(e.constructor)&&!e.isFoul||e.rollType===this.rollType&&e.rollStatus==ft.RerollTaken}static dice(e){var t=super.dice(e);return t.slice(0,t.length/2).map((e=>Dt[e]))}get description(){var e=this.isRedDice?" uphill":"",t=this.attacker.skills.length>0?` (${this.attacker.skillNames.join(", ")})`:"",n=this.defender.skills.length>0?` (${this.defender.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${t} against ${this.defender.name}${n} - ${this.dice.join(this.constructor.diceSeparator)}${e}`}static ignore(e){return e.boardActionResult.ResultType!=xt||(e.boardActionResult.SubResultType==_t||(e.boardActionResult.SubResultType==kt||super.ignore(e)))}dieValue(e,t){const n=this.attacker,r=this.defender;var i=n&&n.skills||[],a=r&&r.skills||[];switch(e){case Ot:return this.knockdownValue(n,t).add(this.turnoverValue);case St:const e=i.includes(Le),u=a.includes(Le);var o=[];if(i.includes(ot)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));o.push(e)}if(i.includes(He)&&this.isBlitz){const e=this.knockdownValue(r,!1).product(new sn("Push",.33)).named(`Push(${r.name})`).add(t?this.dependentMoveValues:null);o.push(e)}var s,l=[];if(a.includes(ot)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));l.push(e)}if(e&&u){s=new sn("Block/Block",0).add(t?this.dependentMoveValues:null)}else if(e){s=this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}else if(u){s=this.knockdownValue(n,t)}else{s=this.knockdownValue(r,t).add(this.knockdownValue(n,t),this.turnoverValue)}return s.min(...l).max(...o);case Et:return(a.includes(Ne)?new sn("Stand Firm",0):this.knockdownValue(r,!1).product(new sn("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null);case $t:return a.includes(Ce)&&!i.includes(Ze)?(a.includes(Ne)?new sn("Stand Firm",0):this.knockdownValue(r,!1).product(new sn("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null):this.knockdownValue(r,t).add(t?this.dependentMoveValues:null);case At:return this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}}value(e,t){if(this.dependentRolls.length>0&&this.dependentRolls[0].rollType==this.rollType&&this.dependentRolls[0].rollStatus==ft.RerollTaken)return this.rerollValue;var n=e.filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>this.dieValue(e,t)));if(1==n.length)return n[0];if(this.isRedDice){var[r,...i]=n;return r.min(...i)}var[r,...i]=n;return r.max(...i)}get possibleOutcomes(){var e;const t=new on([{name:Et,weight:1/3,value:this.dieValue(Et,!0)},{name:Ot,weight:1/6,value:this.dieValue(Ot,!0)},{name:At,weight:1/6,value:this.dieValue(At,!0)},{name:$t,weight:1/6,value:this.dieValue($t,!0)},{name:St,weight:1/6,value:this.dieValue(St,!0)}]);return e=1==this.dice.length?t:this.isRedDice?new mn(new Array(this.dice.length).fill(t)):new pn(new Array(this.dice.length).fill(t)),Object.defineProperty(this,"possibleOutcomes",{value:e}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ga([Ot,St,Et,Et,$t,At])))}},6:class extends Ea{static rollName="Stand Up";failValue(){return this.knockdownValue(this.activePlayer,!1)}},7:class extends Ea{static rollName="Pickup";static rerollSkill=rt;static handledSkills=[rt,st,Me];failValue(){return this.turnoverValue}},8:Ma,9:Da,10:null,11:null,12:class extends Ea{static rollName="Pass";static rerollSkill=Xe;static handledSkills=[Xe,et,Pe];failValue(){return this.turnoverValue}},13:Ta,14:Na,15:Ra,16:Aa,17:class extends Ea{static rollName="Wake Up";constructor(e){super(e),this.finalBoardState.activeTeam=this.activePlayer.team,this.finalBoardState.turn=this.finalBoardState.activeTeam.turn+1}passValue(){return this.koValue(this.activePlayer).product(-1).named("Wake Up")}},19:null,20:class extends Ea{static rollName="Bone Head";static handledSkills=[qe];failValue(){return this.knockdownValue(this.activePlayer,!1)}},21:class extends Ea{static rollName="Really Stupid";static handledSkills=[Ke];failValue(){return this.knockdownValue(this.activePlayer,!1)}},22:class extends Ea{static rollName="Wild Animal";static handledSkills=[at];failValue(){return-this.onPitchValue(this.activePlayer)}},24:class extends Ea{static rollName="Landing";static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e)}},26:null,29:class extends Ea{static rollName="Dauntless";static handledSkills=[Be]},31:class extends Ea{static rollName="Jump-Up";static handledSkills=[Ge];failValue(){return-this.onPitchValue(this.activePlayer)}},36:class extends Ea{static rollName="Leap";static canCauseInjury=!0;failValue(){return this.knockdownValue(this.activePlayer).add(this.turnoverValue)}},40:class extends Ea{static rollName="Take Root";static handledSkills=[Re];failValue(){return this.knockdownValue(this.activePlayer,!1)}},54:class extends Ea{static rollName="Fireball";static canCauseInjury=!0;passValue(e){return this.knockdownValue(this.activePlayer,e)}},55:class extends Ea{static rollName="Lightning Bolt";static canCauseInjury=!0;static argsFromXml(e){const t=super.argsFromXml(e);return t.activePlayer=t.initialBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}passValue(e){return this.knockdownValue(this.activePlayer,e)}},56:class extends Ea{static rollName="Throw Teammate";static handledSkills=[it];failValue(){return new sn("Fail",0)}isDependentRoll(e){return[Da,Aa].includes(e.constructor)}},58:null,59:$a,60:Ca,61:null,64:null,70:null},za=function(e){var t,n,r,i=(n=(t=e).Replay.ReplayStep[0],r=t.Replay.ReplayStep[t.Replay.ReplayStep.length-1],console.log("Full gameinfo:"),console.log(n.GameInfos),{stadiumName:n.GameInfos.NameStadium,stadiumType:n.GameInfos.StructStadium,leagueName:n.GameInfos.RowLeague.Name,homeTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[0].UserId,teamName:n.BoardState.ListTeams.TeamState[0].Data.Name,raceId:n.BoardState.ListTeams.TeamState[0].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.HomeScore||0},awayTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[1].UserId,teamName:n.BoardState.ListTeams.TeamState[1].Data.Name,raceId:n.BoardState.ListTeams.TeamState[1].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.AwayScore||0}});console.log("Extracted game details...",i);for(var a=[],o=0;o<e.Replay.ReplayStep.length;o++){var s=e.Replay.ReplayStep[o];s.index=o,a=a.concat(Sa.fromReplayStep(e.Replay.ReplayStep[o-1]&&e.Replay.ReplayStep[o-1].BoardState,o,s))}return console.log("Extracted rolls...",a),(a=(a=a.filter((e=>!e.ignore))).reduce(((e,t)=>(e.length>0&&e[e.length-1].isDependentRoll(t)?e[e.length-1].dependentRolls.push(t):e.push(t),e)),[])).forEach(((e,t)=>e.rollIndex=t)),{fullReplay:e.Replay,gameDetails:i,playerDetails:{},rolls:a,version:1}};function Ba(t){let n,r,i,a,o,s,l,u,c,f,d;return{c(){n=_("div"),r=_("span"),i=k("Select Replay\n    "),a=_("input"),o=O(),s=_("script"),u=_("script"),D(a,"type","file"),D(a,"accept",".bbrz,.zip"),D(a,"class","svelte-16kp35q"),D(r,"id","file-input-button"),D(r,"class","btn btn-primary btn-file centered svelte-16kp35q"),D(n,"class","text-center"),s.src!==(l="https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js")&&D(s,"src","https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js"),u.src!==(c="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js")&&D(u,"src","https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js"),D(u,"integrity","sha512-JtZhe+DT2O3VPwzAMhyOpVY75fn92Zm1ebHVgAdXFf/x+7SfbonV/O7OWLsHkj11+yMtZAXavsuMvCaQS3WXrQ=="),D(u,"crossorigin","anonymous")},m(e,l){b(e,n,l),v(n,r),v(r,i),v(r,a),t[2](a),b(e,o,l),v(document.head,s),v(document.head,u),f||(d=E(a,"change",t[1]),f=!0)},p:e,i:e,o:e,d(e){e&&x(n),t[2](null),e&&x(o),x(s),x(u),f=!1,d()}}}function Ia(e,t,n){const r=q();let i;return[i,function(){console.log("Preparing to parse XML..."),r("replayLoading");const e=i.files;e.length>0&&Ae(e[0],(function(t){console.log("Preparing to process replay json..."),t.Replay.filename=e[0].name;const n=za(t);r("replayLoaded",n)}),(function(e){r("replayError"),alert(e)}))},function(e){W[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class La extends $e{constructor(e){super(),Ee(this,e,Ia,Ba,s,{})}}function qa(t){let n;return{c(){n=_("div"),n.innerHTML='<div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 110%">Loading...</div>',D(n,"id","loading"),D(n,"class","progress")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class Ua extends $e{constructor(e){super(),Ee(this,e,null,qa,s,{})}}function Va(t){let n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,w,S,E,$,A,M,j,F,T,N,R,P,z,B,I,L,q,U,V,W,H,G,X,Y,J,K,Q,Z,ee,te,ne,re,ie,ae,oe,se,le,ue,ce,fe,de,he,pe,me,ge,ye=t[0].leagueName+"",ve=t[0].homeTeam.teamName+"",be=t[0].homeTeam.coachName+"",xe=(Zt[t[0].homeTeam.raceId]||`Unknown: ${t[0].homeTeam.raceId}`)+"",we=t[0].homeTeam.score+"",_e=t[0].awayTeam.score+"",ke=t[0].awayTeam.teamName+"",Oe=t[0].awayTeam.teamName+"",Se=(Zt[t[0].awayTeam.raceId]||`Unknown: ${t[0].awayTeam.raceId}`)+"",Ee=t[0].stadiumName+"",$e=(t[0].stadiumType||"None")+"";return{c(){n=_("div"),r=_("div"),i=_("div"),a=k(t[1]),o=O(),s=_("div"),l=_("div"),u=k("League:\n      "),c=_("span"),f=k(ye),d=O(),h=_("div"),p=_("div"),m=_("div"),g=_("div"),y=_("span"),w=k(ve),S=O(),E=_("div"),$=k("Coach:\n          "),A=_("span"),M=k(be),j=O(),F=_("div"),T=k("Race:\n          "),N=_("span"),R=k(xe),P=O(),z=_("div"),B=_("span"),I=k(we),L=k("\n        -\n        "),q=_("span"),U=k(_e),V=O(),W=_("div"),H=_("div"),G=_("span"),X=k(ke),Y=O(),J=_("div"),K=k("Coach:\n          "),Q=_("span"),Z=k(Oe),ee=O(),te=_("div"),ne=k("Race:\n          "),re=_("span"),ie=k(Se),ae=O(),oe=_("div"),se=_("div"),le=k("Stadium:\n        "),ue=_("span"),ce=k(Ee),fe=O(),de=_("div"),he=_("div"),pe=k("Stadium Enhancement:\n        "),me=_("span"),ge=k($e),D(i,"class","col-sm-12"),D(r,"class","row filename svelte-ooduml"),D(c,"id","league-name"),D(l,"class","col-sm-12"),D(s,"class","row league-name svelte-ooduml"),D(y,"id","home-team"),D(g,"class","team-name home svelte-ooduml"),D(A,"id","home-coach"),D(E,"class","coach-name svelte-ooduml"),D(N,"id","home-race"),D(F,"class","race svelte-ooduml"),D(m,"class","col-sm-5 team-details team-details-left svelte-ooduml"),D(B,"id","home-score"),D(B,"class","home svelte-ooduml"),D(q,"id","away-score"),D(q,"class","away svelte-ooduml"),D(z,"class","col-sm-2 score svelte-ooduml"),D(G,"id","away-team"),D(H,"class","team-name away svelte-ooduml"),D(Q,"id","away-coach"),D(J,"class","coach-name svelte-ooduml"),D(re,"id","away-race"),D(te,"class","race svelte-ooduml"),D(W,"class","col-sm-5 team-details team-details-right svelte-ooduml"),D(p,"class","row"),D(ue,"id","stadium-name"),D(se,"class","col-sm-12"),D(oe,"class","row stadium-name svelte-ooduml"),D(me,"id","stadium-type"),D(he,"class","col-sm-12"),D(de,"class","row stadium-type svelte-ooduml"),D(h,"id","game-details"),D(n,"id","summary"),D(n,"class","container svelte-ooduml")},m(e,t){b(e,n,t),v(n,r),v(r,i),v(i,a),v(n,o),v(n,s),v(s,l),v(l,u),v(l,c),v(c,f),v(n,d),v(n,h),v(h,p),v(p,m),v(m,g),v(g,y),v(y,w),v(m,S),v(m,E),v(E,$),v(E,A),v(A,M),v(m,j),v(m,F),v(F,T),v(F,N),v(N,R),v(p,P),v(p,z),v(z,B),v(B,I),v(z,L),v(z,q),v(q,U),v(p,V),v(p,W),v(W,H),v(H,G),v(G,X),v(W,Y),v(W,J),v(J,K),v(J,Q),v(Q,Z),v(W,ee),v(W,te),v(te,ne),v(te,re),v(re,ie),v(h,ae),v(h,oe),v(oe,se),v(se,le),v(se,ue),v(ue,ce),v(h,fe),v(h,de),v(de,he),v(he,pe),v(he,me),v(me,ge)},p(e,[t]){2&t&&C(a,e[1]),1&t&&ye!==(ye=e[0].leagueName+"")&&C(f,ye),1&t&&ve!==(ve=e[0].homeTeam.teamName+"")&&C(w,ve),1&t&&be!==(be=e[0].homeTeam.coachName+"")&&C(M,be),1&t&&xe!==(xe=(Zt[e[0].homeTeam.raceId]||`Unknown: ${e[0].homeTeam.raceId}`)+"")&&C(R,xe),1&t&&we!==(we=e[0].homeTeam.score+"")&&C(I,we),1&t&&_e!==(_e=e[0].awayTeam.score+"")&&C(U,_e),1&t&&ke!==(ke=e[0].awayTeam.teamName+"")&&C(X,ke),1&t&&Oe!==(Oe=e[0].awayTeam.teamName+"")&&C(Z,Oe),1&t&&Se!==(Se=(Zt[e[0].awayTeam.raceId]||`Unknown: ${e[0].awayTeam.raceId}`)+"")&&C(ie,Se),1&t&&Ee!==(Ee=e[0].stadiumName+"")&&C(ce,Ee),1&t&&$e!==($e=(e[0].stadiumType||"None")+"")&&C(ge,$e)},i:e,o:e,d(e){e&&x(n)}}}function Wa(e,t,n){let{gameDetails:r}=t,{filename:i}=t;return e.$$set=e=>{"gameDetails"in e&&n(0,r=e.gameDetails),"filename"in e&&n(1,i=e.filename)},[r,i]}class Ha extends $e{constructor(e){super(),Ee(this,e,Wa,Va,s,{gameDetails:0,filename:1})}}function Ga(t){let n;return{c(){n=_("div"),n.innerHTML='<div class="col-sm-12"><div><h1>What am I looking at?</h1> \n      <p>Diced or Not has imported your replay, and categorized each of the dice\n        rolls how much value you got out of them, based on whether they passed\n        or failed. It also computed what value you should have expected to get\n        out of those rolls. Finally, it compared the value you got to the\n        expected value, and add up that net value across the game. You can see\n        that trend-line in the graph above.</p> \n      <p>The values attributed to the rolls are based on the following standards:</p> \n      <ul><li>Each teams player positions/activations is worth 1 per turn. This\n          means that a block that results in a knockdown for your opponent will\n          give you fractional points based on that player&#39;s TV value compared to\n          the whole team value, while getting your own player stunned would cost\n          you that same fraction, but times multiple turns.</li> \n        <li>Future player value is time-discounted to account for the uncertainty\n          of future events. So, if first turn of knockdown is worth 0.1, then\n          the second turn of a stun would be worth 0.09, the third 0.081, and so\n          on.</li> \n        <li>Player value is scaled based on vicinity to the ball and goal line.\n          So, having the ball doubles the value of your player, and marking the\n          ball multiplies the value by 1.5. Being within movement distance of\n          the endzone also multiplies player value, by larger amounts as the\n          player is closer to the endzone.</li> \n        <li>Ball-possession and fields position account for another pool of\n          points. Based on the expectation of a team taking 8 turns to score\n          once in a drive, moving the ball all the way up the field and scoring\n          a touchdown should be worth 8 points. We divide that in half: 4 points\n          for actually scoring the touchdown, and 4 points for moving the ball\n          up the field. The 4 field-position points are weighted more heavily\n          toward the endzone, and are awarded by net-position. So, moving the\n          ball one square forward gives you points equal to the value of your\n          new position minus the value of your old position.</li></ul> \n      <p>Once your game was analyzed, Diced or Not simulated rolling those same\n        sets of dice\n        <span id="game-count">0</span>\n        more times, and compared the net value of your game to the net value in\n        the simulated games. The fainter background lines show the 99th, 90th,\n        75th, 50th, 25th, 10th, and 1st percentile cumulative net-values. So, if\n        your line is above the top background line, then your game was better\n        than 99% of games with the same dice, and you most definitely were not\n        diced. If you line was below the 3rd line from the bottom, then your\n        game was worse than 3/4s of games, and you might have a slight argument\n        for having been diced.</p></div> \n    <div><h2>Terminology</h2> \n      <dl><dt id="value-def">Value</dt><dd>An abstraction of how much getting that roll result likely helped your\n          game. For example, getting a Defender Down on a Block roll would be a\n          +1 value, and getting an Attacker Down on a Block roll would be a -1\n          value (because it ends your turn). More details of the values assigned\n          are listed in the\n          <a href="#value-table">Values Table</a>.\n        </dd><dt id="expected-value-def">Expected Value</dt><dd>The average\n          <a href="value-def">Value</a>\n          over all of the possible results of a roll.\n        </dd><dt>Net Value</dt><dd>The difference between the actual value and the expected value on a\n          specific roll.\n        </dd><dt>Cumulative Net Value</dt><dd>The running total of Net Value for all the rolls taken so far by a\n          team.</dd></dl></div> \n    <div><h2>To Do</h2> \n      <div><h3>Value calculation changes</h3> \n        <ul><li>Add points when a touchdown is scored.</li> \n          <li>Count net change in points between rolls.</li> \n          <li>Handle the value of team rerolls, and the expected results of\n            rerolling.</li> \n          <li>Account for Bribe use in Fouls.</li> \n          <li>Compute player value by using actual TV values.</li> \n          <li>Adjust player value based on distance to endzone.</li> \n          <li>Include Piling-On in block expected value calculations.</li> \n          <li>Make sure armor/injury rolls make use of Mighty Blow in expected\n            value calculations.</li> \n          <li>Make sure that Claw is properly accounted for in possible outcome\n            calculations.</li> \n          <li>Make sure that Dirty Player is properly accountef for in possibel\n            outcome calculations.</li></ul></div> \n      <div><h3>Display improvements</h3> \n        <ul><li>Add thumbnails of the board state across the game.</li> \n          <li>Make the Dice logs less verbose by making player stats popups.</li> \n          <li>Display the full range of expected values and their probablities on\n            the graph.</li></ul></div></div></div>',D(n,"id","explanation"),D(n,"class","row")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class Xa extends $e{constructor(e){super(),Ee(this,e,null,Ga,s,{})}}function Ya(t){let n;return{c(){n=_("div"),n.innerHTML='<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> \n    <span class="sr-only">Error:</span>\n    Could not process saved replay data, it might be a bad URL.',D(n,"class","alert alert-danger svelte-tlpcpu"),D(n,"role","alert"),D(n,"id","data-param-error")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class Ja extends $e{constructor(e){super(),Ee(this,e,null,Ya,s,{})}}function Ka(e,t,n){const r=e.slice();return r[7]=t[n],r}function Qa(e,t,n){const r=e.slice();return r[7]=t[n],r}function Za(t){let n;return{c(){n=k(t[0])},m(e,t){b(e,n,t)},p(e,t){1&t&&C(n,e[0])},i:e,o:e,d(e){e&&x(n)}}}function eo(e){let t,n,r,i,a,o,s,l,u,c,f=e[0].values.reduce(e[5],null)+"",d=e[0].valueString+"",h=e[0].name&&io(e),p=e[1]&&ao(e);return{c(){t=_("details"),n=_("summary"),h&&h.c(),r=O(),i=k(f),a=O(),o=k(d),s=O(),p&&p.c(),t.open=e[1]},m(f,d){b(f,t,d),v(t,n),h&&h.m(n,null),v(n,r),v(n,i),v(n,a),v(n,o),v(t,s),p&&p.m(t,null),l=!0,u||(c=E(t,"click",A($(e[6]))),u=!0)},p(e,a){e[0].name?h?h.p(e,a):(h=io(e),h.c(),h.m(n,r)):h&&(h.d(1),h=null),(!l||1&a)&&f!==(f=e[0].values.reduce(e[5],null)+"")&&C(i,f),(!l||1&a)&&d!==(d=e[0].valueString+"")&&C(o,d),e[1]?p?(p.p(e,a),2&a&&fe(p,1)):(p=ao(e),p.c(),fe(p,1),p.m(t,null)):p&&(ue(),de(p,1,1,(()=>{p=null})),ce()),(!l||2&a)&&(t.open=e[1])},i(e){l||(fe(p),l=!0)},o(e){de(p),l=!1},d(e){e&&x(t),h&&h.d(),p&&p.d(),u=!1,c()}}}function to(e){let t,n;return t=new bo({props:{dist:e[0].simple}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.dist=e[0].simple),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function no(e){let t,n,r,i,a,o,s,l,u=e[0].valueString+"",c=e[0].name&&uo(e),f=e[1]&&co(e);return{c(){t=_("details"),n=_("summary"),c&&c.c(),r=O(),i=k(u),a=O(),f&&f.c(),t.open=e[1]},m(u,d){b(u,t,d),v(t,n),c&&c.m(n,null),v(n,r),v(n,i),v(t,a),f&&f.m(t,null),o=!0,s||(l=E(t,"click",A($(e[4]))),s=!0)},p(e,a){e[0].name?c?c.p(e,a):(c=uo(e),c.c(),c.m(n,r)):c&&(c.d(1),c=null),(!o||1&a)&&u!==(u=e[0].valueString+"")&&C(i,u),e[1]?f?(f.p(e,a),2&a&&fe(f,1)):(f=co(e),f.c(),fe(f,1),f.m(t,null)):f&&(ue(),de(f,1,1,(()=>{f=null})),ce()),(!o||2&a)&&(t.open=e[1])},i(e){o||(fe(f),o=!0)},o(e){de(f),o=!1},d(e){e&&x(t),c&&c.d(),f&&f.d(),s=!1,l()}}}function ro(e){let t,n,r,i;const a=[go,mo],o=[];function s(e,t){return e[0].value instanceof an?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=S()},m(e,n){o[t].m(e,n),b(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ue(),de(o[l],1,1,(()=>{o[l]=null})),ce(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),fe(n,1),n.m(r.parentNode,r))},i(e){i||(fe(n),i=!0)},o(e){de(n),i=!1},d(e){o[t].d(e),e&&x(r)}}}function io(e){let t,n,r=e[0].name+"";return{c(){t=k(r),n=k(" →")},m(e,r){b(e,t,r),b(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&C(t,r)},d(e){e&&x(t),e&&x(n)}}}function ao(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=lo(Ka(e,a,t));const s=e=>de(o[e],1,1,(()=>{o[e]=null}));return{c(){t=_("ul");for(let e=0;e<o.length;e+=1)o[e].c();D(t,"class","list-group")},m(a,s){b(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",A(e[3])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Ka(e,a,r);o[r]?(o[r].p(i,n),fe(o[r],1)):(o[r]=lo(i),o[r].c(),fe(o[r],1),o[r].m(t,null))}for(ue(),r=a.length;r<o.length;r+=1)s(r);ce()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)fe(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)de(o[e]);n=!1},d(e){e&&x(t),w(o,e),r=!1,i()}}}function oo(t){let n,r,i,a=t[7].toFixed(2)+"";return{c(){n=_("li"),r=k(a),i=O(),D(n,"class","list-group-item list-group-item-action")},m(e,t){b(e,n,t),v(n,r),v(n,i)},p(e,t){1&t&&a!==(a=e[7].toFixed(2)+"")&&C(r,a)},i:e,o:e,d(e){e&&x(n)}}}function so(e){let t,n,r,i;return n=new bo({props:{dist:e[7]}}),{c(){t=_("li"),ke(n.$$.fragment),r=O(),D(t,"class","list-group-item list-group-item-action")},m(e,a){b(e,t,a),Oe(n,t,null),v(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7]),n.$set(r)},i(e){i||(fe(n.$$.fragment,e),i=!0)},o(e){de(n.$$.fragment,e),i=!1},d(e){e&&x(t),Se(n)}}}function lo(e){let t,n,r,i;const a=[so,oo],o=[];function s(e,t){return e[7]instanceof an?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=S()},m(e,n){o[t].m(e,n),b(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ue(),de(o[l],1,1,(()=>{o[l]=null})),ce(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),fe(n,1),n.m(r.parentNode,r))},i(e){i||(fe(n),i=!0)},o(e){de(n),i=!1},d(e){o[t].d(e),e&&x(r)}}}function uo(e){let t,n,r=e[0].name+"";return{c(){t=k(r),n=k(" →")},m(e,r){b(e,t,r),b(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&C(t,r)},d(e){e&&x(t),e&&x(n)}}}function co(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=po(Qa(e,a,t));const s=e=>de(o[e],1,1,(()=>{o[e]=null}));return{c(){t=_("ul");for(let e=0;e<o.length;e+=1)o[e].c();D(t,"class","list-group")},m(a,s){b(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",A(e[2])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Qa(e,a,r);o[r]?(o[r].p(i,n),fe(o[r],1)):(o[r]=po(i),o[r].c(),fe(o[r],1),o[r].m(t,null))}for(ue(),r=a.length;r<o.length;r+=1)s(r);ce()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)fe(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)de(o[e]);n=!1},d(e){e&&x(t),w(o,e),r=!1,i()}}}function fo(t){let n,r,i,a,o,s,l,u=(100*t[7].weight).toFixed(1)+"",c=t[7].name+"",f=t[7].value+"";return{c(){n=_("li"),r=k(u),i=k("%:\n              "),a=k(c),o=k("\n              →\n              "),s=k(f),l=O(),D(n,"class","list-group-item list-group-item-action")},m(e,t){b(e,n,t),v(n,r),v(n,i),v(n,a),v(n,o),v(n,s),v(n,l)},p(e,t){1&t&&u!==(u=(100*e[7].weight).toFixed(1)+"")&&C(r,u),1&t&&c!==(c=e[7].name+"")&&C(a,c),1&t&&f!==(f=e[7].value+"")&&C(s,f)},i:e,o:e,d(e){e&&x(n)}}}function ho(e){let t,n,r,i;return n=new bo({props:{dist:e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)}}),{c(){t=_("li"),ke(n.$$.fragment),r=O(),D(t,"class","list-group-item list-group-item-action")},m(e,a){b(e,t,a),Oe(n,t,null),v(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)),n.$set(r)},i(e){i||(fe(n.$$.fragment,e),i=!0)},o(e){de(n.$$.fragment,e),i=!1},d(e){e&&x(t),Se(n)}}}function po(e){let t,n,r,i;const a=[ho,fo],o=[];function s(e,t){return e[7].value instanceof an?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=S()},m(e,n){o[t].m(e,n),b(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(ue(),de(o[l],1,1,(()=>{o[l]=null})),ce(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),fe(n,1),n.m(r.parentNode,r))},i(e){i||(fe(n),i=!0)},o(e){de(n),i=!1},d(e){o[t].d(e),e&&x(r)}}}function mo(t){let n,r,i,a=t[0].name+"",o=t[0].valueString+"";return{c(){n=k(a),r=O(),i=k(o)},m(e,t){b(e,n,t),b(e,r,t),b(e,i,t)},p(e,t){1&t&&a!==(a=e[0].name+"")&&C(n,a),1&t&&o!==(o=e[0].valueString+"")&&C(i,o)},i:e,o:e,d(e){e&&x(n),e&&x(r),e&&x(i)}}}function go(e){let t,n,r;return t=new bo({props:{dist:e[0].value.named(e[0].name)}}),{c(){ke(t.$$.fragment),n=k(";")},m(e,i){Oe(t,e,i),b(e,n,i),r=!0},p(e,n){const r={};1&n&&(r.dist=e[0].value.named(e[0].name)),t.$set(r)},i(e){r||(fe(t.$$.fragment,e),r=!0)},o(e){de(t.$$.fragment,e),r=!1},d(e){Se(t,e),e&&x(n)}}}function yo(e){let t,n,r,i;const a=[ro,no,to,eo,Za],o=[];function s(e,t){return e[0]instanceof sn?0:e[0]instanceof on?1:e[0]instanceof hn?2:e[0]instanceof ln?3:4}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=S()},m(e,n){o[t].m(e,n),b(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(ue(),de(o[l],1,1,(()=>{o[l]=null})),ce(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),fe(n,1),n.m(r.parentNode,r))},i(e){i||(fe(n),i=!0)},o(e){de(n),i=!1},d(e){o[t].d(e),e&&x(r)}}}function vo(e,t,n){let{dist:r}=t,i=!1;return e.$$set=e=>{"dist"in e&&n(0,r=e.dist)},[r,i,function(t){U(e,t)},function(t){U(e,t)},()=>n(1,i=!i),(e,t)=>e?r.nameFunc(e,t.name||t):t.name,()=>n(1,i=!i)]}class bo extends $e{constructor(e){super(),Ee(this,e,vo,yo,s,{dist:0})}}function xo(e,t,n){const r=e.slice();return r[8]=t[n],r}function wo(e){let t,n,r,i,o,s,l,u,c,f,d,h=e[3]&&_o(e);return u=new bo({props:{dist:e[0].possibleOutcomes.named("Possible Outcomes")}}),{c(){t=_("ul"),n=_("li"),r=_("details"),i=_("summary"),i.textContent="Actual Outcomes",o=O(),h&&h.c(),s=O(),l=_("li"),ke(u.$$.fragment),r.open=e[3],D(n,"class","list-group-item list-group-item-action"),D(l,"class","list-group-item list-group-item-action"),D(t,"class","list-group")},m(a,p){b(a,t,p),v(t,n),v(n,r),v(r,i),v(r,o),h&&h.m(r,null),v(t,s),v(t,l),Oe(u,l,null),c=!0,f||(d=[E(r,"click",A($(e[6]))),E(t,"click",A(e[4]))],f=!0)},p(e,t){e[3]?h?(h.p(e,t),8&t&&fe(h,1)):(h=_o(e),h.c(),fe(h,1),h.m(r,null)):h&&(ue(),de(h,1,1,(()=>{h=null})),ce()),(!c||8&t)&&(r.open=e[3]);const n={};1&t&&(n.dist=e[0].possibleOutcomes.named("Possible Outcomes")),u.$set(n)},i(e){c||(fe(h),fe(u.$$.fragment,e),c=!0)},o(e){de(h),de(u.$$.fragment,e),c=!1},d(e){e&&x(t),h&&h.d(),Se(u),f=!1,a(d)}}}function _o(e){let t,n,r,i,a=e[1],o=[];for(let t=0;t<a.length;t+=1)o[t]=ko(xo(e,a,t));const s=e=>de(o[e],1,1,(()=>{o[e]=null}));return{c(){t=_("ul");for(let e=0;e<o.length;e+=1)o[e].c();D(t,"class","list-group")},m(a,s){b(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=E(t,"click",A(e[5])),r=!0)},p(e,n){if(2&n){let r;for(a=e[1],r=0;r<a.length;r+=1){const i=xo(e,a,r);o[r]?(o[r].p(i,n),fe(o[r],1)):(o[r]=ko(i),o[r].c(),fe(o[r],1),o[r].m(t,null))}for(ue(),r=a.length;r<o.length;r+=1)s(r);ce()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)fe(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)de(o[e]);n=!1},d(e){e&&x(t),w(o,e),r=!1,i()}}}function ko(e){let t,n,r,i;return n=new bo({props:{dist:e[8]}}),{c(){t=_("li"),ke(n.$$.fragment),r=O(),D(t,"class","list-group-item list-group-item-action")},m(e,a){b(e,t,a),Oe(n,t,null),v(t,r),i=!0},p(e,t){const r={};2&t&&(r.dist=e[8]),n.$set(r)},i(e){i||(fe(n.$$.fragment,e),i=!0)},o(e){de(n.$$.fragment,e),i=!1},d(e){e&&x(t),Se(n)}}}function Oo(e){let t,n,r,i,a,o,s,l,u,c,f,d,h=e[0].jointDescription+"",p=e[0].valueWithDependents.valueString+"",m=e[0].possibleOutcomes.valueString+"",g=e[2]&&wo(e);return{c(){t=_("details"),n=_("summary"),r=k(h),i=O(),a=k(p),o=O(),s=k(m),l=O(),g&&g.c(),t.open=e[2],D(t,"id",u="roll-"+e[0].rollIndex)},m(u,h){b(u,t,h),v(t,n),v(n,r),v(n,i),v(n,a),v(n,o),v(n,s),v(t,l),g&&g.m(t,null),c=!0,f||(d=E(t,"click",A($(e[7]))),f=!0)},p(e,[n]){(!c||1&n)&&h!==(h=e[0].jointDescription+"")&&C(r,h),(!c||1&n)&&p!==(p=e[0].valueWithDependents.valueString+"")&&C(a,p),(!c||1&n)&&m!==(m=e[0].possibleOutcomes.valueString+"")&&C(s,m),e[2]?g?(g.p(e,n),4&n&&fe(g,1)):(g=wo(e),g.c(),fe(g,1),g.m(t,null)):g&&(ue(),de(g,1,1,(()=>{g=null})),ce()),(!c||4&n)&&(t.open=e[2]),(!c||1&n&&u!==(u="roll-"+e[0].rollIndex))&&D(t,"id",u)},i(e){c||(fe(g),c=!0)},o(e){de(g),c=!1},d(e){e&&x(t),g&&g.d(),f=!1,d()}}}function So(e,t,n){let r,{roll:i}=t,a=!1,o=!1;return e.$$set=e=>{"roll"in e&&n(0,i=e.roll)},e.$$.update=()=>{1&e.$$.dirty&&n(1,r=[i,...i.dependentRolls].map((e=>{const t=e.actualValue;return t.name?t.named(`${e.shortDescription} - ${t.name}`):t.named(e.shortDescription)})))},[i,r,a,o,function(t){U(e,t)},function(t){U(e,t)},()=>n(3,o=!o),()=>n(2,a=!a)]}class Eo extends $e{constructor(e){super(),Ee(this,e,So,Oo,s,{roll:0})}}function $o(e,t,n){const r=e.slice();return r[7]=t[n],r[8]=t,r[9]=n,r}function Ao(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[7].rollIndex;for(let t=0;t<s.length;t+=1){let n=$o(e,s,t),r=l(n);o.set(r,a[t]=Do(r,n))}return{c(){t=_("ul");for(let e=0;e<a.length;e+=1)a[e].c();D(t,"class","list-group")},m(o,s){b(o,t,s);for(let e=0;e<a.length;e+=1)a[e].m(t,null);n=!0,r||(i=E(t,"click",A(e[3])),r=!0)},p(e,n){if(3&n){const r=e[0];ue(),a=be(a,n,l,1,e,r,o,t,ve,Do,null,$o),ce()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)fe(a[e]);n=!0}},o(e){for(let e=0;e<a.length;e+=1)de(a[e]);n=!1},d(e){e&&x(t);for(let e=0;e<a.length;e+=1)a[e].d();r=!1,i()}}}function Do(e,t){let n,r,i,a,o,s,l;function u(e){t[4].call(null,e,t[7])}let c={roll:t[7]};function f(){return t[5](t[7],t[8],t[9])}return void 0!==t[7].open&&(c.open=t[7].open),r=new Eo({props:c}),W.push((()=>_e(r,"open",u))),{key:e,first:null,c(){n=_("li"),ke(r.$$.fragment),a=O(),D(n,"class","list-group-item list-group-item-action"),j(n,"active",t[1]==t[7].rollIndex),this.first=n},m(e,t){b(e,n,t),Oe(r,n,null),v(n,a),o=!0,s||(l=E(n,"click",A(f)),s=!0)},p(e,a){t=e;const o={};1&a&&(o.roll=t[7]),!i&&1&a&&(i=!0,o.open=t[7].open,Z((()=>i=!1))),r.$set(o),3&a&&j(n,"active",t[1]==t[7].rollIndex)},i(e){o||(fe(r.$$.fragment,e),o=!0)},o(e){de(r.$$.fragment,e),o=!1},d(e){e&&x(n),Se(r),s=!1,l()}}}function Co(e){let t,n,r,i,a,o,s,l,u,c=e[0][0].activeTeam.name+"",f=e[0][0].turn+"",d=e[2]&&Ao(e);return{c(){t=_("details"),n=_("summary"),r=k(c),i=k(" - Turn "),a=k(f),o=O(),d&&d.c(),t.open=e[2]},m(c,f){b(c,t,f),v(t,n),v(n,r),v(n,i),v(n,a),v(t,o),d&&d.m(t,null),s=!0,l||(u=E(t,"click",A($(e[6]))),l=!0)},p(e,[n]){(!s||1&n)&&c!==(c=e[0][0].activeTeam.name+"")&&C(r,c),(!s||1&n)&&f!==(f=e[0][0].turn+"")&&C(a,f),e[2]?d?(d.p(e,n),4&n&&fe(d,1)):(d=Ao(e),d.c(),fe(d,1),d.m(t,null)):d&&(ue(),de(d,1,1,(()=>{d=null})),ce()),(!s||4&n)&&(t.open=e[2])},i(e){s||(fe(d),s=!0)},o(e){de(d),s=!1},d(e){e&&x(t),d&&d.d(),l=!1,u()}}}function Mo(e,t,n){let{rolls:r}=t,{selectedRoll:i}=t,a=!1;return e.$$set=e=>{"rolls"in e&&n(0,r=e.rolls),"selectedRoll"in e&&n(1,i=e.selectedRoll)},e.$$.update=()=>{7&e.$$.dirty&&n(2,a=a||r&&i&&i>=r[0].rollIndex&&i<=r[r.length-1].rollIndex)},[r,i,a,function(t){U(e,t)},function(e,t){t.open=e,n(0,r)},(e,t,i)=>n(0,t[i].open=!e.open,r),()=>n(2,a=!a)]}class jo extends $e{constructor(e){super(),Ee(this,e,Mo,Co,s,{rolls:0,selectedRoll:1})}}function Fo(e,t,n){const r=e.slice();return r[0]=t[n],r[8]=t,r[9]=n,r}function To(e,t){let n,r,i,a,o,s,l;function u(e){t[4].call(null,e,t[0])}let c={rolls:t[0],selectedRoll:t[1]};function f(){return t[5](t[0],t[8],t[9])}return void 0!==t[0].open&&(c.open=t[0].open),r=new jo({props:c}),W.push((()=>_e(r,"open",u))),{key:e,first:null,c(){n=_("li"),ke(r.$$.fragment),a=O(),D(n,"class","list-group-item list-group-item-action"),this.first=n},m(e,t){b(e,n,t),Oe(r,n,null),v(n,a),o=!0,s||(l=E(n,"click",A(f)),s=!0)},p(e,n){t=e;const a={};4&n&&(a.rolls=t[0]),2&n&&(a.selectedRoll=t[1]),!i&&4&n&&(i=!0,a.open=t[0].open,Z((()=>i=!1))),r.$set(a)},i(e){o||(fe(r.$$.fragment,e),o=!0)},o(e){de(r.$$.fragment,e),o=!1},d(e){e&&x(n),Se(r),s=!1,l()}}}function No(e){let t,n,r,i=[],a=new Map,o=e[2];const s=e=>e[0][0].rollIndex;for(let t=0;t<o.length;t+=1){let n=Fo(e,o,t),r=s(n);a.set(r,i[t]=To(r,n))}return{c(){t=_("div"),n=_("ul");for(let e=0;e<i.length;e+=1)i[e].c();D(t,"class","details-list")},m(e,a){b(e,t,a),v(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);r=!0},p(e,[t]){if(6&t){const r=e[2];ue(),i=be(i,t,s,1,e,r,a,n,ve,To,null,Fo),ce()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)fe(i[e]);r=!0}},o(e){for(let e=0;e<i.length;e+=1)de(i[e]);r=!1},d(e){e&&x(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function Ro(e,t,n){let r,i,{rolls:a}=t,{replayStepIndex:o}=t;return e.$$set=e=>{"rolls"in e&&n(0,a=e.rolls),"replayStepIndex"in e&&n(3,o=e.replayStepIndex)},e.$$.update=()=>{if(11&e.$$.dirty){let e=a.findIndex((e=>o<e.stepIndex));n(1,i=e>0?a[e-1].rollIndex:0),function(e,t){n(2,r=e.reduce(((e,t)=>{const n=e[e.length-1],r=n&&n[n.length-1];return n&&r&&r.activeTeam.id==t.activeTeam.id&&r.turn==t.turn?n.push(t):e.push([t]),e}),[]))}(a)}},[a,i,r,o,function(e,t){t.open=e,n(2,r)},(e,t,i)=>n(2,t[i].open=!e.open,r)]}class Po extends $e{constructor(e){super(),Ee(this,e,Ro,No,s,{rolls:0,replayStepIndex:3})}}
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */var zo,Bo=(zo=function(e,t){return(zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}zo(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Io=Object.prototype.hasOwnProperty;function Lo(e,t){return Io.call(e,t)}function qo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)Lo(e,r)&&t.push(r);return t}function Uo(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Vo(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function Wo(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Ho(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Go(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Go(e[t]))return!0}else if("object"==typeof e){var r=qo(e),i=r.length;for(t=0;t<i;t++)if(Go(e[r[t]]))return!0}return!1}function Xo(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var Yo=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,Xo(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=Xo(t,{name:n,index:r,operation:i,tree:a}),s}return Bo(t,e),t}(Error),Jo=Yo,Ko=Uo,Qo={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=es(n,this.path);r&&(r=Uo(r));var i=ts(n,{op:"remove",path:this.from}).removed;return ts(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=es(n,this.from);return ts(n,{op:"add",path:this.path,value:Uo(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:as(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Zo={add:function(e,t,n){return Vo(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Qo.move,copy:Qo.copy,test:Qo.test,_get:Qo._get};function es(e,t){if(""==t)return e;var n={op:"_get",path:t};return ts(e,n),n.value}function ts(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):rs(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=es(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=as(e,t.value),!1===o.test)throw new Jo("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new Jo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=Uo(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,f=void 0,d=void 0,h=void 0;for(h="function"==typeof n?n:rs;;){if(d=s[u],i&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===l[d]?f=s.slice(0,u).join("/"):u==c-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(n&&!Vo(d))throw new Jo("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Vo(d)&&(d=~~d)}if(u>=c){if(n&&"add"===t.op&&d>l.length)throw new Jo("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=Zo[t.op].call(t,l,d,e)).test)throw new Jo("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(d&&-1!=d.indexOf("~")&&(d=Ho(d)),u>=c){if(!1===(o=Qo[t.op].call(t,l,d,e)).test)throw new Jo("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[d]}}function ns(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new Jo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Uo(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=ts(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function rs(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new Jo("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Qo[e.op])throw new Jo("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new Jo("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new Jo('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new Jo("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new Jo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Go(e.value))throw new Jo("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new Jo("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new Jo("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=is([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new Jo("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function is(e,t,n){try{if(!Array.isArray(e))throw new Jo("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ns(Uo(t),Uo(e),n||!0);else{n=n||rs;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof Jo)return e;throw e}}function as(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!as(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!as(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var os=Object.freeze({__proto__:null,JsonPatchError:Jo,deepClone:Ko,getValueByPointer:es,applyOperation:ts,applyPatch:ns,applyReducer:function(e,t,n){var r=ts(e,t);if(!1===r.test)throw new Jo("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument},validator:rs,validate:is,_areEquals:as}),ss=new WeakMap,ls=function(e){this.observers=new Map,this.obj=e},us=function(e,t){this.callback=e,this.observer=t};
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */function cs(e,t){void 0===t&&(t=!1);var n=ss.get(e.object);fs(n.value,e.object,e.patches,"",t),e.patches.length&&ns(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function fs(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=qo(t),o=qo(e),s=!1,l=o.length-1;l>=0;l--){var u=e[f=o[l]];if(!Lo(t,f)||void 0===t[f]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+Wo(f),value:Uo(u)}),n.push({op:"remove",path:r+"/"+Wo(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[f];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?fs(u,c,n,r+"/"+Wo(f),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+Wo(f),value:Uo(u)}),n.push({op:"replace",path:r+"/"+Wo(f),value:Uo(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var f;Lo(e,f=a[l])||void 0===t[f]||n.push({op:"add",path:r+"/"+Wo(f),value:Uo(t[f])})}}}var ds=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){return ss.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new ls(e),ss.set(e,r);if(n)return n;if(n={},r.value=Uo(e),t){n.callback=t,n.next=null;var a=function(){cs(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){cs(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new us(t,n)),n},generate:cs,compare:function(e,t,n){void 0===n&&(n=!1);var r=[];return fs(e,t,r,"",n),r}});Object.assign({},os,ds,{JsonPatchError:Yo,deepClone:Uo,escapePathComponent:Wo,unescapePathComponent:Ho});var hs=/("(?:[^\\"]|\\.)*")|[:,]/g,ps=function(e,t){var n,r,i;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),r=""===n?1/0:void 0===t.maxLength?80:t.maxLength,i=t.replacer,function e(t,a,o){var s,l,u,c,f,d,h,p,m,g,y,v;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,i)))return y;if(h=r-a.length-o,y.length<=h&&(m=y.replace(hs,(function(e,t){return t||e+" "}))).length<=h)return m;if(null!=i&&(t=JSON.parse(y),i=void 0),"object"==typeof t&&null!==t){if(p=a+n,u=[],l=0,Array.isArray(t))for(g="[",s="]",h=t.length;l<h;l++)u.push(e(t[l],p,l===h-1?0:1)||"null");else for(g="{",s="}",h=(d=Object.keys(t)).length;l<h;l++)c=d[l],f=JSON.stringify(c)+": ",void 0!==(v=e(t[c],p,f.length+(l===h-1?0:1)))&&u.push(f+v);if(u.length>0)return[g,n+u.join(",\n"+p),s].join("\n"+a)}return y}(e,"",0)};function ms(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var gs={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var ys="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},vs=ms((function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=gs,r=(t=e.exports={}).re=[],i=t.src=[],a=t.t={};let o=0;const s=(e,t,n)=>{const s=o++;ys(s,t),a[e]=s,i[s]=t,r[s]=new RegExp(t,n?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),s("FULL",`^${i[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),s("LOOSE",`^${i[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),s("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",i[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));const bs=["includePrerelease","loose","rtl"];var xs=e=>e?"object"!=typeof e?{loose:!0}:bs.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const ws=/^[0-9]+$/,_s=(e,t)=>{const n=ws.test(e),r=ws.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var ks={compareIdentifiers:_s,rcompareIdentifiers:(e,t)=>_s(t,e)};const{MAX_LENGTH:Os,MAX_SAFE_INTEGER:Ss}=gs,{re:Es,t:$s}=vs,{compareIdentifiers:As}=ks;class Ds{constructor(e,t){if(t=xs(t),e instanceof Ds){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>Os)throw new TypeError(`version is longer than ${Os} characters`);ys("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?Es[$s.LOOSE]:Es[$s.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Ss||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ss||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ss||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Ss)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ys("SemVer.compare",this.version,this.options,e),!(e instanceof Ds)){if("string"==typeof e&&e===this.version)return 0;e=new Ds(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ds||(e=new Ds(e,this.options)),As(this.major,e.major)||As(this.minor,e.minor)||As(this.patch,e.patch)}comparePre(e){if(e instanceof Ds||(e=new Ds(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(ys("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return As(n,r)}while(++t)}compareBuild(e){e instanceof Ds||(e=new Ds(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(ys("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return As(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Cs=Ds;const{MAX_LENGTH:Ms}=gs,{re:js,t:Fs}=vs;var Ts=(e,t)=>{if(t=xs(t),e instanceof Cs)return e;if("string"!=typeof e)return null;if(e.length>Ms)return null;if(!(t.loose?js[Fs.LOOSE]:js[Fs.FULL]).test(e))return null;try{return new Cs(e,t)}catch(e){return null}};var Ns=(e,t)=>{const n=Ts(e,t);return n?n.version:null};var Rs=(e,t)=>{const n=Ts(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var Ps=(e,t,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new Cs(e,n).inc(t,r).version}catch(e){return null}};var zs=(e,t,n)=>new Cs(e,n).compare(new Cs(t,n));var Bs=(e,t,n)=>0===zs(e,t,n);var Is=(e,t)=>{if(Bs(e,t))return null;{const n=Ts(e),r=Ts(t),i=n.prerelease.length||r.prerelease.length,a=i?"pre":"",o=i?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return a+e;return o}};var Ls=(e,t)=>new Cs(e,t).major;var qs=(e,t)=>new Cs(e,t).minor;var Us=(e,t)=>new Cs(e,t).patch;var Vs=(e,t)=>{const n=Ts(e,t);return n&&n.prerelease.length?n.prerelease:null};var Ws=(e,t,n)=>zs(t,e,n);var Hs=(e,t)=>zs(e,t,!0);var Gs=(e,t,n)=>{const r=new Cs(e,n),i=new Cs(t,n);return r.compare(i)||r.compareBuild(i)};var Xs=(e,t)=>e.sort(((e,n)=>Gs(e,n,t)));var Ys=(e,t)=>e.sort(((e,n)=>Gs(n,e,t)));var Js=(e,t,n)=>zs(e,t,n)>0;var Ks=(e,t,n)=>zs(e,t,n)<0;var Qs=(e,t,n)=>0!==zs(e,t,n);var Zs=(e,t,n)=>zs(e,t,n)>=0;var el=(e,t,n)=>zs(e,t,n)<=0;var tl=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Bs(e,n,r);case"!=":return Qs(e,n,r);case">":return Js(e,n,r);case">=":return Zs(e,n,r);case"<":return Ks(e,n,r);case"<=":return el(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const{re:nl,t:rl}=vs;var il=(e,t)=>{if(e instanceof Cs)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=nl[rl.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),nl[rl.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;nl[rl.COERCERTL].lastIndex=-1}else n=e.match(nl[rl.COERCE]);return null===n?null:Ts(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)},al=ol;function ol(e){var t=this;if(t instanceof ol||(t=new ol),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}function sl(e,t,n){var r=t===e.head?new cl(n,null,t,e):new cl(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function ll(e,t){e.tail=new cl(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function ul(e,t){e.head=new cl(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function cl(e,t,n,r){if(!(this instanceof cl))return new cl(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}ol.Node=cl,ol.create=ol,ol.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},ol.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},ol.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},ol.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)ll(this,arguments[e]);return this.length},ol.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)ul(this,arguments[e]);return this.length},ol.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},ol.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},ol.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},ol.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},ol.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},ol.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},ol.prototype.map=function(e,t){t=t||this;for(var n=new ol,r=this.head;null!==r;)n.push(e.call(t,r.value,this)),r=r.next;return n},ol.prototype.mapReverse=function(e,t){t=t||this;for(var n=new ol,r=this.tail;null!==r;)n.push(e.call(t,r.value,this)),r=r.prev;return n},ol.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},ol.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},ol.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},ol.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},ol.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new ol;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;for(;null!==i&&r<t;r++,i=i.next)n.push(i.value);return n},ol.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new ol;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;null!==i&&r>t;r--)i=i.prev;for(;null!==i&&r>e;r--,i=i.prev)n.push(i.value);return n},ol.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;var a=[];for(r=0;i&&r<t;r++)a.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(r=0;r<n.length;r++)i=sl(this,i,n[r]);return a},ol.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(ol)}catch(e){}const fl=Symbol("max"),dl=Symbol("length"),hl=Symbol("lengthCalculator"),pl=Symbol("allowStale"),ml=Symbol("maxAge"),gl=Symbol("dispose"),yl=Symbol("noDisposeOnSet"),vl=Symbol("lruList"),bl=Symbol("cache"),xl=Symbol("updateAgeOnGet"),wl=()=>1;const _l=(e,t,n)=>{const r=e[bl].get(t);if(r){const t=r.value;if(kl(e,t)){if(Sl(e,r),!e[pl])return}else n&&(e[xl]&&(r.value.now=Date.now()),e[vl].unshiftNode(r));return t.value}},kl=(e,t)=>{if(!t||!t.maxAge&&!e[ml])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[ml]&&n>e[ml]},Ol=e=>{if(e[dl]>e[fl])for(let t=e[vl].tail;e[dl]>e[fl]&&null!==t;){const n=t.prev;Sl(e,t),t=n}},Sl=(e,t)=>{if(t){const n=t.value;e[gl]&&e[gl](n.key,n.value),e[dl]-=n.length,e[bl].delete(n.key),e[vl].removeNode(t)}};class El{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const $l=(e,t,n,r)=>{let i=n.value;kl(e,i)&&(Sl(e,n),e[pl]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var Al=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[fl]=e.max||1/0;const t=e.length||wl;if(this[hl]="function"!=typeof t?wl:t,this[pl]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[ml]=e.maxAge||0,this[gl]=e.dispose,this[yl]=e.noDisposeOnSet||!1,this[xl]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[fl]=e||1/0,Ol(this)}get max(){return this[fl]}set allowStale(e){this[pl]=!!e}get allowStale(){return this[pl]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[ml]=e,Ol(this)}get maxAge(){return this[ml]}set lengthCalculator(e){"function"!=typeof e&&(e=wl),e!==this[hl]&&(this[hl]=e,this[dl]=0,this[vl].forEach((e=>{e.length=this[hl](e.value,e.key),this[dl]+=e.length}))),Ol(this)}get lengthCalculator(){return this[hl]}get length(){return this[dl]}get itemCount(){return this[vl].length}rforEach(e,t){t=t||this;for(let n=this[vl].tail;null!==n;){const r=n.prev;$l(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[vl].head;null!==n;){const r=n.next;$l(this,e,n,t),n=r}}keys(){return this[vl].toArray().map((e=>e.key))}values(){return this[vl].toArray().map((e=>e.value))}reset(){this[gl]&&this[vl]&&this[vl].length&&this[vl].forEach((e=>this[gl](e.key,e.value))),this[bl]=new Map,this[vl]=new al,this[dl]=0}dump(){return this[vl].map((e=>!kl(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[vl]}set(e,t,n){if((n=n||this[ml])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[hl](t,e);if(this[bl].has(e)){if(i>this[fl])return Sl(this,this[bl].get(e)),!1;const a=this[bl].get(e).value;return this[gl]&&(this[yl]||this[gl](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[dl]+=i-a.length,a.length=i,this.get(e),Ol(this),!0}const a=new El(e,t,i,r,n);return a.length>this[fl]?(this[gl]&&this[gl](e,t),!1):(this[dl]+=a.length,this[vl].unshift(a),this[bl].set(e,this[vl].head),Ol(this),!0)}has(e){if(!this[bl].has(e))return!1;const t=this[bl].get(e).value;return!kl(this,t)}get(e){return _l(this,e,!0)}peek(e){return _l(this,e,!1)}pop(){const e=this[vl].tail;return e?(Sl(this,e),e.value):null}del(e){Sl(this,this[bl].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[bl].forEach(((e,t)=>_l(this,t,!1)))}};class Dl{constructor(e,t){if(t=xs(t),e instanceof Dl)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Dl(e.raw,t);if(e instanceof eu)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!Pl(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&zl(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=Ml.get(t);if(n)return n;const r=this.options.loose,i=r?jl[Fl.HYPHENRANGELOOSE]:jl[Fl.HYPHENRANGE];e=e.replace(i,Jl(this.options.includePrerelease)),ys("hyphen replace",e),e=e.replace(jl[Fl.COMPARATORTRIM],Tl),ys("comparator trim",e,jl[Fl.COMPARATORTRIM]),e=(e=(e=e.replace(jl[Fl.TILDETRIM],Nl)).replace(jl[Fl.CARETTRIM],Rl)).split(/\s+/).join(" ");const a=r?jl[Fl.COMPARATORLOOSE]:jl[Fl.COMPARATOR],o=e.split(" ").map((e=>Il(e,this.options))).join(" ").split(/\s+/).map((e=>Yl(e,this.options))).filter(this.options.loose?e=>!!e.match(a):()=>!0).map((e=>new eu(e,this.options))),s=(o.length,new Map);for(const e of o){if(Pl(e))return[e];s.set(e.value,e)}s.size>1&&s.has("")&&s.delete("");const l=[...s.values()];return Ml.set(t,l),l}intersects(e,t){if(!(e instanceof Dl))throw new TypeError("a Range is required");return this.set.some((n=>Bl(n,t)&&e.set.some((e=>Bl(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Cs(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Kl(this.set[t],e,this.options))return!0;return!1}}var Cl=Dl;const Ml=new Al({max:1e3}),{re:jl,t:Fl,comparatorTrimReplace:Tl,tildeTrimReplace:Nl,caretTrimReplace:Rl}=vs,Pl=e=>"<0.0.0-0"===e.value,zl=e=>""===e.value,Bl=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},Il=(e,t)=>(ys("comp",e,t),e=Vl(e,t),ys("caret",e),e=ql(e,t),ys("tildes",e),e=Hl(e,t),ys("xrange",e),e=Xl(e,t),ys("stars",e),e),Ll=e=>!e||"x"===e.toLowerCase()||"*"===e,ql=(e,t)=>e.trim().split(/\s+/).map((e=>Ul(e,t))).join(" "),Ul=(e,t)=>{const n=t.loose?jl[Fl.TILDELOOSE]:jl[Fl.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return ys("tilde",e,t,n,r,i,a),Ll(n)?o="":Ll(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:Ll(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(ys("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,ys("tilde return",o),o}))},Vl=(e,t)=>e.trim().split(/\s+/).map((e=>Wl(e,t))).join(" "),Wl=(e,t)=>{ys("caret",e,t);const n=t.loose?jl[Fl.CARETLOOSE]:jl[Fl.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let s;return ys("caret",e,t,n,i,a,o),Ll(n)?s="":Ll(i)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:Ll(a)?s="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(ys("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(ys("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),ys("caret return",s),s}))},Hl=(e,t)=>(ys("replaceXRanges",e,t),e.split(/\s+/).map((e=>Gl(e,t))).join(" ")),Gl=(e,t)=>{e=e.trim();const n=t.loose?jl[Fl.XRANGELOOSE]:jl[Fl.XRANGE];return e.replace(n,((n,r,i,a,o,s)=>{ys("xRange",e,n,r,i,a,o,s);const l=Ll(i),u=l||Ll(a),c=u||Ll(o),f=c;return"="===r&&f&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&f?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(s="-0"),n=`${r+i}.${a}.${o}${s}`):u?n=`>=${i}.0.0${s} <${+i+1}.0.0-0`:c&&(n=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`),ys("xRange return",n),n}))},Xl=(e,t)=>(ys("replaceStars",e,t),e.trim().replace(jl[Fl.STAR],"")),Yl=(e,t)=>(ys("replaceGTE0",e,t),e.trim().replace(jl[t.includePrerelease?Fl.GTE0PRE:Fl.GTE0],"")),Jl=e=>(t,n,r,i,a,o,s,l,u,c,f,d,h)=>`${n=Ll(r)?"":Ll(i)?`>=${r}.0.0${e?"-0":""}`:Ll(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=Ll(u)?"":Ll(c)?`<${+u+1}.0.0-0`:Ll(f)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${f}-${d}`:e?`<${u}.${c}.${+f+1}-0`:`<=${l}`}`.trim(),Kl=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(ys(e[n].semver),e[n].semver!==eu.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},Ql=Symbol("SemVer ANY");class Zl{static get ANY(){return Ql}constructor(e,t){if(t=xs(t),e instanceof Zl){if(e.loose===!!t.loose)return e;e=e.value}ys("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ql?this.value="":this.value=this.operator+this.semver.version,ys("comp",this)}parse(e){const t=this.options.loose?tu[nu.COMPARATORLOOSE]:tu[nu.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new Cs(n[2],this.options.loose):this.semver=Ql}toString(){return this.value}test(e){if(ys("Comparator.test",e,this.options.loose),this.semver===Ql||e===Ql)return!0;if("string"==typeof e)try{e=new Cs(e,this.options)}catch(e){return!1}return tl(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Zl))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new Cl(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new Cl(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=tl(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),s=tl(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||i&&a||o||s}}var eu=Zl;const{re:tu,t:nu}=vs;var ru=(e,t,n)=>{try{t=new Cl(t,n)}catch(e){return!1}return t.test(e)};var iu=(e,t)=>new Cl(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));var au=(e,t,n)=>{let r=null,i=null,a=null;try{a=new Cl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new Cs(r,n)))})),r};var ou=(e,t,n)=>{let r=null,i=null,a=null;try{a=new Cl(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new Cs(r,n)))})),r};var su=(e,t)=>{e=new Cl(e,t);let n=new Cs("0.0.0");if(e.test(n))return n;if(n=new Cs("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let i=null;r.forEach((e=>{const t=new Cs(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!Js(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||n&&!Js(n,i)||(n=i)}return n&&e.test(n)?n:null};var lu=(e,t)=>{try{return new Cl(e,t).range||"*"}catch(e){return null}};const{ANY:uu}=eu;var cu=(e,t,n,r)=>{let i,a,o,s,l;switch(e=new Cs(e,r),t=new Cl(t,r),n){case">":i=Js,a=el,o=Ks,s=">",l=">=";break;case"<":i=Ks,a=Zs,o=Js,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ru(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let c=null,f=null;if(u.forEach((e=>{e.semver===uu&&(e=new eu(">=0.0.0")),c=c||e,f=f||e,i(e.semver,c.semver,r)?c=e:o(e.semver,f.semver,r)&&(f=e)})),c.operator===s||c.operator===l)return!1;if((!f.operator||f.operator===s)&&a(e,f.semver))return!1;if(f.operator===l&&o(e,f.semver))return!1}return!0};var fu=(e,t,n)=>cu(e,t,">",n);var du=(e,t,n)=>cu(e,t,"<",n);var hu=(e,t,n)=>(e=new Cl(e,n),t=new Cl(t,n),e.intersects(t));const{ANY:pu}=eu,mu=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===pu)return 1===t.length&&t[0].semver===pu;const r=new Set;let i,a,o,s,l,u,c;for(const t of e)">"===t.operator||">="===t.operator?i=gu(i,t,n):"<"===t.operator||"<="===t.operator?a=yu(a,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&a){if(o=zs(i.semver,a.semver,n),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==a.operator))return null}for(const e of r){if(i&&!ru(e,String(i),n))return null;if(a&&!ru(e,String(a),n))return null;for(const r of t)if(!ru(e,String(r),n))return!1;return!0}for(const e of t){if(c=c||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,i)if(">"===e.operator||">="===e.operator){if(s=gu(i,e,n),s===e&&s!==i)return!1}else if(">="===i.operator&&!ru(i.semver,String(e),n))return!1;if(a)if("<"===e.operator||"<="===e.operator){if(l=yu(a,e,n),l===e&&l!==a)return!1}else if("<="===a.operator&&!ru(a.semver,String(e),n))return!1;if(!e.operator&&(a||i)&&0!==o)return!1}return!(i&&u&&!a&&0!==o)&&!(a&&c&&!i&&0!==o)},gu=(e,t,n)=>{if(!e)return t;const r=zs(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},yu=(e,t,n)=>{if(!e)return t;const r=zs(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var vu=(e,t,n)=>{if(e===t)return!0;e=new Cl(e,n),t=new Cl(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=mu(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},bu={re:vs.re,src:vs.src,tokens:vs.t,SEMVER_SPEC_VERSION:gs.SEMVER_SPEC_VERSION,SemVer:Cs,compareIdentifiers:ks.compareIdentifiers,rcompareIdentifiers:ks.rcompareIdentifiers,parse:Ts,valid:Ns,clean:Rs,inc:Ps,diff:Is,major:Ls,minor:qs,patch:Us,prerelease:Vs,compare:zs,rcompare:Ws,compareLoose:Hs,compareBuild:Gs,sort:Xs,rsort:Ys,gt:Js,lt:Ks,eq:Bs,neq:Qs,gte:Zs,lte:el,cmp:tl,coerce:il,Comparator:eu,Range:Cl,satisfies:ru,toComparators:iu,maxSatisfying:au,minSatisfying:ou,minVersion:su,validRange:lu,outside:cu,gtr:fu,ltr:du,intersects:hu,simplifyRange:(e,t,n)=>{const r=[];let i=null,a=null;const o=e.sort(((e,t)=>zs(e,t,n)));for(const e of o){ru(e,t,n)?(a=e,i||(i=e)):(a&&r.push([i,a]),a=null,i=null)}i&&r.push([i,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return l.length<u.length?l:t},subset:vu};function xu(e,t,n){return e.fields=t||[],e.fname=n,e}function wu(e){return null==e?null:e.fname}function _u(e){return null==e?null:e.fields}function ku(e){return 1===e.length?Ou(e[0]):Su(e)}const Ou=e=>function(t){return t[e]},Su=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function Eu(e){throw Error(e)}function $u(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||Eu("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&Eu("Access path missing closing bracket: "+e),o&&Eu("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function Au(e,t,n){const r=$u(e);return e=1===r.length?r[0]:e,xu((n&&n.get||ku)(r),[e],t||e)}const Du=Au("id"),Cu=xu((e=>e),[],"identity"),Mu=xu((()=>0),[],"zero"),ju=xu((()=>1),[],"one"),Fu=xu((()=>!0),[],"true"),Tu=xu((()=>!1),[],"false");function Nu(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}function Ru(e,t){let n=e||0;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=1&&Nu(t||"error","ERROR",arguments),this},warn(){return n>=2&&Nu(t||"warn","WARN",arguments),this},info(){return n>=3&&Nu(t||"log","INFO",arguments),this},debug(){return n>=4&&Nu(t||"log","DEBUG",arguments),this}}}var Pu=Array.isArray;function zu(e){return e===Object(e)}const Bu=e=>"__proto__"!==e;function Iu(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=qu(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;Lu(e,n,t[n],r)}return e}),{})}function Lu(e,t,n,r){if(!Bu(t))return;let i,a;if(zu(n)&&!Pu(n))for(i in a=zu(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?Lu(a,i,n[i]):Bu(i)&&(a[i]=n[i]);else e[t]=n}function qu(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function Uu(e){return e[e.length-1]}function Vu(e){return null==e||""===e?null:+e}const Wu=e=>t=>e*Math.exp(t),Hu=e=>t=>Math.log(e*t),Gu=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Xu=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Yu=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Ju(e,t,n,r){const i=n(e[0]),a=n(Uu(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Ku(e,t){return Ju(e,t,Vu,Cu)}function Qu(e,t){var n=Math.sign(e[0]);return Ju(e,t,Hu(n),Wu(n))}function Zu(e,t,n){return Ju(e,t,Yu(n),Yu(1/n))}function ec(e,t,n){return Ju(e,t,Gu(n),Xu(n))}function tc(e,t,n,r,i){const a=r(e[0]),o=r(Uu(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function nc(e,t,n){return tc(e,t,n,Vu,Cu)}function rc(e,t,n){const r=Math.sign(e[0]);return tc(e,t,n,Hu(r),Wu(r))}function ic(e,t,n,r){return tc(e,t,n,Yu(r),Yu(1/r))}function ac(e,t,n,r){return tc(e,t,n,Gu(r),Xu(r))}function oc(e){return 1+~~(new Date(e).getMonth()/3)}function sc(e){return 1+~~(new Date(e).getUTCMonth()/3)}function lc(e){return null!=e?Pu(e)?e:[e]:[]}function uc(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function cc(e){return"function"==typeof e}function fc(e,t,n){n=n||{},t=lc(t)||[];const r=[],i=[],a={},o=n.comparator||hc;return lc(e).forEach(((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=cc(e)?e:Au(e,null,n)),(_u(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:xu(o(i,r),Object.keys(a))}const dc=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),hc=(e,t)=>1===e.length?pc(e[0],t[0]):mc(e,t,e.length),pc=(e,t)=>function(n,r){return dc(e(n),e(r))*t},mc=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=dc(a(r),a(i));return o*t[s]});function gc(e){return cc(e)?e:()=>e}function yc(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function vc(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function bc(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function xc(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const wc=Object.prototype.hasOwnProperty;function _c(e,t){return wc.call(e,t)}const kc={};function Oc(e){let t,n={};function r(e){return _c(n,e)&&n[e]!==kc}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===kc&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=kc),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===kc||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function Sc(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=Uu(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function Ec(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,vc(r,n)}function $c(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function Ac(e){return"boolean"==typeof e}function Dc(e){return"[object Date]"===Object.prototype.toString.call(e)}function Cc(e){return e&&cc(e[Symbol.iterator])}function Mc(e){return"number"==typeof e}function jc(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function Fc(e){return"string"==typeof e}function Tc(e,t,n){e&&(e=t?lc(e).map((e=>e.replace(/\\(.)/g,"$1"))):lc(e));const r=e&&e.length,i=n&&n.get||ku,a=e=>i(t?[e]:$u(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return xu(o,e,"key")}function Nc(e,t){const n=e[0],r=Uu(e),i=+t;return i?1===i?r:n+i*(r-n):n}function Rc(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>_c(t,e)||_c(n,e),get:e=>_c(t,e)?t[e]:_c(n,e)?a(e,n[e]):void 0,set:(e,n)=>_c(t,e)?t[e]=n:a(e,n)}}function Pc(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function zc(e,t){let n="";for(;--t>=0;)n+=e;return n}function Bc(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?zc(i,o)+a:"center"===r?zc(i,~~(o/2))+a+zc(i,Math.ceil(o/2)):a+zc(i,o)}function Ic(e){return e&&Uu(e)-e[0]||0}function Lc(e){return Pu(e)?"["+e.map(Lc)+"]":zu(e)||Fc(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function qc(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}const Uc=e=>Mc(e)||Dc(e)?e:Date.parse(e);function Vc(e,t){return t=t||Uc,null==e||""===e?null:t(e)}function Wc(e){return null==e||""===e?null:e+""}function Hc(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Gc(e,t,n,r){const i=null!=r?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function Xc(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const Yc=/^([A-Za-z]+:)?\/\//,Jc=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Kc=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Qc="file://";async function Zc(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function ef(e,t){t=vc({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=Jc.test(e.replace(Kc,""));null!=e&&"string"==typeof e&&s||Eu("Sanitize failure, invalid URI: "+Lc(e));const l=Yc.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(Qc))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(Qc.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function tf(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):nf}async function nf(){Eu("No file system access.")}function rf(e){return e?async function(t,n){const r=vc({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?cc(a[i])?a[i]():a.text():Eu(a.status+""+a.statusText)}:af}async function af(){Eu("No HTTP fetch method available.")}const of=e=>null!=e&&e==e,sf=e=>!(Number.isNaN(+e)||e instanceof Date),lf={boolean:qc,integer:Vu,number:Vu,date:Vc,string:Wc,unknown:Cu},uf=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>sf(e)&&Number.isInteger(+e),sf,e=>!Number.isNaN(Date.parse(e))],cf=["boolean","integer","number","date"];function ff(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=uf.length,i=uf.map(((e,t)=>t+1));for(let a,o,s=0,l=0;s<n;++s)for(o=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&of(o)&&!uf[a](o)&&(i[a]=0,++l,l===uf.length))return"string";return cf[i.reduce(((e,t)=>0===e?t:e),0)-1]}function df(e,t){return t.reduce(((t,n)=>(t[n]=ff(e,n),t)),{})}var hf={},pf={};function mf(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function gf(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function yf(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function vf(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+yf(-e,6):e>9999?"+"+yf(e,6):yf(e,4)}(e.getUTCFullYear())+"-"+yf(e.getUTCMonth()+1,2)+"-"+yf(e.getUTCDate(),2)+(i?"T"+yf(t,2)+":"+yf(n,2)+":"+yf(r,2)+"."+yf(i,3)+"Z":r?"T"+yf(t,2)+":"+yf(n,2)+":"+yf(r,2)+"Z":n||t?"T"+yf(t,2)+":"+yf(n,2)+"Z":"")}function bf(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return pf;if(u)return u=!1,hf;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==pf;){for(var f=[];r!==hf&&r!==pf;)f.push(r),r=c();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?vf(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=mf(e);return function(r,i){return t(n(r),i,e)}}(e,t):mf(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=gf(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=gf(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}function xf(e){const t=function(t,n){const r={delimiter:e};return wf(t,n?vc(n,r):r)};return t.responseType="text",t}function wf(e,t){return t.header&&(e=t.header.map(Lc).join(t.delimiter)+"\n"+e),bf(t.delimiter).parse(e+"")}function _f(e,t){const n=t&&t.property?Au(t.property):Cu;return zu(e)&&!function(e){return!("function"!=typeof Buffer||!cc(Buffer.isBuffer))&&Buffer.isBuffer(e)}(e)?function(e,t){!Pu(e)&&Cc(e)&&(e=[...e]);return t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t):n(JSON.parse(e))}function kf(e){return e}function Of(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return Sf(e,t)}))}:Sf(e,t)}function Sf(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=Ef(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function Ef(e,t){var n=function(e){if(null==e)return kf;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function $f(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1];return t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function Af(e){return Ef(e,Df.apply(this,arguments))}function Df(e,t,n){var r,i,a;if(arguments.length>1)r=Cf(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:$f(e,r)}}function Cf(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}wf.responseType="text",_f.responseType="json";const Mf={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function jf(e,t){let n,r,i,a;return e=_f(e,t),t&&t.feature?(n=Of,i=t.feature):t&&t.mesh?(n=Af,i=t.mesh,a=Mf[t.filter]):Eu("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):Eu("Invalid TopoJSON object: "+i),r&&r.features||[r]}jf.responseType="json";const Ff={dsv:wf,csv:xf(","),tsv:xf("\t"),json:_f,topojson:jf};function Tf(e,t){return arguments.length>1?(Ff[e]=t,this):_c(Ff,e)?Ff[e]:null}function Nf(e){const t=Tf(e);return t&&t.responseType||"text"}function Rf(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Pf(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>Rf(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}function zf(e){return null===e?NaN:+e}const Bf=Pf(Rf),If=Bf.right,Lf=Bf.left;Pf(zf).center;class qf{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var Uf=Math.sqrt(50),Vf=Math.sqrt(10),Wf=Math.sqrt(2);function Hf(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Gf(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a}function Gf(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Uf?10:a>=Vf?5:a>=Wf?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Uf?10:a>=Vf?5:a>=Wf?2:1)}function Xf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Uf?i*=10:a>=Vf?i*=5:a>=Wf&&(i*=2),t<e?-i:i}function Yf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function Jf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function Kf(e,t,n=0,r=e.length-1,i=Rf){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Kf(e,t,Math.max(n,Math.floor(t-o*l/a+u)),Math.min(r,Math.floor(t+(a-o)*l/a+u)),i)}const a=e[t];let o=n,s=r;for(Qf(e,n,t),i(e[r],a)>0&&Qf(e,n,r);o<s;){for(Qf(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?Qf(e,n,s):(++s,Qf(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Qf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Zf(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return Jf(e);if(t>=1)return Yf(e);var r,i=(r-1)*t,a=Math.floor(i),o=Yf(Kf(e,a).subarray(0,a+1));return o+(Jf(e.subarray(a+1))-o)*(i-a)}}function ed(e,t,n=zf){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function td(e,t){return Zf(e,.5,t)}function nd(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function rd(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function id(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function ad(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function od(e){return(e=ad(Math.abs(e)))?e[1]:NaN}var sd,ld=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ud(e){if(!(t=ld.exec(e)))throw new Error("invalid format: "+e);var t;return new cd({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function cd(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function fd(e,t){var n=ad(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}ud.prototype=cd.prototype,cd.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var dd={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>fd(100*e,t),r:fd,s:function(e,t){var n=ad(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(sd=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+ad(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function hd(e){return e}var pd,md,gd,yd=Array.prototype.map,vd=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bd(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?hd:(t=yd.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?hd:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(yd.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=ud(e)).fill,n=e.align,f=e.sign,d=e.symbol,h=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):dd[v]||(void 0===g&&(g=12),y=!0,v="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?a:/[%p]/.test(v)?l:"",w=dd[v],_=/[defgprs%]/.test(v);function k(e){var i,a,l,d=b,k=x;if("c"===v)k=w(e)+k,e="";else{var O=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),O&&0==+e&&"+"!==f&&(O=!1),d=(O?"("===f?f:u:"-"===f||"("===f?"":f)+d,k=("s"===v?vd[8+sd/3]:"")+k+(O&&"("===f?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}m&&!h&&(e=r(e,1/0));var S=d.length+e.length+k.length,E=S<p?new Array(p-S+1).join(t):"";switch(m&&h&&(e=r(E+e,E.length?p-k.length:1/0),E=""),n){case"<":e=d+e+k+E;break;case"=":e=d+E+e+k;break;case"^":e=E.slice(0,S=E.length>>1)+d+e+k+E.slice(S);break;default:e=E+d+e+k}return s(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:f,formatPrefix:function(e,t){var n=f(((e=ud(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(od(t)/3))),i=Math.pow(10,-r),a=vd[8+r/3];return function(e){return n(i*e)+a}}}}function xd(e){return Math.max(0,-od(Math.abs(e)))}function wd(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(od(t)/3)))-od(Math.abs(e)))}function _d(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,od(t)-od(e))+1}!function(e){pd=bd(e),md=pd.format,gd=pd.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var kd=new Date,Od=new Date;function Sd(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return Sd((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return kd.setTime(+t),Od.setTime(+r),e(kd),e(Od),Math.floor(n(kd,Od))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Ed=Sd((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));Ed.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Sd((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Ed:null};var $d=1e3,Ad=6e4,Dd=36e5,Cd=864e5,Md=6048e5,jd=Sd((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*$d)}),(function(e,t){return(t-e)/$d}),(function(e){return e.getUTCSeconds()})),Fd=Sd((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*$d)}),(function(e,t){e.setTime(+e+t*Ad)}),(function(e,t){return(t-e)/Ad}),(function(e){return e.getMinutes()})),Td=Sd((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*$d-e.getMinutes()*Ad)}),(function(e,t){e.setTime(+e+t*Dd)}),(function(e,t){return(t-e)/Dd}),(function(e){return e.getHours()})),Nd=Sd((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ad)/Cd),(e=>e.getDate()-1));function Rd(e){return Sd((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ad)/Md}))}var Pd=Rd(0),zd=Rd(1),Bd=(Rd(2),Rd(3),Rd(4)),Id=(Rd(5),Rd(6),Sd((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),Ld=Sd((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));Ld.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Sd((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var qd=Sd((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Ad)}),(function(e,t){return(t-e)/Ad}),(function(e){return e.getUTCMinutes()})),Ud=Sd((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Dd)}),(function(e,t){return(t-e)/Dd}),(function(e){return e.getUTCHours()})),Vd=Sd((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Cd}),(function(e){return e.getUTCDate()-1}));function Wd(e){return Sd((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Md}))}var Hd=Wd(0),Gd=Wd(1),Xd=(Wd(2),Wd(3),Wd(4)),Yd=(Wd(5),Wd(6),Sd((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}))),Jd=Sd((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));Jd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Sd((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const Kd="year",Qd="quarter",Zd="month",eh="week",th="date",nh="day",rh="dayofyear",ih="hours",ah="minutes",oh="seconds",sh="milliseconds",lh=[Kd,Qd,Zd,eh,th,nh,rh,ih,ah,oh,sh],uh=lh.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function ch(e){const t=lc(e).slice(),n={};t.length||Eu("Missing time unit."),t.forEach((e=>{_c(uh,e)?n[e]=1:Eu("Invalid time unit: ".concat(e,"."))}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&Eu("Incompatible time units: ".concat(e)),t.sort(((e,t)=>uh[e]-uh[t])),t}const fh={[Kd]:"%Y ",[Qd]:"Q%q ",[Zd]:"%b ",[th]:"%d ",[eh]:"W%U ",[nh]:"%a ",[rh]:"%j ",[ih]:"%H:00",[ah]:"00:%M",[oh]:":%S",[sh]:".%L",["".concat(Kd,"-").concat(Zd)]:"%Y-%m ",["".concat(Kd,"-").concat(Zd,"-").concat(th)]:"%Y-%m-%d ",["".concat(ih,"-").concat(ah)]:"%H:%M"};function dh(e,t){const n=vc({},fh,t),r=ch(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const hh=new Date;function ph(e){return hh.setFullYear(e),hh.setMonth(0),hh.setDate(1),hh.setHours(0,0,0,0),hh}function mh(e){return yh(new Date(e))}function gh(e){return vh(new Date(e))}function yh(e){return Nd.count(ph(e.getFullYear())-1,e)}function vh(e){return Pd.count(ph(e.getFullYear())-1,e)}function bh(e){return ph(e).getDay()}function xh(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function wh(e){return kh(new Date(e))}function _h(e){return Oh(new Date(e))}function kh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Vd.count(t-1,e)}function Oh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Hd.count(t-1,e)}function Sh(e){return hh.setTime(Date.UTC(e,0,1)),hh.getUTCDay()}function Eh(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function $h(e,t,n,r,i){const a=t||1,o=Uu(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=Hc(e),c=u.year?s(Kd):gc(2012),f=u.month?s(Zd):u.quarter?s(Qd):Mu,d=u.week&&u.day?s(nh,1,eh+nh):u.week?s(eh,1):u.day?s(nh,1):u.date?s(th,1):u.dayofyear?s(rh,1):ju,h=u.hours?s(ih):Mu,p=u.minutes?s(ah):Mu,m=u.seconds?s(oh):Mu,g=u.milliseconds?s(sh):Mu;return function(e){l.setTime(+e);const t=c(l);return i(t,f(l),d(l,t),h(l),p(l),m(l),g(l))}}function Ah(e,t,n){return t+7*e-(n+6)%7}const Dh={[Kd]:e=>e.getFullYear(),[Qd]:e=>Math.floor(e.getMonth()/3),[Zd]:e=>e.getMonth(),[th]:e=>e.getDate(),[ih]:e=>e.getHours(),[ah]:e=>e.getMinutes(),[oh]:e=>e.getSeconds(),[sh]:e=>e.getMilliseconds(),[rh]:e=>yh(e),[eh]:e=>vh(e),[eh+nh]:(e,t)=>Ah(vh(e),e.getDay(),bh(t)),[nh]:(e,t)=>Ah(1,e.getDay(),bh(t))},Ch={[Qd]:e=>3*e,[eh]:(e,t)=>Ah(e,0,bh(t))};function Mh(e,t){return $h(e,t||1,Dh,Ch,xh)}const jh={[Kd]:e=>e.getUTCFullYear(),[Qd]:e=>Math.floor(e.getUTCMonth()/3),[Zd]:e=>e.getUTCMonth(),[th]:e=>e.getUTCDate(),[ih]:e=>e.getUTCHours(),[ah]:e=>e.getUTCMinutes(),[oh]:e=>e.getUTCSeconds(),[sh]:e=>e.getUTCMilliseconds(),[rh]:e=>kh(e),[eh]:e=>Oh(e),[nh]:(e,t)=>Ah(1,e.getUTCDay(),Sh(t)),[eh+nh]:(e,t)=>Ah(Oh(e),e.getUTCDay(),Sh(t))},Fh={[Qd]:e=>3*e,[eh]:(e,t)=>Ah(e,0,Sh(t))};function Th(e,t){return $h(e,t||1,jh,Fh,Eh)}const Nh={[Kd]:Ld,[Qd]:Id.every(3),[Zd]:Id,[eh]:Pd,[th]:Nd,[nh]:Nd,[rh]:Nd,[ih]:Td,[ah]:Fd,[oh]:jd,[sh]:Ed},Rh={[Kd]:Jd,[Qd]:Yd.every(3),[Zd]:Yd,[eh]:Hd,[th]:Vd,[nh]:Vd,[rh]:Vd,[ih]:Ud,[ah]:qd,[oh]:jd,[sh]:Ed};function Ph(e){return Nh[e]}function zh(e){return Rh[e]}function Bh(e,t,n){return e?e.offset(t,n):void 0}function Ih(e,t,n){return Bh(Ph(e),t,n)}function Lh(e,t,n){return Bh(zh(e),t,n)}function qh(e,t,n,r){return e?e.range(t,n,r):void 0}function Uh(e,t,n,r){return qh(Ph(e),t,n,r)}function Vh(e,t,n,r){return qh(zh(e),t,n,r)}const Wh=1e3,Hh=6e4,Gh=36e5,Xh=864e5,Yh=2592e6,Jh=31536e6,Kh=[Kd,Zd,th,ih,ah,oh,sh],Qh=Kh.slice(0,-1),Zh=Qh.slice(0,-1),ep=Zh.slice(0,-1),tp=ep.slice(0,-1),np=[Kd,Zd],rp=[Kd],ip=[[Qh,1,Wh],[Qh,5,5e3],[Qh,15,15e3],[Qh,30,3e4],[Zh,1,Hh],[Zh,5,3e5],[Zh,15,9e5],[Zh,30,18e5],[ep,1,Gh],[ep,3,108e5],[ep,6,216e5],[ep,12,432e5],[tp,1,Xh],[[Kd,eh],1,6048e5],[np,1,Yh],[np,3,7776e6],[rp,1,Jh]];function ap(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Ic(t))/n;let i,a,o=Pf((e=>e[2])).right(ip,r);return o===ip.length?(i=rp,a=Xf(t[0]/Jh,t[1]/Jh,n)):o?(o=ip[r/ip[o-1][2]<ip[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=Kh,a=Math.max(Xf(t[0],t[1],n),1)),{units:i,step:a}}function op(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function sp(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function lp(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function up(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=wp(i),c=_p(i),f=wp(a),d=_p(a),h=wp(o),p=_p(o),m=wp(s),g=_p(s),y=wp(l),v=_p(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Up,e:Up,f:Xp,g:am,G:sm,H:Vp,I:Wp,j:Hp,L:Gp,m:Yp,M:Jp,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Cm,s:Mm,S:Kp,u:Qp,U:Zp,V:tm,w:nm,W:rm,x:null,X:null,y:im,Y:om,Z:lm,"%":Dm},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:um,e:um,f:pm,g:Sm,G:$m,H:cm,I:fm,j:dm,L:hm,m:mm,M:gm,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Cm,s:Mm,S:ym,u:vm,U:bm,V:wm,w:_m,W:km,x:null,X:null,y:Om,Y:Em,Z:Am,"%":Dm},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=y.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return O(e,t,n,r)},d:Fp,e:Fp,f:Bp,g:Dp,G:Ap,H:Np,I:Np,j:Tp,L:zp,m:jp,M:Rp,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:Mp,Q:Lp,s:qp,S:Pp,u:Op,U:Sp,V:Ep,w:kp,W:$p,x:function(e,t,r){return O(e,n,t,r)},X:function(e,t,n){return O(e,r,t,n)},y:Dp,Y:Ap,Z:Cp,"%":Ip};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=mp[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=lp(1900,void 0,1);if(O(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=sp(lp(a.y,0,1))).getUTCDay(),r=i>4||0===i?Gd.ceil(r):Gd(r),r=Vd.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=op(lp(a.y,0,1))).getDay(),r=i>4||0===i?zd.ceil(r):zd(r),r=Nd.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?sp(lp(a.y,0,1)).getUTCDay():op(lp(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,sp(a)):op(a)}}function O(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in mp?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var cp,fp,dp,hp,pp,mp={"-":"",_:" ",0:"0"},gp=/^\s*\d+/,yp=/^%/,vp=/[\\^$*+?|[\]().{}]/g;function bp(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function xp(e){return e.replace(vp,"\\$&")}function wp(e){return new RegExp("^(?:"+e.map(xp).join("|")+")","i")}function _p(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function kp(e,t,n){var r=gp.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Op(e,t,n){var r=gp.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Sp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Ep(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function $p(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Ap(e,t,n){var r=gp.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Dp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Cp(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Mp(e,t,n){var r=gp.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function jp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Fp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Tp(e,t,n){var r=gp.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Np(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Rp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Pp(e,t,n){var r=gp.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function zp(e,t,n){var r=gp.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Bp(e,t,n){var r=gp.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Ip(e,t,n){var r=yp.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Lp(e,t,n){var r=gp.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function qp(e,t,n){var r=gp.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Up(e,t){return bp(e.getDate(),t,2)}function Vp(e,t){return bp(e.getHours(),t,2)}function Wp(e,t){return bp(e.getHours()%12||12,t,2)}function Hp(e,t){return bp(1+Nd.count(Ld(e),e),t,3)}function Gp(e,t){return bp(e.getMilliseconds(),t,3)}function Xp(e,t){return Gp(e,t)+"000"}function Yp(e,t){return bp(e.getMonth()+1,t,2)}function Jp(e,t){return bp(e.getMinutes(),t,2)}function Kp(e,t){return bp(e.getSeconds(),t,2)}function Qp(e){var t=e.getDay();return 0===t?7:t}function Zp(e,t){return bp(Pd.count(Ld(e)-1,e),t,2)}function em(e){var t=e.getDay();return t>=4||0===t?Bd(e):Bd.ceil(e)}function tm(e,t){return e=em(e),bp(Bd.count(Ld(e),e)+(4===Ld(e).getDay()),t,2)}function nm(e){return e.getDay()}function rm(e,t){return bp(zd.count(Ld(e)-1,e),t,2)}function im(e,t){return bp(e.getFullYear()%100,t,2)}function am(e,t){return bp((e=em(e)).getFullYear()%100,t,2)}function om(e,t){return bp(e.getFullYear()%1e4,t,4)}function sm(e,t){var n=e.getDay();return bp((e=n>=4||0===n?Bd(e):Bd.ceil(e)).getFullYear()%1e4,t,4)}function lm(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+bp(t/60|0,"0",2)+bp(t%60,"0",2)}function um(e,t){return bp(e.getUTCDate(),t,2)}function cm(e,t){return bp(e.getUTCHours(),t,2)}function fm(e,t){return bp(e.getUTCHours()%12||12,t,2)}function dm(e,t){return bp(1+Vd.count(Jd(e),e),t,3)}function hm(e,t){return bp(e.getUTCMilliseconds(),t,3)}function pm(e,t){return hm(e,t)+"000"}function mm(e,t){return bp(e.getUTCMonth()+1,t,2)}function gm(e,t){return bp(e.getUTCMinutes(),t,2)}function ym(e,t){return bp(e.getUTCSeconds(),t,2)}function vm(e){var t=e.getUTCDay();return 0===t?7:t}function bm(e,t){return bp(Hd.count(Jd(e)-1,e),t,2)}function xm(e){var t=e.getUTCDay();return t>=4||0===t?Xd(e):Xd.ceil(e)}function wm(e,t){return e=xm(e),bp(Xd.count(Jd(e),e)+(4===Jd(e).getUTCDay()),t,2)}function _m(e){return e.getUTCDay()}function km(e,t){return bp(Gd.count(Jd(e)-1,e),t,2)}function Om(e,t){return bp(e.getUTCFullYear()%100,t,2)}function Sm(e,t){return bp((e=xm(e)).getUTCFullYear()%100,t,2)}function Em(e,t){return bp(e.getUTCFullYear()%1e4,t,4)}function $m(e,t){var n=e.getUTCDay();return bp((e=n>=4||0===n?Xd(e):Xd.ceil(e)).getUTCFullYear()%1e4,t,4)}function Am(){return"+0000"}function Dm(){return"%"}function Cm(e){return+e}function Mm(e){return Math.floor(+e/1e3)}function jm(e){const t={};return n=>t[n]||(t[n]=e(n))}function Fm(e){const t=jm(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=ud(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=ud(null==a?",f":a);const o=Xf(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=wd(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=_d(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=xd(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let Tm,Nm;function Rm(){return Tm=Fm({format:md,formatPrefix:gd})}function Pm(e){return Fm(bd(e))}function zm(e){return arguments.length?Tm=Pm(e):Tm}function Bm(e,t,n){zu(n=n||{})||Eu("Invalid time multi-format specifier: ".concat(n));const r=t(oh),i=t(ah),a=t(ih),o=t(th),s=t(eh),l=t(Zd),u=t(Qd),c=t(Kd),f=e(n.milliseconds||".%L"),d=e(n.seconds||":%S"),h=e(n.minutes||"%I:%M"),p=e(n.hours||"%I %p"),m=e(n.date||n.day||"%a %d"),g=e(n.week||"%b %d"),y=e(n.month||"%B"),v=e(n.quarter||"%B"),b=e(n.year||"%Y");return e=>(r(e)<e?f:i(e)<e?d:a(e)<e?h:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?y:v:b)(e)}function Im(e){const t=jm(e.format),n=jm(e.utcFormat);return{timeFormat:e=>Fc(e)?t(e):Bm(t,Ph,e),utcFormat:e=>Fc(e)?n(e):Bm(n,zh,e),timeParse:jm(e.parse),utcParse:jm(e.utcParse)}}function Lm(){return Nm=Im({format:fp,parse:dp,utcFormat:hp,utcParse:pp})}function qm(e){return Im(up(e))}function Um(e){return arguments.length?Nm=qm(e):Nm}!function(e){cp=up(e),fp=cp.format,dp=cp.parse,hp=cp.utcFormat,pp=cp.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Rm(),Lm();const Vm=(e,t)=>vc({},e,t);function Wm(e,t){const n=e?Pm(e):zm(),r=t?qm(t):Um();return Vm(n,r)}function Hm(e,t){const n=arguments.length;return n&&2!==n&&Eu("defaultLocale expects either zero or two arguments."),n?Vm(zm(e),Um(t)):Vm(zm(),Um())}function Gm(e,t,n,r){const i=Tf((t=t||{}).type||"json");return i||Eu("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=Um();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,f=e.columns||Object.keys(e[0]);"auto"===t&&(t=df(e,f));f=Object.keys(t);const d=f.map((e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1));return("utc"===a[0]?r:n)(o)}if(!lf[i])throw Error("Illegal format pattern: "+e+":"+i);return lf[i]}));for(s=0,u=e.length,c=f.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=f[l],a[o]=d[l](a[o])}(e,t.parse,n,r),_c(e,"columns")&&delete e.columns,e}const Xm=function(e,t){return n=>({options:n||{},sanitize:ef,load:Zc,fileAccess:!!t,file:tf(t),http:rf(e)})}("undefined"!=typeof fetch&&fetch,null);function Ym(e){const t=e||Cu,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function Jm(e,t){try{await t(e)}catch(t){e.error(t)}}const Km=Symbol("vega_id");let Qm=1;function Zm(e){return!(!e||!eg(e))}function eg(e){return e[Km]}function tg(e,t){return e[Km]=t,e}function ng(e){const t=e===Object(e)?e:{data:e};return eg(t)?t:tg(t,Qm++)}function rg(e){return ig(e,ng({}))}function ig(e,t){for(const n in e)t[n]=e[n];return t}function ag(e,t){return tg(t,eg(e))}function og(e,t){return e?t?(n,r)=>e(n,r)||eg(t(n))-eg(t(r)):(t,n)=>e(t,n)||eg(t)-eg(n):null}function sg(e){return e&&e.constructor===lg}function lg(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:lg,insert(t){const n=lc(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=cc(e)?r:t,i=lc(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:gc(r)};return cc(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return cc(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let f,d,h,p,m,g;for(f=0,d=l.length;f<d;++f)u[eg(l[f])]=1;for(f=0,d=t.length;f<d;++f)m=t[f],u[eg(m)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],l.forEach((e=>{p(e)&&(u[eg(e)]=-1)}));for(f=0,d=e.length;f<d;++f)m=e[f],g=eg(m),u[g]?u[g]=1:s.add.push(ng(e[f]));for(f=0,d=l.length;f<d;++f)m=l[f],u[eg(m)]<0&&s.rem.push(m);function y(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[eg(e)]=e)}for(f=0,d=n.length;f<d;++f)h=n[f],m=h.tuple,p=h.field,g=u[eg(m)],g>0&&(y(m,p,h.value),s.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,l.forEach((e=>{p(e)&&u[eg(e)]>0&&y(e,h.field,h.value)})),s.modifies(h.field);if(o)s.mod=t.length||r.length?l.filter((e=>u[eg(e)]>0)):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const ug="_:mod:_";function cg(){Object.defineProperty(this,ug,{writable:!0,value:{}})}cg.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[ug];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=Pu(n)?1+n.length:-1),i},modified(e,t){const n=this[ug];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(Pu(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[ug]={},this}};let fg=0;const dg=new cg;function hg(e,t,n,r){this.id=++fg,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function pg(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}hg.prototype={targets(){return this._targets||(this._targets=Ym(Du))},set(e){return this.value!==e?(this.value=e,1):0},skip:pg(1),modified:pg(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new cg,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof hg?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)lc(s).forEach((e=>{e instanceof hg?e!==this&&(e.targets().add(this),a.push(e)):Eu("Pulse parameters must be operator instances.")})),this.source=s;else if(Pu(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||dg,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let mg=0;function gg(e,t,n){this.id=++mg,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function yg(e,t,n){return new gg(e,t,n)}gg.prototype={_filter:Fu,_apply:Cu,targets(){return this._targets||(this._targets=Ym(Du))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=yg(e);return this.targets().add(t),t},apply(e){const t=yg(null,e);return this.targets().add(t),t},merge(){const e=yg();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=yg();return this.targets().add(yg(null,null,yc(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(yg(null,null,(()=>n=!0))),t.targets().add(yg(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){}};const vg={skip:!0};function bg(e,t,n,r,i,a){const o=vc({},a,vg);let s,l;cc(n)||(n=gc(n)),void 0===r?s=t=>e.touch(n(t)):cc(r)?(l=new hg(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;sg(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function xg(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new hg(null,function(e,t){return t=cc(t)?t:gc(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const wg={};function _g(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function kg(e,t){const n=[];return Xc(e,t,(e=>n.push(e))),n}function Og(e,t){const n={};return e.visit(t,(e=>{n[eg(e)]=1})),e=>n[eg(e)]?null:e}function Sg(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function Eg(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(o|=i.ADD),r.changed(i.REM)&&(o|=i.REM),r.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function $g(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}_g.prototype={StopPropagation:wg,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new _g(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new _g(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,Og(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Pu(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Pu(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=Sg(n.addF,t)),2&e&&(n.remF=Sg(n.remF,t)),4&e&&(n.modF=Sg(n.modF,t)),16&e&&(n.srcF=Sg(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=kg(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=kg(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=kg(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Xc(n.source,n.srcF,r),n;1&e&&Xc(n.add,n.addF,r),2&e&&Xc(n.rem,n.remF,r),4&e&&Xc(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||Xc(i,e?Og(n,5):n.srcF,r)}return n}},Ec(Eg,_g,{fork(e){const t=new _g(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Pu(e)?e.some((e=>n[e])):n[e]:0},filter(){Eu("MultiPulse does not support filtering.")},materialize(){Eu("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const Ag={skip:!1,force:!1};function Dg(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Cg(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,Cg(e,r,t,n)}(t,0,e)):r=n,r}}}function Cg(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function Mg(){this.logger(Ru()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=Hm();try{this._loader=Xm()}catch(e){}this._touched=Ym(Du),this._input={},this._pulse=null,this._heap=Dg(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function jg(e){return function(){return this._log[e].apply(this,arguments)}}function Fg(e,t){hg.call(this,e,null,t)}Mg.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:jg("error"),warn:jg("warn"),info:jg("info"),debug:jg("debug"),logLevel:jg("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof hg?i=e:e&&e.prototype instanceof hg?i=new e:cc(e)?i=new hg(null,e):(a=0,i=new hg(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&Eu("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Ag);const r=new _g(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||Ag;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||Ag;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:lg,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Gm(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(Fu).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:Nf(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=yg(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):lc(e);const l=s.length;for(let e=0;e<l;++e)s[e].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof hg?xg:bg)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return $g(r);if(r._pending&&await r._pending,t&&await Jm(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new _g(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=Ym(Du);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=wg),s!==wg&&o._targets&&o._targets.forEach((e=>r._enqueue(e))),++u):r._enqueue(o,!0)}catch(e){r._heap.clear(),l=e}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await Jm(r,e[t].callback)}return n&&await Jm(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?$g(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Pu(n)?new Eg(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){if(t&&t.stamp===e.stamp)return t;e=e.fork(),t&&t!==wg&&(e.source=t.source);return e}(this._pulse,n&&n.pulse)}},Ec(Fg,hg,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Tg={};function Ng(e){const t=Rg(e);return t&&t.Definition||null}function Rg(e){return e=e&&e.toLowerCase(),_c(Tg,e)?Tg[e]:null}function*Pg(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function zg(e,t,n){const r=Float64Array.from(Pg(e,n));return r.sort(Rf),t.map((e=>ed(r,e)))}function Bg(e,t){return zg(e,[.25,.5,.75],t)}function Ig(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=Bg(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function Lg(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,f=e.extent[0],d=e.extent[1];const h=e.span||d-f||Math.abs(f)||1;if(e.step)a=e.step;else if(e.steps){for(l=h/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(h)/r)-o));Math.ceil(h/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&h/l<=t&&(a=l)}l=Math.log(a);const p=l>=0?0:1+~~(-l/r),m=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(f/a+m)*a,f=f<l?l-a:l,d=Math.ceil(d/a)*a),{start:f,stop:d===f?f+a:d,step:a}}var qg=Math.random;function Ug(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Pg(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(qg()*a)];c[u]=s/a}return c.sort(Rf),[Zf(c,n/2),Zf(c,1-n/2)]}function Vg(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,f=u+t;for(;l<i;++l){if(o=r(e[l]),o>=f){for(c=(u+c)/2;s<l;++s)a[s]=c;f=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}const Wg=Math.sqrt(2*Math.PI),Hg=Math.SQRT2;let Gg=NaN;function Xg(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(Gg==Gg)i=Gg,Gg=NaN;else{do{i=2*qg()-1,a=2*qg()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,Gg=a*r}return e+i*t}function Yg(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*Wg)}function Jg(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function Kg(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Hg*function(e){let t,n=-Math.log((1-e)*(1+e));n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0;return t*e}(2*e-1)}function Qg(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Xg(n,r),pdf:e=>Yg(e,n,r),cdf:e=>Jg(e,n,r),icdf:e=>Kg(e,n,r)};return i.mean(e).stdev(t)}function Zg(e,t){const n=Qg();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=Ig(e)),i):t},sample:()=>e[~~(qg()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function ey(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Xg()*t)}function ty(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*Wg*e)}function ny(e,t,n){return Jg(Math.log(e),t,n)}function ry(e,t,n){return Math.exp(Kg(e,t,n))}function iy(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>ey(n,r),pdf:e=>ty(e,n,r),cdf:e=>ny(e,n,r),icdf:e=>ry(e,n,r)};return i.mean(e).stdev(t)}function ay(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=qg();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function oy(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*qg()}function sy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function ly(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function uy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function cy(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>oy(n,r),pdf:e=>sy(e,n,r),cdf:e=>ly(e,n,r),icdf:e=>uy(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function fy(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function dy(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,f=0,d=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,f+=(s-f)/c,d+=(l-d)/c;for(c=0;c<i;++c)a[c]-=f,o[c]-=d;return[a,o,f,d]}function hy(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function py(e,t,n,r,i){let a=0,o=0;return hy(e,t,n,((e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function my(e,t,n){let r=0,i=0,a=0,o=0,s=0;hy(e,t,n,((e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=fy(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:py(e,t,n,i,u)}}function gy(e,t,n){let r=0,i=0,a=0,o=0,s=0;hy(e,t,n,((e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=fy(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:py(e,t,n,i,u)}}function yy(e,t,n){const[r,i,a,o]=dy(e,t,n);let s,l,u,c=0,f=0,d=0,h=0,p=0;hy(e,t,n,((e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,f+=(u-f)/p,d+=(u*l-d)/p,h+=(s*u-h)/p}));const[m,g]=fy(f/o,c/o,d/o,h/o),y=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:y,rSquared:py(e,t,n,o,y)}}function vy(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;hy(e,t,n,((e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l}));const u=fy(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:py(e,t,n,s,c)}}function by(e,t,n){const[r,i,a,o]=dy(e,t,n),s=r.length;let l,u,c,f,d=0,h=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],f=u*u,d+=(f-d)/l,h+=(f*u-h)/l,p+=(f*f-p)/l,m+=(u*c-m)/l,g+=(f*c-g)/l;const y=p-d*d,v=d*y-h*h,b=(g*d-m*h)/v,x=(m*y-g*h)/v,w=-b*d,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:py(e,t,n,o,_)}}function xy(e,t,n,r){if(1===r)return my(e,t,n);if(2===r)return by(e,t,n);const[i,a,o,s]=dy(e,t,n),l=i.length,u=[],c=[],f=r+1;let d,h,p,m,g;for(d=0;d<f;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*a[p];for(u.push(m),g=new Float64Array(f),h=0;h<f;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+h);g[h]=m}c.push(g)}c.push(u);const y=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),v=e=>{e-=o;let t=s+y[0]+y[1]*e+y[2]*e*e;for(d=3;d<f;++d)t+=y[d]*Math.pow(e,d);return t};return{coef:wy(f,y,-o,s),predict:v,rSquared:py(e,t,n,s,v)}}function wy(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function _y(e,t,n,r){const[i,a,o,s]=dy(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let e=-1;++e<=2;){const t=[0,u-1];for(let e=0;e<l;++e){const n=i[e],r=t[0],o=t[1],s=n-i[r]>i[o]-n?r:o;let l=0,u=0,h=0,p=0,m=0;const g=1/Math.abs(i[s]-n||1);for(let e=r;e<=o;++e){const t=i[e],r=a[e],o=ky(Math.abs(n-t)*g)*d[e],s=t*o;l+=o,u+=s,h+=r*o,p+=r*s,m+=t*s}const[y,v]=fy(u/l,h/l,p/l,m/l);c[e]=y+v*n,f[e]=Math.abs(a[e]-c[e]),Oy(i,e+1,t)}if(2===e)break;const n=td(f);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<l;++r)e=f[r]/(6*n),d[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function ky(e){return(e=1-e*e*e)*e*e}function Oy(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const Sy=.1*Math.PI/180;function Ey(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let e=n;--e>0;)c.push(i(a+e/n*s));let f=u[0],d=c[c.length-1];for(;d;){const e=i((f[0]+d[0])/2);e[0]-f[0]>=l&&$y(f,e,d)>Sy?c.push(e):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function $y(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function Ay(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function Dy(e,t,n){return n||e+(t?"_"+t:"")}const Cy=()=>{},My={init:Cy,add:Cy,rem:Cy,idx:0},jy={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Fy=Object.keys(jy);function Ty(e,t){return jy[e](t)}function Ny(e,t){return e.idx-t.idx}function Ry(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function Py(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function zy(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function By(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Iy(e,t){const n=t||Cu,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=jy[e]())}))};return e.forEach(n),Object.values(t).sort(Ny)}(e),i=e.slice().sort(Ny);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Ry,a.prototype.add=Py,a.prototype.rem=zy,a.prototype.set=By,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function Ly(e){this._key=e?Au(e):eg,this.reset()}Fy.forEach((e=>{jy[e]=function(e,t){return n=>vc({name:e,out:n||e},My,t)}(e,jy[e])}));const qy=Ly.prototype;function Uy(e){Fg.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}qy.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},qy.add=function(e){this._add.push(e)},qy.rem=function(e){this._rem.push(e)},qy.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},qy.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",_c(n,r)||(n[r]=1,++a);return a},qy.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=xc(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},qy.argmin=function(e){return this.extent(e)[0]||{}},qy.argmax=function(e){return this.extent(e)[1]||{}},qy.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},qy.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},qy.quartile=function(e){return this._get===e&&this._q||(this._q=Bg(this.values(),e),this._get=e),this._q},qy.q1=function(e){return this.quartile(e)[0]},qy.q2=function(e){return this.quartile(e)[1]},qy.q3=function(e){return this.quartile(e)[2]},qy.ci=function(e){return this._get===e&&this._ci||(this._ci=Ug(this.values(),1e3,.05,e),this._get=e),this._ci},qy.ci0=function(e){return this.ci(e)[0]},qy.ci1=function(e){return this.ci(e)[1]},Uy.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Fy},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},Ec(Uy,Fg,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=lc(_u(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=lc(e.groupby),this._dnames=this._dims.map((e=>{const t=wu(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:Ay(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,f,d,h,p,m;for(l!==o.length&&Eu("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],f=o[m],null==c&&"count"!==f&&Eu("Null aggregate field specified."),h=wu(c),p=Dy(f,h,s[m]),n.push(p),"count"!==f?(d=u[h],d||(i(c),d=u[h]=[],d.field=c,this._measures.push(d)),"count"!==f&&(this._countOnly=!1),d.push(Ty(f,p))):this._counts.push(p);return this._measures=this._measures.map((e=>Iy(e,e.field))),{}},cellkey:Ay(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new Ly),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?ag(t.tuple,a):ng(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,f;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Vy(e){Fg.call(this,null,e)}function Wy(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter((e=>!o[r(e)])),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?Pc(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function Hy(e){Fg.call(this,[],e)}function Gy(e){hg.call(this,null,Xy,e)}function Xy(e){return this.value&&!e.modified()?this.value:fc(e.fields,e.orders)}function Yy(e){Fg.call(this,null,e)}function Jy(e){Fg.call(this,null,e)}Vy.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},Ec(Vy,Fg,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(_u(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=Lg(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=Vu(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=xu(l,_u(t),e.name||"bin_"+wu(t))}}),Hy.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},Ec(Hy,Fg,{transform(e,t){const n=t.fork(t.ALL),r=Wy(eg,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(og(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),Ec(Gy,hg),Yy.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},Ec(Yy,Fg,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n((e=>i[e]=1+(i[e]||0))),c=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=ng({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),Jy.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},Ec(Jy,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push(ng(s)),(s={})[t]=a);return o}(s,i,a,e.filter||Fu)):n.mod=s,n.source=this.value,n.modifies(r)}});const Ky={kde:Zg,mixture:ay,normal:Qg,lognormal:iy,uniform:cy},Qy="function";function Zy(e,t){const n=e.function;_c(Ky,n)||Eu("Unknown distribution function: "+n);const r=Ky[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>Zy(e,t)))):typeof r[n]===Qy&&r[n](e[n]);return r}function ev(e){Fg.call(this,null,e)}const tv=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],nv={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:tv},{name:"weights",type:"number",array:!0}]};function rv(e,t){return e?e.map(((e,n)=>t[n]||wu(e))):null}function iv(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}ev.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:tv.concat(nv)},{name:"as",type:"string",array:!0,default:["value","density"]}]},Ec(ev,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Zy(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&Eu("Invalid density method: "+o),e.extent||r.data||Eu("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=Ey(o,e.extent||bc(r.data()),i,a).map((e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],ng(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function av(e){Fg.call(this,null,e)}av.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function ov(e){hg.call(this,null,sv,e),this.modified(!0)}function sv(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:xu((n=>t(n,e)),_u(t),wu(t))}function lv(e){Fg.call(this,[void 0,void 0],e)}function uv(e,t){hg.call(this,e),this.parent=t,this.count=0}function cv(e){Fg.call(this,{},e),this._keys=Oc();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function fv(e){hg.call(this,null,dv,e)}function dv(e){return this.value&&!e.modified()?this.value:Pu(e.name)?lc(e.name).map((e=>Au(e))):Au(e.name,e.as)}function hv(e){Fg.call(this,Oc(),e)}function pv(e){Fg.call(this,[],e)}function mv(e){Fg.call(this,[],e)}function gv(e){Fg.call(this,null,e)}function yv(e){Fg.call(this,[],e)}Ec(av,Fg,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=iv(t.source,e.groupby,Cu),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>Ic(bc(e,t))/30)(n,a),s=og(((e,t)=>a(e)-a(t))),l=e.as||"bin",u=r.length;let c,f=1/0,d=-1/0,h=0;for(;h<u;++h){const e=r[h].sort(s);c=-1;for(const t of Vg(e,o,i,a))t<f&&(f=t),t>d&&(d=t),e[++c][l]=t}return this.value={start:f,stop:d,step:o},t.reflow(!0).modifies(l)}}),Ec(ov,hg),lv.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},Ec(lv,Fg,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=Vu(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=wu(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),Ec(uv,hg,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),Ec(cv,Fg,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=_c(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new uv(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=eg(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(eg(e),t),s(t).add(e)})),o||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=eg(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{s(a.get(eg(e))).mod(e)})),o&&t.visit(t.REFLOW,(e=>{const t=eg(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),Ec(fv,hg),hv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},Ec(hv,Fg,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=eg(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(e=>{const t=eg(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(t=>{l(t,e)?a.push(t):r.set(eg(t),1)})),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),pv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},Ec(pv,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=rv(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),s=t.reduce(((e,t)=>Math.max(e,t.length)),0);let l,u,c,f=0;for(;f<s;++f){for(u=rg(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][f])?null:c;a&&(u[a]=f),n.add.push(u)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),mv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},Ec(mv,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(wu),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<l;++a)t=rg(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),gv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},Ec(gv,Fg,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),Ec(yv,Fg,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=ng(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const vv={value:"value",median:td,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:Jf,max:Yf},bv=[];function xv(e){Fg.call(this,[],e)}function wv(e){Uy.call(this,e)}function _v(e){Fg.call(this,null,e)}function kv(e){hg.call(this,null,Ov,e)}function Ov(e){return this.value&&!e.modified()?this.value:Tc(e.fields,e.flat)}function Sv(e){Fg.call(this,[],e),this._pending=null}function Ev(e,t,n){n.forEach(ng);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function $v(e){Fg.call(this,{},e)}function Av(e){hg.call(this,null,Dv,e)}function Dv(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function Cv(e){hg.call(this,null,Mv,e)}function Mv(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function jv(e){Fg.call(this,null,e)}function Fv(e){Uy.call(this,e)}function Tv(e){cv.call(this,e)}function Nv(e){Fg.call(this,null,e)}function Rv(e){Fg.call(this,null,e)}function Pv(e){Fg.call(this,null,e)}xv.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},Ec(xv,Fg,{transform(e,t){var n,r,i,a,o,s,l,u,c,f,d=t.fork(t.ALL),h=function(e){var t,n=e.method||vv.value;if(null!=vv[n])return n===vv.value?(t=void 0!==e.value?e.value:0,()=>t):vv[n];Eu("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=wu(e.field),g=wu(e.key),y=(e.groupby||[]).map(wu),v=function(e,t,n,r){var i,a,o,s,l,u,c,f,d=e=>e(f),h=[],p=r?r.slice():[],m={},g={};for(p.forEach(((e,t)=>m[e]=t+1)),s=0,c=e.length;s<c;++s)u=n(f=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(d):bv)+""])||(o=g[a]=[],h.push(o),o.values=i),o[l-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(o=0,u=v.length;o<u;++o)for(i=(n=v[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=v.domain[l],f={_impute:!0},s=0,c=i.length;s<c;++s)f[y[s]]=i[s];f[g]=a,f[m]=Number.isNaN(r)?r=h(n,p):r,b.push(ng(f))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d}}),wv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Fy},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},Ec(wv,Uy,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{vc(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),_v.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},Ec(_v,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=iv(r,e.groupby,e.field),a=(e.groupby||[]).map(wu),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&Eu("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=bc(r,e.field)),f=d=e.steps||d),i.forEach((t=>{const n=Zg(t,o)[s],r=e.counts?t.length:1;Ey(n,c||bc(t),f,d).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push(ng(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),Ec(kv,hg),Ec(Sv,Fg,{transform(e,t){const n=t.dataflow;if(this._pending)return Ev(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return Ev(this,t,n.parse(e.values,e.format));if(e.async){return{async:n.request(e.url,e.format).then((e=>(this._pending=lc(e.data),e=>e.touch(this))))}}return n.request(e.url,e.format).then((e=>Ev(this,t,lc(e.data))))}}),$v.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},Ec($v,Fg,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,f=o?t.SOURCE:t.ADD,d=t,h=e.as;return i?(u=i.length,s>1&&!h&&Eu('Multi-field lookup requires explicit "as" parameter.'),h&&h.length!==s*u&&Eu('The "as" parameter has too few output field names.'),h=h||i.map(wu),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[h[c]]=a;else for(t=0;t<u;++t,++c)e[h[c]]=i[t](o)}):(h||Eu("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[h[i]]=null==t?a:t}),o?d=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),f|=c?t.MOD:0),t.visit(f,l),d.modifies(h)}}),Ec(Av,hg),Ec(Cv,hg),Ec(jv,Fg,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Fv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Fy,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},Ec(Fv,Uy,{_transform:Uy.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=_u(n).concat(_u(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(dc),t?i.slice(0,t):i}(n,e.limit||0,t);t.changed()&&e.set("__pivot__",null,null,!0);return{key:e.key,groupby:e.groupby,ops:o.map((()=>i)),fields:o.map((e=>function(e,t,n,r){return xu((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:o.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),Ec(Tv,cv,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(eg(e),n,t,e);return(e.modified("field")||r&&t.modified(_u(r)))&&Eu("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(ng(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),Nv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},Ec(Nv,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=rv(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):ig;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,(e=>{const t=eg(e);n.rem.push(o[t]),o[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,ng({}));o[eg(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,o[eg(e)]))})),n}}),Ec(Rv,Fg,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Pv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function zv(e){Fg.call(this,null,e)}function Bv(e){Fg.call(this,[],e),this.count=0}function Iv(e){Fg.call(this,null,e)}function Lv(e){Fg.call(this,null,e),this.modified(!0)}function qv(e){Fg.call(this,null,e)}Ec(Pv,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=iv(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(wu),o=[],s=e.step||.01,l=e.probs||rd(s/2,1-1e-14,s),u=l.length;return i.forEach((e=>{const t=zg(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push(ng(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),Ec(zv,Fg,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=eg(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=rg(e);r[eg(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[eg(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),Bv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},Ec(Bv,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[eg(t)]=1,e)),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*qg()),r<o.length&&r>=l&&(t=o[r],a[eg(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=eg(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((e=>-1!==a[eg(e)]))),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,(e=>{a[eg(e)]||u(e)})),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[eg(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[eg(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter((e=>!a[eg(e)]))),this.count=s,this.value=n.source=o,n}}),Iv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},Ec(Iv,Fg,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=rd(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,ng(t)})),n.add=t.add.concat(this.value),n}}),Ec(Lv,Fg,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Uv=["unit0","unit1"];function Vv(e){Fg.call(this,Oc(),e)}function Wv(e){Fg.call(this,null,e)}qv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:lh,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Uv}]},Ec(qv,Fg,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?zh:Ph)(a.unit).offset,s=e.as||Uv,l=s[0],u=s[1],c=a.step;let f=a.start||1/0,d=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(_u(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,d=-1/0),t.visit(h,(e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<f&&(f=i),s>d&&(d=s))})),a.start=f,a.stop=d,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:ap({extent:e.extent||bc(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=ch(r),o=this.value||{},s=(n?Th:Mh)(a,i);return s.unit=Uu(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),Ec(Vv,Fg,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),Ec(Wv,Fg,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(og(e.sort)):t.source).map(e.field))}});const Hv={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Hv.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||Eu("ntile num must be greater than zero.");const n=Hv.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||Eu("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n){if(null!=e(t[n]))return n}return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};const Gv=Object.keys(Hv);function Xv(e){const t=lc(e.ops),n=lc(e.fields),r=lc(e.params),i=lc(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let f=!0;function d(e){lc(_u(e)).forEach((e=>s[e]=1))}d(e.sort),t.forEach(((e,t)=>{const s=n[t],h=wu(s),p=Dy(e,h,i[t]);if(d(s),a.push(p),_c(Hv,e))o.push(function(e,t,n,r){const i=Hv[e](t,n);return{init:i.init||Mu,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&Eu("Null aggregate field specified."),"count"===e)return void u.push(p);f=!1;let t=l[h];t||(t=l[h]=[],t.field=s,c.push(t)),t.push(Ty(e,p))}})),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>Iy(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new Ly;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,f)),this.inputs=Object.keys(s)}const Yv=Xv.prototype;function Jv(e){Fg.call(this,{},e),this._mlen=0,this._mods=[]}function Kv(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?Pf(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||gc(-1)};t.init();for(let e=0;e<l;++e)Qv(c,o,e,l),a&&Zv(c,u),t.update(c,s[e])}function Qv(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Zv(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}Yv.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},Yv.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},Jv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Gv.concat(Fy)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},Ec(Jv,Fg,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=og(e.sort),i=Ay(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new Xv(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)Kv(this._mods[t],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=Wy(eg),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});var eb=Object.freeze({__proto__:null,aggregate:Uy,bin:Vy,collect:Hy,compare:Gy,countpattern:Yy,cross:Jy,density:ev,dotbin:av,expression:ov,extent:lv,facet:cv,field:fv,filter:hv,flatten:pv,fold:mv,formula:gv,generate:yv,impute:xv,joinaggregate:wv,kde:_v,key:kv,load:Sv,lookup:$v,multiextent:Av,multivalues:Cv,params:jv,pivot:Fv,prefacet:Tv,project:Nv,proxy:Rv,quantile:Pv,relay:zv,sample:Bv,sequence:Iv,sieve:Lv,subflow:uv,timeunit:qv,tupleindex:Vv,values:Wv,window:Jv});const tb=Math.PI,nb=2*tb,rb=1e-6,ib=nb-rb;function ab(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function ob(){return new ab}function sb(e){return function(){return e}}ab.prototype=ob.prototype={constructor:ab,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,l=r-t,u=a-e,c=o-t,f=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>rb)if(Math.abs(c*s-l*u)>rb&&i){var d=n-a,h=r-o,p=s*s+l*l,m=d*d+h*h,g=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((tb-Math.acos((p+f-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>rb&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>rb||Math.abs(this._y1-u)>rb)&&(this._+="L"+l+","+u),n&&(f<0&&(f=f%nb+nb),f>ib?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>rb&&(this._+="A"+n+","+n+",0,"+ +(f>=tb)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var lb=Math.abs,ub=Math.atan2,cb=Math.cos,fb=Math.max,db=Math.min,hb=Math.sin,pb=Math.sqrt,mb=1e-12,gb=Math.PI,yb=gb/2,vb=2*gb;function bb(e){return e>1?0:e<-1?gb:Math.acos(e)}function xb(e){return e>=1?yb:e<=-1?-yb:Math.asin(e)}function wb(e){return e.innerRadius}function _b(e){return e.outerRadius}function kb(e){return e.startAngle}function Ob(e){return e.endAngle}function Sb(e){return e&&e.padAngle}function Eb(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,f=s-a,d=f*l-c*u;if(!(d*d<mb))return[e+(d=(c*(t-a)-f*(e-i))/d)*l,t+d*u]}function $b(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/pb(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,m=r+f,g=(d+p)/2,y=(h+m)/2,v=p-d,b=m-h,x=v*v+b*b,w=i-a,_=d*m-p*h,k=(b<0?-1:1)*pb(fb(0,w*w*x-_*_)),O=(_*b-v*k)/x,S=(-_*v-b*k)/x,E=(_*b+v*k)/x,$=(-_*v+b*k)/x,A=O-g,D=S-y,C=E-g,M=$-y;return A*A+D*D>C*C+M*M&&(O=E,S=$),{cx:O,cy:S,x01:-c,y01:-f,x11:O*(i/w-1),y11:S*(i/w-1)}}function Ab(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Db(e){this._context=e}function Cb(e){return new Db(e)}function Mb(e){return e[0]}function jb(e){return e[1]}function Fb(e,t){var n=sb(!0),r=null,i=Cb,a=null;function o(o){var s,l,u,c=(o=Ab(o)).length,f=!1;for(null==r&&(a=i(u=ob())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?Mb:sb(e),t="function"==typeof t?t:void 0===t?jb:sb(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:sb(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:sb(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:sb(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o}function Tb(e,t,n){var r=null,i=sb(!0),a=null,o=Cb,s=null;function l(l){var u,c,f,d,h,p=(l=Ab(l)).length,m=!1,g=new Array(p),y=new Array(p);for(null==a&&(s=o(h=ob())),u=0;u<=p;++u){if(!(u<p&&i(d=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=u-1;f>=c;--f)s.point(g[f],y[f]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(d,u,l),y[u]=+t(d,u,l),s.point(r?+r(d,u,l):g[u],n?+n(d,u,l):y[u]))}if(h)return s=null,h+""||null}function u(){return Fb().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?Mb:sb(+e),t="function"==typeof t?t:sb(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?jb:sb(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:sb(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:sb(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:sb(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:sb(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:sb(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:sb(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:sb(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l}Db.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var Nb={draw:function(e,t){var n=Math.sqrt(t/gb);e.moveTo(n,0),e.arc(0,0,n,0,vb)}};function Rb(){}function Pb(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function zb(e){this._context=e}function Bb(e){this._context=e}function Ib(e){this._context=e}function Lb(e,t){this._basis=new zb(e),this._beta=t}zb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Pb(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Pb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Bb.prototype={areaStart:Rb,areaEnd:Rb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Pb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Ib.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Pb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Lb.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)r=l/n,this._basis.point(this._beta*e[l]+(1-this._beta)*(i+r*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var qb=function e(t){function n(e){return 1===t?new zb(e):new Lb(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function Ub(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Vb(e,t){this._context=e,this._k=(1-t)/6}Vb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Ub(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Ub(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Wb=function e(t){function n(e){return new Vb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Hb(e,t){this._context=e,this._k=(1-t)/6}Hb.prototype={areaStart:Rb,areaEnd:Rb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Ub(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Gb=function e(t){function n(e){return new Hb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Xb(e,t){this._context=e,this._k=(1-t)/6}Xb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Ub(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Yb=function e(t){function n(e){return new Xb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Jb(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>mb){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>mb){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function Kb(e,t){this._context=e,this._alpha=t}Kb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Jb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Qb=function e(t){function n(e){return t?new Kb(e,t):new Vb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Zb(e,t){this._context=e,this._alpha=t}Zb.prototype={areaStart:Rb,areaEnd:Rb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Jb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var ex=function e(t){function n(e){return t?new Zb(e,t):new Hb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function tx(e,t){this._context=e,this._alpha=t}tx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Jb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var nx=function e(t){function n(e){return t?new tx(e,t):new Xb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function rx(e){this._context=e}function ix(e){return e<0?-1:1}function ax(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(ix(a)+ix(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function ox(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function sx(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function lx(e){this._context=e}function ux(e){this._context=new cx(e)}function cx(e){this._context=e}function fx(e){this._context=e}function dx(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function hx(e,t){this._context=e,this._t=t}function px(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}rx.prototype={areaStart:Rb,areaEnd:Rb,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},lx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:sx(this,this._t0,ox(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,sx(this,ox(this,n=ax(this,e,t)),n);break;default:sx(this,this._t0,n=ax(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(ux.prototype=Object.create(lx.prototype)).point=function(e,t){lx.prototype.point.call(this,t,e)},cx.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},fx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=dx(e),i=dx(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},hx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const mx=()=>"undefined"!=typeof Image?Image:null;function gx(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function yx(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const vx=Symbol("implicit");function bx(){var e=new Map,t=[],n=[],r=vx;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==vx)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return bx(t,n).unknown(r)},gx.apply(i,arguments),i}function xx(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function wx(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function _x(){}var kx=.7,Ox=1/kx,Sx="\\s*([+-]?\\d+)\\s*",Ex="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",$x="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ax=/^#([0-9a-f]{3,8})$/,Dx=new RegExp("^rgb\\("+[Sx,Sx,Sx]+"\\)$"),Cx=new RegExp("^rgb\\("+[$x,$x,$x]+"\\)$"),Mx=new RegExp("^rgba\\("+[Sx,Sx,Sx,Ex]+"\\)$"),jx=new RegExp("^rgba\\("+[$x,$x,$x,Ex]+"\\)$"),Fx=new RegExp("^hsl\\("+[Ex,$x,$x]+"\\)$"),Tx=new RegExp("^hsla\\("+[Ex,$x,$x,Ex]+"\\)$"),Nx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Rx(){return this.rgb().formatHex()}function Px(){return this.rgb().formatRgb()}function zx(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ax.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Bx(t):3===n?new Ux(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Ix(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Ix(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Dx.exec(e))?new Ux(t[1],t[2],t[3],1):(t=Cx.exec(e))?new Ux(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Mx.exec(e))?Ix(t[1],t[2],t[3],t[4]):(t=jx.exec(e))?Ix(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Fx.exec(e))?Gx(t[1],t[2]/100,t[3]/100,1):(t=Tx.exec(e))?Gx(t[1],t[2]/100,t[3]/100,t[4]):Nx.hasOwnProperty(e)?Bx(Nx[e]):"transparent"===e?new Ux(NaN,NaN,NaN,0):null}function Bx(e){return new Ux(e>>16&255,e>>8&255,255&e,1)}function Ix(e,t,n,r){return r<=0&&(e=t=n=NaN),new Ux(e,t,n,r)}function Lx(e){return e instanceof _x||(e=zx(e)),e?new Ux((e=e.rgb()).r,e.g,e.b,e.opacity):new Ux}function qx(e,t,n,r){return 1===arguments.length?Lx(e):new Ux(e,t,n,null==r?1:r)}function Ux(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Vx(){return"#"+Hx(this.r)+Hx(this.g)+Hx(this.b)}function Wx(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Hx(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Gx(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Jx(e,t,n,r)}function Xx(e){if(e instanceof Jx)return new Jx(e.h,e.s,e.l,e.opacity);if(e instanceof _x||(e=zx(e)),!e)return new Jx;if(e instanceof Jx)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Jx(o,s,l,e.opacity)}function Yx(e,t,n,r){return 1===arguments.length?Xx(e):new Jx(e,t,n,null==r?1:r)}function Jx(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Kx(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}xx(_x,zx,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Rx,formatHex:Rx,formatHsl:function(){return Xx(this).formatHsl()},formatRgb:Px,toString:Px}),xx(Ux,qx,wx(_x,{brighter:function(e){return e=null==e?Ox:Math.pow(Ox,e),new Ux(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?kx:Math.pow(kx,e),new Ux(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Vx,formatHex:Vx,formatRgb:Wx,toString:Wx})),xx(Jx,Yx,wx(_x,{brighter:function(e){return e=null==e?Ox:Math.pow(Ox,e),new Jx(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?kx:Math.pow(kx,e),new Jx(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Ux(Kx(e>=240?e-240:e+120,i,r),Kx(e,i,r),Kx(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Qx=Math.PI/180,Zx=180/Math.PI,ew=.96422,tw=.82521,nw=4/29,rw=6/29,iw=3*rw*rw;function aw(e){if(e instanceof sw)return new sw(e.l,e.a,e.b,e.opacity);if(e instanceof pw)return mw(e);e instanceof Ux||(e=Lx(e));var t,n,r=fw(e.r),i=fw(e.g),a=fw(e.b),o=lw((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=lw((.4360747*r+.3850649*i+.1430804*a)/ew),n=lw((.0139322*r+.0971045*i+.7141733*a)/tw)),new sw(116*o-16,500*(t-o),200*(o-n),e.opacity)}function ow(e,t,n,r){return 1===arguments.length?aw(e):new sw(e,t,n,null==r?1:r)}function sw(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function lw(e){return e>.008856451679035631?Math.pow(e,1/3):e/iw+nw}function uw(e){return e>rw?e*e*e:iw*(e-nw)}function cw(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function fw(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function dw(e){if(e instanceof pw)return new pw(e.h,e.c,e.l,e.opacity);if(e instanceof sw||(e=aw(e)),0===e.a&&0===e.b)return new pw(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Zx;return new pw(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function hw(e,t,n,r){return 1===arguments.length?dw(e):new pw(e,t,n,null==r?1:r)}function pw(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function mw(e){if(isNaN(e.h))return new sw(e.l,0,0,e.opacity);var t=e.h*Qx;return new sw(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}xx(sw,ow,wx(_x,{brighter:function(e){return new sw(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new sw(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Ux(cw(3.1338561*(t=ew*uw(t))-1.6168667*(e=1*uw(e))-.4906146*(n=tw*uw(n))),cw(-.9787684*t+1.9161415*e+.033454*n),cw(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),xx(pw,hw,wx(_x,{brighter:function(e){return new pw(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new pw(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return mw(this).rgb()}}));var gw=-.14861,yw=1.78277,vw=-.29227,bw=-.90649,xw=1.97294,ww=xw*bw,_w=xw*yw,kw=yw*vw-bw*gw;function Ow(e){if(e instanceof Ew)return new Ew(e.h,e.s,e.l,e.opacity);e instanceof Ux||(e=Lx(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(kw*r+ww*t-_w*n)/(kw+ww-_w),a=r-i,o=(xw*(n-i)-vw*a)/bw,s=Math.sqrt(o*o+a*a)/(xw*i*(1-i)),l=s?Math.atan2(o,a)*Zx-120:NaN;return new Ew(l<0?l+360:l,s,i,e.opacity)}function Sw(e,t,n,r){return 1===arguments.length?Ow(e):new Ew(e,t,n,null==r?1:r)}function Ew(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function $w(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Aw(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return $w((n-r/t)*t,o,i,a,s)}}function Dw(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return $w((n-r/t)*t,i,a,o,s)}}xx(Ew,Sw,wx(_x,{brighter:function(e){return e=null==e?Ox:Math.pow(Ox,e),new Ew(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?kx:Math.pow(kx,e),new Ew(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Qx,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Ux(255*(t+n*(gw*r+yw*i)),255*(t+n*(vw*r+bw*i)),255*(t+n*(xw*r)),this.opacity)}}));var Cw=e=>()=>e;function Mw(e,t){return function(n){return e+n*t}}function jw(e,t){var n=t-e;return n?Mw(e,n>180||n<-180?n-360*Math.round(n/360):n):Cw(isNaN(e)?t:e)}function Fw(e){return 1==(e=+e)?Tw:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Cw(isNaN(t)?n:t)}}function Tw(e,t){var n=t-e;return n?Mw(e,n):Cw(isNaN(e)?t:e)}var Nw=function e(t){var n=Fw(t);function r(e,t){var r=n((e=qx(e)).r,(t=qx(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Tw(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Rw(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=qx(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var Pw=Rw(Aw),zw=Rw(Dw);function Bw(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Iw(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Lw(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Xw(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function qw(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Uw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Vw(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Xw(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Ww=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Hw=new RegExp(Ww.source,"g");function Gw(e,t){var n,r,i,a=Ww.lastIndex=Hw.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=Ww.exec(e))&&(r=Hw.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:Uw(n,r)})),a=Hw.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Xw(e,t){var n,r=typeof t;return null==t||"boolean"===r?Cw(t):("number"===r?Uw:"string"===r?(n=zx(t))?(t=n,Nw):Gw:t instanceof zx?Nw:t instanceof Date?qw:Iw(t)?Bw:Array.isArray(t)?Lw:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Vw:Uw)(e,t)}function Yw(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Jw,Kw=180/Math.PI,Qw={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Zw(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Kw,skewX:Math.atan(l)*Kw,scaleX:o,scaleY:s}}function e_(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:Uw(e,i)},{i:l-2,x:Uw(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Uw(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Uw(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Uw(e,n)},{i:s-2,x:Uw(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var t_=e_((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Qw:Zw(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),n_=e_((function(e){return null==e?Qw:(Jw||(Jw=document.createElementNS("http://www.w3.org/2000/svg","g")),Jw.setAttribute("transform",e),(e=Jw.transform.baseVal.consolidate())?Zw((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Qw)}),", ",")",")");function r_(e){return((e=Math.exp(e))+1/e)/2}var i_=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[0],f=i[1],d=i[2],h=c-s,p=f-l,m=h*h+p*p;if(m<1e-12)o=Math.log(d/u)/t,a=function(e){return[s+e*h,l+e*p,u*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),y=(d*d-u*u+r*m)/(2*u*n*g),v=(d*d-u*u-r*m)/(2*d*n*g),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);o=(x-b)/t,a=function(e){var r=e*o,i=r_(b),a=u/(n*g)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,l+a*p,u*i/r_(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function a_(e){return function(t,n){var r=e((t=Yx(t)).h,(n=Yx(n)).h),i=Tw(t.s,n.s),a=Tw(t.l,n.l),o=Tw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var o_=a_(jw),s_=a_(Tw);function l_(e){return function(t,n){var r=e((t=hw(t)).h,(n=hw(n)).h),i=Tw(t.c,n.c),a=Tw(t.l,n.l),o=Tw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var u_=l_(jw),c_=l_(Tw);function f_(e){return function t(n){function r(t,r){var i=e((t=Sw(t)).h,(r=Sw(r)).h),a=Tw(t.s,r.s),o=Tw(t.l,r.l),s=Tw(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}var d_=f_(jw),h_=f_(Tw);function p_(e,t){void 0===t&&(t=e,e=Xw);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var m_=Object.freeze({__proto__:null,interpolate:Xw,interpolateArray:function(e,t){return(Iw(t)?Bw:Lw)(e,t)},interpolateBasis:Aw,interpolateBasisClosed:Dw,interpolateDate:qw,interpolateDiscrete:function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},interpolateHue:function(e,t){var n=jw(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},interpolateNumber:Uw,interpolateNumberArray:Bw,interpolateObject:Vw,interpolateRound:Yw,interpolateString:Gw,interpolateTransformCss:t_,interpolateTransformSvg:n_,interpolateZoom:i_,interpolateRgb:Nw,interpolateRgbBasis:Pw,interpolateRgbBasisClosed:zw,interpolateHsl:o_,interpolateHslLong:s_,interpolateLab:function(e,t){var n=Tw((e=ow(e)).l,(t=ow(t)).l),r=Tw(e.a,t.a),i=Tw(e.b,t.b),a=Tw(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}},interpolateHcl:u_,interpolateHclLong:c_,interpolateCubehelix:d_,interpolateCubehelixLong:h_,piecewise:p_,quantize:function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}});function g_(e){return+e}var y_=[0,1];function v_(e){return e}function b_(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function x_(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=b_(i,r),a=n(o,a)):(r=b_(r,i),a=n(a,o)),function(e){return a(r(e))}}function w_(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=b_(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=If(e,t,1,r)-1;return a[n](i[n](t))}}function __(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function k_(){var e,t,n,r,i,a,o=y_,s=y_,l=Xw,u=v_;function c(){var e=Math.min(o.length,s.length);return u!==v_&&(u=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?w_:x_,i=a=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return f.invert=function(n){return u(t((a||(a=r(s,o.map(e),Uw)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,g_),c()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),l=Yw,c()},f.clamp=function(e){return arguments.length?(u=!!e||v_,c()):u!==v_},f.interpolate=function(e){return arguments.length?(l=e,c()):l},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function O_(){return k_()(v_,v_)}function S_(e,t,n,r){var i,a=Xf(e,t,n);switch((r=ud(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=wd(a,o))||(r.precision=i),gd(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=_d(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=xd(a))||(r.precision=i-2*("%"===r.type))}return md(r)}function E_(e){var t=e.domain;return e.ticks=function(e){var n=t();return Hf(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return S_(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=Gf(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function $_(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function A_(e){return Math.log(e)}function D_(e){return Math.exp(e)}function C_(e){return-Math.log(-e)}function M_(e){return-Math.exp(-e)}function j_(e){return isFinite(e)?+("1e"+e):e<0?0:e}function F_(e){return function(t){return-e(-t)}}function T_(e){var t,n,r=e(A_,D_),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?j_:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=F_(t),n=F_(n),e(C_,M_)):e(A_,D_),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(d=s,s=l,l=d);var u,c,f,d=t(s),h=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(c=1,u=n(d);c<a;++c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}}else for(;d<=h;++d)for(c=a-1,u=n(d);c>=1;--c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}2*m.length<p&&(m=Hf(s,l,p))}else m=Hf(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=md(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i($_(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function N_(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function R_(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function P_(e){var t=1,n=e(N_(t),R_(t));return n.constant=function(n){return arguments.length?e(N_(t=+n),R_(t)):t},E_(n)}function z_(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function B_(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function I_(e){return e<0?-e*e:e*e}function L_(e){var t=e(v_,v_),n=1;function r(){return 1===n?e(v_,v_):.5===n?e(B_,I_):e(z_(n),z_(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},E_(t)}function q_(){var e=L_(k_());return e.copy=function(){return __(e,q_()).exponent(e.exponent())},gx.apply(e,arguments),e}var U_=1e3,V_=6e4,W_=36e5,H_=864e5,G_=2592e6,X_=31536e6;function Y_(e){return new Date(e)}function J_(e){return e instanceof Date?+e:+new Date(+e)}function K_(e,t,n,r,i,a,o,s,l){var u=O_(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),y=l("%b %d"),v=l("%B"),b=l("%Y"),x=[[o,1,U_],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,V_],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,W_],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,H_],[r,2,1728e5],[n,1,6048e5],[t,1,G_],[t,3,7776e6],[e,1,X_]];function w(s){return(o(s)<s?d:a(s)<s?h:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:y:e(s)<s?v:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=Pf((function(e){return e[2]})).right(x,a);return o===x.length?(i=Xf(n/X_,r/X_,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(Xf(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?f(Array.from(e,J_)):f().map(Y_)},u.ticks=function(e){var t,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=f();return(e=_(e,t[0],t[t.length-1]))?f($_(t,e)):u},u.copy=function(){return __(u,K_(e,t,n,r,i,a,o,s,l))},u}function Q_(){var e,t,n,r,i,a=0,o=1,s=v_,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(Xw),u.rangeRound=c(Yw),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function Z_(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ek(){var e=E_(Q_()(v_));return e.copy=function(){return Z_(e,ek())},yx.apply(e,arguments)}function tk(){var e=L_(Q_());return e.copy=function(){return Z_(e,tk()).exponent(e.exponent())},yx.apply(e,arguments)}function nk(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,f=v_,d=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),f(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,f=p_(e,[n,r,i]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h):[s,l,u]},h.clamp=function(e){return arguments.length?(d=!!e,h):d},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=p(Xw),h.rangeRound=p(Yw),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h}}function rk(){var e=L_(nk());return e.copy=function(){return Z_(e,rk()).exponent(e.exponent())},yx.apply(e,arguments)}function ik(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const ak="linear",ok="log",sk="pow",lk="sqrt",uk="symlog",ck="time",fk="utc",dk="sequential",hk="diverging",pk="quantile",mk="quantize",gk="threshold",yk="ordinal",vk="point",bk="band",xk="bin-ordinal",wk="continuous",_k="discrete",kk="discretizing",Ok="interpolating",Sk="temporal";function Ek(){const e=bx().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],f=a[1-c],d=ik(e,s,l);let h=a[c-0];r=(f-h)/(d||1),o&&(r=Math.floor(r)),h+=(f-h-r*(e-s))*u,i=r*(1-s),o&&(h=Math.round(h),i=Math.round(i));const p=rd(e).map((e=>h+r*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,f=+e[0],d=+e[1];return f!=f||d!=d||(d<f&&(c=f,f=d,d=c),d<o[0]||f>a[1-r])?void 0:(l=Math.max(0,If(o,f)-1),u=f===d?l:If(o,d)-1,f-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return Ek().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function $k(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return $k(t())},e}var Ak=Array.prototype.map;function Dk(e){return Ak.call(e,Vu)}const Ck=Array.prototype.slice;const Mk={};function jk(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?function(e){return function(t){let n,r=t[0],i=t[1];return i<r&&(n=r,r=i,i=n),[e.invert(r),e.invert(i)]}}(n):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n};return r.metadata=Hc(lc(n)),r}function Fk(e,t,n){return arguments.length>1?(Mk[e]=jk(e,t,n),this):Tk(e)?Mk[e]:void 0}function Tk(e){return _c(Mk,e)}function Nk(e,t){const n=Mk[e];return n&&n.metadata[t]}function Rk(e){return Nk(e,wk)}function Pk(e){return Nk(e,_k)}function zk(e){return Nk(e,kk)}function Bk(e){return Nk(e,ok)}function Ik(e){return Nk(e,Ok)}function Lk(e){return Nk(e,pk)}Fk("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,g_),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,g_):[0,1],E_(r)})),Fk(ak,(function e(){var t=O_();return t.copy=function(){return __(t,e())},gx.apply(t,arguments),E_(t)}),wk),Fk(ok,(function e(){var t=T_(k_()).domain([1,10]);return t.copy=function(){return __(t,e()).base(t.base())},gx.apply(t,arguments),t}),[wk,ok]),Fk(sk,q_,wk),Fk(lk,(function(){return q_.apply(null,arguments).exponent(.5)}),wk),Fk(uk,(function e(){var t=P_(k_());return t.copy=function(){return __(t,e()).constant(t.constant())},gx.apply(t,arguments)}),wk),Fk(ck,(function(){return gx.apply(K_(Ld,Id,Pd,Nd,Td,Fd,jd,Ed,fp).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[wk,Sk]),Fk(fk,(function(){return gx.apply(K_(Jd,Yd,Hd,Vd,Ud,qd,jd,Ed,hp).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[wk,Sk]),Fk(dk,ek,[wk,Ok]),Fk("".concat(dk,"-").concat(ak),ek,[wk,Ok]),Fk("".concat(dk,"-").concat(ok),(function e(){var t=T_(Q_()).domain([1,10]);return t.copy=function(){return Z_(t,e()).base(t.base())},yx.apply(t,arguments)}),[wk,Ok,ok]),Fk("".concat(dk,"-").concat(sk),tk,[wk,Ok]),Fk("".concat(dk,"-").concat(lk),(function(){return tk.apply(null,arguments).exponent(.5)}),[wk,Ok]),Fk("".concat(dk,"-").concat(uk),(function e(){var t=P_(Q_());return t.copy=function(){return Z_(t,e()).constant(t.constant())},yx.apply(t,arguments)}),[wk,Ok]),Fk("".concat(hk,"-").concat(ak),(function e(){var t=E_(nk()(v_));return t.copy=function(){return Z_(t,e())},yx.apply(t,arguments)}),[wk,Ok]),Fk("".concat(hk,"-").concat(ok),(function e(){var t=T_(nk()).domain([.1,1,10]);return t.copy=function(){return Z_(t,e()).base(t.base())},yx.apply(t,arguments)}),[wk,Ok,ok]),Fk("".concat(hk,"-").concat(sk),rk,[wk,Ok]),Fk("".concat(hk,"-").concat(lk),(function(){return rk.apply(null,arguments).exponent(.5)}),[wk,Ok]),Fk("".concat(hk,"-").concat(uk),(function e(){var t=P_(nk());return t.copy=function(){return Z_(t,e()).constant(t.constant())},yx.apply(t,arguments)}),[wk,Ok]),Fk(pk,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=ed(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[If(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(Rf),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},gx.apply(o,arguments)}),[kk,pk]),Fk(mk,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[If(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},gx.apply(E_(s),arguments)}),kk),Fk(gk,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[If(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},gx.apply(a,arguments)}),kk),Fk(xk,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(If(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=Dk(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Ck.call(e),r):n.slice()},r.tickFormat=function(e,n){return S_(t[0],Uu(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[_k,kk]),Fk(yk,bx,_k),Fk(bk,Ek,_k),Fk(vk,(function(){return $k(Ek().paddingInner(1))}),_k);const qk=["clamp","base","constant","exponent"];function Uk(e,t){const n=t[0],r=Uu(t)-n;return function(t){return e(n+t*r)}}function Vk(e,t,n){return p_(Gk(t||"rgb",n),e)}function Wk(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Hk(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=Fk(a)().domain([t,n]).range([0,1]),qk.forEach((t=>e[t]?o[t](e[t]()):0)),o):gc(.5)}function Gk(e,t){const n=m_[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Xk(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Yk(e,t){for(const n in e)Kk(n,t(e[n]))}const Jk={};function Kk(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Jk[e]=t,this):Jk[e]}Yk({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Xk),Yk({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>Vk(Xk(e))));const Qk="symbol",Zk=e=>Pu(e)?e.map((e=>String(e))):String(e),eO=(e,t)=>e[1]-t[1],tO=(e,t)=>t[1]-e[1];function nO(e,t,n){let r;return Mc(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Ic(e.domain())/n||1)))),zu(t)&&(r=t.step,t=t.interval),Fc(t)&&(t=e.type===ck?Ph(t):e.type==fk?zh(t):Eu("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function rO(e,t,n){let r=e.range(),i=r[0],a=Uu(r),o=eO;if(i>a&&(r=a,a=i,i=r,o=tO),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(o).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],Uu(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function iO(e,t){return e.bins?rO(e,e.bins):e.ticks?e.ticks(t):e.domain()}function aO(e,t,n,r,i,a){const o=t.type;let s=Zk;if(o===ck||i===ck)s=e.timeFormat(r);else if(o===fk||i===fk)s=e.utcFormat(r);else if(Bk(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=oO(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function oO(e,t,n){const r=iO(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const sO={[pk]:"quantiles",[mk]:"thresholds",[gk]:"domain"},lO={[pk]:"quantiles",[mk]:"domain"};function uO(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=Uu(e),t}(e.bins):e.type===ok?oO(e,t,!0):sO[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[sO[e.type]]()):iO(e,t)}function cO(e,t,n,r,i,a,o){const s=lO[t.type]&&a!==ck&&a!==fk?function(e,t,n){const r=t[lO[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):aO(e,t,n,i,a,o);return r===Qk&&(e=>sO[e.type]||e.bins)(t)?fO(s):"discrete"===r?hO(s):pO(s)}const fO=e=>(t,n,r)=>{const i=dO(r[n+1],dO(r.max,1/0)),a=mO(t,e),o=mO(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a},dO=(e,t)=>null!=e?e:t,hO=e=>(t,n)=>n?e(t):null,pO=e=>t=>e(t),mO=(e,t)=>Number.isFinite(e)?t(e):null;function gO(e,t,n,r){const i=r||t.type;return Fc(n)&&function(e){return Nk(e,Sk)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==ck?n||i!==fk?cO(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function yO(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=gO(e,t,n.format,n.formatType);if(zk(t.type)){const e=uO(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(Pk(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(Uu(e)))}}let vO=0;const bO="p_";function xO(e){return e&&e.gradient}function wO(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?bO:"";return i||(i=e.id="gradient_"+vO++,"radial"===r?(e.x1=_O(e.x1,.5),e.y1=_O(e.y1,.5),e.r1=_O(e.r1,0),e.x2=_O(e.x2,.5),e.y2=_O(e.y2,.5),e.r2=_O(e.r2,.5),a=bO):(e.x1=_O(e.x1,0),e.y1=_O(e.y1,0),e.x2=_O(e.x2,1),e.y2=_O(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function _O(e,t){return null!=e?e:t}function kO(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const OO={basis:{curve:function(e){return new zb(e)}},"basis-closed":{curve:function(e){return new Bb(e)}},"basis-open":{curve:function(e){return new Ib(e)}},bundle:{curve:qb,tension:"beta",value:.85},cardinal:{curve:Wb,tension:"tension",value:0},"cardinal-open":{curve:Yb,tension:"tension",value:0},"cardinal-closed":{curve:Gb,tension:"tension",value:0},"catmull-rom":{curve:Qb,tension:"alpha",value:.5},"catmull-rom-closed":{curve:ex,tension:"alpha",value:.5},"catmull-rom-open":{curve:nx,tension:"alpha",value:.5},linear:{curve:Cb},"linear-closed":{curve:function(e){return new rx(e)}},monotone:{horizontal:function(e){return new ux(e)},vertical:function(e){return new lx(e)}},natural:{curve:function(e){return new fx(e)}},step:{curve:function(e){return new hx(e,.5)}},"step-after":{curve:function(e){return new hx(e,1)}},"step-before":{curve:function(e){return new hx(e,0)}}};function SO(e,t,n){var r=_c(OO,e)&&OO[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const EO={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},$O=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function AO(e){const t=[];let n,r,i,a,o,s,l,u,c,f;const d=e.slice().replace($O[0],"###$1").split($O[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],r=n.slice(1).trim().replace($O[2],"$1###$2").replace($O[3],"$1###$2").split($O[4]),o=n.charAt(0),i=[o],u=0,f=r.length;u<f;++u)(a=+r[u])===a&&i.push(a);if(s=EO[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const DO=Math.PI/180,CO=Math.PI/2,MO=2*Math.PI,jO=Math.sqrt(3)/2;var FO={},TO={},NO=[].join;function RO(e){const t=NO.call(e);if(TO[t])return TO[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*m,_=r+m+x*p,k=n+g,O=r+y,S=k+x*y,E=O-x*g;return TO[t]=[c*w+f*_,d*w+h*_,c*S+f*E,d*S+h*E,c*k+f*O,d*k+h*O]}const PO=["l",0,0,0,0,0,0,0];function zO(e,t,n){const r=PO[0]=e[0];if("a"===r||"A"===r)PO[1]=t*e[1],PO[2]=n*e[2],PO[3]=e[3],PO[4]=e[4],PO[5]=e[5],PO[6]=t*e[6],PO[7]=n*e[7];else if("h"===r||"H"===r)PO[1]=t*e[1];else if("v"===r||"V"===r)PO[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)PO[i]=(i%2==1?t:n)*e[i];return PO}function BO(e,t,n,r,i,a){var o,s,l,u,c,f=null,d=0,h=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(o=t[g],1===i&&1===a||(o=zO(o,i,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+r);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+r);break;case"h":d+=o[1],e.lineTo(d+n,h+r);break;case"H":d=o[1],e.lineTo(d+n,h+r);break;case"v":h+=o[1],e.lineTo(d+n,h+r);break;case"V":h=o[1],e.lineTo(d+n,h+r);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+r);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+r);break;case"c":s=d+o[5],l=h+o[6],p=d+o[3],m=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+r,p+n,m+r,s+n,l+r),d=s,h=l;break;case"C":d=o[5],h=o[6],p=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,p+n,m+r,d+n,h+r);break;case"s":s=d+o[3],l=h+o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,d+o[1]+n,h+o[2]+r,s+n,l+r),p=d+o[1],m=h+o[2],d=s,h=l;break;case"S":s=o[3],l=o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"q":s=d+o[3],l=h+o[4],p=d+o[1],m=h+o[2],e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"Q":s=o[3],l=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"t":s=d+o[1],l=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,m=h):"t"===f[0]?(p=2*d-u,m=2*h-c):"q"===f[0]&&(p=2*d-p,m=2*h-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),h=l,p=(d=s)+o[1],m=h+o[2];break;case"T":s=o[1],l=o[2],p=2*d-p,m=2*h-m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"a":IO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+r]),d+=o[6],h+=o[7];break;case"A":IO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function IO(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=NO.call(arguments);if(FO[u])return FO[u];const c=o*DO,f=Math.sin(c),d=Math.cos(c),h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5;let m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=d/n,y=f/n,v=-f/r,b=d/r,x=g*s+y*l,w=v*s+b*l,_=g*e+y*t,k=v*e+b*t;let O=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;O<0&&(O=0);let S=Math.sqrt(O);a==i&&(S=-S);const E=.5*(x+_)-S*(k-w),$=.5*(w+k)+S*(_-x),A=Math.atan2(w-$,x-E);let D=Math.atan2(k-$,_-E)-A;D<0&&1===a?D+=MO:D>0&&0===a&&(D-=MO);const C=Math.ceil(Math.abs(D/(CO+.001))),M=[];for(let e=0;e<C;++e){const t=A+e*D/C,i=A+(e+1)*D/C;M[e]=[E,$,t,i,n,r,f,d]}return FO[u]=M}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=RO(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const LO=.5773502691896257,qO={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,MO)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n,i=r-n*LO,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n,i=r-n*LO;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=jO*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function UO(e){return _c(qO,e)?qO[e]:function(e){if(!_c(VO,e)){const t=AO(e);VO[e]={draw:function(e,n){BO(e,t,0,0,Math.sqrt(n)/2)}}}return VO[e]}(e)}var VO={};const WO=.448084975506;function HO(e){return e.x}function GO(e){return e.y}function XO(e){return e.width}function YO(e){return e.height}function JO(e){return"function"==typeof e?e:()=>+e}function KO(e,t,n){return Math.max(t,Math.min(e,n))}function QO(){var e=HO,t=GO,n=XO,r=YO,i=JO(0),a=i,o=i,s=i,l=null;function u(u,c,f){var d,h=null!=c?c:+e.call(this,u),p=null!=f?f:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),y=Math.min(m,g)/2,v=KO(+i.call(this,u),0,y),b=KO(+a.call(this,u),0,y),x=KO(+o.call(this,u),0,y),w=KO(+s.call(this,u),0,y);if(l||(l=d=ob()),v<=0&&b<=0&&x<=0&&w<=0)l.rect(h,p,m,g);else{var _=h+m,k=p+g;l.moveTo(h+v,p),l.lineTo(_-b,p),l.bezierCurveTo(_-WO*b,p,_,p+WO*b,_,p+b),l.lineTo(_,k-w),l.bezierCurveTo(_,k-WO*w,_-WO*w,k,_-w,k),l.lineTo(h+x,k),l.bezierCurveTo(h+WO*x,k,h,k-WO*x,h,k-x),l.lineTo(h,p+v),l.bezierCurveTo(h,p+WO*v,h+WO*v,p,h+v,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(t){return arguments.length?(e=JO(t),u):e},u.y=function(e){return arguments.length?(t=JO(e),u):t},u.width=function(e){return arguments.length?(n=JO(e),u):n},u.height=function(e){return arguments.length?(r=JO(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=JO(e),a=null!=t?JO(t):i,s=null!=n?JO(n):i,o=null!=r?JO(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function ZO(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var f=Math.sqrt(u*u+c*c),d=(u/=f)*s,h=(c/=f)*s,p=Math.atan2(c,u);l.moveTo(a-d,o-h),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+d,o+h),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,MO);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,f=a.length,d=!1;for(null==l&&(l=c=ob()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===d&&(d=!d)&&(i=0),d&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function eS(e,t){return null!=e?e:t}const tS=e=>e.x||0,nS=e=>e.y||0,rS=e=>!(!1===e.defined),iS=function(){var e=wb,t=_b,n=sb(0),r=null,i=kb,a=Ob,o=Sb,s=null;function l(){var l,u,c=+e.apply(this,arguments),f=+t.apply(this,arguments),d=i.apply(this,arguments)-yb,h=a.apply(this,arguments)-yb,p=lb(h-d),m=h>d;if(s||(s=l=ob()),f<c&&(u=f,f=c,c=u),f>mb)if(p>vb-mb)s.moveTo(f*cb(d),f*hb(d)),s.arc(0,0,f,d,h,!m),c>mb&&(s.moveTo(c*cb(h),c*hb(h)),s.arc(0,0,c,h,d,m));else{var g,y,v=d,b=h,x=d,w=h,_=p,k=p,O=o.apply(this,arguments)/2,S=O>mb&&(r?+r.apply(this,arguments):pb(c*c+f*f)),E=db(lb(f-c)/2,+n.apply(this,arguments)),$=E,A=E;if(S>mb){var D=xb(S/c*hb(O)),C=xb(S/f*hb(O));(_-=2*D)>mb?(x+=D*=m?1:-1,w-=D):(_=0,x=w=(d+h)/2),(k-=2*C)>mb?(v+=C*=m?1:-1,b-=C):(k=0,v=b=(d+h)/2)}var M=f*cb(v),j=f*hb(v),F=c*cb(w),T=c*hb(w);if(E>mb){var N,R=f*cb(b),P=f*hb(b),z=c*cb(x),B=c*hb(x);if(p<gb&&(N=Eb(M,j,z,B,R,P,F,T))){var I=M-N[0],L=j-N[1],q=R-N[0],U=P-N[1],V=1/hb(bb((I*q+L*U)/(pb(I*I+L*L)*pb(q*q+U*U)))/2),W=pb(N[0]*N[0]+N[1]*N[1]);$=db(E,(c-W)/(V-1)),A=db(E,(f-W)/(V+1))}}k>mb?A>mb?(g=$b(z,B,M,j,f,A,m),y=$b(R,P,F,T,f,A,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),A<E?s.arc(g.cx,g.cy,A,ub(g.y01,g.x01),ub(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,A,ub(g.y01,g.x01),ub(g.y11,g.x11),!m),s.arc(0,0,f,ub(g.cy+g.y11,g.cx+g.x11),ub(y.cy+y.y11,y.cx+y.x11),!m),s.arc(y.cx,y.cy,A,ub(y.y11,y.x11),ub(y.y01,y.x01),!m))):(s.moveTo(M,j),s.arc(0,0,f,v,b,!m)):s.moveTo(M,j),c>mb&&_>mb?$>mb?(g=$b(F,T,R,P,c,-$,m),y=$b(M,j,z,B,c,-$,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),$<E?s.arc(g.cx,g.cy,$,ub(g.y01,g.x01),ub(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,$,ub(g.y01,g.x01),ub(g.y11,g.x11),!m),s.arc(0,0,c,ub(g.cy+g.y11,g.cx+g.x11),ub(y.cy+y.y11,y.cx+y.x11),m),s.arc(y.cx,y.cy,$,ub(y.y11,y.x11),ub(y.y01,y.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(F,T)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-gb/2;return[cb(r)*n,hb(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:sb(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:sb(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:sb(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:sb(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:sb(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:sb(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:sb(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),aS=Tb().x(tS).y1(nS).y0((e=>(e.y||0)+(e.height||0))).defined(rS),oS=Tb().y(nS).x1(tS).x0((e=>(e.x||0)+(e.width||0))).defined(rS),sS=Fb().x(tS).y(nS).defined(rS),lS=QO().x(tS).y(nS).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>eS(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>eS(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>eS(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>eS(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),uS=function(e,t){var n=null;function r(){var r;if(n||(n=r=ob()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:sb(e||Nb),t="function"==typeof t?t:sb(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:sb(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:sb(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>UO(e.shape||"circle"))).size((e=>eS(e.size,64))),cS=ZO().x(tS).y(nS).defined(rS).size((e=>e.size||1));function fS(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function dS(e,t,n,r){return lS.context(e)(t,n,r)}var hS=1;function pS(){hS=1}function mS(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+hS++),o=i.clipping[a]||(i.clipping[a]={id:a});return cc(r)?o.path=r(null):fS(n)?o.path=dS(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function gS(e){this.clear(),e&&this.union(e)}function yS(e){this.mark=e,this.bounds=this.bounds||new gS}function vS(e){yS.call(this,e),this.items=this.items||[]}function bS(e){this._pending=0,this._loader=e||Xm()}function xS(e){e._pending+=1}function wS(e){e._pending-=1}function _S(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}gS.prototype={clone(){return new gS(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},Ec(vS,yS),bS.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return xS(t),t._loader.sanitize(e,{context:"href"}).then((e=>(wS(t),e))).catch((()=>(wS(t),null)))},loadImage(e){const t=this,n=mx();return xS(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=_c(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>wS(t),i.onerror=()=>wS(t),i.src=r,i})).catch((e=>(wS(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const kS=MO-1e-8;let OS,SS,ES,$S,AS,DS,CS,MS;const jS=(e,t)=>OS.add(e,t),FS=(e,t)=>jS(SS=e,ES=t),TS=e=>jS(e,OS.y1),NS=e=>jS(OS.x1,e),RS=(e,t)=>AS*e+CS*t,PS=(e,t)=>DS*e+MS*t,zS=(e,t)=>jS(RS(e,t),PS(e,t)),BS=(e,t)=>FS(RS(e,t),PS(e,t));function IS(e,t){return OS=e,t?($S=t*DO,AS=MS=Math.cos($S),DS=Math.sin($S),CS=-DS):(AS=MS=1,$S=DS=CS=0),LS}const LS={beginPath(){},closePath(){},moveTo:BS,lineTo:BS,rect(e,t,n,r){$S?(zS(e+n,t),zS(e+n,t+r),zS(e,t+r),BS(e,t)):(jS(e+n,t+r),FS(e,t))},quadraticCurveTo(e,t,n,r){const i=RS(e,t),a=PS(e,t),o=RS(n,r),s=PS(n,r);qS(SS,i,o,TS),qS(ES,a,s,NS),FS(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=RS(e,t),s=PS(e,t),l=RS(n,r),u=PS(n,r),c=RS(i,a),f=PS(i,a);US(SS,o,l,c,TS),US(ES,s,u,f,NS),FS(c,f)},arc(e,t,n,r,i,a){if(r+=$S,i+=$S,SS=n*Math.cos(i)+e,ES=n*Math.sin(i)+t,Math.abs(i-r)>kS)jS(e-n,t-n),jS(e+n,t+n);else{const o=r=>jS(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=MO)<0&&(r+=MO),(i%=MO)<0&&(i+=MO),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=MO,s=r-r%CO,l=0;l<4&&s>i;++l,s-=CO)o(s);else for(s=r-r%CO+CO,l=0;l<4&&s<i;++l,s+=CO)o(s)}}};function qS(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function US(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(VS(u,e,t,n,r)),0<c&&c<1&&i(VS(c,e,t,n,r))}function VS(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var WS=(WS=px(1,1))?WS.getContext("2d"):null;const HS=new gS;function GS(e){return function(t,n){if(!WS)return!0;e(WS,t),HS.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=HS;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(WS.isPointInPath(t,e))return!0;return!1}}function XS(e,t){return t.contains(e.x||0,e.y||0)}function YS(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(HS.set(n,r,n+i,r+a))}function JS(e,t){const n=e.x||0,r=e.y||0;return KS(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function KS(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let f,d,h,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(f=-u,d=-(a-t)),1===p&&(f=u,d=s-t),2===p&&(f=-c,d=-(o-n)),3===p&&(f=c,d=l-n),Math.abs(f)<1e-10&&d<0)return!1;if(h=d/f,f<0){if(h>g)return!1;h>m&&(m=h)}else if(f>0){if(h<m)return!1;h<g&&(g=h)}}return!0}function QS(e,t){e.globalCompositeOperation=t.blend||"source-over"}function ZS(e,t){return null==e?t:e}function eE(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function tE(e,t,n){return xO(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+ZS(t.x1,.5)*r,n.y1+ZS(t.y1,.5)*i,Math.max(r,i)*ZS(t.r1,0),n.x1+ZS(t.x2,.5)*r,n.y1+ZS(t.y2,.5)*i,Math.max(r,i)*ZS(t.r2,.5));else{const o=ZS(t.x1,0),s=ZS(t.y1,0),l=ZS(t.x2,1),u=ZS(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=px(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=eE(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return eE(a,t.stops)}(e,n,t.bounds):n}function nE(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=tE(e,t,t.fill),!0)}var rE=[];function iE(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&((n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=tE(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||rE),e.lineDashOffset=t.strokeDashOffset||0),!0))}function aE(e,t){return e.zindex-t.zindex||e.index-t.index}function oE(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(aE)}function sE(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=oE(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function lE(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=oE(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function uE(e){return function(t,n,r){sE(n,(n=>{r&&!r.intersects(n.bounds)||fE(e,t,n,n)}))}}function cE(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||fE(e,t,n.items[0],n.items)}}function fE(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(QS(t,n),n.fill&&nE(t,n,i)&&t.fill(),n.stroke&&iE(t,n,i)&&t.stroke()))}function dE(e){return e=e||Fu,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,lE(n,(n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function hE(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(o=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function pE(e){return dE(hE(e))}function mE(e,t){return"translate("+e+","+t+")"}function gE(e){return"rotate("+e+")"}function yE(e){return mE(e.x||0,e.y||0)}function vE(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=DO),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return mE(e.x||0,e.y||0)+(e.angle?" "+gE(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(IS(e,n.angle),n),_S(e,n).translate(n.x||0,n.y||0)},draw:uE(r),pick:pE(r),isect:n||GS(r)}}var bE=vE("arc",(function(e,t){return iS.context(e)(t)}));function xE(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=hE(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(IS(e),r),_S(e,r[0]))},draw:cE(r),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:XS,tip:n}}var wE=xE("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?oS:aS).curve(SO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function _E(e,t){e.beginPath(),fS(t)?dS(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function kE(e){const t=ZS(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function OE(e,t){const n=kE(t);e("d",dS(null,t,n,n))}function SE(e,t,n,r){const i=kE(t);e.beginPath(),dS(e,t,(n||0)+i,(r||0)+i)}const EE=hE(SE),$E=hE(SE,!1),AE=hE(SE,!0);var DE={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",yE(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),_S(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){sE(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(SE(e,t,r,i),QS(e,t),t.fill&&nE(e,t,o)&&e.fill(),t.stroke&&!a&&iE(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&_E(e,t),n&&n.translate(-r,-i),sE(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(SE(e,t,r,i),QS(e,t),iE(e,t,o)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return lE(t,(l=>{let u,c,f;const d=l.bounds;if(d&&!d.contains(i,a))return;c=l.x||0,f=l.y||0;const h=c+(l.width||0),p=f+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<f||a>p))return;if(e.save(),e.translate(c,f),c=i-c,f=a-f,m&&fS(l)&&!AE(e,l,o,s))return e.restore(),null;const g=l.strokeForeground,y=!1!==t.interactive;return y&&g&&l.stroke&&$E(e,l,o,s)?(e.restore(),l):(u=lE(l,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,f)?this.pick(e,n,r,c,f):null)),!u&&y&&(l.fill||!g&&l.stroke)&&EE(e,l,o,s)&&(u=l),e.restore(),u||null)}))},isect:YS,content:function(e,t,n){e("clip-path",t.clip?mS(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),OE(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?OE(e,t):e("d","")}},CE={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function ME(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function jE(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function FE(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function TE(e,t){return"center"===e?t/2:"right"===e?t:0}function NE(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var RE={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=ME(t,n),i=jE(t,r),a=FE(t,r),o=(t.x||0)-TE(t.align,i),s=(t.y||0)-NE(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",CE["xmlns:xlink"],"xlink:href"),e("transform",mE(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=jE(t,n),i=FE(t,n),a=(t.x||0)-TE(t.align,r),o=(t.y||0)-NE(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){sE(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=ME(t,this);let i,a,o,s,l=jE(t,r),u=FE(t,r),c=(t.x||0)-TE(t.align,l),f=(t.y||0)-NE(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,f+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(QS(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,f,l,u))}))},pick:dE(),isect:Fu,get:ME,xOffset:TE,yOffset:NE},PE=xE("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return sS.curve(SO(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function zE(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*DO,l=t.pathCache;l&&l.path===n||((t.pathCache=l=AO(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),BO(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):BO(e,l,r,i,a,o)}var BE={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return mE(e.x||0,e.y||0)+(e.angle?" "+gE(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return zE(IS(e,t.angle),t)?e.set(0,0,0,0):_S(e,t,!0)},draw:uE(zE),pick:pE(zE),isect:GS(zE)};function IE(e,t){e.beginPath(),dS(e,t)}var LE={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",dS(null,t))},bound:function(e,t){var n,r;return _S(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:uE(IE),pick:pE(IE),isect:YS};function qE(e,t,n){var r,i,a,o;return!(!t.stroke||!iE(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var UE={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",yE(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return _S(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){sE(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&qE(e,t,r)&&(QS(e,t),e.stroke())}}))},pick:dE((function(e,t,n,r){return!!e.isPointInStroke&&(qE(e,t,1)&&e.isPointInStroke(n,r))})),isect:JS},VE=vE("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),WE=vE("symbol",(function(e,t){return uS.context(e)(t)}),XS);const HE=Rc();var GE={height:ZE,measureWidth:KE,estimateWidth:YE,width:YE,canvas:XE};function XE(e){GE.width=e&&WS?KE:YE}function YE(e,t){return JE(r$(e,t),ZE(e))}function JE(e,t){return~~(.8*e.length*t)}function KE(e,t){return ZE(e)<=0||!(t=r$(e,t))?0:QE(t,a$(e))}function QE(e,t){const n="(".concat(t,") ").concat(e);let r=HE.get(n);return void 0===r&&(WS.font=t,r=WS.measureText(e).width,HE.set(n,r)),r}function ZE(e){return null!=e.fontSize?+e.fontSize||0:11}function e$(e){return null!=e.lineHeight?e.lineHeight:ZE(e)+2}function t$(e){return function(e){return Pu(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!Pu(e.text)?e.text.split(e.lineBreak):e.text)}function n$(e){const t=t$(e);return(Pu(t)?t.length-1:0)*e$(e)}function r$(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(GE.width===KE){const t=a$(e);return e=>QE(e,t)}{const t=ZE(e);return e=>JE(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"…",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)i=s+l>>>1,r(t.slice(i))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)i=1+(s+l>>>1),r(t.slice(0,i))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function i$(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function a$(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+ZE(e)+"px "+i$(e,t)}function o$(e){var t=e.baseline,n=ZE(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*e$(e):"line-bottom"===t?.29*n-.5*e$(e):0)}XE(!0);const s$={left:"start",center:"middle",right:"end"},l$=new gS;function u$(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-CO,n+=i*Math.cos(t),r+=i*Math.sin(t)),l$.x1=n,l$.y1=r,l$}function c$(e,t,n){var r,i=GE.height(t),a=t.align,o=u$(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+o$(t)-Math.round(.8*i),f=t$(t);if(Pu(f)?(i+=e$(t)*(f.length-1),r=f.reduce(((e,n)=>Math.max(e,GE.width(t,n))),0)):r=GE.width(t,f),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*DO,s,l);else if(2===n)return e.rotatedPoints(t.angle*DO,s,l);return e}var f$={arc:bE,area:wE,group:DE,image:RE,line:PE,path:BE,rect:LE,rule:UE,shape:VE,symbol:WE,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+o$(t),a=u$(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",s$[t.align]||"start"),l?(n=mE(o,s)+" "+gE(l),(r||i)&&(n+=" "+mE(r,i))):n=mE(o+r,s+i),e("transform",n)},bound:c$,draw:function(e,t,n){sE(t,(t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=a$(t),e.textAlign=t.align||"left",i=(r=u$(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*DO),i=a=0),i+=t.dx||0,a+=(t.dy||0)+o$(t),l=t$(t),QS(e,t),Pu(l))for(s=e$(t),o=0;o<l.length;++o)u=r$(t,l[o]),t.fill&&nE(e,t,c)&&e.fillText(u,i,a),t.stroke&&iE(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=r$(t,l),t.fill&&nE(e,t,c)&&e.fillText(u,i,a),t.stroke&&iE(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}}))},pick:dE((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=u$(t),s=o.x1,l=o.y1,u=c$(l$,t,1),c=-t.angle*DO,f=Math.cos(c),d=Math.sin(c),h=f*i-d*a+(s-f*s+d*l),p=d*i+f*a+(l-d*s-f*l);return u.contains(h,p)})),isect:function(e,t){const n=c$(l$,e,2);return KS(t,n[0],n[1],n[2],n[3])||KS(t,n[0],n[1],n[4],n[5])||KS(t,n[4],n[5],n[6],n[7])||KS(t,n[2],n[3],n[6],n[7])}},trail:xE("trail",(function(e,t){return cS.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function d$(e,t,n){var r=f$[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new gS),e,n)}var h$={mark:null};function p$(e,t,n){var r,i,a,o,s=f$[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(h$.mark=e,a=h$),o=d$(a,l,n),t=t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new gS,c)for(r=0,i=u.length;r<i;++r)t.union(d$(u[r],l,n));return e.bounds=t}const m$=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function g$(e,t){return JSON.stringify(e,m$,t)}function y$(e){return v$("string"==typeof e?JSON.parse(e):e)}function v$(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&v$(a[n]);return i&&p$(e),e}function b$(e){arguments.length?this.root=y$(e):(this.root=x$({marktype:"group",name:"root",role:"frame"}),this.root.items=[new vS(this.root)])}function x$(e,t){const n={bounds:new gS,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function w$(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function _$(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function k$(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=w$(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function O$(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function S$(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function E$(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function $$(e,t){this._active=null,this._handlers={},this._loader=e||Xm(),this._tooltip=t||A$}function A$(e,t,n,r){e.element().setAttribute("title",r||"")}function D$(e){this._el=null,this._bgcolor=null,this._loader=new bS(e)}b$.prototype={toJSON(e){return g$(this.root,e||0)},mark(e,t,n){const r=x$(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},$$.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=w$(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=f$[o.marktype]).tip){for((a=E$(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},D$.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const C$="dragenter",M$="dragleave",j$="dragover",F$="mousedown",T$="mousemove",N$="mouseout",R$="mouseover",P$="click",z$="mousewheel",B$="touchstart",I$="touchmove",L$="touchend",q$=T$,U$=N$,V$=P$;function W$(e,t){$$.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function H$(e,t){(e=>e===B$||e===I$||e===L$?[B$,I$,L$]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function G$(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function X$(e){return function(t){this.fire(e,t),this._active=null}}Ec(W$,$$,{initialize(e,t,n){return this._canvas=e&&_$(e,"canvas"),[P$,F$,T$,N$,M$].forEach((e=>H$(this,e))),$$.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",C$,M$,j$,F$,"mouseup",T$,N$,R$,P$,"dblclick","wheel",z$,B$,I$,L$],DOMMouseScroll(e){this.fire(z$,e)},mousemove:G$(T$,R$,N$),dragover:G$(j$,C$,M$),mouseout:X$(N$),dragleave:X$(M$),mousedown(e){this._down=this._active,this.fire(F$,e)},click(e){this._down===this._active&&(this.fire(P$,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(B$,e,!0)},touchmove(e){this.fire(I$,e,!0)},touchend(e){this.fire(L$,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===V$&&r&&r.href?this.handleHref(t,r,r.href):e!==q$&&e!==U$||this.handleTooltip(t,r,e!==U$),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(H$(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=E$(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return f$[e.marktype].pick.call(this,a,e,t,n,r,i)}});var Y$="undefined"!=typeof window&&window.devicePixelRatio||1;function J$(e){D$.call(this,e),this._options={},this._redraw=!1,this._dirty=new gS,this._tempb=new gS}const K$=D$.prototype;function Q$(e,t){$$.call(this,e,t);const n=this;n._hrefHandler=Z$(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=Z$(n,((e,t)=>{n.handleTooltip(e,t,e.type!==U$)}))}Ec(J$,D$,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:px(1,1,this._options.type),e&&this._canvas&&(O$(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),K$.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(K$.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?Y$:i;e.width=t*l,e.height=n*l;for(const e in a)s[e]=a[e];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||Eu("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((e,t,n)=>(new gS).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=f$[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),cc(n)?(e.beginPath(),n(e),e.clip()):_E(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const Z$=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};Ec(Q$,$$,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(V$,this._hrefHandler),r.removeEventListener(q$,this._tooltipHandler),r.removeEventListener(U$,this._tooltipHandler)),this._svg=r=e&&_$(e,"svg"),r&&(r.addEventListener(V$,this._hrefHandler),r.addEventListener(q$,this._tooltipHandler),r.addEventListener(U$,this._tooltipHandler)),$$.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:Z$(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const eA="aria-hidden",tA="aria-label",nA="role",rA="aria-roledescription",iA="graphics-object",aA="graphics-symbol",oA=(e,t,n)=>({[nA]:e,[rA]:t,[tA]:n||void 0}),sA=Hc(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),lA={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?hA(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(Pk(s)?"discrete":s," scale")+" with ".concat(yO(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?hA(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return u=r,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Uu(e)}(a))+" with ".concat(yO(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(dA(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(dA(e),"'")}},uA={ariaRole:nA,ariaRoleDescription:rA,description:tA};function cA(e,t){const n=!1===t.aria;if(e(eA,n||void 0),n||null==t.description)for(const t in uA)e(uA[t],void 0);else{const n=t.mark.marktype;e(tA,t.description),e(nA,t.ariaRole||("group"===n?iA:aA)),e(rA,t.ariaRoleDescription||"".concat(n," mark"))}}function fA(e){return!1===e.aria?{[eA]:!0}:sA[e.role]?null:lA[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return oA(t.role||aA,t.desc,n.description||r(n))}catch(e){return null}}(e,lA[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return oA(n?iA:aA,"".concat(t," mark container"),e.description)}(e)}function dA(e){return lc(e.text).join(" ")}function hA(e){try{return lc(Uu(e.items).items[0].text).join(" ")}catch(e){return null}}const pA=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function mA(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(pA(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=pA(e),o),toString:()=>e};return o}const gA=e=>yA(mA(),e)+"";function yA(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):yA(e,r)}}return e.close()}const vA={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},bA={fill:"none","stroke-miterlimit":10},xA=CE.xmlns;function wA(e){D$.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const _A=D$.prototype;function kA(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function OA(e,t,n){let r,i,a;if("radial"===t.gradient){let r=k$(e,n++,"pattern",xA);jA(r,{id:bO+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=k$(r,0,"rect",xA),jA(r,{width:1,height:1,fill:"url(".concat(TA(),"#").concat(t.id,")")}),jA(e=k$(e,n++,"radialGradient",xA),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else jA(e=k$(e,n++,"linearGradient",xA),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=k$(e,r,"stop",xA),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return O$(e,r),n}function SA(e,t,n){let r;return(e=k$(e,n,"clipPath",xA)).setAttribute("id",t.id),t.path?(r=k$(e,0,"path",xA),r.setAttribute("d",t.path)):(r=k$(e,0,"rect",xA),jA(r,{x:0,y:0,width:t.width,height:t.height})),O$(e,1),n+1}function EA(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=w$(a,r,xA),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=w$(a,"path",xA);o.appendChild(t),t.__data__=e;const n=w$(a,"g",xA);o.appendChild(n),n.__data__=e;const r=w$(a,"path",xA);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}Ec(wA,D$,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=k$(e,0,"svg",xA),jA(this._svg,CE),this._svg.setAttribute("class","marks"),O$(e,1),this._root=k$(this._svg,0,"g",xA),jA(this._root,bA),O$(this._svg,1)),this.background(this._bgcolor),_A.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),_A.background.apply(this,arguments)},resize(e,t,n,r){return _A.resize.call(this,e,t,n,r),this._svg&&(jA(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=k$(e,0,"rect",xA),jA(n,{width:this._width,height:this._height,fill:t}));const r=gA(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),O$(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=f$[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,kA(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,kA(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=f$[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=EA(t,e,n,"g",r);u.setAttribute("class",S$(t));const c=fA(t);for(const e in c)FA(u,e,c[e]);o||FA(u,"pointer-events",a),FA(u,"clip-path",t.clip?mS(this,t,t.group):null);const f=e=>{const t=this.isDirty(e),n=EA(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;sE(n,(n=>{r=e.mark(t,n,r),++i})),O$(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&f(t.items[0]):sE(t,f),O$(u,l),u},_update(e,t,n){$A=t,AA=t.__values__,cA(CA,n),e.attr(CA,n,this);const r=DA[e.type];r&&r.call(this,e,t,n),$A&&this.style($A,n)},style(e,t){if(null!=t)for(const n in vA){let r="font"===n?i$(t):t[n];if(r===AA[n])continue;const i=vA[n];null==r?e.removeAttribute(i):(xO(r)&&(r=wO(r,this._defs.gradient,TA())),e.setAttribute(i,r+"")),AA[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=k$(e,1,"defs",xA)),r=OA(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=k$(e,1,"defs",xA)),r=SA(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):O$(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let $A=null,AA=null;const DA={group(e,t,n){const r=$A=t.childNodes[2];AA=r.__values__,e.foreground(CA,n,this),AA=t.__values__,$A=t.childNodes[1],e.content(CA,n,this);const i=$A=t.childNodes[0];e.background(CA,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==AA.events&&(FA(r,"pointer-events",a),FA(i,"pointer-events",a),AA.events=a),n.strokeForeground&&n.stroke){const e=n.fill;FA(r,"display",null),this.style(i,n),FA(i,"stroke",null),e&&(n.fill=null),AA=r.__values__,this.style(r,n),e&&(n.fill=e),$A=null}else FA(r,"display","none")},image(e,t,n){!1===n.smooth?(MA(t,"image-rendering","optimizeSpeed"),MA(t,"image-rendering","pixelated")):MA(t,"image-rendering",null)},text(e,t,n){const r=t$(n);let i,a,o,s;Pu(r)?(a=r.map((e=>r$(n,e))),i=a.join("\n"),i!==AA.text&&(O$(t,0),o=t.ownerDocument,s=e$(n),a.forEach(((e,r)=>{const i=w$(o,"tspan",xA);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)})),AA.text=i)):(a=r$(n,r),a!==AA.text&&(t.textContent=a,AA.text=a)),FA(t,"font-family",i$(n)),FA(t,"font-size",ZE(n)+"px"),FA(t,"font-style",n.fontStyle),FA(t,"font-variant",n.fontVariant),FA(t,"font-weight",n.fontWeight)}};function CA(e,t,n){t!==AA[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}($A,e,t,n):FA($A,e,t),AA[e]=t)}function MA(e,t,n){n!==AA[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),AA[t]=n)}function jA(e,t){for(const n in t)FA(e,n,t[n])}function FA(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function TA(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function NA(e){D$.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}Ec(NA,D$,{svg(){return this._text},_render(e){const t=mA();t.open("svg",vc({},CE,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",bA,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=f$[t.marktype],r=n.tag,i=[cA,n.attr];e.open("g",{class:S$(t),"clip-path":t.clip?mS(this,t,t.group):null},fA(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=t$(a);if(Pu(t)){const n={x:0,dy:e$(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(r$(a,t[r])).close()}else e.text(r$(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),sE(a,(t=>this.mark(e,t))),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):sE(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;"bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===r&&(e["font-family"]=i$(t),e["font-size"]=ZE(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in vA){let r=t[n];const a=vA[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(xO(r)&&(r=wO(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:bO+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const RA="canvas",PA="none",zA={Canvas:RA,PNG:"png",SVG:"svg",None:PA},BA={};function IA(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(BA[e]=t,this):BA[e]}function LA(e,t,n){const r=[],i=(new gS).union(t),a=e.marktype;return a?qA(e,i,n,r):"group"===a?UA(e,i,n,r):Eu("Intersect scene must be mark node or group item.")}function qA(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)UA(i[s],t,n,r);else for(const e=f$[a].isect;s<o;++s){const n=i[s];VA(n,t,e)&&r.push(n)}}return r}function UA(e,t,n,r){n&&n(e.mark)&&VA(e,t,f$.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)qA(i[e],t,n,r);t.translate(o,s)}return r}function VA(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}BA.canvas=BA.png={renderer:J$,headless:J$,handler:W$},BA.svg={renderer:wA,headless:NA,handler:Q$},BA.none={};const WA=new gS;function HA(e){const t=e.clip;if(cc(t))t(IS(WA.clear()));else{if(!t)return;WA.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(WA)}function GA(e,t,n){return e===t||("path"===n?XA(e,t):e instanceof Date&&t instanceof Date?+e==+t:Mc(e)&&Mc(t)?Math.abs(e-t)<=1e-9:e&&t&&(zu(e)||zu(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!GA(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function XA(e,t){return GA(AO(e),AO(t))}const YA="top",JA="left",KA="right",QA="bottom",ZA="start",eD="middle",tD="end",nD="group",rD="axis",iD="title",aD="frame",oD="scope",sD="legend",lD="row-header",uD="row-footer",cD="row-title",fD="column-header",dD="column-footer",hD="column-title",pD="padding",mD="fit",gD="fit-x",yD="fit-y",vD="none",bD="all",xD="each",wD="flush",_D="column",kD="row";function OD(e){Fg.call(this,null,e)}function SD(e,t,n){return t(e.bounds.clear(),e,n)}Ec(OD,Fg,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=f$[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=SD(r,o),r.items.forEach((e=>{e.bounds.clear().union(l)}));else if(i===nD||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),l.clear(),r.items.forEach((e=>l.union(SD(e,o)))),r.role){case rD:case sD:case iD:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,(e=>{l.union(SD(e,o))})),t.visit(t.MOD,(e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(SD(e,o))})),s&&(l.clear(),r.items.forEach((e=>l.union(e.bounds))));return HA(r),t.modifies("bounds")}});const ED=":vega_identifier:";function $D(e){Fg.call(this,0,e)}function AD(e){Fg.call(this,null,e)}function DD(e){Fg.call(this,null,e)}$D.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},Ec($D,Fg,{transform(e,t){const n=(i=t.dataflow)._signals[ED]||(i._signals[ED]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),Ec(AD,Fg,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===nD?vS:yS;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const CD={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&MD(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},MD=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),jD=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(MD(a,n=e[r].bounds,t))return!0},FD=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},TD=e=>(e.forEach((e=>e.opacity=1)),e),ND=(e,t)=>e.reflow(t.modified()).modifies("opacity");function RD(e){Fg.call(this,null,e)}Ec(DD,Fg,{transform(e,t){const n=CD[e.method]||CD.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(TD(o),t=ND(t,e)),t;if(o=o.filter(FD),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=TD(o),t=ND(t,e),i.length>=3&&jD(i,r)){do{i=n(i,r)}while(i.length>=3&&jD(i,r));i.length<3&&!Uu(o).opacity&&(i.length>1&&(Uu(i).opacity=0),Uu(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new gS;return t===YA||t===QA?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((e=>{a(e)||(e.opacity=0)})));const s=i[0].mark.bounds.clear();return o.forEach((e=>{e.opacity&&s.union(e.bounds)})),t}}),Ec(RD,Fg,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const PD=new gS;function zD(e,t,n){return e[t]===n?0:(e[t]=n,1)}function BD(e){var t=e.items[0].orient;return t===JA||t===KA}function ID(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=g&&n$(g),x=0,w=0;switch(PD.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(o.items[i].bounds),(i=c[1])>-1&&v.union(o.items[i].bounds),u){case YA:x=h||0,w=-d,a=Math.max(p,Math.min(m,-v.y1)),v.add(0,-a).add(f,0),g&&LD(e,g,a,y,b,0,-1,v);break;case JA:x=-d,w=h||0,a=Math.max(p,Math.min(m,-v.x1)),v.add(-a,0).add(0,f),g&&LD(e,g,a,y,b,1,-1,v);break;case KA:x=n+d,w=h||0,a=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(a,f),g&&LD(e,g,a,y,b,1,1,v);break;case QA:x=h||0,w=r+d,a=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(f,a),g&&LD(e,g,a,y,0,0,1,v);break;default:x=o.x,w=o.y}return _S(v.translate(x,w),o),zD(o,"x",x+l)|zD(o,"y",w+l)&&(o.bounds=PD,e.dirty(o),o.bounds=v,e.dirty(o)),o.mark.bounds.clear().union(v)}function LD(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const qD=(e,t)=>Math.floor(Math.min(e,t)),UD=(e,t)=>Math.ceil(Math.max(e,t));function VD(e){return(new gS).set(0,0,e.width||0,e.height||0)}function WD(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function HD(e,t,n){const r=zu(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function GD(e){return e<0?Math.ceil(-e):0}function XD(e,t,n){var r,i,a,o,s,l,u,c,f,d,h,p=!n.nodirty,m=n.bounds===wD?VD:WD,g=PD.set(0,0,0,0),y=HD(n.align,_D),v=HD(n.align,kD),b=HD(n.padding,_D),x=HD(n.padding,kD),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,O=Array(k),S=Array(w),E=0,$=Array(k),A=Array(_),D=0,C=Array(k),M=Array(k),j=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)A[i]=0;for(i=0;i<k;++i)l=t[i],s=j[i]=m(l),l.x=l.x||0,C[i]=0,l.y=l.y||0,M[i]=0,a=i%w,o=~~(i/w),E=Math.max(E,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),A[o]=Math.max(A[o],c),O[i]=b+GD(s.x1),$[i]=x+GD(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(O[i]=0),i<w&&($[i]=0);if(y===xD)for(a=1;a<w;++a){for(h=0,i=a;i<k;i+=w)h<O[i]&&(h=O[i]);for(i=a;i<k;i+=w)O[i]=h+S[a-1]}else if(y===bD){for(h=0,i=0;i<k;++i)i%w&&h<O[i]&&(h=O[i]);for(i=0;i<k;++i)i%w&&(O[i]=h+E)}else for(y=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)O[i]+=S[a-1];if(v===xD)for(o=1;o<_;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<$[i]&&(h=$[i]);for(i=o*w;i<r;++i)$[i]=h+A[o-1]}else if(v===bD){for(h=0,i=w;i<k;++i)h<$[i]&&(h=$[i]);for(i=w;i<k;++i)$[i]=h+D}else for(v=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)$[i]+=A[o-1];for(f=0,i=0;i<k;++i)f=O[i]+(i%w?f:0),C[i]+=f-t[i].x;for(a=0;a<w;++a)for(d=0,i=a;i<k;i+=w)d+=$[i],M[i]+=d-t[i].y;if(y&&HD(n.center,_D)&&_>1)for(i=0;i<k;++i)(f=(s=y===bD?E:S[i%w])-j[i].x2-t[i].x-C[i])>0&&(C[i]+=f/2);if(v&&HD(n.center,kD)&&1!==w)for(i=0;i<k;++i)(d=(s=v===bD?D:A[~~(i/w)])-j[i].y2-t[i].y-M[i])>0&&(M[i]+=d/2);for(i=0;i<k;++i)g.union(j[i].translate(C[i],M[i]));switch(f=HD(n.anchor,"x"),d=HD(n.anchor,"y"),HD(n.anchor,_D)){case tD:f-=g.width();break;case eD:f-=g.width()/2}switch(HD(n.anchor,kD)){case tD:d-=g.height();break;case eD:d-=g.height()/2}for(f=Math.round(f),d=Math.round(d),g.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(l=t[i]).x+=C[i]+=f,l.y+=M[i]+=d,g.union(l.mark.bounds.union(l.bounds.translate(C[i],M[i]))),p&&e.dirty(l);return g}function YD(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===nD)switch(t.role){case rD:case sD:case iD:break;case lD:o.rowheaders.push(...n);break;case uD:o.rowfooters.push(...n);break;case fD:o.colheaders.push(...n);break;case dD:o.colfooters.push(...n);break;case cD:o.rowtitle=n[0];break;case hD:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),f=c.marks,d=n.bounds===wD?JD:KD,h=n.offset,p=n.columns||f.length,m=p<=0?1:Math.ceil(f.length/p),g=m*p;const y=XD(e,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=HD(n.headerBand,kD,null),r=QD(e,c.rowheaders,f,p,m,-HD(h,"rowHeader"),qD,0,d,"x1",0,p,1,l)),c.colheaders&&(l=HD(n.headerBand,_D,null),i=QD(e,c.colheaders,f,p,p,-HD(h,"columnHeader"),qD,1,d,"y1",0,1,p,l)),c.rowfooters&&(l=HD(n.footerBand,kD,null),a=QD(e,c.rowfooters,f,p,m,HD(h,"rowFooter"),UD,0,d,"x2",p-1,p,1,l)),c.colfooters&&(l=HD(n.footerBand,_D,null),o=QD(e,c.colfooters,f,p,p,HD(h,"columnFooter"),UD,1,d,"y2",g-p,1,p,l)),c.rowtitle&&(s=HD(n.titleAnchor,kD),u=HD(h,"rowTitle"),u=s===tD?a+u:r-u,l=HD(n.titleBand,kD,.5),ZD(e,c.rowtitle,u,0,y,l)),c.coltitle&&(s=HD(n.titleAnchor,_D),u=HD(h,"columnTitle"),u=s===tD?o+u:i-u,l=HD(n.titleBand,_D,.5),ZD(e,c.coltitle,u,1,y,l))}function JD(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function KD(e,t){return e.bounds[t]}function QD(e,t,n,r,i,a,o,s,l,u,c,f,d,h){var p,m,g,y,v,b,x,w,_,k=n.length,O=0,S=0;if(!k)return O;for(p=c;p<k;p+=f)n[p]&&(O=o(O,l(n[p],u)));if(!t.length)return O;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),O+=a,m=0,y=t.length;m<y;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,y=t.length;m<y;++m,p+=f){for(v=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=d);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),_=O):(w=O,_=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,v[u])}return S}function ZD(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function eC(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",ZA),c=u===tD?1:u===eD?.5:0,f={align:xD,bounds:s("bounds",wD),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case JA:f.anchor={x:Math.floor(r.x1)-l,column:tD,y:c*(o||r.height()+2*r.y1),row:u};break;case KA:f.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case YA:f.anchor={y:Math.floor(i.y1)-l,row:tD,x:c*(a||i.width()+2*i.x1),column:u};break;case QA:f.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":f.anchor={x:l,y:l};break;case"top-right":f.anchor={x:a-l,y:l,column:tD};break;case"bottom-left":f.anchor={x:l,y:o-l,row:tD};break;case"bottom-right":f.anchor={x:a-l,y:o-l,column:tD,row:tD}}return f}function tC(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case JA:i+=Math.ceil(o.bounds.width())+l;break;case KA:case QA:break;default:a+=o.bounds.height()+l}switch((i||a)&&rC(e,n,i,a),o.orient){case JA:c+=nC(t,n,o,s,1,1);break;case KA:u+=nC(t,n,o,tD,0,0)+l,c+=nC(t,n,o,s,1,1);break;case QA:u+=nC(t,n,o,s,0,0),c+=nC(t,n,o,tD,-1,0,1)+l;break;default:u+=nC(t,n,o,s,0,0)}(u||c)&&rC(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(rC(e,n,-u,0),rC(e,o,-u,0))}else(i||a)&&rC(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==vD&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,_S(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function nC(e,t,n,r,i,a,o){const s="symbol"!==e.datum.type,l=n.datum.vgrad,u=(!s||!a&&l||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,c=l&&a?u:0,f=l&&a?0:u,d=i<=0?0:n$(n);return Math.round(r===ZA?c:r===tD?f-d:.5*(u-d))}function rC(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function iC(e){Fg.call(this,null,e)}Ec(iC,Fg,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&YD(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),f=(new gS).set(0,0,u,c),d=f.clone(),h=f.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case rD:(BD(i)?d:h).union(ID(e,i,u,c));break;case iD:r=i;break;case sD:p.push(tC(e,i));break;case aD:case oD:case lD:case uD:case cD:case fD:case dD:case hD:d.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const t={};p.forEach((e=>{(a=e.orient||KA)!==vD&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];XD(e,i,eC(i,r,n.legends,d,h,u,c))}p.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&n.autosize.type===mD)switch(t.orient){case JA:case KA:f.add(r.x1,0).add(r.x2,0);break;case YA:case QA:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(d).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,l=o.orient,u=o.anchor,c=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=l===JA||l===KA?r:n,m=0,g=0,y=0,v=0,b=0;if(s!==nD?l===JA?(m=i.y2,p=i.y1):l===KA?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):l===JA&&(m=r,p=0),a=u===ZA?m:u===tD?p:(m+p)/2,h&&h.text){switch(l){case YA:case QA:b=d.bounds.height()+f;break;case JA:v=d.bounds.width()+f;break;case KA:v=-d.bounds.width()-f}PD.clear().union(h.bounds),PD.translate(v-(h.x||0),b-(h.y||0)),zD(h,"x",v)|zD(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(PD),h.mark.bounds.clear().union(PD),e.dirty(h)),PD.clear().union(h.bounds)}else PD.clear();switch(PD.union(d.bounds),l){case YA:g=a,y=i.y1-PD.height()-c;break;case JA:g=i.x1-PD.width()-c,y=a;break;case KA:g=i.x2+PD.width()+c,y=a;break;case QA:g=a,y=i.y2+c;break;default:g=o.x,y=o.y}return zD(o,"x",g)|zD(o,"y",y)&&(PD.translate(g,y),e.dirty(o),o.bounds.clear().union(PD),t.bounds.clear().union(PD),e.dirty(o)),o.bounds}(e,r,u,c,f));t.clip&&f.set(0,0,t.width||0,t.height||0);!function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,Math.ceil(n.y2-c));if(i.contains===pD){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===vD?(u=0,f=0,l=o,c=s):a===mD?(l=Math.max(0,o-u-d),c=Math.max(0,s-f-h)):a===gD?(l=Math.max(0,o-u-d),s=c+f+h):a===yD?(o=l+u+d,c=Math.max(0,s-f-h)):"pad"===a&&(o=l+u+d,s=c+f+h);e._resizeView(o,s,l,c,[u,f],i.resize)}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}});var aC=Object.freeze({__proto__:null,bound:OD,identifier:$D,mark:AD,overlap:DD,render:RD,viewlayout:iC});function oC(e){Fg.call(this,null,e)}function sC(e){Fg.call(this,null,e)}function lC(){return ng({})}function uC(e){Fg.call(this,null,e)}function cC(e){Fg.call(this,[],e)}Ec(oC,Fg,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=nO(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||aO(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?rO(a,e.values,o):iO(a,o);return i&&(r.rem=i),i=l.map(((e,t)=>ng({index:t/(l.length-1||1),value:e,label:s(e)}))),e.extra&&i.length&&i.push(ng({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),Ec(sC,Fg,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||lC,a=e.key||eg,o=this.value;return Pu(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&Eu("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=Oc().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),Ec(uC,Fg,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(Pu(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||Tu,l=i.enter||Tu,u=i.exit||Tu,c=(a&&!o?i[a]:s)||Tu;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{l(t,e),s(t,e)})),n.modifies(l.output),n.modifies(s.output),c!==Tu&&c!==s&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&u!==Tu&&(t.visit(t.REM,(t=>{u(t,e)})),n.modifies(u.output)),o||c!==Tu){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,(t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)):t.visit(i,(t=>{(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),Ec(cC,Fg,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||Qk,f=e.scale,d=+e.limit,h=nO(f,null==e.count?5:e.count,e.minstep),p=!!e.values||c===Qk,m=e.format||cO(s,f,h,c,e.formatSpecifier,e.formatType,p),g=e.values||uO(f,h);return u&&(l.rem=u),c===Qk?(d&&g.length>d?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,d-1),o=!0):u=g,cc(i=e.size)?(e.values||0!==f(u[0])||(u=u.slice(1)),a=u.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=gc(a=i||8),u=u.map(((t,n)=>ng({index:n,label:m(t,n,u),value:t,offset:a,size:i(t,e)}))),o&&(o=g[u.length],u.push(ng({index:u.length,label:"…".concat(g.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=f.domain(),r=Hk(f,n[0],Uu(n)),g.length<3&&!e.values&&n[0]!==Uu(n)&&(g=[n[0],Uu(n)]),u=g.map(((e,t)=>ng({index:t,label:m(e,t,g),value:e,perc:r(e)})))):(i=g.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Uu(t),a=i-r;if(e.type===gk){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(f),u=g.map(((e,t)=>ng({index:t,label:m(e,t,g),value:e,perc:t?r(e):0,perc2:t===i?1:r(g[t+1])})))),l.source=u,l.add=u,this.value=u,l}});const fC=e=>e.source.x,dC=e=>e.source.y,hC=e=>e.target.x,pC=e=>e.target.y;function mC(e){Fg.call(this,{},e)}mC.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},Ec(mC,Fg,{transform(e,t){var n=e.sourceX||fC,r=e.sourceY||dC,i=e.targetX||hC,a=e.targetY||pC,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=bC.get(l+"-"+s)||bC.get(l);return u||Eu("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[o]=u(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});const gC=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,yC=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},vC=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},bC=Oc({line:gC,"line-radial":(e,t,n,r)=>gC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:yC,"arc-radial":(e,t,n,r)=>yC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:vC,"curve-radial":(e,t,n,r)=>vC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function xC(e){Fg.call(this,null,e)}xC.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},Ec(xC,Fg,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.field||ju,u=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(l),h=d.length,p=u,m=(c-u)/id(d),g=rd(h);for(e.sort&&g.sort(((e,t)=>d[e]-d[t])),n=0;n<h;++n)i=d[g[n]],(r=f[g[n]])[o]=p,r[s]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)}});function wC(e){return Rk(e)&&e!==dk}const _C=Hc(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function kC(e){Fg.call(this,null,e),this.modified(!0)}function OC(e,t,n){Bk(e)&&(Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+Lc(t)));return t}function SC(e,t,n){return cc(e)&&(t||n)?Uk(e,EC(t||[0,1],n)):e}function EC(e,t){return t?e.slice().reverse():e}function $C(e){Fg.call(this,null,e)}Ec(kC,Fg,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";if(n===dk)return"sequential-linear";(function(e){const t=e.type;return Rk(t)&&t!==ck&&t!==fk&&(e.scheme||e.range&&e.range.length&&e.range.every(Fc))})(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":"");return(r+n||ak).toLowerCase()}(e);for(i in r&&i===r.type||(this.value=r=Fk(i)()),e)if(!_C[i]){if("padding"===i&&wC(r.type))continue;cc(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==bk&&e!==vk&&Eu("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===vk?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*ik(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;Pu(t.scheme)?r=Vk(t.scheme,t.interpolate,t.interpolateGamma):(r=Kk(t.scheme.toLowerCase()))||Eu("Unrecognized scheme name: ".concat(t.scheme));return n=e===gk?n+1:e===xk?n-1:e===pk||e===mk?+t.schemeCount||5:n,Ik(e)?SC(r,i,t.reverse):cc(r)?Wk(SC(r,i),n):e===yk?r:r.slice(0,n)}(r,t,n),cc(a))){if(e.interpolator)return e.interpolator(a);Eu("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&Ik(r))return e.interpolator(Vk(EC(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Gk(t.interpolate,t.interpolateGamma)):cc(e.round)?e.round(i):cc(e.rangeRound)&&e.interpolate(i?Yw:Xw);a&&e.range(EC(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!Pu(r)){const t=e.domain(),n=t[0],i=Uu(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||Eu("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=rd(o,s+a/2,a)}r?e.bins=r:e.bins&&delete e.bins;e.type===xk&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain());return n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(OC(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===ak||t===sk||t===lk)}(e);if(!o)return 0;wC(s)&&t.padding&&o[0]!==Uu(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(Uu(n)-n[0]),s=o/(o-2*r),l=e===ok?rc(t,null,s):e===lk?ic(t,null,s,.5):e===sk?ic(t,null,s,i||1):e===uk?ac(t,null,s,a||1):nc(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant));if((l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}e.domain(OC(s,o,n)),s===yk&&e.unknown(t.domainImplicit?vx:void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&nO(e,t.nice)||null);return o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Ec($C,Fg,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(og(e.sort)),this.modified(n),t}});const AC="zero",DC="center",CC="normalize",MC=["y0","y1"];function jC(e){Fg.call(this,null,e)}function FC(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function TC(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function NC(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}jC.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:AC,values:[AC,DC,CC]},{name:"as",type:"string",array:!0,length:2,default:MC}]},Ec(jC,Fg,{transform(e,t){var n,r,i,a,o=e.as||MC,s=o[0],l=o[1],u=og(e.sort),c=e.field||ju,f=e.offset===DC?FC:e.offset===CC?TC:NC;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,f,d,h=[],p=e=>e(l);if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],h.push(c)),c.push(l);for(u=0,d=0,s=h.length;u<s;++u){for(a=0,f=0,o=(c=h[u]).length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,f>d&&(d=f),n&&c.sort(n)}return h.max=d,h}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var RC=Object.freeze({__proto__:null,axisticks:oC,datajoin:sC,encode:uC,legendentries:cC,linkpath:mC,pie:xC,scale:kC,sortitems:$C,stack:jC}),PC=1e-6,zC=1e-12,BC=Math.PI,IC=BC/2,LC=BC/4,qC=2*BC,UC=180/BC,VC=BC/180,WC=Math.abs,HC=Math.atan,GC=Math.atan2,XC=Math.cos,YC=Math.ceil,JC=Math.exp,KC=Math.hypot,QC=Math.log,ZC=Math.pow,eM=Math.sin,tM=Math.sign||function(e){return e>0?1:e<0?-1:0},nM=Math.sqrt,rM=Math.tan;function iM(e){return e>1?0:e<-1?BC:Math.acos(e)}function aM(e){return e>1?IC:e<-1?-IC:Math.asin(e)}function oM(){}function sM(e,t){e&&uM.hasOwnProperty(e.type)&&uM[e.type](e,t)}var lM={Feature:function(e,t){sM(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)sM(n[r].geometry,t)}},uM={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){cM(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)cM(n[r],t,0)},Polygon:function(e,t){fM(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)fM(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)sM(n[r],t)}};function cM(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function fM(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)cM(e[n],t,1);t.polygonEnd()}function dM(e,t){e&&lM.hasOwnProperty(e.type)?lM[e.type](e,t):sM(e,t)}var hM,pM,mM,gM,yM,vM,bM,xM,wM,_M,kM,OM,SM,EM,$M,AM,DM=new qf,CM=new qf,MM={point:oM,lineStart:oM,lineEnd:oM,polygonStart:function(){DM=new qf,MM.lineStart=jM,MM.lineEnd=FM},polygonEnd:function(){var e=+DM;CM.add(e<0?qC+e:e),this.lineStart=this.lineEnd=this.point=oM},sphere:function(){CM.add(qC)}};function jM(){MM.point=TM}function FM(){NM(hM,pM)}function TM(e,t){MM.point=NM,hM=e,pM=t,mM=e*=VC,gM=XC(t=(t*=VC)/2+LC),yM=eM(t)}function NM(e,t){var n=(e*=VC)-mM,r=n>=0?1:-1,i=r*n,a=XC(t=(t*=VC)/2+LC),o=eM(t),s=yM*o,l=gM*a+s*XC(i),u=s*r*eM(i);DM.add(GC(u,l)),mM=e,gM=a,yM=o}function RM(e){return[GC(e[1],e[0]),aM(e[2])]}function PM(e){var t=e[0],n=e[1],r=XC(n);return[r*XC(t),r*eM(t),eM(n)]}function zM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function BM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function IM(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function LM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function qM(e){var t=nM(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var UM,VM,WM,HM,GM,XM,YM,JM,KM,QM,ZM,ej,tj,nj,rj,ij,aj={point:oj,lineStart:lj,lineEnd:uj,polygonStart:function(){aj.point=cj,aj.lineStart=fj,aj.lineEnd=dj,EM=new qf,MM.polygonStart()},polygonEnd:function(){MM.polygonEnd(),aj.point=oj,aj.lineStart=lj,aj.lineEnd=uj,DM<0?(vM=-(xM=180),bM=-(wM=90)):EM>PC?wM=90:EM<-1e-6&&(bM=-90),AM[0]=vM,AM[1]=xM},sphere:function(){vM=-(xM=180),bM=-(wM=90)}};function oj(e,t){$M.push(AM=[vM=e,xM=e]),t<bM&&(bM=t),t>wM&&(wM=t)}function sj(e,t){var n=PM([e*VC,t*VC]);if(SM){var r=BM(SM,n),i=BM([r[1],-r[0],0],r);qM(i),i=RM(i);var a,o=e-_M,s=o>0?1:-1,l=i[0]*UC*s,u=WC(o)>180;u^(s*_M<l&&l<s*e)?(a=i[1]*UC)>wM&&(wM=a):u^(s*_M<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*UC)<bM&&(bM=a):(t<bM&&(bM=t),t>wM&&(wM=t)),u?e<_M?hj(vM,e)>hj(vM,xM)&&(xM=e):hj(e,xM)>hj(vM,xM)&&(vM=e):xM>=vM?(e<vM&&(vM=e),e>xM&&(xM=e)):e>_M?hj(vM,e)>hj(vM,xM)&&(xM=e):hj(e,xM)>hj(vM,xM)&&(vM=e)}else $M.push(AM=[vM=e,xM=e]);t<bM&&(bM=t),t>wM&&(wM=t),SM=n,_M=e}function lj(){aj.point=sj}function uj(){AM[0]=vM,AM[1]=xM,aj.point=oj,SM=null}function cj(e,t){if(SM){var n=e-_M;EM.add(WC(n)>180?n+(n>0?360:-360):n)}else kM=e,OM=t;MM.point(e,t),sj(e,t)}function fj(){MM.lineStart()}function dj(){cj(kM,OM),MM.lineEnd(),WC(EM)>PC&&(vM=-(xM=180)),AM[0]=vM,AM[1]=xM,SM=null}function hj(e,t){return(t-=e)<0?t+360:t}function pj(e,t){return e[0]-t[0]}function mj(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var gj={sphere:oM,point:yj,lineStart:bj,lineEnd:_j,polygonStart:function(){gj.lineStart=kj,gj.lineEnd=Oj},polygonEnd:function(){gj.lineStart=bj,gj.lineEnd=_j}};function yj(e,t){e*=VC;var n=XC(t*=VC);vj(n*XC(e),n*eM(e),eM(t))}function vj(e,t,n){++UM,WM+=(e-WM)/UM,HM+=(t-HM)/UM,GM+=(n-GM)/UM}function bj(){gj.point=xj}function xj(e,t){e*=VC;var n=XC(t*=VC);nj=n*XC(e),rj=n*eM(e),ij=eM(t),gj.point=wj,vj(nj,rj,ij)}function wj(e,t){e*=VC;var n=XC(t*=VC),r=n*XC(e),i=n*eM(e),a=eM(t),o=GC(nM((o=rj*a-ij*i)*o+(o=ij*r-nj*a)*o+(o=nj*i-rj*r)*o),nj*r+rj*i+ij*a);VM+=o,XM+=o*(nj+(nj=r)),YM+=o*(rj+(rj=i)),JM+=o*(ij+(ij=a)),vj(nj,rj,ij)}function _j(){gj.point=yj}function kj(){gj.point=Sj}function Oj(){Ej(ej,tj),gj.point=yj}function Sj(e,t){ej=e,tj=t,e*=VC,t*=VC,gj.point=Ej;var n=XC(t);nj=n*XC(e),rj=n*eM(e),ij=eM(t),vj(nj,rj,ij)}function Ej(e,t){e*=VC;var n=XC(t*=VC),r=n*XC(e),i=n*eM(e),a=eM(t),o=rj*a-ij*i,s=ij*r-nj*a,l=nj*i-rj*r,u=KC(o,s,l),c=aM(u),f=u&&-c/u;KM.add(f*o),QM.add(f*s),ZM.add(f*l),VM+=c,XM+=c*(nj+(nj=r)),YM+=c*(rj+(rj=i)),JM+=c*(ij+(ij=a)),vj(nj,rj,ij)}function $j(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Aj(e,t){return[WC(e)>BC?e+Math.round(-e/qC)*qC:e,t]}function Dj(e,t,n){return(e%=qC)?t||n?$j(Mj(e),jj(t,n)):Mj(e):t||n?jj(t,n):Aj}function Cj(e){return function(t,n){return[(t+=e)>BC?t-qC:t<-BC?t+qC:t,n]}}function Mj(e){var t=Cj(e);return t.invert=Cj(-e),t}function jj(e,t){var n=XC(e),r=eM(e),i=XC(t),a=eM(t);function o(e,t){var o=XC(t),s=XC(e)*o,l=eM(e)*o,u=eM(t),c=u*n+s*r;return[GC(l*i-c*a,s*n-u*r),aM(c*i+l*a)]}return o.invert=function(e,t){var o=XC(t),s=XC(e)*o,l=eM(e)*o,u=eM(t),c=u*i-l*a;return[GC(l*i+u*a,s*n+c*r),aM(c*n-s*r)]},o}function Fj(e,t){(t=PM(t))[0]-=e,qM(t);var n=iM(-t[1]);return((-t[2]<0?-n:n)+qC-PC)%qC}function Tj(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:oM,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Nj(e,t){return WC(e[0]-t[0])<PC&&WC(e[1]-t[1])<PC}function Rj(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Pj(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(Nj(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new Rj(r,e,null,!0)),l.push(n.o=new Rj(r,null,n,!1)),s.push(n=new Rj(o,e,null,!1)),l.push(n.o=new Rj(o,null,n,!0))}})),s.length){for(l.sort(t),zj(s),zj(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,f=s[0];;){for(var d=f,h=!0;d.v;)if((d=d.n)===f)return;u=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(u=d.p.z,a=u.length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}u=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}}function zj(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Bj(e){return WC(e[0])<=BC?e[0]:tM(e[0])*((WC(e[0])+BC)%qC-BC)}function Ij(e,t,n,r){return function(i){var a,o,s,l=t(i),u=Tj(),c=t(u),f=!1,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,o=[],a=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,o=nd(o);var e=function(e,t){var n=Bj(t),r=t[1],i=eM(r),a=[eM(n),-XC(n),0],o=0,s=0,l=new qf;1===i?r=IC+PC:-1===i&&(r=-IC-PC);for(var u=0,c=e.length;u<c;++u)if(d=(f=e[u]).length)for(var f,d,h=f[d-1],p=Bj(h),m=h[1]/2+LC,g=eM(m),y=XC(m),v=0;v<d;++v,p=x,g=_,y=k,h=b){var b=f[v],x=Bj(b),w=b[1]/2+LC,_=eM(w),k=XC(w),O=x-p,S=O>=0?1:-1,E=S*O,$=E>BC,A=g*_;if(l.add(GC(A*S*eM(E),y*k+A*XC(E))),o+=$?O+S*qC:O,$^p>=n^x>=n){var D=BM(PM(h),PM(b));qM(D);var C=BM(a,D);qM(C);var M=($^O>=0?-1:1)*aM(C[2]);(r>M||r===M&&(D[0]||D[1]))&&(s+=$^O>=0?1:-1)}}return(o<-1e-6||o<PC&&l<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),Pj(o,qj,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){d.point=p,l.lineStart()}function g(){d.point=h,l.lineEnd()}function y(e,t){s.push([e,t]),c.point(e,t)}function v(){c.lineStart(),s=[]}function b(){y(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),d=u.result(),h=d.length;if(s.pop(),a.push(s),s=null,h)if(1&l){if((t=(n=d[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(Lj))}return d}}function Lj(e){return e.length>1}function qj(e,t){return((e=e.x)[0]<0?e[1]-IC-PC:IC-e[1])-((t=t.x)[0]<0?t[1]-IC-PC:IC-t[1])}Aj.invert=Aj;var Uj=Ij((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?BC:-BC,l=WC(a-n);WC(l-BC)<PC?(e.point(n,r=(r+o)/2>0?IC:-IC),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=BC&&(WC(n-i)<PC&&(n-=i*PC),WC(a-s)<PC&&(a-=s*PC),r=function(e,t,n,r){var i,a,o=eM(e-n);return WC(o)>PC?HC((eM(t)*(a=XC(r))*eM(n)-eM(r)*(i=XC(t))*eM(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*IC,r.point(-BC,i),r.point(0,i),r.point(BC,i),r.point(BC,0),r.point(BC,-i),r.point(0,-i),r.point(-BC,-i),r.point(-BC,0),r.point(-BC,i);else if(WC(e[0]-t[0])>PC){var a=e[0]<t[0]?BC:-BC;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-BC,-IC]);function Vj(e){var t=XC(e),n=6*VC,r=t>0,i=WC(t)>PC;function a(e,n){return XC(e)*XC(n)>t}function o(e,n,r){var i=[1,0,0],a=BM(PM(e),PM(n)),o=zM(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,f=BM(i,a),d=LM(i,u);IM(d,LM(a,c));var h=f,p=zM(d,h),m=zM(h,h),g=p*p-m*(zM(d,d)-1);if(!(g<0)){var y=nM(g),v=LM(h,(-p-y)/m);if(IM(v,d),v=RM(v),!r)return v;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var O=w-x,S=WC(O-BC)<PC;if(!S&&k<_&&(b=_,_=k,k=b),S||O<PC?S?_+k>0^v[1]<(WC(v[0]-x)<PC?_:k):_<=v[1]&&v[1]<=k:O>BC^(x<=v[0]&&v[0]<=w)){var E=LM(h,(-p+y)/m);return IM(E,d),[v,RM(E)]}}}function s(t,n){var i=r?e:BC-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Ij(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(f,d){var h,p=[f,d],m=a(f,d),g=r?m?0:s(f,d):m?s(f+(f<0?BC:-BC),d):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(h=o(t,p))||Nj(t,h)||Nj(p,h))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),h=o(p,t),e.point(h[0],h[1])):(h=o(t,p),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var y;g&n||!(y=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!m||t&&Nj(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=XC(t),s=eM(t),l=r*n;null==i?(i=t+r*qC,a=t-l/2):(i=Fj(o,i),a=Fj(o,a),(r>0?i<a:i>a)&&(i+=r*qC));for(var u,c=i;r>0?c>a:c<a;c-=l)u=RM([o,-s*XC(c),-s*eM(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-BC,e-BC])}var Wj=1e9,Hj=-Wj;function Gj(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,f=0;if(null==i||(c=o(i,s))!==(f=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==f);else u.point(a[0],a[1])}function o(r,i){return WC(r[0]-e)<PC?i>0?0:3:WC(r[0]-n)<PC?i>0?2:1:WC(r[1]-t)<PC?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,f,d,h,p,m,g,y,v,b=o,x=Tj(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]);y=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(k(f,d),h&&g&&x.rejoin(),l.push(x.result()));w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,f=s[0],d=f[0],h=f[1];l<c;++l)a=d,o=h,d=(f=s[l])[0],h=f[1],o<=r?h>r&&(d-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(d-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=v&&t,i=(l=nd(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&Pj(l,s,t,a,o),o.polygonEnd());b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(u&&c.push([a,o]),y)f=a,d=o,h=s,y=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(Hj,Math.min(Wj,p)),m=Math.max(Hj,Math.min(Wj,m))],x=[a=Math.max(Hj,Math.min(Wj,a)),o=Math.max(Hj,Math.min(Wj,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,f=t[0]-s,d=t[1]-l;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<u)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>u&&(u=o)}else if(f>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*f,e[1]=l+u*d),c<1&&(t[0]=s+c*f,t[1]=l+c*d),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),v=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),v=!1)}p=a,m=o,g=s}return w}}function Xj(e,t,n){var r=rd(e,t-PC,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function Yj(e,t,n){var r=rd(e,t-PC,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var Jj,Kj,Qj,Zj,eF=e=>e,tF=new qf,nF=new qf,rF={point:oM,lineStart:oM,lineEnd:oM,polygonStart:function(){rF.lineStart=iF,rF.lineEnd=sF},polygonEnd:function(){rF.lineStart=rF.lineEnd=rF.point=oM,tF.add(WC(nF)),nF=new qf},result:function(){var e=tF/2;return tF=new qf,e}};function iF(){rF.point=aF}function aF(e,t){rF.point=oF,Jj=Qj=e,Kj=Zj=t}function oF(e,t){nF.add(Zj*e-Qj*t),Qj=e,Zj=t}function sF(){oF(Jj,Kj)}var lF=1/0,uF=lF,cF=-lF,fF=cF,dF={point:function(e,t){e<lF&&(lF=e);e>cF&&(cF=e);t<uF&&(uF=t);t>fF&&(fF=t)},lineStart:oM,lineEnd:oM,polygonStart:oM,polygonEnd:oM,result:function(){var e=[[lF,uF],[cF,fF]];return cF=fF=-(uF=lF=1/0),e}};var hF,pF,mF,gF,yF=0,vF=0,bF=0,xF=0,wF=0,_F=0,kF=0,OF=0,SF=0,EF={point:$F,lineStart:AF,lineEnd:MF,polygonStart:function(){EF.lineStart=jF,EF.lineEnd=FF},polygonEnd:function(){EF.point=$F,EF.lineStart=AF,EF.lineEnd=MF},result:function(){var e=SF?[kF/SF,OF/SF]:_F?[xF/_F,wF/_F]:bF?[yF/bF,vF/bF]:[NaN,NaN];return yF=vF=bF=xF=wF=_F=kF=OF=SF=0,e}};function $F(e,t){yF+=e,vF+=t,++bF}function AF(){EF.point=DF}function DF(e,t){EF.point=CF,$F(mF=e,gF=t)}function CF(e,t){var n=e-mF,r=t-gF,i=nM(n*n+r*r);xF+=i*(mF+e)/2,wF+=i*(gF+t)/2,_F+=i,$F(mF=e,gF=t)}function MF(){EF.point=$F}function jF(){EF.point=TF}function FF(){NF(hF,pF)}function TF(e,t){EF.point=NF,$F(hF=mF=e,pF=gF=t)}function NF(e,t){var n=e-mF,r=t-gF,i=nM(n*n+r*r);xF+=i*(mF+e)/2,wF+=i*(gF+t)/2,_F+=i,kF+=(i=gF*e-mF*t)*(mF+e),OF+=i*(gF+t),SF+=3*i,$F(mF=e,gF=t)}function RF(e){this._context=e}RF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,qC)}},result:oM};var PF,zF,BF,IF,LF,qF=new qf,UF={point:oM,lineStart:function(){UF.point=VF},lineEnd:function(){PF&&WF(zF,BF),UF.point=oM},polygonStart:function(){PF=!0},polygonEnd:function(){PF=null},result:function(){var e=+qF;return qF=new qf,e}};function VF(e,t){UF.point=WF,zF=IF=e,BF=LF=t}function WF(e,t){IF-=e,LF-=t,qF.add(nM(IF*IF+LF*LF)),IF=e,LF=t}function HF(){this._string=[]}function GF(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function XF(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),dM(e,n(r))),r.result()}return a.area=function(e){return dM(e,n(rF)),rF.result()},a.measure=function(e){return dM(e,n(UF)),UF.result()},a.bounds=function(e){return dM(e,n(dF)),dF.result()},a.centroid=function(e){return dM(e,n(EF)),EF.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,eF):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new HF):new RF(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function YF(e){return function(t){var n=new JF;for(var r in e)n[r]=e[r];return n.stream=t,n}}function JF(){}function KF(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),dM(n,e.stream(dF)),t(dF.result()),null!=r&&e.clipExtent(r),e}function QF(e,t,n){return KF(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function ZF(e,t,n){return QF(e,[[0,0],t],n)}function eT(e,t,n){return KF(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function tT(e,t,n){return KF(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}HF.prototype={_radius:4.5,_circle:GF(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=GF(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}},JF.prototype={constructor:JF,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var nT=XC(30*VC);function rT(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var x=o+d,w=s+h,_=l+p,k=nM(x*x+w*w+_*_),O=aM(_/=k),S=WC(WC(_)-1)<PC||WC(a-f)<PC?(a+f)/2:GC(w,x),E=e(S,O),$=E[0],A=E[1],D=$-r,C=A-i,M=v*D-y*C;(M*M/b>t||WC((y*D+v*C)/b-.5)>.3||o*d+s*h+l*p<nT)&&(n(r,i,a,o,s,l,$,A,S,x/=k,w/=k,_,m,g),g.point($,A),n($,A,S,x,w,_,u,c,f,d,h,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,f,d,h,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){c=NaN,m.point=v,t.lineStart()}function v(r,i){var a=PM([r,i]),o=e(r,i);n(c,f,u,d,h,p,c=o[0],f=o[1],u=r,d=a[0],h=a[1],p=a[2],16,t),t.point(c,f)}function b(){m.point=g,t.lineEnd()}function x(){y(),m.point=w,m.lineEnd=_}function w(e,t){v(r=e,t),i=c,a=f,o=d,s=h,l=p,m.point=v}function _(){n(c,f,u,d,h,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return YF({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var iT=YF({point:function(e,t){this.stream.point(e*VC,t*VC)}});function aT(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=XC(a),s=eM(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-f*t+d),i*(h-f*e-c*t)]},p}function oT(e){return sT((function(){return e}))()}function sT(e){var t,n,r,i,a,o,s,l,u,c,f=150,d=480,h=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,w=1,_=null,k=Uj,O=null,S=eF,E=.5;function $(e){return l(e[0]*VC,e[1]*VC)}function A(e){return(e=l.invert(e[0],e[1]))&&[e[0]*UC,e[1]*UC]}function D(){var e=aT(f,0,0,x,w,b).apply(null,t(p,m)),r=aT(f,d-e[0],h-e[1],x,w,b);return n=Dj(g,y,v),s=$j(t,r),l=$j(n,s),o=rT(s,E),C()}function C(){return u=c=null,$}return $.stream=function(e){return u&&c===e?u:u=iT(function(e){return YF({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(c=e)))))},$.preclip=function(e){return arguments.length?(k=e,_=void 0,C()):k},$.postclip=function(e){return arguments.length?(S=e,O=r=i=a=null,C()):S},$.clipAngle=function(e){return arguments.length?(k=+e?Vj(_=e*VC):(_=null,Uj),C()):_*UC},$.clipExtent=function(e){return arguments.length?(S=null==e?(O=r=i=a=null,eF):Gj(O=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),C()):null==O?null:[[O,r],[i,a]]},$.scale=function(e){return arguments.length?(f=+e,D()):f},$.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],D()):[d,h]},$.center=function(e){return arguments.length?(p=e[0]%360*VC,m=e[1]%360*VC,D()):[p*UC,m*UC]},$.rotate=function(e){return arguments.length?(g=e[0]%360*VC,y=e[1]%360*VC,v=e.length>2?e[2]%360*VC:0,D()):[g*UC,y*UC,v*UC]},$.angle=function(e){return arguments.length?(b=e%360*VC,D()):b*UC},$.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},$.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},$.precision=function(e){return arguments.length?(o=rT(s,E=e*e),C()):nM(E)},$.fitExtent=function(e,t){return QF($,e,t)},$.fitSize=function(e,t){return ZF($,e,t)},$.fitWidth=function(e,t){return eT($,e,t)},$.fitHeight=function(e,t){return tT($,e,t)},function(){return t=e.apply(this,arguments),$.invert=t.invert&&A,D()}}function lT(e){var t=0,n=BC/3,r=sT(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*VC,n=e[1]*VC):[t*UC,n*UC]},i}function uT(e,t){var n=eM(e),r=(n+eM(t))/2;if(WC(r)<PC)return function(e){var t=XC(e);function n(e,n){return[e*t,eM(n)/t]}return n.invert=function(e,n){return[e/t,aM(n*t)]},n}(e);var i=1+n*(2*r-n),a=nM(i)/r;function o(e,t){var n=nM(i-2*r*eM(t))/r;return[n*eM(e*=r),a-n*XC(e)]}return o.invert=function(e,t){var n=a-t,o=GC(e,WC(n))*tM(n);return n*r<0&&(o-=BC*tM(e)*tM(n)),[o/r,aM((i-(e*e+n*n)*r*r)/(2*r))]},o}function cT(){return lT(uT).scale(155.424).center([0,33.6442])}function fT(){return cT().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function dT(e){return function(t,n){var r=XC(t),i=XC(n),a=e(r*i);return a===1/0?[2,0]:[a*i*eM(t),a*eM(n)]}}function hT(e){return function(t,n){var r=nM(t*t+n*n),i=e(r),a=eM(i),o=XC(i);return[GC(t*a,r*o),aM(r&&n*a/r)]}}var pT=dT((function(e){return nM(2/(1+e))}));pT.invert=hT((function(e){return 2*aM(e/2)}));var mT=dT((function(e){return(e=iM(e))&&e/eM(e)}));function gT(e,t){return[e,QC(rM((IC+t)/2))]}function yT(e){var t,n,r,i=oT(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=BC*o(),s=i(function(e){function t(t){return(t=e(t[0]*VC,t[1]*VC))[0]*=UC,t[1]*=UC,t}return e=Dj(e[0]*VC,e[1]*VC,e.length>2?e[2]*VC:0),t.invert=function(t){return(t=e.invert(t[0]*VC,t[1]*VC))[0]*=UC,t[1]*=UC,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===gT?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function vT(e){return rM((IC+e)/2)}function bT(e,t){var n=XC(e),r=e===t?eM(e):QC(n/XC(t))/QC(vT(t)/vT(e)),i=n*ZC(vT(e),r)/r;if(!r)return gT;function a(e,t){i>0?t<-IC+PC&&(t=-IC+PC):t>IC-PC&&(t=IC-PC);var n=i/ZC(vT(t),r);return[n*eM(r*e),i-n*XC(r*e)]}return a.invert=function(e,t){var n=i-t,a=tM(r)*nM(e*e+n*n),o=GC(e,WC(n))*tM(n);return n*r<0&&(o-=BC*tM(e)*tM(n)),[o/r,2*HC(ZC(i/a,1/r))-IC]},a}function xT(e,t){return[e,t]}function wT(e,t){var n=XC(e),r=e===t?eM(e):(n-XC(t))/(t-e),i=n/r+e;if(WC(r)<PC)return xT;function a(e,t){var n=i-t,a=r*e;return[n*eM(a),i-n*XC(a)]}return a.invert=function(e,t){var n=i-t,a=GC(e,WC(n))*tM(n);return n*r<0&&(a-=BC*tM(e)*tM(n)),[a/r,i-tM(r)*nM(e*e+n*n)]},a}mT.invert=hT((function(e){return e})),gT.invert=function(e,t){return[e,2*HC(JC(t))-IC]},xT.invert=xT;var _T=1.340264,kT=-.081106,OT=893e-6,ST=.003796,ET=nM(3)/2;function $T(e,t){var n=aM(ET*eM(t)),r=n*n,i=r*r*r;return[e*XC(n)/(ET*(_T+3*kT*r+i*(7*OT+9*ST*r))),n*(_T+kT*r+i*(OT+ST*r))]}function AT(e,t){var n=XC(t),r=XC(e)*n;return[n*eM(e)/r,eM(t)/r]}function DT(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function CT(e,t){return[XC(t)*eM(e),eM(t)]}function MT(e,t){var n=XC(t),r=1+XC(e)*n;return[n*eM(e)/r,eM(t)/r]}function jT(e,t){return[QC(rM((IC+t)/2)),-e]}$T.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(_T+kT*i+a*(OT+ST*i))-t)/(_T+3*kT*i+a*(7*OT+9*ST*i)))*r)*i*i,!(WC(n)<zC));++o);return[ET*e*(_T+3*kT*i+a*(7*OT+9*ST*i))/XC(r),aM(eM(r)/ET)]},AT.invert=hT(HC),DT.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(WC(n)>PC&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},CT.invert=hT(aM),MT.invert=hT((function(e){return 2*HC(e)})),jT.invert=function(e,t){return[-t,2*HC(JC(e))-IC]};var FT=Math.abs,TT=Math.cos,NT=Math.sin,RT=Math.PI,PT=RT/2,zT=function(e){return e>0?Math.sqrt(e):0}(2);function BT(e){return e>1?PT:e<-1?-PT:Math.asin(e)}function IT(e,t){var n,r=e*NT(t),i=30;do{t-=n=(t+NT(t)-r)/(1+TT(t))}while(FT(n)>1e-6&&--i>0);return t/2}var LT=function(e,t,n){function r(r,i){return[e*r*TT(i=IT(n,i)),t*NT(i)]}return r.invert=function(r,i){return i=BT(i/t),[r/(e*TT(i)),BT((2*i+NT(2*i))/n)]},r}(zT/PT,zT,RT);const qT=XF(),UT=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function VT(e,t){return function n(){const r=t();return r.type=e,r.path=XF().projection(r),r.copy=r.copy||function(){const e=n();return UT.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function WT(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(GT[e]=VT(e,t),this):GT[e]||null}function HT(e){return e&&e.path||qT}const GT={albers:fT,albersusa:function(){var e,t,n,r,i,a,o=fT(),s=cT().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=cT().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),f()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+PC,c+.12*t+PC],[a-.214*t-PC,c+.234*t-PC]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+PC,c+.166*t+PC],[a-.115*t-PC,c+.234*t-PC]]).stream(u),f()},c.fitExtent=function(e,t){return QF(c,e,t)},c.fitSize=function(e,t){return ZF(c,e,t)},c.fitWidth=function(e,t){return eT(c,e,t)},c.fitHeight=function(e,t){return tT(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return oT(pT).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return oT(mT).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return lT(bT).scale(109.5).parallels([30,30])},conicequalarea:cT,conicequidistant:function(){return lT(wT).scale(131.154).center([0,13.9389])},equalEarth:function(){return oT($T).scale(177.158)},equirectangular:function(){return oT(xT).scale(152.63)},gnomonic:function(){return oT(AT).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,f=1,d=0,h=null,p=1,m=1,g=YF({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=eF;function v(){return p=s*c,m=s*f,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(d){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(y(o=e))},b.postclip=function(e){return arguments.length?(y=e,h=n=r=i=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(h=n=r=i=null,eF):Gj(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),v()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,v()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],v()):[l,u]},b.angle=function(n){return arguments.length?(t=eM(d=n%360*VC),e=XC(d),v()):d*UC},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,v()):f<0},b.fitExtent=function(e,t){return QF(b,e,t)},b.fitSize=function(e,t){return ZF(b,e,t)},b.fitWidth=function(e,t){return eT(b,e,t)},b.fitHeight=function(e,t){return tT(b,e,t)},b},mercator:function(){return yT(gT).scale(961/qC)},mollweide:function(){return oT(LT).scale(169.529)},naturalEarth1:function(){return oT(DT).scale(175.295)},orthographic:function(){return oT(CT).scale(249.5).clipAngle(90.000001)},stereographic:function(){return oT(MT).scale(250).clipAngle(142)},transversemercator:function(){var e=yT(jT),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in GT)WT(e,GT[e]);function XT(){}const YT=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function JT(){var e=1,t=1,n=o;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,f,d=new Array,h=new Array;o=s=-1,u=n[0]>=r,YT[u<<1].forEach(p);for(;++o<e-1;)l=u,u=n[o+1]>=r,YT[l|u<<1].forEach(p);YT[u<<0].forEach(p);for(;++s<t-1;){for(o=-1,u=n[s*e+e]>=r,c=n[s*e]>=r,YT[u<<1|c<<2].forEach(p);++o<e-1;)l=u,u=n[s*e+e+o+1]>=r,f=c,c=n[s*e+o+1]>=r,YT[l|u<<1|c<<2|f<<3].forEach(p);YT[u|c<<3].forEach(p)}o=-1,c=n[s*e]>=r,YT[c<<2].forEach(p);for(;++o<e-1;)f=c,c=n[s*e+o+1]>=r,YT[c<<2|f<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}YT[c<<3].forEach(p)}(r,i,(e=>{n(e,r,i),function(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==KT((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(a=r[u*e+l-1],n[0]=o+(i-a)/(c-a)-.5),s>0&&s<t&&u===s&&(a=r[(u-1)*e+l],n[1]=s+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||Eu("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:XT,r):n===o},r}function KT(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=QT(e,t[r]))return n;return 0}function QT(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(ZT(l,f,t))return 0;c>r!=h>r&&n<(d-u)*(r-c)/(h-c)+u&&(i=-i)}return i}function ZT(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function eN(e,t,n){return function(r){var i=bc(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?Xf(a,o,e):s/(e+1);return rd(a+l,o,l)}}function tN(e){Fg.call(this,null,e)}function nN(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function rN(e,t,n){const r=e>=0?e:Ig(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function iN(e){return cc(e)?e:gc(+e)}function aN(){var e=e=>e[0],t=e=>e[1],n=ju,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=rN(r[0],s,e)>>o,c=rN(r[1],s,t)>>o,f=u?u+2:0,d=c?c+2:0,h=2*f+(i>>o),p=2*d+(a>>o),m=new Float32Array(h*p),g=new Float32Array(h*p);let y=m;s.forEach((r=>{const i=f+(+e(r)>>o),a=d+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<p&&(m[i+a*h]+=+n(r))})),u>0&&c>0?(oN(h,p,m,g,u),sN(h,p,g,m,c),oN(h,p,m,g,u),sN(h,p,g,m,c),oN(h,p,m,g,u),sN(h,p,g,m,c)):u>0?(oN(h,p,m,g,u),oN(h,p,g,m,u),oN(h,p,m,g,u),y=g):c>0&&(sN(h,p,m,g,c),sN(h,p,g,m,c),sN(h,p,m,g,c),y=g);const v=l?Math.pow(2,-2*o):1/id(y);for(let e=0,t=h*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(i>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=iN(t),s):e},s.y=function(e){return arguments.length?(t=iN(e),s):t},s.weight=function(e){return arguments.length?(n=iN(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||Eu("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||Eu("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=lc(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&Eu("invalid bandwidth"),r=e,s):r},s}function oN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function sN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function lN(e){Fg.call(this,null,e)}tN.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},Ec(tN,Fg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Cu,a=JT().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=eN(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>Yf(t(e).values))))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,Pu(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;cc(i)&&(i=i(n,r));cc(a)&&(a=a(n,r));if((1===i||null==i)&&!a)return;const o=(Mc(i)?i:i[0])||1,s=(Mc(i)?i:i[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(nN(t,o,s,l,u))}(r,n,t,e),r.forEach((e=>{l.push(ig(t,ng(null!=s?{[s]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),lN.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const uN=["x","y","weight","size","cellSize","bandwidth"];function cN(e,t){return uN.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function fN(e){Fg.call(this,null,e)}Ec(lN,Fg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(wu),o=cN(aN(),e),s=e.as||"grid";return n=i.map((t=>ng(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),fN.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},Ec(fN,Fg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=JT().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||eN(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=nN(n=cN(aN(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=Pu(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(ng),i}});const dN="Feature",hN="FeatureCollection";function pN(e){Fg.call(this,null,e)}function mN(e){Fg.call(this,null,e)}function gN(e){Fg.call(this,null,e)}function yN(e){Fg.call(this,null,e)}function vN(e){Fg.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,f,d=10,h=d,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return rd(YC(r/p)*p,n,p).map(c).concat(rd(YC(s/m)*m,o,m).map(f)).concat(rd(YC(t/d)*d,e,d).filter((function(e){return WC(e%p)>PC})).map(l)).concat(rd(YC(a/h)*h,i,h).filter((function(e){return WC(e%m)>PC})).map(u))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(o).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),y.precision(g)):[[r,s],[n,o]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),y.precision(g)):[[t,a],[e,i]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],y):[p,m]},y.stepMinor=function(e){return arguments.length?(d=+e[0],h=+e[1],y):[d,h]},y.precision=function(d){return arguments.length?(g=+d,l=Xj(a,i,90),u=Yj(t,e,g),c=Xj(s,o,90),f=Yj(r,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function bN(e){Fg.call(this,null,e)}function xN(e){if(!cc(e))return!1;const t=Hc(_u(e));return t.$x||t.$y||t.$value||t.$max}function wN(e){Fg.call(this,null,e),this.modified(!0)}function _N(e,t,n){cc(e[t])&&e[t](n)}pN.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},Ec(pN,Fg,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&Cu,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(_u(l))||o&&t.modified(_u(o))||s&&t.modified(_u(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,(e=>r.push(l(e)))),o&&s&&(t.visit(u,(e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:dN,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:hN,features:r}}}),mN.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},Ec(mN,Fg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Cu,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=HT(e.projection),n.materialize().reflow()):o=i===Cu||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(r,e.pointRadius);return n.visit(o,(e=>e[a]=r(i(e)))),r.pointRadius(s),n.modifies(a)}}),gN.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},Ec(gN,Fg,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),yN.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},Ec(yN,Fg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(HT(e.projection),e.field||Au("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),vN.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},Ec(vN,Fg,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)cc(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(ag(r[0],n)):t.add.push(ng(n)),r[0]=n,t}}),bN.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},Ec(bN,Fg,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||Cu,a=function(e,t){let n;cc(e)?(n=n=>e(n,t),n.dep=xN(e)):e?n=gc(e):(n=e=>e.$value/e.$max||0,n.dep=!0);return n}(e.opacity,e),o=function(e,t){let n;cc(e)?(n=n=>qx(e(n,t)),n.dep=xN(e)):n=gc(qx(e||"#888"));return n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?Yf(n.map((e=>Yf(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=vc({},e,l);r||(n.$max=Yf(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||i,u=e.y2||a,c=e.values,f=c?e=>c[e]:Mu,d=px(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),m=p.data;for(let e=s,a=0;e<u;++e){t.$y=e-s;for(let s=o,u=e*i;s<l;++s,a+=4){t.$x=s-o,t.$value=f(s+u);const e=n(t);m[a+0]=e.r,m[a+1]=e.g,m[a+2]=e.b,m[a+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}(t,n,o.dep?o:gc(o(n)),a.dep?a:gc(a(n)))})),t.reflow(!0).modifies(s)}}),Ec(wN,Fg,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=WT((e||"mercator").toLowerCase());t||Eu("Unrecognized projection type: "+e);return t()}(e.type),UT.forEach((t=>{null!=e[t]&&_N(n,t,e[t])}))):UT.forEach((t=>{e.modified(t)&&_N(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=lc(e)).length?e[0]:{type:hN,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===hN?e.features:lc(e).filter((e=>null!=e)).map((e=>e.type===dN?e:{type:dN,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var kN=Object.freeze({__proto__:null,contour:fN,geojson:pN,geopath:mN,geopoint:gN,geoshape:yN,graticule:vN,heatmap:bN,isocontour:tN,kde2d:lN,projection:wN});function ON(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,f,d,h=e._root,p={data:r},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o,i=h,!(h=h[f=c<<1|u]))return i[f]=p,e;if(s=+e._x.call(null,h.data),l=+e._y.call(null,h.data),t===s&&n===l)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o}while((f=c<<1|u)==(d=(l>=o)<<1|s>=a));return i[d]=h,i[f]=p,e}function SN(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function EN(e){return e[0]}function $N(e){return e[1]}function AN(e,t,n){var r=new DN(null==t?EN:t,null==n?$N:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function DN(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function CN(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var MN=AN.prototype=DN.prototype;function jN(e){return function(){return e}}function FN(e){return 1e-6*(e()-.5)}function TN(e){return e.x+e.vx}function NN(e){return e.y+e.vy}function RN(e){return e.index}function PN(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}MN.copy=function(){var e,t,n=new DN(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=CN(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=CN(t));return n},MN.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return ON(this.cover(t,n),t,n,e)},MN.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>f&&(f=i));if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<a;++n)ON(this,o[n],s[n],e[n]);return this},MN.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n||1,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},MN.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},MN.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},MN.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],m=this._root;for(m&&p.push(new SN(m,c,f,d,h)),null==n?n=1/0:(c=e-n,f=t-n,d=e+n,h=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(a=l.y0)>h||(o=l.x1)<c||(s=l.y1)<f))if(m.length){var g=(i+o)/2,y=(a+s)/2;p.push(new SN(m[3],g,y,o,s),new SN(m[2],i,y,g,s),new SN(m[1],g,a,o,y),new SN(m[0],i,a,g,y)),(u=(t>=y)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,f=t-w,d=e+w,h=t+w,r=m.data}}return r},MN.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,f,d,h=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!h)return this;if(h.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+y)/2))?m=l:y=l,t=h,!(h=h[f=c<<1|u]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},MN.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},MN.root=function(){return this._root},MN.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},MN.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new SN(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new SN(n,u,c,a,o)),(n=l[2])&&s.push(new SN(n,r,c,u,o)),(n=l[1])&&s.push(new SN(n,u,i,a,c)),(n=l[0])&&s.push(new SN(n,r,i,u,c))}return this},MN.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new SN(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,f=(s+u)/2;(a=i[0])&&n.push(new SN(a,o,s,c,f)),(a=i[1])&&n.push(new SN(a,c,s,l,f)),(a=i[2])&&n.push(new SN(a,o,f,c,u)),(a=i[3])&&n.push(new SN(a,c,f,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},MN.x=function(e){return arguments.length?(this._x=e,this):this._x},MN.y=function(e){return arguments.length?(this._y=e,this):this._y};var zN={value:()=>{}};function BN(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new IN(r)}function IN(e){this._=e}function LN(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function qN(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function UN(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=zN,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}IN.prototype=BN.prototype={constructor:IN,on:function(e,t){var n,r=this._,i=LN(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=UN(r[n],e.name,t);else if(null==t)for(n in r)r[n]=UN(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=qN(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new IN(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var VN,WN,HN=0,GN=0,XN=0,YN=0,JN=0,KN=0,QN="object"==typeof performance&&performance.now?performance:Date,ZN="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function eR(){return JN||(ZN(tR),JN=QN.now()+KN)}function tR(){JN=0}function nR(){this._call=this._time=this._next=null}function rR(e,t,n){var r=new nR;return r.restart(e,t,n),r}function iR(){JN=(YN=QN.now())+KN,HN=GN=0;try{!function(){eR(),++HN;for(var e,t=VN;t;)(e=JN-t._time)>=0&&t._call.call(null,e),t=t._next;--HN}()}finally{HN=0,function(){var e,t,n=VN,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:VN=t);WN=e,oR(r)}(),JN=0}}function aR(){var e=QN.now(),t=e-YN;t>1e3&&(KN-=t,YN=e)}function oR(e){HN||(GN&&(GN=clearTimeout(GN)),e-JN>24?(e<1/0&&(GN=setTimeout(iR,e-QN.now()-KN)),XN&&(XN=clearInterval(XN))):(XN||(YN=QN.now(),XN=setInterval(aR,1e3)),HN=1,ZN(iR)))}nR.prototype=rR.prototype={constructor:nR,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?eR():+n)+(null==t?0:+t),this._next||WN===this||(WN?WN._next=this:VN=this,WN=this),this._call=e,this._time=n,oR()},stop:function(){this._call&&(this._call=null,this._time=1/0,oR())}};const sR=4294967296;function lR(e){return e.x}function uR(e){return e.y}var cR=Math.PI*(3-Math.sqrt(5));function fR(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=rR(f),u=BN("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%sR)/sR}();function f(){d(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function d(r){var l,u,c=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*cR;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}const dR={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,f,d,h=t.length,p=0;p<a;++p)for(o=AN(t,TN,NN).visitAfter(s),e=0;e<h;++e)l=t[e],f=n[l.index],d=f*f,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,p=f+h;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,y=m*m+g*g;y<p*p&&(0===m&&(y+=(m=FN(r))*m),0===g&&(y+=(g=FN(r))*g),y=(p-(y=Math.sqrt(y)))/y*i,l.vx+=(m*=y)*(p=(h*=h)/(d+h)),l.vy+=(g*=y)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=jN(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:jN(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=jN(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=AN(e,lR,uR).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,a,u,c){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=c-a,p=f*f+d*d;if(h*h/l<p)return p<s&&(0===f&&(p+=(f=FN(n))*f),0===d&&(p+=(d=FN(n))*d),p<o&&(p=Math.sqrt(o*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=FN(n))*f),0===d&&(p+=(d=FN(n))*d),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:jN(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=RN,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=jN(30),c=1;function f(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,f,d,h,p,m,g=0;g<s;++g)u=(l=e[g]).source,d=(f=l.target).x+f.vx-u.x-u.vx||FN(o),h=f.y+f.vy-u.y-u.vy||FN(o),d*=p=((p=Math.sqrt(d*d+h*h))-n[g])/p*r*t[g],h*=p,f.vx-=d*(m=a[g]),f.vy-=h*m,u.vx+=d*(m=1-m),u.vy+=h*m}function d(){if(r){var o,l,u=r.length,c=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=PN(f,l.source)),"object"!=typeof l.target&&(l.target=PN(f,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)l=e[o],a[o]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),h(),n=new Array(c),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(c=+e,f):c},f.strength=function(e){return arguments.length?(l="function"==typeof e?e:jN(+e),h(),f):l},f.distance=function(e){return arguments.length?(u="function"==typeof e?e:jN(+e),p(),f):u},f},x:function(e){var t,n,r,i=jN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=jN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:jN(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:jN(+t),o(),a):e},a},y:function(e){var t,n,r,i=jN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=jN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:jN(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:jN(+t),o(),a):e},a}},hR="forces",pR=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],mR=["static","iterations"],gR=["x","y","vx","vy"];function yR(e){Fg.call(this,null,e)}function vR(e,t,n,r){var i,a,o,s,l=lc(t.forces);for(i=0,a=pR.length;i<a;++i)(o=pR[i])!==hR&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=hR+i,(o=n||t.modified(hR,i)?xR(l[i]):r&&bR(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(hR+i,null);return e.numForces=l.length,e}function bR(e,t){var n,r;for(n in e)if(cc(r=e[n])&&t.modified(_u(r)))return 1;return 0}function xR(e){var t,n;for(n in _c(dR,e.force)||Eu("Unrecognized force: "+e.force),t=dR[e.force](),e)cc(t[n])&&wR(t[n],e[n],e);return t}function wR(e,t,n){e(cc(t)?e=>t(e,n):t)}yR.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:gR}]},Ec(yR,Fg,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(pR),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&vR(i,e,0,t)):(this.value=i=function(e,t){const n=fR(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),vR(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(mR)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,s=0,l=t.length;s<l;++s)if(e=t[s],e.name===hR&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(gR)}});var _R=Object.freeze({__proto__:null,force:yR});function kR(e,t){return e.parent===t.parent?1:2}function OR(e,t){return e+t.x}function SR(e,t){return Math.max(e,t.y)}function ER(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function $R(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=DR)):void 0===t&&(t=AR);for(var n,r,i,a,o,s=new jR(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new jR(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(MR)}function AR(e){return e.children}function DR(e){return Array.isArray(e)?e[1]:null}function CR(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function MR(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function jR(e){this.data=e,this.depth=this.height=0,this.parent=null}function FR(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&RR(n,t)?++r:(n=zR(a=TR(a,t)),r=0);return n}function TR(e,t){var n,r;if(PR(t,e))return[t];for(n=0;n<e.length;++n)if(NR(t,e[n])&&PR(BR(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(NR(BR(e[n],e[r]),t)&&NR(BR(e[n],t),e[r])&&NR(BR(e[r],t),e[n])&&PR(IR(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function NR(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function RR(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function PR(e,t){for(var n=0;n<t.length;++n)if(!RR(e,t[n]))return!1;return!0}function zR(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return BR(e[0],e[1]);case 3:return IR(e[0],e[1],e[2])}}function BR(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(r+o+u/f*c)/2,r:(f+i+s)/2}}function IR(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=r-o,h=r-u,p=i-s,m=i-c,g=l-a,y=f-a,v=r*r+i*i-a*a,b=v-o*o-s*s+l*l,x=v-u*u-c*c+f*f,w=h*p-d*m,_=(p*x-m*b)/(2*w)-r,k=(m*g-p*y)/w,O=(h*b-d*x)/(2*w)-i,S=(d*y-h*g)/w,E=k*k+S*S-1,$=2*(a+_*k+O*S),A=_*_+O*O-a*a,D=-(E?($+Math.sqrt($*$-4*E*A))/(2*E):A/$);return{x:r+_+k*D,y:i+O+S*D,r:D}}function LR(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function qR(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function UR(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function VR(e){this._=e,this.next=null,this.previous=null}function WR(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,o,s,l,u,c,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;LR(n,t,r=e[2]),t=new VR(t),n=new VR(n),r=new VR(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){LR(t._,n._,r=e[s]),r=new VR(r),l=n.next,u=t.previous,c=n._.r,f=t._.r;do{if(c<=f){if(qR(l._,r._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(qR(u._,r._)){(t=u).next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}}while(l!==u.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=UR(t);(r=r.next)!==n;)(o=UR(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=FR(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function HR(e){return null==e?null:GR(e)}function GR(e){if("function"!=typeof e)throw new Error;return e}function XR(){return 0}function YR(e){return function(){return e}}function JR(e){return Math.sqrt(e.value)}function KR(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function QR(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=WR(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function ZR(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function eP(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function tP(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u}jR.prototype=$R.prototype={constructor:jR,count:function(){return this.eachAfter(ER)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop(),t=r.pop();for(;e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return $R(this).eachBefore(CR)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var nP={depth:-1},rP={};function iP(e){return e.id}function aP(e){return e.parentId}function oP(){var e=iP,t=aP;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),f=c.length,d=new Map;for(i=0;i<f;++i)r=c[i],s=c[i]=new jR(r),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,d.set(u,d.has(u)?rP:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<f;++i)if(l=(s=c[i]).parent){if(!(o=d.get(l)))throw new Error("missing: "+l);if(o===rP)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=nP,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(MR),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=GR(t),n):e},n.parentId=function(e){return arguments.length?(t=GR(e),n):t},n}function sP(e,t){return e.parent===t.parent?1:2}function lP(e){var t=e.children;return t?t[0]:e.t}function uP(e){var t=e.children;return t?t[t.length-1]:e.t}function cP(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function fP(e,t,n){return e.a.parent===t.parent?e.a:n}function dP(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function hP(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u}dP.prototype=Object.create(jR.prototype);var pP=(1+Math.sqrt(5))/2;function mP(e,t,n,r,i,a){for(var o,s,l,u,c,f,d,h,p,m,g,y=[],v=t.children,b=0,x=0,w=v.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=v[x++].value}while(!c&&x<w);for(f=d=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(d/g,g/f);x<w;++x){if(c+=s=v[x].value,s<f&&(f=s),s>d&&(d=s),g=c*c*m,(h=Math.max(d/g,g/f))>p){c-=s;break}p=h}y.push(o={value:c,dice:l<u,children:v.slice(b,x)}),o.dice?tP(o,n,r,i,_?r+=u*c/_:a):hP(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return y}var gP=function e(t){function n(e,n,r,i,a){mP(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(pP);var yP=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,f=-1,d=o.length,h=e.value;++f<d;){for(l=(s=o[f]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?tP(s,n,r,i,h?r+=(a-r)*s.value/h:a):hP(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=mP(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(pP);function vP(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function bP(e){Fg.call(this,null,e)}bP.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const xP=e=>e.values;function wP(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],o={},s={};let l,u,c,f=-1;for(;++f<i;)l=a(u=t[f])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=n(o[l],r);return s}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function _P(e){Fg.call(this,null,e)}Ec(bP,Fg,{transform(e,t){t.source||Eu("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&Zm(e.data)&&i.rem.push(e.data)})),this.value=a=$R({values:lc(e.keys).reduce(((e,t)=>(e.key(t),e)),wP()).entries(i.source)},xP),n&&a.each((e=>{e.children&&(e=ng(e.data),i.add.push(e),i.source.push(e))})),vP(a,eg,eg)),i.source.root=a,i}});const kP=(e,t)=>e.parent===t.parent?1:2;Ec(_P,Fg,{transform(e,t){t.source&&t.source.root||Eu(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(og(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?kP:ju);try{this.value=n(i)}catch(e){Eu(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const OP=["x","y","r","depth","children"];function SP(e){_P.call(this,e)}SP.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:OP.length,default:OP}]},Ec(SP,_P,{layout:function(){var e=null,t=1,n=1,r=XR;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(KR(e)).eachAfter(QR(r,.5)).eachBefore(ZR(1)):i.eachBefore(KR(JR)).eachAfter(QR(XR,1)).eachAfter(QR(r,i.r/Math.min(t,n))).eachBefore(ZR(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=HR(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:YR(+e),i):r},i},params:["radius","size","padding"],fields:OP});const EP=["x0","y0","x1","y1","depth","children"];function $P(e){_P.call(this,e)}function AP(e){Fg.call(this,null,e)}$P.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:EP.length,default:EP}]},Ec($P,_P,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&tP(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(eP),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:EP}),AP.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},Ec(AP,Fg,{transform(e,t){t.source||Eu("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?vP(oP().id(e.key).parentId(e.parentKey)(i.source),e.key,Fu):vP(oP()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const DP={tidy:function(){var e=sP,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new dP(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new dP(r[i],i)),n.parent=t;return(o.parent=new dP(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,f=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>f.depth&&(f=e)}));var d=u===c?1:e(u,c)/2,h=d-u.x,p=t/(c.x+d+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,f=s.m,d=l.m;s=uP(s),a=lP(a),s&&a;)l=lP(l),(o=uP(o)).a=t,(i=s.z+f-a.z-u+e(s._,a._))>0&&(cP(fP(s,t,r),t,i),u+=i,c+=i),f+=s.m,u+=a.m,d+=l.m,c+=o.m;s&&!uP(o)&&(o.t=s,o.m+=f-c),a&&!lP(l)&&(l.t=a,l.m+=u-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=kR,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(OR,0)/e.length}(n),t.y=function(e){return 1+e.reduce(SR,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},CP=["x","y","depth","children"];function MP(e){_P.call(this,e)}function jP(e){Fg.call(this,[],e)}MP.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:CP.length,default:CP}]},Ec(MP,_P,{layout(e){const t=e||"tidy";if(_c(DP,t))return DP[t]();Eu("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:CP}),jP.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},Ec(jP,Fg,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||Eu("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[eg(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[eg(t)]&&a[eg(n)]&&i.add.push(ng({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[eg(e)]=1)),n.forEach((e=>{(a[eg(e.source)]||a[eg(e.target)])&&i.mod.push(e)}))),i}});const FP={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}var f=u[t],d=r/2+f,h=t+1,p=n-1;for(;h<p;){var m=h+p>>>1;u[m]<d?h=m+1:p=m}d-u[h-1]<u[h]-d&&t+1<h&&--h;var g=u[h]-f,y=r-g;if(o-i>l-a){var v=r?(i*y+o*g)/r:o;e(t,h,g,i,a,v,l),e(h,n,y,v,a,o,l)}else{var b=r?(a*y+l*g)/r:l;e(t,h,g,i,a,o,b),e(h,n,y,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:tP,slice:hP,slicedice:function(e,t,n,r,i){(1&e.depth?hP:tP)(e,t,n,r,i)},squarify:gP,resquarify:yP},TP=["x0","y0","x1","y1","depth","children"];function NP(e){_P.call(this,e)}NP.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:TP.length,default:TP}]},Ec(NP,_P,{layout(){const e=function(){var e=gP,t=!1,n=1,r=1,i=[0],a=XR,o=XR,s=XR,l=XR,u=XR;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(eP),e}function f(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,f=t.x1-n,d=t.y1-n;f<r&&(r=f=(r+f)/2),d<c&&(c=d=(c+d)/2),t.x0=r,t.y0=c,t.x1=f,t.y1=d,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(d-=l(t)-n)<c&&(c=d=(c+d)/2),e(t,r,c,f,d))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=GR(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:YR(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:YR(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:YR(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:YR(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:YR(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{_c(FP,t)?e.tile(FP[t]):Eu("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:TP});var RP=Object.freeze({__proto__:null,nest:bP,pack:SP,partition:$P,stratify:AP,tree:MP,treelinks:jP,treemap:NP});function PP(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=px(i,a).getContext("2d");t.forEach((e=>zP(s,e,o)));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let f,d,h,p,m;for(d=0;d<a;++d)for(f=0;f<i;++f)m=4278190080&l[d*i+f],m&&(h=e(f),p=e(d),r||u.set(h,p),o&&268435456^m&&c.set(h,p));return[u,c]}function zP(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>zP(e,t.items,n)))})):f$[r].draw(e,{items:n?t.map(BP):t})}function BP(e){const t=ig(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const IP=31,LP=new Uint32Array(33),qP=new Uint32Array(33);qP[0]=0,LP[0]=~qP[0];for(let e=1;e<=32;++e)qP[e]=qP[e-1]<<1|1,LP[e]=~qP[e];function UP(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&IP)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&IP))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&IP)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&LP[o&IP]&qP[1+(s&IP)])return!0}else{if(n[l]&LP[o&IP])return!0;if(n[u]&qP[1+(s&IP)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,LP[o&IP]&qP[1+(s&IP)]);else for(r(l,LP[o&IP]),r(u,qP[1+(s&IP)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,qP[o&IP]|LP[1+(s&IP)]);else for(i(l,qP[o&IP]),i(u,LP[1+(s&IP)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function VP(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function WP(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),f=e(n-(a/=2)),d=e(n+a);return o.outOfBounds(u,f,c,d)||o.getRange(u,f,c,d)||s&&s.getRange(u,f,c,d)}const HP=[-1,-1,1,1],GP=[-1,1,-1,1];const XP=["right","center","left"],YP=["bottom","middle","top"];function JP(e,t,n,r,i,a,o,s,l,u,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const KP={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},QP={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=GE.width(e.datum,e.datum.text);let l,u,c,f,d,h,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,f=void 0===t[r].y2?c:t[r].y2,d=(l+u)/2,h=(c+f)/2,p=Math.abs(u-l+f-c),p>=m&&(m=p,e.x=d,e.y=h);return d=s/2,h=o/2,l=e.x-d,u=e.x+d,c=e.y-h,f=e.y+h,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&f<=a?e.baseline="top":0<=c&&a<f&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),f=e.invert(n);let d,h=r,p=a;if(!VP(c,f,l,u,i,a)&&!WP(e,c,f,u,l,h,o,s)&&!WP(e,c,f,u,l,u,o,null)){for(;p-h>=1;)d=(h+p)/2,WP(e,c,f,u,l,d,o,s)?p=d:h=d;if(h>r)return[c,f,h,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,f=GE.width(t.datum,t.datum.text);let d,h,p,m,g,y,v,b,x,w,_,k,O,S,E,$,A,D=n?c:0,C=!1,M=!1,j=0;for(let r=0;r<u;++r){for(d=s[r].x,p=s[r].y,h=void 0===s[r].x2?d:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,d>h&&(A=d,d=h,h=A),p>m&&(A=p,p=m,m=A),x=e(d),_=e(h),w=~~((x+_)/2),k=e(p),S=e(m),O=~~((k+S)/2),v=w;v>=x;--v)for(b=O;b>=k;--b)$=l(v,b,D,f,c),$&&([t.x,t.y,D,C]=$);for(v=w;v<=_;++v)for(b=O;b<=S;++b)$=l(v,b,D,f,c),$&&([t.x,t.y,D,C]=$);C||n||(E=Math.abs(h-d+m-p),g=(d+h)/2,y=(p+m)/2,E>=j&&!VP(g,y,f,c,i,a)&&!WP(e,g,y,c,f,c,o,null)&&(j=E,t.x=g,t.y=y,M=!0))}return!(!C&&!M)&&(g=f/2,y=c/2,o.setRange(e(t.x-g),e(t.y-y),e(t.x+g),e(t.y+y)),t.align="center",t.baseline="middle",!0)}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,f=t.datum.fontSize,d=GE.width(t.datum,t.datum.text),h=[];let p,m,g,y,v,b,x,w,_,k,O,S,E=n?f:0,$=!1,A=!1,D=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,y=void 0===u[r].y2?g:u[r].y2,h.push([e((p+m)/2),e((g+y)/2)]);h.length;)if([x,w]=h.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)v=x+HP[e],b=w+GP[e],l.outOfBounds(v,b,v,b)||h.push([v,b]);if(v=e.invert(x),b=e.invert(w),_=E,k=a,!VP(v,b,d,f,i,a)&&!WP(e,v,b,f,d,_,o,s)&&!WP(e,v,b,f,d,f,o,null)){for(;k-_>=1;)O=(_+k)/2,WP(e,v,b,f,d,O,o,s)?k=O:_=O;_>E&&(t.x=v,t.y=b,E=_,$=!0)}}$||n||(S=Math.abs(m-p+y-g),v=(p+m)/2,b=(g+y)/2,S>=D&&!VP(v,b,d,f,i,a)&&!WP(e,v,b,f,d,f,o,null)&&(D=S,t.x=v,t.y=b,A=!0))}return!(!$&&!A)&&(v=d/2,b=f/2,o.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",!0)}}};function ZP(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const f=Math.max(r.length,i.length),d=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,f),h=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=KP[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,f),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,y=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),v=UP(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let _;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<h.length&&!t;++e)t=5===h[e]||d[e]<0;p&&(o||g)&&(a=[e.map((e=>e.datum))].concat(a)),_=a.length?PP(v,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,o&&w)}const k=g?QP[c](v,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let f,d,h,p,m,g,y,v,b,x,w,_,k,O,S,E=0;for(let i=0;i<l;++i){if(f=(3&n[i])-1,d=(n[i]>>>2&3)-1,h=0===f&&0===d||r[i]<0,p=f&&d?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+f]+r[i]*f*p,w=u[4+d]+m*c*d/2+r[i]*d*p,v=w-c/2,b=w+c/2,_=e(g),O=e(v),S=e(b),!E){if(!JP(_,_,O,S,o,s,g,g,v,b,u,h))continue;E=GE.width(t.datum,t.datum.text)}if(x=g+m*E*f/2,g=x-E/2,y=x+E/2,_=e(g),k=e(y),JP(_,k,O,S,o,s,g,y,v,b,u,h))return t.x=f?f*m<0?y:g:x,t.y=d?d*m<0?b:v:w,t.align=XP[f*m+1],t.baseline=YP[d*m+1],o.setRange(_,O,k,S),!0}return!1}}(v,_,h,d);return w.forEach((e=>e.opacity=+k(e))),w}const ez=["x","y","opacity","align","baseline"],tz=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function nz(e){Fg.call(this,null,e)}nz.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:tz},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:ez.length,default:ez}]},Ec(nz,Fg,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e[n];return cc(r)&&t.modified(r.fields)}("sort")))return;e.size&&2===e.size.length||Eu("Size parameter should be specified as a [width, height] array.");const r=e.as||ez;return ZP(t.materialize(t.SOURCE).source,e.size,e.sort,lc(e.offset||1),lc(e.anchor||tz),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}});var rz=Object.freeze({__proto__:null,label:nz});function iz(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function az(e){Fg.call(this,null,e)}az.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},Ec(az,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=iz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(wu),a=i.length,o=e.as||[wu(e.x),wu(e.y)],s=[];r.forEach((t=>{_y(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[o[0]]=e[0],n[o[1]]=e[1],s.push(ng(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const oz={linear:my,log:gy,exp:yy,pow:vy,quad:by,poly:xy};function sz(e){Fg.call(this,null,e)}sz.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(oz)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},Ec(sz,Fg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=iz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(wu),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[wu(e.x),wu(e.y)],u=oz[a],c=[];let f=e.extent;_c(oz,a)||Eu("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push(ng({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const d=f||bc(n,e.x),h=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[l[0]]=e[0],t[l[1]]=e[1],c.push(ng(t))};"linear"===a?d.forEach((e=>h([e,r.predict(e)]))):Ey(r.predict,d,25,200).forEach(h)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});var lz=Object.freeze({__proto__:null,loess:az,regression:sz});const uz=Math.pow(2,-52),cz=new Uint32Array(512);class fz{static from(e,t=bz,n=xz){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new fz(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>l&&(l=n),r>u&&(u=r),this._ids[t]=t}const c=(o+l)/2,f=(s+u)/2;let d,h,p,m=1/0;for(let t=0;t<a;t++){const n=dz(c,f,e[2*t],e[2*t+1]);n<m&&(d=t,m=n)}const g=e[2*d],y=e[2*d+1];m=1/0;for(let t=0;t<a;t++){if(t===d)continue;const n=dz(g,y,e[2*t],e[2*t+1]);n<m&&n>0&&(h=t,m=n)}let v=e[2*h],b=e[2*h+1],x=1/0;for(let t=0;t<a;t++){if(t===d||t===h)continue;const n=gz(g,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];yz(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(pz(g,y,v,b,w,_)){const e=h,t=v,n=b;h=p,v=w,b=_,p=e,w=t,_=n}const k=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*f)*d,y:t+(o*f-l*c)*d}}(g,y,v,b,w,_);this._cx=k.x,this._cy=k.y;for(let t=0;t<a;t++)this._dists[t]=dz(e[2*t],e[2*t+1],k.x,k.y);yz(this._ids,this._dists,0,a-1),this._hullStart=d;let O=3;n[d]=t[p]=h,n[h]=t[d]=p,n[p]=t[h]=d,r[d]=0,r[h]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(v,b)]=h,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(d,h,p,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const l=this._ids[s],u=e[2*l],c=e[2*l+1];if(s>0&&Math.abs(u-a)<=uz&&Math.abs(c-o)<=uz)continue;if(a=u,o=c,l===d||l===h||l===p)continue;let f=0;for(let e=0,t=this._hashKey(u,c);e<this._hashSize&&(f=i[(t+e)%this._hashSize],-1===f||f===n[f]);e++);f=t[f];let m,g=f;for(;m=n[g],!pz(u,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,l,n[g],-1,-1,r[g]);r[l]=this._legalize(y+2),r[g]=y,O++;let v=n[g];for(;m=n[v],pz(u,c,e[2*v],e[2*v+1],e[2*m],e[2*m+1]);)y=this._addTriangle(v,l,m,r[l],-1,r[v]),r[l]=this._legalize(y+2),n[v]=v,O--,v=m;if(g===f)for(;m=t[g],pz(u,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)y=this._addTriangle(m,l,g,-1,r[g],r[m]),this._legalize(y+2),r[m]=y,n[g]=g,O--,g=m;this._hullStart=t[l]=g,n[g]=t[v]=l,n[l]=v,i[this._hashKey(u,c)]=l,i[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(O);for(let e=0,t=this._hullStart;e<O;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=cz[--i];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c];if(mz(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1])){t[e]=p,t[o]=f;const r=n[c];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,c);const s=l+(o+1)%3;i<cz.length&&(cz[i++]=s)}else{if(0===i)break;e=cz[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function dz(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function hz(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function pz(e,t,n,r,i,a){return(hz(i,a,e,t,n,r)||hz(e,t,n,r,i,a)||hz(n,r,i,a,e,t))<0}function mz(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,f=r-s,d=i-o,h=a-s,p=c*c+f*f,m=d*d+h*h;return l*(f*m-p*h)-u*(c*m-p*d)+(l*l+u*u)*(c*h-f*d)<0}function gz(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function yz(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;vz(e,n+r>>1,i),t[e[n]]>t[e[r]]&&vz(e,n,r),t[e[i]]>t[e[r]]&&vz(e,i,r),t[e[n]]>t[e[i]]&&vz(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;vz(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(yz(e,t,i,r),yz(e,t,n,a-1)):(yz(e,t,n,a-1),yz(e,t,i,r))}}function vz(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function bz(e){return e[0]}function xz(e){return e[1]}const wz=1e-6;class _z{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>wz||Math.abs(this._y1-i)>wz)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class kz{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class Oz{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,o=0,s=n.length;a<s;a+=3,o+=2){const s=2*n[a],l=2*n[a+1],u=2*n[a+2],c=e[s],f=e[s+1],d=e[l],h=e[l+1],p=e[u],m=e[u+1],g=d-c,y=h-f,v=p-c,b=m-f,x=g*g+y*y,w=v*v+b*b,_=2*(g*b-y*v);if(_)if(Math.abs(_)<1e-8)t=(c+p)/2,r=(f+m)/2;else{const e=1/_;t=c+(b*x-y*w)*e,r=f+(g*w-v*x)*e}else t=(c+p)/2-1e8*b,r=(f+m)/2+1e8*v;i[o]=t,i[o+1]=r}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],f=e[2*l+1];r.fill(0);for(let n=0;n<t.length;++n)l=t[n],a=u,o=c,s=f,u=4*l,c=e[2*l],f=e[2*l+1],r[a+2]=r[u]=s-f,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new _z:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),o=2*Math.floor(r/3),s=a[i],l=a[i+1],u=a[o],c=a[o+1];this._renderSegment(s,l,u,c,e)}let s,l=i[i.length-1];for(let t=0;t<i.length;++t){s=l,l=i[t];const n=2*Math.floor(r[l]/3),u=a[n],c=a[n+1],f=4*s,d=this._project(u,c,o[f+2],o[f+3]);d&&this._renderSegment(u,c,d[0],d[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new _z:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new _z:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new kz;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],f=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(r=u,i=c,u=t[d],c=t[d+1],a=f,f=this._regioncode(u,c),0===a&&0===f)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,d,h,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,f)))continue;[n,d,h,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,f,a)))continue;[h,p,n,d]=t,o=s,s=this._edgecode(n,d),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,d):l=[n,d]}o=s,s=this._edgecode(h,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(h,p):l=[h,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let t,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)t=i,i=this._edgecode(s[n],s[n+1]),t&&i&&(n=this._edge(e,t,i,s,n),r=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const Sz=2*Math.PI,Ez=Math.pow;function $z(e){return e[0]}function Az(e){return e[1]}function Dz(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Cz{static from(e,t=$z,n=Az,r){return new Cz("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new fz(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=Dz(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new fz(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new Oz(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=Ez(t-l[2*e],2)+Ez(n-l[2*e+1],2);const f=r[e];let d=f;do{let r=s[d];const f=Ez(t-l[2*r],2)+Ez(n-l[2*r+1],2);if(f<c&&(c=f,u=r),d=d%3==2?d-2:d+1,s[d]!==e)break;if(d=o[d],-1===d){if(d=i[(a[e]+1)%i.length],d!==r&&Ez(t-l[2*d],2)+Ez(n-l[2*d+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=null==e?e=new _z:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const o=2*i[t],s=2*i[a];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new _z:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,Sz)}return n&&n.value()}renderHull(e){const t=null==e?e=new _z:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new kz;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new _z:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new kz;return this.renderTriangle(e,t),t.value()}}function Mz(e){Fg.call(this,null,e)}Mz.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const jz=[-1e5,-1e5,1e5,1e5];function Fz(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}Ec(Mz,Fg,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:jz;const a=this.value=Cz.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?Fz(t):null}return t.reflow(e.modified()).modifies(n)}});var Tz=Object.freeze({__proto__:null,voronoi:Mz}),Nz=Math.PI/180,Rz=2048;function Pz(){var e,t,n,r,i,a,o,s=[256,256],l=qz,u=[],c=Math.random,f={};function d(e,t,n){for(var r,i,a,o=t.x,u=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=l(s),h=c()<.5?1:-1,p=-h;(r=d(p+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=u+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!Bz(t,e,s[0]))&&(!n||Lz(t,n))){for(var m,g=t.sprite,y=t.width>>5,v=s[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,_=t.y1-t.y0,k=(t.y+t.y0)*v+(b>>5),O=0;O<_;O++){m=0;for(var S=0;S<=y;S++)e[k+S]|=m<<w|(S<y?(m=g[O*y+S])>>>x:0);k+=v}return t.sprite=null,!0}return!1}return f.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=Rz/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(px()),f=function(e){var t=[],n=-1;for(;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,p=u.length,m=-1,g=[],y=u.map((s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((e,t)=>t.size-e.size));++m<p;){var v=y[m];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,zz(l,v,y,m),v.hasText&&d(f,v,h)&&(g.push(v),h?Iz(h,v):h=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return g},f.words=function(e){return arguments.length?(u=e,f):u},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=Uz(e),f):t},f.fontStyle=function(e){return arguments.length?(r=Uz(e),f):r},f.fontWeight=function(e){return arguments.length?(i=Uz(e),f):i},f.rotate=function(e){return arguments.length?(a=Uz(e),f):a},f.text=function(t){return arguments.length?(e=Uz(t),f):e},f.spiral=function(e){return arguments.length?(l=Vz[e]||e,f):l},f.fontSize=function(e){return arguments.length?(n=Uz(e),f):n},f.padding=function(e){return arguments.length?(o=Uz(e),f):o},f.random=function(e){return arguments.length?(c=e,f):c},f}function zz(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,Rz/a);var o,s,l,u,c,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*Nz),g=Math.cos(t.rotate*Nz),y=o*g,v=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,l=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(l>h&&(h=l),f+o>=2048&&(f=0,d+=h,h=0),d+l>=Rz)break;i.translate((f+(o>>1))/a,(d+(l>>1))/a),t.rotate&&i.rotate(t.rotate*Nz),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,2048/a,Rz/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,O=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=s*c+(u>>5),E=w[2048*(d+c)+(f+u)<<2]?1<<31-u%32:0;_[S]|=E,k|=E}k?O=c:(t.y0++,l--,c--,d++)}t.y1=t.y0+O,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function Bz(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*n+(o>>5),f=0;f<u;f++){r=0;for(var d=0;d<=a;d++)if((r<<l|(d<a?(r=i[f*a+d])>>>s:0))&t[c+d])return!0;c+=n}return!1}function Iz(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function Lz(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function qz(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function Uz(e){return"function"==typeof e?e:function(){return e}}var Vz={archimedean:qz,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const Wz=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Hz=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Gz(e){Fg.call(this,Pz(),e)}Gz.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:Wz}]},Ec(Gz,Fg,{transform(e,t){!e.size||e.size[0]&&e.size[1]||Eu("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||Hz.some((function(n){const r=e[n];return cc(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||Wz;let o,s=e.fontSize||14;if(cc(s)?o=e.fontSizeRange:s=gc(s),o){const e=s,t=Fk("sqrt")().domain(bc(r,e)).range(o);s=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(qg).layout(),u=i.size(),c=u[0]>>1,f=u[1]>>1,d=l.length;for(let e,t,n=0;n<d;++n)e=l[n],t=e.datum,t[a[0]]=e.x+c,t[a[1]]=e.y+f,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});var Xz=Object.freeze({__proto__:null,wordcloud:Gz});const Yz=e=>new Uint8Array(e),Jz=e=>new Uint16Array(e),Kz=e=>new Uint32Array(e);function Qz(e,t,n){const r=(t<257?Yz:t<65537?Jz:Kz)(e);return n&&r.set(n),r}function Zz(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function eB(){let e=Kz(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=Kz(s);let u,c,f,d=Array(s);for(f=0;f<s;++f)d[f]=r(i[f]),l[f]=f;if(d=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(d,l),o)u=t,c=e,t=Array(o+s),e=Kz(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,f=0;for(u=0;c<r&&f<o;++u)t[c]<i[f]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[f],l[u]=a[f++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;f<o;++f,++u)s[u]=i[f],l[u]=a[f]+e}(a,u,c,o,d,l,s,t,e);else{if(a>0)for(f=0;f<s;++f)l[f]+=a;t=d,e=l}return n=o+s,{index:l,value:d}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[Lf(r,e[0],0,i),If(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function tB(e){Fg.call(this,function(){let e=8,t=[],n=Kz(0),r=Qz(0,e),i=Qz(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=Qz(t,e,r),i=Qz(t,e))}}}(),e),this._indices=null,this._dims=null}function nB(e){Fg.call(this,null,e)}tB.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},Ec(tB,Fg,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=eB()),a.push(Zz(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let m,g,y,v,b,x,w,_,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,_=v.length;w<_;++w)x[v[w]._index]=1;for(w=0;w<h;++w)k=r[w],(!o[w]||e.modified("fields",w)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(a[y]=g=eB(),p[y]=m=g.insert(k,t.source,0)),o[w]=Zz(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?f.push(w):x[w]&&l[w]!==c&&d.push(w));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,f=a.length;let d,h,p,m=i.size();i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),v=i.all();for(d=0;d<f;++d)h=s[d].fname,p=l[h]||(l[h]=o[h].insert(s[d],r,m)),a[d].onAdd(p,g);for(;m<c;++m)y[m]=v,g[m]!==v&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in r)r[h].remove(d,l);return this.reindex(t,d,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],m=e.one;let g,y,v;if(f<h)for(g=f,y=Math.min(h,d);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(f>h)for(g=h,y=Math.min(f,p);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;if(d>p)for(g=Math.max(f,p),y=d;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(d<p)for(g=Math.max(h,d),y=p;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],f=o[1],d=e.one;let h,p,m;if(l<c)for(h=l,p=Math.min(c,u);h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(l>c)for(h=c,p=Math.min(l,f);h<p;++h)m=a[h],i[m]^=d,r.push(m);if(u>f)for(h=Math.max(l,f),p=u;h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(u<f)for(h=Math.max(c,u),p=f;h<p;++h)m=a[h],i[m]^=d,r.push(m);e.range=t.slice()}}),nB.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},Ec(nB,Fg,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,(e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null})),a.filter(a.REM,(e=>{const t=s[e]&n;return t&&!(t^t^l[e]&n)?o[e]:null}))):(a.filter(a.ADD,u),a.filter(a.REM,(e=>(s[e]&n)===i?o[e]:null))),a.filter(a.SOURCE,(e=>u(e._index)))}});var rB=Object.freeze({__proto__:null,crossfilter:tB,resolvefilter:nB});const iB="RawCode",aB="Literal",oB="Property",sB="Identifier",lB="ArrayExpression",uB="BinaryExpression",cB="CallExpression",fB="ConditionalExpression",dB="LogicalExpression",hB="MemberExpression",pB="ObjectExpression",mB="UnaryExpression";function gB(e){this.type=e}var yB,vB,bB,xB,wB;gB.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case lB:return e.elements;case uB:case dB:return[e.left,e.right];case cB:return[e.callee].concat(e.arguments);case fB:return[e.test,e.consequent,e.alternate];case hB:return[e.object,e.property];case pB:return e.properties;case oB:return[e.key,e.value];case mB:return[e.argument];case sB:case aB:case iB:default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};(yB={})[1]="Boolean",yB[2]="<end>",yB[3]="Identifier",yB[4]="Keyword",yB[5]="Null",yB[6]="Numeric",yB[7]="Punctuator",yB[8]="String",yB[9]="RegularExpression";var _B="Identifier",kB="Unexpected token %0",OB="Invalid regular expression",SB="Invalid regular expression: missing /",EB="Octal literals are not allowed in strict mode.",$B="ILLEGAL",AB="Disabled.",DB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),CB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function MB(e,t){if(!e)throw new Error("ASSERT: "+t)}function jB(e){return e>=48&&e<=57}function FB(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function TB(e){return"01234567".indexOf(e)>=0}function NB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function RB(e){return 10===e||13===e||8232===e||8233===e}function PB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&DB.test(String.fromCharCode(e))}function zB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&CB.test(String.fromCharCode(e))}const BB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function IB(){for(;bB<xB;){const e=vB.charCodeAt(bB);if(!NB(e)&&!RB(e))break;++bB}}function LB(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)bB<xB&&FB(vB[bB])?(r=vB[bB++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):rI({},kB,$B);return String.fromCharCode(i)}function qB(){var e,t,n,r;for(t=0,"}"===(e=vB[bB])&&rI({},kB,$B);bB<xB&&FB(e=vB[bB++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&rI({},kB,$B),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function UB(){var e,t;for(e=vB.charCodeAt(bB++),t=String.fromCharCode(e),92===e&&(117!==vB.charCodeAt(bB)&&rI({},kB,$B),++bB,(e=LB("u"))&&"\\"!==e&&PB(e.charCodeAt(0))||rI({},kB,$B),t=e);bB<xB&&zB(e=vB.charCodeAt(bB));)++bB,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==vB.charCodeAt(bB)&&rI({},kB,$B),++bB,(e=LB("u"))&&"\\"!==e&&zB(e.charCodeAt(0))||rI({},kB,$B),t+=e);return t}function VB(){var e,t;return e=bB,{type:1===(t=92===vB.charCodeAt(bB)?UB():function(){var e,t;for(e=bB++;bB<xB;){if(92===(t=vB.charCodeAt(bB)))return bB=e,UB();if(!zB(t))break;++bB}return vB.slice(e,bB)}()).length?3:BB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:bB}}function WB(){var e,t,n,r,i=bB,a=vB.charCodeAt(bB),o=vB[bB];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++bB,{type:7,value:String.fromCharCode(a),start:i,end:bB};default:if(61===(e=vB.charCodeAt(bB+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return bB+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:bB};case 33:case 61:return bB+=2,61===vB.charCodeAt(bB)&&++bB,{type:7,value:vB.slice(i,bB),start:i,end:bB}}}return">>>="===(r=vB.substr(bB,4))?{type:7,value:r,start:i,end:bB+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:bB+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:bB+=2}:("//"===t&&rI({},kB,$B),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++bB}:void rI({},kB,$B))}function HB(){var e,t,n;if(MB(jB((n=vB[bB]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=bB,e="","."!==n){if(e=vB[bB++],n=vB[bB],"0"===e){if("x"===n||"X"===n)return++bB,function(e){let t="";for(;bB<xB&&FB(vB[bB]);)t+=vB[bB++];return 0===t.length&&rI({},kB,$B),PB(vB.charCodeAt(bB))&&rI({},kB,$B),{type:6,value:parseInt("0x"+t,16),start:e,end:bB}}(t);if(TB(n))return function(e){let t="0"+vB[bB++];for(;bB<xB&&TB(vB[bB]);)t+=vB[bB++];return(PB(vB.charCodeAt(bB))||jB(vB.charCodeAt(bB)))&&rI({},kB,$B),{type:6,value:parseInt(t,8),octal:!0,start:e,end:bB}}(t);n&&jB(n.charCodeAt(0))&&rI({},kB,$B)}for(;jB(vB.charCodeAt(bB));)e+=vB[bB++];n=vB[bB]}if("."===n){for(e+=vB[bB++];jB(vB.charCodeAt(bB));)e+=vB[bB++];n=vB[bB]}if("e"===n||"E"===n)if(e+=vB[bB++],"+"!==(n=vB[bB])&&"-"!==n||(e+=vB[bB++]),jB(vB.charCodeAt(bB)))for(;jB(vB.charCodeAt(bB));)e+=vB[bB++];else rI({},kB,$B);return PB(vB.charCodeAt(bB))&&rI({},kB,$B),{type:6,value:parseFloat(e),start:t,end:bB}}function GB(){var e,t,n,r;return wB=null,IB(),e=bB,t=function(){var e,t,n,r;for(MB("/"===(e=vB[bB]),"Regular expression literal must start with a slash"),t=vB[bB++],n=!1,r=!1;bB<xB;)if(t+=e=vB[bB++],"\\"===e)RB((e=vB[bB++]).charCodeAt(0))&&rI({},SB),t+=e;else if(RB(e.charCodeAt(0)))rI({},SB);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||rI({},SB),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";bB<xB&&zB((e=vB[bB]).charCodeAt(0));)++bB,"\\"===e&&bB<xB?rI({},kB,$B):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&rI({},OB,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";rI({},OB)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){rI({},OB)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:bB}}function XB(){if(IB(),bB>=xB)return{type:2,start:bB,end:bB};const e=vB.charCodeAt(bB);return PB(e)?VB():40===e||41===e||59===e?WB():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(MB("'"===(e=vB[bB])||'"'===e,"String literal must starts with a quote"),t=bB,++bB;bB<xB;){if((n=vB[bB++])===e){e="";break}if("\\"===n)if((n=vB[bB++])&&RB(n.charCodeAt(0)))"\r"===n&&"\n"===vB[bB]&&++bB;else switch(n){case"u":case"x":"{"===vB[bB]?(++bB,i+=qB()):i+=LB(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:TB(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),bB<xB&&TB(vB[bB])&&(a=!0,r=8*r+"01234567".indexOf(vB[bB++]),"0123".indexOf(n)>=0&&bB<xB&&TB(vB[bB])&&(r=8*r+"01234567".indexOf(vB[bB++]))),i+=String.fromCharCode(r)):i+=n}else{if(RB(n.charCodeAt(0)))break;i+=n}}return""!==e&&rI({},kB,$B),{type:8,value:i,octal:a,start:t,end:bB}}():46===e?jB(vB.charCodeAt(bB+1))?HB():WB():jB(e)?HB():WB()}function YB(){const e=wB;return bB=e.end,wB=XB(),bB=e.end,e}function JB(){const e=bB;wB=XB(),bB=e}function KB(e,t,n){const r=new gB("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function QB(e,t){const n=new gB("CallExpression");return n.callee=e,n.arguments=t,n}function ZB(e){const t=new gB(_B);return t.name=e,t}function eI(e){const t=new gB("Literal");return t.value=e.value,t.raw=vB.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function tI(e,t,n){const r=new gB("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function nI(e,t,n){const r=new gB("Property");return r.key=t,r.value=n,r.kind=e,r}function rI(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(MB(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=bB,n.description=i,n}function iI(e){2===e.type&&rI(e,"Unexpected end of input"),6===e.type&&rI(e,"Unexpected number"),8===e.type&&rI(e,"Unexpected string"),3===e.type&&rI(e,"Unexpected identifier"),4===e.type&&rI(e,"Unexpected reserved word"),rI(e,kB,e.value)}function aI(e){const t=YB();7===t.type&&t.value===e||iI(t)}function oI(e){return 7===wB.type&&wB.value===e}function sI(e){return 4===wB.type&&wB.value===e}function lI(){const e=[];for(bB=wB.start,aI("[");!oI("]");)oI(",")?(YB(),e.push(null)):(e.push(xI()),oI("]")||aI(","));return YB(),function(e){const t=new gB("ArrayExpression");return t.elements=e,t}(e)}function uI(){bB=wB.start;const e=YB();return 8===e.type||6===e.type?(e.octal&&rI(e,EB),eI(e)):ZB(e.value)}function cI(){var e,t,n;return bB=wB.start,3===(e=wB).type?(n=uI(),aI(":"),nI("init",n,xI())):2!==e.type&&7!==e.type?(t=uI(),aI(":"),nI("init",t,xI())):void iI(e)}function fI(){var e,t,n=[],r={},i=String;for(bB=wB.start,aI("{");!oI("}");)t="$"+((e=cI()).key.type===_B?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?rI({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),oI("}")||aI(",");return aI("}"),function(e){const t=new gB("ObjectExpression");return t.properties=e,t}(n)}const dI={if:1};function hI(){var e,t,n;if(oI("("))return function(){aI("(");const e=wI();return aI(")"),e}();if(oI("["))return lI();if(oI("{"))return fI();if(e=wB.type,bB=wB.start,3===e||dI[wB.value])n=ZB(YB().value);else if(8===e||6===e)wB.octal&&rI(wB,EB),n=eI(YB());else{if(4===e)throw new Error(AB);1===e?((t=YB()).value="true"===t.value,n=eI(t)):5===e?((t=YB()).value=null,n=eI(t)):oI("/")||oI("/=")?(n=eI(GB()),JB()):iI(YB())}return n}function pI(){const e=[];if(aI("("),!oI(")"))for(;bB<xB&&(e.push(xI()),!oI(")"));)aI(",");return aI(")"),e}function mI(){return aI("."),function(){bB=wB.start;const e=YB();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||iI(e),ZB(e.value)}()}function gI(){aI("[");const e=wI();return aI("]"),e}function yI(){const e=function(){var e;for(e=hI();;)if(oI("."))e=tI(".",e,mI());else if(oI("("))e=QB(e,pI());else{if(!oI("["))break;e=tI("[",e,gI())}return e}();if(7===wB.type&&(oI("++")||oI("--")))throw new Error(AB);return e}function vI(){var e,t;if(7!==wB.type&&4!==wB.type)t=yI();else{if(oI("++")||oI("--"))throw new Error(AB);if(oI("+")||oI("-")||oI("~")||oI("!"))e=YB(),t=vI(),t=function(e,t){const n=new gB("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(sI("delete")||sI("void")||sI("typeof"))throw new Error(AB);t=yI()}}return t}function bI(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function xI(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=wB,l=vI(),0===(i=bI(r=wB)))return l;for(r.prec=i,YB(),t=[e,wB],a=[l,r,o=vI()];(i=bI(wB))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=KB(s,l,o),a.push(n);(r=YB()).prec=i,a.push(r),t.push(wB),n=vI(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=KB(a[u-1].value,a[u-2],n),u-=2;return n}(),oI("?")&&(YB(),t=xI(),aI(":"),e=function(e,t,n){const r=new gB("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,xI())),e}function wI(){const e=xI();if(oI(","))throw new Error(AB);return e}function _I(e){bB=0,xB=(vB=e).length,wB=null,JB();const t=wI();if(2!==wB.type)throw new Error("Unexpect token after expression.");return t}var kI={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function OI(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&Eu("Missing arguments to clamp function."),t.length>3&&Eu("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),replace:t("replace",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&Eu("Missing arguments to if function."),t.length>3&&Eu("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}const SI="intersect",EI="union";var $I="index:unit";function AI(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=Au.getter||Au(r.field),Dc(n=r.getter(e))&&(n=Vu(n)),Dc(a[s])&&(a[s]=Vu(a[s])),Dc(a[s][0])&&(a[s]=a[s].map(Vu)),"E"===r.type){if(Pu(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!$c(n,a[s]))return!1}else if("R-RE"===r.type){if(!$c(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!$c(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!$c(n,a[s],!1,!0))return!1;return!0}var DI={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=Vu(t[0]),r=Vu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Vu(t[0]),r=Vu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function CI(e,t,n,r){t[0].type!==aB&&Eu("First argument to selection functions must be a string literal.");const i=t[0].value,a="unit",o="@unit",s=":"+i;(t.length>=2&&Uu(t).value)!==SI||_c(r,o)||(r["@unit"]=n.getData(i).indataRef(n,a)),_c(r,s)||(r[s]=n.getData(i).tuplesRef())}function MI(e){const t=this.context.data[e];return t?t.values.value:[]}const jI=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},FI=jI("format"),TI=jI("timeFormat"),NI=jI("utcFormat"),RI=jI("timeParse"),PI=jI("utcParse"),zI=new Date(2e3,0,1);function BI(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(zI.setYear(2e3),zI.setMonth(e),zI.setDate(t),TI.call(this,zI,n)):""}function II(e,t,n,r){t[0].type!==aB&&Eu("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!_c(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function LI(e,t,n,r){if(t[0].type===aB)qI(n,r,t[0].value);else for(e in n.scales)qI(n,r,e)}function qI(e,t,n){const r="%"+n;if(!_c(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function UI(e,t){let n;return cc(e)?e:Fc(e)?(n=t.scales[e])&&n.value:void 0}function VI(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=LI,n._range=LI,n._scale=LI;const r=t=>"_["+(t.type===aB?Lc("%"+t.value):Lc("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}function WI(e,t){return function(n,r,i){if(n){const t=UI(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const HI=WI("area",(function(e){return CM=new qf,dM(e,MM),2*CM})),GI=WI("bounds",(function(e){var t,n,r,i,a,o,s;if(wM=xM=-(vM=bM=1/0),$M=[],dM(e,aj),n=$M.length){for($M.sort(pj),t=1,a=[r=$M[0]];t<n;++t)mj(r,(i=$M[t])[0])||mj(r,i[1])?(hj(r[0],i[1])>hj(r[0],r[1])&&(r[1]=i[1]),hj(i[0],r[1])>hj(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=hj(r[1],i[0]))>o&&(o=s,vM=i[0],xM=r[1])}return $M=AM=null,vM===1/0||bM===1/0?[[NaN,NaN],[NaN,NaN]]:[[vM,bM],[xM,wM]]})),XI=WI("centroid",(function(e){UM=VM=WM=HM=GM=XM=YM=JM=0,KM=new qf,QM=new qf,ZM=new qf,dM(e,gj);var t=+KM,n=+QM,r=+ZM,i=KC(t,n,r);return i<zC&&(t=XM,n=YM,r=JM,VM<PC&&(t=WM,n=HM,r=GM),(i=KC(t,n,r))<zC)?[NaN,NaN]:[GC(n,t)*UC,aM(r/i)*UC]}));function YI(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function JI(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function KI(e){const t=qx(e);return.2126*JI(t.r)+.7152*JI(t.g)+.0722*JI(t.b)}function QI(e,t){return e===t||e!=e&&t!=t||(Pu(e)?!(!Pu(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!QI(e[n],t[n]))return!1;return!0}(e,t):!(!zu(e)||!zu(t))&&ZI(e,t))}function ZI(e,t){for(const n in e)if(!QI(e[n],t[n]))return!1;return!0}function eL(e){return t=>ZI(e,t)}const tL=e=>e.data;function nL(e,t){const n=MI.call(t,e);return n.root&&n.root.lookup||{}}const rL=()=>"undefined"!=typeof window&&window||null;const iL={random:()=>qg(),cumulativeNormal:Jg,cumulativeLogNormal:ny,cumulativeUniform:ly,densityNormal:Yg,densityLogNormal:ty,densityUniform:sy,quantileNormal:Kg,quantileLogNormal:ry,quantileUniform:uy,sampleNormal:Xg,sampleLogNormal:ey,sampleUniform:oy,isArray:Pu,isBoolean:Ac,isDate:Dc,isDefined:e=>void 0!==e,isNumber:Mc,isObject:zu,isRegExp:jc,isString:Fc,isTuple:Zm,isValid:e=>null!=e&&e==e,toBoolean:qc,toDate:Vc,toNumber:Vu,toString:Wc,flush:Sc,lerp:Nc,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),vc(...e)},pad:Bc,peek:Uu,span:Ic,inrange:$c,truncate:Gc,rgb:qx,lab:ow,hcl:hw,hsl:Yx,luminance:KI,contrast:function(e,t){const n=KI(e),r=KI(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:rd,format:FI,utcFormat:NI,utcParse:PI,utcOffset:Lh,utcSequence:Vh,timeFormat:TI,timeParse:RI,timeOffset:Ih,timeSequence:Uh,timeUnitSpecifier:dh,monthFormat:function(e){return BI.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return BI.call(this,e,1,"%b")},dayFormat:function(e){return BI.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return BI.call(this,0,2+e,"%a")},quarter:oc,utcquarter:sc,week:gh,utcweek:_h,dayofyear:mh,utcdayofyear:wh,warn:function(){return YI(this.context.dataflow,"warn",arguments)},info:function(){return YI(this.context.dataflow,"info",arguments)},debug:function(){return YI(this.context.dataflow,"debug",arguments)},extent:bc,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new gS).set(r[0],r[1],i[0],i[1]);return LA(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=lc(e.marktype),r=lc(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:uc,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=rL();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=rL();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return ik(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(Fu).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?BO(n,t=t||AO(e)):e}},panLinear:Ku,panLog:Qu,panPow:Zu,panSymlog:ec,zoomLinear:nc,zoomLog:rc,zoomPow:ic,zoomSymlog:ac,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,f,d=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!d||d.stamp<u)&&(s.changes=d=o.changeset(),d.stamp=u,o.runAfter((()=>{s.modified=!0,o.pulse(l,d).run()}),!0,1)),n&&(c=!0===n?Fu:Pu(n)||Zm(n)?n:eL(n),d.remove(c)),t&&d.insert(t),r&&(c=eL(r),l.value.some(c)?d.remove(c):d.insert(r)),i)for(f in a)d.modify(i,f,a[f]);return 1}},aL=["view","item","group","xy","x","y"],oL="this.",sL={},lL={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(Lc("$"+e),"]"),functions:function(e){const t=OI(e);aL.forEach((e=>t[e]="event.vega."+e));for(const e in iL)t[e]=oL+e;return vc(t,VI(e,iL,sL)),t},constants:kI,visitors:sL},uL=function(e){const t=(e=e||{}).allowed?Hc(e.allowed):{},n=e.forbidden?Hc(e.forbidden):{},r=e.constants||kI,i=(e.functions||OI)(f),a=e.globalvar,o=e.fieldvar,s=cc(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function f(e){if(Fc(e))return e;const t=d[e.type];return null==t&&Eu("Unsupported type: "+e.type),t(e)}const d={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:_c(n,i)?Eu("Illegal identifier: "+i):_c(r,i)?r[i]:_c(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(c+=1);const r=f(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&Eu("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=_c(i,t)&&i[t];return r||Eu("Unrecognized function: "+t),cc(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{c+=1;const t=f(e.key);return c-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return h.functions=i,h.constants=r,h}(lL);function cL(e,t,n){return 1===arguments.length?iL[e]:(iL[e]=t,n&&(sL[e]=n),uL&&(uL.functions[e]=oL+e),this)}function fL(e,t){const n={};let r;try{r=_I(e=Fc(e)?e:Lc(e)+"")}catch(t){Eu("Expression parse error: "+e)}r.visit((e=>{if(e.type!==cB)return;const r=e.callee.name,i=lL.visitors[r];i&&i(r,e.arguments,t,n)}));const i=uL(r);return i.globals.forEach((e=>{const r="$"+e;!_c(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:vc({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}cL("bandwidth",(function(e,t){const n=UI(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),LI),cL("copy",(function(e,t){const n=UI(e,(t||this).context);return n?n.copy():void 0}),LI),cL("domain",(function(e,t){const n=UI(e,(t||this).context);return n?n.domain():[]}),LI),cL("range",(function(e,t){const n=UI(e,(t||this).context);return n&&n.range?n.range():[]}),LI),cL("invert",(function(e,t,n){const r=UI(e,(n||this).context);return r?Pu(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),LI),cL("scale",(function(e,t,n){const r=UI(e,(n||this).context);return r?r(t):void 0}),LI),cL("gradient",(function(e,t,n,r,i){e=UI(e,(i||this).context);const a=kO(t,n);let o=e.domain(),s=o[0],l=Uu(o),u=Cu;return l-s?u=Hk(e,s,l):e=(e.interpolator?Fk("sequential")().interpolator(e.interpolator()):Fk("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==Uu(o)&&o.push(l)),o.forEach((t=>a.stop(u(t),e(t)))),a}),LI),cL("geoArea",HI,LI),cL("geoBounds",GI,LI),cL("geoCentroid",XI,LI),cL("geoShape",(function(e,t,n){const r=UI(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),LI),cL("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==aB&&Eu("First argument to indata must be a string literal."),t[1].type!==aB&&Eu("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;_c(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),cL("data",MI,II),cL("treePath",(function(e,t,n){const r=nL(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(tL):void 0}),II),cL("treeAncestors",(function(e,t){const n=nL(e,this)[t];return n?n.ancestors().map(tL):void 0}),II),cL("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[$I]&&l[$I].value:void 0,f=n===SI,d=u.length,h=0;h<d;++h)if(r=u[h],c&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=AI(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(f^(s=AI(t,r)))return s;return d&&f}),CI),cL("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,f,d,h,p=this.context.data[e],m=p?p.values.value:[],g={},y={},v={},b=m.length,x=0;x<b;++x){for(o=(r=m[x]).unit,i=r.fields,a=r.values,d=0,h=i.length;d<h;++d)s=i[d],u=(l=g[s.field]||(g[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),f=DI[c+"_union"],l[o]=f(u,lc(a[d]));n&&(u=y[o]||(y[o]=[])).push(lc(a).reduce(((e,t,n)=>(e[i[n].field]=t,e)),{}))}return t=t||EI,Object.keys(g).forEach((e=>{g[e]=Object.keys(g[e]).map((t=>g[e][t])).reduce(((n,r)=>void 0===n?r:DI[v[e]+"_"+t](n,r)))})),m=Object.keys(y),n&&m.length&&(g.vlMulti=t===EI?{or:m.reduce(((e,t)=>(e.push(...y[t]),e)),[])}:{and:m.map((e=>({or:y[e]})))}),g}),CI);const dL=Hc(["rule"]),hL=Hc(["group","image","rect"]);function pL(e){return(e+"").toLowerCase()}function mL(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var gL={operator:(e,t)=>mL(e,["_"],t.code),parameter:(e,t)=>mL(e,["datum","_"],t.code),event:(e,t)=>mL(e,["event"],t.code),handler:(e,t)=>mL(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+Lc(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return dL[t]||(e.x2&&(e.x?(hL[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(hL[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",mL(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(Lc).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function yL(e,t,n){if(!e||!zu(e))return e;for(let r,i=0,a=vL.length;i<a;++i)if(r=vL[i],_c(e,r.key))return r.parse(e,t,n);return e}var vL=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||Eu("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Tc(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=xu(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Au(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=xu(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=lc(e.$compare).map((e=>e&&e.$tupleid?eg:e));return t.fn[n]||(t.fn[n]=fc(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return eg}}];const bL={skip:!0};function xL(e,t,n,r){return new wL(e,t,n,r)}function wL(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||gL,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function _L(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function kL(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}wL.prototype=_L.prototype={fork(){const e=new _L(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(e){return"collect"===pL(e)}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[pL(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;!function(e){return"operator"===pL(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||Eu("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Pu(i)?i.map((e=>yL(e,n,t))):yL(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&Eu("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=zu(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||Eu("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],bL)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(Fu).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const OL="default";function SL(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function EL(e,t){var n=e._runtime.data;return _c(n,t)||Eu("Unrecognized data set: "+t),n[t]}function $L(e,t){sg(t)||Eu("Second argument to changes must be a changeset.");const n=EL(this,e);return n.modified=!0,this.pulse(n.input,t)}function AL(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function DL(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function CL(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function ML(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=CL(e),(r=E$(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;Fc(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:gc(e),item:gc(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}const jL="view",FL={trap:!1};function TL(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||zu(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function NL(e){return e.item}function RL(e){return e.item.mark.source}function PL(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function zL(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}const BL="vega-bind",IL="vega-bind-name";function LL(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=yc(r.debounce,i.update))),function(e,t,n,r){const i=zL("div",{class:BL}),a="radio"===n.input?i:i.appendChild(zL("label"));a.appendChild(zL("span",{class:IL},n.name||n.signal)),t.appendChild(i);let o=qL;switch(n.input){case"checkbox":o=UL;break;case"select":o=VL;break;case"radio":o=WL;break;case"range":o=HL}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0),i}function qL(e,t,n,r){const i=zL("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function UL(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=zL("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function VL(e,t,n,r){const i=zL("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};GL(e,r)&&(n.selected=!0),i.appendChild(zL("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(GL(n.options[t],e))return void(i.selectedIndex=t)}}function WL(e,t,n,r){const i=zL("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,o)=>{const s={type:"radio",name:n.signal,value:t};GL(t,r)&&(s.checked=!0);const l=zL("input",s);l.addEventListener("change",(()=>e.update(t)));const u=zL("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)GL(n[e].value,t)&&(n[e].checked=!0)}}function HL(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Xf(a,i,100),s=zL("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=zL("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function GL(e,t){return e===t||e+""==t+""}function XL(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,AL(e),DL(e),CL(e),i,a).background(e.background())}function YL(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function JL(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const KL=e=>+e||0;function QL(e){return zu(e)?{top:KL(e.top),bottom:KL(e.bottom),left:KL(e.left),right:KL(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(KL(e))}async function ZL(e,t,n,r){const i=IA(t),a=i&&i.headless;return a||Eu("Unrecognized renderer type: "+t),await e.runAsync(),XL(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var eq="width",tq="height",nq="padding",rq={skip:!0};function iq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===nq?r.left+r.right:0)}function aq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===nq?r.top+r.bottom:0)}function oq(e,t){return t.modified&&Pu(t.input.value)&&e.indexOf("_:vega:_")}function sq(e,t){return!("parent"===e||t instanceof Tg.proxy)}function lq(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":Pu(e)?uq(e):zu(e)&&!Dc(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(Pu(n)?uq(n):cq(n))})).join("\n")):e+"";var t}(r))}function uq(e){return"["+e.map(cq).join(", ")+"]"}function cq(e){return Pu(e)?"[…]":zu(e)&&!Dc(e)?"{…}":e}function fq(e,t){const n=this;if(t=t||{},Mg.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=vc({},e.locale,t.locale);n.locale(Wm(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||zA.Canvas,n._scenegraph=new b$;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||lq,n._redraw=!0,n._handler=(new W$).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=vc({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{Pu(e[t])&&(e[t]=Hc(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return xL(e,Tg,iL,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:vc({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=iq(n,n._width),n._viewHeight=aq(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=iq(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=aq(e,t.size),a()}),{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:OL,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?Fc(r)?r:r.user:OL,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return Fc(n)||(r=n.item,n=n.user),SL(e,n&&n!==OL?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function dq(e,t){return _c(e._signals,t)?e._signals[t]:Eu("Unrecognized signal name: "+Lc(t))}function hq(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function pq(e,t,n,r){let i=hq(n,r);return i||(i=YL(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function mq(e,t,n){const r=hq(t,n);return r&&t._targets.remove(r),e}Ec(fq,Mg,{async evaluate(e,t,n){if(await Mg.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(e){var t=CL(e),n=AL(e),r=DL(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach((t=>{try{t(n,r)}catch(t){e.error(t)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}return n&&Jm(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&kL(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=dq(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",QL(e)):QL(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(IA(e)||Eu("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Mg.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(dq(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(eq,n,rq),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(tq,r,rq),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=YL(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return pq(this,e,dq(this,e),t)},removeSignalListener(e,t){return mq(this,dq(this,e),t)},addDataListener(e,t){return pq(this,e,EL(this,e).values,t)},removeDataListener(e,t){return mq(this,EL(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=SL(this,null);this._globalCursor=!!e,t&&SL(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new nR,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?eR():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new gg(n),o=function(n,r){i.runAsync(null,(()=>{e===jL&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(ML(i,n,r))}))};if("timer"===e)TL(i,"timer",t)&&i.timer(o,t);else if(e===jL)TL(i,"view",t)&&i.addEventListener(t,o,FL);else if("window"===e?TL(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&TL(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",NL),RL,PL(e)),this.on(this.events("view","mouseout",NL),RL,PL(t)),this},data:function(e,t){return arguments.length<2?EL(this,e).values.value:$L.call(this,e,lg().remove(Fu).insert(t))},change:$L,insert:function(e,t){return $L.call(this,e,lg().insert(t))},remove:function(e,t){return $L.call(this,e,lg().remove(t))},scale:function(e){var t=this._runtime.scales;return _c(t,e)||Eu("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=IA(r);e=n._el=e?JL(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),kL(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||W$,s=e?a.renderer:a.headless;return n._renderer=s?XL(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),YL(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,CL(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=JL(n,t):e.appendChild(zL("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=JL(n,e.param.element))})),n._bind.forEach((e=>{LL(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==zA.Canvas&&e!==zA.SVG&&e!==zA.PNG&&Eu("Unrecognized image type: "+e);const n=await ZL(this,e,t);return e===zA.SVG?function(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await ZL(this,zA.Canvas,e,t)).canvas()},toSVG:async function(e){return(await ZL(this,zA.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:oq,signals:sq,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const gq="[",yq="]",vq=/[[\]{}]/,bq={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let xq,wq;function _q(e,t,n){return xq=t||"view",wq=n||bq,Oq(e.trim()).map(Sq)}function kq(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function Oq(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=kq(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function Sq(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=kq(e,r,yq,gq,yq),r===t)throw"Empty between selector: "+e;if(n=Oq(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(Sq);const i=Sq(e.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(e):function(e){const t={source:xq},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(u+1,l-1))}catch(t){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;"@"===e[0]&&(o=++u);r=kq(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r);if(u=kq(e,u,gq),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=kq(e,u,yq),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&e[++u]!==gq)throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||vq.test(n[l-1]))throw"Invalid event selector: "+e;l>1?(t.type=n[1],o?t.markname=n[0].slice(1):!function(e){return wq[e]}(n[0])?t.source=n[0]:t.marktype=n[0]):t.type=n[0];"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1));null!=i&&(t.filter=i);a[0]&&(t.throttle=a[0]);a[1]&&(t.debounce=a[1]);return t}(e)}function Eq(e){return zu(e)?e:{type:e||"pad"}}const $q=e=>+e||0;function Aq(e){return zu(e)?e.signal?e:{top:$q(e.top),bottom:$q(e.bottom),left:$q(e.left),right:$q(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))($q(e))}const Dq=e=>zu(e)&&!Pu(e)?vc({},e):{value:e};function Cq(e,t,n,r){if(null!=n){return zu(n)&&!Pu(n)||Pu(n)&&n.length&&zu(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1}return 0}function Mq(e,t,n){for(const n in t)Cq(e,n,t[n]);for(const t in n)Cq(e,t,n[t],"update")}function jq(e,t,n){for(const r in t)n&&_c(n,r)||(e[r]=vc(e[r]||{},t[r]));return e}function Fq(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const Tq="mark",Nq="frame",Rq="scope",Pq="legend-label",zq="title-text",Bq="title-subtitle";function Iq(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const Lq=e=>Fc(e)?Lc(e):e.signal?"(".concat(e.signal,")"):Wq(e);function qq(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:Lc(e)));for(;t.length&&null==Uu(t);)t.pop();return t.unshift(Lq(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?Uq("hcl",e.h,e.c,e.l):e.h||e.s?Uq("hsl",e.h,e.s,e.l):e.l||e.a?Uq("lab",e.l,e.a,e.b):e.r||e.g||e.b?Uq("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?Wq(e.field):void 0!==e.value?Lc(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=Lq(e.scale);null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+Vq(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0"));return t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(Vq(e.exponent),")")),null!=e.mult&&(t+="*".concat(Vq(e.mult))),null!=e.offset&&(t+="+".concat(Vq(e.offset))),e.round&&(t="round(".concat(t,")")),t}const Uq=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(qq).join(","),")+'')");function Vq(e){return zu(e)?"("+qq(e)+")":e}function Wq(e){return Hq(zu(e)?e:{datum:e})}function Hq(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):Eu("Invalid field reference: "+Lc(e));return e.signal||(r=Fc(r)?$u(r).map(Lc).join("]["):Hq(r)),t+"["+r+"]"}function Gq(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||Fq(l,e)||Iq(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===Nq?i.group:n===Tq?vc({},i.mark,i[t]):null,c)u=Fq(l,e)||("fill"===l||"stroke"===l)&&(Fq("fill",e)||Fq("stroke",e)),u||Iq(a,l,c[l]);for(l in lc(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)Fq(t,e)||Iq(a,t,n[t])})),e=vc({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=vc(o,e.enter),s&&(e.update=vc(s,e.update)),e}(e,t,n,r,i.config);for(const n in e)o[n]=Xq(e[n],t,a,i);return a}function Xq(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=Yq((o=e[t],Pu(o)?function(e){let t="";return e.forEach((e=>{const n=qq(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n})),":"===Uu(t)&&(t+="null"),t}(o):qq(o)),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function Yq(e,t,n,r){const i=fL(e,t);return i.$fields.forEach((e=>r[e]=1)),vc(n,i.$params),i.$expr}const Jq=["value","update","init","react","bind"];function Kq(e,t){Eu(e+' for "outer" push: '+Lc(t))}function Qq(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||Kq("No prior signal definition",n),Jq.forEach((t=>{void 0!==e[t]&&Kq("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Zq(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function eU(e,t,n,r){return new Zq(e,t,n,r)}function tU(e,t){return eU("operator",e,t)}function nU(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function rU(e,t){return t?{$field:e,$name:t}:{$field:e}}const iU=rU("key");function aU(e,t){return{$compare:e,$order:t}}function oU(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const sU="scope",lU="view";function uU(e){return e&&e.signal}function cU(e){if(uU(e))return!0;if(zu(e))for(const t in e)if(cU(e[t]))return!0;return!1}function fU(e,t){return null!=e?e:t}function dU(e){return e&&e.signal||e}const hU="timer";function pU(e,t){return(e.merge?mU:e.stream?gU:e.type?yU:Eu("Invalid stream specification: "+Lc(e)))(e,t)}function mU(e,t){const n=vU({merge:e.merge.map((e=>pU(e,t)))},e,t);return t.addStream(n).id}function gU(e,t){const n=vU({stream:pU(e.stream,t)},e,t);return t.addStream(n).id}function yU(e,t){let n;e.type===hU?(n=t.event(hU,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===sU?lU:e||lU}(e.source),e.type);const r=vU({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function vU(e,t,n){let r=t.between;return r&&(2!==r.length&&Eu('Stream "between" parameter must have 2 entries: '+Lc(t)),e.between=[pU(r[0],n),pU(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===sU&&r.push("inScope(event.item)"),r.length&&(e.filter=fL("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const bU={code:"_.$value",ast:{type:"Identifier",value:"value"}};function xU(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||Eu("Signal update missing events specification."),Fc(a)&&(a=_q(a,t.isSubscope()?sU:lU)),a=lc(a).filter((e=>e.signal||e.scale?(s.push(e),0):1)),s.length>1&&(s=[wU(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&Eu("Signal encode and update are mutually exclusive."),o="encode(item(),"+Lc(r)+")"),i.update=Fc(o)?fL(o,t):null!=o.expr?fL(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:bU,$params:{$value:t.signalRef(o.signal)}}:Eu("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((e=>t.addUpdate(vc(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):pU(e,t)}}(e,t),i))))}function wU(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const _U=e=>(t,n,r)=>eU(e,n,t||void 0,r),kU=_U("aggregate"),OU=_U("axisticks"),SU=_U("bound"),EU=_U("collect"),$U=_U("compare"),AU=_U("datajoin"),DU=_U("encode"),CU=_U("expression"),MU=_U("facet"),jU=_U("field"),FU=_U("key"),TU=_U("legendentries"),NU=_U("load"),RU=_U("mark"),PU=_U("multiextent"),zU=_U("multivalues"),BU=_U("overlap"),IU=_U("params"),LU=_U("prefacet"),qU=_U("projection"),UU=_U("proxy"),VU=_U("relay"),WU=_U("render"),HU=_U("scale"),GU=_U("sieve"),XU=_U("sortitems"),YU=_U("viewlayout"),JU=_U("values");let KU=0;const QU={min:"min",max:"max",count:"sum"};function ZU(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=rV(e.domain,e,t),null!=e.range&&(n.range=fV(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=eV(e.type||e),null!=e.gamma&&(t.interpolateGamma=eV(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return zu(e)?{interval:eV(e.interval),step:eV(e.step)}:eV(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||Pu(e)?tV(e,t):t.objectProperty(e)}(e.bins,t)),e)_c(n,r)||"name"===r||(n[r]=eV(e[r],t))}function eV(e,t){return zu(e)?e.signal?t.signalRef(e.signal):Eu("Unsupported object: "+Lc(e)):e}function tV(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>eV(e,t)))}function nV(e){Eu("Can not find data set: "+Lc(e))}function rV(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Pu(e)?iV:e.fields?oV:aV)(e,t,n);null==t.domainMin&&null==t.domainMax||Eu("No scale domain defined for domainMin/domainMax to override.")}function iV(e,t,n){return e.map((e=>eV(e,n)))}function aV(e,t,n){const r=n.getData(e.data);return r||nV(e.data),Pk(t.type)?r.valuesRef(n,e.field,lV(e.sort,!1)):Lk(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function oV(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=Fc(t)?{data:r,field:t}:Pu(t)||t.signal?function(e,t){const n="_:vega:_"+KU++,r=EU({});if(Pu(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+Lc(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,GU({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(Pk(t.type)?sV:Lk(t.type)?uV:cV)(e,n,i)}function sV(e,t,n){const r=lV(e.sort,!0);let i,a;const o=n.map((e=>{const n=t.getData(e.data);return n||nV(e.data),n.countsRef(t,e.field,r)})),s={groupby:iU,pulse:o};r&&(i=r.op||"count",a=r.field?oU(i,r.field):"count",s.ops=[QU[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(kU(s));const l=t.add(EU({pulse:nU(i)}));return a=t.add(JU({field:iU,sort:t.sortRef(r),pulse:nU(l)})),nU(a)}function lV(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!QU[e.op]&&Eu("Multiple domain scales can not be sorted using "+e.op):Eu("No field provided for sort aggregate op: "+e.op):zu(e)?e.field="key":e={field:"key"}),e}function uV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||nV(e.data),n.domainRef(t,e.field)}));return nU(t.add(zU({values:r})))}function cV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||nV(e.data),n.extentRef(t,e.field)}));return nU(t.add(PU({extents:r})))}function fV(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(Fc(i)){if(r&&_c(r,i))return fV(e=vc({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=Pk(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:Eu("Unrecognized scale range value: "+Lc(i))}else{if(i.scheme)return n.scheme=Pu(i.scheme)?tV(i.scheme,t):eV(i.scheme,t),i.extent&&(n.schemeExtent=tV(i.extent,t)),void(i.count&&(n.schemeCount=eV(i.count,t)));if(i.step)return void(n.rangeStep=eV(i.step,t));if(Pk(e.type)&&!Pu(i))return rV(i,e,t);Pu(i)||Eu("Unsupported range type: "+Lc(i))}return i.map((e=>(Pu(e)?tV:eV)(e,t)))}function dV(e,t,n){return Pu(e)?e.map((e=>dV(e,t,n))):zu(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:Eu("Unsupported parameter object: "+Lc(e)):e}const hV="top",pV="left",mV="right",gV="bottom",yV="center",vV="index",bV="label",xV="perc",wV="value",_V="guide-label",kV="guide-title",OV="group-title",SV="group-subtitle",EV="symbol",$V="gradient",AV="discrete",DV="size",CV=[DV,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],MV={name:1,style:1,interactive:1},jV={value:0},FV={value:1},TV="group",NV="rect",RV="rule",PV="text";function zV(e){return e.type=TV,e.interactive=e.interactive||!1,e}function BV(e,t){const n=(n,r)=>fU(e[n],fU(t[n],r));return n.isVertical=n=>"vertical"===fU(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>fU(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>fU(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>fU(e.columns,fU(t.columns,+n.isVertical(!0))),n}function IV(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function LV(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const qV=LV(Lc(pV),Lc(mV),Lc(yV));function UV(e,t){return t?e?zu(e)?Object.assign({},e,{offset:UV(e.offset,t)}):{value:e,offset:t}:t:e}function VV(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=jq(e.encode,t,MV)):e.interactive=!1,e}function WV(e,t,n,r){const i=BV(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,f,d;a?(u=[0,1],c=[0,0],f=o,d=s):(u=[0,0],c=[1,0],f=s,d=o);const h={enter:l={opacity:jV,x:jV,y:jV,width:Dq(f),height:Dq(d)},update:vc({},l,{opacity:FV,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:jV}};return Mq(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),VV({type:NV,role:"legend-gradient",encode:h},r)}function HV(e,t,n,r,i){const a=BV(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,f,d,h="";o?(u="y",f="y2",c="x",d="width",h="1-"):(u="x",f="x2",c="y",d="height");const p={opacity:jV,fill:{scale:t,field:wV}};p[u]={signal:h+"datum."+xV,mult:l},p[c]=jV,p[f]={signal:h+"datum.perc2",mult:l},p[d]=Dq(s);const m={enter:p,update:vc({},p,{opacity:FV}),exit:{opacity:jV}};return Mq(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),VV({type:NV,role:"legend-band",key:wV,from:i,encode:m},r)}const GV="datum.".concat(xV,'<=0?"').concat(pV,'":datum.').concat(xV,'>=1?"').concat(mV,'":"').concat(yV,'"'),XV="datum.".concat(xV,'<=0?"').concat(gV,'":datum.').concat(xV,'>=1?"').concat(hV,'":"').concat("middle",'"');function YV(e,t,n,r){const i=BV(e,t),a=i.isVertical(),o=Dq(i.gradientThickness()),s=i.gradientLength();let l,u,c,f,d=i("labelOverlap"),h="";const p={enter:l={opacity:jV},update:u={opacity:FV,text:{field:bV}},exit:{opacity:jV}};return Mq(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:fU(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:XV},c="y",f="x",h="1-"):(l.align=u.align={signal:GV},l.baseline={value:"top"},c="x",f="y"),l[c]=u[c]={signal:h+"datum."+xV,mult:s},l[f]=u[f]=o,o.offset=fU(e.labelOffset,t.gradientLabelOffset)||0,d=d?{separation:i("labelSeparation"),method:d,order:"datum.index"}:void 0,VV({type:PV,role:Pq,style:_V,key:wV,from:r,encode:p,overlap:d},n)}function JV(e,t,n,r,i){const a=BV(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d="(".concat(i,") ? datum.").concat("offset"," : datum.").concat(DV),h=u?Dq(u):{field:DV},p="datum.".concat(vV),m="max(1, ".concat(i,")");let g,y,v,b,x;h.mult=.5,g={enter:y={opacity:jV,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:FV,x:y.x,y:y.y},exit:{opacity:jV}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Mq(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),CV.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:wV})}));const k=VV({type:"symbol",role:"legend-symbol",key:wV,from:f,clip:!!u||void 0,encode:g},n.symbols),O=Dq(c);O.offset=a("labelOffset"),g={enter:y={opacity:jV,x:{signal:d,offset:O},y:h},update:v={opacity:FV,text:{field:bV},x:y.x,y:y.y},exit:{opacity:jV}},Mq(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const S=VV({type:PV,role:Pq,style:_V,key:wV,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:jV,height:u?Dq(u):jV,opacity:jV},exit:{opacity:jV},update:v={opacity:FV,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(m,")"),v.column.signal="".concat(p," % ").concat(m),x={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),zV({role:Rq,from:r={facet:{data:r,name:"value",groupby:vV}},encode:jq(g,o,MV),marks:[k,S],name:l,interactive:s,sort:x})}const KV='item.orient === "left"',QV='item.orient === "right"',ZV="(".concat(KV," || ").concat(QV,")"),eW="datum.vgrad && ".concat(ZV),tW=LV('"top"','"bottom"','"middle"'),nW=LV('"right"','"left"','"center"'),rW="datum.vgrad && ".concat(QV," ? (").concat(nW,") : (").concat(ZV," && !(datum.vgrad && ").concat(KV,')) ? "left" : ').concat(qV),iW="item._anchor || (".concat(ZV,' ? "middle" : "start")'),aW="".concat(eW," ? (").concat(KV," ? -90 : 90) : 0"),oW="".concat(ZV," ? (datum.vgrad ? (").concat(QV,' ? "bottom" : "top") : ').concat(tW,') : "top"');function sW(e,t){let n;return zu(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+lW(e.path)+")":e.sphere&&(n="geoShape("+lW(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function lW(e){return zu(e)&&e.signal?e.signal:Lc(e)}function uW(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===TV?Rq:t||Tq:t}function cW(e){return{marktype:e.type,name:e.name||void 0,role:e.role||uW(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function fW(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function dW(e,t){const n=Ng(e.type);n||Eu("Unrecognized transform type: "+Lc(e.type));const r=eU(n.type.toLowerCase(),null,hW(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function hW(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=pW(i,t,n)}return r}function pW(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){Fc(t.from)||Eu('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(Pu(r)||Eu("Expected an array of sub-parameters. Instead: "+Lc(r)),r.map((t=>gW(e,t,n)))):gW(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!uU(i)?i.map((t=>mW(e,t,n))):mW(e,i,n):void(e.required&&Eu("Missing required "+Lc(t.type)+" parameter: "+Lc(e.name)))}function mW(e,t,n){const r=e.type;if(uU(t))return xW(r)?Eu("Expression references can not be signals."):wW(r)?n.fieldRef(t):_W(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||wW(r);return i&&yW(t)?n.exprRef(t.expr,t.as):i&&vW(t)?rU(t.field,t.as):xW(r)?fL(t,n):bW(r)?nU(n.getData(t).values):wW(r)?rU(t):_W(r)?n.compareRef(t):t}}function gW(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||Eu("Unsupported parameter: "+Lc(t));const a=vc(hW(i,t,n),i.key);return nU(n.add(IU(a)))}const yW=e=>e&&e.expr,vW=e=>e&&e.field,bW=e=>"data"===e,xW=e=>"expr"===e,wW=e=>"field"===e,_W=e=>"compare"===e;function kW(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:nU(t.getData(e.data).output)}function OW(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function SW(e){return Fc(e)?e:null}function EW(e,t,n){const r=oU(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function $W(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return zu(e)?("descending"===e.order?"-":"+")+oU(e.op,e.field):""}(a);let u,c,f=SW(i);if(null!=f&&(e=t.scope,f+=l?"|"+l:"",u=s[f]),!u){const n=a?{field:iU,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:nU(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(eU(r,void 0,n)),o&&(t.index[i]=c),u=nU(c),null!=f&&(s[f]=u)}return u}function AW(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(tU()),u=fL("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function DW(e,t){const n=uW(e),r=e.type===TV,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,f,d,h=e.layout||n===Rq||n===Nq;const p=n===Tq||h||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||Eu("Only group marks can be faceted."),null!=r.field?o=s=kW(r,n):(e.data?s=nU(n.getData(e.data).aggregate):(a=dW(vc({type:"aggregate",groupby:lc(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=kW(r,n),o=s=nU(n.add(a))),i=n.keyRef(r.groupby,!0))):o=nU(n.add(EU(null,[{}]))),o||(o=kW(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(AU({key:m.key||(e.key?rU(e.key):void 0),pulse:m.pulse,clean:!r}));const g=nU(s);s=l=t.add(EU({pulse:g})),s=t.add(RU({markdef:cW(e),interactive:fW(e.interactive,t),clip:sW(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:nU(s)}));const y=nU(s);s=u=t.add(DU(Gq(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=dW(e,t),r=n.metadata;(r.generates||r.changes)&&Eu("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=nU(s),t.add(s=n)})),e.sort&&(s=t.add(XU({sort:t.compareRef(e.sort),pulse:nU(s)})));const v=nU(s);(i||h)&&(h=t.add(YU({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),f=nU(h));const b=t.add(SU({mark:y,pulse:f||v}));d=nU(b),r&&(p&&(o=t.operators,o.pop(),h&&o.pop()),t.pushState(v,f||d,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=kW(r,t);let o;r.name||Eu("Facet must have a name: "+Lc(r)),r.data||Eu("Facet must reference a data set: "+Lc(r)),r.field?o=t.add(LU({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(MU({key:t.keyRef(r.groupby),group:nU(t.proxy(n.parent)),pulse:a})):Eu("Facet must specify groupby or field: "+Lc(r));const s=t.fork(),l=s.add(EU()),u=s.add(GU({pulse:nU(l)}));s.addData(i,new OW(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(LU({pulse:n.pulse})),i=t.fork();i.add(GU()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(h&&o.push(h),o.push(b))),a&&(d=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:uU(a)?n.signalRef(a.signal):a,method:uU(r)?n.signalRef(r.signal):r,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(i){const e=i.tolerance;o.boundTolerance=uU(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return nU(n.add(BU(o)))}(a,d,t));const x=t.add(WU({pulse:d})),w=t.add(GU({pulse:nU(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new OW(t,l,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&Eu("Marks only support modify triggers."),AW(e,t,c)})))}function CW(e,t){const n=t.config.legend,r=e.encode||{},i=BV(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,f,d,h=0;CV.forEach((t=>e[t]?(u[t]=e[t],h=h||e[t]):0)),h||Eu("Missing valid scale for legend.");const p=function(e,t){let n=e.type||EV;e.type||1!==function(e){return CV.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=Rk(t)?$V:zk(t)?AV:EV);return n!==$V?n:zk(t)?AV:$V}(e,t.scaleType(h)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=nU(t.add(EU(null,[m]))),y=nU(t.add(TU(f={type:p,scale:t.scaleRef(h),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===$V?(d=[WV(e,h,n,r.gradient),YV(e,n,r.labels,y)],f.count=f.count||t.signalRef("max(2,2*floor((".concat(dU(i.gradientLength()),")/100))"))):p===AV?d=[HV(e,h,n,r.gradient,y),YV(e,n,r.labels,y)]:(c=function(e,t){const n=BV(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),d=[JV(e,n,r,y,dU(c.columns))],f.size=function(e,t,n){const r=dU(jW("size",e,n)),i=dU(jW("strokeWidth",e,n)),a=dU(function(e,t,n){return IV("fontSize",e)||function(e,t,n){const r=t.config.style[n];return r&&r[e]}("fontSize",t,n)}(n[1].encode,t,_V));return fL("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,d[0].marks)),d=[zV({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:c,interactive:s})],m.title&&d.push(function(e,t,n,r){const i=BV(e,t),a={enter:{opacity:jV},update:{opacity:FV,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:jV}};return Mq(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:iW},angle:{signal:aW},align:{signal:rW},baseline:{signal:oW},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),VV({type:PV,role:"legend-title",style:kV,from:r,encode:a},n)}(e,n,r.title,g)),DW(zV({role:"legend",from:g,encode:jq(MW(i,e,n),a,MV),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}function MW(e,t,n){const r={enter:{},update:{}};return Mq(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function jW(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):IV(e,n[0].encode)}OW.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=nU(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new OW(e,a,i,r,o)},OW.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=SW(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&EW(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:nU(r.output)},n&&n.field&&EW(e,l,n),s=e.add(kU(l)),o=e.add(EU({pulse:nU(s)})),o={agg:s,ref:nU(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return nU(this.values)},extentRef(e,t){return $W(e,this,"extent","extent",t,!1)},domainRef(e,t){return $W(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return $W(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return $W(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return $W(e,this,"indata","tupleindex",t,!0,!0)}};const FW='item.orient==="'.concat(pV,'"?-90:item.orient==="').concat(mV,'"?90:0');function TW(e,t){const n=BV(e=Fc(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=nU(t.add(EU(null,[{}])));return l.push(function(e,t,n,r){const i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Mq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),VV({type:PV,role:zq,style:OV,from:r,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||vc({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Mq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),VV({type:PV,role:Bq,style:SV,from:r,encode:o},n)}(e,n,r.subtitle,u)),DW(zV({role:"title",from:u,encode:NW(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function NW(e,t){const n={enter:{},update:{}};return Mq(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:qV},angle:{signal:FW},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),jq(n,t,MV)}function RW(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(dW(e,t))})),e.on&&e.on.forEach((n=>{AW(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,f=!1;e.values?cU(e.values)||cU(e.format)?(r.push(zW(t,e)),r.push(u=PW())):r.push(u=PW({$ingest:e.values,$format:e.format})):e.url?cU(e.url)||cU(e.format)?(r.push(zW(t,e)),r.push(u=PW())):r.push(u=PW({$request:e.url,$format:e.format})):e.source&&(u=i=lc(e.source).map((e=>nU(t.getData(e).output))),r.push(null));for(a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=PW()),r.push(s),l.generates&&(f=!0),l.modifies&&!f&&(c=!0),l.source?u=s:l.changes&&(u=null);i&&(o=i.length-1,r[0]=VU({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,PW()));u||r.push(PW());return r.push(GU({})),r}(e,t,n))}function PW(e){const t=EU({},e);return t.metadata={source:!0},t}function zW(e,t){return NU({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const BW=e=>e===gV||e===hV,IW=(e,t,n)=>uU(e)?HW(e.signal,t,n):e===pV||e===hV?t:n,LW=(e,t,n)=>uU(e)?VW(e.signal,t,n):BW(e)?t:n,qW=(e,t,n)=>uU(e)?WW(e.signal,t,n):BW(e)?n:t,UW=(e,t,n)=>uU(e)?GW(e.signal,t,n):e===hV?{value:t}:{value:n},VW=(e,t,n)=>YW("".concat(e," === '").concat(hV,"' || ").concat(e," === '").concat(gV,"'"),t,n),WW=(e,t,n)=>YW("".concat(e," !== '").concat(hV,"' && ").concat(e," !== '").concat(gV,"'"),t,n),HW=(e,t,n)=>KW("".concat(e," === '").concat(pV,"' || ").concat(e," === '").concat(hV,"'"),t,n),GW=(e,t,n)=>KW("".concat(e," === '").concat(hV,"'"),t,n),XW=(e,t,n)=>KW("".concat(e," === '").concat(mV,"'"),t,n),YW=(e,t,n)=>(t=null!=t?Dq(t):t,n=null!=n?Dq(n):n,JW(t)&&JW(n)?(t=t?t.signal||Lc(t.value):null,n=n?n.signal||Lc(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[vc({test:e},t)].concat(n||[])),JW=e=>null==e||1===Object.keys(e).length,KW=(e,t,n)=>({signal:"".concat(e," ? (").concat(ZW(t),") : (").concat(ZW(n),")")}),QW=(e,t,n,r,i)=>({signal:(null!=r?"".concat(e," === '").concat(pV,"' ? (").concat(ZW(r),") : "):"")+(null!=n?"".concat(e," === '").concat(gV,"' ? (").concat(ZW(n),") : "):"")+(null!=i?"".concat(e," === '").concat(mV,"' ? (").concat(ZW(i),") : "):"")+(null!=t?"".concat(e," === '").concat(hV,"' ? (").concat(ZW(t),") : "):"")+"(null)"}),ZW=e=>uU(e)?e.signal:null==e?null:Lc(e),eH=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function tH(e,t,n,r){let i;if(t&&_c(t,e))return t[e];if(_c(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function nH(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function rH(e,t){return{scale:e.scale,range:t}}function iH(e,t,n,r,i){const a=BV(e,t),o=e.orient,s=e.gridScale,l=IW(o,1,-1),u=function(e,t){if(1===t);else if(zu(e)){let n=e=vc({},e);for(;null!=n.mult;){if(!zu(n.mult))return n.mult=uU(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=vc({},n.mult)}n.mult=t}else e=uU(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,f,d;const h={enter:c={opacity:jV},update:d={opacity:FV},exit:f={opacity:jV}};Mq(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:wV,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=LW(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:vc(m,{mult:l,offset:u});return c.x=d.x=LW(o,p,g),c.y=d.y=qW(o,p,g),c.x2=d.x2=qW(o,y),c.y2=d.y2=LW(o,y),f.x=LW(o,p),f.y=qW(o,p),VV({type:RV,role:"axis-grid",key:wV,from:r,encode:h},n)}function aH(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function oH(e,t,n,r,i,a){const o=BV(e,t),s=e.orient,l=e.scale,u=IW(s,-1,1),c=dU(o("labelFlush")),f=dU(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p,m=0===c||!!c;const g=Dq(i);g.mult=u,g.offset=Dq(o("labelPadding")||0),g.offset.mult=u;const y={scale:l,field:wV,band:.5,offset:UV(a.offset,o("labelOffset"))},v=LW(s,m?aH(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>uU(e)?XW(e.signal,t,n):e===mV?{value:t}:{value:n})(s,"left","right")),b=LW(s,UW(s,"bottom","top"),m?aH(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=aH(l,c,"-(".concat(f,")"),f,0);m=m&&f;const w={opacity:jV,x:LW(s,y,g),y:qW(s,y,g)},_={enter:w,update:p={opacity:FV,text:{field:bV},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:jV,x:w.x,y:w.y}};Mq(_,{dx:!d&&m?LW(s,x):null,dy:!h&&m?qW(s,x):null}),Mq(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const k=o("labelBound");let O=o("labelOverlap");return O=O||k?{separation:o("labelSeparation"),method:O,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=eH(p.align,v)),p.baseline!==b&&(p.baseline=eH(p.baseline,b)),VV({type:PV,role:"axis-label",style:_V,key:wV,from:r,encode:_,overlap:O},n)}function sH(e,t,n,r){const i=BV(e,t),a=e.orient,o=IW(a,-1,1);let s,l;const u={enter:s={opacity:jV,anchor:Dq(i("titleAnchor",null)),align:{signal:qV}},update:l=vc({},s,{opacity:FV,text:Dq(e.title)}),exit:{opacity:jV}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(LV(0,1,.5),")")};return l.x=LW(a,c),l.y=qW(a,c),s.angle=LW(a,jV,((e,t)=>0===t?0:uU(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t})(o,90)),s.baseline=LW(a,UW(a,gV,hV),{value:gV}),l.angle=s.angle,l.baseline=s.baseline,Mq(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=eH(Dq(e),n.update[t]),!1):!Fq(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?Dq(o):LW(t,Dq(o),Dq(a))}(i,a,u,n),u.update.align=eH(u.update.align,s.align),u.update.angle=eH(u.update.angle,s.angle),u.update.baseline=eH(u.update.baseline,s.baseline),VV({type:PV,role:"axis-title",style:kV,from:r,encode:u},n)}function lH(e,t){const n=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,l="band"===t.scaleType(e.scale)&&a.axisBand,u=e.orient;if(uU(u)){const e=nH([a.axisX,a.axisY]),t=nH([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=LW(u,tH(i,a.axisX,s,o),tH(i,a.axisY,s,o));for(i of(r={},t))r[i]=QW(u.signal,tH(i,a.axisTop,s,o),tH(i,a.axisBottom,s,o),tH(i,a.axisLeft,s,o),tH(i,a.axisRight,s,o))}else n=u===hV||u===gV?a.axisX:a.axisY,r=a["axis"+u[0].toUpperCase()+u.slice(1)];return n||r||l?vc({},s,n,r,l):s}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=BV(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},zu(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},f=nU(t.add(EU({},[c]))),d=nU(t.add(OU({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let p;return c.grid&&h.push(iH(e,n,r.grid,d,u)),c.ticks&&(p=l("tickSize"),h.push(function(e,t,n,r,i,a){const o=BV(e,t),s=e.orient,l=IW(s,-1,1);let u,c,f;const d={enter:u={opacity:jV},update:f={opacity:FV},exit:c={opacity:jV}};Mq(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=Dq(i);h.mult=l;const p={scale:e.scale,field:wV,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=u.y=LW(s,jV,p),f.y2=u.y2=LW(s,h),c.x=LW(s,p),f.x=u.x=qW(s,jV,p),f.x2=u.x2=qW(s,h),c.y=qW(s,p),VV({type:RV,role:"axis-tick",key:wV,from:r,encode:d},n)}(e,n,r.ticks,d,p,u))),c.labels&&(p=c.ticks?p:0,h.push(oH(e,n,r.labels,d,p,u))),c.domain&&h.push(function(e,t,n,r){const i=BV(e,t),a=e.orient;let o,s;const l={enter:o={opacity:jV},update:s={opacity:FV},exit:{opacity:jV}};Mq(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=rH(e,0),c=rH(e,1);return o.x=s.x=LW(a,u,jV),o.x2=s.x2=LW(a,c),o.y=s.y=qW(a,u,jV),o.y2=s.y2=qW(a,c),VV({type:RV,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,f)),c.title&&h.push(sH(e,n,r.title,f)),DW(zV({role:"axis",from:f,encode:jq(uH(l,e),i,MV),marks:h,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function uH(e,t){const n={enter:{},update:{}};return Mq(n,{orient:e("orient"),offset:e("offset")||0,position:fU(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function cH(e,t,n){const r=lc(e.signals),i=lc(e.scales);return n||r.forEach((e=>Qq(e,t))),lc(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=dV(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=dV(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";Tk(n)||Eu("Unrecognized scale type: "+Lc(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),lc(e.data).forEach((e=>RW(e,t))),i.forEach((e=>ZU(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?Eu("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=fL(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>xU(e,t,n.id)))}(e,t))),lc(e.axes).forEach((e=>lH(e,t))),lc(e.marks).forEach((e=>DW(e,t))),lc(e.legends).forEach((e=>CW(e,t))),e.title&&TW(e.title,t),t.parseLambdas(),t}function fH(e,t){const n=t.config,r=nU(t.root=t.add(tU())),i=function(e,t){const n=n=>fU(e[n],t[n]),r=[dH("background",n("background")),dH("autosize",Eq(n("autosize"))),dH("padding",Aq(n("padding"))),dH("width",n("width")||0),dH("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return lc(e.signals).forEach((e=>{_c(i,e.name)?e=vc(i[e.name],e):r.push(e),a[e.name]=e})),lc(t.signals).forEach((e=>{_c(a,e.name)||_c(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>Qq(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(EU()),o=t.add(DU(Gq((e=>jq({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),TV,Nq,e.style,t,{pulse:nU(a)}))),s=t.add(YU({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:nU(o)}));t.operators.pop(),t.pushState(nU(o),nU(s),null),cH(e,t,i),t.operators.push(s);let l=t.add(SU({mark:r,pulse:nU(s)}));return l=t.add(WU({pulse:nU(l)})),l=t.add(GU({pulse:nU(l)})),t.addData("root",new OW(t,a,a,l)),t}function dH(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function hH(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function pH(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function mH(e){return(Pu(e)?gH:yH)(e)}function gH(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(zu(t)?t.signal||mH(t):Lc(t))}return n+"]"}function yH(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+Lc(t)+":"+(zu(n)?n.signal||mH(n):Lc(n));return r+"}"}hH.prototype=pH.prototype={parse(e){return cH(e,this)},fork(){return new pH(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof Zq?nU(e):e;return this.add(UU({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(nU(this.add(GU({pulse:e})))),this._parent.push(t),this._lookup.push(n?nU(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Uu(this._parent)},encode(){return Uu(this._encode)},lookup(){return Uu(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Fc(e))return rU(e,t);e.signal||Eu("Unsupported field reference: "+Lc(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=nU(this.add(jU(e)))}return r},compareRef(e){let t=!1;const n=e=>uU(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=lc(e.field).map(n),i=lc(e.order).map(n);return t?nU(this.add($U({fields:r,orders:i}))):aU(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=lc(e).map((e=>uU(e)?(n=!0,nU(r[e.signal])):e)),n?nU(this.add(FU({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=oU(e.op,e.field),n=e.order||"ascending";return n.signal?nU(this.add($U({fields:t,orders:this.signalRef(n.signal)}))):aU(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return _c(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&Eu("Duplicate signal name: "+Lc(e));const n=t instanceof Zq?t:this.add(tU(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||Eu("Unrecognized signal name: "+Lc(e)),this.signals[e]},signalRef(e){return this.signals[e]?nU(this.signals[e]):(_c(this.lambdas,e)||(this.lambdas[e]=this.add(tU(null))),nU(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=fL(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&zu(e)?this.signalRef(e.signal||mH(e)):e},exprRef(e,t){const n={expr:fL(e,this)};return t&&(n.expr.$name=t),nU(this.add(CU(n)))},addBinding(e,t){this.bindings||Eu("Nested signals do not support binding: "+Lc(e)),this.bindings.push(vc({signal:e},t))},addScaleProj(e,t){_c(this.scales,e)&&Eu("Duplicate scale or projection name: "+Lc(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,HU(t))},addProjection(e,t){this.addScaleProj(e,qU(t))},getScale(e){return this.scales[e]||Eu("Unrecognized scale name: "+Lc(e)),this.scales[e]},scaleRef(e){return nU(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return _c(this.data,e)&&Eu("Duplicate data set name: "+Lc(e)),this.data[e]=t},getData(e){return this.data[e]||Eu("Undefined data set name: "+Lc(e)),this.data[e]},addDataPipeline(e,t){return _c(this.data,e)&&Eu("Duplicate data set name: "+Lc(e)),this.addData(e,OW.fromEntries(this,t))}};vc(Tg,eb,aC,RC,kN,_R,rz,RP,lz,Tz,Xz,rB);var vH=Object.freeze({__proto__:null,version:"5.17.1",Dataflow:Mg,EventStream:gg,MultiPulse:Eg,Operator:hg,Parameters:cg,Pulse:_g,Transform:Fg,changeset:lg,definition:Ng,ingest:ng,isTuple:Zm,transform:Rg,transforms:Tg,tupleid:eg,interpolate:Gk,interpolateColors:Vk,interpolateRange:Uk,quantizeInterpolator:Wk,scale:Fk,scheme:Kk,projection:WT,View:fq,defaultLocale:Hm,formatLocale:zm,locale:Wm,resetDefaultLocale:function(){return Rm(),Lm(),Hm()},timeFormatLocale:Um,expressionFunction:cL,parse:function(e,t,n){return zu(e)||Eu("Input Vega specification must be an object."),fH(e,new hH(t=Iu(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()},runtimeContext:xL,Debug:4,Error:1,Info:3,None:0,Warn:2,accessor:xu,accessorFields:_u,accessorName:wu,array:lc,ascending:dc,clampRange:uc,compare:fc,constant:gc,debounce:yc,error:Eu,extend:vc,extent:bc,extentIndex:xc,falsy:Tu,fastmap:Oc,field:Au,flush:Sc,hasOwnProperty:_c,id:Du,identity:Cu,inherits:Ec,inrange:$c,isArray:Pu,isBoolean:Ac,isDate:Dc,isFunction:cc,isIterable:Cc,isNumber:Mc,isObject:zu,isRegExp:jc,isString:Fc,key:Tc,lerp:Nc,logger:Ru,lruCache:Rc,merge:Pc,mergeConfig:Iu,one:ju,pad:Bc,panLinear:Ku,panLog:Qu,panPow:Zu,panSymlog:ec,peek:Uu,quarter:oc,repeat:zc,span:Ic,splitAccessPath:$u,stringValue:Lc,toBoolean:qc,toDate:Vc,toNumber:Vu,toSet:Hc,toString:Wc,truncate:Gc,truthy:Fu,utcquarter:sc,visitArray:Xc,writeConfig:Lu,zero:Mu,zoomLinear:nc,zoomLog:rc,zoomPow:ic,zoomSymlog:ac,bandwidthNRD:Ig,bin:Lg,bootstrapCI:Ug,cumulativeLogNormal:ny,cumulativeNormal:Jg,cumulativeUniform:ly,densityLogNormal:ty,densityNormal:Yg,densityUniform:sy,dotbin:Vg,quantileLogNormal:ry,quantileNormal:Kg,quantileUniform:uy,quantiles:zg,quartiles:Bg,get random(){return qg},randomInteger:function(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*qg()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)},randomKDE:Zg,randomLCG:function(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}},randomLogNormal:iy,randomMixture:ay,randomNormal:Qg,randomUniform:cy,regressionExp:yy,regressionLinear:my,regressionLoess:_y,regressionLog:gy,regressionPoly:xy,regressionPow:vy,regressionQuad:by,sampleCurve:Ey,sampleLogNormal:ey,sampleNormal:Xg,sampleUniform:oy,setRandom:function(e){qg=e},DATE:th,DAY:nh,DAYOFYEAR:rh,HOURS:ih,MILLISECONDS:sh,MINUTES:ah,MONTH:Zd,QUARTER:Qd,SECONDS:oh,TIME_UNITS:lh,WEEK:eh,YEAR:Kd,dayofyear:mh,timeBin:ap,timeFloor:Mh,timeInterval:Ph,timeOffset:Ih,timeSequence:Uh,timeUnitSpecifier:dh,timeUnits:ch,utcFloor:Th,utcInterval:zh,utcOffset:Lh,utcSequence:Vh,utcdayofyear:wh,utcweek:_h,week:gh,read:Gm,inferType:ff,inferTypes:df,typeParsers:lf,format:Ff,formats:Tf,responseType:Nf,loader:Xm,Bounds:gS,CanvasHandler:W$,CanvasRenderer:J$,Gradient:kO,GroupItem:vS,Handler:$$,Item:yS,Marks:f$,RenderType:zA,Renderer:D$,ResourceLoader:bS,SVGHandler:Q$,SVGRenderer:wA,SVGStringRenderer:NA,Scenegraph:b$,boundClip:HA,boundContext:IS,boundItem:d$,boundMark:p$,boundStroke:_S,domChild:k$,domClear:O$,domCreate:w$,domFind:_$,font:a$,fontFamily:i$,fontSize:ZE,intersect:LA,intersectBoxLine:KS,intersectPath:GS,intersectPoint:XS,intersectRule:JS,lineHeight:e$,markup:mA,multiLineOffset:n$,pathCurves:SO,pathEqual:XA,pathParse:AO,pathRectangle:QO,pathRender:BO,pathSymbols:UO,pathTrail:ZO,point:E$,renderModule:IA,resetSVGClipId:pS,resetSVGDefIds:function(){pS(),vO=0},sceneEqual:GA,sceneFromJSON:y$,scenePickVisit:lE,sceneToJSON:g$,sceneVisit:sE,sceneZOrder:oE,serializeXML:gA,textMetrics:GE});Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var bH=ms((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var f=[],d=[],h="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(h&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var y=f.indexOf(l);if(-1!=y)return d[y];f.push(l),d.push(m)}for(var v in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,v)),b&&null==b.set||(m[v]=a(l[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(v=0;v<x.length;v++){var w=x[v];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(m[w]=a(l[w],p-1),k.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(v=0;v<_.length;v++){var k,O=_[v];(k=Object.getOwnPropertyDescriptor(l,O))&&k.enumerable||(m[O]=a(l[O],p-1),Object.defineProperty(m,O,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)})),xH=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)};function wH(e){return!!e.or}function _H(e){return!!e.and}function kH(e){return!!e.not}function OH(e,t){if(kH(e))OH(e.not,t);else if(_H(e))for(const n of e.and)OH(n,t);else if(wH(e))for(const n of e.or)OH(n,t);else t(e)}function SH(e,t){return kH(e)?{not:SH(e.not,t)}:_H(e)?{and:e.and.map((e=>SH(e,t)))}:wH(e)?{or:e.or.map((e=>SH(e,t)))}:t(e)}const EH=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n},$H=bH;function AH(e,t){const n={};for(const r of t)_c(e,r)&&(n[r]=e[r]);return n}function DH(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>xH(e))).join(",")})`};const CH=xH;function MH(e){if(Mc(e))return e;const t=Fc(e)?e:xH(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function jH(e){return!1===e||null===e}function FH(e,t){return e.indexOf(t)>-1}function TH(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function NH(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function RH(e,...t){for(const n of t)PH(e,null!=n?n:{});return e}function PH(e,t){for(const n of VH(t))Lu(e,n,t[n],!0)}function zH(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function BH(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function IH(e,t){for(const n of e)if(t.has(n))return!0;return!1}function LH(e){const t=new Set;for(const n of e){const e=$u(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function qH(e,t){return void 0===e||void 0===t||IH(LH(e),LH(t))}function UH(e){return 0===VH(e).length}const VH=Object.keys,WH=Object.values,HH=Object.entries;function GH(e){return!0===e||!1===e}function XH(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function YH(e,t){return kH(e)?"!("+YH(e.not,t)+")":_H(e)?"("+e.and.map((e=>YH(e,t))).join(") && (")+")":wH(e)?"("+e.or.map((e=>YH(e,t))).join(") || (")+")":t(e)}function JH(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&JH(e[n],t)&&delete e[n],UH(e)}function KH(e){return e.charAt(0).toUpperCase()+e.substr(1)}function QH(e,t="datum"){const n=$u(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(Lc).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function ZH(e,t="datum"){return`${t}[${Lc($u(e).join("."))}]`}function eG(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function tG(e){return`${$u(e).map(eG).join("\\.")}`}function nG(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function rG(e){return`${$u(e).join(".")}`}function iG(e){return e?$u(e).length:0}function aG(...e){for(const t of e)if(void 0!==t)return t}let oG=42;function sG(e){const t=++oG;return e?String(e)+t:t}function lG(e){return uG(e)?e:`__${e}`}function uG(e){return 0===e.indexOf("__")}function cG(e){if(void 0!==e)return(e%360+360)%360}function fG(e){return!!Mc(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const dG={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function hG(e){return e&&e.condition}const pG=["domain","grid","labels","ticks","title"],mG={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},gG={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},yG=Object.assign(Object.assign({},gG),{style:1,labelExpr:1,encoding:1});function vG(e){return!!yG[e]}const bG=VH({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),xG={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},wG={count:1,min:1,max:1};function _G(e){return!!e&&!!e.argmin}function kG(e){return!!e&&!!e.argmax}function OG(e){return Fc(e)&&!!xG[e]}const SG=["count","valid","missing","distinct"];function EG(e){return Fc(e)&&FH(SG,e)}const $G=["count","sum","distinct","valid","missing"],AG=Hc(["mean","average","median","q1","q3","min","max"]);var DG=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const CG="row",MG="column",jG="facet",FG="x",TG="y",NG="x2",RG="y2",PG="radius",zG="radius2",BG="theta",IG="theta2",LG="latitude",qG="longitude",UG="latitude2",VG="longitude2",WG="color",HG="fill",GG="stroke",XG="shape",YG="size",JG="angle",KG="opacity",QG="fillOpacity",ZG="strokeOpacity",eX="strokeWidth",tX="strokeDash",nX="text",rX="order",iX="detail",aX="key",oX="tooltip",sX="href",lX="url",uX="description",cX={theta:1,theta2:1,radius:1,radius2:1};function fX(e){return e in cX}const dX={longitude:1,longitude2:1,latitude:1,latitude2:1};const hX=VH(dX),pX=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),cX),dX),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function mX(e){return e===WG||e===HG||e===GG}const gX={row:1,column:1,facet:1},yX=VH(gX),vX=Object.assign(Object.assign({},pX),gX),bX=VH(vX),xX=DG(vX,["order","detail","tooltip"]),wX=DG(xX,["row","column","facet"]);function _X(e){return!!vX[e]}const kX=[NG,RG,UG,VG,IG,zG];function OX(e){return SX(e)!==e}function SX(e){switch(e){case NG:return FG;case RG:return TG;case UG:return LG;case VG:return qG;case IG:return BG;case zG:return PG}return e}function EX(e){if(fX(e))switch(e){case BG:return"startAngle";case IG:return"endAngle";case PG:return"outerRadius";case zG:return"innerRadius"}return e}function $X(e){switch(e){case FG:return NG;case TG:return RG;case LG:return UG;case qG:return VG;case BG:return IG;case PG:return zG}}function AX(e){switch(e){case FG:case NG:return"width";case TG:case RG:return"height"}}const DX=DG(pX,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),CX=VH(DX),MX={x:1,y:1},jX=VH(MX);function FX(e){return e in MX}const TX={theta:1,radius:1},NX=VH(TX);function RX(e){return"width"===e?FG:TG}const PX=DG(DX,["text","tooltip","href","url","description","detail","key","order"]),zX=VH(PX);const BX=Object.assign(Object.assign(Object.assign({},MX),TX),PX),IX=VH(BX);function LX(e){return!!BX[e]}function qX(e,t){return function(e){switch(e){case WG:case HG:case GG:case uX:case iX:case aX:case oX:case sX:case rX:case KG:case QG:case ZG:case eX:case jG:case CG:case MG:return UX;case FG:case TG:case LG:case qG:return VX;case NG:case RG:case UG:case VG:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case YG:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case tX:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case XG:return{point:"always",geoshape:"always"};case nX:return{text:"always"};case JG:return{point:"always",square:"always",text:"always"};case lX:return{image:"always"};case BG:case PG:return{text:"always",arc:"always"};case IG:case zG:return{arc:"always"}}}(e)[t]}const UX={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},VX=DG(UX,["geoshape"]);function WX(e){switch(e){case FG:case TG:case BG:case PG:case YG:case JG:case eX:case KG:case QG:case ZG:case NG:case RG:case IG:case zG:return;case jG:case CG:case MG:case XG:case tX:case nX:case oX:case sX:case lX:case uX:return"discrete";case WG:case HG:case GG:return"flexible";case LG:case qG:case UG:case VG:case iX:case aX:case rX:return}}function HX(e){return Ac(e)&&(e=MQ(e,void 0)),"bin"+VH(e).map((t=>JX(e[t])?XH(`_${t}_${HH(e[t])}`):XH(`_${t}_${e[t]}`))).join("")}function GX(e){return!0===e||YX(e)&&!e.binned}function XX(e){return"binned"===e||YX(e)&&!0===e.binned}function YX(e){return zu(e)}function JX(e){return null==e?void 0:e.selection}function KX(e){switch(e){case CG:case MG:case YG:case WG:case HG:case GG:case eX:case KG:case QG:case ZG:case XG:return 6;case tX:return 4;default:return 10}}function QX(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const ZX='Autosize "fit" only works for single views and layered views.';function eY(e){return`${"width"==e?"Width":"Height"} "container" only works for single views and layered views.`}function tY(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function nY(e){return e?`Dropping "fit-${e}" because spec has discrete ${AX(e)}.`:'Dropping "fit" because spec has discrete size.'}function rY(e){return`Unknown field for ${e}. Cannot calculate view size.`}function iY(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function aY(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function oY(e){return`Selection not supported for ${e} yet.`}const sY="The same selection must be used to override scale domains in a layered view.";function lY(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function uY(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function cY(e){return`Ignoring an invalid transform: ${CH(e)}.`}function fY(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function dY(e){return`Invalid field type "${e}".`}function hY(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function pY(e,t){return`Dropping ${CH(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function mY(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function gY(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function yY(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function vY(e){return`Using unaggregated domain with raw field has no effect (${CH(e)}).`}function bY(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function xY(e){return`Unaggregated domain is currently unsupported for log scale (${CH(e)}).`}function wY(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function _Y(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const kY="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function OY(e,t){return`Invalid ${e}: ${CH(t)}.`}function SY(e){return`1D error band does not support ${e}.`}function EY(e){return`Channel ${e} is required for "binned" bin.`}const $Y=Ru(2);let AY=$Y;function DY(...e){AY.warn(...e)}function CY(e){if(e&&zu(e))for(const t of BY)if(t in e)return!0;return!1}const MY=["january","february","march","april","may","june","july","august","september","october","november","december"],jY=MY.map((e=>e.substr(0,3))),FY=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],TY=FY.map((e=>e.substr(0,3)));function NY(e,t){const n=[];if(t&&void 0!==e.day&&VH(e).length>1&&(DY(function(e){return`Dropping day from datetime ${CH(e)} as day cannot be combined with other units.`}(e)),delete(e=$H(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(fG(e)&&(e=+e),Mc(e))return e-1;{const t=e.toLowerCase(),n=MY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=jY.indexOf(r);if(-1!==i)return i;throw new Error(OY("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(fG(e)&&(e=+e),Mc(e))return e>4&&DY(OY("quarter",e)),e-1;throw new Error(OY("quarter",e))}(e.quarter):e.quarter;n.push(Mc(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(fG(e)&&(e=+e),Mc(e))return e%7;{const t=e.toLowerCase(),n=FY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=TY.indexOf(r);if(-1!==i)return i;throw new Error(OY("day",e))}}(e.day):e.day;n.push(Mc(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function RY(e){const t=NY(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}var PY=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const zY={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},BY=VH(zY);function IY(e){return e.startsWith("utc")}const LY={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function qY(e){const t=[];for(const n of BY)UY(e,n)&&t.push(n);return t}function UY(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function VY(e,t,{end:n}={end:!1}){const r=QH(t),i=IY(e)?"utc":"";let a;const o={};for(const t of BY)UY(e,t)&&(o[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=t);var s;return n&&(o[a]+="+1"),function(e){const t=NY(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}function WY(e){if(!e)return;const t=qY(e);return`timeUnitSpecifier(${xH(t)}, ${xH(LY)})`}function HY(e){if(!e)return;let t;return Fc(e)?t={unit:e}:zu(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),IY(t.unit)&&(t.utc=!0,t.unit=function(e){return e.substr(3)}(t.unit)),t}function GY(e){return e&&!!e.signal}function XY(e){return!!e.step}function YY(e){return!Pu(e)&&("field"in e&&"data"in e)}const JY=VH({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),KY={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},QY=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function ZY(e){return e&&!!e.field&&void 0!==e.equal}function eJ(e){return e&&!!e.field&&void 0!==e.lt}function tJ(e){return e&&!!e.field&&void 0!==e.lte}function nJ(e){return e&&!!e.field&&void 0!==e.gt}function rJ(e){return e&&!!e.field&&void 0!==e.gte}function iJ(e){if(e&&e.field){if(Pu(e.range)&&2===e.range.length)return!0;if(GY(e.range))return!0}return!1}function aJ(e){return e&&!!e.field&&(Pu(e.oneOf)||Pu(e.in))}function oJ(e){return aJ(e)||ZY(e)||iJ(e)||eJ(e)||nJ(e)||tJ(e)||rJ(e)}function sJ(e,t){return TQ(e,{timeUnit:t,wrapTime:!0})}function lJ(e,t=!0){var n;const{field:r}=e,i=null===(n=HY(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+VY(i,r)+")":gQ(e,{expr:"datum"});if(ZY(e))return a+"==="+sJ(e.equal,i);if(eJ(e)){return`${a}<${sJ(e.lt,i)}`}if(nJ(e)){return`${a}>${sJ(e.gt,i)}`}if(tJ(e)){return`${a}<=${sJ(e.lte,i)}`}if(rJ(e)){return`${a}>=${sJ(e.gte,i)}`}if(aJ(e))return`indexof([${function(e,t){return e.map((e=>sJ(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return uJ(a,e.valid);if(iJ(e)){const{range:n}=e,r=GY(n)?{signal:`${n.signal}[0]`}:n[0],o=GY(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+sJ(r,i)+", "+sJ(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${sJ(r,i)}`),null!==o&&s.push(`${a} <= ${sJ(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function uJ(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function cJ(e){var t;return oJ(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=HY(e.timeUnit))||void 0===t?void 0:t.unit}):e}const fJ="quantitative",dJ="ordinal",hJ="temporal",pJ="nominal",mJ="geojson";var gJ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const yJ="linear",vJ="log",bJ="pow",xJ="sqrt",wJ="symlog",_J="time",kJ="utc",OJ="quantile",SJ="quantize",EJ="threshold",$J="point",AJ="band",DJ={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function CJ(e,t){const n=DJ[e],r=DJ[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const MJ={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function jJ(e){return MJ[e]}const FJ=["linear","log","pow","sqrt","symlog","time","utc"],TJ=Hc(FJ),NJ=Hc(["linear","log","pow","sqrt","symlog"]);const RJ=Hc(["quantile","quantize","threshold"]),PJ=Hc(FJ.concat(["quantile","quantize","threshold","sequential","identity"])),zJ=Hc(["ordinal","bin-ordinal","point","band"]);function BJ(e){return e in zJ}function IJ(e){return e in PJ}function LJ(e){return e in TJ}function qJ(e){return e in RJ}function UJ(e){return null==e?void 0:e.selection}const VJ=gJ({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),WJ=VH(VJ);function HJ(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!FH(["point","band","identity"],e);case"bins":return!FH(["point","band","identity","ordinal"],e);case"round":return LJ(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return LJ(e)||FH(["point","band"],e);case"paddingOuter":case"align":return FH(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return LJ(e);case"nice":return LJ(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return IJ(e)&&!FH(["log","time","utc","threshold","quantile"],e)}}function GJ(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return mX(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function XJ(e){return e&&!!e.expr}function YJ(e){const t=VH(e||{}),n={};for(const r of t)n[r]=qQ(e[r]);return n}const JJ={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},KJ=JJ.arc,QJ=JJ.area,ZJ=JJ.bar,eK=JJ.image,tK=JJ.line,nK=JJ.point,rK=JJ.rect,iK=JJ.rule,aK=JJ.text,oK=JJ.tick,sK=JJ.trail,lK=JJ.circle,uK=JJ.square,cK=JJ.geoshape;function fK(e){return FH(["line","area","trail"],e)}function dK(e){return FH(["rect","bar","image","arc"],e)}const hK=VH(JJ);function pK(e){return e.type}Hc(hK);const mK=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],gK=VH({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),yK=VH({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),vK={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},bK={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},xK={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function wK(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=$K(e);return rQ(n)&&!EG(n.aggregate)&&i&&LJ(i.get("type"))&&!1===i.get("zero")?_K({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function _K({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){if(fK(n.type))return r;return null===XQ("invalid",n,i)?r:[kK(e,t),r]}function kK(e,t){const n=OK(e,!0),r="y"===SX(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function OK(e,t=!0){return uJ(Fc(e)?e:gQ(e,{expr:"datum"}),!t)}function SK(e,t,n,r){const i={};if(t&&(i.scale=t),aQ(e)){const{datum:t}=e;CY(t)?i.signal=RY(t):GY(t)?i.signal=t.signal:XJ(t)?i.signal=t.expr:i.value=t}else i.field=gQ(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function EK({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=gQ(t,{expr:o,suffix:i}),l=void 0!==n?gQ(n,{expr:o}):gQ(t,{suffix:"end",expr:o}),u={};if(0===a||1===a){u.scale=e;const t=0===a?s:l;u.field=t}else{const t=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${t})`}return r&&(u.offset=r),u}function $K({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(lQ(t)){if(uQ(t)){c=null!=c?c:QK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:f}=t;if(GX(o)||c&&u&&f===hJ)return s&&s.impute?SK(t,a,{binSuffix:"mid"},{offset:l}):c?EK({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):SK(t,a,RQ(t,e)?{binSuffix:"range"}:{},{offset:l});if(XX(o)){if(rQ(n))return EK({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});DY(EY(e===FG?NG:RG))}}const u=null==o?void 0:o.get("type");return SK(t,a,BJ(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(cQ(t)){const n=t.value,r=l?{offset:l}:{};return Object.assign(Object.assign({},AK(e,n)),r)}}return cc(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function AK(e,t){return FH(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:FH(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:VQ(t)}function DK(e){return e&&"number"!==e&&"time"!==e}function CK(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function MK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if(DK(n))return FK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=jK(e,r,i);if(FQ(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=Fc(n)?n:r}')`:function(e,t,n){if(!e)return;const r=WY(e);return`${n||IY(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,rQ(e)?null===(o=HY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,fQ(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===kJ);return n?{signal:n}:void 0}if(t=RK(iQ(e),t,a),rQ(e)&&GX(e.bin)){return{signal:BK(l,gQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return t||"quantitative"===iQ(e)?{signal:`${PK(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function jK(e,t,n){return rQ(e)?n?`${gQ(e,{expr:t,suffix:"end"})}-${gQ(e,{expr:t,suffix:"start"})}`:gQ(e,{expr:t}):function(e){const{datum:t}=e;return CY(t)?RY(t):`${JSON.stringify(t)}`}(e)}function FK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){if(o=null!=o?o:jK(e,r,i),rQ(e)&&GX(e.bin)){return{signal:BK(o,gQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return{signal:CK(n,o,t)}}function TK(e,t,n,r,i,a){var o;if(!DK(r)){if(FQ(e)){return function(e,t,n,r){if(e)return e;if(t)return{signal:WY(t)};return r?void 0:n.timeFormat}(n,rQ(e)?null===(o=HY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a)}return RK(t,n,i)}}function NK(e,t,n){return e&&(GY(e)||"number"===e||"time"===e)?e:FQ(t)&&"time"!==n&&"utc"!==n?"time":void 0}function RK(e,t,n){return Fc(t)?t:e===fJ?n.numberFormat:void 0}function PK(e,t){return`format(${e}, "${t||""}")`}function zK(e,t,n,r){var i;return DK(n)?CK(n,e,t):PK(e,null!==(i=Fc(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function BK(e,t,n,r,i){const a=zK(e,n,r,i),o=zK(t,n,r,i);return`${uJ(e,!1)} ? "null" : ${a} + " – " + ${o}`}const IK="min",LK={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function qK(e){return e in LK}function UK(e){return!!e&&!!e.encoding}function VK(e){return!(!e||"count"!==e.op&&!e.field)}function WK(e){return!!e&&Pu(e)}function HK(e){return"row"in e||"column"in e}function GK(e){return!!e&&"header"in e}function XK(e){return"facet"in e}var YK=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function JK(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function KK(e){return"sort"in e}function QK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(lQ(t)&&void 0!==t.band)return t.band;if(rQ(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?YQ("timeUnitBandPosition",r,a):dK(r.type)?YQ("timeUnitBand",r,a):0;if(GX(i))return dK(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function ZK(e,t,n,r,i,a){return!!(GX(t.bin)||t.timeUnit&&uQ(t)&&"temporal"===t.type)&&!!QK({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function eQ(e){return!!e&&"condition"in e}function tQ(e){const t=e&&e.condition;return!!t&&!Pu(t)&&rQ(t)}function nQ(e){const t=e&&e.condition;return!!t&&!Pu(t)&&lQ(t)}function rQ(e){return!(!e||!e.field&&"count"!==e.aggregate)}function iQ(e){return e&&e.type}function aQ(e){return!!e&&"datum"in e}function oQ(e){return uQ(e)&&vQ(e)||sQ(e)}function sQ(e){return aQ(e)&&Mc(e.datum)}function lQ(e){return rQ(e)||aQ(e)}function uQ(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function cQ(e){return e&&"value"in e&&"value"in e}function fQ(e){return!!e&&("scale"in e||"sort"in e)}function dQ(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function hQ(e){return!!e&&"legend"in e}function pQ(e){return!!e&&("format"in e||"formatType"in e)}function mQ(e){return DH(e,["legend","axis","header","scale"])}function gQ(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=lG("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:f}=e;GX(u)?(o=HX(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?kG(c)?(l=`["${a}"]`,a=`argmax_${c.argmax}`):_G(c)?(l=`["${a}"]`,a=`argmin_${c.argmin}`):o=String(c):f&&(o=function(e){const t=HY(e),{utc:n}=t,r=PY(t,["utc"]);return r.unit?(n?"utc":"")+VH(r).map((e=>XH(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+VH(r).map((e=>XH(`_${e}_${r[e]}`))).join("")}(f),s=(!FH(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?rG(a):t.expr?ZH(a,t.expr)+l:tG(a)+l}function yQ(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return rQ(e)&&!!e.bin;case"temporal":return!1}throw new Error(dY(e.type))}function vQ(e){return!yQ(e)}const bQ=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(kG(t))return`${i} for argmax(${t.argmax})`;if(_G(t))return`${i} for argmin(${t.argmin})`;const a=HY(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||GX(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(GX(i))return`${r} (binned)`;if(a){const e=null===(n=HY(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${qY(e).join("-")})`}else if(o)return kG(o)?`${r} for max ${o.argmax}`:_G(o)?`${r} for min ${o.argmin}`:`${KH(o)} of ${r}`;return r}(e,t)}};let xQ=bQ;function wQ(e){xQ=e}function _Q(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=kQ(e))||void 0===i?void 0:i.title;if(!rQ(e))return o;const s=e,l=r?OQ(s,t):void 0;return n?aG(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function kQ(e){return dQ(e)&&e.axis?e.axis:hQ(e)&&e.legend?e.legend:GK(e)&&e.header?e.header:void 0}function OQ(e,t){return xQ(e,t)}function SQ(e){var t;if(pQ(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=kQ(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function EQ(e){return rQ(e)?e:tQ(e)?e.condition:void 0}function $Q(e){return lQ(e)?e:nQ(e)?e.condition:void 0}function AQ(e,t,n,r={}){if(Fc(e)||Mc(e)||Ac(e)){return DY(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${CH(n)}}.`}(t,Fc(e)?"string":Mc(e)?"number":"boolean",e)),{value:e}}return lQ(e)?DQ(e,t,n,r):nQ(e)?Object.assign(Object.assign({},e),{condition:DQ(e.condition,t,n,r)}):e}function DQ(e,t,n,r){if(pQ(e)){const{format:i,formatType:a}=e,o=YK(e,["format","formatType"]);if(DK(a)&&!n.customFormatTypes)return DY(fY(t)),DQ(o,t,n,r)}else{const i=dQ(e)?"axis":hQ(e)?"legend":GK(e)?"header":null;if(i&&e[i]){const a=e[i],{format:o,formatType:s}=a,l=YK(a,["format","formatType"]);if(DK(s)&&!n.customFormatTypes)return DY(fY(t)),DQ(Object.assign(Object.assign({},e),{[i]:l}),t,n,r)}}return rQ(e)?CQ(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Mc(n)?"quantitative":Fc(n)?"nominal":CY(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function CQ(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||OG(r)||kG(r)||_G(r)||(DY(function(e){return`Invalid aggregation operator "${e}".`}(r)),delete s.aggregate),i&&(s.timeUnit=HY(i)),o&&(s.field=`${o}`),GX(a)&&(s.bin=MQ(a,t)),XX(a)&&!FX(t)&&DY(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),uQ(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case fJ:return"quantitative";case"t":case hJ:return"temporal";case"o":case dJ:return"ordinal";case"n":case pJ:return"nominal";case mJ:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&EG(r)&&(DY(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,r)),s.type="quantitative")}else if(!OX(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(KK(e)&&Pu(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!kG(r)&&!_G(r))return"quantitative";if(fQ(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(DJ[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(uQ(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case CG:case MG:case jG:return vQ(e)?{compatible:!1,warning:gY(t)}:jQ;case FG:case TG:case WG:case HG:case GG:case nX:case iX:case aX:case oX:case sX:case lX:case JG:case BG:case PG:case uX:return jQ;case qG:case VG:case LG:case UG:return n!==fJ?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:jQ;case KG:case QG:case ZG:case eX:case YG:case IG:case zG:case NG:case RG:return"nominal"!==n||e.sort?jQ:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case tX:return FH(["ordinal","nominal"],e.type)?jQ:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case XG:return FH(["ordinal","nominal","geojson"],e.type)?jQ:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case rX:return"nominal"!==e.type||"sort"in e?jQ:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&DY(n)}if(KK(s)&&Fc(s.sort)){const{sort:e}=s;if(qK(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&qK(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(GK(s)){const{header:e}=s,{orient:t}=e,n=YK(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function MQ(e,t){return Ac(e)?{maxbins:KX(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:KX(t)})}const jQ={compatible:!0};function FQ(e){const{formatType:t}=SQ(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||rQ(e)&&!!e.timeUnit)}(e)}function TQ(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=HY(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return XJ(e)?s=e.expr:GY(e)?s=e.signal:CY(e)?(l=!0,s=RY(e)):(Fc(e)||Mc(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!zY[e]}(o)&&(Mc(e)&&e<1e4||Fc(e)&&isNaN(Date.parse(e)))&&(s=RY({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function NQ(e,t){const{type:n}=e;return t.map((t=>{const r=TQ(t,{timeUnit:rQ(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function RQ(e,t){return GX(e.bin)?LX(t)&&FH(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var PQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zQ(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=PQ(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:AH(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function BQ(e){return Fc(e)||Pu(e)&&Fc(e[0])}var IQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function LQ(e){const t=Pu(e.condition)?e.condition.map(UQ):UQ(e.condition);return Object.assign(Object.assign({},qQ(e)),{condition:t})}function qQ(e){if(XJ(e)){const{expr:t}=e,n=IQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function UQ(e){if(XJ(e)){const{expr:t}=e,n=IQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function VQ(e){if(XJ(e)){const{expr:t}=e,n=IQ(e,["expr"]);return Object.assign({signal:t},n)}return GY(e)?e:void 0!==e?{value:e}:void 0}function WQ(e){return GY(e)?e.signal:Lc(e.value)}function HQ(e){return GY(e)?e.signal:null==e?null:Lc(e)}function GQ(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function XQ(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?YQ(e,t,n,r):void 0}function YQ(e,t,n,{vgChannel:r}={}){return aG(r?JQ(e,t,n.style):void 0,JQ(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function JQ(e,t,n){return KQ(e,GQ(t),n)}function KQ(e,t,n){let r;t=lc(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function QQ(e,t){return lc(e).reduce(((e,n)=>{var r;return e.field.push(gQ(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function ZQ(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(EH(t,e))return;n.push(e)})),n}function eZ(e,t){return EH(e,t)||!t?e:e?[...lc(e),...lc(t)].join(", "):t}function tZ(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((BQ(n)||GY(n))&&(BQ(r)||GY(r)))return{explicit:e.explicit,value:eZ(n,r)};if(BQ(n)||GY(n))return{explicit:e.explicit,value:n};if(BQ(r)||GY(r))return{explicit:e.explicit,value:r};if(!(BQ(n)||GY(n)||BQ(r)||GY(r)))return{explicit:e.explicit,value:ZQ(n,r)};throw new Error("It should never reach here")}function nZ(e){return"mark"in e}class rZ{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!nZ(e)&&function(e){return pK(e)?e.type:e}(e.mark)===this.name}}var iZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function aZ(e,t){const n=e&&e[t];return!!n&&(Pu(n)?TH(n,(e=>!!e.field)):rQ(n)||tQ(n))}function oZ(e){return TH(bX,(t=>{if(aZ(e,t)){const n=e[t];if(Pu(n))return TH(n,(e=>!!e.aggregate));{const e=EQ(n);return e&&!!e.aggregate}}return!1}))}function sZ(e,t){const n=[],r=[],i=[],a=[],o={};return cZ(e,((s,l)=>{if(rQ(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=iZ(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=kQ(s),p=e&&e.title;let m=gQ(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:_Q(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let e;if(kG(c)?(e="argmax",m=gQ({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):_G(c)?(e="argmin",m=gQ({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),uQ(s)&&GX(f)){if(r.push({bin:f,field:u,as:m}),n.push(gQ(s,{binSuffix:"end"})),RQ(s,l)&&n.push(gQ(s,{binSuffix:"range"})),FX(l)){const e={field:m+"_end"};o[l+"2"]=e}g.bin="binned",OX(l)||(g.type=fJ)}else if(d){i.push({timeUnit:d,field:u,as:m});const e=uQ(s)&&s.type!==hJ&&"time";e&&(l===nX||l===oX?g.formatType=e:!function(e){return!!DX[e]}(l)?FX(l)&&(g.axis=Object.assign({formatType:e},g.axis)):g.legend=Object.assign({formatType:e},g.legend))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function lZ(e,t,n,r){return VH(e).reduce(((i,a)=>{if(!_X(a))return DY(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||(DY("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=BG),!function(e,t,n){const r=qX(t,n);if(!r)return!1;if("binned"===r){const n=e[t===NG?FG:TG];return!!(rQ(n)&&rQ(e[t])&&XX(n.bin))}return!0}(e,a,t))return DY(mY(a,t)),i;if(a===YG&&"line"===t){const t=EQ(e[a]);if(null==t?void 0:t.aggregate)return DY("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===WG&&(n?"fill"in e:"stroke"in e))return DY(hY("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===iX||a===rX&&!Pu(o)&&!cQ(o)||a===oX&&Pu(o))o&&(i[a]=lc(o).reduce(((e,t)=>(rQ(t)?e.push(CQ(t,a)):DY(pY(t,a)),e)),[]));else{if(a===oX&&null===o)i[a]=null;else if(!(rQ(o)||aQ(o)||cQ(o)||eQ(o)||GY(o)))return DY(pY(o,a)),i;i[a]=AQ(o,a,r)}return i}),{})}function uZ(e,t){const n={};for(const r of VH(e)){const i=AQ(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function cZ(e,t,n){if(e)for(const r of VH(e)){const i=e[r];if(Pu(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function fZ(e,t){return VH(t).reduce(((n,r)=>{switch(r){case FG:case TG:case sX:case uX:case lX:case NG:case RG:case BG:case IG:case PG:case zG:case LG:case qG:case UG:case VG:case nX:case XG:case JG:case oX:return n;case rX:if("line"===e||"trail"===e)return n;case iX:case aX:{const e=t[r];if(Pu(e)||rQ(e))for(const t of lc(e))t.aggregate||n.push(gQ(t,{}));return n}case YG:if("trail"===e)return n;case WG:case HG:case GG:case KG:case QG:case ZG:case tX:case eX:{const e=EQ(t[r]);return e&&!e.aggregate&&n.push(gQ(e,{})),n}}}),[])}var dZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function hZ(e,t,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${pZ(t)}`:"";return{field:e+t.field,type:t.type,title:GY(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...zH(function(e){const t=[];for(const n of VH(e))if(aZ(e,n)){const r=lc(e[n]);for(const e of r)rQ(e)?t.push(e):tQ(e)&&t.push(e.condition)}return t}(n).map(mQ),MH)]}}function pZ(e){const{title:t,field:n}=e;return aG(t,n)}function mZ(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:f={}})=>{const d=pZ(n);return gZ(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},Fc(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),f)})}}function gZ(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),pK(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),Ac(e[t])?{}:e[t])})]:[]}function yZ(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],l=r[i+"Error2"];return{continuousAxisChannelDef:vZ(a,n),continuousAxisChannelDef2:vZ(o,n),continuousAxisChannelDefError:vZ(s,n),continuousAxisChannelDefError2:vZ(l,n),continuousAxis:i}}function vZ(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=dZ(e,["aggregate"]);return n!==t&&DY(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function bZ(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(pK(n)&&n.orient)return n.orient;if(oQ(i)){if(oQ(a)){const e=rQ(i)&&i.aggregate,n=rQ(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return FQ(a)&&!FQ(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(oQ(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var xZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const wZ="boxplot",_Z=new rZ(wZ,OZ);function kZ(e){return Mc(e)?"tukey":e}function OZ(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:uZ(e.encoding,t)});const{mark:i,encoding:a,selection:o,projection:s}=e,l=xZ(e,["mark","encoding","selection","projection"]),u=pK(i)?i:{type:i};o&&DY(oY("boxplot"));const c=null!==(n=u.extent)&&void 0!==n?n:t.boxplot.extent,f=XQ("size",u,t),d=kZ(c),{bins:h,timeUnits:p,transform:m,continuousAxisChannelDef:g,continuousAxis:y,groupby:v,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:w,boxOrient:_,customTooltipWithoutAggregatedField:k}=function(e,t,n){const r=bZ(e,wZ),{continuousAxisChannelDef:i,continuousAxis:a}=yZ(e,r,wZ),o=i.field,s=kZ(t),l=[...SZ(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=(c[f],xZ(c,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=dZ(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(Pu(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return Pu(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(d),{bins:m,timeUnits:g,aggregate:y,groupby:v,encoding:b}=sZ(p,n),x="vertical"===r?"horizontal":"vertical",w=r,_=[...m,...g,{aggregate:[...y,...l],groupby:v},...u];return{bins:m,timeUnits:g,transform:_,groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:h}}(e,c,t),{color:O,size:S}=x,E=xZ(x,["color","size"]),$=e=>mZ(u,y,g,e,t.boxplot),A=$(E),D=$(x),C=$(Object.assign(Object.assign({},E),S?{size:S}:{})),M=hZ([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],g,x),j={type:"tick",color:"black",opacity:1,orient:w,invalid:null,aria:!1},F="min-max"===d?M:hZ([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,x),T=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"lower_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"upper_whisker",extraEncoding:F})],N=[..."tukey"!==d?T:[],...D({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},zu(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:w,aria:!1}),positionPrefix:"mid_box",extraEncoding:M})];if("min-max"===d)return Object.assign(Object.assign({},l),{transform:(null!==(r=l.transform)&&void 0!==r?r:[]).concat(m),layer:N});const R=`datum["lower_box_${g.field}"]`,P=`datum["upper_box_${g.field}"]`,z=`(${P} - ${R})`,B=`${R} - ${c} * ${z}`,I=`${P} + ${c} * ${z}`,L=`datum["${g.field}"]`,q={joinaggregate:SZ(g.field),groupby:v},U={transform:[{filter:`(${B} <= ${L}) && (${L} <= ${I})`},{aggregate:[{op:"min",field:g.field,as:"lower_whisker_"+g.field},{op:"max",field:g.field,as:"upper_whisker_"+g.field},{op:"min",field:"lower_box_"+g.field,as:"lower_box_"+g.field},{op:"max",field:"upper_box_"+g.field,as:"upper_box_"+g.field},...b],groupby:v}],layer:T},V=xZ(E,["tooltip"]),{scale:W,axis:H}=g,G=pZ(g),X=DH(H,["title"]),Y=gZ(u,"outliers",t.boxplot,{transform:[{filter:`(${L} < ${B}) || (${L} > ${I})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},void 0!==G?{title:G}:{}),void 0!==W?{scale:W}:{}),UH(X)?{}:{axis:X})},V),O?{color:O}:{}),k?{tooltip:k}:{})})[0];let J;const K=[...h,...p,q];return Y?J={transform:K,layer:[Y,U]}:(J=U,J.transform.unshift(...K)),Object.assign(Object.assign({},l),{layer:[J,{transform:m,layer:N}]})}function SZ(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var EZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const $Z="errorbar",AZ=new rZ($Z,DZ);function DZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:uZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=MZ(e,$Z,t);delete a.size;const c=mZ(s,i,r,a,t.errorbar),f=s.thickness,d=s.size,h=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==f?{thickness:f}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==f?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function CZ(e,t){const{encoding:n}=e;if(function(e){return(lQ(e.x)||lQ(e.y))&&!lQ(e.x2)&&!lQ(e.y2)&&!lQ(e.xError)&&!lQ(e.xError2)&&!lQ(e.yError)&&!lQ(e.yError2)}(n))return{orient:bZ(e,t),inputType:"raw"};const r=function(e){return lQ(e.x2)||lQ(e.y2)}(n),i=function(e){return lQ(e.xError)||lQ(e.xError2)||lQ(e.yError)||lQ(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(lQ(e)&&lQ(r))throw new Error(`${t} cannot have both x2 and y2`);if(lQ(e)){if(oQ(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(lQ(r)){if(oQ(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(lQ(r)&&!lQ(e))throw new Error(`${t} cannot have xError2 without xError`);if(lQ(s)&&!lQ(i))throw new Error(`${t} cannot have yError2 without yError`);if(lQ(e)&&lQ(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(lQ(e)){if(oQ(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(lQ(i)){if(oQ(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function MZ(e,t,n){var r;const{mark:i,encoding:a,selection:o,projection:s}=e,l=EZ(e,["mark","encoding","selection","projection"]),u=pK(i)?i:{type:i};o&&DY(oY(t));const{orient:c,inputType:f}=CZ(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=yZ(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&DY(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:KH(t)},{fieldPrefix:"upper_",titlePrefix:jZ(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:jZ(t,n,"-")}],d=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:_Q({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:_Q({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:_Q({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&DY(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?u.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:nG(nG(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}(u,d,h,p,m,f,t,n),w=a,_=g,k=(w[_],"x"===g?"x2":"y2"),O=(w[k],"x"===g?"xError":"yError"),S=(w[O],"x"===g?"xError2":"yError2"),E=(w[S],EZ(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof O?O:O+"","symbol"==typeof S?S:S+""])),{bins:$,timeUnits:A,aggregate:D,groupby:C,encoding:M}=sZ(E,n),j=[...D,...y],F="raw"!==f?[]:C,T=hZ(b,d,M,x);return{transform:[...null!==(r=l.transform)&&void 0!==r?r:[],...$,...A,...0===j.length?[]:[{aggregate:j,groupby:F}],...v],groupby:F,continuousAxisChannelDef:d,continuousAxis:g,encodingWithoutContinuousAxis:M,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:T}}function jZ(e,t,n){return KH(e)+" "+n+" "+t}const FZ="errorband",TZ=new rZ(FZ,NZ);function NZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:uZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=MZ(e,FZ,t),u=o,c=mZ(u,i,r,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),p),{aria:!1})):u.interpolate?DY(SY("interpolate")):u.tension&&DY(SY("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:l})]})}const RZ={};function PZ(e,t,n){const r=new rZ(e,t);RZ[e]={normalizer:r,parts:n}}PZ(wZ,OZ,["box","median","outliers","rule","ticks"]),PZ($Z,DZ,["ticks","rule"]),PZ(FZ,NZ,["band","borders"]);const zZ=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],BZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},IZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},LZ=VH(BZ),qZ=VH(IZ),UZ=VH({header:1,headerRow:1,headerColumn:1,headerFacet:1}),VZ=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var WZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function HZ(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=WZ(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const GZ="_vgsid_",XZ={single:{on:"click",fields:[GZ],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[GZ],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function YZ(e){return!(!e||"legend"!==e&&!e.legend)}function JZ(e){return YZ(e)&&zu(e)}function KZ(e){return"concat"in e}function QZ(e){return"vconcat"in e}function ZZ(e){return"hconcat"in e}function e0(e){return zu(e)&&void 0!==e.step}function t0(e){return e.view||e.width||e.height}const n0=VH({align:1,bounds:1,center:1,columns:1,spacing:1});var r0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function i0(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function a0(e,t){const n=o0(e,t);return e0(n)?n.step:s0}function o0(e,t){var n;return aG(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const s0=20,l0={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:s0},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:bK,circle:{},geoshape:{},image:{},line:{},point:{},rect:xK,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:XZ,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},u0=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],c0={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},f0={blue:u0[0],orange:u0[1],red:u0[2],teal:u0[3],green:u0[4],yellow:u0[5],purple:u0[6],pink:u0[7],brown:u0[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function d0(e){const t=VH(e||{}),n={};for(const r of t){const t=e[r];n[r]=hG(t)?LQ(t):qQ(t)}return n}const h0=[...yK,...bG,...UZ,"background","padding","legend","lineBreak","scale","style","title","view"];function p0(e={}){const{color:t,font:n,fontSize:r}=e,i=r0(e,["color","font","fontSize"]),a=Iu({},l0,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:zu(e)?Object.assign(Object.assign({},f0),e):f0}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:zu(e)?Object.assign(Object.assign({},c0),e):c0}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=DH(a,h0);for(const e of["background","lineBreak","padding"])a[e]&&(o[e]=qQ(a[e]));for(const e of yK)a[e]&&(o[e]=YJ(a[e]));for(const e of bG)a[e]&&(o[e]=d0(a[e]));for(const e of UZ)a[e]&&(o[e]=YJ(a[e]));return a.legend&&(o.legend=YJ(a.legend)),a.scale&&(o.scale=YJ(a.scale)),a.style&&(o.style=function(e){const t=VH(e),n={};for(const r of t)n[r]=d0(e[r]);return n}(a.style)),a.title&&(o.title=YJ(a.title)),a.view&&(o.view=YJ(a.view)),o}const m0=["view",...hK],g0=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],y0=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function v0(e){e=$H(e);for(const t of g0)delete e[t];if(e.axis)for(const t in e.axis)hG(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of zZ)delete e.legend[t];if(e.mark){for(const t of gK)delete e.mark[t];e.mark.tooltip&&zu(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(HZ(e.params)),delete e.params);for(const t of m0){for(const n of gK)delete e[t][n];const n=y0[t];if(n)for(const r of n)delete e[t][r];b0(e,t)}for(const t of VH(RZ))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=zQ(e.title);UH(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));UH(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));UH(r)?delete e.title:e.title=r}(e);for(const t in e)zu(e[t])&&UH(e[t])&&delete e[t];return UH(e)?void 0:e}function b0(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);UH(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function x0(e){return"layer"in e}var w0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const _0={zero:1,center:1,normalize:1};const k0=new Set([KJ,ZJ,QJ,iK,nK,lK,uK,tK,aK,oK]),O0=new Set([ZJ,QJ,KJ]);function S0(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(rQ(a)&&rQ(o))if("quantitative"===iQ(a)&&"quantitative"===iQ(o)){if(a.stack)return t;if(o.stack)return i;const e=rQ(a)&&!!a.aggregate;if(e!==(rQ(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===iQ(a))return t;if("quantitative"===iQ(o))return i}else{if("quantitative"===iQ(a))return t;if("quantitative"===iQ(o))return i}}function E0(e,t,n={}){const r=pK(e)?e.type:e;if(!k0.has(r))return null;const i=S0(t,"x")||S0(t,"theta");if(!i)return null;const a=t[i],o=rQ(a)?gQ(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=rQ(l)?gQ(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=CX.reduce(((e,n)=>{if("tooltip"!==n&&aZ(t,n)){const r=t[n];for(const t of lc(r)){const r=EQ(t);if(r.aggregate)continue;const i=gQ(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e}),[]);let f;if(void 0!==a.stack?f=Ac(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&O0.has(r)&&(f="zero"),!f||!(f in _0))return null;var d;if(oZ(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==yJ){if(n.disallowNonLinearStack)return null;DY(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return lQ(t[$X(i)])?(void 0!==a.stack&&DY(`Cannot stack "${d=i}" if there is already "${d}2".`),null):(rQ(a)&&a.aggregate&&!FH($G,a.aggregate)&&DY(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&fK(r),stackBy:c,offset:f})}var $0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function A0(e){const t=$0(e,["point","line"]);return VH(t).length>1?t:t.type}function D0(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:DH(e[t],["point","line"])}));return e}function C0(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?zu(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?zu(t.point)?t.point:{}:void 0}function M0(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class j0{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(nZ(e)){const{mark:n,encoding:r}=e,i=pK(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!C0(i,t[i.type],r);case"area":return!!C0(i,t[i.type],r)||!!M0(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=$0(e,["selection","projection","mark","encoding"]),u=uZ(s,r),c=pK(o)?o:{type:o},f=C0(c,r[c.type],u),d="area"===c.type&&M0(c,r[c.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:A0(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:DH(u,["shape"])})],p=E0(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},AH(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),f&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},AH(c,["clip","tooltip"])),f),encoding:m})),n(Object.assign(Object.assign({},l),{layer:h}),Object.assign(Object.assign({},t),{config:D0(r)}))}}var F0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class T0{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(nZ(e)&&e.encoding)for(const n of jX){const r=e.encoding[n];if(r&&lQ(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of jX){const i=AX(e),a=r[e];if(a&&lQ(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=F0(a,["scale"]),s=F0(t,["rangeStep"]);n[i]={step:t.rangeStep},DY('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},o),UH(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}var N0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function R0(e,t){return t?HK(e)?q0(e,t):B0(e,t):e}function P0(e,t){return t?q0(e,t):e}function z0(e,t,n){const r=t[e];return function(e){return e&&!Fc(e)&&"repeat"in e}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void DY(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t}function B0(e,t){if(void 0!==(e=z0("field",e,t))){if(null===e)return null;if(KK(e)&&VK(e.sort)){const n=z0("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function I0(e,t){if(rQ(e))return B0(e,t);{const n=z0("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function L0(e,t){if(!lQ(e)){if(nQ(e)){const n=I0(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return N0(e,["condition"])}return e}{const n=I0(e,t);if(n)return n;if(eQ(e))return{condition:e.condition}}}function q0(e,t){const n={};for(const r in e)if(_c(e,r)){const i=e[r];if(Pu(i))n[r]=i.map((e=>L0(e,t))).filter((e=>e));else{const e=L0(i,t);void 0!==e&&(n[r]=e)}}return n}class U0{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(nZ(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of kX){const n=t[SX(e)];if(t[e]&&(rQ(n)&&!XX(n.bin)||aQ(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return DY((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var V0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function W0({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...VH(e),...VH(t)]);for(const a of i){const i=t[a],o=e[a];if(lQ(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else nQ(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||cQ(o)||GY(o)||lQ(o)||Pu(o))&&(r[a]=o)}}else r=t;return!r||UH(r)?void 0:r}function H0(e){const{parentProjection:t,projection:n}=e;return t&&n&&DY(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${CH(t)} is overridden by a child projection ${CH(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function G0(e,t){void 0===t&&(t=p0(e.config));const n=function(e,t={}){return X0.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=nZ(e)||x0(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&(DY(eY("width")),r=void 0),"container"==i&&(DY(eY("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?Y0(n.autosize):{}),Y0(e.autosize));"fit"!==s.type||a||(DY(ZX),s.type="pad");"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&DY(tY("width"));"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&DY(tY("height"));if(EH(s,{type:"pad"}))return;return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const X0=new class extends class{map(e,t){return XK(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):ZZ(e)?this.mapHConcat(e,t):QZ(e)?this.mapVConcat(e,t):KZ(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(x0(e))return this.mapLayer(e,t);if(nZ(e))return this.mapUnit(e,t);throw new Error(QX(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=w0(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[_Z,AZ,TZ,new j0,new U0,new T0]}map(e,t){if(nZ(e)){const n=aZ(e.encoding,CG),r=aZ(e.encoding,MG),i=aZ(e.encoding,jG);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=P0(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(a,t.config))return e.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!Pu(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=V0(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map((e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+`child__layer_${XH(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=V0(e,["repeat","spec","data"]);!Pu(r)&&e.columns&&(e=DH(e,["columns"]),DY(lY("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!Pu(r)&&r.row||[l?l.row:null],f=!Pu(r)&&r.column||[l?l.column:null],d=Pu(r)&&r||[l?l.repeat:null];for(const e of d)for(const n of c)for(const a of f){const o={repeat:e,row:n,column:a,layer:l.layer},c=(i.name||"")+u+"child__"+(Pu(r)?`${XH(e)}`:(r.row?`row_${XH(n)}`:"")+(r.column?`column_${XH(a)}`:"")),f=this.map(i,Object.assign(Object.assign({},t),{repeater:o,repeaterPrefix:c}));f.name=c,s.push(DH(f,["data"]))}const h=Pu(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return HK(n)&&e.columns&&(e=DH(e,["columns"]),DY(lY("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=H0({parentProjection:a,projection:r}),l=W0({parentEncoding:i,encoding:P0(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=V0(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=V0(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),y=P0(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:y}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&DY(`Facet encoding dropped as ${(o=[...r?[CG]:[],...i?[MG]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const t={},s={};for(const r of[CG,MG]){const i=e[r];if(i){const e=V0(i,["align","center","spacing","columns"]);t[r]=e;for(const e of["align","center","spacing"])void 0!==i[e]&&(s[e]=null!==(n=s[e])&&void 0!==n?n:{},s[e][r]=i[e])}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:R0(V0(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var o}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=V0(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=V0(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:W0({parentEncoding:n,encoding:a,layer:!0}),parentProjection:H0({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function Y0(e){return Fc(e)?{type:e}:null!=e?e:{}}const J0=["background","padding"];function K0(e,t){const n={};for(const t of J0)e&&void 0!==e[t]&&(n[t]=qQ(e[t]));return t&&(n.params=e.params),n}class Q0{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Q0($H(this.explicit),$H(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return aG(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of VH(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function Z0(e){return{explicit:!0,value:e}}function e1(e){return{explicit:!1,value:e}}function t1(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:n1(t,n,r,i)}}function n1(e,t,n,r){return e.explicit&&t.explicit&&DY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${CH(n)} and ${CH(r)}). Using ${CH(n)}.`}(n,r,e.value,t.value)),e}function r1(e,t,n,r,i=n1){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:EH(e.value,t.value)?e:i(e,t,n,r)}class i1 extends Q0{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function a1(e){return"url"in e}function o1(e){return"values"in e}function s1(e){return"name"in e&&!a1(e)&&!o1(e)&&!l1(e)}function l1(e){return e&&(u1(e)||c1(e)||f1(e))}function u1(e){return"sequence"in e}function c1(e){return"sphere"in e}function f1(e){return"graticule"in e}var d1;function h1(e){return"filter"in e}function p1(e){return void 0!==(null==e?void 0:e.stop)}function m1(e){return"lookup"in e}function g1(e){return"pivot"in e}function y1(e){return"density"in e}function v1(e){return"quantile"in e}function b1(e){return"regression"in e}function x1(e){return"loess"in e}function w1(e){return"sample"in e}function _1(e){return"window"in e}function k1(e){return"joinaggregate"in e}function O1(e){return"flatten"in e}function S1(e){return"calculate"in e}function E1(e){return"bin"in e}function $1(e){return"impute"in e}function A1(e){return"timeUnit"in e}function D1(e){return"aggregate"in e}function C1(e){return"stack"in e}function M1(e){return"fold"in e}function j1(e,t,n,r){const i=eQ(t)&&t.condition,a=r(t);if(i){return{[n]:[...lc(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?r3(e,t.selection):a3(e,t.test);return Object.assign({test:i},n)})),...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function F1(e,t="text"){const n=e.encoding[t];return j1(e,n,t,(t=>T1(t,e.config)))}function T1(e,t,n="datum"){if(e){if(cQ(e))return VQ(e.value);if(lQ(e)){const{format:r,formatType:i}=SQ(e);return MK({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function N1(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(Pu(o))return{tooltip:P1({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return j1(e,o,"tooltip",(e=>{const o=T1(e,i,s);if(o)return o;if(null===e)return;let l=XQ("tooltip",r,i);return!0===l&&(l={content:"encoding"}),Fc(l)?{value:l}:zu(l)?GY(l)?l:"encoding"===l.content?P1(n,a,i,t):{signal:s}:void 0}))}}function R1(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=SX(s),u=uQ(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=lc(u.title||OQ(u,n)).join(", ");let f;if(FX(s)){const r="x"===s?"x2":"y2",o=EQ(e[r]);if(XX(u.bin)&&o){const e=gQ(u,{expr:a}),t=gQ(o,{expr:a}),{format:s,formatType:l}=SQ(u);f=BK(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=SQ(u);f=MK({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}f=null!=f?f:T1(u,n,a).signal,o.push({channel:s,key:c,value:f})}cZ(e,((e,t)=>{rQ(e)?s(e,t):tQ(e)&&s(e.condition,t)}));const l={};for(const{channel:e,key:t,value:n}of o)i[e]||l[t]||(l[t]=n);return l}function P1(e,t,n,{reactiveGeom:r}={}){const i=R1(e,t,n,{reactiveGeom:r}),a=HH(i).map((([e,t])=>`"${e}": ${t}`));return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function z1(e){const{markDef:t,config:n}=e,r=XQ("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=XQ("ariaRoleDescription",n,r);if(null!=i)return{ariaRoleDescription:{value:i}};return t in KY?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return j1(e,a,"description",(t=>T1(t,e.config)));const o=XQ("description",n,r);if(null!=o)return{description:VQ(o)};if(!1===r.aria)return{};const s=R1(t,i,r);if(UH(s))return;return{description:{signal:HH(s).map((([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`)).join(" + ")}}}(e))}function B1(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;void 0===s&&(l=null!=l?l:XQ(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=VQ(l)));const u=i[e];return j1(t,u,null!=o?o:e,(n=>$K({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function I1(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:XQ("filled",o,l),f=FH(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(i=null!==(r=XQ(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:f,h=null!==(a=XQ(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:VQ(d)}:{}),h?{stroke:VQ(h)}:{});return o.color&&(c?o.fill:o.stroke)&&DY(hY("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),B1("color",e,{vgChannel:p,defaultValue:c?d:h})),B1("fill",e,{defaultValue:s.fill?d:void 0})),B1("stroke",e,{defaultValue:s.stroke?h:void 0}))}function L1(e,t){const n=t[function(e){switch(e){case FG:return"xOffset";case TG:return"yOffset";case NG:return"x2Offset";case RG:return"y2Offset";case BG:return"thetaOffset";case PG:return"radiusOffset";case IG:return"theta2Offset";case zG:return"radius2Offset"}}(e)];if(n)return n}function q1(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[$X(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=L1(e,o),p=U1({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!u&&FX(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(lQ(n)&&a&&t===a.fieldChannel){if(rQ(n)){const e=QK({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return EK({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return SK(n,i,{suffix:"end"},{offset:o})}return wK(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return m?{[r||e]:m}:void 0}function U1({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=SX(n),l=EX(n),u=XQ(n,a,o,{vgChannel:l});if(void 0!==u)return AK(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(FH([vJ,_J,kJ],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[AX(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(d1||(d1={}));const V1={left:"x",center:"xc",right:"x2"},W1={top:"y",middle:"yc",bottom:"y2"};function H1(e,t,n,r="middle"){if("radius"===e||"theta"===e)return EX(e);const i="x"===e?"align":"baseline",a=XQ(i,t,n);let o;return GY(a)?(DY(function(e){return`The ${e} for range marks cannot be an expression`}(i)),o=void 0):o=a,"x"===e?V1[o||("top"===r?"left":"center")]:W1[o||r]}function G1(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?X1(e,t,{defaultPos:n,defaultPos2:r}):q1(e,t,{defaultPos:n})}function X1(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=$X(e),s=AX(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=SX(n),u=AX(n),c=EX(n),f=r[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=L1(n in r||n in a?n:l,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){if(lQ(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0))return SK(t,a,{suffix:"start"},{offset:l});return wK({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return Y1(n,a)||Y1(n,{[n]:JQ(n,a,s.style),[u]:JQ(u,a,s.style)})||Y1(n,s[i])||Y1(n,s.mark)||{[c]:U1({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}(t,r,o),u=l[s]?H1(e,i,a):EX(e);return Object.assign(Object.assign({},q1(e,t,{defaultPos:n,vgChannel:u})),l)}function Y1(e,t){const n=AX(e),r=EX(e);return void 0!==t[r]?{[r]:AK(e,t[r])}:void 0!==t[e]?{[r]:AK(e,t[e])}:t[n]?{[n]:AK(e,t[n])}:void 0}function J1(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=$X(t),d=AX(t),h=l[t],p=l[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),v=u.orient,b=null!==(i=null!==(r=l[d])&&void 0!==r?r:l.size)&&void 0!==i?i:XQ("size",u,s,{vgChannel:d}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(rQ(h)&&(GX(h.bin)||XX(h.bin)||h.timeUnit&&!p)&&!b&&!BJ(g)){const n=QK({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=$X(n),f=EX(n),d=EX(c),h=L1(n,a);if(GX(e.bin)||e.timeUnit)return{[d]:Z1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:Q1(c,o,l,s,h),config:u}),[f]:Z1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:Q1(n,o,l,s,h),config:u})};if(XX(e.bin)){const r=SK(e,i,{},{offset:Q1(c,o,l,s,h)});if(rQ(t))return{[d]:r,[f]:SK(t,i,{},{offset:Q1(n,o,l,s,h)})};if(YX(e.bin)&&e.bin.step)return{[d]:r,[f]:{signal:`scale("${i}", ${gQ(e,{expr:"datum"})} + ${e.bin.step})`,offset:Q1(n,o,l,s,h)}}}return void DY(EY(c))}({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:y,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:FX(t)?XQ("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(lQ(h)&&BJ(g)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),f=r.getScaleComponent(n),d=AX(n),h=$X(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=XQ(p?"size":d,a,s,{vgChannel:d});let g;(o.size||void 0!==m)&&(p?g=B1("size",r,{vgChannel:d,defaultValue:m}):DY(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const y=null!==(i=lQ(t)?QK({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[d]:K1(e,d,c,f,s,y)};const v="band"!==(null==f?void 0:f.get("type"))||!("band"in g[d]),b=H1(n,a,s,v?"middle":"top"),x=L1(n,a),w=wK({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:x,defaultRef:U1({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-y)/2});if(d)return Object.assign({[b]:w},g);{const e=EX(h),t=g[d],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:Pu(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,h,t,e):X1(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function K1(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===$J){const e=r.get("range");return XY(e)&&Mc(e.step)?{value:e.step-2}:{value:s0-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=a0(i.view,t),s=aG(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function Q1(e,t,n,r,i){if(fX(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(GY(n)||GY(i)||GY(r)){const e=HQ(n),t=HQ(i),o=HQ(r);return{signal:(o?`${o} + `:"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function Z1({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return _K({fieldDef:t,channel:e,markDef:r,ref:EK({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const e2=new Set(["aria"]);function t2(e,t){const{fill:n,stroke:r}="include"===t.color?I1(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return JY.reduce(((n,r)=>(e2.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=VQ(e[r])),n)),{})}(e.markDef,t)),n2(e,"fill",n)),n2(e,"stroke",r)),B1("opacity",e)),B1("fillOpacity",e)),B1("strokeOpacity",e)),B1("strokeWidth",e)),B1("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!fK(n)&&cQ(r)?j1(e,r,"zindex",(e=>VQ(e.value))):{}}(e)),N1(e)),F1(e,"href")),z1(e))}function n2(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===XQ("invalid",a,r)&&n&&!fK(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&IJ(i)&&(t[a]=!0)}return t}),{}),i=VH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>OK(e,t))).join(` ${e} `)}return}(e,{invalid:!0,channels:IX});if(r)return{[t]:[{test:r,value:null},...lc(n)]}}return n?{[t]:n}:{}}function r2(e){const{config:t,markDef:n}=e;if(XQ("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&IJ(i)&&(t[a]=!0)}return t}),{}),i=VH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>OK(e,t))).join(` ${e} `)}return}(e,{channels:jX});if(t)return{defined:{signal:t}}}return{}}function i2(e,t){if(void 0!==t)return{[e]:VQ(t)}}const a2="voronoi",o2={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(a2)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(fK(a))return DY(`The "nearest" transform is not supported for ${a} marks.`),n;const o={name:e.getName(a2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},N1(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(a2)>=0&&(l=!0)})),l||n.splice(s+1,0,o),n}};class s2{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?DY("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class l2 extends s2{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${sG()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var u2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class c2 extends s2{constructor(e,t){super(e),this.formula=t}clone(){return new c2(null,$H(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,o=P4(t)?t.encoding[$X(r)]:void 0,s=P4(t)&&ZK(r,n,o,t.stack,t.markDef,t.config);if(a){const t=gQ(n,{forAs:!0});e[MH({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return UH(n)?null:new c2(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=u2(n,["timeUnit"]),a=HY(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new c2(e,{[MH(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of HH(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(WH(this.formula).map((e=>e.as)))}dependentFields(){return new Set(WH(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${MH(this.formula)}`}assemble(){const e=[];for(const t of WH(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=HY(i),{unit:o,utc:s}=a,l=u2(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:tG(n),type:"timeunit"},o?{units:qY(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return e}}var f2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const d2="_tuple_fields";class h2{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const p2={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!YZ(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=o2.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var l,u;const c=XH(`${r}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:F2(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Lc(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+W2))[0],o=r+d2,s=i.items.map((e=>XH(`${r}_${e.field}`))),l=s.map((e=>`${e} !== null`)).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},m2="_toggle",g2={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+m2,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+W2,r=t.name+m2;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${J2(e)}}, `)+`${r} ? ${n} : null`}},y2={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=Fc(n.clear)?_q(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(p2.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===XH(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));if(r(t,"[0, 0]"),-1===t){r(n.findIndex((t=>t.name===e.signals.data)),"null")}}else{let e=n.findIndex((e=>e.name===t.name+W2));r(e,"null"),g2.has(t)&&(e=n.findIndex((e=>e.name===t.name+m2)),r(e,"false"))}return n}},v2={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!LX(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!IJ(o)){DY("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:t.name,field:r.field};a.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||x2(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf(G2)>=0)i.update=`{${r.map((e=>`${Lc(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${Lc(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!x2(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function b2(e,t){return`domain(${Lc(e.scaleName(t))})`}function x2(e){var t;return e.parent&&I4(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:x2(e.parent.parent))}const w2={has:e=>{const t="global"===e.resolve&&e.bind&&YZ(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==GZ;return t&&!n&&DY("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=lc(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=JZ(t.bind)?t.bind.legend:"click",o=Fc(a)?_q(a,"view"):lc(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=JZ(t.bind)&&t.bind.legend,a=e=>t=>{const n=$H(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const o=`${XH(e.field)}_legend`,s=`${r}_${o}`;if(0===n.filter((e=>e.name===s)).length){const e=i.merge.map(a(`${o}_symbols`)).concat(i.merge.map(a(`${o}_labels`))).concat(i.merge.map(a(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+W2)),o=r+d2,s=i.items.filter((e=>e.hasLegend)).map((e=>XH(`${r}_${XH(e.field)}_legend`))),l=`${s.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map((e=>({signal:e}))),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find((e=>e.name===r+m2)),c=JZ(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}};const _2="_translate_anchor",k2="_translate_delta",O2={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=v2.has(t),a=r+_2,{x:o,y:s}=t.project.hasChannel;let l=_q(t.translate,"scope");return i||(l=l.map((e=>(e.between[0].markname=r+P2,e)))),n.push({name:a,value:{},on:[{events:l.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?b2(e,FG):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?b2(e,TG):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+k2,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&S2(e,t,o,"width",n),void 0!==s&&S2(e,t,s,"height",n),n}};function S2(e,t,n,r,i){var a;const o=t.name,s=o+_2,l=o+k2,u=n.channel,c=v2.has(t),f=i.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],d=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(u),p=h.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===FG?"-":""}${l}.${u} / `+(c?`${d}`:`span(${m})`)}`+(c&&"pow"===p?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${d})`})}const E2="_zoom_anchor",$2="_zoom_delta",A2={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=v2.has(t),a=r+$2,{x:o,y:s}=t.project.hasChannel,l=Lc(e.scaleName(FG)),u=Lc(e.scaleName(TG));let c=_q(t.zoom,"scope");return i||(c=c.map((e=>(e.markname=r+P2,e)))),n.push({name:r+E2,on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&D2(e,t,o,"width",n),void 0!==s&&D2(e,t,s,"height",n),n}};function D2(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=v2.has(t),u=i.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?b2(e,s):u.name,p=o+$2,m=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${h}, ${`${o}${E2}.${s}`}, ${p}`+(l&&"pow"===d?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const C2=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new h2,l={},u={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=XH(`${o}_${n}`);for(let e=1;c.has(r);e++)r=XH(`${o}_${n}_${e}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of lc(n.init))for(const r of VH(e))wX[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?(DY('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),s.items.push(t),s.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){DY(aY(r,n.aggregate));continue}if(!i){DY(iY(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};u[MH(t)]=t}if(!l[i]){let a="E";if("interval"===t.type){IJ(e.getScaleComponent(r).get("type"))&&(a="R")}else n.bin&&(a="R-RE");const o={field:i,channel:r,type:a};o.signals=Object.assign(Object.assign({},f(o,"data")),f(o,"visual")),s.items.push(l[i]=o),s.hasField[i]=s.hasChannel[r]=l[i]}}else DY(iY(r))}if(n.init){const e=e=>s.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=lc(n.init);t.init=r.map(e)}}UH(u)||(s.timeUnit=new c2(null,u))},signals:(e,t,n)=>{const r=t.name+d2;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const t=f2(e,["signals","hasLegend"]);return t.field=tG(t.field),t}))})}},g2,v2,w2,O2,A2,p2,o2,y2];function M2(e,t){for(const n of C2)n.has(e)&&t(n)}var j2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function F2(e,t=!0,n=Cu){if(Pu(e)){const r=e.map((e=>F2(e,t,n)));return t?`[${r.join(", ")}]`:r}return CY(e)?n(t?RY(e):function(e){const t=NY(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function T2(e,t){return Y2(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,M2(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function N2(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}var R2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const P2="_brush",z2="_scale_trigger",B2={signals:(e,t)=>{const n=t.name,r=n+d2,i=v2.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${Lc(n+P2)}`;I2(t,((t,n)=>{var r;const i=lc(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==FG&&i!==TG)return void DY("Interval selections only support x and y encoding channels.");const l=t.init?t.init[r]:null,u=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=v2.has(t),l=Lc(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,f=e=>`scale(${l}, ${e})`,d=e.getSizeSignalRef(i===FG?"width":"height").signal,h=`${i}(unit)`,p=I2(t,((e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]));return p.push({events:{signal:t.name+z2},update:IJ(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:F2(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:F2(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,l),c=n.signals.data,f=n.signals.visual,d=Lc(e.scaleName(i)),h=IJ(e.getScaleComponent(i).get("type"))?"+":"";a.push(...u),o.push(c),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${c}) || (${h}invert(${d}, ${f})[0] === ${h}${c}[0] && ${h}invert(${d}, ${f})[1] === ${h}${c}[1]))`})})),i||a.push({name:n+z2,value:{},on:[{events:s.map((e=>({scale:e.scaleName}))),update:s.map((e=>e.expr)).join(" && ")+` ? ${n+z2} : {}`}]});const l=t.init,u=`unit: ${J2(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+W2},l?{init:`{${u}: ${F2(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+W2+", "+("global"===t.resolve?"true":`{unit: ${J2(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${Lc(t.name+V2)})`;if(v2.has(t))return n;const u={x:void 0!==i?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of VH(u))u[t]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${J2(e)}`},u[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=R2(c,["fill","fillOpacity","cursor"]),m=VH(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:r+P2+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:r+P2,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function I2(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):(DY(`${n} is not an ordered event stream for interval selections.`),e)),[])}function L2(e,t){const n=t.name,r=n+d2,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${Lc(e.vgField(t.channel,{}))}], ${a}[${Lc(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${Lc(t.field)}]`})).join(", "),s=`unit: ${J2(e)}, fields: ${r}, values`,l=t.events;return[{name:n+W2,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const q2={signals:L2,modifyExpr:(e,t)=>t.name+W2+", "+("global"===t.resolve?"null":`{unit: ${J2(e)}}`)},U2={signals:L2,modifyExpr:(e,t)=>t.name+W2+", "+("global"===t.resolve?"true":`{unit: ${J2(e)}}`)},V2="_store",W2="_tuple",H2="_modify",G2="vlSelectionResolve",X2={single:U2,multi:q2,interval:B2};function Y2(e,t){const n=e.component.selection;if(n)for(const e of WH(n)){if(!0===t(e,X2[e.type]))break}}function J2(e,{escape:t}={escape:!0}){let n=t?Lc(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!z4(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of yX)e[t]&&(n+=` + '__facet_${t}_' + (facet[${Lc(r.vgField(t))}])`)}return n}function K2(e){let t=!1;return Y2(e,(e=>{t=t||e.project.items.some((e=>e.field===GZ))})),t}function Q2(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...Q2(e.object)),t.push(...Q2(e.property))),t)}function Z2(e){return"MemberExpression"===e.object.type?Z2(e.object):"datum"===e.object.name}function e3(e){const t=_I(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&Z2(e)&&n.add(Q2(e).slice(1).join("."))})),n}class t3 extends s2{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=a3(this.model,this.filter,this),this._dependentFields=e3(this.expr)}clone(){return new t3(null,this.model,$H(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var n3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function r3(e,t,n,r="datum"){const i=[];const a=YH(t,(function(t){const a=XH(t),o=e.getSelectionComponent(a,t),s=Lc(a+V2);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${Lc(o.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function i3(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,DY((i.length?"Multiple ":"No ")+`matching ${Lc(n)} encoding found for selection ${Lc(t.selection)}. `+`Using "field": ${Lc(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&DY(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${Lc(r)}.`);return`${e.name}[${Lc(r)}]`}function a3(e,t,n){return YH(t,(t=>Fc(t)?t:function(e){return null==e?void 0:e.selection}(t)?r3(e,t.selection,n):lJ(t)))}var o3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function s3(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function l3(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=o3(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in h){const n=mG[e],r=h[e];if(n&&n!==t&&"both"!==n)delete h[e];else if(hG(r)){const{condition:t}=r,n=o3(r,["condition"]),i=lc(t),a=dG[e];if(a){const{vgProp:t,part:r}=a;s3(h,r,t,[...i.map((e=>{const{test:t}=e,n=o3(e,["test"]);return Object.assign({test:a3(null,t)},n)})),n]),delete h[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=o3(e,["test"]);return`${a3(null,t)} ? ${WQ(n)} : `})).join("")+WQ(n)};h[e]=t}}else if(GY(r)){const t=dG[e];if(t){const{vgProp:n,part:i}=t;s3(h,i,n,r),delete h[e]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),UH(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:aG(d,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=h.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&GY(h.encode.labels.update.text)&&(e=nG(c,"datum.label",h.encode.labels.update.text.signal)),s3(h,"labels","text",{signal:e})}if(null===h.labelAlign&&delete h.labelAlign,h.encode){for(const t of pG)e.hasAxisPart(t)||delete h.encode[t];UH(h.encode)&&delete h.encode}const t=function(e,t){if(e)return Pu(e)&&!BQ(e)?e.map((e=>OQ(e,t))).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),h),!1===n.aria?{aria:!1}:{}),{zindex:aG(d,0)})}}}function u3(e){const{axes:t}=e.component,n=[];for(const r of jX)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function c3(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...VH(i),...VH(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${HQ(i[t])} : ${HQ(a[t])}`};return s}return t[e]}))])}function f3(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:function(e){return e in NJ}(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=GY(n)?"axisOrient":"axis"+KH(n),s=[...i,...i.map((e=>a+e.substr(4)))],l=["axis",o,a];return{vlOnlyAxisConfig:c3(s,r,e,n),vgAxisConfig:c3(l,r,e,n),axisConfigStyle:d3([...l,...s],r)}}function d3(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=lc(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function h3(e,t,n,r={}){var i;const a=KQ(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const p3={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return TK(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return NK(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!rQ(e)||!XX(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!BJ(e)&&rQ(t)&&!GX(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||y3(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||g3(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&FH(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!zu(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy";return}(t.type,n,rQ(t)&&!!t.timeUnit,rQ(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!BJ(t)&&"log"!==t){if(rQ(e)){if(GX(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&FH(["month","hours","day","quarter"],null===(i=HY(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=v3(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",o=t.fieldDef(a);return ZQ(i?[JK(i)]:[],rQ(o)?[JK(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(Pu(n))return NQ(t,n);if(GY(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){if("rect"===e&&yQ(t))return 1;return 0}(n,t)}};function m3(e){return`(((${e.signal} % 360) + 360) % 360)`}function g3(e,t,n,r){if(void 0!==e){if("x"===n){if(GY(e)){const n=m3(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${GY(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(GY(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(GY(e)){const n=m3(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${GY(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(GY(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function y3(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(GY(e)){const n=m3(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${GY(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(GY(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${n} "${a}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function v3(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?eZ(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}class b3 extends s2{constructor(e,t){super(e),this.transform=t,this._dependentFields=e3(this.transform.calculate)}clone(){return new b3(null,$H(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(fQ(t)&&WK(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map(((e,t)=>`${lJ({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new b3(e,{calculate:o,as:x3(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${MH(this.transform)}`}}function x3(e,t,n){return gQ(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function w3(e,t){return FH(["top","bottom"],t)?"column":FH(["left","right"],t)||"row"===e?"row":"column"}function _3(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return aG((t||{})[e],i[e],n.header[e])}function k3(e,t,n,r){const i={};for(const a of e){const e=_3(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const O3=["row","column"],S3=["header","footer"];function E3(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=k3(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=w3(t,s),u=cG(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),A3(u,l)),$3(l,u,a)),N3(r,i,t,LZ,BZ))}}function $3(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=y3(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function A3(e,t){const n=g3(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function D3(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of S3)if(n[i])for(const a of n[i]){const o=j3(e,t,i,n,a);null!=o&&r.push(o)}return r}function C3(e,t){var n;const{sort:r}=e;return VK(r)?{field:gQ(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:Pu(r)?{field:x3(e,t,{expr:"datum"}),order:"ascending"}:{field:gQ(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function M3(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=k3(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=MK({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=w3(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?nG(nG(l,"datum.label",u),"datum.value",gQ(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),A3(a,c)),$3(c,a,o)),N3(n,e,t,qZ,IZ))}function j3(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=k3(["labelOrient"],o.header,s,t);("row"===t&&!FH(["top","bottom"],e)||"column"===t&&!FH(["left","right"],e))&&(a=M3(o,t,s))}const l=z4(e)&&!HK(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:C3(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const F3={column:{start:0,end:1},row:{start:1,end:0}};function T3(e,t){return F3[t][e]}function N3(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=_3(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function R3(e){return[...P3(e,"width"),...P3(e,"height"),...P3(e,"childWidth"),...P3(e,"childHeight")]}function P3(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(BJ(r)&&XY(a)){const r=e.scaleName(n);if(z4(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[z3(r,a)]}return[z3(r,a),{name:i,update:B3(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${i0(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function z3(e,t){return{name:e+"_step",value:t.step}}function B3(e,t,n){const r=t.get("type"),i=t.get("padding"),a=aG(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${HQ(o)}, ${HQ(a)}) * ${e}_step`}function I3(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function L3(e,t){return VH(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),j1(t,i,r,(e=>VQ(e.value))))}),{})}function q3(e,t){if(I4(t)||z4(t))return"shared";if(B4(t))return FX(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function U3(e,t){const n=e.scale[t],r=FX(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&DY(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const V3=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),W3=VH(V3);class H3 extends Q0{}const G3={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,f,d,h;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:y}=n,v=p.filled&&"trail"!==y;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=YQ(r,t.markDef,t.config);void 0!==n&&(e[r]=VQ(n))}return e}({},n,mK)),I1(n,{filled:v}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,k=void 0===x?null!==(u=X3(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||v&&r===WG)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=VQ(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=VQ(null!=k?k:1));else if(Pu(b.fill)){const e=null!==(h=null!==(d=Y3(null!==(f=m.fill)&&void 0!==f?f:m.color))&&void 0!==d?d:p.fill)&&void 0!==h?h:v&&p.color;e&&(b.fill=VQ(e))}if(b.stroke)if("stroke"===r||!v&&r===WG)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(Pu(b.stroke)){const e=aG(Y3(m.stroke||m.color),p.stroke,v?p.color:void 0);e&&(b.stroke={value:e})}if(r!==KG){const e=rQ(t)&&K3(n,i,t);e?b.opacity=[Object.assign({test:e},VQ(null!=k?k:1)),VQ(g.legend.unselectedOpacity)]:k&&(b.opacity=VQ(k))}return b=Object.assign(Object.assign({},b),e),UH(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?X3(s.opacity)||o.opacity:void 0;u&&(l.opacity=VQ(u));return l=Object.assign(Object.assign({},l),e),UH(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=rQ(t)?K3(n,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=DK(c)?FK({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return UH(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function X3(e){return J3(e,((e,t)=>Math.max(e,t.value)))}function Y3(e){return J3(e,((e,t)=>aG(e,t.value)))}function J3(e,t){return function(e){const t=e&&e.condition;return!!t&&(Pu(t)||cQ(t))}(e)?lc(e.condition).reduce(t,e.value):cQ(e)?e.value:void 0}function K3(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=Lc(n.field);return r.map((e=>`(!length(data(${Lc(XH(e)+V2)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const Q3={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return TK(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return NK(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(LJ(i))return"horizontal"===n?"top"===r||"bottom"===r?t5(t,"width",o,a):o:t5(t,"height",l,s);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(FH(["quantile","threshold","log","symlog"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=Y3(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>_Q(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(mX(n)&&LJ(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(Pu(n))return NQ(t,n);if(GY(n))return n;return}(t,e)};function Z3(e){const{legend:t}=e;return aG(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(mX(e)){if(FH(["quarter","month","day"],t))return"symbol";if(LJ(n))return"gradient"}return"symbol"}(e))}function e5({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function t5(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function n5(e){const t=P4(e)?function(e){const{encoding:t}=e,n={};for(const r of[WG,...VZ]){const i=$Q(t[r]);i&&e.getScaleComponent(r)&&(r===XG&&rQ(i)&&i.type===mJ||(n[r]=i5(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){n5(r);for(const i of VH(r.component.legends))n.legend[i]=U3(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=a5(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of VH(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function r5(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function i5(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new H3({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;Y2(e,(e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&w2.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}}))}(e,t,c);const f=void 0!==a?!a:u.disable;if(c.set("disable",f,void 0!==a),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=$Q(s[t]),p=rQ(h)?null===(n=HY(h.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=Z3({legend:a,channel:t,timeUnit:p,scaleType:d}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:m,legendType:g,direction:e5({legend:a,legendType:g,orient:m,legendConfig:u})};for(const n of W3){if("gradient"===g&&n.startsWith("symbol")||"symbol"===g&&n.startsWith("gradient"))continue;const r=n in Q3?Q3[n](y):a[n];if(void 0!==r){const i=r5(r,n,a,e.fieldDef(t));(i||void 0===l.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=L3(null!==(i=v[t])&&void 0!==i?i:{},e),r=t in G3?G3[t](n,w):n;void 0===r||UH(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&rQ(h)?{name:`${XH(h.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return UH(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function a5(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const n of W3){const r=r1(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return o5(e,t);case"title":return tZ(e,t);case"type":return l=!0,e1("symbol")}return n1(e,t,n,"legend")}));e.setWithExplicit(n,r)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&JH(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&JH(e.explicit,["encode","gradient"])),e}function o5(e,t){return"circle"===t.value?t:e}var s5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function l5(e){const t=e.component.legends,n={};for(const r of VH(t)){const i=e.getScaleComponent(r),a=CH(i.get("domains"));if(n[a])for(const e of n[a]){a5(e,t[r])||n[a].push(t[r])}else n[a]=[t[r].clone()]}return WH(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=s5(a,["disable","labelExpr","selections"]);if(o)return;!1===t.aria&&null==u.aria&&(u.aria=!1);if(null===(n=u.encode)||void 0===n?void 0:n.symbols){const e=u.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||u.stroke||(e.stroke={value:"transparent"});for(const t of VZ)u[t]&&delete e[t]}u.title||delete u.title;if(void 0!==s){let e=s;(null===(i=null===(r=u.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&GY(u.encode.labels.update.text)&&(e=nG(s,"datum.label",u.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}(u,"labels","text",{signal:e})}return u}(t,e.config))).filter((e=>void 0!==e))}function u5(e){return I4(e)||B4(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),c5(e))}(e):c5(e)}function c5(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=GY(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return FH(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const f5=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class d5 extends Q0{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function h5(e){e.component.projection=P4(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[qG,LG],[VG,UG]])($Q(n[r[0]])||$Q(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});e.channelHasField(XG)&&e.typedFieldDef(XG).type===mJ&&t.push({signal:e.getName(`geojson_${t.length}`)});0===t.length&&t.push(e.requestDataName(d1.Main));return t}(e):void 0;return new d5(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)h5(t);const n=NH(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=NH(f5,(n=>!_c(e.explicit,n)&&!_c(t.explicit,n)||!(!_c(e.explicit,n)||!_c(t.explicit,n)||CH(e.get(n))!==CH(t.get(n)))));if(CH(e.size)===CH(t.size)){if(n)return e;if(CH(e.explicit)===CH({}))return t;if(CH(t.explicit)===CH({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new d5(n,t.specifiedProjection,t.size,$H(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}return}(e)}var p5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function m5(e,t){return`${HX(e)}_${t}`}function g5(e,t,n){var r;const i=m5(null!==(r=MQ(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function y5(e,t,n){let r,i;r=function(e){return"as"in e}(e)?Fc(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[gQ(e,{forAs:!0}),gQ(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},MQ(t,void 0)),o=m5(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,o);if(JX(a.extent)){const e=a.extent,t=e.selection;i=i3(n.getSelectionComponent(XH(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class v5 extends s2{constructor(e,t){super(e),this.bins=t}clone(){return new v5(null,$H(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(uQ(n)&&GX(n.bin)){const{key:i,binComponent:a}=y5(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(RQ(t,n)){const o=P4(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=gQ(t,{expr:"datum"}),l=gQ(t,{expr:"datum",binSuffix:"end"});return{formulaAs:gQ(t,{binSuffix:"range",forAs:!0}),formula:BK(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return UH(n)?null:new v5(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=y5(t,t.bin,n);return new v5(e,{[r]:i})}merge(e,t){for(const n of VH(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=zH([...this.bins[n].as,...e.bins[n].as],MH)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(WH(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(WH(this.bins).map((e=>e.field)))}hash(){return`Bin ${MH(this.bins)}`}assemble(){return WH(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=p5(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:tG(e.field),as:n,signal:e.signal},JX(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:tG(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:gQ({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}function b5(e,t,n,r){const i=P4(r)?r.encoding[$X(t)]:void 0;if(uQ(n)&&P4(r)&&ZK(t,n,i,r.stack,r.markDef,r.config))e.add(gQ(n,{})),e.add(gQ(n,{suffix:"end"})),n.bin&&RQ(n,t)&&e.add(gQ(n,{binSuffix:"range"}));else if(function(e){return e in dX}(t)){const n=function(e){switch(e){case LG:return"y";case UG:return"y2";case qG:return"x";case VG:return"x2"}}(t);e.add(r.getName(n))}else e.add(gQ(n));return e}class x5 extends s2{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new x5(null,new Set(this.dimensions),$H(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([gQ(e,{forAs:!0})]);else{if(_G(u)||kG(u)){const e=_G(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([gQ({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([gQ(e,{forAs:!0})]);LX(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([gQ({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([gQ({field:c,aggregate:"max"},{forAs:!0})]))}else b5(i,n,e,t)})),i.size+VH(r).length===0?null:new x5(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([a||gQ(e,{forAs:!0})])):(o[i]=null!==(r=o[i])&&void 0!==r?r:{},o[i][t]=new Set([a||gQ(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+VH(o).length===0?null:new x5(e,a,o)}merge(e){return BH(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of VH(t)){const i=t[r];for(const t of VH(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){AY.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...VH(this.measures)])}producedFields(){const e=new Set;for(const t of VH(this.measures))for(const n of VH(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${MH({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of VH(this.measures))for(const i of VH(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:tG(r));return{type:"aggregate",groupby:[...this.dimensions].map(tG),ops:e,fields:t,as:n}}}class w5 extends s2{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of yX){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[gQ(n),...GX(r)?[gQ(n,{binSuffix:"end"})]:[]]},VK(i)?{sortField:i}:Pu(i)?{sortIndexField:x3(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of yX)this[t]&&(e+=` ${t.charAt(0)}:${MH(this[t])}`);return e}get fields(){var e;const t=[];for(const n of yX)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of yX)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of jX){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(BJ(r)&&XY(i)){const n=p4(m4(this.childModel,t));n?e[t]=n:DY(rY(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=IK,field:t}=s;i.push(t),a.push(e),o.push(gQ(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const e of O3){for(const r of S3){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[e]=!0;break}}if(o[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const e of[MG,CG])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function _5(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function k5(e){const t={};return OH(e.filter,(e=>{var n;if(oJ(e)){let r=null;ZY(e)?r=qQ(e.equal):tJ(e)?r=qQ(e.lte):eJ(e)?r=qQ(e.lt):nJ(e)?r=qQ(e.gt):rJ(e)?r=qQ(e.gte):iJ(e)?r=e.range[0]:aJ(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(CY(r)?t[e.field]="date":Mc(r)?t[e.field]="number":Fc(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}function O5(e){const t={};function n(e){var n;FQ(e)?t[e.field]="date":"quantitative"===e.type&&(Fc(n=e.aggregate)&&FH(["min","max"],n))?t[e.field]="number":iG(e.field)>1?e.field in t||(t[e.field]="flatten"):fQ(e)&&VK(e.sort)&&iG(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((P4(e)||z4(e))&&e.forEachFieldDef(((t,r)=>{if(uQ(t))n(t);else{const i=SX(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),P4(e)){const{mark:n,markDef:r,encoding:i}=e;if(fK(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];rQ(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class S5 extends s2{constructor(e,t){super(e),this._parse=t}clone(){return new S5(null,$H(this._parse))}hash(){return`Parse ${MH(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!l1(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of VH(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:DY(uY(e,n[e],t.value)))}for(const e of VH(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:DY(uY(e,t[e],n)))}const i=new Q0(t,n);r.copyAll(i);const a={};for(const e of VH(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===VH(a).length||r.parseNothing?null:new S5(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of VH(this._parse)){const n=this._parse[t];1===iG(t)&&(e[t]=n)}return e}producedFields(){return new Set(VH(this._parse))}dependentFields(){return new Set(VH(this._parse))}assembleTransforms(e=!1){return VH(this._parse).filter((t=>!e||iG(t)>1)).map((e=>{const t=function(e,t){const n=QH(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:"))return`timeParse(${n},'${_5(t.slice(5,t.length))}')`;if(0===t.indexOf("utc:"))return`utcParse(${n},'${_5(t.slice(4,t.length))}')`;return DY(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:rG(e)}})).filter((e=>null!==e))}}class E5 extends s2{clone(){return new E5(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([GZ])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:GZ}}}class $5 extends s2{constructor(e,t){super(e),this.params=t}clone(){return new $5(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${MH(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class A5 extends s2{constructor(e,t){super(e),this.params=t}clone(){return new A5(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${MH(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class D5 extends s2{constructor(e){let t;if(super(null),l1(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},DH(e.format,["parse"])):{}),o1(e))this._data={values:e.values};else if(a1(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];FH(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else c1(e)?this._data={values:[{type:"Sphere"}]}:(s1(e)||l1(e))&&(this._data={});this._generator=l1(e),e.name&&(this._name=e.name),t&&!UH(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var C5,M5=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},j5=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};function F5(e){return e instanceof D5||e instanceof $5||e instanceof A5}class T5{constructor(){C5.set(this,void 0),M5(this,C5,!1)}setModified(){M5(this,C5,!0)}get modifiedFlag(){return j5(this,C5)}}C5=new WeakMap;class N5 extends T5{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort(((e,t)=>t[1]-e[1]));for(const e of t)this.run(e[0]);return this.modifiedFlag}}class R5 extends T5{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class P5 extends R5{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of VH(n))n[t].length>1&&(this.setModified(),this.mergeNodes(e,n[t]))}}class z5 extends R5{constructor(e){super(),this.requiresSelectionId=e&&K2(e)}run(e){e instanceof E5&&(this.requiresSelectionId&&(F5(e.parent)||e.parent instanceof x5||e.parent instanceof S5)||(this.setModified(),e.remove()))}}class B5 extends T5{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof c2&&(n=e.producedFields(),IH(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class I5 extends R5{constructor(){super()}run(e){e instanceof l2&&!e.isRequired()&&(this.setModified(),e.remove())}}class L5 extends N5{run(e){if(!(F5(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof S5)if(e instanceof S5)this.setModified(),e.merge(t);else{if(qH(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class q5 extends N5{run(e){const t=[...e.children],n=e.children.filter((e=>e instanceof S5));if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of VH(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!UH(r)){this.setModified();const n=new S5(e,r);for(const i of t){if(i instanceof S5)for(const e of VH(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof S5&&0===VH(i.parse).length&&i.remove()}}}}}class U5 extends N5{run(e){e instanceof l2||e.numChildren()>0||e instanceof w5||e instanceof D5||(this.setModified(),e.remove())}}class V5 extends N5{run(e){const t=e.children.filter((e=>e instanceof c2)),n=t.pop();for(const e of t)this.setModified(),n.merge(e)}}class W5 extends N5{run(e){const t=e.children.filter((e=>e instanceof x5)),n={};for(const e of t){const t=MH(e.groupBy);t in n||(n[t]=[]),n[t].push(e)}for(const t of VH(n)){const r=n[t];if(r.length>1){const t=r.pop();for(const n of r)t.merge(n)&&(e.removeChild(n),n.parent=t,n.remove(),this.setModified())}}}}class H5 extends N5{constructor(e){super(),this.model=e}run(e){const t=!(F5(e)||e instanceof t3||e instanceof S5||e instanceof E5),n=[],r=[];for(const i of e.children)i instanceof v5&&(t&&!qH(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof v5?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class G5 extends N5{run(e){const t=[...e.children];if(!TH(t,(e=>e instanceof l2))||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof l2){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof l2))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class X5 extends s2{constructor(e,t){super(e),this.transform=t}clone(){return new X5(null,$H(this.transform))}addDimensions(e){this.transform.groupby=zH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:gQ(e)}hash(){return`JoinAggregateTransform ${MH(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class Y5 extends s2{constructor(e,t){super(e),this._stack=t}clone(){return new Y5(null,$H(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const e of t.sort)o.push(e.field),s.push(aG(e.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return Pu(e)&&e.every((e=>Fc(e)))&&e.length>1}(i)?i:Fc(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new Y5(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;if(i){l=EQ(r[i])}const u=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=gQ(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let f;return f=Pu(c)||rQ(c)?QQ(c):u.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new Y5(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${MH(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[gQ(e,{binSuffix:"mid"})]:[gQ(e,{}),gQ(e,{binSuffix:"end"})]:[gQ(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+gQ(n,{expr:"datum"})+`+${1-a}*`+gQ(n,{expr:"datum",binSuffix:"end"}),as:gQ(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:gQ(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class J5 extends s2{constructor(e,t){super(e),this.transform=t}clone(){return new J5(null,$H(this.transform))}addDimensions(e){this.transform.groupby=zH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:gQ(e)}hash(){return`WindowTransform ${MH(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>OG(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)s.push(t.field),l.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:u},void 0!==c?{ignorePeers:c}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function K5(e){if(e instanceof w5)if(1!==e.numChildren()||e.children[0]instanceof l2){const n=e.model.component.data.main;Q5(n);const r=(t=e,function e(n){if(!(n instanceof w5)){const r=n.clone();if(r instanceof l2){const e=Z5+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof x5||r instanceof Y5||r instanceof J5||r instanceof X5)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof x5||t instanceof Y5||t instanceof J5||t instanceof X5)&&t.addDimensions(e.fields),t.swapWithParent(),K5(e)}else e.children.map(K5);var t}function Q5(e){if(e instanceof l2&&e.type===d1.Main&&1===e.numChildren()){const t=e.children[0];t instanceof w5||(t.swapWithParent(),Q5(e))}}const Z5="scale_";function e4(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!e4(t.children))return!1}return!0}function t4(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function n4(e,t,n){let r=e.sources,i=!1;return i=t4(new I5,r)||i,i=t4(new z5(t),r)||i,r=r.filter((e=>e.numChildren()>0)),i=t4(new U5,r)||i,r=r.filter((e=>e.numChildren()>0)),n||(i=t4(new L5,r)||i,i=t4(new H5(t),r)||i,i=t4(new B5,r)||i,i=t4(new q5,r)||i,i=t4(new W5,r)||i,i=t4(new V5,r)||i,i=t4(new P5,r)||i,i=t4(new G5,r)||i),e.sources=r,i}class r4{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new r4((()=>e(t)))}}var i4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function a4(e){P4(e)?function(e){const t=e.component.scales;for(const n of VH(t)){const r=o4(e,n);if(t[n].setWithExplicit("domains",r),c4(e,n),e.component.data.isFaceted){let t=e;for(;!z4(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)YY(e)&&(e.data=Z5+e.data.replace(Z5,""))}}}(e):function(e){for(const t of e.children)a4(t);const t=e.component.scales;for(const n of VH(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):r1(r,e.getWithExplicit("domains"),"domains","scale",d4);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&DY(sY),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function o4(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=f4(t,n);if(!e)return void DY(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=f4(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&$Q(r.x2)?$Q(r.x)?r1(l4(n,i,e,"x"),l4(n,i,e,"x2"),"domain","scale",d4):l4(n,i,e,"x2"):"y"===t&&$Q(r.y2)?$Q(r.y)?r1(l4(n,i,e,"y"),l4(n,i,e,"y2"),"domain","scale",d4):l4(n,i,e,"y2"):l4(n,i,e,t)}function s4(e,t,n){var r;const i=null===(r=HY(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${TQ(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function l4(e,t,n,r){const{encoding:i}=n,a=$Q(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=l4(e,void 0,n,r),a=s4(t.unionWith,o,s);return Z0([...i.value,...a])}if(GY(t))return Z0([t]);if(t&&"unaggregated"!==t&&!UJ(t))return Z0(s4(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return e1([[0,1]]);const e=n.requestDataName(d1.Main);return e1([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=LX(r)&&rQ(a)?function(e,t,n){if(!BJ(n))return;const r=e.fieldDef(t),i=r.sort;if(WK(i))return{op:"min",field:x3(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(VK(i)){return u4(i,a&&!FH(o,i.field))}if(UK(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!FH(o,l);if(_G(s)||kG(s))return u4({field:gQ(r),order:n},u);if(OG(s)||!s)return u4({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(FH(["ascending",void 0],i))return!0}return}(n,r,e):void 0;if(aQ(a)){return e1(s4([a.datum],o,s))}const c=a;if("unaggregated"===t){const e=n.requestDataName(d1.Main),{field:t}=a;return e1([{data:e,field:gQ({field:t,aggregate:"min"})},{data:e,field:gQ({field:t,aggregate:"max"})}])}if(GX(c.bin)){if(BJ(e))return e1("bin-ordinal"===e?[]:[{data:GH(u)?n.requestDataName(d1.Main):n.requestDataName(d1.Raw),field:n.vgField(r,RQ(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&zu(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(GX(e)){const t=g5(n,c.field,e);return e1([new r4((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return e1([{data:n.requestDataName(d1.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&FH(["time","utc"],e)&&ZK(r,c,P4(n)?n.encoding[$X(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(d1.Main);return e1([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return e1(u?[{data:GH(u)?n.requestDataName(d1.Main):n.requestDataName(d1.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(d1.Main),field:n.vgField(r)}])}function u4(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":IK},r?{field:tG(r)}:{}),i?{order:i}:{})}function c4(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=UJ(i)&&i,s=YX(a)&&JX(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function f4(e,t){const{aggregate:n,type:r}=e;return n?Fc(n)&&!AG[n]?{valid:!1,reason:bY(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:xY(e)}:{valid:!0}:{valid:!1,reason:vY(e)}}function d4(e,t,n,r){return e.explicit&&t.explicit&&DY(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${CH(n)} and ${CH(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function h4(e){const t=zH(e.map((e=>{if(YY(e)){return i4(e,["sort"])}return e})),MH),n=zH(e.map((e=>{if(YY(e)){const t=e.sort;return void 0===t||GH(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),MH);if(0===t.length)return;if(1===t.length){const t=e[0];if(YY(t)&&n.length>0){let e=n[0];if(n.length>1)DY(kY),e=!0;else if(zu(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=zH(n.map((e=>GH(e)||!("op"in e)||Fc(e.op)&&e.op in wG?e:(DY(function(e){return`Dropping sort property ${CH(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),MH);let i;1===r.length?i=r[0]:r.length>1&&(DY(kY),i=!0);const a=zH(e.map((e=>YY(e)?e.data:null)),(e=>e));if(1===a.length&&null!==a[0]){return Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{})}return Object.assign({fields:t},i?{sort:i}:{})}function p4(e){if(YY(e)&&Fc(e.field))return e.field;if(function(e){return!Pu(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(YY(n)&&Fc(n.field))if(t){if(t!==n.field)return DY("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return DY("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!Pu(e)&&"fields"in e&&"data"in e}(e)){DY("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return Fc(t)?t:void 0}}function m4(e,t){return h4(e.component.scales[t].get("domains").map((t=>(YY(t)&&(t.data=e.lookupDataSource(t.data)),t))))}var g4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function y4(e){return I4(e)||B4(e)?e.children.reduce(((e,t)=>e.concat(y4(t))),v4(e)):v4(e)}function v4(e){return VH(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=i,f=g4(i,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,t,n,r){if(FX(n)){if(XY(e))return{step:{signal:t+"_step"}}}else if(zu(e)&&YY(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let h;s&&(h=function(e,t){const n=t.selection;return{signal:i3(e.getSelectionComponent(n,XH(n)),t)}}(e,s));const p=m4(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),void 0!==c?{reverse:c}:{}),f)),t}),[])}class b4 extends Q0{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||TH(this.get("domains"),(e=>Pu(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const x4=["range","scheme"];function w4(e){return"x"===e?"width":"y"===e?"height":void 0}function _4(e,t){const n=e.fieldDef(t);if(n&&n.bin&&GX(n.bin)){const r=g5(e,n.field,n.bin),i=w4(t),a=e.getName(i);return new r4((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function k4(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of x4)if(void 0!==n[r]){const a=HJ(i,r),o=GJ(e,r);if(a)if(o)DY(o);else switch(r){case"range":{const r=n.range;if(Pu(r)){if(FX(e))return Z0(r.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return r4.fromName(r,n)}return e})))}else if(zu(r))return Z0({data:t.requestDataName(d1.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return Z0(r)}case"scheme":return Z0(O4(n[r]))}else DY(wY(i,r,e))}if(e===FG||e===TG){const t=e===FG?"width":"height",n=r[t];if(e0(n)){if(BJ(i))return Z0({step:n.step});DY(_Y(t))}}const{rangeMin:a,rangeMax:o}=n,s=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=$Q(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case FG:case TG:{if(FH(["point","band"],l))if(e!==FG||n.width){if(e===TG&&!n.height){const e=o0(r.view,"height");if(e0(e))return e}}else{const e=o0(r.view,"width");if(e0(e))return e}const i=w4(e),a=t.getName(i);return e===TG&&IJ(l)?[r4.fromName(o,a),0]:[0,r4.fromName(o,a)]}case YG:{const a=S4(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:_4(n,"x"),y:_4(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=$4(t,i,r.view);return Mc(e)?e-1:new r4((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=$4(t,i,r.view);return Mc(e)?Math.pow(E4*e,2):new r4((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(mY("size",e))}(i,n,t,r);return qJ(l)?function(e,t,n){const r=()=>{const r=HQ(t),i=HQ(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return GY(t)?new r4(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&Pu(n)?n.length+1:(DY(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(l,r,u,e)):[a,o]}case BG:return[0,2*Math.PI];case JG:return[0,360];case PG:return[0,new r4((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case eX:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case tX:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case XG:return"symbol";case WG:case HG:case GG:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case KG:case QG:case ZG:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t);return(void 0!==a||void 0!==o)&&HJ(i,"rangeMin")&&Pu(s)&&2===s.length?Z0([null!=a?a:s[0],null!=o?o:s[1]]):e1(s)}function O4(e){return function(e){return!Fc(e)&&!!e.name}(e)?Object.assign({scheme:e.name},DH(e,["name"])):{scheme:e}}function S4(e,t,n){if(t)return GY(t)?{signal:`${t.signal} ? 0 : ${S4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(mY("size",e))}const E4=.95;function $4(e,t,n){const r=e0(e.width)?e.width.step:a0(n,"width"),i=e0(e.height)?e.height.step:a0(n,"height");return t.x||t.y?new r4((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function A4(e,t){P4(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of VH(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=$Q(i[s]),d=l[t],h=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=HJ(h,t),y=GJ(s,t);if(void 0!==d&&(g?y&&DY(y):DY(wY(h,t,s))),g&&void 0===y)if(void 0!==d){const e=f.timeUnit,n=f.type;switch(t){case"domainMax":case"domainMin":CY(l[t])||"temporal"===n||e?u.set(t,{signal:TQ(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in D4?D4[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):M4(e,t)}const D4={bins:({model:e,fieldOrDatumDef:t})=>rQ(t)?function(e,t){const n=t.bin;if(GX(n)){const r=g5(e,t.field,n);return new r4((()=>e.getSignalName(r)))}if(XX(n)&&YX(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(FH([WG,HG,GG],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if((null===(r=EQ(n))||void 0===r?void 0:r.bin)||FH([_J,kJ],e))return;return t in MX||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in MX){if(LJ(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!rQ(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===$J)return n.pointPadding}return}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0!==e)return;if(t in MX){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return aG(e,"bar"===n?t:i)}return}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0!==e)return;if(t in MX&&n===AJ){const{bandPaddingOuter:e}=a;return aG(e,GY(i)?{signal:`${i.signal}/2`}:i/2)}return}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){if("x"===n&&void 0!==r.xReverse)return IJ(e)&&"descending"===t?GY(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(IJ(e)&&"descending"===t)return!0;return}(t,rQ(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&IJ(i)){if(Pu(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!qJ(i))return!0;if((!rQ(t)||!t.bin)&&FH([...jX,...NX],e)){const{orient:t,type:n}=r;return!FH(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function C4(e){P4(e)?function(e){const t=e.component.scales;for(const n of IX){const r=t[n];if(!r)continue;const i=k4(n,e);r.setWithExplicit("range",i)}}(e):M4(e,"range")}function M4(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?C4(n):A4(n,t);for(const r of VH(n)){let i;for(const n of e.children){const e=n.component.scales[r];if(e){i=r1(i,e.getWithExplicit(t),t,"scale",t1(((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}}n[r].setWithExplicit(t,i)}}function j4(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(mX(e)||"discrete"===WX(e))return"shape"===e&&"ordinal"===t.type&&DY(yY(e,"ordinal")),"ordinal";if(e in MX){if(FH(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in TX)return"band";return void 0!==t.band||dQ(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return mX(e)?"time":"discrete"===WX(e)?(DY(yY(e,"temporal")),"ordinal"):rQ(t)&&t.timeUnit&&HY(t.timeUnit).utc?"utc":"time";case"quantitative":return mX(e)?rQ(t)&&GX(t.bin)?"bin-ordinal":"linear":"discrete"===WX(e)?(DY(yY(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(dY(t.type))}(t,n,r),{type:a}=e;return LX(t)?void 0!==a?function(e,t){if(!LX(e))return!1;switch(e){case FG:case TG:case BG:case PG:return LJ(t)||FH(["band","point"],t);case YG:case eX:case KG:case QG:case ZG:case JG:return LJ(t)||qJ(t)||FH(["band","point","ordinal"],t);case WG:case HG:case GG:return"band"!==t;case tX:return"ordinal"===t||qJ(t);case XG:return"ordinal"===t}}(t,a)?rQ(n)&&(o=a,s=n.type,!(FH([dJ,pJ],s)?void 0===o||BJ(o):s===hJ?FH([_J,kJ,void 0],o):s!==fJ||FH([vJ,bJ,xJ,wJ,OJ,SJ,EJ,yJ,void 0],o)))?(DY(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:(DY(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null;var o,s}function F4(e){P4(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return IX.reduce(((r,i)=>{const a=$Q(t[i]);if(a&&n===cK&&i===XG&&a.type===mJ)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=j4(o,i,a,n);r[i]=new b4(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){F4(n);for(const a of VH(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:q3(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?CJ(e.value,t.value)?r[a]=r1(e,t,"type","scale",T4):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of VH(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new b4(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const T4=t1(((e,t)=>jJ(e)-jJ(t)));var N4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class R4{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function P4(e){return"unit"===(null==e?void 0:e.type)}function z4(e){return"facet"===(null==e?void 0:e.type)}function B4(e){return"concat"===(null==e?void 0:e.type)}function I4(e){return"layer"===(null==e?void 0:e.type)}class L4{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=YJ(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=BQ(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new R4,this.projectionNameMap=n?n.projectionNameMap:new R4,this.signalNameMap=n?n.signalNameMap:new R4,this.data=e.data,this.description=e.description,this.transforms=function(e){return e.map((e=>h1(e)?{filter:SH(e.filter,cJ)}:e))}(null!==(l=e.transform)&&void 0!==l?l:[]),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(XK(e)&&!HK(e.facet)||KZ(e))&&(o.columns=l),QZ(e)&&(o.columns=1);for(const t of n0)if(void 0!==e[t])if("spacing"===t){const n=e[t];o[t]=Mc(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else o[t]=e[t];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:XK(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new Q0,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?$H(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=VH(e),n={text:qQ(e.text)};for(const r of t)n[r]=qQ(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){F4(e),a4(e);for(const t of WJ)A4(e,t);t||C4(e)}(this)}parseProjection(){h5(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){n5(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=N4(e,["style"]),n={};for(const e of VH(t)){const r=t[e];void 0!==r&&(n[e]=VQ(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=VQ(this.description)),"unit"!==this.type&&"layer"!==this.type)?UH(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=N4(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of yX){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=k3(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=w3(r,a),s=T3(e,o);void 0!==s&&(n[o]=s)}}return UH(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of yX)e[n].title&&t.push(E3(this,n));for(const e of O3)t=t.concat(D3(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>l3(e,"grid",t))),...r.map((e=>l3(e,"grid",t))),...n.map((e=>l3(e,"main",t))),...r.map((e=>l3(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return l5(this)}assembleProjections(){return u5(this)}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=N4(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},zQ(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return FH(["unit","layer"],this.type)?FH(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",UH(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||z4(this.parent)?y4(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return XH((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(d1[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(z4(this.parent)){const t=RX(I3(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(BJ(e)&&XY(r)){const e=n.get("name"),r=p4(m4(this,t));if(r){return{signal:B3(e,n,gQ({aggregate:"distinct",field:r},{expr:"datum"}))}}return DY(rY(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):_X(e)&&LX(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return`Cannot find a selection named "${e}".`}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class q4 extends L4{vgField(e,t={}){const n=this.fieldDef(e);if(n)return gQ(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?VH(e).reduce(((n,i)=>{const a=e[i];return Pu(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}(this.getMapping(),((t,n,r)=>{const i=EQ(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){cZ(this.getMapping(),((t,n)=>{const r=EQ(t);r&&e(r,n)}),t)}}var U4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class V4 extends s2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=$H(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new V4(null,$H(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${MH(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=U4(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class W4 extends s2{constructor(e,t){super(e),this.filter=t}clone(){return new W4(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==XQ("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=LX(i)&&t.getScaleComponent(i);if(a){IJ(a.get("type"))&&"count"!==n.aggregate&&!fK(r)&&(e[n.field]=n)}return e}),{});return VH(a).length?new W4(e,a):null}dependentFields(){return new Set(VH(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${MH(this.filter)}`}assemble(){const e=VH(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=gQ(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class H4 extends s2{constructor(e,t){super(e),this.transform=t,this.transform=$H(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new H4(this.parent,$H(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${MH(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class G4 extends s2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=$H(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new G4(null,$H(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${MH(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class X4 extends s2{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new X4(null,$H(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[qG,LG],[VG,UG]]){const i=r.map((e=>{const n=$Q(t.encoding[e]);return rQ(n)?n.field:aQ(n)?{expr:`${n.datum}`}:cQ(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new X4(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(XG)){const r=t.typedFieldDef(XG);r.type===mJ&&(e=new X4(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(Fc);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${MH(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class Y4 extends s2{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new Y4(null,this.projection,$H(this.fields),$H(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[qG,LG],[VG,UG]]){const r=n.map((e=>{const n=$Q(t.encoding[e]);return rQ(n)?n.field:aQ(n)?{expr:`${n.datum}`}:cQ(n)?{expr:`${n.value}`}:void 0})),i=n[0]===VG?"2":"";(r[0]||r[1])&&(e=new Y4(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(Fc))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${MH(this.fields)} ${MH(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class J4 extends s2{constructor(e,t){super(e),this.transform=t}clone(){return new J4(null,$H(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new J4(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(rQ(r)&&rQ(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=fZ(t.mark,n);return new J4(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${MH(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:p1(n)?this.processSequence(n):n}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});if(r&&"value"!==r){return[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[s]}}var K4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Q4 extends s2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=$H(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new Q4(null,$H(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${MH(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=K4(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class Z4 extends s2{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new Z4(null,$H(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=y6(a.data,i);e||(e=new D5(a.data),i.push(e));const n=t.getName(`lookup_${r}`);o=new l2(e,n,d1.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(XH(e),e).materialized,!o)throw new Error(function(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}(e))}return new Z4(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?lc(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${MH({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:lc(this.transform.as)}:{});else{let t=this.transform.as;Fc(t)||(DY('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}var e6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class t6 extends s2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=$H(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new t6(null,$H(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${MH(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=e6(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}var n6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class r6 extends s2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=$H(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new r6(null,$H(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${MH(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=n6(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class i6 extends s2{constructor(e,t){super(e),this.transform=t}clone(){return new i6(null,$H(this.transform))}addDimensions(e){var t;this.transform.groupby=zH((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${MH(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class a6 extends s2{constructor(e,t){super(e),this.transform=t}clone(){return new a6(null,$H(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${MH(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function o6(e){let t=0;return function n(r,i){var a;if(r instanceof D5&&!r.isGenerator&&!a1(r.data)){e.push(i);i={name:null,source:i.name,transform:[]}}if(r instanceof S5&&(r.parent instanceof D5&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof w5){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else{if((r instanceof $5||r instanceof A5||r instanceof W4||r instanceof t3||r instanceof b3||r instanceof Y4||r instanceof X4||r instanceof x5||r instanceof Z4||r instanceof J5||r instanceof X5||r instanceof G4||r instanceof H4||r instanceof V4||r instanceof Q4||r instanceof t6||r instanceof r6||r instanceof E5||r instanceof a6||r instanceof i6)&&i.transform.push(r.assemble()),(r instanceof v5||r instanceof c2||r instanceof J4||r instanceof Y5)&&i.transform.push(...r.assemble()),r instanceof l2)if(i.source&&0===i.transform.length)r.setSource(i.source);else if(r.parent instanceof l2)r.setSource(i.name);else if(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()){e.push(i);i={name:null,source:i.name,transform:[]}}switch(r.numChildren()){case 0:r instanceof l2&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children){n(e,{name:null,source:a,transform:[]})}break}}}}}function s6(e){return"top"===e||"left"===e||GY(e)?"header":"footer"}function l6(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=_3("title",null,i,t);let u=_Q(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=Pu(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=_3("labelOrient",s,i,t),f=aG((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=FH(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[d]:"facet"===t?[]:[u6(e,t,f)]}}}function u6(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function c6(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=U3(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=i[a];for(const i of r.component.axes[t]){const t=s6(i.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[u6(e,a,!1)];const r=l3(i,"main",e.config,{header:!0});r&&o[t][0].axes.push(r),i.mainExtracted=!0}}}}function f6(e){for(const t of e.children)t.parseLayoutSize()}function d6(e,t){const n=I3(t),r=RX(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){o=void 0;break}if(o){if("independent"===a&&o.value!==e.value){o=void 0;break}o=r1(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function h6(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(BJ(e)){const e=o0(r.view,t);return XY(n)||e0(e)?"step":e}return i0(r.view,t)}if(e.hasProjection||"arc"===e.mark)return i0(r.view,t);{const e=o0(r.view,t);return e0(e)?e.step:e}}var p6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function m6(e,t,n){return gQ(t,Object.assign({suffix:`by_${gQ(e)}`},null!=n?n:{}))}class g6 extends q4{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=B6(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!HK(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=VH(e),n={};for(const r of t){if(!FH([CG,MG],r)){DY(mY(r,"facet"));break}const t=e[r];if(void 0===t.field){DY(pY(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=CQ(p6(e,["header"]),t);return n&&(r.header=YJ(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=v6(this),this.child.parseData()}parseLayoutSize(){f6(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of yX)l6(e,t);c6(e,"x"),c6(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of yX)for(const a of S3){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=_3("titleOrient",l.header,this.config,i);if(FH(["right","bottom"],t)){const n=w3(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof g6)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof g6?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:gQ(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof g6){if(this.child.channelHasField("column")){const r=gQ(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of jX){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(BJ(a)&&XY(o)){const i=p4(m4(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):DY(rY(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const e of yX){const t=this.facet[e];if(t){s.push(gQ(t));const{bin:l,sort:u}=t;if(GX(l)&&s.push(gQ(t,{binSuffix:"end"})),VK(u)){const{field:e,op:s=IK}=u,l=m6(t,u);n&&r?(i.push(l),a.push("max"),o.push(l)):(i.push(e),a.push(s),o.push(l))}else if(Pu(u)){const n=x3(t,e);i.push(n),a.push("max"),o.push(n)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?VK(n.sort)?[m6(n,n.sort,{expr:"datum"})]:Pu(n.sort)?[x3(n,e,{expr:"datum"})]:[gQ(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(VK(e)?e.order:!Pu(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return M3(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of O3)if(t[i]){const a=_3("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(FH(r[i],a))return M3(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=o6(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:yX.map((e=>this.facetSortFields(e))).flat(),order:yX.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&VH(e.component.selection).length){const n=Lc(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:_q("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return N2(t)}(this,[])))]}getMapping(){return this.facet}}function y6(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(o1(e)&&o1(t)){if(EH(e.values,t.values))return o}else if(a1(e)&&a1(t)){if(e.url===t.url)return o}else if(s1(e)&&e.name===o.dataName)return o}return null}function v6(e){var t,n,r,i,a,o,s,l,u,c;let f=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new D5({values:[]});return t.push(e),e}const n=y6(e.data,t);if(n)return l1(e.data)||(n.data.format=RH({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new D5(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new i1,m=e.data;l1(m)?(u1(m)?f=new A5(f,m.sequence):f1(m)&&(f=new $5(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=S5.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new E5(f);const g=e.parent&&I4(e.parent);(P4(e)||z4(e))&&g&&(f=null!==(r=v5.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l;if(S1(o))l=e=new b3(e,o),s="derived";else if(h1(o)){const i=k5(o);l=e=null!==(r=S5.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new t3(e,t,o.filter)}else if(E1(o))l=e=v5.makeFromTransform(e,o,t),s="number";else if(A1(o))s="date",void 0===n.getWithExplicit(o.field).value&&(e=new S5(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=c2.makeFromTransform(e,o);else if(D1(o))l=e=x5.makeFromTransform(e,o),s="number",K2(t)&&(e=new E5(e));else if(m1(o))l=e=Z4.make(e,t,o,a++),s="derived";else if(_1(o))l=e=new J5(e,o),s="number";else if(k1(o))l=e=new X5(e,o),s="number";else if(C1(o))l=e=Y5.makeFromTransform(e,o),s="derived";else if(M1(o))l=e=new G4(e,o),s="derived";else if(O1(o))l=e=new H4(e,o),s="derived";else if(g1(o))l=e=new i6(e,o),s="derived";else if(w1(o))e=new a6(e,o);else if($1(o))l=e=J4.makeFromTransform(e,o),s="derived";else if(y1(o))l=e=new V4(e,o),s="derived";else if(v1(o))l=e=new t6(e,o),s="derived";else if(b1(o))l=e=new r6(e,o),s="derived";else{if(!x1(o)){DY(cY(o));continue}l=e=new Q4(e,o),s="derived"}if(l&&void 0!==s)for(const e of null!==(i=l.producedFields())&&void 0!==i?i:[])n.set(e,s,!1)}return e}(f,e,p));const y=function(e){const t={};if(P4(e)&&e.component.selection)for(const n of VH(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&iG(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=O5(e);f=null!==(i=S5.makeWithAncestors(f,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:f,P4(e)&&(f=X4.parseAll(f,e),f=Y4.parseAll(f,e)),(P4(e)||z4(e))&&(g||(f=null!==(a=v5.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=c2.makeFromEncoding(f,e))&&void 0!==o?o:f,f=b3.parseAllForSortIndex(f,e));const b=e.getDataName(d1.Raw),x=new l2(f,b,d1.Raw,h);if(d[b]=x,f=x,P4(e)){const t=x5.makeFromEncoding(f,e);t&&(f=t,K2(e)&&(f=new E5(f))),f=null!==(s=J4.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(l=Y5.makeFromEncoding(f,e))&&void 0!==l?l:f}P4(e)&&(f=null!==(u=W4.make(f,e))&&void 0!==u?u:f);const w=e.getDataName(d1.Main),_=new l2(f,w,d1.Main,h);d[w]=_,f=_,P4(e)&&function(e,t){Y2(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new l2(new t3(t,e,{selection:r}),i,d1.Lookup,e.component.data.outputNodeRefCounts)}))}(e,_);let k=null;if(z4(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(VK(i.sort)){const{field:n,op:r=IK}=i.sort;e=t=new X5(e,{joinaggregate:[{op:r,field:n,as:m6(i,i.sort,{forAs:!0})}],groupby:[gQ(i)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,k=new w5(f,e,t,_.getSource()),d[t]=k}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:x,main:_,facetRoot:k,ancestorParse:p})}class b6 extends L4{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||DY("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>B6(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=v6(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of VH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return QZ(e)?e.vconcat:ZZ(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){f6(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";d6(e,t),d6(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=R3(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const x6=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},gG),{labelExpr:1,encode:1}),w6=VH(x6);class _6 extends Q0{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new _6($H(this.explicit),$H(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return GY(this.explicit.orient)}}const k6={bottom:"top",top:"bottom",left:"right",right:"left"};function O6(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=S6(n,i)}}}return e}function S6(e,t){for(const n of w6){const r=r1(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return tZ(e,t);case"gridScale":return{explicit:e.explicit,value:aG(e.value,t.value)}}return n1(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function E6(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(GY(n.labelAngle)?n.labelAngle:cG(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===v3(r,i))return!0}return e===n[t]}const $6=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function A6(e,t){var n,r,i;let a=t.axis(e);const o=new _6,s=$Q(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=f3(e,f,c,t.config),h=void 0!==a?!a:h3("disable",u.style,null==a?void 0:a.style,d).configValue;if(o.set("disable",h,void 0!==a),h)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return GY(a)?a:cG(a);{const{configValue:a}=h3("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?cG(a):n!==FG||!FH([pJ,dJ],e.type)||rQ(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,d),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const n of w6){const r=n in p3?p3[n](m):vG(n)?a[n]:void 0,i=void 0!==r,s=E6(r,n,a,t,e);if(i&&s)o.set(n,r,s);else{const{configValue:e,configFrom:t}=vG(n)&&"values"!==n?h3(n,u.style,a.style,d):{},l=void 0!==e;i&&!l?o.set(n,r,s):("vgAxisConfig"!==t||$6.has(n)&&l||hG(e)||GY(e))&&o.set(n,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},y=pG.reduce(((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=L3(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=$Q(i[t]))&&void 0!==r?r:$Q(i[$X(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return DK(u)?Object.assign({text:FK({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||UH(s)||(n[r]={update:s}),n}),{});return UH(y)||o.set("encode",y,!!a.encoding||void 0!==a.labelAngle),o}function D6(e,t,n){const r=YJ(e),i=XQ("orient",r,n);if(r.orient=function(e,t,n){switch(e){case nK:case lK:case uK:case aK:case rK:case eK:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case ZJ:if(rQ(r)&&(XX(r.bin)||rQ(i)&&i.aggregate&&!r.aggregate))return"vertical";if(rQ(i)&&(XX(i.bin)||rQ(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(rQ(r)&&r.type===fJ&&!GX(r.bin)||sQ(r)))return"horizontal";if(!o&&(rQ(i)&&i.type===fJ&&!GX(i.bin)||sQ(i)))return"vertical"}case iK:if(a&&(!rQ(r)||!XX(r.bin))&&o&&(!rQ(i)||!XX(i.bin)))return;case QJ:if(o)return rQ(i)&&XX(i.bin)?"horizontal":"vertical";if(a)return rQ(r)&&XX(r.bin)?"vertical":"horizontal";if(e===iK){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case tK:case oK:{const t=oQ(r),a=oQ(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===hJ,s=a.type===hJ;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&DY(`Specified orient "${r.orient}" overridden with "${i}".`),"bar"===r.type&&r.orient){const e=XQ("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:vK[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===XQ("opacity",r,n)&&(r.opacity=function(e,t){if(FH([nK,oK,lK,uK],e)&&!oZ(t))return.7;return}(r.type,t));return void 0===XQ("cursor",r,n)&&(r.cursor=function(e,t,n){if(t.href||e.href||XQ("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function C6(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),q1("x",e,{defaultPos:"mid"})),q1("y",e,{defaultPos:"mid"})),B1("size",e)),B1("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return B1("shape",e)}(e,0,t))}function M6(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=XQ("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;if(e&&XY(e)&&Mc(e.step))return 3*e.step/4;return 3*a0(n.view,a)/4}}const j6={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),q1("x",e,{defaultPos:"mid"})),q1("y",e,{defaultPos:"mid"})),J1(e,"radius","arc")),J1(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),G1("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),r2(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),J1(e,"x","bar")),J1(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>C6(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&rQ(n)&&n.type===mJ?{field:gQ(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),J1(e,"x","image")),J1(e,"y","image")),F1(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),q1("x",e,{defaultPos:"mid"})),q1("y",e,{defaultPos:"mid"})),B1("size",e,{vgChannel:"strokeWidth"})),r2(e))},point:{vgMark:"symbol",encodeEntry:e=>C6(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),J1(e,"x","rect")),J1(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),G1("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),G1("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),B1("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>C6(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),q1("x",e,{defaultPos:"mid"})),q1("y",e,{defaultPos:"mid"})),F1(e)),B1("size",e,{vgChannel:"fontSize"})),B1("angle",e)),i2("align",function(e,t,n){if(void 0===XQ("align",e,n))return"center";return}(e.markDef,0,t))),i2("baseline",function(e,t,n){if(void 0===XQ("baseline",e,n))return"middle";return}(e.markDef,0,t))),q1("radius",e,{defaultPos:null,isMidPoint:!0})),q1("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),q1("x",e,{defaultPos:"mid",vgChannel:"xc"})),q1("y",e,{defaultPos:"mid",vgChannel:"yc"})),B1("size",e,{defaultValue:M6(e),vgChannel:i})),{[a]:VQ(XQ("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},t2(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),q1("x",e,{defaultPos:"mid"})),q1("y",e,{defaultPos:"mid"})),B1("size",e)),r2(e))}};function F6(e){if(FH([tK,QJ,sK],e.mark)){const t=fZ(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:T6+e.requestDataName(d1.Main),data:e.requestDataName(d1.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:R6(e,{fromPrefix:T6})}]}(e,t)}else if(FH([ZJ],e.mark)){const t=QY.some((t=>XQ(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=R6(e,{fromPrefix:N6}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},AH(t.encode.update,["y","yc","y2","height",...QY])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},DH(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},AH(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},DH(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of QY){const r=YQ(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=VQ(r)),r&&(t.encode.update[n]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=gQ(s)?[gQ(s)]:[];((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(gQ(s,{binSuffix:"end"}));a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=YQ(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:VQ(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(d1.Main),name:N6+e.requestDataName(d1.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return R6(e)}const T6="faceted_path_";const N6="stack_group_";function R6(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=aG(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=GQ(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!Pu(o)&&cQ(o)&&jH(o.value)||!o&&jH(XQ("order",i,a)))){if((Pu(o)||rQ(o))&&!n)return QQ(o,{expr:"datum"});if(fK(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(rQ(r)){const t=r.sort;return Pu(t)?{field:gQ(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:VK(t)?{field:gQ({aggregate:oZ(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:UK(t)?{field:gQ(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:gQ(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=VH(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=VH(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),f=XQ("aria",r,a),d=j6[n].postEncodingTransform?j6[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:j6[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===f?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(d1.Main)},encode:{update:j6[n].encodeEntry(e)}}),d?{transform:d}:{})]}class P6 extends q4{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,t0(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=pK(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=YQ("filled",e,t),i=e.type;return aG(r,i!==nK&&i!==tK&&i!==iK)}(a,i,{graticule:e.data&&f1(e.data)}));const s=this.encoding=lZ(e.encoding||{},o,a.filled,i);this.markDef=D6(a,s,i),this.size=function({encoding:e,size:t}){for(const n of jX){const r=AX(n);e0(t[r])&&oQ(e[n])&&(delete t[r],DY(_Y(r)))}return t}({encoding:s,size:t0(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=E0(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===cK,n=e&&hX.some((t=>lQ(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return IX.reduce(((e,n)=>{var r;const i=$Q(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e}),{})}initScale(e){const{domain:t,range:n}=e,r=YJ(e);return Pu(t)&&(r.domain=t.map(qQ)),Pu(n)&&(r.range=n.map(qQ)),r}initAxes(e){return jX.reduce(((t,n)=>{const r=e[n];if(lQ(r)||n===FG&&lQ(e.x2)||n===TG&&lQ(e.y2)){const e=lQ(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t}),{})}initAxis(e){const t=VH(e),n={};for(const r of t){const t=e[r];n[r]=hG(t)?LQ(t):qQ(t)}return n}initLegends(e){return zX.reduce(((t,n)=>{const r=$Q(e[n]);if(r&&function(e){switch(e){case WG:case HG:case GG:case YG:case XG:case KG:case eX:case tX:return!0;case QG:case ZG:case JG:return!1}}(n)){const e=r.legend;t[n]=e?YJ(e):e}return t}),{})}parseData(){this.component.data=v6(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of jX){const i=AX(r);if(t[i]){const e=t[i];n.layoutSize.set(i,e0(e)?"step":e,!0)}else{const t=h6(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of VH(null!=t?t:{})){const o=$H(t[a]),s=i[o.type],l=n3(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const u=XH(a),c=r[u]=Object.assign(Object.assign({},o),{name:u,events:Fc(o.on)?_q(o.on,"scope"):$H(o.on)});M2(c,(n=>{n.has(c)&&n.parse&&n.parse(e,c,o,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=F6(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,jX.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[A6(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;Y2(e,((r,i)=>{const a=r.name,o=Lc(a+V2);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${G2}(${o}, ${Lc(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),M2(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n&&0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return N2(t)}(this,e)}assembleSignals(){return[...u3(this),...(e=this,t=[],Y2(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),M2(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+H2,on:[{events:{signal:n.name+W2},update:`modify(${Lc(n.name+V2)}, ${a})`}]})})),N2(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return Y2(e,(t=>{const r={name:t.name+V2};if(t.init){const n=t.project.items.map((e=>j2(e,["signals"]))),i=t.init.map((e=>F2(e,!1)));r.values="interval"===t.type?[{unit:J2(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:J2(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+V2)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return R3(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&I4(this.parent)||(t=T2(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return aZ(this.encoding,e)}fieldDef(e){return EQ(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return uQ(t)?t:null}}class z6 extends L4{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(x0(e))return new z6(e,this,this.getName("layer_"+t),a,i);if(nZ(e))return new P6(e,this,this.getName("layer_"+t),a,i);throw new Error(QX(e))}))}parseData(){this.component.data=v6(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;f6(e=this),d6(e,"width"),d6(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of VH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of VH(t.component.axes))r.axis[i]=U3(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=O6(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of jX){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!GY(t)){if(i[t]>0&&!n){const n=k6[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),u3(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),R3(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)P4(n)&&(t=T2(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),l5(this))}}function B6(e,t,n,r,i){if(XK(e))return new g6(e,t,n,i);if(x0(e))return new z6(e,t,n,r,i);if(nZ(e))return new P6(e,t,n,r,i);if(function(e){return QZ(e)||ZZ(e)||KZ(e)}(e))return new b6(e,t,n,i);throw new Error(QX(e))}var I6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};var L6=Object.freeze({__proto__:null,normalize:G0,version:"4.17.0",compile:function(e,t={}){var n;t.logger&&(n=t.logger,AY=n),t.fieldTitle&&wQ(t.fieldTitle);try{const n=p0(Iu(t.config,e.config)),r=G0(e,n),i=B6(r,null,"",void 0,n);i.parse(),function(e,t){e4(e.sources);let n=0,r=0;for(let r=0;r<5&&n4(e,t,!0);r++)n++;e.sources.map(K5);for(let n=0;n<5&&n4(e,t,!1);n++)r++;e4(e.sources),5===Math.max(n,r)&&DY("Maximum optimization runs(5) reached.")}(i.component.data,i);return{spec:function(e,t,n={},r){const i=e.config?v0(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=o6(i);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+o++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let s=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(s++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)));const{params:f}=t,d=I6(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...HZ(f)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):Fc(t)&&(t={type:t});if(i&&a&&(o=t.type,"fit"===o||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)DY(nY()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";DY(nY(RX(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${RX(e)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===VH(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),K0(n,!1)),K0(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(AY=$Y),t.fieldTitle&&wQ(bQ)}},deepEqual:EH,duplicate:$H,pick:AH,omit:DH,stringify:CH,hash:MH,isNullOrFalse:jH,contains:FH,some:TH,every:NH,mergeDeep:RH,unique:zH,isEqual:function(e,t){const n=VH(e),r=VH(t);if(n.length!==r.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},setEqual:BH,hasIntersection:IH,prefixGenerator:LH,fieldIntersection:qH,isEmpty:UH,keys:VH,vals:WH,entries:HH,isBoolean:GH,varName:XH,logicalExpr:YH,deleteNestedProperty:JH,titleCase:KH,accessPathWithDatum:QH,flatAccessWithDatum:ZH,replacePathInField:tG,replaceAll:nG,removePathFromField:rG,accessPathDepth:iG,getFirstDefined:aG,uniqueId:sG,resetIdCounter:function(){oG=42},internalField:lG,isInternalField:uG,normalizeAngle:cG,isNumeric:fG});function q6(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}const U6="#fff",V6={background:"#333",title:{color:U6},style:{"guide-label":{fill:U6},"guide-title":{fill:U6}},axis:{domainColor:U6,gridColor:"#888",tickColor:U6}},W6="#4572a7",H6={background:"#fff",arc:{fill:W6},area:{fill:W6},line:{stroke:W6,strokeWidth:2},path:{stroke:W6},rect:{fill:W6},shape:{stroke:W6},symbol:{fill:W6,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},G6="#30a2da",X6="#cbcbcb",Y6="#f0f0f0",J6="#333",K6={arc:{fill:G6},area:{fill:G6},axis:{domainColor:X6,grid:!0,gridColor:X6,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:X6,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Y6,group:{fill:Y6},legend:{labelColor:J6,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:J6,titleFontSize:14,titlePadding:10},line:{stroke:G6,strokeWidth:2},path:{stroke:G6,strokeWidth:.5},rect:{fill:G6},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:G6},bar:{binSpacing:2,fill:G6,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Q6="#000",Z6={group:{fill:"#e5e5e5"},arc:{fill:Q6},area:{fill:Q6},line:{stroke:Q6},path:{stroke:Q6},rect:{fill:Q6},shape:{stroke:Q6},symbol:{fill:Q6,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},e7="Benton Gothic, sans-serif",t7="#82c6df",n7="Benton Gothic Bold, sans-serif",r7="normal",i7={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},a7={background:"#ffffff",title:{anchor:"start",color:"#000000",font:n7,fontSize:22,fontWeight:"normal"},arc:{fill:t7},area:{fill:t7},line:{stroke:t7,strokeWidth:2},path:{stroke:t7},rect:{fill:t7},shape:{stroke:t7},symbol:{fill:t7,size:30},axis:{labelFont:e7,labelFontSize:11.5,labelFontWeight:"normal",titleFont:n7,titleFontSize:13,titleFontWeight:r7},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:e7,labelFontSize:11.5,symbolType:"square",titleFont:n7,titleFontSize:13,titleFontWeight:r7},range:{category:i7["category-6"],diverging:i7["fireandice-6"],heatmap:i7["fire-7"],ordinal:i7["fire-7"],ramp:i7["fire-7"]}},o7="#ab5787",s7="#979797",l7={background:"#f9f9f9",arc:{fill:o7},area:{fill:o7},line:{stroke:o7},path:{stroke:o7},rect:{fill:o7},shape:{stroke:o7},symbol:{fill:o7,size:30},axis:{domainColor:s7,domainWidth:.5,gridWidth:.2,labelColor:s7,tickColor:s7,tickWidth:.2,titleColor:s7},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},u7="#3e5c69",c7={background:"#fff",arc:{fill:u7},area:{fill:u7},line:{stroke:u7},path:{stroke:u7},rect:{fill:u7},shape:{stroke:u7},symbol:{fill:u7},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},f7="#1696d2",d7="#000000",h7="Lato",p7="Lato",m7={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},g7={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:h7},axisX:{domain:!0,domainColor:d7,domainWidth:1,grid:!1,labelFontSize:12,labelFont:p7,labelAngle:0,tickColor:d7,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:h7},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:p7,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:h7,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:p7,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:h7,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:m7["six-groups-cat-1"],diverging:m7["diverging-colors"],heatmap:m7["diverging-colors"],ordinal:m7["six-groups-seq"],ramp:m7["shades-blue"]},area:{fill:f7},rect:{fill:f7},line:{color:f7,stroke:f7,strokeWidth:5},trail:{color:f7,stroke:f7,strokeWidth:0,size:1},path:{stroke:f7,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:f7,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:f7,stroke:null}},arc:{fill:f7},shape:{stroke:f7},symbol:{fill:f7,size:30}},y7="#3366CC",v7="#ccc",b7="Arial, sans-serif",x7={arc:{fill:y7},area:{fill:y7},path:{stroke:y7},rect:{fill:y7},shape:{stroke:y7},symbol:{stroke:y7},circle:{fill:y7},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:b7,fontSize:12},"guide-title":{font:b7,fontSize:12},"group-title":{font:b7,fontSize:12}},title:{font:b7,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:v7,tickColor:v7,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},w7="2.9.1";var _7=Object.freeze({__proto__:null,dark:V6,excel:H6,fivethirtyeight:K6,ggplot2:Z6,googlecharts:x7,latimes:a7,quartz:l7,urbaninstitute:g7,version:w7,vox:c7}),k7="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const O7="vg-tooltip-element",S7={offsetX:10,offsetY:10,id:O7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function E7(e,t,n){if(Pu(e))return`[${e.map((e=>t(Fc(e)?e:$7(e,n)))).join(", ")}]`;if(zu(e)){let r="";const i=e,{title:a,image:o}=i,s=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(zu(i)&&(i=$7(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function $7(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class A7{constructor(e){this.options=Object.assign(Object.assign({},S7),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return k7.toString().replace(O7,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=E7(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function D7(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var C7,M7='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function j7(e,...t){for(const n of t)F7(e,n);return e}function F7(e,t){for(const n of Object.keys(t))Lu(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const T7=vH;let N7=L6;const R7="undefined"!=typeof window?window:void 0;void 0===N7&&(null===(C7=null==R7?void 0:R7.vl)||void 0===C7?void 0:C7.compile)&&(N7=R7.vl);const P7={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},z7={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},B7={vega:"Vega","vega-lite":"Vega-Lite"},I7={vega:T7.version,"vega-lite":N7?N7.version:"not available"},L7={vega:e=>e,"vega-lite":(e,t)=>N7.compile(e,{config:t}).spec},q7='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',U7="chart-wrapper";function V7(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=`${B7[r]} JSON Source`}function W7(e,t,n={}){var r,i,a;return D7(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:T7.loader(n.loader);var s;const l=Fc(t)?JSON.parse(yield o.load(t)):t,u=yield H7(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield H7(n,o),f=Object.assign(Object.assign({},j7(c,u)),{config:Iu(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return D7(this,void 0,void 0,(function*(){const c=n.theme?Iu(_7[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=Ac(n.actions)?n.actions:j7({},P7,null!==(a=n.actions)&&void 0!==a?a:{}),d=Object.assign(Object.assign({},z7),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:T7.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?M7.toString():n.defaultStyle,r.appendChild(t)}}const y=function(e,t){var n;if(e.$schema){const r=q6(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${B7[r.library]}, but mode argument sets ${null!==(n=B7[t])&&void 0!==n?n:t}.`);const i=r.library;return bu.satisfies(I7[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${B7[i]} ${r.version}, but the current version of ${B7[i]} is v${I7[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let v=L7[y](t,c);if("vega-lite"===y&&v.$schema){const e=q6(v.$schema);bu.satisfies(I7.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${I7.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(f){const e=document.createElement("div");e.classList.add(U7),g.appendChild(e),b=e}const x=n.patch;x&&(v=x instanceof Function?x(v):ns(v,x,!0,!1).newDocument),n.formatLocale&&T7.formatLocale(n.formatLocale),n.timeFormatLocale&&T7.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=T7.parse(v,"vega-lite"===y?{}:c,{ast:w}),k=new T7.View(_,Object.assign({loader:r,logLevel:p,renderer:h},w?{expr:T7.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e=function(e){return"function"==typeof e}(n.tooltip)?n.tooltip:new A7(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(e)}let O,{hover:S}=n;if(void 0===S&&(S="vega"===y),S){const{hoverSet:e,updateSet:t}="boolean"==typeof S?{}:S;k.hover(e,t)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(b,n.bind).runAsync(),!1!==f){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=d.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML=q7,t.append(n),O=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",O)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const e of["svg","png"])if(!0===f||!0===f.export||f.export[e]){const t=d[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${m}.${e}`,i.addEventListener("mousedown",(function(t){return D7(this,void 0,void 0,(function*(){t.preventDefault();const r=yield k.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=d.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;V7(ps(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),e.preventDefault()})),r.append(e)}if("vega-lite"===y&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=d.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;V7(ps(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===f||!1!==f.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=d.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:y,renderer:h,spec:ps(t)}),n.preventDefault()})),r.append(i)}}function E(){O&&document.removeEventListener("click",O),k.finalize()}return{view:k,spec:t,vgSpec:v,finalize:E}}))}(e,l,f,o)}))}function H7(e,t){var n;return D7(this,void 0,void 0,(function*(){const r=Fc(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=Fc(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const G7={$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:"container",height:500,layer:[{data:{name:"simulated"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]}],layer:[{transform:[{aggregate:[{op:"min",field:"cumNetValue",as:"teamMinNetValue"},{op:"max",field:"cumNetValue",as:"teamMaxNetValue"}],groupby:["rollIndex","turn","activeTeamColor","activeTeamName"]},{joinaggregate:[{op:"min",field:"teamMinNetValue",as:"minNetValue"},{op:"max",field:"teamMaxNetValue",as:"maxNetValue"}]},{calculate:"datum.rollIndex - 0.5",as:"x"},{calculate:"datum.rollIndex + 0.5",as:"x2"}],mark:{type:"rect",opacity:.05},encoding:{x:{field:"x",type:"quantitative"},x2:{field:"x2",type:"quantitative"},y:{field:"minNetValue",type:"quantitative",title:"Net Value"},y2:{field:"maxNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"}]}},{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["activeTeamColor","rollIndex"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"value",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},detail:{field:"prob",type:"nominal"},tooltip:[{field:"activeTeamColor",title:"Active Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}}]},{data:{name:"playHead"},mark:{type:"rule"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}}}},{data:{name:"actual"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]},{calculate:"'#roll-' + datum.rollIndex",as:"url"}],layer:[{mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Active Team",legend:{disable:!0}},detail:{field:"iteration",type:"nominal"}}},{transform:[{flatten:["outcomes","weights"]},{bin:{step:.5,anchor:-.25},field:"outcomes",as:["outcomes_min","outcomes_max"]},{aggregate:[{op:"sum",field:"weights",as:"weight_sum"}],groupby:["rollIndex","activeTeamColor","activeTeamName","outcomes_min","outcomes_max","cumNetValue","netValue","description"]},{calculate:"datum.outcomes_min + datum.cumNetValue - datum.netValue",as:"posNetValue_min"},{calculate:"datum.outcomes_max + datum.cumNetValue - datum.netValue",as:"posNetValue_max"},{calculate:"datum.rollIndex - (datum.weight_sum / 2)",as:"x"},{calculate:"datum.rollIndex + (datum.weight_sum / 2)",as:"x2"},{calculate:"datum.posNetValue_min",as:"y"},{calculate:"datum.posNetValue_max",as:"y2"},{calculate:"join([datum.outcomes_min, datum.outcomes_max], ' - ')",as:"outcomes_range"}],mark:{type:"rect",opacity:.7},encoding:{x:{type:"quantitative",field:"x"},x2:{type:"quantitative",field:"x2"},y:{type:"quantitative",field:"y"},y2:{type:"quantitative",field:"y2"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"description",title:"Roll"},{field:"outcomes_range",title:"Net Value Change"},{field:"weight_sum",title:"Probability",format:".2p"},{field:"activeTeamName",title:"Active Team"}]}},{mark:{type:"point"},selection:{zoom_x:{type:"interval",bind:"scales",encodings:["x"]}},encoding:{x:{type:"quantitative",field:"rollIndex"},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"},{field:"description",title:"Roll"},{field:"valueDescription",title:"Value"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}],href:{field:"url",type:"nominal"}}}]}]};function X7(t){let n;return{c(){n=_("div"),n.innerHTML='<div id="chart" class="col-sm-12 svelte-1yk3kez"></div>',D(n,"id","results")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}function Y7(e,t,n){const r=q();let i,a,{rolls:o}=t,{replayStepIndex:s}=t,{selectedRoll:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return L((()=>(console.log("Results onMount"),function(){const e=o.filter((e=>{const t=e.actual;return isFinite(t.outcomeValue)?!!isFinite(t.expectedValue)||(console.warn("Dice roll with non-finite expected value",{roll:e,dataPoint:t}),!1):(console.warn("Dice roll with non-finite outcome value",{roll:e,dataPoint:t}),!1)})),t=e.map((e=>e.actual));console.log("Valid rolls",e),console.log("Actual points",t),W7("#chart",G7).then((a=>{a.view.addEventListener("click",(function(e,t){t&&(n(0,l=t.datum.rollIndex),n(1,u=o[l].stepIndex),n(2,c=o[l+1].stepIndex),console.log("Results clicked",{selectedRoll:l,replayStart:u,replayEnd:c}))})),n(5,i=a.view),n(5,i=a.view.insert("actual",t).run()),n(5,i=i.insert("simulated",t).run());var s=0;function f(){for(var t=[],a=0;a<50;a++)s++,t=t.concat(e.map((e=>e.simulated(s))));var o=lg().insert(t);n(5,i=i.change("simulated",o).run()),r("iterationComplete",s),s<1e3&&window.setTimeout(f,200)}f()}))}(),console.log("Results onMount chart rendered"),()=>console.log("destroyed")))),e.$$set=e=>{"rolls"in e&&n(3,o=e.rolls),"replayStepIndex"in e&&n(4,s=e.replayStepIndex),"selectedRoll"in e&&n(0,l=e.selectedRoll),"replayStart"in e&&n(1,u=e.replayStart),"replayEnd"in e&&n(2,c=e.replayEnd)},e.$$.update=()=>{if(120&e.$$.dirty){if(o&&s){let e=o.findIndex((e=>s<e.stepIndex));n(6,a=e>0?o[e-1].rollIndex:0)}if(i&&a){var t=lg().remove((()=>!0)).insert([{rollIndex:a}]);n(5,i=i.change("playHead",t).run())}}},[l,u,c,o,s,i,a]}class J7 extends $e{constructor(e){super(),Ee(this,e,Y7,X7,s,{rolls:3,replayStepIndex:4,selectedRoll:0,replayStart:1,replayEnd:2})}}function K7(t){let n;return{c(){n=_("p"),n.textContent="Welcome to Diced or Not, the Blood Bowl 2 replay dice analyzer! If you've just\n  had a particularly good or bad game and you want to know if the dice are to\n  blame, this is the site for you. To get started, use the button below to\n  select the replay you want to load. These are .bbrz files that are usually\n  located in My Documents\\BloodBowl2\\Profiles\\(Coach Name or ID)\\Replays. Diced\n  or Not will analyze the replay and extract all the dice rolls, then show them\n  to you along with a bunch of statistics about just how lucky or unlucky you\n  were.",D(n,"id","about")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class Q7 extends $e{constructor(e){super(),Ee(this,e,null,K7,s,{})}}function Z7(t){let n;return{c(){n=_("nav"),n.innerHTML='<a class="navbar-brand svelte-gb2y3h" href="/#">Diced or Not</a> \n    <ul class="navbar-nav"><li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#about">About</a></li> \n      <li class="dropdown svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#summary">Replay</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#explanation">Explain?</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#contact">Contact</a></li></ul>',D(n,"class","navbar-dark bg-dark sidenav svelte-gb2y3h")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class e8 extends $e{constructor(e){super(),Ee(this,e,null,Z7,s,{})}}function t8(e){const t=e-1;return t*t*t+1}function n8(e){return-.5*(Math.cos(Math.PI*e)-1)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function r8(e,{delay:n=0,duration:r=400,easing:i=t}){const a=+getComputedStyle(e).opacity;return{delay:n,duration:r,easing:i,css:e=>"opacity: "+e*a}}function i8(e){var{fallback:t}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["fallback"]);const i=new Map,a=new Map;function s(e,i,a){return(s,l)=>(e.set(l.key,{rect:s.getBoundingClientRect()}),()=>{if(i.has(l.key)){const{rect:e}=i.get(l.key);return i.delete(l.key),function(e,t,i){const{delay:a=0,duration:s=(e=>30*Math.sqrt(e)),easing:l=t8}=n(n({},r),i),u=t.getBoundingClientRect(),c=e.left-u.left,f=e.top-u.top,d=e.width/u.width,h=e.height/u.height,p=Math.sqrt(c*c+f*f),m=getComputedStyle(t),g="none"===m.transform?"":m.transform,y=+m.opacity;return{delay:a,duration:o(s)?s(p):s,easing:l,css:(e,t)=>`\n\t\t\t\topacity: ${e*y};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${g} translate(${t*c}px,${t*f}px) scale(${e+(1-e)*d}, ${e+(1-e)*h});\n\t\t\t`}}(e,s,l)}return e.delete(l.key),t&&t(s,l,a)})}return[s(a,i,!1),s(i,a,!0)]}function a8(e){let t,n,r,i;const a=e[4].default,o=function(e,t,n,r){if(e){const i=u(e,t,n,r);return e[0](i)}}(a,e,e[3],null);return{c(){t=_("div"),n=_("div"),o&&o.c(),D(n,"class",r=f(`inner ${e[2]||""}`)+" svelte-190gtax"),D(t,"class","outer svelte-190gtax"),M(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},m(e,r){b(e,t,r),v(t,n),o&&o.m(n,null),i=!0},p(e,[s]){o&&o.p&&8&s&&c(o,a,e,e[3],s,null,null),(!i||4&s&&r!==(r=f(`inner ${e[2]||""}`)+" svelte-190gtax"))&&D(n,"class",r),(!i||3&s)&&M(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},i(e){i||(fe(o,e),i=!0)},o(e){de(o,e),i=!1},d(e){e&&x(t),o&&o.d(e)}}}function o8(e,t,n){let{$$slots:r={},$$scope:i}=t,{width:a=1}=t,{height:o=1}=t,{class:s=null}=t;return e.$$set=e=>{"width"in e&&n(0,a=e.width),"height"in e&&n(1,o=e.height),"class"in e&&n(2,s=e.class),"$$scope"in e&&n(3,i=e.$$scope)},[a,o,s,i,r]}class s8 extends $e{constructor(e){super(),Ee(this,e,o8,a8,s,{width:0,height:1,class:2})}}function l8(e,t,n){const r=e.slice();return r[5]=t[n],r[7]=n,r}function u8(e,t,n){const r=e.slice();return r[8]=t[n],r[10]=n,r}function c8(t){let n,r;return{c(){n=_("div"),D(n,"class","grid-item svelte-1gz3er0"),D(n,"id",r=t[0]+"_"+t[10]+"_"+t[7])},m(e,t){b(e,n,t)},p(e,t){7&t&&r!==(r=e[0]+"_"+e[10]+"_"+e[7])&&D(n,"id",r)},i:e,o:e,d(e){e&&x(n)}}}function f8(e){let t,r,i;const a=[{row:e[7]},{column:e[10]},{width:e[1]},{height:e[2]},e[4],{id:e[0]+"_"+e[10]+"_"+e[7]}];var o=e[3];function s(e){let t={};for(let e=0;e<a.length;e+=1)t=n(t,a[e]);return{props:t}}return o&&(t=new o(s())),{c(){t&&ke(t.$$.fragment),r=S()},m(e,n){t&&Oe(t,e,n),b(e,r,n),i=!0},p(e,n){const i=23&n?xe(a,[4&n&&{row:e[7]},2&n&&{column:e[10]},2&n&&{width:e[1]},4&n&&{height:e[2]},16&n&&we(e[4]),7&n&&{id:e[0]+"_"+e[10]+"_"+e[7]}]):{};if(o!==(o=e[3])){if(t){ue();const e=t;de(e.$$.fragment,1,0,(()=>{Se(e,1)})),ce()}o?(t=new o(s()),ke(t.$$.fragment),fe(t.$$.fragment,1),Oe(t,r.parentNode,r)):t=null}else o&&t.$set(i)},i(e){i||(t&&fe(t.$$.fragment,e),i=!0)},o(e){t&&de(t.$$.fragment,e),i=!1},d(e){e&&x(r),t&&Se(t,e)}}}function d8(e,t){let n,r,i,a,o;const s=[f8,c8],l=[];function u(e,t){return e[3]?0:1}return r=u(t),i=l[r]=s[r](t),{key:e,first:null,c(){n=S(),i.c(),a=S(),this.first=n},m(e,t){b(e,n,t),l[r].m(e,t),b(e,a,t),o=!0},p(e,t){let n=r;r=u(e),r===n?l[r].p(e,t):(ue(),de(l[n],1,1,(()=>{l[n]=null})),ce(),i=l[r],i?i.p(e,t):(i=l[r]=s[r](e),i.c()),fe(i,1),i.m(a.parentNode,a))},i(e){o||(fe(i),o=!0)},o(e){de(i),o=!1},d(e){e&&x(n),l[r].d(e),e&&x(a)}}}function h8(e,t){let n,r,i,a=[],o=new Map,s=Array(t[1]);const l=e=>e[10];for(let e=0;e<s.length;e+=1){let n=u8(t,s,e),r=l(n);o.set(r,a[e]=d8(r,n))}return{key:e,first:null,c(){n=S();for(let e=0;e<a.length;e+=1)a[e].c();r=S(),this.first=n},m(e,t){b(e,n,t);for(let n=0;n<a.length;n+=1)a[n].m(e,t);b(e,r,t),i=!0},p(e,t){if(31&t){const n=Array(e[1]);ue(),a=be(a,t,l,1,e,n,o,r.parentNode,ve,d8,r,u8),ce()}},i(e){if(!i){for(let e=0;e<s.length;e+=1)fe(a[e]);i=!0}},o(e){for(let e=0;e<a.length;e+=1)de(a[e]);i=!1},d(e){e&&x(n);for(let t=0;t<a.length;t+=1)a[t].d(e);e&&x(r)}}}function p8(e){let t,n,r=[],i=new Map,a=Array(e[2]);const o=e=>e[7];for(let t=0;t<a.length;t+=1){let n=l8(e,a,t),s=o(n);i.set(s,r[t]=h8(s,n))}return{c(){t=_("div");for(let e=0;e<r.length;e+=1)r[e].c();D(t,"class","grid svelte-1gz3er0"),M(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),M(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},m(e,i){b(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,a){if(31&a){const n=Array(e[2]);ue(),r=be(r,a,o,1,e,n,i,t,ve,h8,null,l8),ce()}(!n||2&a)&&M(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),(!n||4&a)&&M(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},i(e){if(!n){for(let e=0;e<a.length;e+=1)fe(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)de(r[e]);n=!1},d(e){e&&x(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function m8(e){let t,n;return t=new s8({props:{width:e[1],height:e[2],$$slots:{default:[p8]},$$scope:{ctx:e}}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,[n]){const r={};2&n&&(r.width=e[1]),4&n&&(r.height=e[2]),2079&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function g8(e,t,n){let{prefix:r}=t,{width:i}=t,{height:a}=t,{component:o=null}=t,{componentProps:s={}}=t;return e.$$set=e=>{"prefix"in e&&n(0,r=e.prefix),"width"in e&&n(1,i=e.width),"height"in e&&n(2,a=e.height),"component"in e&&n(3,o=e.component),"componentProps"in e&&n(4,s=e.componentProps)},[r,i,a,o,s]}class y8 extends $e{constructor(e){super(),Ee(this,e,g8,m8,s,{prefix:0,width:1,height:2,component:3,componentProps:4})}}function v8(e){let t,n;return{c(){t=_("img"),t.src!==(n=`/images/skills/${e[5]}.png`)&&D(t,"src",n),D(t,"alt",e[5]),D(t,"class","svelte-28czd8")},m(e,n){b(e,t,n)},p(e,r){32&r&&t.src!==(n=`/images/skills/${e[5]}.png`)&&D(t,"src",n),32&r&&D(t,"alt",e[5])},d(e){e&&x(t)}}}function b8(e){let t,n,r,i,a,o=e[5]&&v8(e);return{c(){t=_("div"),o&&o.c(),D(t,"id",e[9]),D(t,"class",n=f(e[8])+" svelte-28czd8"),j(t,"done",e[0]),j(t,"moving",e[1]),j(t,"stunned",e[2]),j(t,"prone",e[3]),j(t,"blitz",e[4])},m(e,n){b(e,t,n),o&&o.m(t,null),a=!0},p(r,i){(e=r)[5]?o?o.p(e,i):(o=v8(e),o.c(),o.m(t,null)):o&&(o.d(1),o=null),(!a||512&i)&&D(t,"id",e[9]),(!a||256&i&&n!==(n=f(e[8])+" svelte-28czd8"))&&D(t,"class",n),257&i&&j(t,"done",e[0]),258&i&&j(t,"moving",e[1]),260&i&&j(t,"stunned",e[2]),264&i&&j(t,"prone",e[3]),272&i&&j(t,"blitz",e[4])},i(n){a||(Q((()=>{i&&i.end(1),r||(r=pe(t,e[7],{key:e[9]})),r.start()})),a=!0)},o(n){r&&r.invalidate(),i=me(t,e[6],{key:e[9]}),a=!1},d(e){e&&x(t),o&&o.d(),e&&i&&i.end()}}}function x8(t){let n,r,i=t[9],a=b8(t);return{c(){a.c(),n=S()},m(e,t){a.m(e,t),b(e,n,t),r=!0},p(t,[r]){512&r&&s(i,i=t[9])?(ue(),de(a,1,1,e),ce(),a=b8(t),a.c(),fe(a),a.m(n.parentNode,n)):a.p(t,r)},i(e){r||(fe(a),r=!0)},o(e){de(a),r=!1},d(e){e&&x(n),a.d(e)}}}function w8(e,t,n){let r,i,{id:a}=t,{race:o}=t,{model:s}=t,{team:l}=t,{done:u=!1}=t,{moving:c=!1}=t,{stunned:f=!1}=t,{prone:d=!1}=t,{blitz:h=!1}=t,{cas:p=null}=t,{stupidity:m=null}=t,{send:g}=t,{receive:y}=t;return e.$$set=e=>{"id"in e&&n(10,a=e.id),"race"in e&&n(11,o=e.race),"model"in e&&n(12,s=e.model),"team"in e&&n(13,l=e.team),"done"in e&&n(0,u=e.done),"moving"in e&&n(1,c=e.moving),"stunned"in e&&n(2,f=e.stunned),"prone"in e&&n(3,d=e.prone),"blitz"in e&&n(4,h=e.blitz),"cas"in e&&n(5,p=e.cas),"stupidity"in e&&n(14,m=e.stupidity),"send"in e&&n(6,g=e.send),"receive"in e&&n(7,y=e.receive)},e.$$.update=()=>{31744&e.$$.dirty&&(n(8,r=[o,s,l,"sprite"].concat(m?[m]:[]).join(" ")),n(9,i=`player_${a}`))},[u,c,f,d,h,p,g,y,r,i,a,o,s,l,m]}class _8 extends $e{constructor(e){super(),Ee(this,e,w8,x8,s,{id:10,race:11,model:12,team:13,done:0,moving:1,stunned:2,prone:3,blitz:4,cas:5,stupidity:14,send:6,receive:7})}}function k8(e){let t,r;const i=[e[3],{send:e[1]},{receive:e[2]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new _8({props:a}),{c(){ke(t.$$.fragment)},m(e,n){Oe(t,e,n),r=!0},p(e,n){const r=14&n?xe(i,[8&n&&we(e[3]),2&n&&{send:e[1]},4&n&&{receive:e[2]}]):{};t.$set(r)},i(e){r||(fe(t.$$.fragment,e),r=!0)},o(e){de(t.$$.fragment,e),r=!1},d(e){Se(t,e)}}}function O8(e){let t,n,r=e[3]&&k8(e);return{c(){t=_("div"),r&&r.c(),D(t,"id",e[0]),D(t,"class","pitch-square svelte-eoi57j")},m(e,i){b(e,t,i),r&&r.m(t,null),n=!0},p(e,[i]){e[3]?r?(r.p(e,i),8&i&&fe(r,1)):(r=k8(e),r.c(),fe(r,1),r.m(t,null)):r&&(ue(),de(r,1,1,(()=>{r=null})),ce()),(!n||1&i)&&D(t,"id",e[0])},i(e){n||(fe(r),n=!0)},o(e){de(r),n=!1},d(e){e&&x(t),r&&r.d()}}}function S8(e,t,n){let r,{dugout:i}=t,{id:a}=t,{row:o}=t,{column:s}=t,{width:l}=t,{height:u}=t,{casType:c}=t,{send:f}=t,{receive:d}=t,h=null;return e.$$set=e=>{"dugout"in e&&n(4,i=e.dugout),"id"in e&&n(0,a=e.id),"row"in e&&n(5,o=e.row),"column"in e&&n(6,s=e.column),"width"in e&&n(7,l=e.width),"height"in e&&n(8,u=e.height),"casType"in e&&n(9,c=e.casType),"send"in e&&n(1,f=e.send),"receive"in e&&n(2,d=e.receive)},e.$$.update=()=>{2032&e.$$.dirty&&i&&(n(10,r="ko"==c?i.cas.slice(l*u).concat(i[c]):"reserve"==c?i.ko.slice(l*u).concat(i[c]):i[c]),n(3,h=r[s*u+o]))},[a,f,d,h,i,o,s,l,u,c,r]}class E8 extends $e{constructor(e){super(),Ee(this,e,S8,O8,s,{dugout:4,id:0,row:5,column:6,width:7,height:8,casType:9,send:1,receive:2})}}function $8(e){let t,n,r,i;return n=new y8({props:{width:4,height:2,prefix:e[0],component:E8,componentProps:{casType:e[0],dugout:e[1],send:e[2],receive:e[3]}}}),{c(){t=_("div"),ke(n.$$.fragment),D(t,"class",r=`bench ${e[0]}`)},m(e,r){b(e,t,r),Oe(n,t,null),i=!0},p(e,[a]){const o={};1&a&&(o.prefix=e[0]),15&a&&(o.componentProps={casType:e[0],dugout:e[1],send:e[2],receive:e[3]}),n.$set(o),(!i||1&a&&r!==(r=`bench ${e[0]}`))&&D(t,"class",r)},i(e){i||(fe(n.$$.fragment,e),i=!0)},o(e){de(n.$$.fragment,e),i=!1},d(e){e&&x(t),Se(n)}}}function A8(e,t,n){let{casType:r}=t,{dugout:i}=t,{send:a}=t,{receive:o}=t;return e.$$set=e=>{"casType"in e&&n(0,r=e.casType),"dugout"in e&&n(1,i=e.dugout),"send"in e&&n(2,a=e.send),"receive"in e&&n(3,o=e.receive)},[r,i,a,o]}class D8 extends $e{constructor(e){super(),Ee(this,e,A8,$8,s,{casType:0,dugout:1,send:2,receive:3})}}function C8(e){let t,n,r,i,a,o,s;return n=new D8({props:{casType:"cas",dugout:e[0],send:e[1],receive:e[2]}}),i=new D8({props:{casType:"ko",dugout:e[0],send:e[1],receive:e[2]}}),o=new D8({props:{casType:"reserve",dugout:e[0],send:e[1],receive:e[2]}}),{c(){t=_("div"),ke(n.$$.fragment),r=O(),ke(i.$$.fragment),a=O(),ke(o.$$.fragment),D(t,"class","bench svelte-kd7r5x")},m(e,l){b(e,t,l),Oe(n,t,null),v(t,r),Oe(i,t,null),v(t,a),Oe(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),2&t&&(r.send=e[1]),4&t&&(r.receive=e[2]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),2&t&&(a.send=e[1]),4&t&&(a.receive=e[2]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),2&t&&(s.send=e[1]),4&t&&(s.receive=e[2]),o.$set(s)},i(e){s||(fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),s=!0)},o(e){de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),s=!1},d(e){e&&x(t),Se(n),Se(i),Se(o)}}}function M8(e,t,n){let{dugout:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class j8 extends $e{constructor(e){super(),Ee(this,e,M8,C8,s,{dugout:0,send:1,receive:2})}}function F8(e){let t,n,r,i,a;return{c(){t=_("div"),t.innerHTML='<div class="inducement wizard svelte-ulwshi"></div>',n=O(),r=_("div"),r.innerHTML='<div class="inducement apo svelte-ulwshi"></div>',i=O(),a=_("div"),a.innerHTML='<div class="reroll svelte-ulwshi"></div>',D(t,"class","grid_item_dice"),D(r,"class","grid_item_dice"),D(a,"class","grid_item_dice")},m(e,o){b(e,t,o),b(e,n,o),b(e,r,o),b(e,i,o),b(e,a,o)},d(e){e&&x(t),e&&x(n),e&&x(r),e&&x(i),e&&x(a)}}}function T8(e){let t,n;return t=new y8({props:{width:10,height:3,prefix:"dice",$$slots:{default:[F8]},$$scope:{ctx:e}}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}class N8 extends $e{constructor(e){super(),Ee(this,e,null,T8,s,{})}}function R8(e){let t;return{c(){t=_("div"),t.innerHTML='<div id="selectedPlayerName"></div> \n    <div><div class="grid_stat">MV</div> \n      <div class="grid_stat" id="selectPlayer-MV"></div> \n      <div class="grid_stat">ST</div> \n      <div class="grid_stat" id="selectPlayer-ST"></div> \n      <div class="grid_stat">AG</div> \n      <div class="grid_stat" id="selectPlayer-AG"></div> \n      <div class="grid_stat">AV</div> \n      <div class="grid_stat" id="selectPlayer-AV"></div></div> \n    <div id="selectedPlayerCAS"></div> \n    <div id="skills"></div>',D(t,"id","selectedPlayerData"),D(t,"class","svelte-dj6vrn")},m(e,n){b(e,t,n)},d(e){e&&x(t)}}}function P8(e){let t,n;return t=new s8({props:{width:207,height:317,$$slots:{default:[R8]},$$scope:{ctx:e}}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}class z8 extends $e{constructor(e){super(),Ee(this,e,null,P8,s,{})}}function B8(e){let t,n,r;return{c(){t=_("div"),D(t,"class",n=f(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu"),D(t,"title",r=e[1][e[0]])},m(e,n){b(e,t,n)},p(e,i){1&i&&n!==(n=f(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu")&&D(t,"class",n),1&i&&r!==(r=e[1][e[0]])&&D(t,"title",r)},d(e){e&&x(t)}}}function I8(e){let t,n;return t=new s8({props:{$$slots:{default:[B8]},$$scope:{ctx:e}}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,[n]){const r={};9&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function L8(e,t,n){let{weather:r}=t;const i={[dt]:"perfect blood bowl weather",[ht]:"sweltering heat!",[pt]:"very sunny",[mt]:"pouring rain",[gt]:"blizzard go brrrr"},a={[dt]:"nice",[ht]:"heat",[pt]:"sunny",[mt]:"rain",[gt]:"blizzard"};return e.$$set=e=>{"weather"in e&&n(0,r=e.weather)},[r,i,a]}class q8 extends $e{constructor(e){super(),Ee(this,e,L8,I8,s,{weather:0})}}function U8(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,w,S,E,$,A,M,F,T,N,R,P=e[0].name+"",z=e[0].score+"",B=e[0].turn+"";return n=new j8({props:{dugout:e[0].dugout,send:e[2],receive:e[3]}}),E=new N8({}),M=new z8({}),N=new q8({props:{weather:e[1]}}),{c(){t=_("div"),ke(n.$$.fragment),r=O(),i=_("img"),s=O(),l=_("div"),u=k(P),c=O(),f=_("div"),d=_("p"),h=k(z),p=O(),m=_("div"),g=_("p"),y=k(B),w=O(),S=_("div"),ke(E.$$.fragment),$=O(),A=_("div"),ke(M.$$.fragment),F=O(),T=_("div"),ke(N.$$.fragment),i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png")&&D(i,"src",a),D(i,"alt",o="Logo: "+e[0].logo),D(i,"class","logo svelte-x8vtg0"),D(l,"class","name svelte-x8vtg0"),D(f,"class","score svelte-x8vtg0"),D(m,"class","turn svelte-x8vtg0"),j(m,"active",e[0].active),D(S,"class","aids svelte-x8vtg0"),D(A,"class","selected svelte-x8vtg0"),D(T,"class","weather svelte-x8vtg0"),D(t,"class","dugout svelte-x8vtg0")},m(e,a){b(e,t,a),Oe(n,t,null),v(t,r),v(t,i),v(t,s),v(t,l),v(l,u),v(t,c),v(t,f),v(f,d),v(d,h),v(t,p),v(t,m),v(m,g),v(g,y),v(t,w),v(t,S),Oe(E,S,null),v(t,$),v(t,A),Oe(M,A,null),v(t,F),v(t,T),Oe(N,T,null),R=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0].dugout),4&t&&(r.send=e[2]),8&t&&(r.receive=e[3]),n.$set(r),(!R||1&t&&i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png"))&&D(i,"src",a),(!R||1&t&&o!==(o="Logo: "+e[0].logo))&&D(i,"alt",o),(!R||1&t)&&P!==(P=e[0].name+"")&&C(u,P),(!R||1&t)&&z!==(z=e[0].score+"")&&C(h,z),(!R||1&t)&&B!==(B=e[0].turn+"")&&C(y,B),1&t&&j(m,"active",e[0].active);const s={};2&t&&(s.weather=e[1]),N.$set(s)},i(e){R||(fe(n.$$.fragment,e),fe(E.$$.fragment,e),fe(M.$$.fragment,e),fe(N.$$.fragment,e),R=!0)},o(e){de(n.$$.fragment,e),de(E.$$.fragment,e),de(M.$$.fragment,e),de(N.$$.fragment,e),R=!1},d(e){e&&x(t),Se(n),Se(E),Se(M),Se(N)}}}function V8(e,t,n){let{homeTeam:r}=t,{weather:i}=t,{send:a}=t,{receive:o}=t;return e.$$set=e=>{"homeTeam"in e&&n(0,r=e.homeTeam),"weather"in e&&n(1,i=e.weather),"send"in e&&n(2,a=e.send),"receive"in e&&n(3,o=e.receive)},[r,i,a,o]}class W8 extends $e{constructor(e){super(),Ee(this,e,V8,U8,s,{homeTeam:0,weather:1,send:2,receive:3})}}function H8(e){let t,n,r,i,a,o,s;return n=new D8({props:{casType:"reserve",dugout:e[0],send:e[1],receive:e[2]}}),i=new D8({props:{casType:"ko",dugout:e[0],send:e[1],receive:e[2]}}),o=new D8({props:{casType:"cas",dugout:e[0],send:e[1],receive:e[2]}}),{c(){t=_("div"),ke(n.$$.fragment),r=O(),ke(i.$$.fragment),a=O(),ke(o.$$.fragment),D(t,"class","bench svelte-4xq83r")},m(e,l){b(e,t,l),Oe(n,t,null),v(t,r),Oe(i,t,null),v(t,a),Oe(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),2&t&&(r.send=e[1]),4&t&&(r.receive=e[2]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),2&t&&(a.send=e[1]),4&t&&(a.receive=e[2]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),2&t&&(s.send=e[1]),4&t&&(s.receive=e[2]),o.$set(s)},i(e){s||(fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),s=!0)},o(e){de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),s=!1},d(e){e&&x(t),Se(n),Se(i),Se(o)}}}function G8(e,t,n){let{dugout:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class X8 extends $e{constructor(e){super(),Ee(this,e,G8,H8,s,{dugout:0,send:1,receive:2})}}function Y8(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,w,S,E=e[0].score+"",$=e[0].turn+"",A=e[0].name+"";return r=new N8({props:{reverse:!0}}),w=new X8({props:{dugout:e[0].dugout,send:e[1],receive:e[2]}}),{c(){t=_("div"),n=_("div"),ke(r.$$.fragment),i=O(),a=_("div"),o=k(E),s=O(),l=_("div"),u=k($),c=O(),f=_("div"),d=k(A),h=O(),p=_("img"),y=O(),ke(w.$$.fragment),D(n,"class","aids svelte-1dth5by"),D(a,"class","score svelte-1dth5by"),D(l,"class","turn svelte-1dth5by"),j(l,"active",e[0].active),D(f,"class","name svelte-1dth5by"),D(p,"class","logo svelte-1dth5by"),p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png")&&D(p,"src",m),D(p,"alt",g="Logo: "+e[0].logo),D(t,"class","dugout svelte-1dth5by")},m(e,m){b(e,t,m),v(t,n),Oe(r,n,null),v(t,i),v(t,a),v(a,o),v(t,s),v(t,l),v(l,u),v(t,c),v(t,f),v(f,d),v(t,h),v(t,p),v(t,y),Oe(w,t,null),S=!0},p(e,[t]){(!S||1&t)&&E!==(E=e[0].score+"")&&C(o,E),(!S||1&t)&&$!==($=e[0].turn+"")&&C(u,$),1&t&&j(l,"active",e[0].active),(!S||1&t)&&A!==(A=e[0].name+"")&&C(d,A),(!S||1&t&&p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png"))&&D(p,"src",m),(!S||1&t&&g!==(g="Logo: "+e[0].logo))&&D(p,"alt",g);const n={};1&t&&(n.dugout=e[0].dugout),2&t&&(n.send=e[1]),4&t&&(n.receive=e[2]),w.$set(n)},i(e){S||(fe(r.$$.fragment,e),fe(w.$$.fragment,e),S=!0)},o(e){de(r.$$.fragment,e),de(w.$$.fragment,e),S=!1},d(e){e&&x(t),Se(r),Se(w)}}}function J8(e,t,n){let{awayTeam:r}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"awayTeam"in e&&n(0,r=e.awayTeam),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class K8 extends $e{constructor(e){super(),Ee(this,e,J8,Y8,s,{awayTeam:0,send:1,receive:2})}}function Q8(t){let n;return{c(){n=_("div"),D(n,"class","logo svelte-5pwedy"),M(n,"background-image","url('/images/logo/256x256/logo_"+t[0]+".png')")},m(e,t){b(e,n,t)},p(e,[t]){1&t&&M(n,"background-image","url('/images/logo/256x256/logo_"+e[0]+".png')")},i:e,o:e,d(e){e&&x(n)}}}function Z8(e,t,n){let{logo:r}=t;return e.$$set=e=>{"logo"in e&&n(0,r=e.logo)},[r]}class e9 extends $e{constructor(e){super(),Ee(this,e,Z8,Q8,s,{logo:0})}}const t9=[];const n9=function(t,n=e){let r;const i=[];function a(e){if(s(t,e)&&(t=e,r)){const e=!t9.length;for(let e=0;e<i.length;e+=1){const n=i[e];n[1](),t9.push(n,t)}if(e){for(let e=0;e<t9.length;e+=2)t9[e][0](t9[e+1]);t9.length=0}}}return{set:a,update:function(e){a(e(t))},subscribe:function(o,s=e){const l=[o,s];return i.push(l),1===i.length&&(r=n(a)||e),o(t),()=>{const e=i.indexOf(l);-1!==e&&i.splice(e,1),0===i.length&&(r(),r=null)}}}}(300);function r9(e){let t,n,r,i,a;return{c(){t=_("div"),D(t,"class",n=f(`cell sprite ${e[6]}`)+" svelte-1oo7fl9"),j(t,"target",e[1]),j(t,"moved",e[3]),j(t,"pushback-choice",e[2])},m(e,n){b(e,t,n),a=!0},p(r,i){e=r,(!a||64&i&&n!==(n=f(`cell sprite ${e[6]}`)+" svelte-1oo7fl9"))&&D(t,"class",n),66&i&&j(t,"target",e[1]),72&i&&j(t,"moved",e[3]),68&i&&j(t,"pushback-choice",e[2])},i(n){a||(Q((()=>{i&&i.end(1),r||(r=pe(t,r8,{duration:.1*e[7]})),r.start()})),a=!0)},o(n){r&&r.invalidate(),i=me(t,r8,{duration:.1*e[7]}),a=!1},d(e){e&&x(t),e&&i&&i.end()}}}function i9(e){let t,n,r,i;return{c(){t=_("div"),D(t,"class","cell sprite svelte-1oo7fl9"),j(t,"active",e[0])},m(e,n){b(e,t,n),i=!0},p(e,n){1&n&&j(t,"active",e[0])},i(a){i||(Q((()=>{r&&r.end(1),n||(n=pe(t,e[5],{key:"active-cell"})),n.start()})),i=!0)},o(a){n&&n.invalidate(),r=me(t,e[4],{key:"active-cell"}),i=!1},d(e){e&&x(t),e&&r&&r.end()}}}function a9(e){let t,n,r,i;const a=[i9,r9],o=[];function s(e,t){return e[0]?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=S()},m(e,n){o[t].m(e,n),b(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(ue(),de(o[l],1,1,(()=>{o[l]=null})),ce(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),fe(n,1),n.m(r.parentNode,r))},i(e){i||(fe(n),i=!0)},o(e){de(n),i=!1},d(e){o[t].d(e),e&&x(r)}}}function o9(e,t,n){let r;l(e,n9,(e=>n(7,r=e)));let i,{plus:a=null}=t,{active:o=!1}=t,{target:s=!1}=t,{pushbackChoice:u=!1}=t,{moved:c=!1}=t,{send:f}=t,{receive:d}=t;return e.$$set=e=>{"plus"in e&&n(8,a=e.plus),"active"in e&&n(0,o=e.active),"target"in e&&n(1,s=e.target),"pushbackChoice"in e&&n(2,u=e.pushbackChoice),"moved"in e&&n(3,c=e.moved),"send"in e&&n(4,f=e.send),"receive"in e&&n(5,d=e.receive)},e.$$.update=()=>{257&e.$$.dirty&&n(6,i=!o&&a?`plus${a}`:"")},[o,s,u,c,f,d,i,r,a]}class s9 extends $e{constructor(e){super(),Ee(this,e,o9,a9,s,{plus:8,active:0,target:1,pushbackChoice:2,moved:3,send:4,receive:5})}}function l9(e){let t,n,r,i;return{c(){t=_("div"),D(t,"id","ball"),D(t,"class","svelte-q0voaj"),j(t,"held",e[0])},m(e,n){b(e,t,n),i=!0},p(e,[n]){1&n&&j(t,"held",e[0])},i(a){i||(Q((()=>{r&&r.end(1),n||(n=pe(t,e[2],{key:"ball"})),n.start()})),i=!0)},o(a){n&&n.invalidate(),r=me(t,e[1],{key:"ball"}),i=!1},d(e){e&&x(t),e&&r&&r.end()}}}function u9(e,t,n){let{held:r=!1}=t,{send:i}=t,{receive:a}=t;return e.$$set=e=>{"held"in e&&n(0,r=e.held),"send"in e&&n(1,i=e.send),"receive"in e&&n(2,a=e.receive)},[r,i,a]}class c9 extends $e{constructor(e){super(),Ee(this,e,u9,l9,s,{held:0,send:1,receive:2})}}function f9(e,t,n){const r=e.slice();return r[2]=t[n],r}function d9(e){let t,n=e[0],r=[];for(let t=0;t<n.length;t+=1)r[t]=h9(f9(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=S()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);b(e,t,n)},p(e,i){if(3&i){let a;for(n=e[0],a=0;a<n.length;a+=1){const o=f9(e,n,a);r[a]?r[a].p(o,i):(r[a]=h9(o),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(e){w(r,e),e&&x(t)}}}function h9(e){let t,n;return{c(){t=_("div"),D(t,"class",n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")},m(e,n){b(e,t,n)},p(e,r){1&r&&n!==(n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")&&D(t,"class",n)},d(e){e&&x(t)}}}function p9(t){let n,r=t[0]&&d9(t);return{c(){n=_("div"),r&&r.c(),D(n,"class","dice-container svelte-1cue4bg")},m(e,t){b(e,n,t),r&&r.m(n,null)},p(e,[t]){e[0]?r?r.p(e,t):(r=d9(e),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&x(n),r&&r.d()}}}function m9(e,t,n){let{dice:r}=t;return e.$$set=e=>{"dice"in e&&n(0,r=e.dice)},[r,["attacker-down","both-down","push","defender-stumbles","defender-down"]]}class g9 extends $e{constructor(e){super(),Ee(this,e,m9,p9,s,{dice:0})}}function y9(t){let n;return{c(){n=_("div"),n.innerHTML='<div class="dice sprite d1h foul svelte-u76c3n"></div>',D(n,"class","dice-container svelte-u76c3n")},m(e,t){b(e,n,t)},p:e,i:e,o:e,d(e){e&&x(n)}}}class v9 extends $e{constructor(e){super(),Ee(this,e,null,y9,s,{})}}function b9(e){let t,n;return t=new e9({props:{logo:e[3].toLowerCase()}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.logo=e[3].toLowerCase()),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function x9(e){let t,n;return t=new e9({props:{logo:e[4].toLowerCase()}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.logo=e[4].toLowerCase()),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function w9(e){let t,r;const i=[e[8],{send:e[5]},{receive:e[6]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new s9({props:a}),{c(){ke(t.$$.fragment)},m(e,n){Oe(t,e,n),r=!0},p(e,n){const r=352&n?xe(i,[256&n&&we(e[8]),32&n&&{send:e[5]},64&n&&{receive:e[6]}]):{};t.$set(r)},i(e){r||(fe(t.$$.fragment,e),r=!0)},o(e){de(t.$$.fragment,e),r=!1},d(e){Se(t,e)}}}function _9(e){let t,r;const i=[e[7],{send:e[5]},{receive:e[6]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new _8({props:a}),{c(){ke(t.$$.fragment)},m(e,n){Oe(t,e,n),r=!0},p(e,n){const r=224&n?xe(i,[128&n&&we(e[7]),32&n&&{send:e[5]},64&n&&{receive:e[6]}]):{};t.$set(r)},i(e){r||(fe(t.$$.fragment,e),r=!0)},o(e){de(t.$$.fragment,e),r=!1},d(e){Se(t,e)}}}function k9(e){let t,n;return t=new g9({props:{dice:e[10]}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,n){const r={};1024&n&&(r.dice=e[10]),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function O9(e){let t,n;return t=new v9({}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function S9(e){let t,r;const i=[e[9],{send:e[5]},{receive:e[6]}];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new c9({props:a}),{c(){ke(t.$$.fragment)},m(e,n){Oe(t,e,n),r=!0},p(e,n){const r=608&n?xe(i,[512&n&&we(e[9]),32&n&&{send:e[5]},64&n&&{receive:e[6]}]):{};t.$set(r)},i(e){r||(fe(t.$$.fragment,e),r=!0)},o(e){de(t.$$.fragment,e),r=!1},d(e){Se(t,e)}}}function E9(e){let t,n,r,i,a,o,s,l,u=0==e[2]&&7==e[1]&&e[3]&&b9(e),c=25==e[2]&&7==e[1]&&e[4]&&x9(e),f=e[8]&&w9(e),d=e[7]&&_9(e),h=e[10]&&k9(e),p=e[11]&&O9(),m=e[9]&&S9(e);return{c(){t=_("div"),u&&u.c(),n=O(),c&&c.c(),r=O(),f&&f.c(),i=O(),d&&d.c(),a=O(),h&&h.c(),o=O(),p&&p.c(),s=O(),m&&m.c(),D(t,"id",e[0]),D(t,"class","pitch-square svelte-124v8fk")},m(e,g){b(e,t,g),u&&u.m(t,null),v(t,n),c&&c.m(t,null),v(t,r),f&&f.m(t,null),v(t,i),d&&d.m(t,null),v(t,a),h&&h.m(t,null),v(t,o),p&&p.m(t,null),v(t,s),m&&m.m(t,null),l=!0},p(e,[g]){0==e[2]&&7==e[1]&&e[3]?u?(u.p(e,g),14&g&&fe(u,1)):(u=b9(e),u.c(),fe(u,1),u.m(t,n)):u&&(ue(),de(u,1,1,(()=>{u=null})),ce()),25==e[2]&&7==e[1]&&e[4]?c?(c.p(e,g),22&g&&fe(c,1)):(c=x9(e),c.c(),fe(c,1),c.m(t,r)):c&&(ue(),de(c,1,1,(()=>{c=null})),ce()),e[8]?f?(f.p(e,g),256&g&&fe(f,1)):(f=w9(e),f.c(),fe(f,1),f.m(t,i)):f&&(ue(),de(f,1,1,(()=>{f=null})),ce()),e[7]?d?(d.p(e,g),128&g&&fe(d,1)):(d=_9(e),d.c(),fe(d,1),d.m(t,a)):d&&(ue(),de(d,1,1,(()=>{d=null})),ce()),e[10]?h?(h.p(e,g),1024&g&&fe(h,1)):(h=k9(e),h.c(),fe(h,1),h.m(t,o)):h&&(ue(),de(h,1,1,(()=>{h=null})),ce()),e[11]?p?2048&g&&fe(p,1):(p=O9(),p.c(),fe(p,1),p.m(t,s)):p&&(ue(),de(p,1,1,(()=>{p=null})),ce()),e[9]?m?(m.p(e,g),512&g&&fe(m,1)):(m=S9(e),m.c(),fe(m,1),m.m(t,null)):m&&(ue(),de(m,1,1,(()=>{m=null})),ce()),(!l||1&g)&&D(t,"id",e[0])},i(e){l||(fe(u),fe(c),fe(f),fe(d),fe(h),fe(p),fe(m),l=!0)},o(e){de(u),de(c),de(f),de(d),de(h),de(p),de(m),l=!1},d(e){e&&x(t),u&&u.d(),c&&c.d(),f&&f.d(),d&&d.d(),h&&h.d(),p&&p.d(),m&&m.d()}}}function $9(e,t,n){let{id:r}=t,{row:i}=t,{column:a}=t,{width:o}=t,{height:s}=t,{pitch:l}=t,{homeLogo:u}=t,{awayLogo:c}=t,{send:f}=t,{receive:d}=t,h=null,p=null,m=null,g=null,y=!1;return e.$$set=e=>{"id"in e&&n(0,r=e.id),"row"in e&&n(1,i=e.row),"column"in e&&n(2,a=e.column),"width"in e&&n(12,o=e.width),"height"in e&&n(13,s=e.height),"pitch"in e&&n(14,l=e.pitch),"homeLogo"in e&&n(3,u=e.homeLogo),"awayLogo"in e&&n(4,c=e.awayLogo),"send"in e&&n(5,f=e.send),"receive"in e&&n(6,d=e.receive)},e.$$.update=()=>{16390&e.$$.dirty&&n(7,({player:h,cell:p,ball:m,dice:g,foul:y}=l[`${a}-${i}`]||{}),h,(n(8,p),n(14,l),n(2,a),n(1,i)),(n(9,m),n(14,l),n(2,a),n(1,i)),(n(10,g),n(14,l),n(2,a),n(1,i)),(n(11,y),n(14,l),n(2,a),n(1,i)))},[r,i,a,u,c,f,d,h,p,m,g,y,o,s,l]}class A9 extends $e{constructor(e){super(),Ee(this,e,$9,E9,s,{id:0,row:1,column:2,width:12,height:13,pitch:14,homeLogo:3,awayLogo:4,send:5,receive:6})}}function D9(e){let t,n,r;return n=new y8({props:{width:26,height:15,prefix:"pos",component:A9,componentProps:{homeLogo:e[3],awayLogo:e[4],pitch:e[0],send:e[1],receive:e[2]}}}),{c(){t=_("div"),ke(n.$$.fragment),D(t,"class","pitch svelte-1d39j5z")},m(e,i){b(e,t,i),Oe(n,t,null),r=!0},p(e,[t]){const r={};31&t&&(r.componentProps={homeLogo:e[3],awayLogo:e[4],pitch:e[0],send:e[1],receive:e[2]}),n.$set(r)},i(e){r||(fe(n.$$.fragment,e),r=!0)},o(e){de(n.$$.fragment,e),r=!1},d(e){e&&x(t),Se(n)}}}function C9(e,t,n){let r,i,{homeTeam:a}=t,{awayTeam:o}=t,{pitch:s}=t,{send:l}=t,{receive:u}=t;return e.$$set=e=>{"homeTeam"in e&&n(5,a=e.homeTeam),"awayTeam"in e&&n(6,o=e.awayTeam),"pitch"in e&&n(0,s=e.pitch),"send"in e&&n(1,l=e.send),"receive"in e&&n(2,u=e.receive)},e.$$.update=()=>{96&e.$$.dirty&&(n(3,r=a.logo),n(4,i=o.logo))},[s,l,u,r,i,a,o]}class M9 extends $e{constructor(e){super(),Ee(this,e,C9,D9,s,{homeTeam:5,awayTeam:6,pitch:0,send:1,receive:2})}}function j9(e){let t,n;return{c(){t=_("div"),D(t,"class",n=f(`sprite ${e[0]}`)+" svelte-39bs0u")},m(e,n){b(e,t,n)},p(e,r){1&r&&n!==(n=f(`sprite ${e[0]}`)+" svelte-39bs0u")&&D(t,"class",n)},d(e){e&&x(t)}}}function F9(e){let t,n,r;return n=new s8({props:{width:2,height:1,$$slots:{default:[j9]},$$scope:{ctx:e}}}),{c(){t=_("div"),ke(n.$$.fragment),D(t,"class","banner svelte-39bs0u")},m(e,i){b(e,t,i),Oe(n,t,null),r=!0},p(e,[t]){const r={};3&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i(e){r||(fe(n.$$.fragment,e),r=!0)},o(e){de(n.$$.fragment,e),r=!1},d(e){e&&x(t),Se(n)}}}function T9(e,t,n){let{banner:r}=t;return e.$$set=e=>{"banner"in e&&n(0,r=e.banner)},[r]}class N9 extends $e{constructor(e){super(),Ee(this,e,T9,F9,s,{banner:0})}}const{document:R9}=ge;function P9(e,t,n){const r=e.slice();return r[49]=t[n],r}function z9(e,t){let n,r;return{key:e,first:null,c(){n=_("link"),D(n,"rel","stylesheet"),D(n,"href",r="/styles/"+t[49]+".css"),this.first=n},m(e,t){b(e,n,t)},p(e,t){1&t[0]&&r!==(r="/styles/"+e[49]+".css")&&D(n,"href",r)},d(e){e&&x(n)}}}function B9(e){let t,n;return t=new N9({props:{banner:e[4]}}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},p(e,n){const r={};16&n[0]&&(r.banner=e[4]),t.$set(r)},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function I9(e){let t,n,r,i,a,o,s,l,u;n=new W8({props:{homeTeam:e[1],weather:e[5],send:e[6],receive:e[7]}}),i=new M9({props:{pitch:e[3],homeTeam:e[1],awayTeam:e[2],send:e[6],receive:e[7]}}),o=new K8({props:{awayTeam:e[2],send:e[6],receive:e[7]}});let c=e[4]&&B9(e);return{c(){t=_("div"),ke(n.$$.fragment),r=O(),ke(i.$$.fragment),a=O(),ke(o.$$.fragment),s=O(),c&&c.c(),l=S(),D(t,"class","pitch svelte-70qdsx")},m(e,f){b(e,t,f),Oe(n,t,null),v(t,r),Oe(i,t,null),v(t,a),Oe(o,t,null),b(e,s,f),c&&c.m(e,f),b(e,l,f),u=!0},p(e,t){const r={};2&t[0]&&(r.homeTeam=e[1]),32&t[0]&&(r.weather=e[5]),n.$set(r);const a={};8&t[0]&&(a.pitch=e[3]),2&t[0]&&(a.homeTeam=e[1]),4&t[0]&&(a.awayTeam=e[2]),i.$set(a);const s={};4&t[0]&&(s.awayTeam=e[2]),o.$set(s),e[4]?c?(c.p(e,t),16&t[0]&&fe(c,1)):(c=B9(e),c.c(),fe(c,1),c.m(l.parentNode,l)):c&&(ue(),de(c,1,1,(()=>{c=null})),ce())},i(e){u||(fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),fe(c),u=!0)},o(e){de(n.$$.fragment,e),de(i.$$.fragment,e),de(o.$$.fragment,e),de(c),u=!1},d(e){e&&x(t),Se(n),Se(i),Se(o),e&&x(s),c&&c.d(e),e&&x(l)}}}function L9(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[49];for(let t=0;t<s.length;t+=1){let n=P9(e,s,t),r=l(n);o.set(r,a[t]=z9(r,n))}return r=new s8({props:{width:1335,height:1061,$$slots:{default:[I9]},$$scope:{ctx:e}}}),{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=_("link"),n=O(),ke(r.$$.fragment),D(t,"rel","stylesheet"),D(t,"href","/styles/sprite.css")},m(e,o){for(let e=0;e<a.length;e+=1)a[e].m(R9.head,null);v(R9.head,t),b(e,n,o),Oe(r,e,o),i=!0},p(e,n){if(1&n[0]){const r=e[0];a=be(a,n,l,1,e,r,o,t.parentNode,ye,z9,t,P9)}const i={};62&n[0]|2097152&n[1]&&(i.$$scope={dirty:n,ctx:e}),r.$set(i)},i(e){i||(fe(r.$$.fragment,e),i=!0)},o(e){de(r.$$.fragment,e),i=!1},d(e){for(let e=0;e<a.length;e+=1)a[e].d();x(t),e&&x(n),Se(r,e)}}}function q9(e,t){return{logo:e.Data.Logo.toLowerCase(),dugout:{cas:[],ko:[],reserve:[]},score:e.Touchdown||0,name:e.Data.Name,turn:e.GameTurn||1,active:t}}function U9(e){return e&&e.length?e:e?[e]:[]}function V9(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}function W9(e){}function H9(e,t,n){let r;l(e,n9,(e=>n(16,r=e)));let i,a,o,s,u,c,{replaySteps:f}=t,{replayStepIndex:d}=t,{replayStart:h}=t,{replayEnd:p}=t,m=[],g={},y={},v={};const b={[ct.Reserves]:"reserve",[ct.KO]:"ko",[ct.Casualty]:"cas",[ct.SentOff]:"cas"},[x,w]=i8({duration:e=>.5*r,easing:n8,fallback(e,t){const n=getComputedStyle(e),i="none"===n.transform?"":n.transform;return{duration:.5*r,easing:n8,css:e=>`\n\t\t\t\t\ttransform: ${i} scale(${e});\n\t\t\t\t\topacity: ${e}\n\t\t\t\t`}}});async function _(e,t,r){i=e.slice(t,r),t>0?await k(e[t-1].BoardState):(a=0,o=null,n(0,m=[]),n(1,g={}),n(2,y={}),n(3,v={}),n(5,c=dt))}async function k(e){D(),s=e.BlitzerId,n(1,g=q9(e.ListTeams.TeamState[0],1!=e.ActiveTeam)),n(2,y=q9(e.ListTeams.TeamState[1],1==e.ActiveTeam)),n(0,m=e.ListTeams.TeamState.map((e=>en[e.Data.IdRace])).filter(((e,t,n)=>n.indexOf(e)===t))),function(e){Object.values(v).forEach((e=>{e.player&&(e.player=null)})),e.ListTeams.TeamState[0].ListPitchPlayers.PlayerState.map((e=>E(e,"home"))),e.ListTeams.TeamState[1].ListPitchPlayers.PlayerState.map((e=>E(e,"away")))}(e),function(e){let{x:t,y:n}=e.Ball.Cell;Object.values(v).forEach((e=>{e.ball=null})),-1!=t&&-1!=n&&(O(e.Ball.Cell).ball={held:1==e.Ball.IsHeld})}(e),await K()}function O(e){return n(3,v[`${e.x||0}-${e.y||0}`]=v[`${e.x||0}-${e.y||0}`]||{},v)}function S(e){let t;return Object.entries(v).forEach((([r,i])=>{i.player&&i.player.id==e&&(n(3,v[r]=i,v),t=i.player)})),t}function E(e,t){let n=function(e,t){switch(t){case 71:case 414:case 459:return{race:"amazon",model:"blitzer"+(e%2+1)};case 70:case 413:case 458:return{race:"amazon",model:"catcher"+(e%2+1)};case 68:case 411:case 456:return{race:"amazon",model:"lineman"+(e%2+1)};case 69:case 457:case 412:return{race:"amazon",model:"thrower"};case 32:case 336:case 355:return{race:"chaos",model:"beastman"+(e%4+1)};case 34:case 338:case 357:return{race:"chaos",model:"minotaur"+(e%3+1)};case 33:case 337:case 356:return{race:"chaos",model:"warrior"+(e%6+1)};case 330:case 363:case 109:return{race:"chaosdwarf",model:"blocker"+(e%4+1)};case 331:case 364:case 110:return{race:"chaosdwarf",model:"bullcentaur"+(e%2+1)};case 329:case 362:case 108:return{race:"chaosdwarf",model:"hobgoblin"+(e%4+1)};case 332:case 365:case 111:return{race:"chaosdwarf",model:"minotaur"};case 47:case 345:case 391:return{race:"darkelf",model:"lineman"};case 48:case 347:case 392:return{race:"darkelf",model:"runner"};case 49:case 346:case 394:return{race:"darkelf",model:"assasin"};case 50:case 344:case 393:return{race:"darkelf",model:"blitzer"};case 51:case 348:case 395:return{race:"darkelf",model:"witchelf"};case 6:case 426:return{race:"dwarf",model:"longbeard"+(e%3+1)};case 8:case 427:return{race:"dwarf",model:"blitzer"+(e%2+1)};case 7:case 429:return{race:"dwarf",model:"runner"+(e%3+1)};case 9:case 428:return{race:"dwarf",model:"trollslayer"+(e%2+1)};case 10:case 430:return{race:"dwarf",model:"deathroller"};case 30:case 372:case 466:case 479:return{race:"goblin",model:"goblin"+(e%7+1)};case 31:case 373:case 467:case 481:return{race:"goblin",model:"looney"+(e%2+1)};case 44:case 377:case 471:case 484:return{race:"goblin",model:"troll"+(e%3+1)};case 45:case 374:case 468:case 482:return{race:"goblin",model:"pogo"+(e%2+1)};case 46:case 376:case 470:case 483:return{race:"goblin",model:"fanatic"+(e%2+1)};case 107:case 375:case 469:case 480:return{race:"goblin",model:"bomber"+(e%2+1)};case 60:case 431:case 485:return{race:"halfling",model:"halfling"+(e%5+1)};case 61:case 432:case 486:return{race:"halfling",model:"treeman"+(e%3+1)};case 77:case 323:case 387:return{race:"highelf",model:"lineman"+(e%2+1)};case 78:case 325:case 390:return{race:"highelf",model:"thrower"};case 79:case 389:case 326:return{race:"highelf",model:"catch"+(e%2+1)};case 80:case 324:case 388:return{race:"highelf",model:"blitzer"};case 1:case 422:case 438:return{race:"human",model:"lineman"+(e%2+1)};case 2:case 423:case 440:return{race:"human",model:"catcher"};case 3:case 424:case 441:return{race:"human",model:"thrower"};case 4:case 421:case 439:return{race:"human",model:"blitzer"};case 5:case 425:case 442:return{race:"human",model:"ogre"};case 81:case 499:return{race:"khemri",model:"lineman"+(e%4+1)};case 82:case 500:return{race:"khemri",model:"thrower"+(e%2+1)};case 83:case 501:return{race:"khemri",model:"blitzer"+(e%2+1)};case 84:case 502:return{race:"khemri",model:"mummy"+(e%2+1)};case 27:case 415:case 472:return{race:"lizardman",model:"skink"+(e%4+1)};case 28:case 416:case 473:return{race:"lizardman",model:"saurus"+(e%4+1)};case 29:case 417:case 474:return{race:"lizardman",model:"kroxigor"+(e%2+1)};case 86:return{race:"necromantic",model:"zombie"+(e%4+1)};case 87:return{race:"necromantic",model:"ghoul"+(e%2+1)};case 88:return{race:"necromantic",model:"wight"+(e%2+1)};case 89:case 498:return{race:"necromantic",model:"golem"+(e%2+1)};case 90:case 497:return{race:"necromantic",model:"werewolf"+(e%2+1)};case 62:case 405:case 450:return{race:"norse",model:"lineman"+(e%4+1)};case 63:case 406:case 452:return{race:"norse",model:"thrower"};case 64:case 407:case 451:return{race:"norse",model:"runner"};case 65:case 408:case 453:return{race:"norse",model:"berserker"+(e%2+1)};case 66:case 409:case 454:return{race:"norse",model:"ulfwerener"+(e%2+1)};case 67:case 410:case 455:return{race:"norse",model:"yhetee"};case 91:case 358:return{race:"nurgle",model:"rotter"+(e%6+1)};case 92:case 359:return{race:"nurgle",model:"pestigor"+(e%4+1)};case 93:case 360:return{race:"nurgle",model:"warrior"+(e%4+1)};case 94:case 361:return{race:"nurgle",model:"beast - of - nurgle"};case 95:case 476:case 478:case 737:return{race:"ogre",model:"snotling"+(e%7+1)};case 96:case 475:case 477:case 738:return{race:"ogre",model:"ogre"+(e%6+1)};case 21:case 366:case 460:return{race:"orc",model:"lineman"+(e%3+1)};case 22:case 369:case 463:return{race:"orc",model:"goblin"+(e%2+1)};case 23:case 368:case 462:return{race:"orc",model:"thrower"+(e%2+1)};case 24:case 370:case 464:return{race:"orc",model:"blocker"+(e%4+1)};case 25:case 367:case 461:return{race:"orc",model:"blitzer"+(e%3+1)};case 26:case 371:case 465:return{race:"orc",model:"troll"};case 72:case 739:return{race:"proelf",model:"lineman"+(e%2+1)};case 73:case 741:return{race:"proelf",model:"thrower"};case 74:case 749:return{race:"proelf",model:"catcher"+(e%2+1)};case 75:case 740:return{race:"proelf",model:"blitzer"+(e%2+1)};case 16:case 339:case 378:return{race:"skaven",model:"lineman"+(e%3+1)};case 17:case 340:case 380:return{race:"skaven",model:"thrower"};case 18:case 341:case 381:return{race:"skaven",model:"runner"+(e%2+1)};case 19:case 342:case 379:return{race:"skaven",model:"blitzer"+(e%2+1)};case 20:case 343:case 382:return{race:"skaven",model:"ratogre"};case 54:case 492:return{race:"undead",model:"skeleton"+(e%3+1)};case 55:case 493:return{race:"undead",model:"zombie"+(e%4+1)};case 56:case 494:return{race:"undead",model:"ghoul"+(e%2+1)};case 57:case 495:return{race:"undead",model:"wight"+(e%2+1)};case 58:case 496:return{race:"undead",model:"mummy"+(e%2+1)};case 123:case 732:return{race:"underworld",model:"goblin"+(e%5+1)};case 124:case 733:return{race:"underworld",model:"lineman"+(e%4+1)};case 125:case 734:return{race:"underworld",model:"thrower"+(e%2+1)};case 126:case 735:return{race:"underworld",model:"blitzer"+(e%2+1)};case 127:case 736:return{race:"underworld",model:"troll"};case 97:case 327:case 327:case 503:return{race:"vampire",model:"thrall"+(e%3+1)};case 98:case 328:case 328:case 504:return{race:"vampire",model:"vampire"+(e%3+1)};case 11:case 396:case 433:return{race:"woodelf",model:"lineman"+(e%4+1)};case 12:case 397:case 434:return{race:"woodelf",model:"catcher"+(e%4+1)};case 13:case 398:case 435:return{race:"woodelf",model:"thrower"+(e%2+1)};case 14:case 399:case 436:return{race:"woodelf",model:"wardancer"+(e%2+1)};case 15:case 400:case 437:return{race:"woodelf",model:"tree"};case 142:case 401:case 446:return{race:"kislev",model:"lineman"+(e%4+1)};case 143:case 403:case 448:return{race:"kislev",model:"catcher"+(e%2+1)};case 144:case 402:case 447:return{race:"kislev",model:"blitzer"+(e%2+1)};case 145:case 404:case 449:return{race:"kislev",model:"bear"};case 139:case 333:case 420:case 443:return{race:"bretonnia",model:"peasant"+(e%3+1)};case 140:case 335:case 419:case 445:return{race:"bretonnia",model:"blocker"+(e%2+1)};case 141:case 334:case 418:case 444:return{race:"bretonnia",model:"knight"+(e%2+1)};case 146:case 239:case 617:case 618:return{model:"barik-farblast",race:"starplayer"};case 293:case 294:case 619:case 620:return{model:"bertha-bigfist",race:"starplayer"};case 133:case 233:case 621:case 622:return{model:"bomber-dribblesnot",race:"starplayer"};case 309:case 310:case 623:case 624:return{model:"boomer-eziasson",race:"starplayer"};case 164:case 256:case 625:case 626:return{model:"brick-farth",race:"starplayer"};case 224:case 59:case 627:case 628:return{model:"count-luthorvon-drakenborg",race:"starplayer"};case 301:case 302:case 629:case 630:return{model:"crazy-igor",race:"starplayer"};case 103:case 229:case 631:case 632:return{model:"deeproot-strongbranch",race:"starplayer"};case 147:case 240:case 633:case 634:return{model:"dolfar-longstride",race:"starplayer"};case 101:case 227:case 635:case 636:return{model:"eldril-sidewinder",race:"starplayer"};case 154:case 247:case 637:case 638:return{model:"fezglitch",race:"starplayer"};case 313:case 314:case 639:case 640:return{model:"flint-churnblade",race:"starplayer"};case 303:case 304:case 641:case 642:return{model:"fungus-the-loon",race:"starplayer"};case 149:case 242:case 643:case 644:return{model:"glart-smashrip-jr",race:"starplayer"};case 214:case 36:case 645:case 646:return{model:"grashnak-blackhoof",race:"starplayer"};case 215:case 37:case 647:case 648:return{model:"griff-oberwald",race:"starplayer"};case 216:case 38:case 649:case 650:return{model:"grim-ironjaw",race:"starplayer"};case 148:case 241:case 651:case 652:return{model:"grotty",race:"starplayer"};case 315:case 316:case 653:case 654:return{model:"hack-enslash",race:"starplayer"};case 138:case 238:case 655:case 656:return{model:"hakflem-skuttlespike",race:"starplayer"};case 217:case 39:case 657:case 658:return{model:"headsplitter",race:"starplayer"};case 317:case 318:case 659:case 660:return{model:"helmut-wulf",race:"starplayer"};case 275:case 276:case 661:case 662:return{model:"hemlock",race:"starplayer"};case 222:case 52:case 663:case 664:return{model:"horkon-heartripper",race:"starplayer"};case 299:case 300:case 665:case 666:return{model:"hthark-the-unstoppable",race:"starplayer"};case 137:case 237:case 667:case 668:return{model:"hubris-rakarth",race:"starplayer"};case 307:case 308:case 669:case 670:return{model:"humerus-carpal",race:"starplayer"};case 106:case 232:case 671:case 672:return{model:"icepelt-hammerblow",race:"starplayer"};case 157:case 250:case 673:case 674:return{model:"ithaca-benoin",race:"starplayer"};case 136:case 236:case 675:case 676:return{model:"j-earlice",race:"starplayer"};case 218:case 40:case 677:case 678:return{model:"jordel-freshbreeze",race:"starplayer"};case 158:case 251:case 679:case 680:return{model:"lewdgrip-whiparm",race:"starplayer"};case 102:case 228:case 683:case 684:return{model:"lord-borak-the-despoiler",race:"starplayer"};case 281:case 282:case 681:case 682:return{model:"lottabottol",race:"starplayer"};case 160:case 252:case 685:case 686:return{model:"max-spleenripper",race:"starplayer"};case 135:case 235:case 687:case 688:return{model:"mighty-zug",race:"starplayer"};case 223:case 53:case 689:case 690:return{model:"morg-n-thorg",race:"starplayer"};case 305:case 306:case 693:case 694:return{model:"nobbla-blackwart",race:"starplayer"};case 150:case 243:case 691:case 692:return{model:"prince-moranion",race:"starplayer"};case 161:case 253:case 695:case 696:return{model:"puggy-baconbreath",race:"starplayer"};case 283:case 284:case 697:case 698:return{model:"quetzal-leap",race:"starplayer"};case 231:case 699:case 700:case 105:return{model:"ramtut-iii",race:"starplayer"};case 295:case 296:case 701:case 702:return{model:"rashnak-backstabber",race:"starplayer"};case 219:case 41:case 703:case 704:return{model:"ripper",race:"starplayer"};case 151:case 244:case 705:case 706:return{model:"roxanna-darknail",race:"starplayer"};case 100:case 226:case 707:case 708:return{model:"scrappa-sorehead",race:"starplayer"};case 104:case 230:case 709:case 710:return{model:"setekh",race:"starplayer"};case 319:case 320:case 711:case 712:return{model:"sinnedbad",race:"starplayer"};case 162:case 254:case 713:case 714:return{model:"skitter-stab-stab",race:"starplayer"};case 220:case 42:case 715:case 716:return{model:"slibli",race:"starplayer"};case 152:case 245:case 717:case 718:return{model:"soaren-hightower",race:"starplayer"};case 163:case 255:case 719:case 720:return{model:"ugroth-bolgrot",race:"starplayer"};case 221:case 43:case 721:case 722:return{model:"varag-ghoul-chewer",race:"starplayer"};case 277:case 278:case 725:case 726:return{model:"wilhelm-chaney",race:"starplayer"};case 279:case 280:case 723:case 724:return{model:"willow-rosebark",race:"starplayer"};case 225:case 727:case 728:case 99:return{model:"zara-the-slayer",race:"starplayer"};case 134:case 234:case 729:case 730:return{model:"zzharg-madeye",race:"starplayer"}}}(e.Id,e.Data.IdPlayerTypes);switch(n.id=e.Id,n.team=t,e.Status){case 1:n.prone=!0;break;case 2:n.stunned=!0}switch(e.disabled&&(e.usedSkills.indexOf(20)>-1?n.disabled="Rooted":e.usedSkills.indexOf(31)>-1?n.disabled="BoneHeaded":e.usedSkills.indexOf(51)>-1&&(n.disabled="Stupid")),e.Situation>=ct.Casualty&&(e.Situation===ct.Casualty?n.cas=tn[Math.max(...V9(e.ListCasualties))].icon:n.cas="Expelled"),e.Situation){case ct.Active:n.done=1!=e.CanAct,O(e.Cell).player=n;break;default:"home"==t?g.dugout[b[e.Situation]].push(n):y.dugout[b[e.Situation]].push(n)}}L((()=>(console.log("Viewer onMount start"),async function(){for(;;){0===i.length&&await _(f,h,p);const e=i.shift();n(10,d=e.index);for(const t of U9(e.RulesEventBoardAction)){t.ActionType!==yt&&(o=null);for(const e of U9(t.Results.BoardActionResult)){const n=$[t.ActionType||0];try{n(t,e),await K()}catch(e){throw await K(),console.error("Action failed",{error:e,boardAction:t}),e}await A()}}e.RulesEventEndTurn&&M(e.RulesEventEndTurn),e.BoardState&&await k(e.BoardState)}}(),console.log("Viewer onMount queue started"),()=>console.log("destroyed"))));let $=[j,C,C,async function(e,t){if(!t.IsOrderCompleted)return;let n=O(e.Order.CellFrom);if(n.ball.held=!1,await K(),t.ResultType===bt){O(e.Order.CellTo.Cell).ball=n.ball,n.ball=null,await A()}},function(e){let t=O(e.Order.CellFrom);O(e.Order.CellTo.Cell).ball=t.ball,t.ball=null},async function(e){O(e.Order.CellTo.Cell).foul=!0,await A()},function(e,t){if(!t.IsOrderCompleted)return;let r,i;switch(Object.entries(v).forEach((([t,a])=>{a.cell&&(a.cell.target=null),a.player&&a.player.id==e.PlayerId&&(r=a.player,n(3,v[t]=a,v),i=t)})),t.RollType){case 3:1===t.ResultType&&(r.prone=!0);break;case 4:if(2===t.SubResultType)r.stunned=!0;else if(3===t.SubResultType){("home"==r.team?g.dugout:y.dugout).ko.push(r),n(3,v[i].player=null,v)}break;case 8:("home"==r.team?g.dugout:y.dugout).cas.push(r),n(3,v[i].player=null,v),n(3,v[i].blood={blood:Math.floor(4*Math.random()+1)},v)}},function(e){O(e.Order.CellTo.Cell).ball={held:!1}},function(e){O(e.Order.CellFrom).ball=null,O(e.Order.CellTo.Cell).ball={held:!1}},function(e,t){if(!t.IsOrderCompleted)return;if(0!==t.ResultType)return;Object.values(v).forEach((e=>e.ball=null)),O(e.Order.CellTo.Cell).ball={held:!0}},async function(){n(4,u="touchdown"),D(),await A(5),n(4,u=null),await K()},function(e){let t=S(e.PlayerId);t.stunned=!1,t.prone=!0},W9,W9,function(e,t){t.IsOrderCompleted&&t.ResultType===bt&&Object.values(v).forEach((e=>{e.ball&&(e.ball.held=!0)}))},function(e,t){let n=O(e.Order.CellTo.Cell);if(t.ResultType===bt)return void(n.player.stupidity=null);{const e={[nn.BoneHead]:"BoneHeaded",[nn.ReallyStupid]:"Stupid",[nn.TakeRoot]:"Rooted"};n.player.stupidity=e[t.RollType]}},W9,W9,W9,W9,W9,function(e){j(e)},W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,W9,function(e){D(),Object.entries(v).forEach((([t,r])=>{r.cell&&(r.cell.active=!1),r.player&&(r.player.id==e.ActivePlayerId&&(r.cell||(r.cell={}),r.cell.active=!0,r.player.prone=!1),r.player.id==a&&(r.player.done=!0),n(3,v[t]=r,v))})),a=e.PlayerId},W9,W9,W9,W9,function(e,t){const r=V9(t.CoachChoices.ListDices);n(5,c={2:ht,3:pt,11:mt,12:gt}[r[0]+r[1]]||dt)},W9,W9,W9,W9,W9,W9,W9,W9,W9,M];async function A(e){var t;await K(),await(t=r*(e||1),new Promise((e=>setTimeout(e,t))))}function D(){Object.entries(v).forEach((([e,t])=>{t.dice=null,t.cell=null,t.foul=!1,t.player&&(t.player.moving=!1),n(3,v[e]=t,v)}))}async function C(e,t){let n=O(e.Order.CellFrom);(n.cell=n.cell||{}).active=!0;let r=O(e.Order.CellTo.Cell),i=r.player;if(Object.values(v).forEach((e=>{e.dice=null})),t.RollType===nn.Block){let n=O(e.Order.CellTo.Cell);if(n.cell||(n.cell={}),n.cell.target=!0,t.IsOrderCompleted)n.dice=[V9(t.CoachChoices.ListDices)[0]];else{let e=V9(t.CoachChoices.ListDices);n.dice=e.slice(0,e.length/2)}await A(2)}if(t.RollType===nn.Push)if(t.IsOrderCompleted){Object.values(v).forEach((e=>{e.cell&&(e.cell.pushbackChoice=!1,e.cell.target=!1)}));let e=O(U9(t.CoachChoices.ListCells.Cell)[0]);o&&(i=o),o=e.player?e.player:null,e.player=i,r.player=null}else U9(t.CoachChoices.ListCells.Cell).forEach((e=>{let t=O(e);if(t.cell=t.cell||{},t.cell.pushbackChoice=!0,e.x<0||e.x>25||e.y<0||e.y>14)throw"Unexpected surf as a choice"}));if(t.RollType===nn.FollowUp&&t.IsOrderCompleted){const n=O(e.Order.CellFrom);O(U9(t.CoachChoices.ListCells.Cell)[0]).player=n.player;n.player=null}}async function M(e){e.Turnover&&(n(4,u="turnover"),D(),await A(5),n(4,u=null),await K())}function j(e,t){let n=S(e.PlayerId),r=O(e.Order.CellFrom),i=O(e.Order.CellTo.Cell);if(n.prone=!1,n.moving=!0,t.IsOrderCompleted&&i!=r&&(r.player=null,i.player=n),r.cell=r.cell||{},r.cell.moved=!0,r.cell.active=!1,t.IsOrderCompleted&&(i.cell=i.cell||{},i.cell.active=!0),t.RollType&&[nn.Dodge,nn.GFI,nn.Leap].includes(t.RollType)&&(i.cell=i.cell||{},i.cell.plus=t.Requirement),n.id==s&&(n.blitz=!0),r.ball){let e=r.ball;r.ball=null,i.ball=e}}return e.$$set=e=>{"replaySteps"in e&&n(11,f=e.replaySteps),"replayStepIndex"in e&&n(10,d=e.replayStepIndex),"replayStart"in e&&n(8,h=e.replayStart),"replayEnd"in e&&n(9,p=e.replayEnd)},e.$$.update=()=>{2816&e.$$.dirty[0]&&(i=[],console.log("About to reset queue",{replayStart:h,replayEnd:p}),n(8,h=h||0),n(9,p=Math.max(p||f.length,h+1)),console.log("Resetting queue",{replayStart:h,replayEnd:p,queue:f.slice(h,p)}))},[m,g,y,v,u,c,x,w,h,p,d,f]}class G9 extends $e{constructor(e){super(),Ee(this,e,H9,L9,s,{replaySteps:11,replayStepIndex:10,replayStart:8,replayEnd:9},[-1,-1])}}function X9(e){let t,n;return t=new Ua({}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function Y9(e){let t,n;return t=new Ja({}),{c(){ke(t.$$.fragment)},m(e,r){Oe(t,e,r),n=!0},i(e){n||(fe(t.$$.fragment,e),n=!0)},o(e){de(t.$$.fragment,e),n=!1},d(e){Se(t,e)}}}function J9(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,w,k;function S(t){e[9].call(null,t)}function E(t){e[10].call(null,t)}r=new Ha({props:{gameDetails:e[0].gameDetails,filename:e[0].fullReplay.filename}});let $={rolls:e[0].rolls,replayStepIndex:e[3]};function A(t){e[11].call(null,t)}void 0!==e[4]&&($.replayStart=e[4]),void 0!==e[5]&&($.replayEnd=e[5]),s=new J7({props:$}),W.push((()=>_e(s,"replayStart",S))),W.push((()=>_e(s,"replayEnd",E)));let C={replaySteps:e[0]&&e[0].fullReplay.ReplayStep,replayStart:e[4],replayEnd:e[5]};return void 0!==e[3]&&(C.replayStepIndex=e[3]),f=new G9({props:C}),W.push((()=>_e(f,"replayStepIndex",A))),m=new Po({props:{rolls:e[0].rolls,replayStepIndex:e[3]}}),w=new Xa({}),{c(){t=_("div"),n=_("div"),ke(r.$$.fragment),i=O(),a=_("div"),o=_("div"),ke(s.$$.fragment),c=O(),ke(f.$$.fragment),h=O(),p=_("div"),ke(m.$$.fragment),g=O(),y=_("div"),ke(w.$$.fragment),D(n,"class","row"),D(o,"class","col-8"),D(p,"class","col-4"),D(a,"class","row"),D(t,"class","container-fluid"),D(t,"role","main"),D(y,"class","container"),D(y,"role","main")},m(e,l){b(e,t,l),v(t,n),Oe(r,n,null),v(t,i),v(t,a),v(a,o),Oe(s,o,null),v(o,c),Oe(f,o,null),v(a,h),v(a,p),Oe(m,p,null),b(e,g,l),b(e,y,l),Oe(w,y,null),k=!0},p(e,t){const n={};1&t&&(n.gameDetails=e[0].gameDetails),1&t&&(n.filename=e[0].fullReplay.filename),r.$set(n);const i={};1&t&&(i.rolls=e[0].rolls),8&t&&(i.replayStepIndex=e[3]),!l&&16&t&&(l=!0,i.replayStart=e[4],Z((()=>l=!1))),!u&&32&t&&(u=!0,i.replayEnd=e[5],Z((()=>u=!1))),s.$set(i);const a={};1&t&&(a.replaySteps=e[0]&&e[0].fullReplay.ReplayStep),16&t&&(a.replayStart=e[4]),32&t&&(a.replayEnd=e[5]),!d&&8&t&&(d=!0,a.replayStepIndex=e[3],Z((()=>d=!1))),f.$set(a);const o={};1&t&&(o.rolls=e[0].rolls),8&t&&(o.replayStepIndex=e[3]),m.$set(o)},i(e){k||(fe(r.$$.fragment,e),fe(s.$$.fragment,e),fe(f.$$.fragment,e),fe(m.$$.fragment,e),fe(w.$$.fragment,e),k=!0)},o(e){de(r.$$.fragment,e),de(s.$$.fragment,e),de(f.$$.fragment,e),de(m.$$.fragment,e),de(w.$$.fragment,e),k=!1},d(e){e&&x(t),Se(r),Se(s),Se(f),Se(m),e&&x(g),e&&x(y),Se(w)}}}function K9(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,y,w,k,S,E,$,A,C,M,j,F,T,N;g=new e8({}),E=new Q7({}),A=new La({}),A.$on("replayLoaded",e[6]),A.$on("replayLoading",e[7]),A.$on("replayError",e[8]);let R=e[1]&&X9(),P=e[2]&&Y9(),z=e[0]&&J9(e);return{c(){t=_("meta"),n=_("meta"),r=_("meta"),i=_("meta"),a=_("meta"),o=_("meta"),s=_("meta"),l=_("meta"),u=_("meta"),c=_("meta"),f=_("meta"),d=_("link"),h=_("link"),p=O(),m=_("body"),ke(g.$$.fragment),y=O(),w=_("div"),k=_("div"),S=_("div"),ke(E.$$.fragment),$=O(),ke(A.$$.fragment),C=O(),R&&R.c(),M=O(),P&&P.c(),j=O(),z&&z.c(),F=O(),T=_("footer"),T.innerHTML='<div class="container svelte-n2fmn3"><p class="text-muted svelte-n2fmn3">This website is under active development. If you notice issues, please\n          post the replay and a description of the problem to\n          <a href="https://github.com/cpennington/dicedornot/issues">Diced Or Not Issues</a>.</p></div>',D(t,"charset","utf-8"),D(n,"http-equiv","x-ua-compatible"),D(n,"content","ie=edge"),D(r,"name","viewport"),D(r,"content","width=device-width, initial-scale=1.0"),D(i,"property","og:title"),D(i,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),D(a,"property","og:type"),D(a,"content","website"),D(o,"property","og:url"),D(o,"content","http://vengefulpickle.com/DicedOrNot"),D(s,"property","og:description"),D(s,"content","Blood Bowl 2 replay and luck analyzer. Use it to decide whether you actually got diced."),D(l,"name","twitter:card"),D(l,"content","summary"),D(u,"name","twitter:url"),D(u,"content","http://vengefulpickle.com/DicedOrNot"),D(c,"name","twitter:title"),D(c,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),D(f,"name","twitter:description"),D(f,"content","Blood Bowl 2 replay luck analyzer. Use it to decide whether you actually got diced."),document.title="Diced or Not? - Blood Bowl 2 Replay Luck Analyzer",D(d,"rel","stylesheet"),D(d,"href","https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"),D(d,"integrity","sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="),D(d,"crossorigin","anonymous"),D(h,"rel","stylesheet"),D(h,"href","https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/css/jquery.dataTables.min.css"),D(h,"integrity","sha256-YY1izqyhIj4W3iyJOaGWOpXDSwrHWFL4Nfk+W0LyCHE="),D(h,"crossorigin","anonymous"),D(S,"class","jumbotron svelte-n2fmn3"),D(k,"class","container-flex"),D(T,"class","footer svelte-n2fmn3"),D(T,"id","contact"),D(w,"id","content"),D(w,"class","svelte-n2fmn3")},m(e,x){v(document.head,t),v(document.head,n),v(document.head,r),v(document.head,i),v(document.head,a),v(document.head,o),v(document.head,s),v(document.head,l),v(document.head,u),v(document.head,c),v(document.head,f),v(document.head,d),v(document.head,h),b(e,p,x),b(e,m,x),Oe(g,m,null),v(m,y),v(m,w),v(w,k),v(k,S),Oe(E,S,null),v(S,$),Oe(A,S,null),v(k,C),R&&R.m(k,null),v(k,M),P&&P.m(k,null),v(w,j),z&&z.m(w,null),v(w,F),v(w,T),N=!0},p(e,[t]){e[1]?R?2&t&&fe(R,1):(R=X9(),R.c(),fe(R,1),R.m(k,M)):R&&(ue(),de(R,1,1,(()=>{R=null})),ce()),e[2]?P?4&t&&fe(P,1):(P=Y9(),P.c(),fe(P,1),P.m(k,null)):P&&(ue(),de(P,1,1,(()=>{P=null})),ce()),e[0]?z?(z.p(e,t),1&t&&fe(z,1)):(z=J9(e),z.c(),fe(z,1),z.m(w,F)):z&&(ue(),de(z,1,1,(()=>{z=null})),ce())},i(e){N||(fe(g.$$.fragment,e),fe(E.$$.fragment,e),fe(A.$$.fragment,e),fe(R),fe(P),fe(z),N=!0)},o(e){de(g.$$.fragment,e),de(E.$$.fragment,e),de(A.$$.fragment,e),de(R),de(P),de(z),N=!1},d(e){x(t),x(n),x(r),x(i),x(a),x(o),x(s),x(l),x(u),x(c),x(f),x(d),x(h),e&&x(p),e&&x(m),Se(g),Se(E),Se(A),R&&R.d(),P&&P.d(),z&&z.d()}}}function Q9(e,t,n){let r,i,a,o=!1,s=!1,l=0;return e.$$.update=()=>{1&e.$$.dirty&&console.log("Replay",r)},[r,o,s,l,i,a,e=>{n(1,o=!1),n(0,r=e.detail),n(4,i=null),n(5,a=null),console.log(e)},()=>{n(0,r=null),n(2,s=!1),n(1,o=!0)},()=>{n(1,o=!1),n(2,s=!0),n(0,r=null)},function(e){i=e,n(4,i)},function(e){a=e,n(5,a)},function(e){l=e,n(3,l)}]}return new class extends $e{constructor(e){super(),Ee(this,e,Q9,K9,s,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
