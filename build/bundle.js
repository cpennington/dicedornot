var app=function(){"use strict";function e(){}const t=e=>e;function n(e,t){for(const n in t)e[n]=t[n];return e}function r(e){return e()}function i(){return Object.create(null)}function a(e){e.forEach(r)}function o(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function l(e,t,r,i){return e[1]&&i?n(r.ctx.slice(),e[1](i(t))):r.ctx}function u(e,t,n,r,i,a,o){const s=function(e,t,n,r){if(e[2]&&r){const i=e[2](r(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|i[r];return e}return t.dirty|i}return t.dirty}(t,r,i,a);if(s){const i=l(t,n,r,o);e.p(i,s)}}function c(e){return null==e?"":e}const f="undefined"!=typeof window;let d=f?()=>window.performance.now():()=>Date.now(),h=f?e=>requestAnimationFrame(e):e;const p=new Set;function m(e){p.forEach((t=>{t.c(e)||(p.delete(t),t.f())})),0!==p.size&&h(m)}function g(e){let t;return 0===p.size&&h(m),{promise:new Promise((n=>{p.add(t={c:e,f:n})})),abort(){p.delete(t)}}}function y(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function b(e){e.parentNode.removeChild(e)}function x(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function w(e){return document.createElement(e)}function _(e){return document.createTextNode(e)}function k(){return _(" ")}function O(){return _("")}function S(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function $(e){return function(t){return t.preventDefault(),e.call(this,t)}}function E(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function A(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function D(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function C(e,t,n,r){e.style.setProperty(t,n,r?"important":"")}function M(e,t,n){e.classList[n?"add":"remove"](t)}function j(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const F=new Set;let T,N=0;function R(e,t,n,r,i,a,o,s=0){const l=16.666/r;let u="{\n";for(let e=0;e<=1;e+=l){const r=t+(n-t)*a(e);u+=100*e+`%{${o(r,1-r)}}\n`}const c=u+`100% {${o(n,1-n)}}\n}`,f=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(c)}_${s}`,d=e.ownerDocument;F.add(d);const h=d.__svelte_stylesheet||(d.__svelte_stylesheet=d.head.appendChild(w("style")).sheet),p=d.__svelte_rules||(d.__svelte_rules={});p[f]||(p[f]=!0,h.insertRule(`@keyframes ${f} ${c}`,h.cssRules.length));const m=e.style.animation||"";return e.style.animation=`${m?`${m}, `:""}${f} ${r}ms linear ${i}ms 1 both`,N+=1,f}function P(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),i=n.length-r.length;i&&(e.style.animation=r.join(", "),N-=i,N||h((()=>{N||(F.forEach((e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}})),F.clear())})))}function z(e){T=e}function B(){if(!T)throw new Error("Function called outside component initialization");return T}function L(e){B().$$.on_mount.push(e)}function I(){const e=B();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const i=j(t,n);r.slice().forEach((t=>{t.call(e,i)}))}}}function q(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}const U=[],V=[],W=[],H=[],G=Promise.resolve();let X=!1;function Y(){X||(X=!0,G.then(te))}function J(){return Y(),G}function K(e){W.push(e)}function Q(e){H.push(e)}let Z=!1;const ee=new Set;function te(){if(!Z){Z=!0;do{for(let e=0;e<U.length;e+=1){const t=U[e];z(t),ne(t.$$)}for(z(null),U.length=0;V.length;)V.pop()();for(let e=0;e<W.length;e+=1){const t=W[e];ee.has(t)||(ee.add(t),t())}W.length=0}while(U.length);for(;H.length;)H.pop()();X=!1,Z=!1,ee.clear()}}function ne(e){if(null!==e.fragment){e.update(),a(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(K)}}let re;function ie(){return re||(re=Promise.resolve(),re.then((()=>{re=null}))),re}function ae(e,t,n){e.dispatchEvent(j(`${t?"intro":"outro"}${n}`))}const oe=new Set;let se;function le(){se={r:0,c:[],p:se}}function ue(){se.r||a(se.c),se=se.p}function ce(e,t){e&&e.i&&(oe.delete(e),e.i(t))}function fe(e,t,n,r){if(e&&e.o){if(oe.has(e))return;oe.add(e),se.c.push((()=>{oe.delete(e),r&&(n&&e.d(1),r())})),e.o(t)}}const de={duration:0};const he="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function pe(e,t){e.d(1),t.delete(e.key)}function me(e,t){fe(e,1,1,(()=>{t.delete(e.key)}))}function ge(e,t,n,r,i,a,o,s,l,u,c,f){let d=e.length,h=a.length,p=d;const m={};for(;p--;)m[e[p].key]=p;const g=[],y=new Map,v=new Map;for(p=h;p--;){const e=f(i,a,p),s=n(e);let l=o.get(s);l?r&&l.p(e,t):(l=u(s,e),l.c()),y.set(s,g[p]=l),s in m&&v.set(s,Math.abs(p-m[s]))}const b=new Set,x=new Set;function w(e){ce(e,1),e.m(s,c),o.set(e.key,e),c=e.first,h--}for(;d&&h;){const t=g[h-1],n=e[d-1],r=t.key,i=n.key;t===n?(c=t.first,d--,h--):y.has(i)?!o.has(r)||b.has(r)?w(t):x.has(i)?d--:v.get(r)>v.get(i)?(x.add(r),w(t)):(b.add(i),d--):(l(n,o),d--)}for(;d--;){const t=e[d];y.has(t.key)||l(t,o)}for(;h;)w(g[h-1]);return g}function ye(e,t){const n={},r={},i={$$scope:1};let a=e.length;for(;a--;){const o=e[a],s=t[a];if(s){for(const e in o)e in s||(r[e]=1);for(const e in s)i[e]||(n[e]=s[e],i[e]=1);e[a]=s}else for(const e in o)i[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}function ve(e){return"object"==typeof e&&null!==e?e:{}}function be(e,t,n){const r=e.$$.props[t];void 0!==r&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function xe(e){e&&e.c()}function we(e,t,n){const{fragment:i,on_mount:s,on_destroy:l,after_update:u}=e.$$;i&&i.m(t,n),K((()=>{const t=s.map(r).filter(o);l?l.push(...t):a(t),e.$$.on_mount=[]})),u.forEach(K)}function _e(e,t){const n=e.$$;null!==n.fragment&&(a(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ke(t,n,r,o,s,l,u=[-1]){const c=T;z(t);const f=n.props||{},d=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:i(),dirty:u,skip_bound:!1};let h=!1;if(d.ctx=r?r(t,f,((e,n,...r)=>{const i=r.length?r[0]:n;return d.ctx&&s(d.ctx[e],d.ctx[e]=i)&&(!d.skip_bound&&d.bound[e]&&d.bound[e](i),h&&function(e,t){-1===e.$$.dirty[0]&&(U.push(e),Y(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],d.update(),h=!0,a(d.before_update),d.fragment=!!o&&o(d.ctx),n.target){if(n.hydrate){const e=function(e){return Array.from(e.childNodes)}(n.target);d.fragment&&d.fragment.l(e),e.forEach(b)}else d.fragment&&d.fragment.c();n.intro&&ce(t.$$.fragment),we(t,n.target,n.anchor),te()}z(c)}class Oe{$destroy(){_e(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Se=function(e,t){JSZip.loadAsync(e).then((e=>{e.forEach(((e,n)=>{n.async("string").then((e=>{var n=parser.parse(e,{ignoreAttributes:!0});console.log(n),t(n)}))}))}))},$e=6,Ee=7,Ae=12,De=13,Ce=15,Me=16,je=17,Fe=20,Te=21,Ne=22,Re=26,Pe=27,ze=30,Be=31,Le=33,Ie=34,qe=38,Ue=40,Ve=41,We=47,He=48,Ge=49,Xe=51,Ye=56,Je=57,Ke=58,Qe=59,Ze=60,et=61,tt=64,nt=67,rt=68,it=74,at=75,ot={[1]:"Strip Ball",[2]:"ST+",[3]:"AG+",[4]:"MA+",[5]:"AV+",[$e]:"Catch",[Ee]:"Dodge",[8]:"Sprint",[9]:"Pass Block",[10]:"Foul Appearance",[11]:"Leap",[Ae]:"Extra Arms",[De]:"Mighty Blow",[14]:"Leader",[Ce]:"Horns",[Me]:"Two-Heads",[je]:"Stand Firm",[18]:"Always Hungry",[19]:"Regeneration",[Fe]:"Take Root",[Te]:"Accurate",[Ne]:"Break Tackle",[23]:"Sneaky Git",[25]:"Chainsaw",[Re]:"Dauntless",[Pe]:"Dirty Player",[28]:"Diving Catch",[29]:"Dump-Off",[ze]:"Block",[Be]:"Bone-Head",[32]:"Very Long Legs",[Le]:"Disturbing Presence",[Ie]:"Diving Tackle",[35]:"Fend",[36]:"Frenzy",[37]:"Grab",[qe]:"Guard",[39]:"Hail-Mary Pass",[Ue]:"Juggernaut",[Ve]:"Jump-Up",[44]:"Loner",[45]:"Nerves Of Steel",[46]:"No Hands",[We]:"Pass",[He]:"Piling On",[Ge]:"Prehensile Tail",[50]:"Pro",[Xe]:"Really Stupid",[52]:"Right Stuff",[53]:"Safe Throw",[54]:"Secret Weapon",[55]:"Shadowing",[Ye]:"Side Step",[Je]:"Tackle",[Ke]:"Strong Arm",[Qe]:"Stunty",[Ze]:"Sure Feet",[et]:"Sure Hands",[63]:"Thick Skull",[tt]:"Throw Team Mate",[nt]:"Wild Animal",[rt]:"Wrestle",[69]:"Tentacles",[70]:"Multiple Block",[71]:"Kick",[72]:"Kick-Off Return",[it]:"Big Hand",[at]:"Claw",[76]:"Ball and Chain",[77]:"Stab",[78]:"Hypnotic Gaze",[79]:"Stakes",[80]:"Bombardier",[81]:"Decay",[82]:"Nurgles Rot",[83]:"Titchy",[84]:"Blood-Lust",[85]:"Fan Favourite",[86]:"Animosity"},st={Active:void 0,Reserves:1,SentOff:5,KO:2,Casualty:4},lt={NoStatus:0,RerollTaken:1,RerollNotTaken:2,RerollWithSkill:3,Reroll4:4},ut=0,ct=1,ft=2,dt=3,ht=4,pt=1,mt=5,gt=0,yt=2,vt=1,bt=35,xt=57,wt="AD",_t="BD",kt="P",Ot="DS",St="DD",$t={0:wt,1:_t,2:kt,3:Ot,4:St},Et=1,At=2,Dt=3,Ct=4,Mt=5,jt=6,Ft=7,Tt=8,Nt=9,Rt=10,Pt=12,zt=13,Bt=14,Lt=15,It=16,qt=17,Ut=18,Vt=20,Wt=21,Ht=22,Gt=24,Xt=25,Yt=33,Jt={[zt]:"Amazon",[Gt]:"Bretonnian",[Tt]:"Chaos",[Wt]:"Chaos Dwarf",[Yt]:"Chaos Pact",[Nt]:"Dark Elf",[At]:"Dwarf",[jt]:"Goblin",[Lt]:"High Elf",[Et]:"Human",[It]:"Khemri",[Xt]:"Kislev",[Mt]:"Lizardman",[qt]:"Necromantic",[Pt]:"Norse",[Ut]:"Nurgle",[Ct]:"Orc",[Bt]:"Pro Elf",[Dt]:"Skaven",[Rt]:"Undead",[Ht]:"Underworld",[Vt]:"Vampire",[Ft]:"Wood Elf"},Kt={[zt]:"amazon",[Gt]:"bretonnia",[Tt]:"chaos",[Wt]:"chaosdwarf",[Yt]:"chaospact",[Nt]:"darkelf",[At]:"dwarf",[jt]:"goblin",[Lt]:"highelf",[Et]:"human",[It]:"khemri",[Xt]:"kislev",[Mt]:"lizardman",[qt]:"necromantic",[Pt]:"norse",[Ut]:"nurgle",[Ct]:"orc",[Bt]:"proelf",[Dt]:"skaven",[Rt]:"undead",[Ht]:"underworld",[Vt]:"vampire",[Ft]:"woodelf"};const Qt=[{},{dice:38,icon:"BadlyHurt",result:"Badly Hurt",effect:"No long term effect"},{dice:41,icon:"BrokenRibs",result:"Broken Rib",effect:"Miss next game "},{dice:42,icon:"GroinStrain",result:"Groin Strain",effect:"Miss next game "},{dice:43,icon:"GougedEye",result:"Gouged Eye",effect:"Miss next game"},{dice:44,icon:"BrokenJaw",result:"Broken Jaw",effect:"Miss next game "},{dice:45,icon:"FracturedArm",result:"Fractured Arm",effect:"Miss next game "},{dice:46,icon:"FracturedLeg",result:"Fractured Leg",effect:"Miss next game "},{dice:47,icon:"SmashedHand",result:"Smashed Hand ",effect:"Miss next game "},{dice:48,icon:"PinchedNerve",result:"Pinched Nerve",effect:"Miss next game "},{dice:51,icon:"NigglingInjury2",result:"Damaged Back",effect:"Niggling Injury"},{dice:52,icon:"NigglingInjury2",result:"Smashed Knee",effect:"Niggling Injury"},{dice:53,icon:"MovementBust",result:"Smashed Hip",effect:"-1 MA"},{dice:54,icon:"MovementBust",result:"Smashed Ankle",effect:"-1 MA"},{dice:55,icon:"ArmourBust",result:"Serious Concussion",effect:"-1 AV"},{dice:56,icon:"ArmourBust",result:"Fractured Skull",effect:"-1 AV"},{dice:57,icon:"AgilityBust",result:"Broken Neck",effect:"-1 AG"},{dice:58,icon:"StrengthBust",result:"Smashed Collar Bone",effect:"-1 ST"},{dice:61,icon:"Dead",result:"Dead",effect:"Dead!"}],Zt={GFI:1,Dodge:2,Armor:3,Injury:4,Block:5,StandUp:6,Pickup:7,Casualty:8,Catch:9,KickoffScatter:10,ThrowIn:11,Pass:12,Push:13,FollowUp:14,FoulPenalty:15,Interception:16,WakeUp:17,TouchBack:19,BoneHead:20,ReallyStupid:21,WildAnimal:22,Loner:23,Landing:24,Regeneration:25,InaccuratePassScatter:26,AlwaysHungryRoll:27,EatTeammate:28,Dauntless:29,SafeThrow:30,JumpUp:31,Shadowing:32,Stab:34,Leap:36,FoulAppearance:37,Tentacles:38,ChainsawKickback:39,TakeRoot:40,BallAndChain:41,HailMaryPass:42,DivingTackle:44,Pro:45,HypnoticGaze:46,Animosity:49,Bloodlust:50,Bite:51,Bribe:52,Fireball:54,LightningBolt:55,ThrowTeammate:56,Multiblock:57,KickoffGust:58,PileOnArmorRoll:59,PileOnInjuryRoll:60,Wrestle2:61,DodgePick:62,StandFirm:63,Juggernaut:64,StandFirm2:65,RaiseDead:66,Fans:69,Weather:70,SwealteringHeat:71,BombKD:72,ChainsawArmor:73};function en(e){return null!=e&&"function"==typeof e[Symbol.iterator]}class tn{constructor(e){this.name=e}named(e){return this.name=e,this}_flat(){throw new Error("${this.constructor}._flat() missing implementation")}get flat(){return Object.defineProperty(this,"flat",{value:Object.values(this._flat().reduce(((e,t)=>{const n=e[`${t.name}-${t.value}`];return n?n.weight+=t.weight:e[`${t.name}-${t.value}`]=t,e}),{}))}),this.flat}get cdf(){Object.defineProperty(this,"cdf",{value:this.flat.sort(((e,t)=>e.value-t.value)).reduce(((e,t)=>(e.push({weight:e[e.length-1].weight+t.weight,value:t.value}),e)))})}sample(){var e=Math.random();for(const t of this.flat){if(t.weight>e)return t.value;e-=t.weight}return this.flat[this.flat.length-1].value}get singularValue(){const e=this.flat;if(e.length>1)throw new Error("Distribution doesn't have a singular value");return e[0].value}get isSingularValue(){return 1==this.flat.length}get expectedValue(){return Object.defineProperty(this,"expectedValue",{value:this.flat.reduce(((e,t)=>e+t.value*t.weight),0)}),this.expectedValue}add(...e){return(e=e.filter((e=>null!==e))).length>0?new on([this,...e]):this}product(...e){return(e=e.filter((e=>null!==e))).length>0?new sn([this,...e]):this}divide(e){return new ln(this,e)}subtract(e){return new un(this,e)}get valueString(){return`[${this.isSingularValue?"V":"EV"}=${this.valueOf().toFixed(2)}]`}valueOf(){return this.expectedValue}max(...e){var t=this;for(var n of e)n.expectedValue>t.expectedValue&&(t=n);return t}min(...e){var t=this;for(var n of e)n.expectedValue<t.expectedValue&&(t=n);return t}}class nn extends tn{constructor(e,t){super(t);const n=e.map((e=>e.weight)).reduce(((e,t)=>e+t));e.forEach((e=>{e.weight/=n})),this.values=Object.values(e.reduce(((e,t)=>{const n=e[`${t.name}`];if(n){if(n.value!=t.value)throw new Error("Inconsistent values passed to SimpleDistribution");n.weight+=t.weight}else e[`${t.name}`]=t;return e}),{}))}_flat(){return this.values.flatMap((e=>e.value instanceof tn?e.value.flat.map((t=>({name:`${e.name} → ${t.name}`,weight:e.weight*t.weight,value:t.value}))):e))}}class rn extends tn{constructor(e,t){super(e),this.value=t}_flat(){return this.value instanceof tn?this.value.flat.map((e=>({name:`${this.name} → ${e.name}`,weight:e.weight,value:e.value}))):[{name:this.name,weight:1,value:this.value}]}}class an extends tn{constructor(e,t,n,r,i){if(super(i),this.valFunc=e,this.nameFunc=t,this.distFuncName=n,!en(r))throw new Error("values not iterable",r);if(0==r.length)throw new Error("empty values list",r);this.values=r}_combine(e,t){return e instanceof tn?e[this.distFuncName](t):t instanceof tn?t[this.distFuncName](e):this.valFunc(e,t)}_flat(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();t=t?t instanceof tn?new nn(n instanceof tn?t.flat.flatMap((e=>n.flat.map((t=>({name:this.name||this.nameFunc(e.name,t.name),weight:e.weight*t.weight,value:this.valFunc(e.value,t.value)}))))):t.flat.map((e=>({name:this.name||this.nameFunc(e.name,n),value:this.valFunc(e.value,n),weight:e.weight}))),this.name):n instanceof tn?new nn(n.flat.map((e=>({name:this.name||this.nameFunc(t,e.name),value:this.valFunc(t,e.value),weight:e.weight}))),this.name):new rn(this.name||this.nameFunc(t,n),this.valFunc(t,n)):n}return t.flat}}class on extends an{constructor(e,t){super(((e,t)=>e+t),((e,t)=>`${e} + ${t}`),"add",e,t)}}class sn extends an{constructor(e,t){super(((e,t)=>e*t),((e,t)=>`${e} * ${t}`),"product",e,t)}}class ln extends an{constructor(e,t,n){super(((e,t)=>e/t),((e,t)=>`${e} / ${t}`),"divide",[e,t],n)}}class un extends an{constructor(e,t,n){super(((e,t)=>e-t),((e,t)=>`${e} - ${t}`),"subtract",[e,t],n)}}class cn extends tn{constructor(e,t,n){if(super(n),!en(t))throw new Error("values not iterable",t);if(0==t.length)throw new Error("empty values list",t);this.better=e,this.values=t}_simple(){const e=[...this.values];for(var t=null;e.length>0;){var n=e.shift();if(t){if(!(t instanceof nn&&n instanceof nn))throw new Error("Can only compare simple distributions");t=new nn(t.values.flatMap((e=>n.values.map((t=>({name:this.better(e.value,t.value)?e.name:t.name,weight:e.weight*t.weight,value:this.better(e.value,t.value)?e.value:t.value}))))))}else t=n}return t}get simple(){return Object.defineProperty(this,"simple",{value:this._simple().named(this.name)}),console.assert(Math.abs(this.simple.expectedValue-this.expectedValue)<1e-4,this),this.simple}_flat(){return this._simple().flat}}class fn extends cn{constructor(e,t){super(((e,t)=>e>t),e,t)}}class dn extends cn{constructor(e,t){super(((e,t)=>e<t),e,t)}}function hn(e,t,n,r){n=n||"value",r=r||"weight";const i=e.sort(((e,t)=>e[n]-t[n])),a=e.reduce(((e,t)=>e+t[r]),0);for(var o=0;t>1e-8&&o<i.length;)(t-=i[o][r]/a)>1e-8&&o++;return i[o][n]}var pn="1.12.0",mn="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},gn=Array.prototype,yn=Object.prototype,vn="undefined"!=typeof Symbol?Symbol.prototype:null,bn=gn.push,xn=gn.slice,wn=yn.toString,_n=yn.hasOwnProperty,kn="undefined"!=typeof ArrayBuffer,On="undefined"!=typeof DataView,Sn=Array.isArray,$n=Object.keys,En=Object.create,An=kn&&ArrayBuffer.isView,Dn=isNaN,Cn=isFinite,Mn=!{toString:null}.propertyIsEnumerable("toString"),jn=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Fn=Math.pow(2,53)-1;function Tn(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var a=Array(t+1);for(i=0;i<t;i++)a[i]=arguments[i];return a[t]=r,e.apply(this,a)}}function Nn(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function Rn(e){return void 0===e}function Pn(e){return!0===e||!1===e||"[object Boolean]"===wn.call(e)}function zn(e){var t="[object "+e+"]";return function(e){return wn.call(e)===t}}var Bn=zn("String"),Ln=zn("Number"),In=zn("Date"),qn=zn("RegExp"),Un=zn("Error"),Vn=zn("Symbol"),Wn=zn("ArrayBuffer"),Hn=zn("Function"),Gn=mn.document&&mn.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Gn&&(Hn=function(e){return"function"==typeof e||!1});var Xn=Hn,Yn=zn("Object"),Jn=On&&Yn(new DataView(new ArrayBuffer(8))),Kn="undefined"!=typeof Map&&Yn(new Map),Qn=zn("DataView");var Zn=Jn?function(e){return null!=e&&Xn(e.getInt8)&&Wn(e.buffer)}:Qn,er=Sn||zn("Array");function tr(e,t){return null!=e&&_n.call(e,t)}var nr=zn("Arguments");!function(){nr(arguments)||(nr=function(e){return tr(e,"callee")})}();var rr=nr;function ir(e){return Ln(e)&&Dn(e)}function ar(e){return function(){return e}}function or(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=Fn}}function sr(e){return function(t){return null==t?void 0:t[e]}}var lr=sr("byteLength"),ur=or(lr),cr=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;var fr=kn?function(e){return An?An(e)&&!Zn(e):ur(e)&&cr.test(wn.call(e))}:ar(!1),dr=sr("length");function hr(e,t){t=function(e){for(var t={},n=e.length,r=0;r<n;++r)t[e[r]]=!0;return{contains:function(e){return t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=jn.length,r=e.constructor,i=Xn(r)&&r.prototype||yn,a="constructor";for(tr(e,a)&&!t.contains(a)&&t.push(a);n--;)(a=jn[n])in e&&e[a]!==i[a]&&!t.contains(a)&&t.push(a)}function pr(e){if(!Nn(e))return[];if($n)return $n(e);var t=[];for(var n in e)tr(e,n)&&t.push(n);return Mn&&hr(e,t),t}function mr(e,t){var n=pr(t),r=n.length;if(null==e)return!r;for(var i=Object(e),a=0;a<r;a++){var o=n[a];if(t[o]!==i[o]||!(o in i))return!1}return!0}function gr(e){return e instanceof gr?e:this instanceof gr?void(this._wrapped=e):new gr(e)}function yr(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,lr(e))}gr.VERSION=pn,gr.prototype.value=function(){return this._wrapped},gr.prototype.valueOf=gr.prototype.toJSON=gr.prototype.value,gr.prototype.toString=function(){return String(this._wrapped)};var vr="[object DataView]";function br(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&xr(e,t,n,r)}function xr(e,t,n,r){e instanceof gr&&(e=e._wrapped),t instanceof gr&&(t=t._wrapped);var i=wn.call(e);if(i!==wn.call(t))return!1;if(Jn&&"[object Object]"==i&&Zn(e)){if(!Zn(t))return!1;i=vr}switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return vn.valueOf.call(e)===vn.valueOf.call(t);case"[object ArrayBuffer]":case vr:return xr(yr(e),yr(t),n,r)}var a="[object Array]"===i;if(!a&&fr(e)){if(lr(e)!==lr(t))return!1;if(e.buffer===t.buffer&&e.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(Xn(o)&&o instanceof o&&Xn(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===t;if(n.push(e),r.push(t),a){if((l=e.length)!==t.length)return!1;for(;l--;)if(!br(e[l],t[l],n,r))return!1}else{var u,c=pr(e);if(l=c.length,pr(t).length!==l)return!1;for(;l--;)if(!tr(t,u=c[l])||!br(e[u],t[u],n,r))return!1}return n.pop(),r.pop(),!0}function wr(e){if(!Nn(e))return[];var t=[];for(var n in e)t.push(n);return Mn&&hr(e,t),t}function _r(e){var t=dr(e);return function(n){if(null==n)return!1;var r=wr(n);if(dr(r))return!1;for(var i=0;i<t;i++)if(!Xn(n[e[i]]))return!1;return e!==Er||!Xn(n[kr])}}var kr="forEach",Or=["clear","delete"],Sr=["get","has","set"],$r=Or.concat(kr,Sr),Er=Or.concat(Sr),Ar=["add"].concat(Or,kr,"has"),Dr=Kn?_r($r):zn("Map"),Cr=Kn?_r(Er):zn("WeakMap"),Mr=Kn?_r(Ar):zn("Set"),jr=zn("WeakSet");function Fr(e){for(var t=pr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r}function Tr(e){for(var t={},n=pr(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t}function Nr(e){var t=[];for(var n in e)Xn(e[n])&&t.push(n);return t.sort()}function Rr(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var a=arguments[i],o=e(a),s=o.length,l=0;l<s;l++){var u=o[l];t&&void 0!==n[u]||(n[u]=a[u])}return n}}var Pr=Rr(wr),zr=Rr(pr),Br=Rr(wr,!0);function Lr(e){if(!Nn(e))return{};if(En)return En(e);var t=function(){};t.prototype=e;var n=new t;return t.prototype=null,n}function Ir(e){return Nn(e)?er(e)?e.slice():Pr({},e):e}function qr(e){return er(e)?e:[e]}function Ur(e){return gr.toPath(e)}function Vr(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0}function Wr(e,t,n){var r=Vr(e,Ur(t));return Rn(r)?n:r}function Hr(e){return e}function Gr(e){return e=zr({},e),function(t){return mr(t,e)}}function Xr(e){return e=Ur(e),function(t){return Vr(t,e)}}function Yr(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,a){return e.call(t,n,r,i,a)}}return function(){return e.apply(t,arguments)}}function Jr(e,t,n){return null==e?Hr:Xn(e)?Yr(e,t,n):Nn(e)&&!er(e)?Gr(e):Xr(e)}function Kr(e,t){return Jr(e,t,1/0)}function Qr(e,t,n){return gr.iteratee!==Kr?gr.iteratee(e,t):Jr(e,t,n)}function Zr(){}function ei(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}gr.toPath=qr,gr.iteratee=Kr;var ti=Date.now||function(){return(new Date).getTime()};function ni(e){var t=function(t){return e[t]},n="(?:"+pr(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}}var ri={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ii=ni(ri),ai=ni(Tr(ri)),oi=gr.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},si=/(.)^/,li={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},ui=/\\|'|\r|\n|\u2028|\u2029/g;function ci(e){return"\\"+li[e]}var fi=0;function di(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var a=Lr(e.prototype),o=e.apply(a,i);return Nn(o)?o:a}var hi=Tn((function(e,t){var n=hi.placeholder,r=function(){for(var i=0,a=t.length,o=Array(a),s=0;s<a;s++)o[s]=t[s]===n?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return di(e,r,this,this,o)};return r}));hi.placeholder=gr;var pi=Tn((function(e,t,n){if(!Xn(e))throw new TypeError("Bind must be called on a function");var r=Tn((function(i){return di(e,r,t,this,n.concat(i))}));return r})),mi=or(dr);function gi(e,t,n,r){if(r=r||[],t||0===t){if(t<=0)return r.concat(e)}else t=1/0;for(var i=r.length,a=0,o=dr(e);a<o;a++){var s=e[a];if(mi(s)&&(er(s)||rr(s)))if(t>1)gi(s,t-1,n,r),i=r.length;else for(var l=0,u=s.length;l<u;)r[i++]=s[l++];else n||(r[i++]=s)}return r}var yi=Tn((function(e,t){var n=(t=gi(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=pi(e[r],e)}return e}));var vi=Tn((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),bi=hi(vi,gr,1);function xi(e){return function(){return!e.apply(this,arguments)}}function wi(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var _i=hi(wi,2);function ki(e,t,n){t=Qr(t,n);for(var r,i=pr(e),a=0,o=i.length;a<o;a++)if(t(e[r=i[a]],r,e))return r}function Oi(e){return function(t,n,r){n=Qr(n,r);for(var i=dr(t),a=e>0?0:i-1;a>=0&&a<i;a+=e)if(n(t[a],a,t))return a;return-1}}var Si=Oi(1),$i=Oi(-1);function Ei(e,t,n,r){for(var i=(n=Qr(n,r,1))(t),a=0,o=dr(e);a<o;){var s=Math.floor((a+o)/2);n(e[s])<i?a=s+1:o=s}return a}function Ai(e,t,n){return function(r,i,a){var o=0,s=dr(r);if("number"==typeof a)e>0?o=a>=0?a:Math.max(a+s,o):s=a>=0?Math.min(a+1,s):a+s+1;else if(n&&a&&s)return r[a=n(r,i)]===i?a:-1;if(i!=i)return(a=t(xn.call(r,o,s),ir))>=0?a+o:-1;for(a=e>0?o:s-1;a>=0&&a<s;a+=e)if(r[a]===i)return a;return-1}}var Di=Ai(1,Si,Ei),Ci=Ai(-1,$i);function Mi(e,t,n){var r=(mi(e)?Si:ki)(e,t,n);if(void 0!==r&&-1!==r)return e[r]}function ji(e,t,n){var r,i;if(t=Yr(t,n),mi(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var a=pr(e);for(r=0,i=a.length;r<i;r++)t(e[a[r]],a[r],e)}return e}function Fi(e,t,n){t=Qr(t,n);for(var r=!mi(e)&&pr(e),i=(r||e).length,a=Array(i),o=0;o<i;o++){var s=r?r[o]:o;a[o]=t(e[s],s,e)}return a}function Ti(e){var t=function(t,n,r,i){var a=!mi(t)&&pr(t),o=(a||t).length,s=e>0?0:o-1;for(i||(r=t[a?a[s]:s],s+=e);s>=0&&s<o;s+=e){var l=a?a[s]:s;r=n(r,t[l],l,t)}return r};return function(e,n,r,i){var a=arguments.length>=3;return t(e,Yr(n,i,4),r,a)}}var Ni=Ti(1),Ri=Ti(-1);function Pi(e,t,n){var r=[];return t=Qr(t,n),ji(e,(function(e,n,i){t(e,n,i)&&r.push(e)})),r}function zi(e,t,n){t=Qr(t,n);for(var r=!mi(e)&&pr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(!t(e[o],o,e))return!1}return!0}function Bi(e,t,n){t=Qr(t,n);for(var r=!mi(e)&&pr(e),i=(r||e).length,a=0;a<i;a++){var o=r?r[a]:a;if(t(e[o],o,e))return!0}return!1}function Li(e,t,n,r){return mi(e)||(e=Fr(e)),("number"!=typeof n||r)&&(n=0),Di(e,t,n)>=0}var Ii=Tn((function(e,t,n){var r,i;return Xn(t)?i=t:(t=Ur(t),r=t.slice(0,-1),t=t[t.length-1]),Fi(e,(function(e){var a=i;if(!a){if(r&&r.length&&(e=Vr(e,r)),null==e)return;a=e[t]}return null==a?a:a.apply(e,n)}))}));function qi(e,t){return Fi(e,Xr(t))}function Ui(e,t,n){var r,i,a=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=mi(e)?e:Fr(e)).length;s<l;s++)null!=(r=e[s])&&r>a&&(a=r);else t=Qr(t,n),ji(e,(function(e,n,r){((i=t(e,n,r))>o||i===-1/0&&a===-1/0)&&(a=e,o=i)}));return a}function Vi(e,t,n){if(null==t||n)return mi(e)||(e=Fr(e)),e[ei(e.length-1)];var r=mi(e)?Ir(e):Fr(e),i=dr(r);t=Math.max(Math.min(t,i),0);for(var a=i-1,o=0;o<t;o++){var s=ei(o,a),l=r[o];r[o]=r[s],r[s]=l}return r.slice(0,t)}function Wi(e,t){return function(n,r,i){var a=t?[[],[]]:{};return r=Qr(r,i),ji(n,(function(t,i){var o=r(t,i,n);e(a,t,o)})),a}}var Hi=Wi((function(e,t,n){tr(e,n)?e[n].push(t):e[n]=[t]})),Gi=Wi((function(e,t,n){e[n]=t})),Xi=Wi((function(e,t,n){tr(e,n)?e[n]++:e[n]=1})),Yi=Wi((function(e,t,n){e[n?0:1].push(t)}),!0),Ji=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Ki(e,t,n){return t in n}var Qi=Tn((function(e,t){var n={},r=t[0];if(null==e)return n;Xn(r)?(t.length>1&&(r=Yr(r,t[1])),t=wr(e)):(r=Ki,t=gi(t,!1,!1),e=Object(e));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];r(s,o,e)&&(n[o]=s)}return n})),Zi=Tn((function(e,t){var n,r=t[0];return Xn(r)?(r=xi(r),t.length>1&&(n=t[1])):(t=Fi(gi(t,!1,!1),String),r=function(e,n){return!Li(t,n)}),Qi(e,r,n)}));function ea(e,t,n){return xn.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function ta(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:ea(e,e.length-t)}function na(e,t,n){return xn.call(e,null==t||n?1:t)}var ra=Tn((function(e,t){return t=gi(t,!0,!0),Pi(e,(function(e){return!Li(t,e)}))})),ia=Tn((function(e,t){return ra(e,t)}));function aa(e,t,n,r){Pn(t)||(r=n,n=t,t=!1),null!=n&&(n=Qr(n,r));for(var i=[],a=[],o=0,s=dr(e);o<s;o++){var l=e[o],u=n?n(l,o,e):l;t&&!n?(o&&a===u||i.push(l),a=u):n?Li(a,u)||(a.push(u),i.push(l)):Li(i,l)||i.push(l)}return i}var oa=Tn((function(e){return aa(gi(e,!0,!0))}));function sa(e){for(var t=e&&Ui(e,dr).length||0,n=Array(t),r=0;r<t;r++)n[r]=qi(e,r);return n}var la=Tn(sa);function ua(e,t){return e._chain?gr(t).chain():t}function ca(e){return ji(Nr(e),(function(t){var n=gr[t]=e[t];gr.prototype[t]=function(){var e=[this._wrapped];return bn.apply(e,arguments),ua(this,n.apply(gr,e))}})),gr}ji(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=gn[e];gr.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),ua(this,n)}})),ji(["concat","join","slice"],(function(e){var t=gn[e];gr.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),ua(this,e)}}));var fa=ca(Object.freeze({__proto__:null,VERSION:pn,restArguments:Tn,isObject:Nn,isNull:function(e){return null===e},isUndefined:Rn,isBoolean:Pn,isElement:function(e){return!(!e||1!==e.nodeType)},isString:Bn,isNumber:Ln,isDate:In,isRegExp:qn,isError:Un,isSymbol:Vn,isArrayBuffer:Wn,isDataView:Zn,isArray:er,isFunction:Xn,isArguments:rr,isFinite:function(e){return!Vn(e)&&Cn(e)&&!isNaN(parseFloat(e))},isNaN:ir,isTypedArray:fr,isEmpty:function(e){if(null==e)return!0;var t=dr(e);return"number"==typeof t&&(er(e)||Bn(e)||rr(e))?0===t:0===dr(pr(e))},isMatch:mr,isEqual:function(e,t){return br(e,t)},isMap:Dr,isWeakMap:Cr,isSet:Mr,isWeakSet:jr,keys:pr,allKeys:wr,values:Fr,pairs:function(e){for(var t=pr(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},invert:Tr,functions:Nr,methods:Nr,extend:Pr,extendOwn:zr,assign:zr,defaults:Br,create:function(e,t){var n=Lr(e);return t&&zr(n,t),n},clone:Ir,tap:function(e,t){return t(e),e},get:Wr,has:function(e,t){for(var n=(t=Ur(t)).length,r=0;r<n;r++){var i=t[r];if(!tr(e,i))return!1;e=e[i]}return!!n},mapObject:function(e,t,n){t=Qr(t,n);for(var r=pr(e),i=r.length,a={},o=0;o<i;o++){var s=r[o];a[s]=t(e[s],s,e)}return a},identity:Hr,constant:ar,noop:Zr,toPath:qr,property:Xr,propertyOf:function(e){return null==e?Zr:function(t){return Wr(e,t)}},matcher:Gr,matches:Gr,times:function(e,t,n){var r=Array(Math.max(0,e));t=Yr(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},random:ei,now:ti,escape:ii,unescape:ai,templateSettings:oi,template:function(e,t,n){!t&&n&&(t=n),t=Br({},t,gr.templateSettings);var r,i=RegExp([(t.escape||si).source,(t.interpolate||si).source,(t.evaluate||si).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(i,(function(t,n,r,i,s){return o+=e.slice(a,s).replace(ui,ci),a=s+t.length,n?o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?o+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t})),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return r.call(this,e,gr)},l=t.variable||"obj";return s.source="function("+l+"){\n"+o+"}",s},result:function(e,t,n){var r=(t=Ur(t)).length;if(!r)return Xn(n)?n.call(e):n;for(var i=0;i<r;i++){var a=null==e?void 0:e[t[i]];void 0===a&&(a=n,i=r),e=Xn(a)?a.call(e):a}return e},uniqueId:function(e){var t=++fi+"";return e?e+t:t},chain:function(e){var t=gr(e);return t._chain=!0,t},iteratee:Kr,partial:hi,bind:pi,bindAll:yi,memoize:function(e,t){var n=function(r){var i=n.cache,a=""+(t?t.apply(this,arguments):r);return tr(i,a)||(i[a]=e.apply(this,arguments)),i[a]};return n.cache={},n},delay:vi,defer:bi,throttle:function(e,t,n){var r,i,a,o,s=0;n||(n={});var l=function(){s=!1===n.leading?0:ti(),r=null,o=e.apply(i,a),r||(i=a=null)},u=function(){var u=ti();s||!1!==n.leading||(s=u);var c=t-(u-s);return i=this,a=arguments,c<=0||c>t?(r&&(clearTimeout(r),r=null),s=u,o=e.apply(i,a),r||(i=a=null)):r||!1===n.trailing||(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),s=0,r=i=a=null},u},debounce:function(e,t,n){var r,i,a=function(t,n){r=null,n&&(i=e.apply(t,n))},o=Tn((function(o){if(r&&clearTimeout(r),n){var s=!r;r=setTimeout(a,t),s&&(i=e.apply(this,o))}else r=vi(a,t,this,o);return i}));return o.cancel=function(){clearTimeout(r),r=null},o},wrap:function(e,t){return hi(t,e)},negate:xi,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:wi,once:_i,findKey:ki,findIndex:Si,findLastIndex:$i,sortedIndex:Ei,indexOf:Di,lastIndexOf:Ci,find:Mi,detect:Mi,findWhere:function(e,t){return Mi(e,Gr(t))},each:ji,forEach:ji,map:Fi,collect:Fi,reduce:Ni,foldl:Ni,inject:Ni,reduceRight:Ri,foldr:Ri,filter:Pi,select:Pi,reject:function(e,t,n){return Pi(e,xi(Qr(t)),n)},every:zi,all:zi,some:Bi,any:Bi,contains:Li,includes:Li,include:Li,invoke:Ii,pluck:qi,where:function(e,t){return Pi(e,Gr(t))},max:Ui,min:function(e,t,n){var r,i,a=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,l=(e=mi(e)?e:Fr(e)).length;s<l;s++)null!=(r=e[s])&&r<a&&(a=r);else t=Qr(t,n),ji(e,(function(e,n,r){((i=t(e,n,r))<o||i===1/0&&a===1/0)&&(a=e,o=i)}));return a},shuffle:function(e){return Vi(e,1/0)},sample:Vi,sortBy:function(e,t,n){var r=0;return t=Qr(t,n),qi(Fi(e,(function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index})),"value")},groupBy:Hi,indexBy:Gi,countBy:Xi,partition:Yi,toArray:function(e){return e?er(e)?xn.call(e):Bn(e)?e.match(Ji):mi(e)?Fi(e,Hr):Fr(e):[]},size:function(e){return null==e?0:mi(e)?e.length:pr(e).length},pick:Qi,omit:Zi,first:ta,head:ta,take:ta,initial:ea,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:na(e,Math.max(0,e.length-t))},rest:na,tail:na,drop:na,compact:function(e){return Pi(e,Boolean)},flatten:function(e,t){return gi(e,t,!1)},without:ia,uniq:aa,unique:aa,union:oa,intersection:function(e){for(var t=[],n=arguments.length,r=0,i=dr(e);r<i;r++){var a=e[r];if(!Li(t,a)){var o;for(o=1;o<n&&Li(arguments[o],a);o++);o===n&&t.push(a)}}return t},difference:ra,unzip:sa,transpose:sa,zip:la,object:function(e,t){for(var n={},r=0,i=dr(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),a=0;a<r;a++,e+=n)i[a]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(xn.call(e,r,r+=t));return n},mixin:ca,default:gr}));function da(e){return e&&e.length?e:e?[e]:[]}function ha(e){return e[Math.floor(Math.random()*e.length)]}function pa(e){for(var t=0,n=0;n<e;n++)t+=.9**n;return t}function ma(e,t){return Math.max(Math.abs((e.x||0)-(t.x||0)),Math.abs((e.y||0)-(t.y||0)))}function ga(e,t){var n;return n=0==e.id?25-(t.x||0):t.x||0,new rn(`${n} to goal`,0==n?8:4*.85**(n-1))}fa._=fa;const ya="actual",va="simulated";class ba{team;playerState;constructor(e,t,n){this.team=e,this.id=t.Data.Id,this.name=t.Data.Name,this.cell=t.Cell,this.situation=t.Situation,this.playerState=t,this.canAct=1==t.CanAct&&this.situation===st.Active,this.skills=_a.translateStringNumberList(t.Data.ListSkills)||[],this.isBallCarrier=0==ma(n.Ball.Cell,this.cell)&&1==n.Ball.IsHeld}get skillNames(){return this.skills.map((e=>ot[e]))}}class xa{teamState;constructor(e,t){this.players=e.ListPitchPlayers.PlayerState.map((e=>new ba(this,e,t))),this.name=e.Data.Name,this.id=e.Data.TeamId||0,this.turn=e.GameTurn||0}get shortName(){return this.name.split(/\s+/).map((e=>e[0])).join("")}}class wa{teams;activeTeam;turn;constructor({teams:e,activeTeamId:t,ballCell:n}){this.teams=e,this.activeTeam=e.filter((e=>e.id==t))[0]||e[0],this.turn=this.activeTeam&&this.activeTeam.turn||0,this.ballCell=n}static argsFromXml(e){const t={};return t.teams=e.ListTeams.TeamState.map((t=>new xa(t,e))),t.activeTeamId=e.ActiveTeam,t.ballCell=e.Ball.Cell,t}playerById(e){for(var t of this.teams)for(var n of t.players)if(n.id===e)return n}playerAtPosition(e){for(var t of this.teams)for(var n of t.players)if((n.cell.x||0)===(e.x||0)&&(n.cell.y||0)===(e.y||0))return n;console.log("No player found",{replayStep:this.replayStep,action:this.action,cell:e})}}class _a{static handledSkills=[];static diceSeparator=", ";constructor(e){Object.assign(this,e),this.onPitchValues={},this.onTeamValues={},this.armorRollCache={},this.dependentRolls=[],console.assert(!this.unhandledSkills||0==this.unhandledSkills.length,"Unhandled skills for roll",{roll:this,skills:this.unhandledSkills&&this.unhandledSkills.map((e=>ot[e.SkillId])),rollName:this.rollName})}static argsFromXml(e){const t={};t.initialBoardState=new wa(wa.argsFromXml(e.initialBoard)),t.finalBoardState=new wa(wa.argsFromXml(e.replayStep.BoardState));var n=e.action.PlayerId;return t.activePlayer=t.initialBoardState.playerById(n),t.rollType=e.boardActionResult.RollType,t.dice=this.dice(e.boardActionResult),t.skillsInEffect=da(e.boardActionResult.CoachChoices.ListSkills.SkillInfo),t.unhandledSkills=t.skillsInEffect.filter((e=>!this.handledSkills.includes(e.SkillId))),t.ignore=this.ignore(e),t.actionType=e.action.ActionType,t.rollStatus=e.boardActionResult.RollStatus,t.resultType=e.boardActionResult.ResultType,t.subResultType=e.boardActionResult.SubResultType,t.stepIndex=e.stepIndex,t.resultIndex=e.resultIndex,t.actionIndex=e.actionIndex,t.isReroll=[lt.RerollTaken,lt.RerollWithSkill].includes(t.rollStatus),t}get activeTeam(){return this.finalBoardState.activeTeam}get teams(){return this.finalBoardState.teams}get turn(){return this.finalBoardState.turn}get rollName(){return this.constructor.rollName}get jointDescription(){return[this.description].concat(this.dependentRolls.map((e=>e.shortDescription||e.description))).join(" → ")}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice}`}get shortDescription(){return`${this.rollName}: ${this.activePlayer.name} - ${this.dice.join(this.constructor.diceSeparator)}`}isDependentRoll(e){return!1}value(e,t){throw"value must be defined by subclass"}get expectedValue(){return this.possibleOutcomes.expectedValue}get possibleOutcomes(){throw`possibleOutcomes must be defined by subclass ${this.constructor.name}`}simulateDice(){throw"simulateDice must be defined by subclass"}static ignore(e){return e.boardActionResult.RollStatus==lt.RerollNotTaken||void 0===e.boardActionResult.CoachChoices.ListDices}static dice(e){return this.translateStringNumberList(e.CoachChoices.ListDices)}get actualValue(){const e=this.value(this.dice,!1);return e instanceof tn?e:new rn(this.rollName,e)}get valueWithDependents(){return this.actualValue.add(...this.dependentRolls.map((e=>e.actualValue)))}get actual(){var e=this.dataPoint(-1,ya);const t=this.possibleOutcomes.flat.map((t=>({value:t.value-e.expectedValue,weight:t.weight})));return Object.assign(e,{turn:this.turn,player:this.activePlayer&&this.activePlayer.name||"",playerSkills:this.activePlayer&&this.activePlayer.skills.map((e=>ot[e]))||[],rollName:this.rollName,dice:this.dice,dnvMin:Math.min(...t.map((e=>e.value))),dnvq33:hn(t,.33,"value","weight"),dnvMed:hn(t,.5,"value","weight"),dnvq67:hn(t,.67,"value","weight"),dnvMax:Math.max(...t.map((e=>e.value))),outcomes:this.possibleOutcomes.flat.map((t=>t.value-e.expectedValue)),weights:this.possibleOutcomes.flat.map((e=>e.weight)),description:this.jointDescription,valueDescription:`${this.valueWithDependents.valueString} ${this.possibleOutcomes.valueString}`})}simulated(e){return this.dataPoint(e,va)}dataPoint(e,t){var n;return t==ya?n=this.valueWithDependents.singularValue:t==va&&(n=this.possibleOutcomes.sample()),{iteration:e,turn:this.turn,activeTeamId:this.activeTeam.id,activeTeamName:this.activeTeam.name,teamId:this.activePlayer?this.activePlayer.team.id:this.activeTeam.id,teamName:this.activePlayer?this.activePlayer.team.name:this.activeTeam.name,outcomeValue:n,type:t,expectedValue:this.expectedValue,netValue:n-this.expectedValue,rollIndex:this.rollIndex}}static translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}static fromReplayStep(e,t,n){for(var r=da(n.RulesEventBoardAction),i=[],a=0;a<r.length;a++){var o=r[a];i=i.concat(_a.fromAction(e,t,n,a,o))}return i}static fromAction(e,t,n,r,i){for(var a=da(i.Results.BoardActionResult),o=[],s=0;s<a.length;s++){var l=a[s],u=this.fromBoardActionResult(e,t,n,r,i,s,l);u&&o.push(u)}return 0==a.length&&console.warn("Unexpectedly missing boardactionresult",{stepIndex:t,replayStep:n,action:i}),o}static fromBoardActionResult(e,t,n,r,i,a,o){var s;return null===(s=void 0===o.RollType?Da:Ta[o.RollType])?null:s?new s(s.argsFromXml({initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o})):(console.warn("Unknown roll "+o.RollType,{initialBoard:e,stepIndex:t,replayStep:n,actionIndex:r,action:i,resultIndex:a,boardActionResult:o}),null)}onActiveTeam(e){return e.team.id===this.activeTeam.id}playerValue(e){var t=this.initialBoardState.ballCell;if((t.x||0)<0||(t.y||0)<0)return this.rawPlayerValue(e);var n=ma(t,e.cell);return 0==n?this.rawPlayerValue(e).product(new rn("On Ball",2)).named(`PV(${e.name})`):1==n?this.rawPlayerValue(e).product(new rn("By Ball",1.5)).named(`PV(${e.name})`):this.rawPlayerValue(e)}rawPlayerValue(e){return new rn(`TV(${e.name})`,1)}teamValue(e,t,n){return new on(e.players.filter((e=>t.includes(e.situation)||e.id==n.id)).map((e=>this.playerValue(e))),`TV(${e.name})`)}get halfTurnsInGame(){var e=this.teams.map((e=>this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}get halfTurnsInHalf(){var e=this.teams.map((e=>this.turn<=8?8-e.turn:this.turn<=16?16-e.turn:24-e.turn));return e[0]+e[1]}stunTurns(e){return Math.min(this.onActiveTeam(e)?4:3,this.halfTurnsInHalf)}kdTurns(e){return Math.min(this.onActiveTeam(e)?2:1,this.halfTurnsInHalf)}onPitchValue(e){return this.onPitchValues[e.id]||(this.onPitchValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[st.Active],e).named(`TPV(${e.team.name})`)).named(`%PV(${e.name})`))}onTeamValue(e){return this.onTeamValues[e.id]||(this.onTeamValues[e.id]=this.playerValue(e).divide(this.teamValue(e.team,[st.Active,st.Reserves,st.KO],e).named("Players on Team")).named(e.name))}armorRoll(e){return this.armorRollCache[e.id]||(this.armorRollCache[e.id]=new Oa({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:e}))}knockdownValue(e,t){const n=this.onPitchValue(e);var r=this.kdTurns(e),i=pa(r),a=[new rn(`TDT(${r/2})`,i)];this.onActiveTeam(e)&&a.push(new rn("On Active Team",-1));var o=n.product(...a).named(`KD(${e.name})`);return t&&(o=o.add(this.armorRoll(e).possibleOutcomes.named("Armor Roll"))),o}stunValue(e){var t=this.onPitchValue(e),n=this.stunTurns(e),r=pa(n),i=[new rn(`TDT(${n/2})`,r)];return this.onActiveTeam(e)&&i.push(new rn("On Active Team",-1)),t.product(...i).named(`STUN(${e.name})`)}koValue(e){const t=this.onPitchValue(e);var n=this.halfTurnsInHalf,r=this.stunTurns(e),i=[new rn(`TDT(${n-r})`,pa(n)-pa(r))];return this.onActiveTeam(e)&&i.push(new rn("On Active Team",-1)),t.product(...i).named(`KO(${e.name})`)}casValue(e){const t=this.onTeamValue(e).product(new rn(`TDT(${this.halfTurnsInGame/2})`,pa(this.halfTurnsInGame))),n=this.onPitchValue(e).subtract(this.onTeamValue(e)).product(new rn(`TDT(${this.halfTurnsInHalf/2})`,pa(this.halfTurnsInHalf))),r=t.add(n).named(`PV(${e.name})`);var i=[];return this.onActiveTeam(e)&&i.push(new rn("On Active Team",-1)),r.product(...i).subtract(this.stunValue(e)).named(`CAS(${e.name})`)}get dependentMoveValues(){const e=this.dependentRolls.filter((e=>e.constructor==Da));return e.length>0?new on(e.map((e=>e.value())),"Following Moves"):null}get unactivatedPlayers(){return Object.defineProperty(this,"unactivatedPlayers",{value:this.activeTeam.players.filter((e=>e.canAct))}),this.unactivatedPlayers}get turnoverValue(){const e=this.unactivatedPlayers.filter((e=>e!=this.activePlayer)).map((e=>this.onPitchValue(e)));var t;return t=e.length>0?new on(e).named("Unactivated PV").product(-1).named("Turnover"):new rn("No Active Players",0),Object.defineProperty(this,"turnoverValue",{value:t}),this.turnoverValue}get rerollValue(){return new rn("Reroll",0)}}class ka extends _a{static numDice=1;static diceSeparator="+";static canCauseInjury=!1;static includeFollowingMoves=!0;constructor(e){super(e),console.assert(!this.computedTarget||!this.target||this.computedTarget==this.target,"Computed target (%d) doesn't equal target from replay XML (%d)",this.computedTarget,this.target,this),console.assert(void 0===this.computedModifier||void 0===this.modifier||this.computedModifier==this.modifier,"Computed modifier (%d) doesn't equal modifier from replay XML (%d)",this.computedModifier,this.modifier,this),console.assert(void 0===this.dice||this.constructor.numDice==this.dice.length,"Mismatch in number of dice (%d) and expected number of dice (%d)",this.dice&&this.dice.length,this.constructor.numDice,this)}static argsFromXml(e){const t=super.argsFromXml(e);return t.modifier=da(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t.target=e.boardActionResult.Requirement,t}get description(){var e=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${e} - ${this.dice} (${this.modifiedTarget})`}get actual(){return Object.assign(super.actual,{target:this.modifiedTarget})}get modifiedTarget(){var e=(this.target||this.computedTarget)-(this.modifier||this.computedModifier||0);return 1==this.constructor.numDice?Math.min(6,Math.max(2,e)):e}value(e,t){return e.reduce(((e,t)=>e+t),0)>=this.modifiedTarget?this.passValue(t).add(t?this.dependentMoveValues:null):this.dependentRolls.length>=1&&this.dependentRolls[0].constructor==this.constructor&&this.dependentRolls[0].isReroll?new rn(`Rerolled ${this.rollName}`,this.rerollValue):this.failValue(t)}get possibleOutcomes(){for(var e=[0],t=0;t<this.constructor.numDice;t++){for(var n=[],r=1;r<=6;r++)for(const t of e)n.push(t+r);e=n}var i=[],a=[];for(const t of e)t>=this.modifiedTarget?i.unshift(t):a.unshift(t);var o=[];if(i.length>0){const e=Math.min(...i),t=Math.max(...i);o.push({name:e===t?e:`${e}-${t}`,value:this.passValue(!0).add(this.dependentMoveValues),weight:i.length/(i.length+a.length)})}if(a.length>0){const e=Math.min(...a),t=Math.max(...a);o.push({name:e===t?e:`${e}-${t}`,value:this.hasSkillReroll?this.reroll.possibleOutcomes:this.failValue(!0),weight:a.length/(i.length+a.length)})}return Object.defineProperty(this,"possibleOutcomes",{value:new nn(o)}),this.possibleOutcomes}get reroll(){const e=new this.constructor({...this,rollStatus:lt.RerollWithSkill});return Object.defineProperty(this,"reroll",{value:e}),this.reroll}get hasSkillReroll(){return this.activePlayer.skills.includes(this.constructor.rerollSkill)&&!this.skillsInEffect.includes(this.constructor.rerollCancelSkill)&&![lt.RerollWithSkill,lt.RerollTaken].includes(this.rollStatus)}simulateDice(){return this.dice.map((()=>ha([1,2,3,4,5,6])))}passValue(){return new rn("Pass",0)}failValue(){return new rn("Fail",0)}isDependentRoll(e){return e.rollType==this.rollType&&[lt.RerollTaken,lt.RerollWithSkill].includes(e.rollStatus)||this.constructor.canCauseInjury&&[Oa,Ea,Aa].includes(e.constructor)&&!e.isFoul||this.constructor.includeFollowingMoves&&e.constructor==Da}}class Oa extends ka{static numDice=2;static handledSkills=[at,De,Pe,He];static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=59==n.RollType,t.isPileOn){var r=da(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==He))[0].PlayerId)}}return t.isFoul=e.action.ActionType==mt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(da(e.replayStep.RulesEventBoardAction)[0].PlayerId),console.log(e,t.finalBoardState.activePlayer,t.foulingPlayer)),t}get description(){if(this.isFoul){var e=this.foulingPlayer.skills.length>0?` (${this.foulingPlayer.skillNames.join(", ")})`:"",t=this.activePlayer.skills.length>0?` (${this.activePlayer.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.foulingPlayer.team.shortName}] ${this.foulingPlayer.name}${e} against ${this.activePlayer.name}${t} - ${this.dice.join(this.constructor.diceSeparator)}`}return super.description}isDependentRoll(e){return this.isFoul&&([Ea,Aa].includes(e.constructor)&&e.isFoul&&e.activePlayer.id==this.activePlayer.id||e.constructor==Fa)}get rollName(){return this.isFoul?"Foul (Armor)":this.isPileOn?"Pile On (Armor)":"Armor"}get computedTarget(){return this.activePlayer.playerState.Data.Av+1}get computedModifier(){return 0}get injuryRoll(){return Object.defineProperty(this,"injuryRoll",{value:new Ea({initialBoardState:this.initialBoardState,finalBoardState:this.finalBoardState,activePlayer:this.activePlayer,modifier:0})}),this.injuryRoll}value(e,t){var n=super.value(e,t);return this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}passValue(e){var t=this.stunValue(this.activePlayer);if(e&&(t=t.add(this.injuryRoll.possibleOutcomes.named("Injury Roll"))),this.isPileOn){const e=this.knockdownValue(this.pilingOnPlayer,!1);return t.add(e)}return t}failValue(){var e=new rn("No Break",0);return this.isPileOn?e.add(this.knockdownValue(this.pilingOnPlayer,!1)):e}}class Sa extends ka{static rollName="Intercept";static handledSkills=[Ae];passValue(){return this.turnoverValue}}class $a extends ka{static rollName="Catch";static handledSkills=[Le,$e,Ae];static rerollSkill=$e;failValue(){return this.turnoverValue}}class Ea extends _a{static handledSkills=[De,Pe,Qe];static diceSeparator="+";static argsFromXml(e){const t=super.argsFromXml(e);if(0==e.resultIndex)t.isPileOn=!1;else{var n=e.action.Results.BoardActionResult[e.resultIndex-1];if(t.isPileOn=60==n.RollType,t.isPileOn){var r=da(n.CoachChoices.ListSkills.SkillInfo);t.pilingOnPlayer=t.finalBoardState.playerById(r.filter((e=>e.SkillId==He))[0].PlayerId)}}return t.isFoul=e.action.ActionType==mt,t.isFoul&&(t.foulingPlayer=t.finalBoardState.playerById(da(e.replayStep.RulesEventBoardAction)[0].PlayerId)),t.modifier=da(e.boardActionResult.ListModifiers.DiceModifier||[]).map((e=>e.Value||0)).reduce(((e,t)=>e+t),0)||0,t}get rollName(){return this.isPileOn?"Pile On (Injury)":"Injury"}static ignore(e){return 1!=e.boardActionResult.IsOrderCompleted?(console.log("Ignoring incomplete InjuryRoll",{roll:this}),!0):super.ignore(e)}injuryValue(e){return this.activePlayer.skills.includes(Qe)&&(e+=1),e<=7?new rn("No Injury",0):e<=9?this.koValue(this.activePlayer):this.casValue(this.activePlayer)}value(e){var t=e[0]+e[1]+this.modifier,n=this.injuryValue(t);return this.isPileOn&&(n=n.subtract(this.onPitchValue(this.pilingOnPlayer))),this.isFoul&&e[0]==e[1]&&(n=n.add(this.casValue(this.foulingPlayer).named("Sent Off"),this.turnoverValue)),n}get possibleOutcomes(){for(var e={},t=1;t<=6;t++)for(var n=1;n<=6;n++){var r=e[this.value([t,n],!0).name];r||(r=e[this.value([t,n],!0).name]=[]),r.unshift({name:(t+n).toString(),value:this.value([t,n],!0)})}return Object.defineProperty(this,"possibleOutcomes",{value:new nn(Object.values(e).map((e=>{const t=Math.min(...e.map((e=>parseInt(e.name)))),n=Math.max(...e.map((e=>parseInt(e.name))));return{name:t===n?t:`${t}-${n}`,weight:e.length,value:e[0].value}})))}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ha([1,2,3,4,5,6])))}}class Aa extends _a{static rollName="Casualty";static diceSeparator="";static argsFromXml(e){const t=super.argsFromXml(e);return t.isFoul=e.action.ActionType==mt,t}static dice(e){var t=super.dice(e);return[(t=t.slice(0,t.length/2))[t.length-1]]}value(e){return new rn("CAS",0)}get possibleOutcomes(){for(var e=[],t=1;t<=6;t++)for(var n=1;n<=8;n++)e.unshift({name:`${t}${n}`,value:this.value(10*t+n,!0),weight:1});return Object.defineProperty(this,"possibleOutcomes",{value:new nn(e)}),this.possibleOutcomes}simulateDice(){return 10*ha([1,2,3,4,5,6])+ha([1,2,3,4,5,6,7,8])}static ignore(e){return e.boardActionResult.ResultType!=yt&&e.boardActionResult.SubResultType!=vt&&12!=e.boardActionResult.SubResultType?(console.warn("Ignoring casualty roll, should verify",{roll:this}),!0):super.ignore(e)}}class Da extends _a{static rollName="Move";static ignore(e){return 0==ma(e.action.Order.CellFrom,e.action.Order.CellTo.Cell)}static argsFromXml(e){const t=super.argsFromXml(e);return t.cellFrom=e.action.Order.CellFrom,t.cellTo=e.action.Order.CellTo.Cell,t}get jointDescription(){const e=[this].concat(this.dependentRolls),t=this.cellFrom,n=e[e.length-1].cellTo;return`Move: [${this.activePlayer.team.shortName}] ${this.activePlayer.name} - (${t.x||0}, ${t.y||0}) → (${n.x||0}, ${n.y||0})`}isDependentRoll(e){return e.constructor==Da&&this.activePlayer.id==e.activePlayer.id}value(){return this.activePlayer&&this.activePlayer.isBallCarrier?ga(this.activePlayer.team,this.cellTo).subtract(ga(this.activePlayer.team,this.cellFrom)):new rn("Move",0)}get possibleOutcomes(){return this.value().add(...this.dependentRolls.map((e=>e.value())))}}class Ca extends _a{static ignore(){return!0}value(){return new rn("No Value",0)}get expectedValue(){return 0}simulateDice(){return null}get possibleOutcomes(){return[]}}class Ma extends Ca{static rollName="Push";static handledSkills=[Ye]}class ja extends Ca{static rollName="Follow Up"}class Fa extends Ca{}const Ta={1:class extends ka{static rollName="GFI";static handledSkills=[Ze];static rerollSkill=Ze;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},2:class extends ka{static rollName="Dodge";static handledSkills=[Ne,Qe,Me,Ee,Je,Ge,Ie];static rerollSkill=Ee;static rerollCancelSkill=Je;static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e).add(this.turnoverValue)}},3:Oa,4:Ea,5:class extends _a{static rollName="Block";static handledSkills=[Je,Ee,ze,qe,Ce,je,rt,Fe];static diceSeparator="/";static argsFromXml(e){const t=super.argsFromXml(e);return t.isRedDice=e.boardActionResult.Requirement<0,t.attacker=t.activePlayer,t.defender=t.finalBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}isDependentRoll(e){return[Ma,ja,Da].includes(e.constructor)||[Oa,Ea,Aa].includes(e.constructor)&&!e.isFoul||e.rollType===this.rollType&&e.rollStatus==lt.RerollTaken}static dice(e){var t=super.dice(e);return t.slice(0,t.length/2).map((e=>$t[e]))}get description(){var e=this.isRedDice?" uphill":"",t=this.attacker.skills.length>0?` (${this.attacker.skillNames.join(", ")})`:"",n=this.defender.skills.length>0?` (${this.defender.skillNames.join(", ")})`:"";return`${this.rollName}: [${this.activePlayer.team.shortName}] ${this.activePlayer.name}${t} against ${this.defender.name}${n} - ${this.dice.join(this.constructor.diceSeparator)}${e}`}static ignore(e){return e.boardActionResult.ResultType!=yt||(e.boardActionResult.SubResultType==bt||(e.boardActionResult.SubResultType==xt||super.ignore(e)))}dieValue(e,t){const n=this.attacker,r=this.defender;var i=n&&n.skills||[],a=r&&r.skills||[];switch(e){case wt:return this.knockdownValue(n,t).add(this.turnoverValue);case _t:const e=i.includes(ze),u=a.includes(ze);var o=[];if(i.includes(rt)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));o.push(e)}if(i.includes(Ue)&&this.isBlitz){const e=this.knockdownValue(r,!1).product(new rn("Push",.33)).named(`Push(${r.name})`).add(t?this.dependentMoveValues:null);o.push(e)}var s,l=[];if(a.includes(rt)){const e=this.knockdownValue(r,!1).add(this.knockdownValue(n,!1));l.push(e)}if(e&&u){s=new rn("Block/Block",0).add(t?this.dependentMoveValues:null)}else if(e){s=this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}else if(u){s=this.knockdownValue(n,t)}else{s=this.knockdownValue(r,t).add(this.knockdownValue(n,t),this.turnoverValue)}return s.min(...l).max(...o);case kt:return(a.includes(je)?new rn("Stand Firm",0):this.knockdownValue(r,!1).product(new rn("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null);case Ot:return a.includes(Ee)&&!i.includes(Je)?(a.includes(je)?new rn("Stand Firm",0):this.knockdownValue(r,!1).product(new rn("Push",.33)).named(`Push(${r.name})`)).add(t?this.dependentMoveValues:null):this.knockdownValue(r,t).add(t?this.dependentMoveValues:null);case St:return this.knockdownValue(r,t).add(t?this.dependentMoveValues:null)}}value(e,t){if(this.dependentRolls.length>0&&this.dependentRolls[0].rollType==this.rollType&&this.dependentRolls[0].rollStatus==lt.RerollTaken)return this.rerollValue;var n=e.filter(((e,t,n)=>n.indexOf(e)===t)).map((e=>this.dieValue(e,t)));if(1==n.length)return n[0];if(this.isRedDice){var[r,...i]=n;return r.min(...i)}var[r,...i]=n;return r.max(...i)}get possibleOutcomes(){var e;const t=new nn([{name:kt,weight:1/3,value:this.dieValue(kt,!0)},{name:wt,weight:1/6,value:this.dieValue(wt,!0)},{name:St,weight:1/6,value:this.dieValue(St,!0)},{name:Ot,weight:1/6,value:this.dieValue(Ot,!0)},{name:_t,weight:1/6,value:this.dieValue(_t,!0)}]);return e=1==this.dice.length?t:this.isRedDice?new dn(new Array(this.dice.length).fill(t)):new fn(new Array(this.dice.length).fill(t)),Object.defineProperty(this,"possibleOutcomes",{value:e}),this.possibleOutcomes}simulateDice(){return this.dice.map((()=>ha([wt,_t,kt,kt,Ot,St])))}},6:class extends ka{static rollName="Stand Up";failValue(){return this.knockdownValue(this.activePlayer,!1)}},7:class extends ka{static rollName="Pickup";static rerollSkill=et;static handledSkills=[et,it,Ae];failValue(){return this.turnoverValue}},8:Aa,9:$a,10:null,11:null,12:class extends ka{static rollName="Pass";static rerollSkill=We;static handledSkills=[We,Ke,Te];failValue(){return this.turnoverValue}},13:Ma,14:ja,15:Fa,16:Sa,17:class extends ka{static rollName="Wake Up";constructor(e){super(e),this.finalBoardState.activeTeam=this.activePlayer.team,this.finalBoardState.turn=this.finalBoardState.activeTeam.turn+1}passValue(){return this.koValue(this.activePlayer).product(-1).named("Wake Up")}},19:null,20:class extends ka{static rollName="Bone Head";static handledSkills=[Be];failValue(){return this.knockdownValue(this.activePlayer,!1)}},21:class extends ka{static rollName="Really Stupid";static handledSkills=[Xe];failValue(){return this.knockdownValue(this.activePlayer,!1)}},22:class extends ka{static rollName="Wild Animal";static handledSkills=[nt];failValue(){return-this.onPitchValue(this.activePlayer)}},24:class extends ka{static rollName="Landing";static canCauseInjury=!0;failValue(e){return this.knockdownValue(this.activePlayer,e)}},26:null,29:class extends ka{static rollName="Dauntless";static handledSkills=[Re]},31:class extends ka{static rollName="Jump-Up";static handledSkills=[Ve];failValue(){return-this.onPitchValue(this.activePlayer)}},36:class extends ka{static rollName="Leap";static canCauseInjury=!0;failValue(){return this.knockdownValue(this.activePlayer).add(this.turnoverValue)}},40:class extends ka{static rollName="Take Root";static handledSkills=[Fe];failValue(){return this.knockdownValue(this.activePlayer,!1)}},54:class extends ka{static rollName="Fireball";static canCauseInjury=!0;passValue(e){return this.knockdownValue(this.activePlayer,e)}},55:class extends ka{static rollName="Lightning Bolt";static canCauseInjury=!0;static argsFromXml(e){const t=super.argsFromXml(e);return t.activePlayer=t.initialBoardState.playerAtPosition(e.action.Order.CellTo.Cell),t}passValue(e){return this.knockdownValue(this.activePlayer,e)}},56:class extends ka{static rollName="Throw Teammate";static handledSkills=[tt];failValue(){return new rn("Fail",0)}isDependentRoll(e){return[$a,Sa].includes(e.constructor)}},58:null,59:Oa,60:Ea,61:null,64:null,70:null},Na=function(e){var t,n,r,i=(n=(t=e).Replay.ReplayStep[0],r=t.Replay.ReplayStep[t.Replay.ReplayStep.length-1],console.log("Full gameinfo:"),console.log(n.GameInfos),{stadiumName:n.GameInfos.NameStadium,stadiumType:n.GameInfos.StructStadium,leagueName:n.GameInfos.RowLeague.Name,homeTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[0].UserId,teamName:n.BoardState.ListTeams.TeamState[0].Data.Name,raceId:n.BoardState.ListTeams.TeamState[0].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.HomeScore||0},awayTeam:{coachName:n.GameInfos.CoachesInfos.CoachInfos[1].UserId,teamName:n.BoardState.ListTeams.TeamState[1].Data.Name,raceId:n.BoardState.ListTeams.TeamState[1].Data.IdRace,score:r.RulesEventGameFinished.MatchResult.Row.AwayScore||0}});console.log("Extracted game details...",i);for(var a=[],o=0;o<e.Replay.ReplayStep.length;o++){var s=e.Replay.ReplayStep[o];s.index=o,a=a.concat(_a.fromReplayStep(e.Replay.ReplayStep[o-1]&&e.Replay.ReplayStep[o-1].BoardState,o,s))}return console.log("Extracted rolls...",a),(a=(a=a.filter((e=>!e.ignore))).reduce(((e,t)=>(e.length>0&&e[e.length-1].isDependentRoll(t)?e[e.length-1].dependentRolls.push(t):e.push(t),e)),[])).forEach(((e,t)=>e.rollIndex=t)),{fullReplay:e.Replay,gameDetails:i,playerDetails:{},rolls:a,version:1}};function Ra(t){let n,r,i,a,o,s,l,u,c,f,d;return{c(){n=w("div"),r=w("span"),i=_("Select Replay\n    "),a=w("input"),o=k(),s=w("script"),u=w("script"),A(a,"type","file"),A(a,"accept",".bbrz,.zip"),A(a,"class","svelte-16kp35q"),A(r,"id","file-input-button"),A(r,"class","btn btn-primary btn-file centered svelte-16kp35q"),A(n,"class","text-center"),s.src!==(l="https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js")&&A(s,"src","https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js"),u.src!==(c="https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js")&&A(u,"src","https://cdnjs.cloudflare.com/ajax/libs/fast-xml-parser/3.17.1/parser.min.js"),A(u,"integrity","sha512-JtZhe+DT2O3VPwzAMhyOpVY75fn92Zm1ebHVgAdXFf/x+7SfbonV/O7OWLsHkj11+yMtZAXavsuMvCaQS3WXrQ=="),A(u,"crossorigin","anonymous")},m(e,l){v(e,n,l),y(n,r),y(r,i),y(r,a),t[2](a),v(e,o,l),y(document.head,s),y(document.head,u),f||(d=S(a,"change",t[1]),f=!0)},p:e,i:e,o:e,d(e){e&&b(n),t[2](null),e&&b(o),b(s),b(u),f=!1,d()}}}function Pa(e,t,n){const r=I();let i;return[i,function(){console.log("Preparing to parse XML..."),r("replayLoading");const e=i.files;e.length>0&&Se(e[0],(function(t){console.log("Preparing to process replay json..."),t.Replay.filename=e[0].name;const n=Na(t);r("replayLoaded",n)}),(function(e){r("replayError"),alert(e)}))},function(e){V[e?"unshift":"push"]((()=>{i=e,n(0,i)}))}]}class za extends Oe{constructor(e){super(),ke(this,e,Pa,Ra,s,{})}}function Ba(t){let n;return{c(){n=w("div"),n.innerHTML='<div class="progress-bar progress-bar-striped progress-bar-animated active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 110%">Loading...</div>',A(n,"id","loading"),A(n,"class","progress")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class La extends Oe{constructor(e){super(),ke(this,e,null,Ba,s,{})}}function Ia(t){let n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,x,O,S,$,E,C,M,j,F,T,N,R,P,z,B,L,I,q,U,V,W,H,G,X,Y,J,K,Q,Z,ee,te,ne,re,ie,ae,oe,se,le,ue,ce,fe,de,he,pe,me,ge,ye=t[0].leagueName+"",ve=t[0].homeTeam.teamName+"",be=t[0].homeTeam.coachName+"",xe=(Jt[t[0].homeTeam.raceId]||`Unknown: ${t[0].homeTeam.raceId}`)+"",we=t[0].homeTeam.score+"",_e=t[0].awayTeam.score+"",ke=t[0].awayTeam.teamName+"",Oe=t[0].awayTeam.teamName+"",Se=(Jt[t[0].awayTeam.raceId]||`Unknown: ${t[0].awayTeam.raceId}`)+"",$e=t[0].stadiumName+"",Ee=(t[0].stadiumType||"None")+"";return{c(){n=w("div"),r=w("div"),i=w("div"),a=_(t[1]),o=k(),s=w("div"),l=w("div"),u=_("League:\n      "),c=w("span"),f=_(ye),d=k(),h=w("div"),p=w("div"),m=w("div"),g=w("div"),x=w("span"),O=_(ve),S=k(),$=w("div"),E=_("Coach:\n          "),C=w("span"),M=_(be),j=k(),F=w("div"),T=_("Race:\n          "),N=w("span"),R=_(xe),P=k(),z=w("div"),B=w("span"),L=_(we),I=_("\n        -\n        "),q=w("span"),U=_(_e),V=k(),W=w("div"),H=w("div"),G=w("span"),X=_(ke),Y=k(),J=w("div"),K=_("Coach:\n          "),Q=w("span"),Z=_(Oe),ee=k(),te=w("div"),ne=_("Race:\n          "),re=w("span"),ie=_(Se),ae=k(),oe=w("div"),se=w("div"),le=_("Stadium:\n        "),ue=w("span"),ce=_($e),fe=k(),de=w("div"),he=w("div"),pe=_("Stadium Enhancement:\n        "),me=w("span"),ge=_(Ee),A(i,"class","col-sm-12"),A(r,"class","row filename svelte-ooduml"),A(c,"id","league-name"),A(l,"class","col-sm-12"),A(s,"class","row league-name svelte-ooduml"),A(x,"id","home-team"),A(g,"class","team-name home svelte-ooduml"),A(C,"id","home-coach"),A($,"class","coach-name svelte-ooduml"),A(N,"id","home-race"),A(F,"class","race svelte-ooduml"),A(m,"class","col-sm-5 team-details team-details-left svelte-ooduml"),A(B,"id","home-score"),A(B,"class","home svelte-ooduml"),A(q,"id","away-score"),A(q,"class","away svelte-ooduml"),A(z,"class","col-sm-2 score svelte-ooduml"),A(G,"id","away-team"),A(H,"class","team-name away svelte-ooduml"),A(Q,"id","away-coach"),A(J,"class","coach-name svelte-ooduml"),A(re,"id","away-race"),A(te,"class","race svelte-ooduml"),A(W,"class","col-sm-5 team-details team-details-right svelte-ooduml"),A(p,"class","row"),A(ue,"id","stadium-name"),A(se,"class","col-sm-12"),A(oe,"class","row stadium-name svelte-ooduml"),A(me,"id","stadium-type"),A(he,"class","col-sm-12"),A(de,"class","row stadium-type svelte-ooduml"),A(h,"id","game-details"),A(n,"id","summary"),A(n,"class","container svelte-ooduml")},m(e,t){v(e,n,t),y(n,r),y(r,i),y(i,a),y(n,o),y(n,s),y(s,l),y(l,u),y(l,c),y(c,f),y(n,d),y(n,h),y(h,p),y(p,m),y(m,g),y(g,x),y(x,O),y(m,S),y(m,$),y($,E),y($,C),y(C,M),y(m,j),y(m,F),y(F,T),y(F,N),y(N,R),y(p,P),y(p,z),y(z,B),y(B,L),y(z,I),y(z,q),y(q,U),y(p,V),y(p,W),y(W,H),y(H,G),y(G,X),y(W,Y),y(W,J),y(J,K),y(J,Q),y(Q,Z),y(W,ee),y(W,te),y(te,ne),y(te,re),y(re,ie),y(h,ae),y(h,oe),y(oe,se),y(se,le),y(se,ue),y(ue,ce),y(h,fe),y(h,de),y(de,he),y(he,pe),y(he,me),y(me,ge)},p(e,[t]){2&t&&D(a,e[1]),1&t&&ye!==(ye=e[0].leagueName+"")&&D(f,ye),1&t&&ve!==(ve=e[0].homeTeam.teamName+"")&&D(O,ve),1&t&&be!==(be=e[0].homeTeam.coachName+"")&&D(M,be),1&t&&xe!==(xe=(Jt[e[0].homeTeam.raceId]||`Unknown: ${e[0].homeTeam.raceId}`)+"")&&D(R,xe),1&t&&we!==(we=e[0].homeTeam.score+"")&&D(L,we),1&t&&_e!==(_e=e[0].awayTeam.score+"")&&D(U,_e),1&t&&ke!==(ke=e[0].awayTeam.teamName+"")&&D(X,ke),1&t&&Oe!==(Oe=e[0].awayTeam.teamName+"")&&D(Z,Oe),1&t&&Se!==(Se=(Jt[e[0].awayTeam.raceId]||`Unknown: ${e[0].awayTeam.raceId}`)+"")&&D(ie,Se),1&t&&$e!==($e=e[0].stadiumName+"")&&D(ce,$e),1&t&&Ee!==(Ee=(e[0].stadiumType||"None")+"")&&D(ge,Ee)},i:e,o:e,d(e){e&&b(n)}}}function qa(e,t,n){let{gameDetails:r}=t,{filename:i}=t;return e.$$set=e=>{"gameDetails"in e&&n(0,r=e.gameDetails),"filename"in e&&n(1,i=e.filename)},[r,i]}class Ua extends Oe{constructor(e){super(),ke(this,e,qa,Ia,s,{gameDetails:0,filename:1})}}function Va(t){let n;return{c(){n=w("div"),n.innerHTML='<div class="col-sm-12"><div><h1>What am I looking at?</h1> \n      <p>Diced or Not has imported your replay, and categorized each of the dice\n        rolls how much value you got out of them, based on whether they passed\n        or failed. It also computed what value you should have expected to get\n        out of those rolls. Finally, it compared the value you got to the\n        expected value, and add up that net value across the game. You can see\n        that trend-line in the graph above.</p> \n      <p>The values attributed to the rolls are based on the following standards:</p> \n      <ul><li>Each teams player positions/activations is worth 1 per turn. This\n          means that a block that results in a knockdown for your opponent will\n          give you fractional points based on that player&#39;s TV value compared to\n          the whole team value, while getting your own player stunned would cost\n          you that same fraction, but times multiple turns.</li> \n        <li>Future player value is time-discounted to account for the uncertainty\n          of future events. So, if first turn of knockdown is worth 0.1, then\n          the second turn of a stun would be worth 0.09, the third 0.081, and so\n          on.</li> \n        <li>Player value is scaled based on vicinity to the ball and goal line.\n          So, having the ball doubles the value of your player, and marking the\n          ball multiplies the value by 1.5. Being within movement distance of\n          the endzone also multiplies player value, by larger amounts as the\n          player is closer to the endzone.</li> \n        <li>Ball-possession and fields position account for another pool of\n          points. Based on the expectation of a team taking 8 turns to score\n          once in a drive, moving the ball all the way up the field and scoring\n          a touchdown should be worth 8 points. We divide that in half: 4 points\n          for actually scoring the touchdown, and 4 points for moving the ball\n          up the field. The 4 field-position points are weighted more heavily\n          toward the endzone, and are awarded by net-position. So, moving the\n          ball one square forward gives you points equal to the value of your\n          new position minus the value of your old position.</li></ul> \n      <p>Once your game was analyzed, Diced or Not simulated rolling those same\n        sets of dice\n        <span id="game-count">0</span>\n        more times, and compared the net value of your game to the net value in\n        the simulated games. The fainter background lines show the 99th, 90th,\n        75th, 50th, 25th, 10th, and 1st percentile cumulative net-values. So, if\n        your line is above the top background line, then your game was better\n        than 99% of games with the same dice, and you most definitely were not\n        diced. If you line was below the 3rd line from the bottom, then your\n        game was worse than 3/4s of games, and you might have a slight argument\n        for having been diced.</p></div> \n    <div><h2>Terminology</h2> \n      <dl><dt id="value-def">Value</dt><dd>An abstraction of how much getting that roll result likely helped your\n          game. For example, getting a Defender Down on a Block roll would be a\n          +1 value, and getting an Attacker Down on a Block roll would be a -1\n          value (because it ends your turn). More details of the values assigned\n          are listed in the\n          <a href="#value-table">Values Table</a>.\n        </dd><dt id="expected-value-def">Expected Value</dt><dd>The average\n          <a href="value-def">Value</a>\n          over all of the possible results of a roll.\n        </dd><dt>Net Value</dt><dd>The difference between the actual value and the expected value on a\n          specific roll.\n        </dd><dt>Cumulative Net Value</dt><dd>The running total of Net Value for all the rolls taken so far by a\n          team.</dd></dl></div> \n    <div><h2>To Do</h2> \n      <div><h3>Value calculation changes</h3> \n        <ul><li>Add points when a touchdown is scored.</li> \n          <li>Count net change in points between rolls.</li> \n          <li>Handle the value of team rerolls, and the expected results of\n            rerolling.</li> \n          <li>Account for Bribe use in Fouls.</li> \n          <li>Compute player value by using actual TV values.</li> \n          <li>Adjust player value based on distance to endzone.</li> \n          <li>Include Piling-On in block expected value calculations.</li> \n          <li>Make sure armor/injury rolls make use of Mighty Blow in expected\n            value calculations.</li> \n          <li>Make sure that Claw is properly accounted for in possible outcome\n            calculations.</li> \n          <li>Make sure that Dirty Player is properly accountef for in possibel\n            outcome calculations.</li></ul></div> \n      <div><h3>Display improvements</h3> \n        <ul><li>Add thumbnails of the board state across the game.</li> \n          <li>Make the Dice logs less verbose by making player stats popups.</li> \n          <li>Display the full range of expected values and their probablities on\n            the graph.</li></ul></div></div></div>',A(n,"id","explanation"),A(n,"class","row")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class Wa extends Oe{constructor(e){super(),ke(this,e,null,Va,s,{})}}function Ha(t){let n;return{c(){n=w("div"),n.innerHTML='<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span> \n    <span class="sr-only">Error:</span>\n    Could not process saved replay data, it might be a bad URL.',A(n,"class","alert alert-danger svelte-tlpcpu"),A(n,"role","alert"),A(n,"id","data-param-error")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class Ga extends Oe{constructor(e){super(),ke(this,e,null,Ha,s,{})}}function Xa(e,t,n){const r=e.slice();return r[7]=t[n],r}function Ya(e,t,n){const r=e.slice();return r[7]=t[n],r}function Ja(t){let n;return{c(){n=_(t[0])},m(e,t){v(e,n,t)},p(e,t){1&t&&D(n,e[0])},i:e,o:e,d(e){e&&b(n)}}}function Ka(e){let t,n,r,i,a,o,s,l,u,c,f=e[0].values.reduce(e[5],null)+"",d=e[0].valueString+"",h=e[0].name&&to(e),p=e[1]&&no(e);return{c(){t=w("details"),n=w("summary"),h&&h.c(),r=k(),i=_(f),a=k(),o=_(d),s=k(),p&&p.c(),t.open=e[1]},m(f,d){v(f,t,d),y(t,n),h&&h.m(n,null),y(n,r),y(n,i),y(n,a),y(n,o),y(t,s),p&&p.m(t,null),l=!0,u||(c=S(t,"click",E($(e[6]))),u=!0)},p(e,a){e[0].name?h?h.p(e,a):(h=to(e),h.c(),h.m(n,r)):h&&(h.d(1),h=null),(!l||1&a)&&f!==(f=e[0].values.reduce(e[5],null)+"")&&D(i,f),(!l||1&a)&&d!==(d=e[0].valueString+"")&&D(o,d),e[1]?p?(p.p(e,a),2&a&&ce(p,1)):(p=no(e),p.c(),ce(p,1),p.m(t,null)):p&&(le(),fe(p,1,1,(()=>{p=null})),ue()),(!l||2&a)&&(t.open=e[1])},i(e){l||(ce(p),l=!0)},o(e){fe(p),l=!1},d(e){e&&b(t),h&&h.d(),p&&p.d(),u=!1,c()}}}function Qa(e){let t,n;return t=new go({props:{dist:e[0].simple}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};1&n&&(r.dist=e[0].simple),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function Za(e){let t,n,r,i,a,o,s,l,u=e[0].valueString+"",c=e[0].name&&oo(e),f=e[1]&&so(e);return{c(){t=w("details"),n=w("summary"),c&&c.c(),r=k(),i=_(u),a=k(),f&&f.c(),t.open=e[1]},m(u,d){v(u,t,d),y(t,n),c&&c.m(n,null),y(n,r),y(n,i),y(t,a),f&&f.m(t,null),o=!0,s||(l=S(t,"click",E($(e[4]))),s=!0)},p(e,a){e[0].name?c?c.p(e,a):(c=oo(e),c.c(),c.m(n,r)):c&&(c.d(1),c=null),(!o||1&a)&&u!==(u=e[0].valueString+"")&&D(i,u),e[1]?f?(f.p(e,a),2&a&&ce(f,1)):(f=so(e),f.c(),ce(f,1),f.m(t,null)):f&&(le(),fe(f,1,1,(()=>{f=null})),ue()),(!o||2&a)&&(t.open=e[1])},i(e){o||(ce(f),o=!0)},o(e){fe(f),o=!1},d(e){e&&b(t),c&&c.d(),f&&f.d(),s=!1,l()}}}function eo(e){let t,n,r,i;const a=[ho,fo],o=[];function s(e,t){return e[0].value instanceof tn?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=O()},m(e,n){o[t].m(e,n),v(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(le(),fe(o[l],1,1,(()=>{o[l]=null})),ue(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),ce(n,1),n.m(r.parentNode,r))},i(e){i||(ce(n),i=!0)},o(e){fe(n),i=!1},d(e){o[t].d(e),e&&b(r)}}}function to(e){let t,n,r=e[0].name+"";return{c(){t=_(r),n=_(" →")},m(e,r){v(e,t,r),v(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&D(t,r)},d(e){e&&b(t),e&&b(n)}}}function no(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=ao(Xa(e,a,t));const s=e=>fe(o[e],1,1,(()=>{o[e]=null}));return{c(){t=w("ul");for(let e=0;e<o.length;e+=1)o[e].c();A(t,"class","list-group")},m(a,s){v(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=S(t,"click",E(e[3])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Xa(e,a,r);o[r]?(o[r].p(i,n),ce(o[r],1)):(o[r]=ao(i),o[r].c(),ce(o[r],1),o[r].m(t,null))}for(le(),r=a.length;r<o.length;r+=1)s(r);ue()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)ce(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)fe(o[e]);n=!1},d(e){e&&b(t),x(o,e),r=!1,i()}}}function ro(t){let n,r,i,a=t[7].toFixed(2)+"";return{c(){n=w("li"),r=_(a),i=k(),A(n,"class","list-group-item list-group-item-action")},m(e,t){v(e,n,t),y(n,r),y(n,i)},p(e,t){1&t&&a!==(a=e[7].toFixed(2)+"")&&D(r,a)},i:e,o:e,d(e){e&&b(n)}}}function io(e){let t,n,r,i;return n=new go({props:{dist:e[7]}}),{c(){t=w("li"),xe(n.$$.fragment),r=k(),A(t,"class","list-group-item list-group-item-action")},m(e,a){v(e,t,a),we(n,t,null),y(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7]),n.$set(r)},i(e){i||(ce(n.$$.fragment,e),i=!0)},o(e){fe(n.$$.fragment,e),i=!1},d(e){e&&b(t),_e(n)}}}function ao(e){let t,n,r,i;const a=[io,ro],o=[];function s(e,t){return e[7]instanceof tn?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=O()},m(e,n){o[t].m(e,n),v(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(le(),fe(o[l],1,1,(()=>{o[l]=null})),ue(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),ce(n,1),n.m(r.parentNode,r))},i(e){i||(ce(n),i=!0)},o(e){fe(n),i=!1},d(e){o[t].d(e),e&&b(r)}}}function oo(e){let t,n,r=e[0].name+"";return{c(){t=_(r),n=_(" →")},m(e,r){v(e,t,r),v(e,n,r)},p(e,n){1&n&&r!==(r=e[0].name+"")&&D(t,r)},d(e){e&&b(t),e&&b(n)}}}function so(e){let t,n,r,i,a=e[0].values,o=[];for(let t=0;t<a.length;t+=1)o[t]=co(Ya(e,a,t));const s=e=>fe(o[e],1,1,(()=>{o[e]=null}));return{c(){t=w("ul");for(let e=0;e<o.length;e+=1)o[e].c();A(t,"class","list-group")},m(a,s){v(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=S(t,"click",E(e[2])),r=!0)},p(e,n){if(1&n){let r;for(a=e[0].values,r=0;r<a.length;r+=1){const i=Ya(e,a,r);o[r]?(o[r].p(i,n),ce(o[r],1)):(o[r]=co(i),o[r].c(),ce(o[r],1),o[r].m(t,null))}for(le(),r=a.length;r<o.length;r+=1)s(r);ue()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)ce(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)fe(o[e]);n=!1},d(e){e&&b(t),x(o,e),r=!1,i()}}}function lo(t){let n,r,i,a,o,s,l,u=(100*t[7].weight).toFixed(1)+"",c=t[7].name+"",f=t[7].value+"";return{c(){n=w("li"),r=_(u),i=_("%:\n              "),a=_(c),o=_("\n              →\n              "),s=_(f),l=k(),A(n,"class","list-group-item list-group-item-action")},m(e,t){v(e,n,t),y(n,r),y(n,i),y(n,a),y(n,o),y(n,s),y(n,l)},p(e,t){1&t&&u!==(u=(100*e[7].weight).toFixed(1)+"")&&D(r,u),1&t&&c!==(c=e[7].name+"")&&D(a,c),1&t&&f!==(f=e[7].value+"")&&D(s,f)},i:e,o:e,d(e){e&&b(n)}}}function uo(e){let t,n,r,i;return n=new go({props:{dist:e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)}}),{c(){t=w("li"),xe(n.$$.fragment),r=k(),A(t,"class","list-group-item list-group-item-action")},m(e,a){v(e,t,a),we(n,t,null),y(t,r),i=!0},p(e,t){const r={};1&t&&(r.dist=e[7].value.named(`${(100*e[7].weight).toFixed(1)}%: ${e[7].name}`)),n.$set(r)},i(e){i||(ce(n.$$.fragment,e),i=!0)},o(e){fe(n.$$.fragment,e),i=!1},d(e){e&&b(t),_e(n)}}}function co(e){let t,n,r,i;const a=[uo,lo],o=[];function s(e,t){return e[7].value instanceof tn?0:1}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=O()},m(e,n){o[t].m(e,n),v(e,r,n),i=!0},p(e,i){let l=t;t=s(e),t===l?o[t].p(e,i):(le(),fe(o[l],1,1,(()=>{o[l]=null})),ue(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),ce(n,1),n.m(r.parentNode,r))},i(e){i||(ce(n),i=!0)},o(e){fe(n),i=!1},d(e){o[t].d(e),e&&b(r)}}}function fo(t){let n,r,i,a=t[0].name+"",o=t[0].valueString+"";return{c(){n=_(a),r=k(),i=_(o)},m(e,t){v(e,n,t),v(e,r,t),v(e,i,t)},p(e,t){1&t&&a!==(a=e[0].name+"")&&D(n,a),1&t&&o!==(o=e[0].valueString+"")&&D(i,o)},i:e,o:e,d(e){e&&b(n),e&&b(r),e&&b(i)}}}function ho(e){let t,n,r;return t=new go({props:{dist:e[0].value.named(e[0].name)}}),{c(){xe(t.$$.fragment),n=_(";")},m(e,i){we(t,e,i),v(e,n,i),r=!0},p(e,n){const r={};1&n&&(r.dist=e[0].value.named(e[0].name)),t.$set(r)},i(e){r||(ce(t.$$.fragment,e),r=!0)},o(e){fe(t.$$.fragment,e),r=!1},d(e){_e(t,e),e&&b(n)}}}function po(e){let t,n,r,i;const a=[eo,Za,Qa,Ka,Ja],o=[];function s(e,t){return e[0]instanceof rn?0:e[0]instanceof nn?1:e[0]instanceof cn?2:e[0]instanceof an?3:4}return t=s(e),n=o[t]=a[t](e),{c(){n.c(),r=O()},m(e,n){o[t].m(e,n),v(e,r,n),i=!0},p(e,[i]){let l=t;t=s(e),t===l?o[t].p(e,i):(le(),fe(o[l],1,1,(()=>{o[l]=null})),ue(),n=o[t],n?n.p(e,i):(n=o[t]=a[t](e),n.c()),ce(n,1),n.m(r.parentNode,r))},i(e){i||(ce(n),i=!0)},o(e){fe(n),i=!1},d(e){o[t].d(e),e&&b(r)}}}function mo(e,t,n){let{dist:r}=t,i=!1;return e.$$set=e=>{"dist"in e&&n(0,r=e.dist)},[r,i,function(t){q(e,t)},function(t){q(e,t)},()=>n(1,i=!i),(e,t)=>e?r.nameFunc(e,t.name||t):t.name,()=>n(1,i=!i)]}class go extends Oe{constructor(e){super(),ke(this,e,mo,po,s,{dist:0})}}function yo(e,t,n){const r=e.slice();return r[8]=t[n],r}function vo(e){let t,n,r,i,o,s,l,u,c,f,d,h=e[3]&&bo(e);return u=new go({props:{dist:e[0].possibleOutcomes.named("Possible Outcomes")}}),{c(){t=w("ul"),n=w("li"),r=w("details"),i=w("summary"),i.textContent="Actual Outcomes",o=k(),h&&h.c(),s=k(),l=w("li"),xe(u.$$.fragment),r.open=e[3],A(n,"class","list-group-item list-group-item-action"),A(l,"class","list-group-item list-group-item-action"),A(t,"class","list-group")},m(a,p){v(a,t,p),y(t,n),y(n,r),y(r,i),y(r,o),h&&h.m(r,null),y(t,s),y(t,l),we(u,l,null),c=!0,f||(d=[S(r,"click",E($(e[6]))),S(t,"click",E(e[4]))],f=!0)},p(e,t){e[3]?h?(h.p(e,t),8&t&&ce(h,1)):(h=bo(e),h.c(),ce(h,1),h.m(r,null)):h&&(le(),fe(h,1,1,(()=>{h=null})),ue()),(!c||8&t)&&(r.open=e[3]);const n={};1&t&&(n.dist=e[0].possibleOutcomes.named("Possible Outcomes")),u.$set(n)},i(e){c||(ce(h),ce(u.$$.fragment,e),c=!0)},o(e){fe(h),fe(u.$$.fragment,e),c=!1},d(e){e&&b(t),h&&h.d(),_e(u),f=!1,a(d)}}}function bo(e){let t,n,r,i,a=e[1],o=[];for(let t=0;t<a.length;t+=1)o[t]=xo(yo(e,a,t));const s=e=>fe(o[e],1,1,(()=>{o[e]=null}));return{c(){t=w("ul");for(let e=0;e<o.length;e+=1)o[e].c();A(t,"class","list-group")},m(a,s){v(a,t,s);for(let e=0;e<o.length;e+=1)o[e].m(t,null);n=!0,r||(i=S(t,"click",E(e[5])),r=!0)},p(e,n){if(2&n){let r;for(a=e[1],r=0;r<a.length;r+=1){const i=yo(e,a,r);o[r]?(o[r].p(i,n),ce(o[r],1)):(o[r]=xo(i),o[r].c(),ce(o[r],1),o[r].m(t,null))}for(le(),r=a.length;r<o.length;r+=1)s(r);ue()}},i(e){if(!n){for(let e=0;e<a.length;e+=1)ce(o[e]);n=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)fe(o[e]);n=!1},d(e){e&&b(t),x(o,e),r=!1,i()}}}function xo(e){let t,n,r,i;return n=new go({props:{dist:e[8]}}),{c(){t=w("li"),xe(n.$$.fragment),r=k(),A(t,"class","list-group-item list-group-item-action")},m(e,a){v(e,t,a),we(n,t,null),y(t,r),i=!0},p(e,t){const r={};2&t&&(r.dist=e[8]),n.$set(r)},i(e){i||(ce(n.$$.fragment,e),i=!0)},o(e){fe(n.$$.fragment,e),i=!1},d(e){e&&b(t),_e(n)}}}function wo(e){let t,n,r,i,a,o,s,l,u,c,f,d,h=e[0].jointDescription+"",p=e[0].valueWithDependents.valueString+"",m=e[0].possibleOutcomes.valueString+"",g=e[2]&&vo(e);return{c(){t=w("details"),n=w("summary"),r=_(h),i=k(),a=_(p),o=k(),s=_(m),l=k(),g&&g.c(),t.open=e[2],A(t,"id",u="roll-"+e[0].rollIndex)},m(u,h){v(u,t,h),y(t,n),y(n,r),y(n,i),y(n,a),y(n,o),y(n,s),y(t,l),g&&g.m(t,null),c=!0,f||(d=S(t,"click",E($(e[7]))),f=!0)},p(e,[n]){(!c||1&n)&&h!==(h=e[0].jointDescription+"")&&D(r,h),(!c||1&n)&&p!==(p=e[0].valueWithDependents.valueString+"")&&D(a,p),(!c||1&n)&&m!==(m=e[0].possibleOutcomes.valueString+"")&&D(s,m),e[2]?g?(g.p(e,n),4&n&&ce(g,1)):(g=vo(e),g.c(),ce(g,1),g.m(t,null)):g&&(le(),fe(g,1,1,(()=>{g=null})),ue()),(!c||4&n)&&(t.open=e[2]),(!c||1&n&&u!==(u="roll-"+e[0].rollIndex))&&A(t,"id",u)},i(e){c||(ce(g),c=!0)},o(e){fe(g),c=!1},d(e){e&&b(t),g&&g.d(),f=!1,d()}}}function _o(e,t,n){let r,{roll:i}=t,a=!1,o=!1;return e.$$set=e=>{"roll"in e&&n(0,i=e.roll)},e.$$.update=()=>{1&e.$$.dirty&&n(1,r=[i,...i.dependentRolls].map((e=>{const t=e.actualValue;return t.name?t.named(`${e.shortDescription} - ${t.name}`):t.named(e.shortDescription)})))},[i,r,a,o,function(t){q(e,t)},function(t){q(e,t)},()=>n(3,o=!o),()=>n(2,a=!a)]}class ko extends Oe{constructor(e){super(),ke(this,e,_o,wo,s,{roll:0})}}function Oo(e,t,n){const r=e.slice();return r[7]=t[n],r[8]=t,r[9]=n,r}function So(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[7].rollIndex;for(let t=0;t<s.length;t+=1){let n=Oo(e,s,t),r=l(n);o.set(r,a[t]=$o(r,n))}return{c(){t=w("ul");for(let e=0;e<a.length;e+=1)a[e].c();A(t,"class","list-group")},m(o,s){v(o,t,s);for(let e=0;e<a.length;e+=1)a[e].m(t,null);n=!0,r||(i=S(t,"click",E(e[3])),r=!0)},p(e,n){if(3&n){const r=e[0];le(),a=ge(a,n,l,1,e,r,o,t,me,$o,null,Oo),ue()}},i(e){if(!n){for(let e=0;e<s.length;e+=1)ce(a[e]);n=!0}},o(e){for(let e=0;e<a.length;e+=1)fe(a[e]);n=!1},d(e){e&&b(t);for(let e=0;e<a.length;e+=1)a[e].d();r=!1,i()}}}function $o(e,t){let n,r,i,a,o,s,l;function u(e){t[4].call(null,e,t[7])}let c={roll:t[7]};function f(){return t[5](t[7],t[8],t[9])}return void 0!==t[7].open&&(c.open=t[7].open),r=new ko({props:c}),V.push((()=>be(r,"open",u))),{key:e,first:null,c(){n=w("li"),xe(r.$$.fragment),a=k(),A(n,"class","list-group-item list-group-item-action"),M(n,"active",t[1]==t[7].rollIndex),this.first=n},m(e,t){v(e,n,t),we(r,n,null),y(n,a),o=!0,s||(l=S(n,"click",E(f)),s=!0)},p(e,a){t=e;const o={};1&a&&(o.roll=t[7]),!i&&1&a&&(i=!0,o.open=t[7].open,Q((()=>i=!1))),r.$set(o),3&a&&M(n,"active",t[1]==t[7].rollIndex)},i(e){o||(ce(r.$$.fragment,e),o=!0)},o(e){fe(r.$$.fragment,e),o=!1},d(e){e&&b(n),_e(r),s=!1,l()}}}function Eo(e){let t,n,r,i,a,o,s,l,u,c=e[0][0].activeTeam.name+"",f=e[0][0].turn+"",d=e[2]&&So(e);return{c(){t=w("details"),n=w("summary"),r=_(c),i=_(" - Turn "),a=_(f),o=k(),d&&d.c(),t.open=e[2]},m(c,f){v(c,t,f),y(t,n),y(n,r),y(n,i),y(n,a),y(t,o),d&&d.m(t,null),s=!0,l||(u=S(t,"click",E($(e[6]))),l=!0)},p(e,[n]){(!s||1&n)&&c!==(c=e[0][0].activeTeam.name+"")&&D(r,c),(!s||1&n)&&f!==(f=e[0][0].turn+"")&&D(a,f),e[2]?d?(d.p(e,n),4&n&&ce(d,1)):(d=So(e),d.c(),ce(d,1),d.m(t,null)):d&&(le(),fe(d,1,1,(()=>{d=null})),ue()),(!s||4&n)&&(t.open=e[2])},i(e){s||(ce(d),s=!0)},o(e){fe(d),s=!1},d(e){e&&b(t),d&&d.d(),l=!1,u()}}}function Ao(e,t,n){let{rolls:r}=t,{selectedRoll:i}=t,a=!1;return e.$$set=e=>{"rolls"in e&&n(0,r=e.rolls),"selectedRoll"in e&&n(1,i=e.selectedRoll)},e.$$.update=()=>{7&e.$$.dirty&&n(2,a=a||r&&i&&i>=r[0].rollIndex&&i<=r[r.length-1].rollIndex)},[r,i,a,function(t){q(e,t)},function(e,t){t.open=e,n(0,r)},(e,t,i)=>n(0,t[i].open=!e.open,r),()=>n(2,a=!a)]}class Do extends Oe{constructor(e){super(),ke(this,e,Ao,Eo,s,{rolls:0,selectedRoll:1})}}function Co(e,t,n){const r=e.slice();return r[1]=t[n],r[7]=t,r[8]=n,r}function Mo(e,t){let n,r,i,a,o,s,l;function u(e){t[3].call(null,e,t[1])}let c={rolls:t[1],selectedRoll:t[0]};function f(){return t[4](t[1],t[7],t[8])}return void 0!==t[1].open&&(c.open=t[1].open),r=new Do({props:c}),V.push((()=>be(r,"open",u))),{key:e,first:null,c(){n=w("li"),xe(r.$$.fragment),a=k(),A(n,"class","list-group-item list-group-item-action"),this.first=n},m(e,t){v(e,n,t),we(r,n,null),y(n,a),o=!0,s||(l=S(n,"click",E(f)),s=!0)},p(e,n){t=e;const a={};4&n&&(a.rolls=t[1]),1&n&&(a.selectedRoll=t[0]),!i&&4&n&&(i=!0,a.open=t[1].open,Q((()=>i=!1))),r.$set(a)},i(e){o||(ce(r.$$.fragment,e),o=!0)},o(e){fe(r.$$.fragment,e),o=!1},d(e){e&&b(n),_e(r),s=!1,l()}}}function jo(e){let t,n,r,i=[],a=new Map,o=e[2];const s=e=>e[1][0].rollIndex;for(let t=0;t<o.length;t+=1){let n=Co(e,o,t),r=s(n);a.set(r,i[t]=Mo(r,n))}return{c(){t=w("div"),n=w("ul");for(let e=0;e<i.length;e+=1)i[e].c();A(t,"class","details-list")},m(e,a){v(e,t,a),y(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);r=!0},p(e,[t]){if(5&t){const r=e[2];le(),i=ge(i,t,s,1,e,r,a,n,me,Mo,null,Co),ue()}},i(e){if(!r){for(let e=0;e<o.length;e+=1)ce(i[e]);r=!0}},o(e){for(let e=0;e<i.length;e+=1)fe(i[e]);r=!1},d(e){e&&b(t);for(let e=0;e<i.length;e+=1)i[e].d()}}}function Fo(e,t,n){let r,{rolls:i}=t,{selectedRoll:a=null}=t;return e.$$set=e=>{"rolls"in e&&n(1,i=e.rolls),"selectedRoll"in e&&n(0,a=e.selectedRoll)},e.$$.update=()=>{3&e.$$.dirty&&(console.log("Roll Details reactive"),function(e,t){n(2,r=e.reduce(((e,t)=>{const n=e[e.length-1],r=n&&n[n.length-1];return n&&r&&r.activeTeam.id==t.activeTeam.id&&r.turn==t.turn?n.push(t):e.push([t]),e}),[]))}(i))},[a,i,r,function(e,t){t.open=e,n(2,r)},(e,t,i)=>n(2,t[i].open=!e.open,r)]}class To extends Oe{constructor(e){super(),ke(this,e,Fo,jo,s,{rolls:1,selectedRoll:0})}}
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */var No,Ro=(No=function(e,t){return(No=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}No(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Po=Object.prototype.hasOwnProperty;function zo(e,t){return Po.call(e,t)}function Bo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)zo(e,r)&&t.push(r);return t}function Lo(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Io(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function qo(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Uo(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Vo(e){if(void 0===e)return!0;if(e)if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(Vo(e[t]))return!0}else if("object"==typeof e){var r=Bo(e),i=r.length;for(t=0;t<i;t++)if(Vo(e[r[t]]))return!0}return!1}function Wo(e,t){var n=[e];for(var r in t){var i="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==i&&n.push(r+": "+i)}return n.join("\n")}var Ho=function(e){function t(t,n,r,i,a){var o=this.constructor,s=e.call(this,Wo(t,{name:n,index:r,operation:i,tree:a}))||this;return s.name=n,s.index=r,s.operation=i,s.tree=a,Object.setPrototypeOf(s,o.prototype),s.message=Wo(t,{name:n,index:r,operation:i,tree:a}),s}return Ro(t,e),t}(Error),Go=Ho,Xo=Lo,Yo={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=Ko(n,this.path);r&&(r=Lo(r));var i=Qo(n,{op:"remove",path:this.from}).removed;return Qo(n,{op:"add",path:this.path,value:i}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=Ko(n,this.from);return Qo(n,{op:"add",path:this.path,value:Lo(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ns(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},Jo={add:function(e,t,n){return Io(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Yo.move,copy:Yo.copy,test:Yo.test,_get:Yo._get};function Ko(e,t){if(""==t)return e;var n={op:"_get",path:t};return Qo(e,n),n.value}function Qo(e,t,n,r,i,a){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===a&&(a=0),n&&("function"==typeof n?n(t,0,e,t.path):es(t,0)),""===t.path){var o={newDocument:e};if("add"===t.op)return o.newDocument=t.value,o;if("replace"===t.op)return o.newDocument=t.value,o.removed=e,o;if("move"===t.op||"copy"===t.op)return o.newDocument=Ko(e,t.from),"move"===t.op&&(o.removed=e),o;if("test"===t.op){if(o.test=ns(e,t.value),!1===o.test)throw new Go("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o.newDocument=e,o}if("remove"===t.op)return o.removed=e,o.newDocument=null,o;if("_get"===t.op)return t.value=e,o;if(n)throw new Go("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return o}r||(e=Lo(e));var s=(t.path||"").split("/"),l=e,u=1,c=s.length,f=void 0,d=void 0,h=void 0;for(h="function"==typeof n?n:es;;){if(d=s[u],i&&"__proto__"==d)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===f&&(void 0===l[d]?f=s.slice(0,u).join("/"):u==c-1&&(f=t.path),void 0!==f&&h(t,0,e,f)),u++,Array.isArray(l)){if("-"===d)d=l.length;else{if(n&&!Io(d))throw new Go("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);Io(d)&&(d=~~d)}if(u>=c){if(n&&"add"===t.op&&d>l.length)throw new Go("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);if(!1===(o=Jo[t.op].call(t,l,d,e)).test)throw new Go("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}}else if(d&&-1!=d.indexOf("~")&&(d=Uo(d)),u>=c){if(!1===(o=Yo[t.op].call(t,l,d,e)).test)throw new Go("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return o}l=l[d]}}function Zo(e,t,n,r,i){if(void 0===r&&(r=!0),void 0===i&&(i=!0),n&&!Array.isArray(t))throw new Go("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Lo(e));for(var a=new Array(t.length),o=0,s=t.length;o<s;o++)a[o]=Qo(e,t[o],n,!0,i,o),e=a[o].newDocument;return a.newDocument=e,a}function es(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new Go("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Yo[e.op])throw new Go("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new Go("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new Go('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new Go("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new Go("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&Vo(e.value))throw new Go("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new Go("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new Go("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var o=ts([{op:"_get",path:e.from,value:void 0}],n);if(o&&"OPERATION_PATH_UNRESOLVABLE"===o.name)throw new Go("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function ts(e,t,n){try{if(!Array.isArray(e))throw new Go("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Zo(Lo(t),Lo(e),n||!0);else{n=n||es;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof Go)return e;throw e}}function ns(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,i,a=Array.isArray(e),o=Array.isArray(t);if(a&&o){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!ns(e[n],t[n]))return!1;return!0}if(a!=o)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!ns(e[i=s[n]],t[i]))return!1;return!0}return e!=e&&t!=t}var rs=Object.freeze({__proto__:null,JsonPatchError:Go,deepClone:Xo,getValueByPointer:Ko,applyOperation:Qo,applyPatch:Zo,applyReducer:function(e,t,n){var r=Qo(e,t);if(!1===r.test)throw new Go("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument},validator:es,validate:ts,_areEquals:ns}),is=new WeakMap,as=function(e){this.observers=new Map,this.obj=e},os=function(e,t){this.callback=e,this.observer=t};
/*!
     * https://github.com/Starcounter-Jack/JSON-Patch
     * (c) 2017 Joachim Wester
     * MIT license
     */function ss(e,t){void 0===t&&(t=!1);var n=is.get(e.object);ls(n.value,e.object,e.patches,"",t),e.patches.length&&Zo(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function ls(e,t,n,r,i){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var a=Bo(t),o=Bo(e),s=!1,l=o.length-1;l>=0;l--){var u=e[f=o[l]];if(!zo(t,f)||void 0===t[f]&&void 0!==u&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(i&&n.push({op:"test",path:r+"/"+qo(f),value:Lo(u)}),n.push({op:"remove",path:r+"/"+qo(f)}),s=!0):(i&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var c=t[f];"object"==typeof u&&null!=u&&"object"==typeof c&&null!=c?ls(u,c,n,r+"/"+qo(f),i):u!==c&&(i&&n.push({op:"test",path:r+"/"+qo(f),value:Lo(u)}),n.push({op:"replace",path:r+"/"+qo(f),value:Lo(c)}))}}if(s||a.length!=o.length)for(l=0;l<a.length;l++){var f;zo(e,f=a[l])||void 0===t[f]||n.push({op:"add",path:r+"/"+qo(f),value:Lo(t[f])})}}}var us=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){return is.get(e)}(e);if(r){var i=function(e,t){return e.observers.get(t)}(r,t);n=i&&i.observer}else r=new as(e),is.set(e,r);if(n)return n;if(n={},r.value=Lo(e),t){n.callback=t,n.next=null;var a=function(){ss(n)},o=function(){clearTimeout(n.next),n.next=setTimeout(a)};"undefined"!=typeof window&&(window.addEventListener("mouseup",o),window.addEventListener("keyup",o),window.addEventListener("mousedown",o),window.addEventListener("keydown",o),window.addEventListener("change",o))}return n.patches=[],n.object=e,n.unobserve=function(){ss(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",o),window.removeEventListener("keyup",o),window.removeEventListener("mousedown",o),window.removeEventListener("keydown",o),window.removeEventListener("change",o))},r.observers.set(t,new os(t,n)),n},generate:ss,compare:function(e,t,n){void 0===n&&(n=!1);var r=[];return ls(e,t,r,"",n),r}});Object.assign({},rs,us,{JsonPatchError:Ho,deepClone:Lo,escapePathComponent:qo,unescapePathComponent:Uo});var cs=/("(?:[^\\"]|\\.)*")|[:,]/g,fs=function(e,t){var n,r,i;return t=t||{},n=JSON.stringify([1],void 0,void 0===t.indent?2:t.indent).slice(2,-3),r=""===n?1/0:void 0===t.maxLength?80:t.maxLength,i=t.replacer,function e(t,a,o){var s,l,u,c,f,d,h,p,m,g,y,v;if(t&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0===(y=JSON.stringify(t,i)))return y;if(h=r-a.length-o,y.length<=h&&(m=y.replace(cs,(function(e,t){return t||e+" "}))).length<=h)return m;if(null!=i&&(t=JSON.parse(y),i=void 0),"object"==typeof t&&null!==t){if(p=a+n,u=[],l=0,Array.isArray(t))for(g="[",s="]",h=t.length;l<h;l++)u.push(e(t[l],p,l===h-1?0:1)||"null");else for(g="{",s="}",h=(d=Object.keys(t)).length;l<h;l++)c=d[l],f=JSON.stringify(c)+": ",void 0!==(v=e(t[c],p,f.length+(l===h-1?0:1)))&&u.push(f+v);if(u.length>0)return[g,n+u.join(",\n"+p),s].join("\n"+a)}return y}(e,"",0)};function ds(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var hs={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var ps="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{},ms=ds((function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n}=hs,r=(t=e.exports={}).re=[],i=t.src=[],a=t.t={};let o=0;const s=(e,t,n)=>{const s=o++;ps(s,t),a[e]=s,i[s]=t,r[s]=new RegExp(t,n?"g":void 0)};s("NUMERICIDENTIFIER","0|[1-9]\\d*"),s("NUMERICIDENTIFIERLOOSE","[0-9]+"),s("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),s("MAINVERSION",`(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})\\.(${i[a.NUMERICIDENTIFIER]})`),s("MAINVERSIONLOOSE",`(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})\\.(${i[a.NUMERICIDENTIFIERLOOSE]})`),s("PRERELEASEIDENTIFIER",`(?:${i[a.NUMERICIDENTIFIER]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASEIDENTIFIERLOOSE",`(?:${i[a.NUMERICIDENTIFIERLOOSE]}|${i[a.NONNUMERICIDENTIFIER]})`),s("PRERELEASE",`(?:-(${i[a.PRERELEASEIDENTIFIER]}(?:\\.${i[a.PRERELEASEIDENTIFIER]})*))`),s("PRERELEASELOOSE",`(?:-?(${i[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[a.PRERELEASEIDENTIFIERLOOSE]})*))`),s("BUILDIDENTIFIER","[0-9A-Za-z-]+"),s("BUILD",`(?:\\+(${i[a.BUILDIDENTIFIER]}(?:\\.${i[a.BUILDIDENTIFIER]})*))`),s("FULLPLAIN",`v?${i[a.MAINVERSION]}${i[a.PRERELEASE]}?${i[a.BUILD]}?`),s("FULL",`^${i[a.FULLPLAIN]}$`),s("LOOSEPLAIN",`[v=\\s]*${i[a.MAINVERSIONLOOSE]}${i[a.PRERELEASELOOSE]}?${i[a.BUILD]}?`),s("LOOSE",`^${i[a.LOOSEPLAIN]}$`),s("GTLT","((?:<|>)?=?)"),s("XRANGEIDENTIFIERLOOSE",`${i[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),s("XRANGEIDENTIFIER",`${i[a.NUMERICIDENTIFIER]}|x|X|\\*`),s("XRANGEPLAIN",`[v=\\s]*(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:\\.(${i[a.XRANGEIDENTIFIER]})(?:${i[a.PRERELEASE]})?${i[a.BUILD]}?)?)?`),s("XRANGEPLAINLOOSE",`[v=\\s]*(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[a.XRANGEIDENTIFIERLOOSE]})(?:${i[a.PRERELEASELOOSE]})?${i[a.BUILD]}?)?)?`),s("XRANGE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAIN]}$`),s("XRANGELOOSE",`^${i[a.GTLT]}\\s*${i[a.XRANGEPLAINLOOSE]}$`),s("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),s("COERCERTL",i[a.COERCE],!0),s("LONETILDE","(?:~>?)"),s("TILDETRIM",`(\\s*)${i[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",s("TILDE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAIN]}$`),s("TILDELOOSE",`^${i[a.LONETILDE]}${i[a.XRANGEPLAINLOOSE]}$`),s("LONECARET","(?:\\^)"),s("CARETTRIM",`(\\s*)${i[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",s("CARET",`^${i[a.LONECARET]}${i[a.XRANGEPLAIN]}$`),s("CARETLOOSE",`^${i[a.LONECARET]}${i[a.XRANGEPLAINLOOSE]}$`),s("COMPARATORLOOSE",`^${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]})$|^$`),s("COMPARATOR",`^${i[a.GTLT]}\\s*(${i[a.FULLPLAIN]})$|^$`),s("COMPARATORTRIM",`(\\s*)${i[a.GTLT]}\\s*(${i[a.LOOSEPLAIN]}|${i[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",s("HYPHENRANGE",`^\\s*(${i[a.XRANGEPLAIN]})\\s+-\\s+(${i[a.XRANGEPLAIN]})\\s*$`),s("HYPHENRANGELOOSE",`^\\s*(${i[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[a.XRANGEPLAINLOOSE]})\\s*$`),s("STAR","(<|>)?=?\\s*\\*"),s("GTE0","^\\s*>=\\s*0.0.0\\s*$"),s("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")}));const gs=["includePrerelease","loose","rtl"];var ys=e=>e?"object"!=typeof e?{loose:!0}:gs.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const vs=/^[0-9]+$/,bs=(e,t)=>{const n=vs.test(e),r=vs.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var xs={compareIdentifiers:bs,rcompareIdentifiers:(e,t)=>bs(t,e)};const{MAX_LENGTH:ws,MAX_SAFE_INTEGER:_s}=hs,{re:ks,t:Os}=ms,{compareIdentifiers:Ss}=xs;class $s{constructor(e,t){if(t=ys(t),e instanceof $s){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>ws)throw new TypeError(`version is longer than ${ws} characters`);ps("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?ks[Os.LOOSE]:ks[Os.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>_s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>_s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>_s||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<_s)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ps("SemVer.compare",this.version,this.options,e),!(e instanceof $s)){if("string"==typeof e&&e===this.version)return 0;e=new $s(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof $s||(e=new $s(e,this.options)),Ss(this.major,e.major)||Ss(this.minor,e.minor)||Ss(this.patch,e.patch)}comparePre(e){if(e instanceof $s||(e=new $s(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(ps("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Ss(n,r)}while(++t)}compareBuild(e){e instanceof $s||(e=new $s(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(ps("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Ss(n,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Es=$s;const{MAX_LENGTH:As}=hs,{re:Ds,t:Cs}=ms;var Ms=(e,t)=>{if(t=ys(t),e instanceof Es)return e;if("string"!=typeof e)return null;if(e.length>As)return null;if(!(t.loose?Ds[Cs.LOOSE]:Ds[Cs.FULL]).test(e))return null;try{return new Es(e,t)}catch(e){return null}};var js=(e,t)=>{const n=Ms(e,t);return n?n.version:null};var Fs=(e,t)=>{const n=Ms(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};var Ts=(e,t,n,r)=>{"string"==typeof n&&(r=n,n=void 0);try{return new Es(e,n).inc(t,r).version}catch(e){return null}};var Ns=(e,t,n)=>new Es(e,n).compare(new Es(t,n));var Rs=(e,t,n)=>0===Ns(e,t,n);var Ps=(e,t)=>{if(Rs(e,t))return null;{const n=Ms(e),r=Ms(t),i=n.prerelease.length||r.prerelease.length,a=i?"pre":"",o=i?"prerelease":"";for(const e in n)if(("major"===e||"minor"===e||"patch"===e)&&n[e]!==r[e])return a+e;return o}};var zs=(e,t)=>new Es(e,t).major;var Bs=(e,t)=>new Es(e,t).minor;var Ls=(e,t)=>new Es(e,t).patch;var Is=(e,t)=>{const n=Ms(e,t);return n&&n.prerelease.length?n.prerelease:null};var qs=(e,t,n)=>Ns(t,e,n);var Us=(e,t)=>Ns(e,t,!0);var Vs=(e,t,n)=>{const r=new Es(e,n),i=new Es(t,n);return r.compare(i)||r.compareBuild(i)};var Ws=(e,t)=>e.sort(((e,n)=>Vs(e,n,t)));var Hs=(e,t)=>e.sort(((e,n)=>Vs(n,e,t)));var Gs=(e,t,n)=>Ns(e,t,n)>0;var Xs=(e,t,n)=>Ns(e,t,n)<0;var Ys=(e,t,n)=>0!==Ns(e,t,n);var Js=(e,t,n)=>Ns(e,t,n)>=0;var Ks=(e,t,n)=>Ns(e,t,n)<=0;var Qs=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Rs(e,n,r);case"!=":return Ys(e,n,r);case">":return Gs(e,n,r);case">=":return Js(e,n,r);case"<":return Xs(e,n,r);case"<=":return Ks(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const{re:Zs,t:el}=ms;var tl=(e,t)=>{if(e instanceof Es)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){let t;for(;(t=Zs[el.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&t.index+t[0].length===n.index+n[0].length||(n=t),Zs[el.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;Zs[el.COERCERTL].lastIndex=-1}else n=e.match(Zs[el.COERCE]);return null===n?null:Ms(`${n[2]}.${n[3]||"0"}.${n[4]||"0"}`,t)},nl=rl;function rl(e){var t=this;if(t instanceof rl||(t=new rl),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return t}function il(e,t,n){var r=t===e.head?new sl(n,null,t,e):new sl(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function al(e,t){e.tail=new sl(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function ol(e,t){e.head=new sl(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function sl(e,t,n,r){if(!(this instanceof sl))return new sl(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}rl.Node=sl,rl.create=rl,rl.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},rl.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},rl.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},rl.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)al(this,arguments[e]);return this.length},rl.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)ol(this,arguments[e]);return this.length},rl.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},rl.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},rl.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},rl.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},rl.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},rl.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},rl.prototype.map=function(e,t){t=t||this;for(var n=new rl,r=this.head;null!==r;)n.push(e.call(t,r.value,this)),r=r.next;return n},rl.prototype.mapReverse=function(e,t){t=t||this;for(var n=new rl,r=this.tail;null!==r;)n.push(e.call(t,r.value,this)),r=r.prev;return n},rl.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},rl.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},rl.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},rl.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},rl.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new rl;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;for(;null!==i&&r<t;r++,i=i.next)n.push(i.value);return n},rl.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var n=new rl;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var r=this.length,i=this.tail;null!==i&&r>t;r--)i=i.prev;for(;null!==i&&r>e;r--,i=i.prev)n.push(i.value);return n},rl.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,i=this.head;null!==i&&r<e;r++)i=i.next;var a=[];for(r=0;i&&r<t;r++)a.push(i.value),i=this.removeNode(i);null===i&&(i=this.tail),i!==this.head&&i!==this.tail&&(i=i.prev);for(r=0;r<n.length;r++)i=il(this,i,n[r]);return a},rl.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{!function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}(rl)}catch(e){}const ll=Symbol("max"),ul=Symbol("length"),cl=Symbol("lengthCalculator"),fl=Symbol("allowStale"),dl=Symbol("maxAge"),hl=Symbol("dispose"),pl=Symbol("noDisposeOnSet"),ml=Symbol("lruList"),gl=Symbol("cache"),yl=Symbol("updateAgeOnGet"),vl=()=>1;const bl=(e,t,n)=>{const r=e[gl].get(t);if(r){const t=r.value;if(xl(e,t)){if(_l(e,r),!e[fl])return}else n&&(e[yl]&&(r.value.now=Date.now()),e[ml].unshiftNode(r));return t.value}},xl=(e,t)=>{if(!t||!t.maxAge&&!e[dl])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[dl]&&n>e[dl]},wl=e=>{if(e[ul]>e[ll])for(let t=e[ml].tail;e[ul]>e[ll]&&null!==t;){const n=t.prev;_l(e,t),t=n}},_l=(e,t)=>{if(t){const n=t.value;e[hl]&&e[hl](n.key,n.value),e[ul]-=n.length,e[gl].delete(n.key),e[ml].removeNode(t)}};class kl{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const Ol=(e,t,n,r)=>{let i=n.value;xl(e,i)&&(_l(e,n),e[fl]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};var Sl=class{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[ll]=e.max||1/0;const t=e.length||vl;if(this[cl]="function"!=typeof t?vl:t,this[fl]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw new TypeError("maxAge must be a number");this[dl]=e.maxAge||0,this[hl]=e.dispose,this[pl]=e.noDisposeOnSet||!1,this[yl]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw new TypeError("max must be a non-negative number");this[ll]=e||1/0,wl(this)}get max(){return this[ll]}set allowStale(e){this[fl]=!!e}get allowStale(){return this[fl]}set maxAge(e){if("number"!=typeof e)throw new TypeError("maxAge must be a non-negative number");this[dl]=e,wl(this)}get maxAge(){return this[dl]}set lengthCalculator(e){"function"!=typeof e&&(e=vl),e!==this[cl]&&(this[cl]=e,this[ul]=0,this[ml].forEach((e=>{e.length=this[cl](e.value,e.key),this[ul]+=e.length}))),wl(this)}get lengthCalculator(){return this[cl]}get length(){return this[ul]}get itemCount(){return this[ml].length}rforEach(e,t){t=t||this;for(let n=this[ml].tail;null!==n;){const r=n.prev;Ol(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[ml].head;null!==n;){const r=n.next;Ol(this,e,n,t),n=r}}keys(){return this[ml].toArray().map((e=>e.key))}values(){return this[ml].toArray().map((e=>e.value))}reset(){this[hl]&&this[ml]&&this[ml].length&&this[ml].forEach((e=>this[hl](e.key,e.value))),this[gl]=new Map,this[ml]=new nl,this[ul]=0}dump(){return this[ml].map((e=>!xl(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)})).toArray().filter((e=>e))}dumpLru(){return this[ml]}set(e,t,n){if((n=n||this[dl])&&"number"!=typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,i=this[cl](t,e);if(this[gl].has(e)){if(i>this[ll])return _l(this,this[gl].get(e)),!1;const a=this[gl].get(e).value;return this[hl]&&(this[pl]||this[hl](e,a.value)),a.now=r,a.maxAge=n,a.value=t,this[ul]+=i-a.length,a.length=i,this.get(e),wl(this),!0}const a=new kl(e,t,i,r,n);return a.length>this[ll]?(this[hl]&&this[hl](e,t),!1):(this[ul]+=a.length,this[ml].unshift(a),this[gl].set(e,this[ml].head),wl(this),!0)}has(e){if(!this[gl].has(e))return!1;const t=this[gl].get(e).value;return!xl(this,t)}get(e){return bl(this,e,!0)}peek(e){return bl(this,e,!1)}pop(){const e=this[ml].tail;return e?(_l(this,e),e.value):null}del(e){_l(this,this[gl].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[gl].forEach(((e,t)=>bl(this,t,!1)))}};class $l{constructor(e,t){if(t=ys(t),e instanceof $l)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new $l(e.raw,t);if(e instanceof Kl)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!Tl(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Nl(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,n=Al.get(t);if(n)return n;const r=this.options.loose,i=r?Dl[Cl.HYPHENRANGELOOSE]:Dl[Cl.HYPHENRANGE];e=e.replace(i,Gl(this.options.includePrerelease)),ps("hyphen replace",e),e=e.replace(Dl[Cl.COMPARATORTRIM],Ml),ps("comparator trim",e,Dl[Cl.COMPARATORTRIM]),e=(e=(e=e.replace(Dl[Cl.TILDETRIM],jl)).replace(Dl[Cl.CARETTRIM],Fl)).split(/\s+/).join(" ");const a=r?Dl[Cl.COMPARATORLOOSE]:Dl[Cl.COMPARATOR],o=e.split(" ").map((e=>Pl(e,this.options))).join(" ").split(/\s+/).map((e=>Hl(e,this.options))).filter(this.options.loose?e=>!!e.match(a):()=>!0).map((e=>new Kl(e,this.options))),s=(o.length,new Map);for(const e of o){if(Tl(e))return[e];s.set(e.value,e)}s.size>1&&s.has("")&&s.delete("");const l=[...s.values()];return Al.set(t,l),l}intersects(e,t){if(!(e instanceof $l))throw new TypeError("a Range is required");return this.set.some((n=>Rl(n,t)&&e.set.some((e=>Rl(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Es(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Xl(this.set[t],e,this.options))return!0;return!1}}var El=$l;const Al=new Sl({max:1e3}),{re:Dl,t:Cl,comparatorTrimReplace:Ml,tildeTrimReplace:jl,caretTrimReplace:Fl}=ms,Tl=e=>"<0.0.0-0"===e.value,Nl=e=>""===e.value,Rl=(e,t)=>{let n=!0;const r=e.slice();let i=r.pop();for(;n&&r.length;)n=r.every((e=>i.intersects(e,t))),i=r.pop();return n},Pl=(e,t)=>(ps("comp",e,t),e=Il(e,t),ps("caret",e),e=Bl(e,t),ps("tildes",e),e=Ul(e,t),ps("xrange",e),e=Wl(e,t),ps("stars",e),e),zl=e=>!e||"x"===e.toLowerCase()||"*"===e,Bl=(e,t)=>e.trim().split(/\s+/).map((e=>Ll(e,t))).join(" "),Ll=(e,t)=>{const n=t.loose?Dl[Cl.TILDELOOSE]:Dl[Cl.TILDE];return e.replace(n,((t,n,r,i,a)=>{let o;return ps("tilde",e,t,n,r,i,a),zl(n)?o="":zl(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:zl(i)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:a?(ps("replaceTilde pr",a),o=`>=${n}.${r}.${i}-${a} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${i} <${n}.${+r+1}.0-0`,ps("tilde return",o),o}))},Il=(e,t)=>e.trim().split(/\s+/).map((e=>ql(e,t))).join(" "),ql=(e,t)=>{ps("caret",e,t);const n=t.loose?Dl[Cl.CARETLOOSE]:Dl[Cl.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,i,a,o)=>{let s;return ps("caret",e,t,n,i,a,o),zl(n)?s="":zl(i)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:zl(a)?s="0"===n?`>=${n}.${i}.0${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.0${r} <${+n+1}.0.0-0`:o?(ps("replaceCaret pr",o),s="0"===n?"0"===i?`>=${n}.${i}.${a}-${o} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a}-${o} <${+n+1}.0.0-0`):(ps("no pr"),s="0"===n?"0"===i?`>=${n}.${i}.${a}${r} <${n}.${i}.${+a+1}-0`:`>=${n}.${i}.${a}${r} <${n}.${+i+1}.0-0`:`>=${n}.${i}.${a} <${+n+1}.0.0-0`),ps("caret return",s),s}))},Ul=(e,t)=>(ps("replaceXRanges",e,t),e.split(/\s+/).map((e=>Vl(e,t))).join(" ")),Vl=(e,t)=>{e=e.trim();const n=t.loose?Dl[Cl.XRANGELOOSE]:Dl[Cl.XRANGE];return e.replace(n,((n,r,i,a,o,s)=>{ps("xRange",e,n,r,i,a,o,s);const l=zl(i),u=l||zl(a),c=u||zl(o),f=c;return"="===r&&f&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&f?(u&&(a=0),o=0,">"===r?(r=">=",u?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):"<="===r&&(r="<",u?i=+i+1:a=+a+1),"<"===r&&(s="-0"),n=`${r+i}.${a}.${o}${s}`):u?n=`>=${i}.0.0${s} <${+i+1}.0.0-0`:c&&(n=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`),ps("xRange return",n),n}))},Wl=(e,t)=>(ps("replaceStars",e,t),e.trim().replace(Dl[Cl.STAR],"")),Hl=(e,t)=>(ps("replaceGTE0",e,t),e.trim().replace(Dl[t.includePrerelease?Cl.GTE0PRE:Cl.GTE0],"")),Gl=e=>(t,n,r,i,a,o,s,l,u,c,f,d,h)=>`${n=zl(r)?"":zl(i)?`>=${r}.0.0${e?"-0":""}`:zl(a)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=zl(u)?"":zl(c)?`<${+u+1}.0.0-0`:zl(f)?`<${u}.${+c+1}.0-0`:d?`<=${u}.${c}.${f}-${d}`:e?`<${u}.${c}.${+f+1}-0`:`<=${l}`}`.trim(),Xl=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(ps(e[n].semver),e[n].semver!==Kl.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},Yl=Symbol("SemVer ANY");class Jl{static get ANY(){return Yl}constructor(e,t){if(t=ys(t),e instanceof Jl){if(e.loose===!!t.loose)return e;e=e.value}ps("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Yl?this.value="":this.value=this.operator+this.semver.version,ps("comp",this)}parse(e){const t=this.options.loose?Ql[Zl.COMPARATORLOOSE]:Ql[Zl.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new Es(n[2],this.options.loose):this.semver=Yl}toString(){return this.value}test(e){if(ps("Comparator.test",e,this.options.loose),this.semver===Yl||e===Yl)return!0;if("string"==typeof e)try{e=new Es(e,this.options)}catch(e){return!1}return Qs(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Jl))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new El(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new El(this.value,t).test(e.semver);const n=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,a=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=Qs(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),s=Qs(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return n||r||i&&a||o||s}}var Kl=Jl;const{re:Ql,t:Zl}=ms;var eu=(e,t,n)=>{try{t=new El(t,n)}catch(e){return!1}return t.test(e)};var tu=(e,t)=>new El(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));var nu=(e,t,n)=>{let r=null,i=null,a=null;try{a=new El(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new Es(r,n)))})),r};var ru=(e,t,n)=>{let r=null,i=null,a=null;try{a=new El(t,n)}catch(e){return null}return e.forEach((e=>{a.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new Es(r,n)))})),r};var iu=(e,t)=>{e=new El(e,t);let n=new Es("0.0.0");if(e.test(n))return n;if(n=new Es("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let i=null;r.forEach((e=>{const t=new Es(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!Gs(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||n&&!Gs(n,i)||(n=i)}return n&&e.test(n)?n:null};var au=(e,t)=>{try{return new El(e,t).range||"*"}catch(e){return null}};const{ANY:ou}=Kl;var su=(e,t,n,r)=>{let i,a,o,s,l;switch(e=new Es(e,r),t=new El(t,r),n){case">":i=Gs,a=Ks,o=Xs,s=">",l=">=";break;case"<":i=Xs,a=Js,o=Gs,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(eu(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const u=t.set[n];let c=null,f=null;if(u.forEach((e=>{e.semver===ou&&(e=new Kl(">=0.0.0")),c=c||e,f=f||e,i(e.semver,c.semver,r)?c=e:o(e.semver,f.semver,r)&&(f=e)})),c.operator===s||c.operator===l)return!1;if((!f.operator||f.operator===s)&&a(e,f.semver))return!1;if(f.operator===l&&o(e,f.semver))return!1}return!0};var lu=(e,t,n)=>su(e,t,">",n);var uu=(e,t,n)=>su(e,t,"<",n);var cu=(e,t,n)=>(e=new El(e,n),t=new El(t,n),e.intersects(t));const{ANY:fu}=Kl,du=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===fu)return 1===t.length&&t[0].semver===fu;const r=new Set;let i,a,o,s,l,u,c;for(const t of e)">"===t.operator||">="===t.operator?i=hu(i,t,n):"<"===t.operator||"<="===t.operator?a=pu(a,t,n):r.add(t.semver);if(r.size>1)return null;if(i&&a){if(o=Ns(i.semver,a.semver,n),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==a.operator))return null}for(const e of r){if(i&&!eu(e,String(i),n))return null;if(a&&!eu(e,String(a),n))return null;for(const r of t)if(!eu(e,String(r),n))return!1;return!0}for(const e of t){if(c=c||">"===e.operator||">="===e.operator,u=u||"<"===e.operator||"<="===e.operator,i)if(">"===e.operator||">="===e.operator){if(s=hu(i,e,n),s===e&&s!==i)return!1}else if(">="===i.operator&&!eu(i.semver,String(e),n))return!1;if(a)if("<"===e.operator||"<="===e.operator){if(l=pu(a,e,n),l===e&&l!==a)return!1}else if("<="===a.operator&&!eu(a.semver,String(e),n))return!1;if(!e.operator&&(a||i)&&0!==o)return!1}return!(i&&u&&!a&&0!==o)&&!(a&&c&&!i&&0!==o)},hu=(e,t,n)=>{if(!e)return t;const r=Ns(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},pu=(e,t,n)=>{if(!e)return t;const r=Ns(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var mu=(e,t,n)=>{if(e===t)return!0;e=new El(e,n),t=new El(t,n);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=du(i,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},gu={re:ms.re,src:ms.src,tokens:ms.t,SEMVER_SPEC_VERSION:hs.SEMVER_SPEC_VERSION,SemVer:Es,compareIdentifiers:xs.compareIdentifiers,rcompareIdentifiers:xs.rcompareIdentifiers,parse:Ms,valid:js,clean:Fs,inc:Ts,diff:Ps,major:zs,minor:Bs,patch:Ls,prerelease:Is,compare:Ns,rcompare:qs,compareLoose:Us,compareBuild:Vs,sort:Ws,rsort:Hs,gt:Gs,lt:Xs,eq:Rs,neq:Ys,gte:Js,lte:Ks,cmp:Qs,coerce:tl,Comparator:Kl,Range:El,satisfies:eu,toComparators:tu,maxSatisfying:nu,minSatisfying:ru,minVersion:iu,validRange:au,outside:su,gtr:lu,ltr:uu,intersects:cu,simplifyRange:(e,t,n)=>{const r=[];let i=null,a=null;const o=e.sort(((e,t)=>Ns(e,t,n)));for(const e of o){eu(e,t,n)?(a=e,i||(i=e)):(a&&r.push([i,a]),a=null,i=null)}i&&r.push([i,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),u="string"==typeof t.raw?t.raw:String(t);return l.length<u.length?l:t},subset:mu};function yu(e,t,n){return e.fields=t||[],e.fname=n,e}function vu(e){return null==e?null:e.fname}function bu(e){return null==e?null:e.fields}function xu(e){return 1===e.length?wu(e[0]):_u(e)}const wu=e=>function(t){return t[e]},_u=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function ku(e){throw Error(e)}function Ou(e){const t=[],n=e.length;let r,i,a,o=null,s=0,l="";function u(){t.push(l+e.substring(r,i)),l="",r=i+1}for(e+="",r=i=0;i<n;++i)if(a=e[i],"\\"===a)l+=e.substring(r,i),l+=e.substring(++i,++i),r=i;else if(a===o)u(),o=null,s=-1;else{if(o)continue;r===s&&'"'===a||r===s&&"'"===a?(r=i+1,o=a):"."!==a||s?"["===a?(i>r&&u(),s=r=i+1):"]"===a&&(s||ku("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&ku("Access path missing closing bracket: "+e),o&&ku("Access path missing closing quote: "+e),i>r&&(i++,u()),t}function Su(e,t,n){const r=Ou(e);return e=1===r.length?r[0]:e,yu((n&&n.get||xu)(r),[e],t||e)}const $u=Su("id"),Eu=yu((e=>e),[],"identity"),Au=yu((()=>0),[],"zero"),Du=yu((()=>1),[],"one"),Cu=yu((()=>!0),[],"true"),Mu=yu((()=>!1),[],"false");function ju(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}function Fu(e,t){let n=e||0;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=1&&ju(t||"error","ERROR",arguments),this},warn(){return n>=2&&ju(t||"warn","WARN",arguments),this},info(){return n>=3&&ju(t||"log","INFO",arguments),this},debug(){return n>=4&&ju(t||"log","DEBUG",arguments),this}}}var Tu=Array.isArray;function Nu(e){return e===Object(e)}const Ru=e=>"__proto__"!==e;function Pu(...e){return e.reduce(((e,t)=>{for(const n in t)if("signals"===n)e.signals=Bu(e.signals,t.signals);else{const r="legend"===n?{layout:1}:"style"===n||null;zu(e,n,t[n],r)}return e}),{})}function zu(e,t,n,r){if(!Ru(t))return;let i,a;if(Nu(n)&&!Tu(n))for(i in a=Nu(e[t])?e[t]:e[t]={},n)r&&(!0===r||r[i])?zu(a,i,n[i]):Ru(i)&&(a[i]=n[i]);else e[t]=n}function Bu(e,t){if(null==e)return t;const n={},r=[];function i(e){n[e.name]||(n[e.name]=1,r.push(e))}return t.forEach(i),e.forEach(i),r}function Lu(e){return e[e.length-1]}function Iu(e){return null==e||""===e?null:+e}const qu=e=>t=>e*Math.exp(t),Uu=e=>t=>Math.log(e*t),Vu=e=>t=>Math.sign(t)*Math.log1p(Math.abs(t/e)),Wu=e=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*e,Hu=e=>t=>t<0?-Math.pow(-t,e):Math.pow(t,e);function Gu(e,t,n,r){const i=n(e[0]),a=n(Lu(e)),o=(a-i)*t;return[r(i-o),r(a-o)]}function Xu(e,t){return Gu(e,t,Iu,Eu)}function Yu(e,t){var n=Math.sign(e[0]);return Gu(e,t,Uu(n),qu(n))}function Ju(e,t,n){return Gu(e,t,Hu(n),Hu(1/n))}function Ku(e,t,n){return Gu(e,t,Vu(n),Wu(n))}function Qu(e,t,n,r,i){const a=r(e[0]),o=r(Lu(e)),s=null!=t?r(t):(a+o)/2;return[i(s+(a-s)*n),i(s+(o-s)*n)]}function Zu(e,t,n){return Qu(e,t,n,Iu,Eu)}function ec(e,t,n){const r=Math.sign(e[0]);return Qu(e,t,n,Uu(r),qu(r))}function tc(e,t,n,r){return Qu(e,t,n,Hu(r),Hu(1/r))}function nc(e,t,n,r){return Qu(e,t,n,Vu(r),Wu(r))}function rc(e){return 1+~~(new Date(e).getMonth()/3)}function ic(e){return 1+~~(new Date(e).getUTCMonth()/3)}function ac(e){return null!=e?Tu(e)?e:[e]:[]}function oc(e,t,n){let r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),r=a-i,r>=n-t?[t,n]:[i=Math.min(Math.max(i,t),n-r),i+r]}function sc(e){return"function"==typeof e}function lc(e,t,n){n=n||{},t=ac(t)||[];const r=[],i=[],a={},o=n.comparator||cc;return ac(e).forEach(((e,o)=>{null!=e&&(r.push("descending"===t[o]?-1:1),i.push(e=sc(e)?e:Su(e,null,n)),(bu(e)||[]).forEach((e=>a[e]=1)))})),0===i.length?null:yu(o(i,r),Object.keys(a))}const uc=(e,t)=>(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0),cc=(e,t)=>1===e.length?fc(e[0],t[0]):dc(e,t,e.length),fc=(e,t)=>function(n,r){return uc(e(n),e(r))*t},dc=(e,t,n)=>(t.push(0),function(r,i){let a,o=0,s=-1;for(;0===o&&++s<n;)a=e[s],o=uc(a(r),a(i));return o*t[s]});function hc(e){return sc(e)?e:()=>e}function pc(e,t){let n;return r=>{n&&clearTimeout(n),n=setTimeout((()=>(t(r),n=null)),e)}}function mc(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}function gc(e,t){let n,r,i,a,o=0;if(e&&(n=e.length))if(null==t){for(r=e[o];o<n&&(null==r||r!=r);r=e[++o]);for(i=a=r;o<n;++o)r=e[o],null!=r&&(r<i&&(i=r),r>a&&(a=r))}else{for(r=t(e[o]);o<n&&(null==r||r!=r);r=t(e[++o]));for(i=a=r;o<n;++o)r=t(e[o]),null!=r&&(r<i&&(i=r),r>a&&(a=r))}return[i,a]}function yc(e,t){const n=e.length;let r,i,a,o,s,l=-1;if(null==t){for(;++l<n;)if(i=e[l],null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=e[l],null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}else{for(;++l<n;)if(i=t(e[l],l,e),null!=i&&i>=i){r=a=i;break}if(l===n)return[-1,-1];for(o=s=l;++l<n;)i=t(e[l],l,e),null!=i&&(r>i&&(r=i,o=l),a<i&&(a=i,s=l))}return[o,s]}const vc=Object.prototype.hasOwnProperty;function bc(e,t){return vc.call(e,t)}const xc={};function wc(e){let t,n={};function r(e){return bc(n,e)&&n[e]!==xc}const i={size:0,empty:0,object:n,has:r,get:e=>r(e)?n[e]:void 0,set(e,t){return r(e)||(++i.size,n[e]===xc&&--i.empty),n[e]=t,this},delete(e){return r(e)&&(--i.size,++i.empty,n[e]=xc),this},clear(){i.size=i.empty=0,i.object=n={}},test(e){return arguments.length?(t=e,i):t},clean(){const e={};let r=0;for(const i in n){const a=n[i];a===xc||t&&t(a)||(e[i]=a,++r)}i.size=r,i.empty=0,i.object=n=e}};return e&&Object.keys(e).forEach((t=>{i.set(t,e[t])})),i}function _c(e,t,n,r,i,a){if(!n&&0!==n)return a;const o=+n;let s,l=e[0],u=Lu(e);u<l&&(s=l,l=u,u=s),s=Math.abs(t-l);const c=Math.abs(u-t);return s<c&&s<=o?r:c<=o?i:a}function kc(e,t,n){const r=e.prototype=Object.create(t.prototype);return r.constructor=e,mc(r,n)}function Oc(e,t,n,r){let i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),r=void 0===r||r,((n=void 0===n||n)?a<=e:a<e)&&(r?e<=o:e<o)}function Sc(e){return"boolean"==typeof e}function $c(e){return"[object Date]"===Object.prototype.toString.call(e)}function Ec(e){return e&&sc(e[Symbol.iterator])}function Ac(e){return"number"==typeof e}function Dc(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function Cc(e){return"string"==typeof e}function Mc(e,t,n){e&&(e=t?ac(e).map((e=>e.replace(/\\(.)/g,"$1"))):ac(e));const r=e&&e.length,i=n&&n.get||xu,a=e=>i(t?[e]:Ou(e));let o;if(r)if(1===r){const t=a(e[0]);o=function(e){return""+t(e)}}else{const t=e.map(a);o=function(e){let n=""+t[0](e),i=0;for(;++i<r;)n+="|"+t[i](e);return n}}else o=function(){return""};return yu(o,e,"key")}function jc(e,t){const n=e[0],r=Lu(e),i=+t;return i?1===i?r:n+i*(r-n):n}function Fc(e){let t,n,r;e=+e||1e4;const i=()=>{t={},n={},r=0},a=(i,a)=>(++r>e&&(n=t,t={},r=1),t[i]=a);return i(),{clear:i,has:e=>bc(t,e)||bc(n,e),get:e=>bc(t,e)?t[e]:bc(n,e)?a(e,n[e]):void 0,set:(e,n)=>bc(t,e)?t[e]=n:a(e,n)}}function Tc(e,t,n,r){const i=t.length,a=n.length;if(!a)return t;if(!i)return n;const o=r||new t.constructor(i+a);let s=0,l=0,u=0;for(;s<i&&l<a;++u)o[u]=e(t[s],n[l])>0?n[l++]:t[s++];for(;s<i;++s,++u)o[u]=t[s];for(;l<a;++l,++u)o[u]=n[l];return o}function Nc(e,t){let n="";for(;--t>=0;)n+=e;return n}function Rc(e,t,n,r){const i=n||" ",a=e+"",o=t-a.length;return o<=0?a:"left"===r?Nc(i,o)+a:"center"===r?Nc(i,~~(o/2))+a+Nc(i,Math.ceil(o/2)):a+Nc(i,o)}function Pc(e){return e&&Lu(e)-e[0]||0}function zc(e){return Tu(e)?"["+e.map(zc)+"]":Nu(e)||Cc(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function Bc(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}const Lc=e=>Ac(e)||$c(e)?e:Date.parse(e);function Ic(e,t){return t=t||Lc,null==e||""===e?null:t(e)}function qc(e){return null==e||""===e?null:e+""}function Uc(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}function Vc(e,t,n,r){const i=null!=r?r:"…",a=e+"",o=a.length,s=Math.max(0,t-i.length);return o<=t?a:"left"===n?i+a.slice(o-s):"center"===n?a.slice(0,Math.ceil(s/2))+i+a.slice(o-~~(s/2)):a.slice(0,s)+i}function Wc(e,t,n){if(e)if(t){const r=e.length;for(let i=0;i<r;++i){const r=t(e[i]);r&&n(r,i,e)}}else e.forEach(n)}const Hc=/^([A-Za-z]+:)?\/\//,Gc=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,Xc=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,Yc="file://";async function Jc(e,t){const n=await this.sanitize(e,t),r=n.href;return n.localFile?this.file(r):this.http(r,t)}async function Kc(e,t){t=mc({},this.options,t);const n=this.fileAccess,r={href:null};let i,a,o;const s=Gc.test(e.replace(Xc,""));null!=e&&"string"==typeof e&&s||ku("Sanitize failure, invalid URI: "+zc(e));const l=Hc.test(e);return(o=t.baseURL)&&!l&&(e.startsWith("/")||"/"===o[o.length-1]||(e="/"+e),e=o+e),a=(i=e.startsWith(Yc))||"file"===t.mode||"http"!==t.mode&&!l&&n,i?e=e.slice(Yc.length):e.startsWith("//")&&("file"===t.defaultProtocol?(e=e.slice(2),a=!0):e=(t.defaultProtocol||"http")+":"+e),Object.defineProperty(r,"localFile",{value:!!a}),r.href=e,t.target&&(r.target=t.target+""),t.rel&&(r.rel=t.rel+""),"image"===t.context&&t.crossOrigin&&(r.crossOrigin=t.crossOrigin+""),r}function Qc(e){return e?t=>new Promise(((n,r)=>{e.readFile(t,((e,t)=>{e?r(e):n(t)}))})):Zc}async function Zc(){ku("No file system access.")}function ef(e){return e?async function(t,n){const r=mc({},this.options.http,n),i=n&&n.response,a=await e(t,r);return a.ok?sc(a[i])?a[i]():a.text():ku(a.status+""+a.statusText)}:tf}async function tf(){ku("No HTTP fetch method available.")}const nf=e=>null!=e&&e==e,rf=e=>!(Number.isNaN(+e)||e instanceof Date),af={boolean:Bc,integer:Iu,number:Iu,date:Ic,string:qc,unknown:Eu},of=[e=>"true"===e||"false"===e||!0===e||!1===e,e=>rf(e)&&Number.isInteger(+e),rf,e=>!Number.isNaN(Date.parse(e))],sf=["boolean","integer","number","date"];function lf(e,t){if(!e||!e.length)return"unknown";const n=e.length,r=of.length,i=of.map(((e,t)=>t+1));for(let a,o,s=0,l=0;s<n;++s)for(o=t?e[s][t]:e[s],a=0;a<r;++a)if(i[a]&&nf(o)&&!of[a](o)&&(i[a]=0,++l,l===of.length))return"string";return sf[i.reduce(((e,t)=>0===e?t:e),0)-1]}function uf(e,t){return t.reduce(((t,n)=>(t[n]=lf(e,n),t)),{})}var cf={},ff={};function df(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function hf(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function pf(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function mf(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),r=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":function(e){return e<0?"-"+pf(-e,6):e>9999?"+"+pf(e,6):pf(e,4)}(e.getUTCFullYear())+"-"+pf(e.getUTCMonth()+1,2)+"-"+pf(e.getUTCDate(),2)+(i?"T"+pf(t,2)+":"+pf(n,2)+":"+pf(r,2)+"."+pf(i,3)+"Z":r?"T"+pf(t,2)+":"+pf(n,2)+":"+pf(r,2)+"Z":n||t?"T"+pf(t,2)+":"+pf(n,2)+"Z":"")}function gf(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],a=e.length,o=0,s=0,l=a<=0,u=!1;function c(){if(l)return ff;if(u)return u=!1,cf;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<a&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=a?l=!0:10===(r=e.charCodeAt(o++))?u=!0:13===r&&(u=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<a;){if(10===(r=e.charCodeAt(t=o++)))u=!0;else if(13===r)u=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,a)}for(10===e.charCodeAt(a-1)&&--a,13===e.charCodeAt(a-1)&&--a;(r=c())!==ff;){for(var f=[];r!==cf&&r!==ff;)f.push(r),r=c();t&&null==(f=t(f,s++))||i.push(f)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function a(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?mf(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,a=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=df(e);return function(r,i){return t(n(r),i,e)}}(e,t):df(e)}));return a.columns=i||[],a},parseRows:r,format:function(t,n){return null==n&&(n=hf(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=hf(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(a).join("\n")},formatRow:a,formatValue:o}}function yf(e){const t=function(t,n){const r={delimiter:e};return vf(t,n?mc(n,r):r)};return t.responseType="text",t}function vf(e,t){return t.header&&(e=t.header.map(zc).join(t.delimiter)+"\n"+e),gf(t.delimiter).parse(e+"")}function bf(e,t){const n=t&&t.property?Su(t.property):Eu;return Nu(e)&&!function(e){return!("function"!=typeof Buffer||!sc(Buffer.isBuffer))&&Buffer.isBuffer(e)}(e)?function(e,t){!Tu(e)&&Ec(e)&&(e=[...e]);return t&&t.copy?JSON.parse(JSON.stringify(e)):e}(n(e),t):n(JSON.parse(e))}function xf(e){return e}function wf(e,t){return"string"==typeof t&&(t=e.objects[t]),"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map((function(t){return _f(e,t)}))}:_f(e,t)}function _f(e,t){var n=t.id,r=t.bbox,i=null==t.properties?{}:t.properties,a=kf(e,t);return null==n&&null==r?{type:"Feature",properties:i,geometry:a}:null==r?{type:"Feature",id:n,properties:i,geometry:a}:{type:"Feature",id:n,bbox:r,properties:i,geometry:a}}function kf(e,t){var n=function(e){if(null==e)return xf;var t,n,r=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(e,s){s||(t=n=0);var l=2,u=e.length,c=new Array(u);for(c[0]=(t+=e[0])*r+a,c[1]=(n+=e[1])*i+o;l<u;)c[l]=e[l],++l;return c}}(e.transform),r=e.arcs;function i(e,t){t.length&&t.pop();for(var i=r[e<0?~e:e],a=0,o=i.length;a<o;++a)t.push(n(i[a],a));e<0&&function(e,t){for(var n,r=e.length,i=r-t;i<--r;)n=e[i],e[i++]=e[r],e[r]=n}(t,o)}function a(e){return n(e)}function o(e){for(var t=[],n=0,r=e.length;n<r;++n)i(e[n],t);return t.length<2&&t.push(t[0]),t}function s(e){for(var t=o(e);t.length<4;)t.push(t[0]);return t}function l(e){return e.map(s)}return function e(t){var n,r=t.type;switch(r){case"GeometryCollection":return{type:r,geometries:t.geometries.map(e)};case"Point":n=a(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(a);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=l(t.arcs);break;case"MultiPolygon":n=t.arcs.map(l);break;default:return null}return{type:r,coordinates:n}}(t)}function Of(e,t){var n={},r={},i={},a=[],o=-1;function s(e,t){for(var r in e){var i=e[r];delete t[i.start],delete i.start,delete i.end,i.forEach((function(e){n[e<0?~e:e]=1})),a.push(i)}}return t.forEach((function(n,r){var i,a=e.arcs[n<0?~n:n];a.length<3&&!a[1][0]&&!a[1][1]&&(i=t[++o],t[o]=n,t[r]=i)})),t.forEach((function(t){var n,a,o=function(t){var n,r=e.arcs[t<0?~t:t],i=r[0];e.transform?(n=[0,0],r.forEach((function(e){n[0]+=e[0],n[1]+=e[1]}))):n=r[r.length-1];return t<0?[n,i]:[i,n]}(t),s=o[0],l=o[1];if(n=i[s])if(delete i[n.end],n.push(t),n.end=l,a=r[l]){delete r[a.start];var u=a===n?n:n.concat(a);r[u.start=n.start]=i[u.end=a.end]=u}else r[n.start]=i[n.end]=n;else if(n=r[l])if(delete r[n.start],n.unshift(t),n.start=s,a=i[s]){delete i[a.end];var c=a===n?n:a.concat(n);r[c.start=a.start]=i[c.end=n.end]=c}else r[n.start]=i[n.end]=n;else r[(n=[t]).start=s]=i[n.end=l]=n})),s(i,r),s(r,i),t.forEach((function(e){n[e<0?~e:e]||a.push([e])})),a}function Sf(e){return kf(e,$f.apply(this,arguments))}function $f(e,t,n){var r,i,a;if(arguments.length>1)r=Ef(e,t,n);else for(i=0,r=new Array(a=e.arcs.length);i<a;++i)r[i]=i;return{type:"MultiLineString",arcs:Of(e,r)}}function Ef(e,t,n){var r,i=[],a=[];function o(e){var t=e<0?~e:e;(a[t]||(a[t]=[])).push({i:e,g:r})}function s(e){e.forEach(o)}function l(e){e.forEach(s)}return function e(t){switch(r=t,t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":l(t.arcs);break;case"MultiPolygon":!function(e){e.forEach(l)}(t.arcs)}}(t),a.forEach(null==n?function(e){i.push(e[0].i)}:function(e){n(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}vf.responseType="text",bf.responseType="json";const Af={interior:(e,t)=>e!==t,exterior:(e,t)=>e===t};function Df(e,t){let n,r,i,a;return e=bf(e,t),t&&t.feature?(n=wf,i=t.feature):t&&t.mesh?(n=Sf,i=t.mesh,a=Af[t.filter]):ku("Missing TopoJSON feature or mesh parameter."),r=(r=e.objects[i])?n(e,r,a):ku("Invalid TopoJSON object: "+i),r&&r.features||[r]}Df.responseType="json";const Cf={dsv:vf,csv:yf(","),tsv:yf("\t"),json:bf,topojson:Df};function Mf(e,t){return arguments.length>1?(Cf[e]=t,this):bc(Cf,e)?Cf[e]:null}function jf(e){const t=Mf(e);return t&&t.responseType||"text"}function Ff(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Tf(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)<0?r=a+1:i=a}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>Ff(e(t),n)}(e)),{left:r,center:function(e,n,i,a){null==i&&(i=0),null==a&&(a=e.length);const o=r(e,n,i,a-1);return o>i&&t(e[o-1],n)>-t(e[o],n)?o-1:o},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const a=r+i>>>1;n(e[a],t)>0?i=a:r=a+1}return r}}}function Nf(e){return null===e?NaN:+e}const Rf=Tf(Ff),Pf=Rf.right,zf=Rf.left;Tf(Nf).center;class Bf{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const t=this._partials;let n=0;for(let r=0;r<this._n&&r<32;r++){const i=t[r],a=e+i,o=Math.abs(e)<Math.abs(i)?e-(a-i):i-(a-e);o&&(t[n++]=o),e=a}return t[n]=e,this._n=n+1,this}valueOf(){const e=this._partials;let t,n,r,i=this._n,a=0;if(i>0){for(a=e[--i];i>0&&(t=a,n=e[--i],a=t+n,r=n-(a-t),!r););i>0&&(r<0&&e[i-1]<0||r>0&&e[i-1]>0)&&(n=2*r,t=a+n,n==t-a&&(a=t))}return a}}var Lf=Math.sqrt(50),If=Math.sqrt(10),qf=Math.sqrt(2);function Uf(e,t,n){var r,i,a,o,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(o=Vf(e,t,n))||!isFinite(o))return[];if(o>0)for(e=Math.ceil(e/o),t=Math.floor(t/o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)*o;else for(o=-o,e=Math.ceil(e*o),t=Math.floor(t*o),a=new Array(i=Math.ceil(t-e+1));++s<i;)a[s]=(e+s)/o;return r&&a.reverse(),a}function Vf(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),a=r/Math.pow(10,i);return i>=0?(a>=Lf?10:a>=If?5:a>=qf?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Lf?10:a>=If?5:a>=qf?2:1)}function Wf(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),a=r/i;return a>=Lf?i*=10:a>=If?i*=5:a>=qf&&(i*=2),t<e?-i:i}function Hf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}function Gf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}function Xf(e,t,n=0,r=e.length-1,i=Ff){for(;r>n;){if(r-n>600){const a=r-n+1,o=t-n+1,s=Math.log(a),l=.5*Math.exp(2*s/3),u=.5*Math.sqrt(s*l*(a-l)/a)*(o-a/2<0?-1:1);Xf(e,t,Math.max(n,Math.floor(t-o*l/a+u)),Math.min(r,Math.floor(t+(a-o)*l/a+u)),i)}const a=e[t];let o=n,s=r;for(Yf(e,n,t),i(e[r],a)>0&&Yf(e,n,r);o<s;){for(Yf(e,o,s),++o,--s;i(e[o],a)<0;)++o;for(;i(e[s],a)>0;)--s}0===i(e[n],a)?Yf(e,n,s):(++s,Yf(e,s,r)),s<=t&&(n=s+1),t<=s&&(r=s-1)}return e}function Yf(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function Jf(e,t,n){if(r=(e=Float64Array.from(function*(e,t){if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)null!=(r=t(r,++n,e))&&(r=+r)>=r&&(yield r)}}(e,n))).length){if((t=+t)<=0||r<2)return Gf(e);if(t>=1)return Hf(e);var r,i=(r-1)*t,a=Math.floor(i),o=Hf(Xf(e,a).subarray(0,a+1));return o+(Gf(e.subarray(a+1))-o)*(i-a)}}function Kf(e,t,n=Nf){if(r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,a=Math.floor(i),o=+n(e[a],a,e);return o+(+n(e[a+1],a+1,e)-o)*(i-a)}}function Qf(e,t){return Jf(e,.5,t)}function Zf(e){return Array.from(function*(e){for(const t of e)yield*t}(e))}function ed(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),a=new Array(i);++r<i;)a[r]=e+r*n;return a}function td(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function nd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function rd(e){return(e=nd(Math.abs(e)))?e[1]:NaN}var id,ad=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function od(e){if(!(t=ad.exec(e)))throw new Error("invalid format: "+e);var t;return new sd({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function sd(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function ld(e,t){var n=nd(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}od.prototype=sd.prototype,sd.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var ud={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>ld(100*e,t),r:ld,s:function(e,t){var n=nd(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(id=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+nd(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function cd(e){return e}var fd,dd,hd,pd=Array.prototype.map,md=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function gd(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?cd:(t=pd.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?cd:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(pd.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",u=void 0===e.minus?"−":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=od(e)).fill,n=e.align,f=e.sign,d=e.symbol,h=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,v=e.type;"n"===v?(m=!0,v="g"):ud[v]||(void 0===g&&(g=12),y=!0,v="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var b="$"===d?i:"#"===d&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",x="$"===d?a:/[%p]/.test(v)?l:"",w=ud[v],_=/[defgprs%]/.test(v);function k(e){var i,a,l,d=b,k=x;if("c"===v)k=w(e)+k,e="";else{var O=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),O&&0==+e&&"+"!==f&&(O=!1),d=(O?"("===f?f:u:"-"===f||"("===f?"":f)+d,k=("s"===v?md[8+id/3]:"")+k+(O&&"("===f?")":""),_)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}m&&!h&&(e=r(e,1/0));var S=d.length+e.length+k.length,$=S<p?new Array(p-S+1).join(t):"";switch(m&&h&&(e=r($+e,$.length?p-k.length:1/0),$=""),n){case"<":e=d+e+k+$;break;case"=":e=d+$+e+k;break;case"^":e=$.slice(0,S=$.length>>1)+d+e+k+$.slice(S);break;default:e=$+d+e+k}return s(e)}return g=void 0===g?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),k.toString=function(){return e+""},k}return{format:f,formatPrefix:function(e,t){var n=f(((e=od(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(rd(t)/3))),i=Math.pow(10,-r),a=md[8+r/3];return function(e){return n(i*e)+a}}}}function yd(e){return Math.max(0,-rd(Math.abs(e)))}function vd(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(rd(t)/3)))-rd(Math.abs(e)))}function bd(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,rd(t)-rd(e))+1}!function(e){fd=gd(e),dd=fd.format,hd=fd.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});var xd=new Date,wd=new Date;function _d(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,a){var o,s=[];if(n=i.ceil(n),a=null==a?1:Math.floor(a),!(n<r&&a>0))return s;do{s.push(o=new Date(+n)),t(n,a),e(n)}while(o<n&&n<r);return s},i.filter=function(n){return _d((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return xd.setTime(+t),wd.setTime(+r),e(xd),e(wd),Math.floor(n(xd,wd))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var kd=_d((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));kd.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?_d((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):kd:null};var Od=1e3,Sd=6e4,$d=36e5,Ed=864e5,Ad=6048e5,Dd=_d((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Od)}),(function(e,t){return(t-e)/Od}),(function(e){return e.getUTCSeconds()})),Cd=_d((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Od)}),(function(e,t){e.setTime(+e+t*Sd)}),(function(e,t){return(t-e)/Sd}),(function(e){return e.getMinutes()})),Md=_d((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Od-e.getMinutes()*Sd)}),(function(e,t){e.setTime(+e+t*$d)}),(function(e,t){return(t-e)/$d}),(function(e){return e.getHours()})),jd=_d((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Sd)/Ed),(e=>e.getDate()-1));function Fd(e){return _d((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Sd)/Ad}))}var Td=Fd(0),Nd=Fd(1),Rd=(Fd(2),Fd(3),Fd(4)),Pd=(Fd(5),Fd(6),_d((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),zd=_d((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));zd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_d((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var Bd=_d((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Sd)}),(function(e,t){return(t-e)/Sd}),(function(e){return e.getUTCMinutes()})),Ld=_d((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*$d)}),(function(e,t){return(t-e)/$d}),(function(e){return e.getUTCHours()})),Id=_d((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Ed}),(function(e){return e.getUTCDate()-1}));function qd(e){return _d((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Ad}))}var Ud=qd(0),Vd=qd(1),Wd=(qd(2),qd(3),qd(4)),Hd=(qd(5),qd(6),_d((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}))),Gd=_d((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));Gd.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_d((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};const Xd="year",Yd="quarter",Jd="month",Kd="week",Qd="date",Zd="day",eh="dayofyear",th="hours",nh="minutes",rh="seconds",ih="milliseconds",ah=[Xd,Yd,Jd,Kd,Qd,Zd,eh,th,nh,rh,ih],oh=ah.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function sh(e){const t=ac(e).slice(),n={};t.length||ku("Missing time unit."),t.forEach((e=>{bc(oh,e)?n[e]=1:ku("Invalid time unit: ".concat(e,"."))}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&ku("Incompatible time units: ".concat(e)),t.sort(((e,t)=>oh[e]-oh[t])),t}const lh={[Xd]:"%Y ",[Yd]:"Q%q ",[Jd]:"%b ",[Qd]:"%d ",[Kd]:"W%U ",[Zd]:"%a ",[eh]:"%j ",[th]:"%H:00",[nh]:"00:%M",[rh]:":%S",[ih]:".%L",["".concat(Xd,"-").concat(Jd)]:"%Y-%m ",["".concat(Xd,"-").concat(Jd,"-").concat(Qd)]:"%Y-%m-%d ",["".concat(th,"-").concat(nh)]:"%H:%M"};function uh(e,t){const n=mc({},lh,t),r=sh(e),i=r.length;let a,o,s="",l=0;for(l=0;l<i;)for(a=r.length;a>l;--a)if(o=r.slice(l,a).join("-"),null!=n[o]){s+=n[o],l=a;break}return s.trim()}const ch=new Date;function fh(e){return ch.setFullYear(e),ch.setMonth(0),ch.setDate(1),ch.setHours(0,0,0,0),ch}function dh(e){return ph(new Date(e))}function hh(e){return mh(new Date(e))}function ph(e){return jd.count(fh(e.getFullYear())-1,e)}function mh(e){return Td.count(fh(e.getFullYear())-1,e)}function gh(e){return fh(e).getDay()}function yh(e,t,n,r,i,a,o){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,a,o);return s.setFullYear(e),s}return new Date(e,t,n,r,i,a,o)}function vh(e){return xh(new Date(e))}function bh(e){return wh(new Date(e))}function xh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Id.count(t-1,e)}function wh(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Ud.count(t-1,e)}function _h(e){return ch.setTime(Date.UTC(e,0,1)),ch.getUTCDay()}function kh(e,t,n,r,i,a,o){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,a,o));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,a,o))}function Oh(e,t,n,r,i){const a=t||1,o=Lu(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===o&&a,t),l=new Date,u=Uc(e),c=u.year?s(Xd):hc(2012),f=u.month?s(Jd):u.quarter?s(Yd):Au,d=u.week&&u.day?s(Zd,1,Kd+Zd):u.week?s(Kd,1):u.day?s(Zd,1):u.date?s(Qd,1):u.dayofyear?s(eh,1):Du,h=u.hours?s(th):Au,p=u.minutes?s(nh):Au,m=u.seconds?s(rh):Au,g=u.milliseconds?s(ih):Au;return function(e){l.setTime(+e);const t=c(l);return i(t,f(l),d(l,t),h(l),p(l),m(l),g(l))}}function Sh(e,t,n){return t+7*e-(n+6)%7}const $h={[Xd]:e=>e.getFullYear(),[Yd]:e=>Math.floor(e.getMonth()/3),[Jd]:e=>e.getMonth(),[Qd]:e=>e.getDate(),[th]:e=>e.getHours(),[nh]:e=>e.getMinutes(),[rh]:e=>e.getSeconds(),[ih]:e=>e.getMilliseconds(),[eh]:e=>ph(e),[Kd]:e=>mh(e),[Kd+Zd]:(e,t)=>Sh(mh(e),e.getDay(),gh(t)),[Zd]:(e,t)=>Sh(1,e.getDay(),gh(t))},Eh={[Yd]:e=>3*e,[Kd]:(e,t)=>Sh(e,0,gh(t))};function Ah(e,t){return Oh(e,t||1,$h,Eh,yh)}const Dh={[Xd]:e=>e.getUTCFullYear(),[Yd]:e=>Math.floor(e.getUTCMonth()/3),[Jd]:e=>e.getUTCMonth(),[Qd]:e=>e.getUTCDate(),[th]:e=>e.getUTCHours(),[nh]:e=>e.getUTCMinutes(),[rh]:e=>e.getUTCSeconds(),[ih]:e=>e.getUTCMilliseconds(),[eh]:e=>xh(e),[Kd]:e=>wh(e),[Zd]:(e,t)=>Sh(1,e.getUTCDay(),_h(t)),[Kd+Zd]:(e,t)=>Sh(wh(e),e.getUTCDay(),_h(t))},Ch={[Yd]:e=>3*e,[Kd]:(e,t)=>Sh(e,0,_h(t))};function Mh(e,t){return Oh(e,t||1,Dh,Ch,kh)}const jh={[Xd]:zd,[Yd]:Pd.every(3),[Jd]:Pd,[Kd]:Td,[Qd]:jd,[Zd]:jd,[eh]:jd,[th]:Md,[nh]:Cd,[rh]:Dd,[ih]:kd},Fh={[Xd]:Gd,[Yd]:Hd.every(3),[Jd]:Hd,[Kd]:Ud,[Qd]:Id,[Zd]:Id,[eh]:Id,[th]:Ld,[nh]:Bd,[rh]:Dd,[ih]:kd};function Th(e){return jh[e]}function Nh(e){return Fh[e]}function Rh(e,t,n){return e?e.offset(t,n):void 0}function Ph(e,t,n){return Rh(Th(e),t,n)}function zh(e,t,n){return Rh(Nh(e),t,n)}function Bh(e,t,n,r){return e?e.range(t,n,r):void 0}function Lh(e,t,n,r){return Bh(Th(e),t,n,r)}function Ih(e,t,n,r){return Bh(Nh(e),t,n,r)}const qh=1e3,Uh=6e4,Vh=36e5,Wh=864e5,Hh=2592e6,Gh=31536e6,Xh=[Xd,Jd,Qd,th,nh,rh,ih],Yh=Xh.slice(0,-1),Jh=Yh.slice(0,-1),Kh=Jh.slice(0,-1),Qh=Kh.slice(0,-1),Zh=[Xd,Jd],ep=[Xd],tp=[[Yh,1,qh],[Yh,5,5e3],[Yh,15,15e3],[Yh,30,3e4],[Jh,1,Uh],[Jh,5,3e5],[Jh,15,9e5],[Jh,30,18e5],[Kh,1,Vh],[Kh,3,108e5],[Kh,6,216e5],[Kh,12,432e5],[Qh,1,Wh],[[Xd,Kd],1,6048e5],[Zh,1,Hh],[Zh,3,7776e6],[ep,1,Gh]];function np(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(Pc(t))/n;let i,a,o=Tf((e=>e[2])).right(tp,r);return o===tp.length?(i=ep,a=Wf(t[0]/Gh,t[1]/Gh,n)):o?(o=tp[r/tp[o-1][2]<tp[o][2]/r?o-1:o],i=o[0],a=o[1]):(i=Xh,a=Math.max(Wf(t[0],t[1],n),1)),{units:i,step:a}}function rp(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ip(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ap(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}function op(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=vp(i),c=bp(i),f=vp(a),d=bp(a),h=vp(o),p=bp(o),m=vp(s),g=bp(s),y=vp(l),v=bp(l),b={a:function(e){return o[e.getDay()]},A:function(e){return a[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Lp,e:Lp,f:Wp,g:nm,G:im,H:Ip,I:qp,j:Up,L:Vp,m:Hp,M:Gp,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Em,s:Am,S:Xp,u:Yp,U:Jp,V:Qp,w:Zp,W:em,x:null,X:null,y:tm,Y:rm,Z:am,"%":$m},x={a:function(e){return o[e.getUTCDay()]},A:function(e){return a[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:om,e:om,f:fm,g:_m,G:Om,H:sm,I:lm,j:um,L:cm,m:dm,M:hm,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Em,s:Am,S:pm,u:mm,U:gm,V:vm,w:bm,W:xm,x:null,X:null,y:wm,Y:km,Z:Sm,"%":$m},w={a:function(e,t,n){var r=h.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=d.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=y.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=g.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return O(e,t,n,r)},d:Cp,e:Cp,f:Rp,g:$p,G:Sp,H:jp,I:jp,j:Mp,L:Np,m:Dp,M:Fp,p:function(e,t,n){var r=u.exec(t.slice(n));return r?(e.p=c.get(r[0].toLowerCase()),n+r[0].length):-1},q:Ap,Q:zp,s:Bp,S:Tp,u:wp,U:_p,V:kp,w:xp,W:Op,x:function(e,t,r){return O(e,n,t,r)},X:function(e,t,n){return O(e,r,t,n)},y:$p,Y:Sp,Z:Ep,"%":Pp};function _(e,t){return function(n){var r,i,a,o=[],s=-1,l=0,u=e.length;for(n instanceof Date||(n=new Date(+n));++s<u;)37===e.charCodeAt(s)&&(o.push(e.slice(l,s)),null!=(i=dp[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(a=t[r])&&(r=a(n,i)),o.push(r),l=s+1);return o.push(e.slice(l,s)),o.join("")}}function k(e,t){return function(n){var r,i,a=ap(1900,void 0,1);if(O(a,e,n+="",0)!=n.length)return null;if("Q"in a)return new Date(a.Q);if("s"in a)return new Date(1e3*a.s+("L"in a?a.L:0));if(t&&!("Z"in a)&&(a.Z=0),"p"in a&&(a.H=a.H%12+12*a.p),void 0===a.m&&(a.m="q"in a?a.q:0),"V"in a){if(a.V<1||a.V>53)return null;"w"in a||(a.w=1),"Z"in a?(i=(r=ip(ap(a.y,0,1))).getUTCDay(),r=i>4||0===i?Vd.ceil(r):Vd(r),r=Id.offset(r,7*(a.V-1)),a.y=r.getUTCFullYear(),a.m=r.getUTCMonth(),a.d=r.getUTCDate()+(a.w+6)%7):(i=(r=rp(ap(a.y,0,1))).getDay(),r=i>4||0===i?Nd.ceil(r):Nd(r),r=jd.offset(r,7*(a.V-1)),a.y=r.getFullYear(),a.m=r.getMonth(),a.d=r.getDate()+(a.w+6)%7)}else("W"in a||"U"in a)&&("w"in a||(a.w="u"in a?a.u%7:"W"in a?1:0),i="Z"in a?ip(ap(a.y,0,1)).getUTCDay():rp(ap(a.y,0,1)).getDay(),a.m=0,a.d="W"in a?(a.w+6)%7+7*a.W-(i+5)%7:a.w+7*a.U-(i+6)%7);return"Z"in a?(a.H+=a.Z/100|0,a.M+=a.Z%100,ip(a)):rp(a)}}function O(e,t,n,r){for(var i,a,o=0,s=t.length,l=n.length;o<s;){if(r>=l)return-1;if(37===(i=t.charCodeAt(o++))){if(i=t.charAt(o++),!(a=w[i in dp?t.charAt(o++):i])||(r=a(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=_(n,b),b.X=_(r,b),b.c=_(t,b),x.x=_(n,x),x.X=_(r,x),x.c=_(t,x),{format:function(e){var t=_(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=k(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=_(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=k(e+="",!0);return t.toString=function(){return e},t}}}var sp,lp,up,cp,fp,dp={"-":"",_:" ",0:"0"},hp=/^\s*\d+/,pp=/^%/,mp=/[\\^$*+?|[\]().{}]/g;function gp(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",a=i.length;return r+(a<n?new Array(n-a+1).join(t)+i:i)}function yp(e){return e.replace(mp,"\\$&")}function vp(e){return new RegExp("^(?:"+e.map(yp).join("|")+")","i")}function bp(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function xp(e,t,n){var r=hp.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function wp(e,t,n){var r=hp.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function _p(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function kp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function Op(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Sp(e,t,n){var r=hp.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function $p(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Ep(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ap(e,t,n){var r=hp.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Dp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Cp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Mp(e,t,n){var r=hp.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function jp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Fp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Tp(e,t,n){var r=hp.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Np(e,t,n){var r=hp.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Rp(e,t,n){var r=hp.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Pp(e,t,n){var r=pp.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function zp(e,t,n){var r=hp.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Bp(e,t,n){var r=hp.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Lp(e,t){return gp(e.getDate(),t,2)}function Ip(e,t){return gp(e.getHours(),t,2)}function qp(e,t){return gp(e.getHours()%12||12,t,2)}function Up(e,t){return gp(1+jd.count(zd(e),e),t,3)}function Vp(e,t){return gp(e.getMilliseconds(),t,3)}function Wp(e,t){return Vp(e,t)+"000"}function Hp(e,t){return gp(e.getMonth()+1,t,2)}function Gp(e,t){return gp(e.getMinutes(),t,2)}function Xp(e,t){return gp(e.getSeconds(),t,2)}function Yp(e){var t=e.getDay();return 0===t?7:t}function Jp(e,t){return gp(Td.count(zd(e)-1,e),t,2)}function Kp(e){var t=e.getDay();return t>=4||0===t?Rd(e):Rd.ceil(e)}function Qp(e,t){return e=Kp(e),gp(Rd.count(zd(e),e)+(4===zd(e).getDay()),t,2)}function Zp(e){return e.getDay()}function em(e,t){return gp(Nd.count(zd(e)-1,e),t,2)}function tm(e,t){return gp(e.getFullYear()%100,t,2)}function nm(e,t){return gp((e=Kp(e)).getFullYear()%100,t,2)}function rm(e,t){return gp(e.getFullYear()%1e4,t,4)}function im(e,t){var n=e.getDay();return gp((e=n>=4||0===n?Rd(e):Rd.ceil(e)).getFullYear()%1e4,t,4)}function am(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+gp(t/60|0,"0",2)+gp(t%60,"0",2)}function om(e,t){return gp(e.getUTCDate(),t,2)}function sm(e,t){return gp(e.getUTCHours(),t,2)}function lm(e,t){return gp(e.getUTCHours()%12||12,t,2)}function um(e,t){return gp(1+Id.count(Gd(e),e),t,3)}function cm(e,t){return gp(e.getUTCMilliseconds(),t,3)}function fm(e,t){return cm(e,t)+"000"}function dm(e,t){return gp(e.getUTCMonth()+1,t,2)}function hm(e,t){return gp(e.getUTCMinutes(),t,2)}function pm(e,t){return gp(e.getUTCSeconds(),t,2)}function mm(e){var t=e.getUTCDay();return 0===t?7:t}function gm(e,t){return gp(Ud.count(Gd(e)-1,e),t,2)}function ym(e){var t=e.getUTCDay();return t>=4||0===t?Wd(e):Wd.ceil(e)}function vm(e,t){return e=ym(e),gp(Wd.count(Gd(e),e)+(4===Gd(e).getUTCDay()),t,2)}function bm(e){return e.getUTCDay()}function xm(e,t){return gp(Vd.count(Gd(e)-1,e),t,2)}function wm(e,t){return gp(e.getUTCFullYear()%100,t,2)}function _m(e,t){return gp((e=ym(e)).getUTCFullYear()%100,t,2)}function km(e,t){return gp(e.getUTCFullYear()%1e4,t,4)}function Om(e,t){var n=e.getUTCDay();return gp((e=n>=4||0===n?Wd(e):Wd.ceil(e)).getUTCFullYear()%1e4,t,4)}function Sm(){return"+0000"}function $m(){return"%"}function Em(e){return+e}function Am(e){return Math.floor(+e/1e3)}function Dm(e){const t={};return n=>t[n]||(t[n]=e(n))}function Cm(e){const t=Dm(e.format),n=e.formatPrefix;return{format:t,formatPrefix:n,formatFloat(e){const n=od(e||",");if(null==n.precision){switch(n.precision=12,n.type){case"%":n.precision-=2;break;case"e":n.precision-=1}return function(e,t){return n=>{const r=e(n),i=r.indexOf(t);if(i<0)return r;let a=function(e,t){let n,r=e.lastIndexOf("e");if(r>0)return r;for(r=e.length;--r>t;)if(n=e.charCodeAt(r),n>=48&&n<=57)return r+1}(r,i);const o=a<r.length?r.slice(a):"";for(;--a>i;)if("0"!==r[a]){++a;break}return r.slice(0,a)+o}}(t(n),t(".1f")(1)[1])}return t(n)},formatSpan(e,r,i,a){a=od(null==a?",f":a);const o=Wf(e,r,i),s=Math.max(Math.abs(e),Math.abs(r));let l;if(null==a.precision)switch(a.type){case"s":return isNaN(l=vd(o,s))||(a.precision=l),n(a,s);case"":case"e":case"g":case"p":case"r":isNaN(l=bd(o,s))||(a.precision=l-("e"===a.type));break;case"f":case"%":isNaN(l=yd(o))||(a.precision=l-2*("%"===a.type))}return t(a)}}}let Mm,jm;function Fm(){return Mm=Cm({format:dd,formatPrefix:hd})}function Tm(e){return Cm(gd(e))}function Nm(e){return arguments.length?Mm=Tm(e):Mm}function Rm(e,t,n){Nu(n=n||{})||ku("Invalid time multi-format specifier: ".concat(n));const r=t(rh),i=t(nh),a=t(th),o=t(Qd),s=t(Kd),l=t(Jd),u=t(Yd),c=t(Xd),f=e(n.milliseconds||".%L"),d=e(n.seconds||":%S"),h=e(n.minutes||"%I:%M"),p=e(n.hours||"%I %p"),m=e(n.date||n.day||"%a %d"),g=e(n.week||"%b %d"),y=e(n.month||"%B"),v=e(n.quarter||"%B"),b=e(n.year||"%Y");return e=>(r(e)<e?f:i(e)<e?d:a(e)<e?h:o(e)<e?p:l(e)<e?s(e)<e?m:g:c(e)<e?u(e)<e?y:v:b)(e)}function Pm(e){const t=Dm(e.format),n=Dm(e.utcFormat);return{timeFormat:e=>Cc(e)?t(e):Rm(t,Th,e),utcFormat:e=>Cc(e)?n(e):Rm(n,Nh,e),timeParse:Dm(e.parse),utcParse:Dm(e.utcParse)}}function zm(){return jm=Pm({format:lp,parse:up,utcFormat:cp,utcParse:fp})}function Bm(e){return Pm(op(e))}function Lm(e){return arguments.length?jm=Bm(e):jm}!function(e){sp=op(e),lp=sp.format,up=sp.parse,cp=sp.utcFormat,fp=sp.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),Fm(),zm();const Im=(e,t)=>mc({},e,t);function qm(e,t){const n=e?Tm(e):Nm(),r=t?Bm(t):Lm();return Im(n,r)}function Um(e,t){const n=arguments.length;return n&&2!==n&&ku("defaultLocale expects either zero or two arguments."),n?Im(Nm(e),Lm(t)):Im(Nm(),Lm())}function Vm(e,t,n,r){const i=Mf((t=t||{}).type||"json");return i||ku("Unknown data format type: "+t.type),e=i(e,t),t.parse&&function(e,t,n,r){if(!e.length)return;const i=Lm();n=n||i.timeParse,r=r||i.utcParse;let a,o,s,l,u,c,f=e.columns||Object.keys(e[0]);"auto"===t&&(t=uf(e,f));f=Object.keys(t);const d=f.map((e=>{const i=t[e];let a,o;if(i&&(i.startsWith("date:")||i.startsWith("utc:"))){a=i.split(/:(.+)?/,2),o=a[1],("'"===o[0]&&"'"===o[o.length-1]||'"'===o[0]&&'"'===o[o.length-1])&&(o=o.slice(1,-1));return("utc"===a[0]?r:n)(o)}if(!af[i])throw Error("Illegal format pattern: "+e+":"+i);return af[i]}));for(s=0,u=e.length,c=f.length;s<u;++s)for(a=e[s],l=0;l<c;++l)o=f[l],a[o]=d[l](a[o])}(e,t.parse,n,r),bc(e,"columns")&&delete e.columns,e}const Wm=function(e,t){return n=>({options:n||{},sanitize:Kc,load:Jc,fileAccess:!!t,file:Qc(t),http:ef(e)})}("undefined"!=typeof fetch&&fetch,null);function Hm(e){const t=e||Eu,n=[],r={};return n.add=e=>{const i=t(e);return r[i]||(r[i]=1,n.push(e)),n},n.remove=e=>{const i=t(e);if(r[i]){r[i]=0;const t=n.indexOf(e);t>=0&&n.splice(t,1)}return n},n}async function Gm(e,t){try{await t(e)}catch(t){e.error(t)}}const Xm=Symbol("vega_id");let Ym=1;function Jm(e){return!(!e||!Km(e))}function Km(e){return e[Xm]}function Qm(e,t){return e[Xm]=t,e}function Zm(e){const t=e===Object(e)?e:{data:e};return Km(t)?t:Qm(t,Ym++)}function eg(e){return tg(e,Zm({}))}function tg(e,t){for(const n in e)t[n]=e[n];return t}function ng(e,t){return Qm(t,Km(e))}function rg(e,t){return e?t?(n,r)=>e(n,r)||Km(t(n))-Km(t(r)):(t,n)=>e(t,n)||Km(t)-Km(n):null}function ig(e){return e&&e.constructor===ag}function ag(){const e=[],t=[],n=[],r=[],i=[];let a=null,o=!1;return{constructor:ag,insert(t){const n=ac(t),r=n.length;for(let t=0;t<r;++t)e.push(n[t]);return this},remove(e){const n=sc(e)?r:t,i=ac(e),a=i.length;for(let e=0;e<a;++e)n.push(i[e]);return this},modify(e,t,r){const a={field:t,value:hc(r)};return sc(e)?(a.filter=e,i.push(a)):(a.tuple=e,n.push(a)),this},encode(e,t){return sc(e)?i.push({filter:e,field:t}):n.push({tuple:e,field:t}),this},clean(e){return a=e,this},reflow(){return o=!0,this},pulse(s,l){const u={},c={};let f,d,h,p,m,g;for(f=0,d=l.length;f<d;++f)u[Km(l[f])]=1;for(f=0,d=t.length;f<d;++f)m=t[f],u[Km(m)]=-1;for(f=0,d=r.length;f<d;++f)p=r[f],l.forEach((e=>{p(e)&&(u[Km(e)]=-1)}));for(f=0,d=e.length;f<d;++f)m=e[f],g=Km(m),u[g]?u[g]=1:s.add.push(Zm(e[f]));for(f=0,d=l.length;f<d;++f)m=l[f],u[Km(m)]<0&&s.rem.push(m);function y(e,t,n){n?e[t]=n(e):s.encode=t,o||(c[Km(e)]=e)}for(f=0,d=n.length;f<d;++f)h=n[f],m=h.tuple,p=h.field,g=u[Km(m)],g>0&&(y(m,p,h.value),s.modifies(p));for(f=0,d=i.length;f<d;++f)h=i[f],p=h.filter,l.forEach((e=>{p(e)&&u[Km(e)]>0&&y(e,h.field,h.value)})),s.modifies(h.field);if(o)s.mod=t.length||r.length?l.filter((e=>u[Km(e)]>0)):l.slice();else for(g in c)s.mod.push(c[g]);return(a||null==a&&(t.length||r.length))&&s.clean(!0),s}}}const og="_:mod:_";function sg(){Object.defineProperty(this,og,{writable:!0,value:{}})}sg.prototype={set(e,t,n,r){const i=this,a=i[e],o=i[og];return null!=t&&t>=0?(a[t]!==n||r)&&(a[t]=n,o[t+":"+e]=-1,o[e]=-1):(a!==n||r)&&(i[e]=n,o[e]=Tu(n)?1+n.length:-1),i},modified(e,t){const n=this[og];if(!arguments.length){for(const e in n)if(n[e])return!0;return!1}if(Tu(e)){for(let t=0;t<e.length;++t)if(n[e[t]])return!0;return!1}return null!=t&&t>=0?t+1<n[e]||!!n[t+":"+e]:!!n[e]},clear(){return this[og]={},this}};let lg=0;const ug=new sg;function cg(e,t,n,r){this.id=++lg,this.value=e,this.stamp=-1,this.rank=-1,this.qrank=-1,this.flags=0,t&&(this._update=t),n&&this.parameters(n,r)}function fg(e){return function(t){const n=this.flags;return 0===arguments.length?!!(n&e):(this.flags=t?n|e:n&~e,this)}}cg.prototype={targets(){return this._targets||(this._targets=Hm($u))},set(e){return this.value!==e?(this.value=e,1):0},skip:fg(1),modified:fg(2),parameters(e,t,n){t=!1!==t;const r=this._argval=this._argval||new sg,i=this._argops=this._argops||[],a=[];let o,s,l,u;const c=(e,n,o)=>{o instanceof cg?(o!==this&&(t&&o.targets().add(this),a.push(o)),i.push({op:o,name:e,index:n})):r.set(e,n,o)};for(o in e)if(s=e[o],"pulse"===o)ac(s).forEach((e=>{e instanceof cg?e!==this&&(e.targets().add(this),a.push(e)):ku("Pulse parameters must be operator instances.")})),this.source=s;else if(Tu(s))for(r.set(o,-1,Array(l=s.length)),u=0;u<l;++u)c(o,u,s[u]);else c(o,-1,s);return this.marshall().clear(),n&&(i.initonly=!0),a},marshall(e){const t=this._argval||ug,n=this._argops;let r,i,a,o;if(n){const s=n.length;for(i=0;i<s;++i)r=n[i],a=r.op,o=a.modified()&&a.stamp===e,t.set(r.name,r.index,a.value,o);if(n.initonly){for(i=0;i<s;++i)r=n[i],r.op.targets().remove(this);this._argops=null,this._update=null}}return t},detach(){const e=this._argops;let t,n,r,i;if(e)for(t=0,n=e.length;t<n;++t)r=e[t],i=r.op,i._targets&&i._targets.remove(this)},evaluate(e){const t=this._update;if(t){const n=this.marshall(e.stamp),r=t.call(this,n,e);if(n.clear(),r!==this.value)this.value=r;else if(!this.modified())return e.StopPropagation}},run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?(this.skip(!1),t=0):t=this.evaluate(e),this.pulse=t||e}};let dg=0;function hg(e,t,n){this.id=++dg,this.value=null,n&&(this.receive=n),e&&(this._filter=e),t&&(this._apply=t)}function pg(e,t,n){return new hg(e,t,n)}hg.prototype={_filter:Cu,_apply:Eu,targets(){return this._targets||(this._targets=Hm($u))},consume(e){return arguments.length?(this._consume=!!e,this):!!this._consume},receive(e){if(this._filter(e)){const t=this.value=this._apply(e),n=this._targets,r=n?n.length:0;for(let e=0;e<r;++e)n[e].receive(t);this._consume&&(e.preventDefault(),e.stopPropagation())}},filter(e){const t=pg(e);return this.targets().add(t),t},apply(e){const t=pg(null,e);return this.targets().add(t),t},merge(){const e=pg();this.targets().add(e);for(let t=0,n=arguments.length;t<n;++t)arguments[t].targets().add(e);return e},throttle(e){let t=-1;return this.filter((()=>{const n=Date.now();return n-t>e?(t=n,1):0}))},debounce(e){const t=pg();return this.targets().add(pg(null,null,pc(e,(e=>{const n=e.dataflow;t.receive(e),n&&n.run&&n.run()})))),t},between(e,t){let n=!1;return e.targets().add(pg(null,null,(()=>n=!0))),t.targets().add(pg(null,null,(()=>n=!1))),this.filter((()=>n))},detach(){}};const mg={skip:!0};function gg(e,t,n,r,i,a){const o=mc({},a,mg);let s,l;sc(n)||(n=hc(n)),void 0===r?s=t=>e.touch(n(t)):sc(r)?(l=new cg(null,r,i,!1),s=t=>{l.evaluate(t);const r=n(t),i=l.value;ig(i)?e.pulse(r,i,a):e.update(r,i,o)}):s=t=>e.update(n(t),r,o),t.apply(s)}function yg(e,t,n,r,i,a){if(void 0===r)t.targets().add(n);else{const o=a||{},s=new cg(null,function(e,t){return t=sc(t)?t:hc(t),e?function(n,r){const i=t(n,r);return e.skip()||(e.skip(i!==this.value).value=i),i}:t}(n,r),i,!1);s.modified(o.force),s.rank=t.rank,t.targets().add(s),n&&(s.skip(!0),s.value=n.value,s.targets().add(n),e.connect(n,[s]))}}const vg={};function bg(e,t,n){this.dataflow=e,this.stamp=null==t?-1:t,this.add=[],this.rem=[],this.mod=[],this.fields=null,this.encode=n||null}function xg(e,t){const n=[];return Wc(e,t,(e=>n.push(e))),n}function wg(e,t){const n={};return e.visit(t,(e=>{n[Km(e)]=1})),e=>n[Km(e)]?null:e}function _g(e,t){return e?(n,r)=>e(n,r)&&t(n,r):t}function kg(e,t,n,r){const i=this,a=n.length;let o=0;this.dataflow=e,this.stamp=t,this.fields=null,this.encode=r||null,this.pulses=n;for(let e=0;e<a;++e){const r=n[e];if(r.stamp===t){if(r.fields){const e=i.fields||(i.fields={});for(const t in r.fields)e[t]=1}r.changed(i.ADD)&&(o|=i.ADD),r.changed(i.REM)&&(o|=i.REM),r.changed(i.MOD)&&(o|=i.MOD)}}this.changes=o}function Og(e){return e.error("Dataflow already running. Use runAsync() to chain invocations."),e}bg.prototype={StopPropagation:vg,ADD:1,REM:2,MOD:4,ADD_REM:3,ADD_MOD:5,ALL:7,REFLOW:8,SOURCE:16,NO_SOURCE:32,NO_FIELDS:64,fork(e){return new bg(this.dataflow).init(this,e)},clone(){const e=this.fork(7);return e.add=e.add.slice(),e.rem=e.rem.slice(),e.mod=e.mod.slice(),e.source&&(e.source=e.source.slice()),e.materialize(23)},addAll(){let e=this;return!e.source||e.add===e.rem||!e.rem.length&&e.source.length===e.add.length||(e=new bg(this.dataflow).init(this),e.add=e.source,e.rem=[]),e},init(e,t){const n=this;return n.stamp=e.stamp,n.encode=e.encode,!e.fields||64&t||(n.fields=e.fields),1&t?(n.addF=e.addF,n.add=e.add):(n.addF=null,n.add=[]),2&t?(n.remF=e.remF,n.rem=e.rem):(n.remF=null,n.rem=[]),4&t?(n.modF=e.modF,n.mod=e.mod):(n.modF=null,n.mod=[]),32&t?(n.srcF=null,n.source=null):(n.srcF=e.srcF,n.source=e.source,e.cleans&&(n.cleans=e.cleans)),n},runAfter(e){this.dataflow.runAfter(e)},changed(e){const t=e||7;return 1&t&&this.add.length||2&t&&this.rem.length||4&t&&this.mod.length},reflow(e){if(e)return this.fork(7).reflow();const t=this.add.length,n=this.source&&this.source.length;return n&&n!==t&&(this.mod=this.source,t&&this.filter(4,wg(this,1))),this},clean(e){return arguments.length?(this.cleans=!!e,this):this.cleans},modifies(e){const t=this.fields||(this.fields={});return Tu(e)?e.forEach((e=>t[e]=!0)):t[e]=!0,this},modified(e,t){const n=this.fields;return!(!t&&!this.mod.length||!n)&&(arguments.length?Tu(e)?e.some((e=>n[e])):n[e]:!!n)},filter(e,t){const n=this;return 1&e&&(n.addF=_g(n.addF,t)),2&e&&(n.remF=_g(n.remF,t)),4&e&&(n.modF=_g(n.modF,t)),16&e&&(n.srcF=_g(n.srcF,t)),n},materialize(e){const t=this;return 1&(e=e||7)&&t.addF&&(t.add=xg(t.add,t.addF),t.addF=null),2&e&&t.remF&&(t.rem=xg(t.rem,t.remF),t.remF=null),4&e&&t.modF&&(t.mod=xg(t.mod,t.modF),t.modF=null),16&e&&t.srcF&&(t.source=t.source.filter(t.srcF),t.srcF=null),t},visit(e,t){const n=this,r=t;if(16&e)return Wc(n.source,n.srcF,r),n;1&e&&Wc(n.add,n.addF,r),2&e&&Wc(n.rem,n.remF,r),4&e&&Wc(n.mod,n.modF,r);const i=n.source;if(8&e&&i){const e=n.add.length+n.mod.length;e===i.length||Wc(i,e?wg(n,5):n.srcF,r)}return n}},kc(kg,bg,{fork(e){const t=new bg(this.dataflow).init(this,e&this.NO_FIELDS);return void 0!==e&&(e&t.ADD&&this.visit(t.ADD,(e=>t.add.push(e))),e&t.REM&&this.visit(t.REM,(e=>t.rem.push(e))),e&t.MOD&&this.visit(t.MOD,(e=>t.mod.push(e)))),t},changed(e){return this.changes&e},modified(e){const t=this,n=t.fields;return n&&t.changes&t.MOD?Tu(e)?e.some((e=>n[e])):n[e]:0},filter(){ku("MultiPulse does not support filtering.")},materialize(){ku("MultiPulse does not support materialization.")},visit(e,t){const n=this,r=n.pulses,i=r.length;let a=0;if(e&n.SOURCE)for(;a<i;++a)r[a].visit(e,t);else for(;a<i;++a)r[a].stamp===n.stamp&&r[a].visit(e,t);return n}});const Sg={skip:!1,force:!1};function $g(e){let t=[];return{clear:()=>t=[],size:()=>t.length,peek:()=>t[0],push:n=>(t.push(n),Eg(t,0,t.length-1,e)),pop:()=>{const n=t.pop();let r;return t.length?(r=t[0],t[0]=n,function(e,t,n){const r=t,i=e.length,a=e[t];let o,s=1+(t<<1);for(;s<i;)o=s+1,o<i&&n(e[s],e[o])>=0&&(s=o),e[t]=e[s],s=1+((t=s)<<1);e[t]=a,Eg(e,r,t,n)}(t,0,e)):r=n,r}}}function Eg(e,t,n,r){let i,a;const o=e[n];for(;n>t&&(a=n-1>>1,i=e[a],r(o,i)<0);)e[n]=i,n=a;return e[n]=o}function Ag(){this.logger(Fu()),this.logLevel(1),this._clock=0,this._rank=0,this._locale=Um();try{this._loader=Wm()}catch(e){}this._touched=Hm($u),this._input={},this._pulse=null,this._heap=$g(((e,t)=>e.qrank-t.qrank)),this._postrun=[]}function Dg(e){return function(){return this._log[e].apply(this,arguments)}}function Cg(e,t){cg.call(this,e,null,t)}Ag.prototype={stamp(){return this._clock},loader(e){return arguments.length?(this._loader=e,this):this._loader},locale(e){return arguments.length?(this._locale=e,this):this._locale},logger(e){return arguments.length?(this._log=e,this):this._log},error:Dg("error"),warn:Dg("warn"),info:Dg("info"),debug:Dg("debug"),logLevel:Dg("level"),cleanThreshold:1e4,add:function(e,t,n,r){let i,a=1;return e instanceof cg?i=e:e&&e.prototype instanceof cg?i=new e:sc(e)?i=new cg(null,e):(a=0,i=new cg(e,t)),this.rank(i),a&&(r=n,n=t),n&&this.connect(i,i.parameters(n,r)),this.touch(i),i},connect:function(e,t){const n=e.rank,r=t.length;for(let i=0;i<r;++i)if(n<t[i].rank)return void this.rerank(e)},rank:function(e){e.rank=++this._rank},rerank:function(e){const t=[e];let n,r,i;for(;t.length;)if(this.rank(n=t.pop()),r=n._targets)for(i=r.length;--i>=0;)t.push(n=r[i]),n===e&&ku("Cycle detected in dataflow graph.")},pulse:function(e,t,n){this.touch(e,n||Sg);const r=new bg(this,this._clock+(this._pulse?0:1)),i=e.pulse&&e.pulse.source||[];return r.target=e,this._input[e.id]=t.pulse(r,i),this},touch:function(e,t){const n=t||Sg;return this._pulse?this._enqueue(e):this._touched.add(e),n.skip&&e.skip(!0),this},update:function(e,t,n){const r=n||Sg;return(e.set(t)||r.force)&&this.touch(e,r),this},changeset:ag,ingest:function(e,t,n){return t=this.parse(t,n),this.pulse(e,this.changeset().insert(t))},parse:function(e,t){const n=this.locale();return Vm(e,t,n.timeParse,n.utcParse)},preload:async function(e,t,n){const r=this,i=r._pending||function(e){let t;const n=new Promise((e=>t=e));return n.requests=0,n.done=()=>{0==--n.requests&&(e._pending=null,t(e))},e._pending=n}(r);i.requests+=1;const a=await r.request(t,n);return r.pulse(e,r.changeset().remove(Cu).insert(a.data||[])),i.done(),a},request:async function(e,t){const n=this;let r,i=0;try{r=await n.loader().load(e,{context:"dataflow",response:jf(t&&t.type)});try{r=n.parse(r,t)}catch(t){i=-2,n.warn("Data ingestion failed",e,t)}}catch(t){i=-1,n.warn("Loading failed",e,t)}return{data:r,status:i}},events:function(e,t,n,r){const i=this,a=pg(n,r),o=function(e){e.dataflow=i;try{a.receive(e)}catch(e){i.error(e)}finally{i.run()}};let s;s="string"==typeof e&&"undefined"!=typeof document?document.querySelectorAll(e):ac(e);const l=s.length;for(let e=0;e<l;++e)s[e].addEventListener(t,o);return a},on:function(e,t,n,r,i){return(e instanceof cg?yg:gg)(this,e,t,n,r,i),this},evaluate:async function(e,t,n){const r=this,i=[];if(r._pulse)return Og(r);if(r._pending&&await r._pending,t&&await Gm(r,t),!r._touched.length)return r.debug("Dataflow invoked, but nothing to do."),r;const a=++r._clock;r._pulse=new bg(r,a,e),r._touched.forEach((e=>r._enqueue(e,!0))),r._touched=Hm($u);let o,s,l,u=0;try{for(;r._heap.size()>0;)o=r._heap.pop(),o.rank===o.qrank?(s=o.run(r._getPulse(o,e)),s.then?s=await s:s.async&&(i.push(s.async),s=vg),s!==vg&&o._targets&&o._targets.forEach((e=>r._enqueue(e))),++u):r._enqueue(o,!0)}catch(e){r._heap.clear(),l=e}if(r._input={},r._pulse=null,r.debug("Pulse ".concat(a,": ").concat(u," operators")),l&&(r._postrun=[],r.error(l)),r._postrun.length){const e=r._postrun.sort(((e,t)=>t.priority-e.priority));r._postrun=[];for(let t=0;t<e.length;++t)await Gm(r,e[t].callback)}return n&&await Gm(r,n),i.length&&Promise.all(i).then((e=>r.runAsync(null,(()=>{e.forEach((e=>{try{e(r)}catch(e){r.error(e)}}))})))),r},run:function(e,t,n){return this._pulse?Og(this):(this.evaluate(e,t,n),this)},runAsync:async function(e,t,n){for(;this._running;)await this._running;const r=()=>this._running=null;return(this._running=this.evaluate(e,t,n)).then(r,r),this._running},runAfter:function(e,t,n){if(this._pulse||t)this._postrun.push({priority:n||0,callback:e});else try{e(this)}catch(e){this.error(e)}},_enqueue:function(e,t){const n=e.stamp<this._clock;n&&(e.stamp=this._clock),(n||t)&&(e.qrank=e.rank,this._heap.push(e))},_getPulse:function(e,t){const n=e.source,r=this._clock;return n&&Tu(n)?new kg(this,r,n.map((e=>e.pulse)),t):this._input[e.id]||function(e,t){if(t&&t.stamp===e.stamp)return t;e=e.fork(),t&&t!==vg&&(e.source=t.source);return e}(this._pulse,n&&n.pulse)}},kc(Cg,cg,{run(e){if(e.stamp<this.stamp)return e.StopPropagation;let t;return this.skip()?this.skip(!1):t=this.evaluate(e),t=t||e,t.then?t=t.then((e=>this.pulse=e)):t!==e.StopPropagation&&(this.pulse=t),t},evaluate(e){const t=this.marshall(e.stamp),n=this.transform(t,e);return t.clear(),n},transform(){}});const Mg={};function jg(e){const t=Fg(e);return t&&t.Definition||null}function Fg(e){return e=e&&e.toLowerCase(),bc(Mg,e)?Mg[e]:null}function*Tg(e,t){if(null==t)for(let t of e)null!=t&&""!==t&&(t=+t)>=t&&(yield t);else{let n=-1;for(let r of e)r=t(r,++n,e),null!=r&&""!==r&&(r=+r)>=r&&(yield r)}}function Ng(e,t,n){const r=Float64Array.from(Tg(e,n));return r.sort(Ff),t.map((e=>Kf(r,e)))}function Rg(e,t){return Ng(e,[.25,.5,.75],t)}function Pg(e,t){const n=e.length,r=function(e,t){const n=function(e,t){let n,r=0,i=0,a=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(n=t-i,i+=n/++r,a+=n*(t-i));else{let o=-1;for(let s of e)null!=(s=t(s,++o,e))&&(s=+s)>=s&&(n=s-i,i+=n/++r,a+=n*(s-i))}if(r>1)return a/(r-1)}(e,t);return n?Math.sqrt(n):n}(e,t),i=Rg(e,t),a=(i[2]-i[0])/1.34;return 1.06*(Math.min(r,a)||r||Math.abs(i[0])||1)*Math.pow(n,-.2)}function zg(e){const t=e.maxbins||20,n=e.base||10,r=Math.log(n),i=e.divide||[5,2];let a,o,s,l,u,c,f=e.extent[0],d=e.extent[1];const h=e.span||d-f||Math.abs(f)||1;if(e.step)a=e.step;else if(e.steps){for(l=h/t,u=0,c=e.steps.length;u<c&&e.steps[u]<l;++u);a=e.steps[Math.max(0,u-1)]}else{for(o=Math.ceil(Math.log(t)/r),s=e.minstep||0,a=Math.max(s,Math.pow(n,Math.round(Math.log(h)/r)-o));Math.ceil(h/a)>t;)a*=n;for(u=0,c=i.length;u<c;++u)l=a/i[u],l>=s&&h/l<=t&&(a=l)}l=Math.log(a);const p=l>=0?0:1+~~(-l/r),m=Math.pow(n,-p-1);return(e.nice||void 0===e.nice)&&(l=Math.floor(f/a+m)*a,f=f<l?l-a:l,d=Math.ceil(d/a)*a),{start:f,stop:d===f?f+a:d,step:a}}var Bg=Math.random;function Lg(e,t,n,r){if(!e.length)return[void 0,void 0];const i=Float64Array.from(Tg(e,r)),a=i.length,o=t;let s,l,u,c;for(u=0,c=Array(o);u<o;++u){for(s=0,l=0;l<a;++l)s+=i[~~(Bg()*a)];c[u]=s/a}return c.sort(Ff),[Jf(c,n/2),Jf(c,1-n/2)]}function Ig(e,t,n,r){r=r||(e=>e);const i=e.length,a=new Float64Array(i);let o,s=0,l=1,u=r(e[0]),c=u,f=u+t;for(;l<i;++l){if(o=r(e[l]),o>=f){for(c=(u+c)/2;s<l;++s)a[s]=c;f=o+t,u=o}c=o}for(c=(u+c)/2;s<l;++s)a[s]=c;return n?function(e,t){const n=e.length;let r,i,a=0,o=1;for(;e[a]===e[o];)++o;for(;o<n;){for(r=o+1;e[o]===e[r];)++r;if(e[o]-e[o-1]<t){for(i=o+(a+r-o-o>>1);i<o;)e[i++]=e[o];for(;i>o;)e[i--]=e[a]}a=o,o=r}return e}(a,t+t/4):a}const qg=Math.sqrt(2*Math.PI),Ug=Math.SQRT2;let Vg=NaN;function Wg(e,t){e=e||0,t=null==t?1:t;let n,r,i=0,a=0;if(Vg==Vg)i=Vg,Vg=NaN;else{do{i=2*Bg()-1,a=2*Bg()-1,n=i*i+a*a}while(0===n||n>1);r=Math.sqrt(-2*Math.log(n)/n),i*=r,Vg=a*r}return e+i*t}function Hg(e,t,n){const r=(e-(t||0))/(n=null==n?1:n);return Math.exp(-.5*r*r)/(n*qg)}function Gg(e,t,n){const r=(e-(t=t||0))/(n=null==n?1:n),i=Math.abs(r);let a;if(i>37)a=0;else{const e=Math.exp(-i*i/2);let t;i<7.07106781186547?(t=.0352624965998911*i+.700383064443688,t=t*i+6.37396220353165,t=t*i+33.912866078383,t=t*i+112.079291497871,t=t*i+221.213596169931,t=t*i+220.206867912376,a=e*t,t=.0883883476483184*i+1.75566716318264,t=t*i+16.064177579207,t=t*i+86.7807322029461,t=t*i+296.564248779674,t=t*i+637.333633378831,t=t*i+793.826512519948,t=t*i+440.413735824752,a/=t):(t=i+.65,t=i+4/t,t=i+3/t,t=i+2/t,t=i+1/t,a=e/t/2.506628274631)}return r>0?1-a:a}function Xg(e,t,n){return e<0||e>1?NaN:(t||0)+(null==n?1:n)*Ug*function(e){let t,n=-Math.log((1-e)*(1+e));n<6.25?(n-=3.125,t=-364441206401782e-35,t=t*n-16850591381820166e-35,t=128584807152564e-32+t*n,t=11157877678025181e-33+t*n,t=t*n-1333171662854621e-31,t=20972767875968562e-33+t*n,t=6637638134358324e-30+t*n,t=t*n-4054566272975207e-29,t=t*n-8151934197605472e-29,t=26335093153082323e-28+t*n,t=t*n-12975133253453532e-27,t=t*n-5415412054294628e-26,t=1.0512122733215323e-9+t*n,t=t*n-4.112633980346984e-9,t=t*n-2.9070369957882005e-8,t=4.2347877827932404e-7+t*n,t=t*n-13654692000834679e-22,t=t*n-13882523362786469e-21,t=.00018673420803405714+t*n,t=t*n-.000740702534166267,t=t*n-.006033670871430149,t=.24015818242558962+t*n,t=1.6536545626831027+t*n):n<16?(n=Math.sqrt(n)-3.25,t=2.2137376921775787e-9,t=9.075656193888539e-8+t*n,t=t*n-2.7517406297064545e-7,t=1.8239629214389228e-8+t*n,t=15027403968909828e-22+t*n,t=t*n-4013867526981546e-21,t=29234449089955446e-22+t*n,t=12475304481671779e-21+t*n,t=t*n-47318229009055734e-21,t=6828485145957318e-20+t*n,t=24031110387097894e-21+t*n,t=t*n-.0003550375203628475,t=.0009532893797373805+t*n,t=t*n-.0016882755560235047,t=.002491442096107851+t*n,t=t*n-.003751208507569241,t=.005370914553590064+t*n,t=1.0052589676941592+t*n,t=3.0838856104922208+t*n):Number.isFinite(n)?(n=Math.sqrt(n)-5,t=-27109920616438573e-27,t=t*n-2.555641816996525e-10,t=1.5076572693500548e-9+t*n,t=t*n-3.789465440126737e-9,t=7.61570120807834e-9+t*n,t=t*n-1.496002662714924e-8,t=2.914795345090108e-8+t*n,t=t*n-6.771199775845234e-8,t=2.2900482228026655e-7+t*n,t=t*n-9.9298272942317e-7,t=4526062597223154e-21+t*n,t=t*n-1968177810553167e-20,t=7599527703001776e-20+t*n,t=t*n-.00021503011930044477,t=t*n-.00013871931833623122,t=1.0103004648645344+t*n,t=4.849906401408584+t*n):t=1/0;return t*e}(2*e-1)}function Yg(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Wg(n,r),pdf:e=>Hg(e,n,r),cdf:e=>Gg(e,n,r),icdf:e=>Xg(e,n,r)};return i.mean(e).stdev(t)}function Jg(e,t){const n=Yg();let r=0;const i={data(n){return arguments.length?(e=n,r=n?n.length:0,i.bandwidth(t)):e},bandwidth(n){return arguments.length?(!(t=n)&&e&&(t=Pg(e)),i):t},sample:()=>e[~~(Bg()*r)]+t*n.sample(),pdf(i){let a=0,o=0;for(;o<r;++o)a+=n.pdf((i-e[o])/t);return a/t/r},cdf(i){let a=0,o=0;for(;o<r;++o)a+=n.cdf((i-e[o])/t);return a/r},icdf(){throw Error("KDE icdf not supported.")}};return i.data(e)}function Kg(e,t){return e=e||0,t=null==t?1:t,Math.exp(e+Wg()*t)}function Qg(e,t,n){if(e<=0)return 0;t=t||0,n=null==n?1:n;const r=(Math.log(e)-t)/n;return Math.exp(-.5*r*r)/(n*qg*e)}function Zg(e,t,n){return Gg(Math.log(e),t,n)}function ey(e,t,n){return Math.exp(Xg(e,t,n))}function ty(e,t){let n,r;const i={mean(e){return arguments.length?(n=e||0,i):n},stdev(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>Kg(n,r),pdf:e=>Qg(e,n,r),cdf:e=>Zg(e,n,r),icdf:e=>ey(e,n,r)};return i.mean(e).stdev(t)}function ny(e,t){let n,r=0;const i={weights(e){return arguments.length?(n=function(e){const t=[];let n,i=0;for(n=0;n<r;++n)i+=t[n]=null==e[n]?1:+e[n];for(n=0;n<r;++n)t[n]/=i;return t}(t=e||[]),i):t},distributions(n){return arguments.length?(n?(r=n.length,e=n):(r=0,e=[]),i.weights(t)):e},sample(){const t=Bg();let i=e[r-1],a=n[0],o=0;for(;o<r-1;a+=n[++o])if(t<a){i=e[o];break}return i.sample()},pdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].pdf(t);return i},cdf(t){let i=0,a=0;for(;a<r;++a)i+=n[a]*e[a].cdf(t);return i},icdf(){throw Error("Mixture icdf not supported.")}};return i.distributions(e).weights(t)}function ry(e,t){return null==t&&(t=null==e?1:e,e=0),e+(t-e)*Bg()}function iy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=t&&e<=n?1/(n-t):0}function ay(e,t,n){return null==n&&(n=null==t?1:t,t=0),e<t?0:e>n?1:(e-t)/(n-t)}function oy(e,t,n){return null==n&&(n=null==t?1:t,t=0),e>=0&&e<=1?t+e*(n-t):NaN}function sy(e,t){let n,r;const i={min(e){return arguments.length?(n=e||0,i):n},max(e){return arguments.length?(r=null==e?1:e,i):r},sample:()=>ry(n,r),pdf:e=>iy(e,n,r),cdf:e=>ay(e,n,r),icdf:e=>oy(e,n,r)};return null==t&&(t=null==e?1:e,e=0),i.min(e).max(t)}function ly(e,t,n,r){const i=r-e*e,a=Math.abs(i)<1e-24?0:(n-e*t)/i;return[t-a*e,a]}function uy(e,t,n,r){e=e.filter((e=>{let r=t(e),i=n(e);return null!=r&&(r=+r)>=r&&null!=i&&(i=+i)>=i})),r&&e.sort(((e,n)=>t(e)-t(n)));const i=e.length,a=new Float64Array(i),o=new Float64Array(i);let s,l,u,c=0,f=0,d=0;for(u of e)a[c]=s=+t(u),o[c]=l=+n(u),++c,f+=(s-f)/c,d+=(l-d)/c;for(c=0;c<i;++c)a[c]-=f,o[c]-=d;return[a,o,f,d]}function cy(e,t,n,r){let i,a,o=-1;for(const s of e)i=t(s),a=n(s),null!=i&&(i=+i)>=i&&null!=a&&(a=+a)>=a&&r(i,a,++o)}function fy(e,t,n,r,i){let a=0,o=0;return cy(e,t,n,((e,t)=>{const n=t-i(e),s=t-r;a+=n*n,o+=s*s})),1-a/o}function dy(e,t,n){let r=0,i=0,a=0,o=0,s=0;cy(e,t,n,((e,t)=>{++s,r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=ly(r,i,a,o),u=e=>l[0]+l[1]*e;return{coef:l,predict:u,rSquared:fy(e,t,n,i,u)}}function hy(e,t,n){let r=0,i=0,a=0,o=0,s=0;cy(e,t,n,((e,t)=>{++s,e=Math.log(e),r+=(e-r)/s,i+=(t-i)/s,a+=(e*t-a)/s,o+=(e*e-o)/s}));const l=ly(r,i,a,o),u=e=>l[0]+l[1]*Math.log(e);return{coef:l,predict:u,rSquared:fy(e,t,n,i,u)}}function py(e,t,n){const[r,i,a,o]=uy(e,t,n);let s,l,u,c=0,f=0,d=0,h=0,p=0;cy(e,t,n,((e,t)=>{s=r[p++],l=Math.log(t),u=s*t,c+=(t*l-c)/p,f+=(u-f)/p,d+=(u*l-d)/p,h+=(s*u-h)/p}));const[m,g]=ly(f/o,c/o,d/o,h/o),y=e=>Math.exp(m+g*(e-a));return{coef:[Math.exp(m-g*a),g],predict:y,rSquared:fy(e,t,n,o,y)}}function my(e,t,n){let r=0,i=0,a=0,o=0,s=0,l=0;cy(e,t,n,((e,t)=>{const n=Math.log(e),u=Math.log(t);++l,r+=(n-r)/l,i+=(u-i)/l,a+=(n*u-a)/l,o+=(n*n-o)/l,s+=(t-s)/l}));const u=ly(r,i,a,o),c=e=>u[0]*Math.pow(e,u[1]);return u[0]=Math.exp(u[0]),{coef:u,predict:c,rSquared:fy(e,t,n,s,c)}}function gy(e,t,n){const[r,i,a,o]=uy(e,t,n),s=r.length;let l,u,c,f,d=0,h=0,p=0,m=0,g=0;for(l=0;l<s;)u=r[l],c=i[l++],f=u*u,d+=(f-d)/l,h+=(f*u-h)/l,p+=(f*f-p)/l,m+=(u*c-m)/l,g+=(f*c-g)/l;const y=p-d*d,v=d*y-h*h,b=(g*d-m*h)/v,x=(m*y-g*h)/v,w=-b*d,_=e=>b*(e-=a)*e+x*e+w+o;return{coef:[w-x*a+b*a*a+o,x-2*b*a,b],predict:_,rSquared:fy(e,t,n,o,_)}}function yy(e,t,n,r){if(1===r)return dy(e,t,n);if(2===r)return gy(e,t,n);const[i,a,o,s]=uy(e,t,n),l=i.length,u=[],c=[],f=r+1;let d,h,p,m,g;for(d=0;d<f;++d){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d)*a[p];for(u.push(m),g=new Float64Array(f),h=0;h<f;++h){for(p=0,m=0;p<l;++p)m+=Math.pow(i[p],d+h);g[h]=m}c.push(g)}c.push(u);const y=function(e){const t=e.length-1,n=[];let r,i,a,o,s;for(r=0;r<t;++r){for(o=r,i=r+1;i<t;++i)Math.abs(e[r][i])>Math.abs(e[r][o])&&(o=i);for(a=r;a<t+1;++a)s=e[a][r],e[a][r]=e[a][o],e[a][o]=s;for(i=r+1;i<t;++i)for(a=t;a>=r;a--)e[a][i]-=e[a][r]*e[r][i]/e[r][r]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*n[a];n[i]=(e[t][i]-s)/e[i][i]}return n}(c),v=e=>{e-=o;let t=s+y[0]+y[1]*e+y[2]*e*e;for(d=3;d<f;++d)t+=y[d]*Math.pow(e,d);return t};return{coef:vy(f,y,-o,s),predict:v,rSquared:fy(e,t,n,s,v)}}function vy(e,t,n,r){const i=Array(e);let a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(n,o)*l;return i[0]+=r,i}function by(e,t,n,r){const[i,a,o,s]=uy(e,t,n,!0),l=i.length,u=Math.max(2,~~(r*l)),c=new Float64Array(l),f=new Float64Array(l),d=new Float64Array(l).fill(1);for(let e=-1;++e<=2;){const t=[0,u-1];for(let e=0;e<l;++e){const n=i[e],r=t[0],o=t[1],s=n-i[r]>i[o]-n?r:o;let l=0,u=0,h=0,p=0,m=0;const g=1/Math.abs(i[s]-n||1);for(let e=r;e<=o;++e){const t=i[e],r=a[e],o=xy(Math.abs(n-t)*g)*d[e],s=t*o;l+=o,u+=s,h+=r*o,p+=r*s,m+=t*s}const[y,v]=ly(u/l,h/l,p/l,m/l);c[e]=y+v*n,f[e]=Math.abs(a[e]-c[e]),wy(i,e+1,t)}if(2===e)break;const n=Qf(f);if(Math.abs(n)<1e-12)break;for(let e,t,r=0;r<l;++r)e=f[r]/(6*n),d[r]=e>=1?1e-12:(t=1-e*e)*t}return function(e,t,n,r){const i=e.length,a=[];let o,s=0,l=0,u=[];for(;s<i;++s)o=e[s]+n,u[0]===o?u[1]+=(t[s]-u[1])/++l:(l=0,u[1]+=r,u=[o,t[s]],a.push(u));return u[1]+=r,a}(i,c,o,s)}function xy(e){return(e=1-e*e*e)*e*e}function wy(e,t,n){const r=e[t];let i=n[0],a=n[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-r<=r-e[i];)n[0]=++i,n[1]=a,++a}const _y=.1*Math.PI/180;function ky(e,t,n,r){n=n||25,r=Math.max(n,r||200);const i=t=>[t,e(t)],a=t[0],o=t[1],s=o-a,l=s/r,u=[i(a)],c=[];if(n===r){for(let e=1;e<r;++e)u.push(i(a+e/n*s));return u.push(i(o)),u}c.push(i(o));for(let e=n;--e>0;)c.push(i(a+e/n*s));let f=u[0],d=c[c.length-1];for(;d;){const e=i((f[0]+d[0])/2);e[0]-f[0]>=l&&Oy(f,e,d)>_y?c.push(e):(f=d,u.push(d),c.pop()),d=c[c.length-1]}return u}function Oy(e,t,n){const r=Math.atan2(n[1]-e[1],n[0]-e[0]),i=Math.atan2(t[1]-e[1],t[0]-e[0]);return Math.abs(r-i)}function Sy(e){return e&&e.length?1===e.length?e[0]:(t=e,e=>{const n=t.length;let r=1,i=String(t[0](e));for(;r<n;++r)i+="|"+t[r](e);return i}):function(){return""};var t}function $y(e,t,n){return n||e+(t?"_"+t:"")}const Ey=()=>{},Ay={init:Ey,add:Ey,rem:Ey,idx:0},Dy={values:{init:e=>e.cell.store=!0,value:e=>e.cell.data.values(),idx:-1},count:{value:e=>e.cell.num},__count__:{value:e=>e.missing+e.valid},missing:{value:e=>e.missing},valid:{value:e=>e.valid},sum:{init:e=>e.sum=0,value:e=>e.sum,add:(e,t)=>e.sum+=+t,rem:(e,t)=>e.sum-=t},product:{init:e=>e.product=1,value:e=>e.valid?e.product:void 0,add:(e,t)=>e.product*=t,rem:(e,t)=>e.product/=t},mean:{init:e=>e.mean=0,value:e=>e.valid?e.mean:void 0,add:(e,t)=>(e.mean_d=t-e.mean,e.mean+=e.mean_d/e.valid),rem:(e,t)=>(e.mean_d=t-e.mean,e.mean-=e.valid?e.mean_d/e.valid:e.mean)},average:{value:e=>e.valid?e.mean:void 0,req:["mean"],idx:1},variance:{init:e=>e.dev=0,value:e=>e.valid>1?e.dev/(e.valid-1):void 0,add:(e,t)=>e.dev+=e.mean_d*(t-e.mean),rem:(e,t)=>e.dev-=e.mean_d*(t-e.mean),req:["mean"],idx:1},variancep:{value:e=>e.valid>1?e.dev/e.valid:void 0,req:["variance"],idx:2},stdev:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid-1)):void 0,req:["variance"],idx:2},stdevp:{value:e=>e.valid>1?Math.sqrt(e.dev/e.valid):void 0,req:["variance"],idx:2},stderr:{value:e=>e.valid>1?Math.sqrt(e.dev/(e.valid*(e.valid-1))):void 0,req:["variance"],idx:2},distinct:{value:e=>e.cell.data.distinct(e.get),req:["values"],idx:3},ci0:{value:e=>e.cell.data.ci0(e.get),req:["values"],idx:3},ci1:{value:e=>e.cell.data.ci1(e.get),req:["values"],idx:3},median:{value:e=>e.cell.data.q2(e.get),req:["values"],idx:3},q1:{value:e=>e.cell.data.q1(e.get),req:["values"],idx:3},q3:{value:e=>e.cell.data.q3(e.get),req:["values"],idx:3},min:{init:e=>e.min=void 0,value:e=>e.min=Number.isNaN(e.min)?e.cell.data.min(e.get):e.min,add:(e,t)=>{(t<e.min||void 0===e.min)&&(e.min=t)},rem:(e,t)=>{t<=e.min&&(e.min=NaN)},req:["values"],idx:4},max:{init:e=>e.max=void 0,value:e=>e.max=Number.isNaN(e.max)?e.cell.data.max(e.get):e.max,add:(e,t)=>{(t>e.max||void 0===e.max)&&(e.max=t)},rem:(e,t)=>{t>=e.max&&(e.max=NaN)},req:["values"],idx:4},argmin:{init:e=>e.argmin=void 0,value:e=>e.argmin||e.cell.data.argmin(e.get),add:(e,t,n)=>{t<e.min&&(e.argmin=n)},rem:(e,t)=>{t<=e.min&&(e.argmin=void 0)},req:["min","values"],idx:3},argmax:{init:e=>e.argmax=void 0,value:e=>e.argmax||e.cell.data.argmax(e.get),add:(e,t,n)=>{t>e.max&&(e.argmax=n)},rem:(e,t)=>{t>=e.max&&(e.argmax=void 0)},req:["max","values"],idx:3}},Cy=Object.keys(Dy);function My(e,t){return Dy[e](t)}function jy(e,t){return e.idx-t.idx}function Fy(){this.valid=0,this.missing=0,this._ops.forEach((e=>e.init(this)))}function Ty(e,t){null!=e&&""!==e?e==e&&(++this.valid,this._ops.forEach((n=>n.add(this,e,t)))):++this.missing}function Ny(e,t){null!=e&&""!==e?e==e&&(--this.valid,this._ops.forEach((n=>n.rem(this,e,t)))):--this.missing}function Ry(e){return this._out.forEach((t=>e[t.out]=t.value(this))),e}function Py(e,t){const n=t||Eu,r=function(e){const t={};e.forEach((e=>t[e.name]=e));const n=e=>{e.req&&e.req.forEach((e=>{t[e]||n(t[e]=Dy[e]())}))};return e.forEach(n),Object.values(t).sort(jy)}(e),i=e.slice().sort(jy);function a(e){this._ops=r,this._out=i,this.cell=e,this.init()}return a.prototype.init=Fy,a.prototype.add=Ty,a.prototype.rem=Ny,a.prototype.set=Ry,a.prototype.get=n,a.fields=e.map((e=>e.out)),a}function zy(e){this._key=e?Su(e):Km,this.reset()}Cy.forEach((e=>{Dy[e]=function(e,t){return n=>mc({name:e,out:n||e},Ay,t)}(e,Dy[e])}));const By=zy.prototype;function Ly(e){Cg.call(this,null,e),this._adds=[],this._mods=[],this._alen=0,this._mlen=0,this._drop=!0,this._cross=!1,this._dims=[],this._dnames=[],this._measures=[],this._countOnly=!1,this._counts=null,this._prev=null,this._inputs=null,this._outputs=null}By.reset=function(){this._add=[],this._rem=[],this._ext=null,this._get=null,this._q=null},By.add=function(e){this._add.push(e)},By.rem=function(e){this._rem.push(e)},By.values=function(){if(this._get=null,0===this._rem.length)return this._add;const e=this._add,t=this._rem,n=this._key,r=e.length,i=t.length,a=Array(r-i),o={};let s,l,u;for(s=0;s<i;++s)o[n(t[s])]=1;for(s=0,l=0;s<r;++s)o[n(u=e[s])]?o[n(u)]=0:a[l++]=u;return this._rem=[],this._add=a},By.distinct=function(e){const t=this.values(),n={};let r,i=t.length,a=0;for(;--i>=0;)r=e(t[i])+"",bc(n,r)||(n[r]=1,++a);return a},By.extent=function(e){if(this._get!==e||!this._ext){const t=this.values(),n=yc(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},By.argmin=function(e){return this.extent(e)[0]||{}},By.argmax=function(e){return this.extent(e)[1]||{}},By.min=function(e){const t=this.extent(e)[0];return null!=t?e(t):void 0},By.max=function(e){const t=this.extent(e)[1];return null!=t?e(t):void 0},By.quartile=function(e){return this._get===e&&this._q||(this._q=Rg(this.values(),e),this._get=e),this._q},By.q1=function(e){return this.quartile(e)[0]},By.q2=function(e){return this.quartile(e)[1]},By.q3=function(e){return this.quartile(e)[2]},By.ci=function(e){return this._get===e&&this._ci||(this._ci=Lg(this.values(),1e3,.05,e),this._get=e),this._ci},By.ci0=function(e){return this.ci(e)[0]},By.ci1=function(e){return this.ci(e)[1]},Ly.Definition={type:"Aggregate",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Cy},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"drop",type:"boolean",default:!0},{name:"cross",type:"boolean",default:!1},{name:"key",type:"field"}]},kc(Ly,Cg,{transform(e,t){const n=this,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.modified();return n.stamp=r.stamp,n.value&&(i||t.modified(n._inputs,!0))?(n._prev=n.value,n.value=i?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(n.value=n.value||n.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),r.modifies(n._outputs),n._drop=!1!==e.drop,e.cross&&n._dims.length>1&&(n._drop=!1,n.cross()),t.clean()&&n._drop&&r.clean(!0).runAfter((()=>this.clean())),n.changes(r)},cross(){const e=this,t=e.value,n=e._dnames,r=n.map((()=>({}))),i=n.length;function a(e){let t,a,o,s;for(t in e)for(o=e[t].tuple,a=0;a<i;++a)r[a][s=o[n[a]]]=s}a(e._prev),a(t),function a(o,s,l){const u=n[l],c=r[l++];for(const n in c){const r=o?o+"|"+n:n;s[u]=c[n],l<i?a(r,s,l):t[r]||e.cell(r,s)}}("",{},0)},init(e){const t=this._inputs=[],n=this._outputs=[],r={};function i(e){const n=ac(bu(e)),i=n.length;let a,o=0;for(;o<i;++o)r[a=n[o]]||(r[a]=1,t.push(a))}this._dims=ac(e.groupby),this._dnames=this._dims.map((e=>{const t=vu(e);return i(e),n.push(t),t})),this.cellkey=e.key?e.key:Sy(this._dims),this._countOnly=!0,this._counts=[],this._measures=[];const a=e.fields||[null],o=e.ops||["count"],s=e.as||[],l=a.length,u={};let c,f,d,h,p,m;for(l!==o.length&&ku("Unmatched number of fields and aggregate ops."),m=0;m<l;++m)c=a[m],f=o[m],null==c&&"count"!==f&&ku("Null aggregate field specified."),h=vu(c),p=$y(f,h,s[m]),n.push(p),"count"!==f?(d=u[h],d||(i(c),d=u[h]=[],d.field=c,this._measures.push(d)),"count"!==f&&(this._countOnly=!1),d.push(My(f,p))):this._counts.push(p);return this._measures=this._measures.map((e=>Py(e,e.field))),{}},cellkey:Sy(),cell(e,t){let n=this.value[e];return n?0===n.num&&this._drop&&n.stamp<this.stamp?(n.stamp=this.stamp,this._adds[this._alen++]=n):n.stamp<this.stamp&&(n.stamp=this.stamp,this._mods[this._mlen++]=n):(n=this.value[e]=this.newcell(e,t),this._adds[this._alen++]=n),n},newcell(e,t){const n={key:e,num:0,agg:null,tuple:this.newtuple(t,this._prev&&this._prev[e]),stamp:this.stamp,store:!1};if(!this._countOnly){const e=this._measures,t=e.length;n.agg=Array(t);for(let r=0;r<t;++r)n.agg[r]=new e[r](n)}return n.store&&(n.data=new zy),n},newtuple(e,t){const n=this._dnames,r=this._dims,i=r.length,a={};for(let t=0;t<i;++t)a[n[t]]=r[t](e);return t?ng(t.tuple,a):Zm(a)},clean(){const e=this.value;for(const t in e)0===e[t].num&&delete e[t]},add(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num+=1,this._countOnly)return;n.store&&n.data.add(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].add(r[t].get(e),e)},rem(e){const t=this.cellkey(e),n=this.cell(t,e);if(n.num-=1,this._countOnly)return;n.store&&n.data.rem(e);const r=n.agg;for(let t=0,n=r.length;t<n;++t)r[t].rem(r[t].get(e),e)},celltuple(e){const t=e.tuple,n=this._counts;e.store&&e.data.values();for(let r=0,i=n.length;r<i;++r)t[n[r]]=e.num;if(!this._countOnly){const n=e.agg;for(let e=0,r=n.length;e<r;++e)n[e].set(t)}return t},changes(e){const t=this._adds,n=this._mods,r=this._prev,i=this._drop,a=e.add,o=e.rem,s=e.mod;let l,u,c,f;if(r)for(u in r)l=r[u],i&&!l.num||o.push(l.tuple);for(c=0,f=this._alen;c<f;++c)a.push(this.celltuple(t[c])),t[c]=null;for(c=0,f=this._mlen;c<f;++c)l=n[c],(0===l.num&&i?o:s).push(this.celltuple(l)),n[c]=null;return this._alen=this._mlen=0,this._prev=null,e}});function Iy(e){Cg.call(this,null,e)}function qy(e,t,n){const r=e;let i=t||[],a=n||[],o={},s=0;return{add:e=>a.push(e),remove:e=>o[r(e)]=++s,size:()=>i.length,data:(e,t)=>(s&&(i=i.filter((e=>!o[r(e)])),o={},s=0),t&&e&&i.sort(e),a.length&&(i=e?Tc(e,i,a.sort(e)):i.concat(a),a=[]),i)}}function Uy(e){Cg.call(this,[],e)}function Vy(e){cg.call(this,null,Wy,e)}function Wy(e){return this.value&&!e.modified()?this.value:lc(e.fields,e.orders)}function Hy(e){Cg.call(this,null,e)}function Gy(e){Cg.call(this,null,e)}Iy.Definition={type:"Bin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:!0,default:[5,2]},{name:"extent",type:"number",array:!0,length:2,required:!0},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:!0},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:!0},{name:"name",type:"string"},{name:"as",type:"string",array:!0,length:2,default:["bin0","bin1"]}]},kc(Iy,Cg,{transform(e,t){const n=!1!==e.interval,r=this._bins(e),i=r.start,a=r.step,o=e.as||["bin0","bin1"],s=o[0],l=o[1];let u;return u=e.modified()?(t=t.reflow(!0)).SOURCE:t.modified(bu(e.field))?t.ADD_MOD:t.ADD,t.visit(u,n?e=>{const t=r(e);e[s]=t,e[l]=null==t?null:i+a*(1+(t-i)/a)}:e=>e[s]=r(e)),t.modifies(n?o:s)},_bins(e){if(this.value&&!e.modified())return this.value;const t=e.field,n=zg(e),r=n.step;let i,a,o=n.start,s=o+Math.ceil((n.stop-o)/r)*r;null!=(i=e.anchor)&&(a=i-(o+r*Math.floor((i-o)/r)),o+=a,s+=a);const l=function(e){let n=Iu(t(e));return null==n?null:n<o?-1/0:n>s?1/0:(n=Math.max(o,Math.min(n,s-r)),o+r*Math.floor(1e-14+(n-o)/r))};return l.start=o,l.stop=n.stop,l.step=r,this.value=yu(l,bu(t),e.name||"bin_"+vu(t))}}),Uy.Definition={type:"Collect",metadata:{source:!0},params:[{name:"sort",type:"compare"}]},kc(Uy,Cg,{transform(e,t){const n=t.fork(t.ALL),r=qy(Km,this.value,n.materialize(n.ADD).add),i=e.sort,a=t.changed()||i&&(e.modified("sort")||t.modified(i.fields));return n.visit(n.REM,r.remove),this.modified(a),this.value=n.source=r.data(rg(i),a),t.source&&t.source.root&&(this.value.root=t.source.root),n}}),kc(Vy,cg),Hy.Definition={type:"CountPattern",metadata:{generates:!0,changes:!0},params:[{name:"field",type:"field",required:!0},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:!0,length:2,default:["text","count"]}]},kc(Hy,Cg,{transform(e,t){const n=t=>n=>{for(var r,i=function(e,t,n){switch(t){case"upper":e=e.toUpperCase();break;case"lower":e=e.toLowerCase()}return e.match(n)}(s(n),e.case,a)||[],l=0,u=i.length;l<u;++l)o.test(r=i[l])||t(r)},r=this._parameterCheck(e,t),i=this._counts,a=this._match,o=this._stop,s=e.field,l=e.as||["text","count"],u=n((e=>i[e]=1+(i[e]||0))),c=n((e=>i[e]-=1));return r?t.visit(t.SOURCE,u):(t.visit(t.ADD,u),t.visit(t.REM,c)),this._finish(t,l)},_parameterCheck(e,t){let n=!1;return!e.modified("stopwords")&&this._stop||(this._stop=new RegExp("^"+(e.stopwords||"")+"$","i"),n=!0),!e.modified("pattern")&&this._match||(this._match=new RegExp(e.pattern||"[\\w']+","g"),n=!0),(e.modified("field")||t.modified(e.field.fields))&&(n=!0),n&&(this._counts={}),n},_finish(e,t){const n=this._counts,r=this._tuples||(this._tuples={}),i=t[0],a=t[1],o=e.fork(e.NO_SOURCE|e.NO_FIELDS);let s,l,u;for(s in n)l=r[s],u=n[s]||0,!l&&u?(r[s]=l=Zm({}),l[i]=s,l[a]=u,o.add.push(l)):0===u?(l&&o.rem.push(l),n[s]=null,r[s]=null):l[a]!==u&&(l[a]=u,o.mod.push(l));return o.modifies(t)}}),Gy.Definition={type:"Cross",metadata:{generates:!0},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:!0,length:2,default:["a","b"]}]},kc(Gy,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.as||["a","b"],i=r[0],a=r[1],o=!this.value||t.changed(t.ADD_REM)||e.modified("as")||e.modified("filter");let s=this.value;return o?(s&&(n.rem=s),s=t.materialize(t.SOURCE).source,n.add=this.value=function(e,t,n,r){for(var i,a,o=[],s={},l=e.length,u=0;u<l;++u)for(s[t]=a=e[u],i=0;i<l;++i)s[n]=e[i],r(s)&&(o.push(Zm(s)),(s={})[t]=a);return o}(s,i,a,e.filter||Cu)):n.mod=s,n.source=this.value,n.modifies(r)}});const Xy={kde:Jg,mixture:ny,normal:Yg,lognormal:ty,uniform:sy},Yy="function";function Jy(e,t){const n=e.function;bc(Xy,n)||ku("Unknown distribution function: "+n);const r=Xy[n]();for(const n in e)"field"===n?r.data((e.from||t()).map(e[n])):"distributions"===n?r[n](e[n].map((e=>Jy(e,t)))):typeof r[n]===Yy&&r[n](e[n]);return r}function Ky(e){Cg.call(this,null,e)}const Qy=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:!0},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}],Zy={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:!0,params:Qy},{name:"weights",type:"number",array:!0}]};function ev(e,t){return e?e.map(((e,n)=>t[n]||vu(e))):null}function tv(e,t,n){const r=[],i=e=>e(l);let a,o,s,l,u,c;if(null==t)r.push(e.map(n));else for(a={},o=0,s=e.length;o<s;++o)l=e[o],u=t.map(i),c=a[u],c||(a[u]=c=[],c.dims=u,r.push(c)),c.push(n(l));return r}Ky.Definition={type:"Density",metadata:{generates:!0},params:[{name:"extent",type:"number",array:!0,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Qy.concat(Zy)},{name:"as",type:"string",array:!0,default:["value","density"]}]},kc(Ky,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=Jy(e.distribution,function(e){return()=>e.materialize(e.SOURCE).source}(t)),i=e.steps||e.minsteps||25,a=e.steps||e.maxsteps||200;let o=e.method||"pdf";"pdf"!==o&&"cdf"!==o&&ku("Invalid density method: "+o),e.extent||r.data||ku("Missing density extent parameter."),o=r[o];const s=e.as||["value","density"],l=ky(o,e.extent||gc(r.data()),i,a).map((e=>{const t={};return t[s[0]]=e[0],t[s[1]]=e[1],Zm(t)}));this.value&&(n.rem=this.value),this.value=n.add=n.source=l}return n}});function nv(e){Cg.call(this,null,e)}nv.Definition={type:"DotBin",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:!1},{name:"as",type:"string",default:"bin"}]};function rv(e){cg.call(this,null,iv,e),this.modified(!0)}function iv(e){const t=e.expr;return this.value&&!e.modified("expr")?this.value:yu((n=>t(n,e)),bu(t),vu(t))}function av(e){Cg.call(this,[void 0,void 0],e)}function ov(e,t){cg.call(this,e),this.parent=t,this.count=0}function sv(e){Cg.call(this,{},e),this._keys=wc();const t=this._targets=[];t.active=0,t.forEach=e=>{for(let n=0,r=t.active;n<r;++n)e(t[n],n,t)}}function lv(e){cg.call(this,null,uv,e)}function uv(e){return this.value&&!e.modified()?this.value:Tu(e.name)?ac(e.name).map((e=>Su(e))):Su(e.name,e.as)}function cv(e){Cg.call(this,wc(),e)}function fv(e){Cg.call(this,[],e)}function dv(e){Cg.call(this,[],e)}function hv(e){Cg.call(this,null,e)}function pv(e){Cg.call(this,[],e)}kc(nv,Cg,{transform(e,t){if(this.value&&!e.modified()&&!t.changed())return t;const n=t.materialize(t.SOURCE).source,r=tv(t.source,e.groupby,Eu),i=e.smooth||!1,a=e.field,o=e.step||((e,t)=>Pc(gc(e,t))/30)(n,a),s=rg(((e,t)=>a(e)-a(t))),l=e.as||"bin",u=r.length;let c,f=1/0,d=-1/0,h=0;for(;h<u;++h){const e=r[h].sort(s);c=-1;for(const t of Ig(e,o,i,a))t<f&&(f=t),t>d&&(d=t),e[++c][l]=t}return this.value={start:f,stop:d,step:o},t.reflow(!0).modifies(l)}}),kc(rv,cg),av.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:!0}]},kc(av,Cg,{transform(e,t){const n=this.value,r=e.field,i=t.changed()||t.modified(r.fields)||e.modified("field");let a=n[0],o=n[1];if((i||null==a)&&(a=1/0,o=-1/0),t.visit(i?t.SOURCE:t.ADD,(e=>{const t=Iu(r(e));null!=t&&(t<a&&(a=t),t>o&&(o=t))})),!Number.isFinite(a)||!Number.isFinite(o)){let e=vu(r);e&&(e=' for field "'.concat(e,'"')),t.dataflow.warn("Infinite extent".concat(e,": [").concat(a,", ").concat(o,"]")),a=o=void 0}this.value=[a,o]}}),kc(ov,cg,{connect(e){return this.detachSubflow=e.detachSubflow,this.targets().add(e),e.source=this},add(e){this.count+=1,this.value.add.push(e)},rem(e){this.count-=1,this.value.rem.push(e)},mod(e){this.value.mod.push(e)},init(e){this.value.init(e,e.NO_SOURCE)},evaluate(){return this.value}}),kc(sv,Cg,{activate(e){this._targets[this._targets.active++]=e},subflow(e,t,n,r){const i=this.value;let a,o,s=bc(i,e)&&i[e];return s?s.value.stamp<n.stamp&&(s.init(n),this.activate(s)):(o=r||(o=this._group[e])&&o.tuple,a=n.dataflow,s=new ov(n.fork(n.NO_SOURCE),this),a.add(s).connect(t(a,e,o)),i[e]=s,this.activate(s)),s},clean(){const e=this.value;for(const t in e)if(0===e[t].count){const n=e[t].detachSubflow;n&&n(),delete e[t]}},initTargets(){const e=this._targets,t=e.length;for(let n=0;n<t&&null!=e[n];++n)e[n]=null;e.active=0},transform(e,t){const n=t.dataflow,r=e.key,i=e.subflow,a=this._keys,o=e.modified("key"),s=e=>this.subflow(e,i,t);return this._group=e.group||{},this.initTargets(),t.visit(t.REM,(e=>{const t=Km(e),n=a.get(t);void 0!==n&&(a.delete(t),s(n).rem(e))})),t.visit(t.ADD,(e=>{const t=r(e);a.set(Km(e),t),s(t).add(e)})),o||t.modified(r.fields)?t.visit(t.MOD,(e=>{const t=Km(e),n=a.get(t),i=r(e);n===i?s(i).mod(e):(a.set(t,i),s(n).rem(e),s(i).add(e))})):t.changed(t.MOD)&&t.visit(t.MOD,(e=>{s(a.get(Km(e))).mod(e)})),o&&t.visit(t.REFLOW,(e=>{const t=Km(e),n=a.get(t),i=r(e);n!==i&&(a.set(t,i),s(n).rem(e),s(i).add(e))})),t.clean()?n.runAfter((()=>{this.clean(),a.clean()})):a.empty>n.cleanThreshold&&n.runAfter(a.clean),t}}),kc(lv,cg),cv.Definition={type:"Filter",metadata:{changes:!0},params:[{name:"expr",type:"expr",required:!0}]},kc(cv,Cg,{transform(e,t){const n=t.dataflow,r=this.value,i=t.fork(),a=i.add,o=i.rem,s=i.mod,l=e.expr;let u=!0;function c(t){const n=Km(t),i=l(t,e),c=r.get(n);i&&c?(r.delete(n),a.push(t)):i||c?u&&i&&!c&&s.push(t):(r.set(n,1),o.push(t))}return t.visit(t.REM,(e=>{const t=Km(e);r.has(t)?r.delete(t):o.push(e)})),t.visit(t.ADD,(t=>{l(t,e)?a.push(t):r.set(Km(t),1)})),t.visit(t.MOD,c),e.modified()&&(u=!1,t.visit(t.REFLOW,c)),r.empty>n.cleanThreshold&&n.runAfter(r.clean),i}}),fv.Definition={type:"Flatten",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"index",type:"string"},{name:"as",type:"string",array:!0}]},kc(fv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=ev(r,e.as||[]),a=e.index||null,o=i.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{const t=r.map((t=>t(e))),s=t.reduce(((e,t)=>Math.max(e,t.length)),0);let l,u,c,f=0;for(;f<s;++f){for(u=eg(e),l=0;l<o;++l)u[i[l]]=null==(c=t[l][f])?null:c;a&&(u[a]=f),n.add.push(u)}})),this.value=n.source=n.add,a&&n.modifies(a),n.modifies(i)}}),dv.Definition={type:"Fold",metadata:{generates:!0},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0,length:2,default:["key","value"]}]},kc(dv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=r.map(vu),a=e.as||["key","value"],o=a[0],s=a[1],l=r.length;return n.rem=this.value,t.visit(t.SOURCE,(e=>{for(let t,a=0;a<l;++a)t=eg(e),t[o]=i[a],t[s]=r[a](e),n.add.push(t)})),this.value=n.source=n.add,n.modifies(a)}}),hv.Definition={type:"Formula",metadata:{modifies:!0},params:[{name:"expr",type:"expr",required:!0},{name:"as",type:"string",required:!0},{name:"initonly",type:"boolean"}]},kc(hv,Cg,{transform(e,t){const n=e.expr,r=e.as,i=e.modified(),a=e.initonly?t.ADD:i?t.SOURCE:t.modified(n.fields)||t.modified(r)?t.ADD_MOD:t.ADD;return i&&(t=t.materialize().reflow(!0)),e.initonly||t.modifies(r),t.visit(a,(t=>t[r]=n(t,e)))}}),kc(pv,Cg,{transform(e,t){const n=t.fork(t.ALL),r=e.generator;let i,a,o,s=this.value,l=e.size-s.length;if(l>0){for(i=[];--l>=0;)i.push(o=Zm(r(e))),s.push(o);n.add=n.add.length?n.materialize(n.ADD).add.concat(i):i}else a=s.slice(0,-l),n.rem=n.rem.length?n.materialize(n.REM).rem.concat(a):a,s=s.slice(-l);return n.source=this.value=s,n}});const mv={value:"value",median:Qf,mean:function(e,t){let n=0,r=0;if(void 0===t)for(let t of e)null!=t&&(t=+t)>=t&&(++n,r+=t);else{let i=-1;for(let a of e)null!=(a=t(a,++i,e))&&(a=+a)>=a&&(++n,r+=a)}if(n)return r/n},min:Gf,max:Hf},gv=[];function yv(e){Cg.call(this,[],e)}function vv(e){Ly.call(this,e)}function bv(e){Cg.call(this,null,e)}function xv(e){cg.call(this,null,wv,e)}function wv(e){return this.value&&!e.modified()?this.value:Mc(e.fields,e.flat)}function _v(e){Cg.call(this,[],e),this._pending=null}function kv(e,t,n){n.forEach(Zm);const r=t.fork(t.NO_FIELDS&t.NO_SOURCE);return r.rem=e.value,e.value=r.source=r.add=n,e._pending=null,r.rem.length&&r.clean(!0),r}function Ov(e){Cg.call(this,{},e)}function Sv(e){cg.call(this,null,$v,e)}function $v(e){if(this.value&&!e.modified())return this.value;const t=e.extents,n=t.length;let r,i,a=1/0,o=-1/0;for(r=0;r<n;++r)i=t[r],i[0]<a&&(a=i[0]),i[1]>o&&(o=i[1]);return[a,o]}function Ev(e){cg.call(this,null,Av,e)}function Av(e){return this.value&&!e.modified()?this.value:e.values.reduce(((e,t)=>e.concat(t)),[])}function Dv(e){Cg.call(this,null,e)}function Cv(e){Ly.call(this,e)}function Mv(e){sv.call(this,e)}function jv(e){Cg.call(this,null,e)}function Fv(e){Cg.call(this,null,e)}function Tv(e){Cg.call(this,null,e)}yv.Definition={type:"Impute",metadata:{changes:!0},params:[{name:"field",type:"field",required:!0},{name:"key",type:"field",required:!0},{name:"keyvals",array:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]},kc(yv,Cg,{transform(e,t){var n,r,i,a,o,s,l,u,c,f,d=t.fork(t.ALL),h=function(e){var t,n=e.method||mv.value;if(null!=mv[n])return n===mv.value?(t=void 0!==e.value?e.value:0,()=>t):mv[n];ku("Unrecognized imputation method: "+n)}(e),p=function(e){const t=e.field;return e=>e?t(e):NaN}(e),m=vu(e.field),g=vu(e.key),y=(e.groupby||[]).map(vu),v=function(e,t,n,r){var i,a,o,s,l,u,c,f,d=e=>e(f),h=[],p=r?r.slice():[],m={},g={};for(p.forEach(((e,t)=>m[e]=t+1)),s=0,c=e.length;s<c;++s)u=n(f=e[s]),l=m[u]||(m[u]=p.push(u)),(o=g[a=(i=t?t.map(d):gv)+""])||(o=g[a]=[],h.push(o),o.values=i),o[l-1]=f;return h.domain=p,h}(t.source,e.groupby,e.key,e.keyvals),b=[],x=this.value,w=v.domain.length;for(o=0,u=v.length;o<u;++o)for(i=(n=v[o]).values,r=NaN,l=0;l<w;++l)if(null==n[l]){for(a=v.domain[l],f={_impute:!0},s=0,c=i.length;s<c;++s)f[y[s]]=i[s];f[g]=a,f[m]=Number.isNaN(r)?r=h(n,p):r,b.push(Zm(f))}return b.length&&(d.add=d.materialize(d.ADD).add.concat(b)),x.length&&(d.rem=d.materialize(d.REM).rem.concat(x)),this.value=b,d}}),vv.Definition={type:"JoinAggregate",metadata:{modifies:!0},params:[{name:"groupby",type:"field",array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"ops",type:"enum",array:!0,values:Cy},{name:"as",type:"string",null:!0,array:!0},{name:"key",type:"field"}]},kc(vv,Ly,{transform(e,t){const n=this,r=e.modified();let i;return n.value&&(r||t.modified(n._inputs,!0))?(i=n.value=r?n.init(e):{},t.visit(t.SOURCE,(e=>n.add(e)))):(i=n.value=n.value||this.init(e),t.visit(t.REM,(e=>n.rem(e))),t.visit(t.ADD,(e=>n.add(e)))),n.changes(),t.visit(t.SOURCE,(e=>{mc(e,i[n.cellkey(e)].tuple)})),t.reflow(r).modifies(this._outputs)},changes(){const e=this._adds,t=this._mods;let n,r;for(n=0,r=this._alen;n<r;++n)this.celltuple(e[n]),e[n]=null;for(n=0,r=this._mlen;n<r;++n)this.celltuple(t[n]),t[n]=null;this._alen=this._mlen=0}}),bv.Definition={type:"KDE",metadata:{generates:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"cumulative",type:"boolean",default:!1},{name:"counts",type:"boolean",default:!1},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:!0,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:!0,default:["value","density"]}]},kc(bv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=t.materialize(t.SOURCE).source,i=tv(r,e.groupby,e.field),a=(e.groupby||[]).map(vu),o=e.bandwidth,s=e.cumulative?"cdf":"pdf",l=e.as||["value","density"],u=[];let c=e.extent,f=e.steps||e.minsteps||25,d=e.steps||e.maxsteps||200;"pdf"!==s&&"cdf"!==s&&ku("Invalid density method: "+s),"shared"===e.resolve&&(c||(c=gc(r,e.field)),f=d=e.steps||d),i.forEach((t=>{const n=Jg(t,o)[s],r=e.counts?t.length:1;ky(n,c||gc(t),f,d).forEach((e=>{const n={};for(let e=0;e<a.length;++e)n[a[e]]=t.dims[e];n[l[0]]=e[0],n[l[1]]=e[1]*r,u.push(Zm(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=u}return n}}),kc(xv,cg),kc(_v,Cg,{transform(e,t){const n=t.dataflow;if(this._pending)return kv(this,t,this._pending);if(function(e){return e.modified("async")&&!(e.modified("values")||e.modified("url")||e.modified("format"))}(e))return t.StopPropagation;if(e.values)return kv(this,t,n.parse(e.values,e.format));if(e.async){return{async:n.request(e.url,e.format).then((e=>(this._pending=ac(e.data),e=>e.touch(this))))}}return n.request(e.url,e.format).then((e=>kv(this,t,ac(e.data))))}}),Ov.Definition={type:"Lookup",metadata:{modifies:!0},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:!0},{name:"key",type:"field",required:!0}]},{name:"values",type:"field",array:!0},{name:"fields",type:"field",array:!0,required:!0},{name:"as",type:"string",array:!0},{name:"default",default:null}]},kc(Ov,Cg,{transform(e,t){const n=e.fields,r=e.index,i=e.values,a=null==e.default?null:e.default,o=e.modified(),s=n.length;let l,u,c,f=o?t.SOURCE:t.ADD,d=t,h=e.as;return i?(u=i.length,s>1&&!h&&ku('Multi-field lookup requires explicit "as" parameter.'),h&&h.length!==s*u&&ku('The "as" parameter has too few output field names.'),h=h||i.map(vu),l=function(e){for(var t,o,l=0,c=0;l<s;++l)if(null==(o=r.get(n[l](e))))for(t=0;t<u;++t,++c)e[h[c]]=a;else for(t=0;t<u;++t,++c)e[h[c]]=i[t](o)}):(h||ku("Missing output field names."),l=function(e){for(var t,i=0;i<s;++i)t=r.get(n[i](e)),e[h[i]]=null==t?a:t}),o?d=t.reflow(!0):(c=n.some((e=>t.modified(e.fields))),f|=c?t.MOD:0),t.visit(f,l),d.modifies(h)}}),kc(Sv,cg),kc(Ev,cg),kc(Dv,Cg,{transform(e,t){return this.modified(e.modified()),this.value=e,t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),Cv.Definition={type:"Pivot",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"value",type:"field",required:!0},{name:"op",type:"enum",values:Cy,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]},kc(Cv,Ly,{_transform:Ly.prototype.transform,transform(e,t){return this._transform(function(e,t){const n=e.field,r=e.value,i=("count"===e.op?"__count__":e.op)||"sum",a=bu(n).concat(bu(r)),o=function(e,t,n){const r={},i=[];return n.visit(n.SOURCE,(t=>{const n=e(t);r[n]||(r[n]=1,i.push(n))})),i.sort(uc),t?i.slice(0,t):i}(n,e.limit||0,t);t.changed()&&e.set("__pivot__",null,null,!0);return{key:e.key,groupby:e.groupby,ops:o.map((()=>i)),fields:o.map((e=>function(e,t,n,r){return yu((r=>t(r)===e?n(r):NaN),r,e+"")}(e,n,r,a))),as:o.map((e=>e+"")),modified:e.modified.bind(e)}}(e,t),t)}}),kc(Mv,sv,{transform(e,t){const n=e.subflow,r=e.field,i=e=>this.subflow(Km(e),n,t,e);return(e.modified("field")||r&&t.modified(bu(r)))&&ku("PreFacet does not support field modification."),this.initTargets(),r?(t.visit(t.MOD,(e=>{const t=i(e);r(e).forEach((e=>t.mod(e)))})),t.visit(t.ADD,(e=>{const t=i(e);r(e).forEach((e=>t.add(Zm(e))))})),t.visit(t.REM,(e=>{const t=i(e);r(e).forEach((e=>t.rem(e)))}))):(t.visit(t.MOD,(e=>i(e).mod(e))),t.visit(t.ADD,(e=>i(e).add(e))),t.visit(t.REM,(e=>i(e).rem(e)))),t.clean()&&t.runAfter((()=>this.clean())),t}}),jv.Definition={type:"Project",metadata:{generates:!0,changes:!0},params:[{name:"fields",type:"field",array:!0},{name:"as",type:"string",null:!0,array:!0}]},kc(jv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.fields,i=ev(e.fields,e.as||[]),a=r?(e,t)=>function(e,t,n,r){for(let i=0,a=n.length;i<a;++i)t[r[i]]=n[i](e);return t}(e,t,r,i):tg;let o;return this.value?o=this.value:(t=t.addAll(),o=this.value={}),t.visit(t.REM,(e=>{const t=Km(e);n.rem.push(o[t]),o[t]=null})),t.visit(t.ADD,(e=>{const t=a(e,Zm({}));o[Km(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{n.mod.push(a(e,o[Km(e)]))})),n}}),kc(Fv,Cg,{transform(e,t){return this.value=e.value,e.modified("value")?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}}),Tv.Definition={type:"Quantile",metadata:{generates:!0,changes:!0},params:[{name:"groupby",type:"field",array:!0},{name:"field",type:"field",required:!0},{name:"probs",type:"number",array:!0},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:!0,default:["prob","value"]}]};function Nv(e){Cg.call(this,null,e)}function Rv(e){Cg.call(this,[],e),this.count=0}function Pv(e){Cg.call(this,null,e)}function zv(e){Cg.call(this,null,e),this.modified(!0)}function Bv(e){Cg.call(this,null,e)}kc(Tv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=e.as||["prob","value"];if(this.value&&!e.modified()&&!t.changed())return n.source=this.value,n;const i=tv(t.materialize(t.SOURCE).source,e.groupby,e.field),a=(e.groupby||[]).map(vu),o=[],s=e.step||.01,l=e.probs||ed(s/2,1-1e-14,s),u=l.length;return i.forEach((e=>{const t=Ng(e,l);for(let n=0;n<u;++n){const i={};for(let t=0;t<a.length;++t)i[a[t]]=e.dims[t];i[r[0]]=l[n],i[r[1]]=t[n],o.push(Zm(i))}})),this.value&&(n.rem=this.value),this.value=n.add=n.source=o,n}}),kc(Nv,Cg,{transform(e,t){let n,r;return this.value?r=this.value:(n=t=t.addAll(),r=this.value={}),e.derive&&(n=t.fork(t.NO_SOURCE),t.visit(t.REM,(e=>{const t=Km(e);n.rem.push(r[t]),r[t]=null})),t.visit(t.ADD,(e=>{const t=eg(e);r[Km(e)]=t,n.add.push(t)})),t.visit(t.MOD,(e=>{const t=r[Km(e)];for(const r in e)t[r]=e[r],n.modifies(r);n.mod.push(t)}))),n}}),Rv.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]},kc(Rv,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE),r=e.modified("size"),i=e.size,a=this.value.reduce(((e,t)=>(e[Km(t)]=1,e)),{});let o=this.value,s=this.count,l=0;function u(e){let t,r;o.length<i?o.push(e):(r=~~((s+1)*Bg()),r<o.length&&r>=l&&(t=o[r],a[Km(t)]&&n.rem.push(t),o[r]=e)),++s}if(t.rem.length&&(t.visit(t.REM,(e=>{const t=Km(e);a[t]&&(a[t]=-1,n.rem.push(e)),--s})),o=o.filter((e=>-1!==a[Km(e)]))),(t.rem.length||r)&&o.length<i&&t.source&&(l=s=o.length,t.visit(t.SOURCE,(e=>{a[Km(e)]||u(e)})),l=-1),r&&o.length>i){const e=o.length-i;for(let t=0;t<e;++t)a[Km(o[t])]=-1,n.rem.push(o[t]);o=o.slice(e)}return t.mod.length&&t.visit(t.MOD,(e=>{a[Km(e)]&&n.mod.push(e)})),t.add.length&&t.visit(t.ADD,u),(t.add.length||l<0)&&(n.add=o.filter((e=>!a[Km(e)]))),this.count=s,this.value=n.source=o,n}}),Pv.Definition={type:"Sequence",metadata:{generates:!0,changes:!0},params:[{name:"start",type:"number",required:!0},{name:"stop",type:"number",required:!0},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]},kc(Pv,Cg,{transform(e,t){if(this.value&&!e.modified())return;const n=t.materialize().fork(t.MOD),r=e.as||"data";return n.rem=this.value?t.rem.concat(this.value):t.rem,this.value=ed(e.start,e.stop,e.step||1).map((e=>{const t={};return t[r]=e,Zm(t)})),n.add=t.add.concat(this.value),n}}),kc(zv,Cg,{transform(e,t){return this.value=t.source,t.changed()?t.fork(t.NO_SOURCE|t.NO_FIELDS):t.StopPropagation}});const Lv=["unit0","unit1"];function Iv(e){Cg.call(this,wc(),e)}function qv(e){Cg.call(this,null,e)}Bv.Definition={type:"TimeUnit",metadata:{modifies:!0},params:[{name:"field",type:"field",required:!0},{name:"interval",type:"boolean",default:!0},{name:"units",type:"enum",values:ah,array:!0},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:!0},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:!0,length:2,default:Lv}]},kc(Bv,Cg,{transform(e,t){const n=e.field,r=!1!==e.interval,i="utc"===e.timezone,a=this._floor(e,t),o=(i?Nh:Th)(a.unit).offset,s=e.as||Lv,l=s[0],u=s[1],c=a.step;let f=a.start||1/0,d=a.stop||-1/0,h=t.ADD;return(e.modified()||t.modified(bu(n)))&&(h=(t=t.reflow(!0)).SOURCE,f=1/0,d=-1/0),t.visit(h,(e=>{const t=n(e);let i,s;null==t?(e[l]=null,r&&(e[u]=null)):(e[l]=i=s=a(t),r&&(e[u]=s=o(i,c)),i<f&&(f=i),s>d&&(d=s))})),a.start=f,a.stop=d,t.modifies(r?s:l)},_floor(e,t){const n="utc"===e.timezone,{units:r,step:i}=e.units?{units:e.units,step:e.step||1}:np({extent:e.extent||gc(t.materialize(t.SOURCE).source,e.field),maxbins:e.maxbins}),a=sh(r),o=this.value||{},s=(n?Mh:Ah)(a,i);return s.unit=Lu(a),s.units=a,s.step=i,s.start=o.start,s.stop=o.stop,this.value=s}}),kc(Iv,Cg,{transform(e,t){const n=t.dataflow,r=e.field,i=this.value,a=e=>i.set(r(e),e);let o=!0;return e.modified("field")||t.modified(r.fields)?(i.clear(),t.visit(t.SOURCE,a)):t.changed()?(t.visit(t.REM,(e=>i.delete(r(e)))),t.visit(t.ADD,a)):o=!1,this.modified(o),i.empty>n.cleanThreshold&&n.runAfter(i.clean),t.fork()}}),kc(qv,Cg,{transform(e,t){(!this.value||e.modified("field")||e.modified("sort")||t.changed()||e.sort&&t.modified(e.sort.fields))&&(this.value=(e.sort?t.source.slice().sort(rg(e.sort)):t.source).map(e.field))}});const Uv={row_number:function(){return{next:e=>e.index+1}},rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?e=n+1:e}}},dense_rank:function(){let e;return{init:()=>e=1,next:t=>{const n=t.index,r=t.data;return n&&t.compare(r[n-1],r[n])?++e:e}}},percent_rank:function(){const e=Uv.rank(),t=e.next;return{init:e.init,next:e=>(t(e)-1)/(e.data.length-1)}},cume_dist:function(){let e;return{init:()=>e=0,next:t=>{const n=t.data,r=t.compare;let i=t.index;if(e<i){for(;i+1<n.length&&!r(n[i],n[i+1]);)++i;e=i}return(1+e)/n.length}}},ntile:function(e,t){(t=+t)>0||ku("ntile num must be greater than zero.");const n=Uv.cume_dist(),r=n.next;return{init:n.init,next:e=>Math.ceil(t*r(e))}},lag:function(e,t){return t=+t||1,{next:n=>{const r=n.index-t;return r>=0?e(n.data[r]):null}}},lead:function(e,t){return t=+t||1,{next:n=>{const r=n.index+t,i=n.data;return r<i.length?e(i[r]):null}}},first_value:function(e){return{next:t=>e(t.data[t.i0])}},last_value:function(e){return{next:t=>e(t.data[t.i1-1])}},nth_value:function(e,t){return(t=+t)>0||ku("nth_value nth must be greater than zero."),{next:n=>{const r=n.i0+(t-1);return r<n.i1?e(n.data[r]):null}}},prev_value:function(e){let t;return{init:()=>t=null,next:n=>{const r=e(n.data[n.index]);return null!=r?t=r:t}}},next_value:function(e){let t,n;return{init:()=>(t=null,n=-1),next:r=>{const i=r.data;return r.index<=n?t:(n=function(e,t,n){for(let r=t.length;n<r;++n){if(null!=e(t[n]))return n}return-1}(e,i,r.index))<0?(n=i.length,t=null):t=e(i[n])}}}};const Vv=Object.keys(Uv);function Wv(e){const t=ac(e.ops),n=ac(e.fields),r=ac(e.params),i=ac(e.as),a=this.outputs=[],o=this.windows=[],s={},l={},u=[],c=[];let f=!0;function d(e){ac(bu(e)).forEach((e=>s[e]=1))}d(e.sort),t.forEach(((e,t)=>{const s=n[t],h=vu(s),p=$y(e,h,i[t]);if(d(s),a.push(p),bc(Uv,e))o.push(function(e,t,n,r){const i=Uv[e](t,n);return{init:i.init||Au,update:function(e,t){t[r]=i.next(e)}}}(e,n[t],r[t],p));else{if(null==s&&"count"!==e&&ku("Null aggregate field specified."),"count"===e)return void u.push(p);f=!1;let t=l[h];t||(t=l[h]=[],t.field=s,c.push(t)),t.push(My(e,p))}})),(u.length||c.length)&&(this.cell=function(e,t,n){e=e.map((e=>Py(e,e.field)));const r={num:0,agg:null,store:!1,count:t};if(!n)for(var i=e.length,a=r.agg=Array(i),o=0;o<i;++o)a[o]=new e[o](r);if(r.store)var s=r.data=new zy;return r.add=function(e){if(r.num+=1,!n){s&&s.add(e);for(let t=0;t<i;++t)a[t].add(a[t].get(e),e)}},r.rem=function(e){if(r.num-=1,!n){s&&s.rem(e);for(let t=0;t<i;++t)a[t].rem(a[t].get(e),e)}},r.set=function(e){let i,o;for(s&&s.values(),i=0,o=t.length;i<o;++i)e[t[i]]=r.num;if(!n)for(i=0,o=a.length;i<o;++i)a[i].set(e)},r.init=function(){r.num=0,s&&s.reset();for(let e=0;e<i;++e)a[e].init()},r}(c,u,f)),this.inputs=Object.keys(s)}const Hv=Wv.prototype;function Gv(e){Cg.call(this,{},e),this._mlen=0,this._mods=[]}function Xv(e,t,n,r){const i=r.sort,a=i&&!r.ignorePeers,o=r.frame||[null,0],s=e.data(n),l=s.length,u=a?Tf(i):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:i||hc(-1)};t.init();for(let e=0;e<l;++e)Yv(c,o,e,l),a&&Jv(c,u),t.update(c,s[e])}function Yv(e,t,n,r){e.p0=e.i0,e.p1=e.i1,e.i0=null==t[0]?0:Math.max(0,n-Math.abs(t[0])),e.i1=null==t[1]?r:Math.min(r,n+Math.abs(t[1])+1),e.index=n}function Jv(e,t){const n=e.i0,r=e.i1-1,i=e.compare,a=e.data,o=a.length-1;n>0&&!i(a[n],a[n-1])&&(e.i0=t.left(a,a[n])),r<o&&!i(a[r],a[r+1])&&(e.i1=t.right(a,a[r]))}Hv.init=function(){this.windows.forEach((e=>e.init())),this.cell&&this.cell.init()},Hv.update=function(e,t){const n=this.cell,r=this.windows,i=e.data,a=r&&r.length;let o;if(n){for(o=e.p0;o<e.i0;++o)n.rem(i[o]);for(o=e.p1;o<e.i1;++o)n.add(i[o]);n.set(t)}for(o=0;o<a;++o)r[o].update(e,t)},Gv.Definition={type:"Window",metadata:{modifies:!0},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:!0},{name:"ops",type:"enum",array:!0,values:Vv.concat(Cy)},{name:"params",type:"number",null:!0,array:!0},{name:"fields",type:"field",null:!0,array:!0},{name:"as",type:"string",null:!0,array:!0},{name:"frame",type:"number",null:!0,array:!0,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:!1}]},kc(Gv,Cg,{transform(e,t){this.stamp=t.stamp;const n=e.modified(),r=rg(e.sort),i=Sy(e.groupby),a=e=>this.group(i(e));let o=this.state;o&&!n||(o=this.state=new Wv(e)),n||t.modified(o.inputs)?(this.value={},t.visit(t.SOURCE,(e=>a(e).add(e)))):(t.visit(t.REM,(e=>a(e).remove(e))),t.visit(t.ADD,(e=>a(e).add(e))));for(let t=0,n=this._mlen;t<n;++t)Xv(this._mods[t],o,r,e);return this._mlen=0,this._mods=[],t.reflow(n).modifies(o.outputs)},group(e){let t=this.value[e];return t||(t=this.value[e]=qy(Km),t.stamp=-1),t.stamp<this.stamp&&(t.stamp=this.stamp,this._mods[this._mlen++]=t),t}});var Kv=Object.freeze({__proto__:null,aggregate:Ly,bin:Iy,collect:Uy,compare:Vy,countpattern:Hy,cross:Gy,density:Ky,dotbin:nv,expression:rv,extent:av,facet:sv,field:lv,filter:cv,flatten:fv,fold:dv,formula:hv,generate:pv,impute:yv,joinaggregate:vv,kde:bv,key:xv,load:_v,lookup:Ov,multiextent:Sv,multivalues:Ev,params:Dv,pivot:Cv,prefacet:Mv,project:jv,proxy:Fv,quantile:Tv,relay:Nv,sample:Rv,sequence:Pv,sieve:zv,subflow:ov,timeunit:Bv,tupleindex:Iv,values:qv,window:Gv});const Qv=Math.PI,Zv=2*Qv,eb=1e-6,tb=Zv-eb;function nb(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function rb(){return new nb}function ib(e){return function(){return e}}nb.prototype=rb.prototype={constructor:nb,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,r,i){e=+e,t=+t,n=+n,r=+r,i=+i;var a=this._x1,o=this._y1,s=n-e,l=r-t,u=a-e,c=o-t,f=u*u+c*c;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>eb)if(Math.abs(c*s-l*u)>eb&&i){var d=n-a,h=r-o,p=s*s+l*l,m=d*d+h*h,g=Math.sqrt(p),y=Math.sqrt(f),v=i*Math.tan((Qv-Math.acos((p+f-m)/(2*g*y)))/2),b=v/y,x=v/g;Math.abs(b-1)>eb&&(this._+="L"+(e+b*u)+","+(t+b*c)),this._+="A"+i+","+i+",0,0,"+ +(c*d>u*h)+","+(this._x1=e+x*s)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,r,i,a){e=+e,t=+t,a=!!a;var o=(n=+n)*Math.cos(r),s=n*Math.sin(r),l=e+o,u=t+s,c=1^a,f=a?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+u:(Math.abs(this._x1-l)>eb||Math.abs(this._y1-u)>eb)&&(this._+="L"+l+","+u),n&&(f<0&&(f=f%Zv+Zv),f>tb?this._+="A"+n+","+n+",0,1,"+c+","+(e-o)+","+(t-s)+"A"+n+","+n+",0,1,"+c+","+(this._x1=l)+","+(this._y1=u):f>eb&&(this._+="A"+n+","+n+",0,"+ +(f>=Qv)+","+c+","+(this._x1=e+n*Math.cos(i))+","+(this._y1=t+n*Math.sin(i))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var ab=Math.abs,ob=Math.atan2,sb=Math.cos,lb=Math.max,ub=Math.min,cb=Math.sin,fb=Math.sqrt,db=1e-12,hb=Math.PI,pb=hb/2,mb=2*hb;function gb(e){return e>1?0:e<-1?hb:Math.acos(e)}function yb(e){return e>=1?pb:e<=-1?-pb:Math.asin(e)}function vb(e){return e.innerRadius}function bb(e){return e.outerRadius}function xb(e){return e.startAngle}function wb(e){return e.endAngle}function _b(e){return e&&e.padAngle}function kb(e,t,n,r,i,a,o,s){var l=n-e,u=r-t,c=o-i,f=s-a,d=f*l-c*u;if(!(d*d<db))return[e+(d=(c*(t-a)-f*(e-i))/d)*l,t+d*u]}function Ob(e,t,n,r,i,a,o){var s=e-n,l=t-r,u=(o?a:-a)/fb(s*s+l*l),c=u*l,f=-u*s,d=e+c,h=t+f,p=n+c,m=r+f,g=(d+p)/2,y=(h+m)/2,v=p-d,b=m-h,x=v*v+b*b,w=i-a,_=d*m-p*h,k=(b<0?-1:1)*fb(lb(0,w*w*x-_*_)),O=(_*b-v*k)/x,S=(-_*v-b*k)/x,$=(_*b+v*k)/x,E=(-_*v+b*k)/x,A=O-g,D=S-y,C=$-g,M=E-y;return A*A+D*D>C*C+M*M&&(O=$,S=E),{cx:O,cy:S,x01:-c,y01:-f,x11:O*(i/w-1),y11:S*(i/w-1)}}function Sb(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function $b(e){this._context=e}function Eb(e){return new $b(e)}function Ab(e){return e[0]}function Db(e){return e[1]}function Cb(e,t){var n=ib(!0),r=null,i=Eb,a=null;function o(o){var s,l,u,c=(o=Sb(o)).length,f=!1;for(null==r&&(a=i(u=rb())),s=0;s<=c;++s)!(s<c&&n(l=o[s],s,o))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(l,s,o),+t(l,s,o));if(u)return a=null,u+""||null}return e="function"==typeof e?e:void 0===e?Ab:ib(e),t="function"==typeof t?t:void 0===t?Db:ib(t),o.x=function(t){return arguments.length?(e="function"==typeof t?t:ib(+t),o):e},o.y=function(e){return arguments.length?(t="function"==typeof e?e:ib(+e),o):t},o.defined=function(e){return arguments.length?(n="function"==typeof e?e:ib(!!e),o):n},o.curve=function(e){return arguments.length?(i=e,null!=r&&(a=i(r)),o):i},o.context=function(e){return arguments.length?(null==e?r=a=null:a=i(r=e),o):r},o}function Mb(e,t,n){var r=null,i=ib(!0),a=null,o=Eb,s=null;function l(l){var u,c,f,d,h,p=(l=Sb(l)).length,m=!1,g=new Array(p),y=new Array(p);for(null==a&&(s=o(h=rb())),u=0;u<=p;++u){if(!(u<p&&i(d=l[u],u,l))===m)if(m=!m)c=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),f=u-1;f>=c;--f)s.point(g[f],y[f]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(d,u,l),y[u]=+t(d,u,l),s.point(r?+r(d,u,l):g[u],n?+n(d,u,l):y[u]))}if(h)return s=null,h+""||null}function u(){return Cb().defined(i).curve(o).context(a)}return e="function"==typeof e?e:void 0===e?Ab:ib(+e),t="function"==typeof t?t:ib(void 0===t?0:+t),n="function"==typeof n?n:void 0===n?Db:ib(+n),l.x=function(t){return arguments.length?(e="function"==typeof t?t:ib(+t),r=null,l):e},l.x0=function(t){return arguments.length?(e="function"==typeof t?t:ib(+t),l):e},l.x1=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:ib(+e),l):r},l.y=function(e){return arguments.length?(t="function"==typeof e?e:ib(+e),n=null,l):t},l.y0=function(e){return arguments.length?(t="function"==typeof e?e:ib(+e),l):t},l.y1=function(e){return arguments.length?(n=null==e?null:"function"==typeof e?e:ib(+e),l):n},l.lineX0=l.lineY0=function(){return u().x(e).y(t)},l.lineY1=function(){return u().x(e).y(n)},l.lineX1=function(){return u().x(r).y(t)},l.defined=function(e){return arguments.length?(i="function"==typeof e?e:ib(!!e),l):i},l.curve=function(e){return arguments.length?(o=e,null!=a&&(s=o(a)),l):o},l.context=function(e){return arguments.length?(null==e?a=s=null:s=o(a=e),l):a},l}$b.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var jb={draw:function(e,t){var n=Math.sqrt(t/hb);e.moveTo(n,0),e.arc(0,0,n,0,mb)}};function Fb(){}function Tb(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function Nb(e){this._context=e}function Rb(e){this._context=e}function Pb(e){this._context=e}function zb(e,t){this._basis=new Nb(e),this._beta=t}Nb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:Tb(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:Tb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Rb.prototype={areaStart:Fb,areaEnd:Fb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:Tb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},Pb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+e)/6,r=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:Tb(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},zb.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var e=this._x,t=this._y,n=e.length-1;if(n>0)for(var r,i=e[0],a=t[0],o=e[n]-i,s=t[n]-a,l=-1;++l<=n;)r=l/n,this._basis.point(this._beta*e[l]+(1-this._beta)*(i+r*o),this._beta*t[l]+(1-this._beta)*(a+r*s));this._x=this._y=null,this._basis.lineEnd()},point:function(e,t){this._x.push(+e),this._y.push(+t)}};var Bb=function e(t){function n(e){return 1===t?new Nb(e):new zb(e,t)}return n.beta=function(t){return e(+t)},n}(.85);function Lb(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function Ib(e,t){this._context=e,this._k=(1-t)/6}Ib.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:Lb(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:Lb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var qb=function e(t){function n(e){return new Ib(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Ub(e,t){this._context=e,this._k=(1-t)/6}Ub.prototype={areaStart:Fb,areaEnd:Fb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Lb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Vb=function e(t){function n(e){return new Ub(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Wb(e,t){this._context=e,this._k=(1-t)/6}Wb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Lb(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Hb=function e(t){function n(e){return new Wb(e,t)}return n.tension=function(t){return e(+t)},n}(0);function Gb(e,t,n){var r=e._x1,i=e._y1,a=e._x2,o=e._y2;if(e._l01_a>db){var s=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);r=(r*s-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,i=(i*s-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>db){var u=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,c=3*e._l23_a*(e._l23_a+e._l12_a);a=(a*u+e._x1*e._l23_2a-t*e._l12_2a)/c,o=(o*u+e._y1*e._l23_2a-n*e._l12_2a)/c}e._context.bezierCurveTo(r,i,a,o,e._x2,e._y2)}function Xb(e,t){this._context=e,this._alpha=t}Xb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Gb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Yb=function e(t){function n(e){return t?new Xb(e,t):new Ib(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Jb(e,t){this._context=e,this._alpha=t}Jb.prototype={areaStart:Fb,areaEnd:Fb,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=t;break;case 1:this._point=2,this._context.moveTo(this._x4=e,this._y4=t);break;case 2:this._point=3,this._x5=e,this._y5=t;break;default:Gb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Kb=function e(t){function n(e){return t?new Jb(e,t):new Ub(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function Qb(e,t){this._context=e,this._alpha=t}Qb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,r=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Gb(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Zb=function e(t){function n(e){return t?new Qb(e,t):new Wb(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);function ex(e){this._context=e}function tx(e){return e<0?-1:1}function nx(e,t,n){var r=e._x1-e._x0,i=t-e._x1,a=(e._y1-e._y0)/(r||i<0&&-0),o=(n-e._y1)/(i||r<0&&-0),s=(a*i+o*r)/(r+i);return(tx(a)+tx(o))*Math.min(Math.abs(a),Math.abs(o),.5*Math.abs(s))||0}function rx(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function ix(e,t,n){var r=e._x0,i=e._y0,a=e._x1,o=e._y1,s=(a-r)/3;e._context.bezierCurveTo(r+s,i+s*t,a-s,o-s*n,a,o)}function ax(e){this._context=e}function ox(e){this._context=new sx(e)}function sx(e){this._context=e}function lx(e){this._context=e}function ux(e){var t,n,r=e.length-1,i=new Array(r),a=new Array(r),o=new Array(r);for(i[0]=0,a[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)i[t]=1,a[t]=4,o[t]=4*e[t]+2*e[t+1];for(i[r-1]=2,a[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=i[t]/a[t-1],a[t]-=n,o[t]-=n*o[t-1];for(i[r-1]=o[r-1]/a[r-1],t=r-2;t>=0;--t)i[t]=(o[t]-i[t+1])/a[t];for(a[r-1]=(e[r]+i[r-1])/2,t=0;t<r-1;++t)a[t]=2*e[t+1]-i[t+1];return[i,a]}function cx(e,t){this._context=e,this._t=t}function fx(e,t){if("undefined"!=typeof document&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext)return n.width=e,n.height=t,n}return null}ex.prototype={areaStart:Fb,areaEnd:Fb,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},ax.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ix(this,this._t0,rx(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ix(this,rx(this,n=nx(this,e,t)),n);break;default:ix(this,this._t0,n=nx(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(ox.prototype=Object.create(ax.prototype)).point=function(e,t){ax.prototype.point.call(this,t,e)},sx.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,a){this._context.bezierCurveTo(t,e,r,n,a,i)}},lx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var r=ux(e),i=ux(t),a=0,o=1;o<n;++a,++o)this._context.bezierCurveTo(r[0][a],i[0][a],r[1][a],i[1][a],e[o],t[o]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},cx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};const dx=()=>"undefined"!=typeof Image?Image:null;function hx(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function px(e,t){switch(arguments.length){case 0:break;case 1:"function"==typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"==typeof t?this.interpolator(t):this.range(t)}return this}const mx=Symbol("implicit");function gx(){var e=new Map,t=[],n=[],r=mx;function i(i){var a=i+"",o=e.get(a);if(!o){if(r!==mx)return r;e.set(a,o=t.push(i))}return n[(o-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=new Map;for(const r of n){const n=r+"";e.has(n)||e.set(n,t.push(r))}return i},i.range=function(e){return arguments.length?(n=Array.from(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return gx(t,n).unknown(r)},hx.apply(i,arguments),i}function yx(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function vx(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function bx(){}var xx=.7,wx=1/xx,_x="\\s*([+-]?\\d+)\\s*",kx="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ox="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sx=/^#([0-9a-f]{3,8})$/,$x=new RegExp("^rgb\\("+[_x,_x,_x]+"\\)$"),Ex=new RegExp("^rgb\\("+[Ox,Ox,Ox]+"\\)$"),Ax=new RegExp("^rgba\\("+[_x,_x,_x,kx]+"\\)$"),Dx=new RegExp("^rgba\\("+[Ox,Ox,Ox,kx]+"\\)$"),Cx=new RegExp("^hsl\\("+[kx,Ox,Ox]+"\\)$"),Mx=new RegExp("^hsla\\("+[kx,Ox,Ox,kx]+"\\)$"),jx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Fx(){return this.rgb().formatHex()}function Tx(){return this.rgb().formatRgb()}function Nx(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Sx.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Rx(t):3===n?new Lx(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?Px(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?Px(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=$x.exec(e))?new Lx(t[1],t[2],t[3],1):(t=Ex.exec(e))?new Lx(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Ax.exec(e))?Px(t[1],t[2],t[3],t[4]):(t=Dx.exec(e))?Px(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Cx.exec(e))?Vx(t[1],t[2]/100,t[3]/100,1):(t=Mx.exec(e))?Vx(t[1],t[2]/100,t[3]/100,t[4]):jx.hasOwnProperty(e)?Rx(jx[e]):"transparent"===e?new Lx(NaN,NaN,NaN,0):null}function Rx(e){return new Lx(e>>16&255,e>>8&255,255&e,1)}function Px(e,t,n,r){return r<=0&&(e=t=n=NaN),new Lx(e,t,n,r)}function zx(e){return e instanceof bx||(e=Nx(e)),e?new Lx((e=e.rgb()).r,e.g,e.b,e.opacity):new Lx}function Bx(e,t,n,r){return 1===arguments.length?zx(e):new Lx(e,t,n,null==r?1:r)}function Lx(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function Ix(){return"#"+Ux(this.r)+Ux(this.g)+Ux(this.b)}function qx(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function Ux(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function Vx(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Gx(e,t,n,r)}function Wx(e){if(e instanceof Gx)return new Gx(e.h,e.s,e.l,e.opacity);if(e instanceof bx||(e=Nx(e)),!e)return new Gx;if(e instanceof Gx)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Gx(o,s,l,e.opacity)}function Hx(e,t,n,r){return 1===arguments.length?Wx(e):new Gx(e,t,n,null==r?1:r)}function Gx(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Xx(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}yx(bx,Nx,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:Fx,formatHex:Fx,formatHsl:function(){return Wx(this).formatHsl()},formatRgb:Tx,toString:Tx}),yx(Lx,Bx,vx(bx,{brighter:function(e){return e=null==e?wx:Math.pow(wx,e),new Lx(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?xx:Math.pow(xx,e),new Lx(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ix,formatHex:Ix,formatRgb:qx,toString:qx})),yx(Gx,Hx,vx(bx,{brighter:function(e){return e=null==e?wx:Math.pow(wx,e),new Gx(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?xx:Math.pow(xx,e),new Gx(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Lx(Xx(e>=240?e-240:e+120,i,r),Xx(e,i,r),Xx(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}));const Yx=Math.PI/180,Jx=180/Math.PI,Kx=.96422,Qx=.82521,Zx=4/29,ew=6/29,tw=3*ew*ew;function nw(e){if(e instanceof iw)return new iw(e.l,e.a,e.b,e.opacity);if(e instanceof fw)return dw(e);e instanceof Lx||(e=zx(e));var t,n,r=lw(e.r),i=lw(e.g),a=lw(e.b),o=aw((.2225045*r+.7168786*i+.0606169*a)/1);return r===i&&i===a?t=n=o:(t=aw((.4360747*r+.3850649*i+.1430804*a)/Kx),n=aw((.0139322*r+.0971045*i+.7141733*a)/Qx)),new iw(116*o-16,500*(t-o),200*(o-n),e.opacity)}function rw(e,t,n,r){return 1===arguments.length?nw(e):new iw(e,t,n,null==r?1:r)}function iw(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function aw(e){return e>.008856451679035631?Math.pow(e,1/3):e/tw+Zx}function ow(e){return e>ew?e*e*e:tw*(e-Zx)}function sw(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function lw(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function uw(e){if(e instanceof fw)return new fw(e.h,e.c,e.l,e.opacity);if(e instanceof iw||(e=nw(e)),0===e.a&&0===e.b)return new fw(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Jx;return new fw(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function cw(e,t,n,r){return 1===arguments.length?uw(e):new fw(e,t,n,null==r?1:r)}function fw(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function dw(e){if(isNaN(e.h))return new iw(e.l,0,0,e.opacity);var t=e.h*Yx;return new iw(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}yx(iw,rw,vx(bx,{brighter:function(e){return new iw(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new iw(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new Lx(sw(3.1338561*(t=Kx*ow(t))-1.6168667*(e=1*ow(e))-.4906146*(n=Qx*ow(n))),sw(-.9787684*t+1.9161415*e+.033454*n),sw(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),yx(fw,cw,vx(bx,{brighter:function(e){return new fw(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new fw(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return dw(this).rgb()}}));var hw=-.14861,pw=1.78277,mw=-.29227,gw=-.90649,yw=1.97294,vw=yw*gw,bw=yw*pw,xw=pw*mw-gw*hw;function ww(e){if(e instanceof kw)return new kw(e.h,e.s,e.l,e.opacity);e instanceof Lx||(e=zx(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(xw*r+vw*t-bw*n)/(xw+vw-bw),a=r-i,o=(yw*(n-i)-mw*a)/gw,s=Math.sqrt(o*o+a*a)/(yw*i*(1-i)),l=s?Math.atan2(o,a)*Jx-120:NaN;return new kw(l<0?l+360:l,s,i,e.opacity)}function _w(e,t,n,r){return 1===arguments.length?ww(e):new kw(e,t,n,null==r?1:r)}function kw(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Ow(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function Sw(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return Ow((n-r/t)*t,o,i,a,s)}}function $w(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return Ow((n-r/t)*t,i,a,o,s)}}yx(kw,_w,vx(bx,{brighter:function(e){return e=null==e?wx:Math.pow(wx,e),new kw(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?xx:Math.pow(xx,e),new kw(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Yx,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new Lx(255*(t+n*(hw*r+pw*i)),255*(t+n*(mw*r+gw*i)),255*(t+n*(yw*r)),this.opacity)}}));var Ew=e=>()=>e;function Aw(e,t){return function(n){return e+n*t}}function Dw(e,t){var n=t-e;return n?Aw(e,n>180||n<-180?n-360*Math.round(n/360):n):Ew(isNaN(e)?t:e)}function Cw(e){return 1==(e=+e)?Mw:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Ew(isNaN(t)?n:t)}}function Mw(e,t){var n=t-e;return n?Aw(e,n):Ew(isNaN(e)?t:e)}var jw=function e(t){var n=Cw(t);function r(e,t){var r=n((e=Bx(e)).r,(t=Bx(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=Mw(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function Fw(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=Bx(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}var Tw=Fw(Sw),Nw=Fw($w);function Rw(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Pw(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function zw(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Ww(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function Bw(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Lw(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Iw(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Ww(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var qw=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Uw=new RegExp(qw.source,"g");function Vw(e,t){var n,r,i,a=qw.lastIndex=Uw.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=qw.exec(e))&&(r=Uw.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:Lw(n,r)})),a=Uw.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Ww(e,t){var n,r=typeof t;return null==t||"boolean"===r?Ew(t):("number"===r?Lw:"string"===r?(n=Nx(t))?(t=n,jw):Vw:t instanceof Nx?jw:t instanceof Date?Bw:Pw(t)?Rw:Array.isArray(t)?zw:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Iw:Lw)(e,t)}function Hw(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Gw,Xw=180/Math.PI,Yw={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Jw(e,t,n,r,i,a){var o,s,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,l/=s),e*r<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(t,e)*Xw,skewX:Math.atan(l)*Xw,scaleX:o,scaleY:s}}function Kw(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],l=[];return a=e(a),o=e(o),function(e,r,i,a,o,s){if(e!==i||r!==a){var l=o.push("translate(",null,t,null,n);s.push({i:l-4,x:Lw(e,i)},{i:l-2,x:Lw(r,a)})}else(i||a)&&o.push("translate("+i+t+a+n)}(a.translateX,a.translateY,o.translateX,o.translateY,s,l),function(e,t,n,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Lw(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(a.rotate,o.rotate,s,l),function(e,t,n,a){e!==t?a.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Lw(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(a.skewX,o.skewX,s,l),function(e,t,n,r,a,o){if(e!==n||t!==r){var s=a.push(i(a)+"scale(",null,",",null,")");o.push({i:s-4,x:Lw(e,n)},{i:s-2,x:Lw(t,r)})}else 1===n&&1===r||a.push(i(a)+"scale("+n+","+r+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,l),a=o=null,function(e){for(var t,n=-1,r=l.length;++n<r;)s[(t=l[n]).i]=t.x(e);return s.join("")}}}var Qw=Kw((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Yw:Jw(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),Zw=Kw((function(e){return null==e?Yw:(Gw||(Gw=document.createElementNS("http://www.w3.org/2000/svg","g")),Gw.setAttribute("transform",e),(e=Gw.transform.baseVal.consolidate())?Jw((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Yw)}),", ",")",")");function e_(e){return((e=Math.exp(e))+1/e)/2}var t_=function e(t,n,r){function i(e,i){var a,o,s=e[0],l=e[1],u=e[2],c=i[0],f=i[1],d=i[2],h=c-s,p=f-l,m=h*h+p*p;if(m<1e-12)o=Math.log(d/u)/t,a=function(e){return[s+e*h,l+e*p,u*Math.exp(t*e*o)]};else{var g=Math.sqrt(m),y=(d*d-u*u+r*m)/(2*u*n*g),v=(d*d-u*u-r*m)/(2*d*n*g),b=Math.log(Math.sqrt(y*y+1)-y),x=Math.log(Math.sqrt(v*v+1)-v);o=(x-b)/t,a=function(e){var r=e*o,i=e_(b),a=u/(n*g)*(i*function(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*r+b)-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+a*h,l+a*p,u*i/e_(t*r+b)]}}return a.duration=1e3*o*t/Math.SQRT2,a}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function n_(e){return function(t,n){var r=e((t=Hx(t)).h,(n=Hx(n)).h),i=Mw(t.s,n.s),a=Mw(t.l,n.l),o=Mw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.s=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var r_=n_(Dw),i_=n_(Mw);function a_(e){return function(t,n){var r=e((t=cw(t)).h,(n=cw(n)).h),i=Mw(t.c,n.c),a=Mw(t.l,n.l),o=Mw(t.opacity,n.opacity);return function(e){return t.h=r(e),t.c=i(e),t.l=a(e),t.opacity=o(e),t+""}}}var o_=a_(Dw),s_=a_(Mw);function l_(e){return function t(n){function r(t,r){var i=e((t=_w(t)).h,(r=_w(r)).h),a=Mw(t.s,r.s),o=Mw(t.l,r.l),s=Mw(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=a(e),t.l=o(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}var u_=l_(Dw),c_=l_(Mw);function f_(e,t){void 0===t&&(t=e,e=Ww);for(var n=0,r=t.length-1,i=t[0],a=new Array(r<0?0:r);n<r;)a[n]=e(i,i=t[++n]);return function(e){var t=Math.max(0,Math.min(r-1,Math.floor(e*=r)));return a[t](e-t)}}var d_=Object.freeze({__proto__:null,interpolate:Ww,interpolateArray:function(e,t){return(Pw(t)?Rw:zw)(e,t)},interpolateBasis:Sw,interpolateBasisClosed:$w,interpolateDate:Bw,interpolateDiscrete:function(e){var t=e.length;return function(n){return e[Math.max(0,Math.min(t-1,Math.floor(n*t)))]}},interpolateHue:function(e,t){var n=Dw(+e,+t);return function(e){var t=n(e);return t-360*Math.floor(t/360)}},interpolateNumber:Lw,interpolateNumberArray:Rw,interpolateObject:Iw,interpolateRound:Hw,interpolateString:Vw,interpolateTransformCss:Qw,interpolateTransformSvg:Zw,interpolateZoom:t_,interpolateRgb:jw,interpolateRgbBasis:Tw,interpolateRgbBasisClosed:Nw,interpolateHsl:r_,interpolateHslLong:i_,interpolateLab:function(e,t){var n=Mw((e=rw(e)).l,(t=rw(t)).l),r=Mw(e.a,t.a),i=Mw(e.b,t.b),a=Mw(e.opacity,t.opacity);return function(t){return e.l=n(t),e.a=r(t),e.b=i(t),e.opacity=a(t),e+""}},interpolateHcl:o_,interpolateHclLong:s_,interpolateCubehelix:u_,interpolateCubehelixLong:c_,piecewise:f_,quantize:function(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}});function h_(e){return+e}var p_=[0,1];function m_(e){return e}function g_(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function y_(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=g_(i,r),a=n(o,a)):(r=g_(r,i),a=n(a,o)),function(e){return a(r(e))}}function v_(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=g_(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=Pf(e,t,1,r)-1;return a[n](i[n](t))}}function b_(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function x_(){var e,t,n,r,i,a,o=p_,s=p_,l=Ww,u=m_;function c(){var e=Math.min(o.length,s.length);return u!==m_&&(u=function(e,t){var n;return e>t&&(n=e,e=t,t=n),function(n){return Math.max(e,Math.min(t,n))}}(o[0],o[e-1])),r=e>2?v_:y_,i=a=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(u(t)))}return f.invert=function(n){return u(t((a||(a=r(s,o.map(e),Lw)))(n)))},f.domain=function(e){return arguments.length?(o=Array.from(e,h_),c()):o.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),c()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),l=Hw,c()},f.clamp=function(e){return arguments.length?(u=!!e||m_,c()):u!==m_},f.interpolate=function(e){return arguments.length?(l=e,c()):l},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function w_(){return x_()(m_,m_)}function __(e,t,n,r){var i,a=Wf(e,t,n);switch((r=od(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=vd(a,o))||(r.precision=i),hd(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=bd(a,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=yd(a))||(r.precision=i-2*("%"===r.type))}return dd(r)}function k_(e){var t=e.domain;return e.ticks=function(e){var n=t();return Uf(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return __(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,a=t(),o=0,s=a.length-1,l=a[o],u=a[s],c=10;for(u<l&&(i=l,l=u,u=i,i=o,o=s,s=i);c-- >0;){if((i=Vf(l,u,n))===r)return a[o]=l,a[s]=u,t(a);if(i>0)l=Math.floor(l/i)*i,u=Math.ceil(u/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,u=Math.floor(u*i)/i}r=i}return e},e}function O_(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}function S_(e){return Math.log(e)}function $_(e){return Math.exp(e)}function E_(e){return-Math.log(-e)}function A_(e){return-Math.exp(-e)}function D_(e){return isFinite(e)?+("1e"+e):e<0?0:e}function C_(e){return function(t){return-e(-t)}}function M_(e){var t,n,r=e(S_,$_),i=r.domain,a=10;function o(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(a),n=function(e){return 10===e?D_:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(a),i()[0]<0?(t=C_(t),n=C_(n),e(E_,A_)):e(S_,$_),r}return r.base=function(e){return arguments.length?(a=+e,o()):a},r.domain=function(e){return arguments.length?(i(e),o()):i()},r.ticks=function(e){var r,o=i(),s=o[0],l=o[o.length-1];(r=l<s)&&(d=s,s=l,l=d);var u,c,f,d=t(s),h=t(l),p=null==e?10:+e,m=[];if(!(a%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),s>0){for(;d<=h;++d)for(c=1,u=n(d);c<a;++c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}}else for(;d<=h;++d)for(c=a-1,u=n(d);c>=1;--c)if(!((f=u*c)<s)){if(f>l)break;m.push(f)}2*m.length<p&&(m=Uf(s,l,p))}else m=Uf(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(e,i){if(null==i&&(i=10===a?".0e":","),"function"!=typeof i&&(i=dd(i)),e===1/0)return i;null==e&&(e=10);var o=Math.max(1,a*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*a<a-.5&&(r*=a),r<=o?i(e):""}},r.nice=function(){return i(O_(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function j_(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function F_(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function T_(e){var t=1,n=e(j_(t),F_(t));return n.constant=function(n){return arguments.length?e(j_(t=+n),F_(t)):t},k_(n)}function N_(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function R_(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function P_(e){return e<0?-e*e:e*e}function z_(e){var t=e(m_,m_),n=1;function r(){return 1===n?e(m_,m_):.5===n?e(R_,P_):e(N_(n),N_(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},k_(t)}function B_(){var e=z_(x_());return e.copy=function(){return b_(e,B_()).exponent(e.exponent())},hx.apply(e,arguments),e}var L_=1e3,I_=6e4,q_=36e5,U_=864e5,V_=2592e6,W_=31536e6;function H_(e){return new Date(e)}function G_(e){return e instanceof Date?+e:+new Date(+e)}function X_(e,t,n,r,i,a,o,s,l){var u=w_(),c=u.invert,f=u.domain,d=l(".%L"),h=l(":%S"),p=l("%I:%M"),m=l("%I %p"),g=l("%a %d"),y=l("%b %d"),v=l("%B"),b=l("%Y"),x=[[o,1,L_],[o,5,5e3],[o,15,15e3],[o,30,3e4],[a,1,I_],[a,5,3e5],[a,15,9e5],[a,30,18e5],[i,1,q_],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,U_],[r,2,1728e5],[n,1,6048e5],[t,1,V_],[t,3,7776e6],[e,1,W_]];function w(s){return(o(s)<s?d:a(s)<s?h:i(s)<s?p:r(s)<s?m:t(s)<s?n(s)<s?g:y:e(s)<s?v:b)(s)}function _(t,n,r){if(null==t&&(t=10),"number"==typeof t){var i,a=Math.abs(r-n)/t,o=Tf((function(e){return e[2]})).right(x,a);return o===x.length?(i=Wf(n/W_,r/W_,t),t=e):o?(i=(o=x[a/x[o-1][2]<x[o][2]/a?o-1:o])[1],t=o[0]):(i=Math.max(Wf(n,r,t),1),t=s),t.every(i)}return t}return u.invert=function(e){return new Date(c(e))},u.domain=function(e){return arguments.length?f(Array.from(e,G_)):f().map(H_)},u.ticks=function(e){var t,n=f(),r=n[0],i=n[n.length-1],a=i<r;return a&&(t=r,r=i,i=t),t=(t=_(e,r,i))?t.range(r,i+1):[],a?t.reverse():t},u.tickFormat=function(e,t){return null==t?w:l(t)},u.nice=function(e){var t=f();return(e=_(e,t[0],t[t.length-1]))?f(O_(t,e)):u},u.copy=function(){return b_(u,X_(e,t,n,r,i,a,o,s,l))},u}function Y_(){var e,t,n,r,i,a=0,o=1,s=m_,l=!1;function u(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,l?Math.max(0,Math.min(1,t)):t))}function c(e){return function(t){var n,r;return arguments.length?([n,r]=t,s=e(n,r),u):[s(0),s(1)]}}return u.domain=function(i){return arguments.length?([a,o]=i,e=r(a=+a),t=r(o=+o),n=e===t?0:1/(t-e),u):[a,o]},u.clamp=function(e){return arguments.length?(l=!!e,u):l},u.interpolator=function(e){return arguments.length?(s=e,u):s},u.range=c(Ww),u.rangeRound=c(Hw),u.unknown=function(e){return arguments.length?(i=e,u):i},function(i){return r=i,e=i(a),t=i(o),n=e===t?0:1/(t-e),u}}function J_(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function K_(){var e=k_(Y_()(m_));return e.copy=function(){return J_(e,K_())},px.apply(e,arguments)}function Q_(){var e=z_(Y_());return e.copy=function(){return J_(e,Q_()).exponent(e.exponent())},px.apply(e,arguments)}function Z_(){var e,t,n,r,i,a,o,s=0,l=.5,u=1,c=1,f=m_,d=!1;function h(e){return isNaN(e=+e)?o:(e=.5+((e=+a(e))-t)*(c*e<c*t?r:i),f(d?Math.max(0,Math.min(1,e)):e))}function p(e){return function(t){var n,r,i;return arguments.length?([n,r,i]=t,f=f_(e,[n,r,i]),h):[f(0),f(.5),f(1)]}}return h.domain=function(o){return arguments.length?([s,l,u]=o,e=a(s=+s),t=a(l=+l),n=a(u=+u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h):[s,l,u]},h.clamp=function(e){return arguments.length?(d=!!e,h):d},h.interpolator=function(e){return arguments.length?(f=e,h):f},h.range=p(Ww),h.rangeRound=p(Hw),h.unknown=function(e){return arguments.length?(o=e,h):o},function(o){return a=o,e=o(s),t=o(l),n=o(u),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),c=t<e?-1:1,h}}function ek(){var e=z_(Z_());return e.copy=function(){return J_(e,ek()).exponent(e.exponent())},px.apply(e,arguments)}function tk(e,t,n){const r=e-t+2*n;return e?r>0?r:1:0}const nk="linear",rk="log",ik="pow",ak="sqrt",ok="symlog",sk="time",lk="utc",uk="sequential",ck="diverging",fk="quantile",dk="quantize",hk="threshold",pk="ordinal",mk="point",gk="band",yk="bin-ordinal",vk="continuous",bk="discrete",xk="discretizing",wk="interpolating",_k="temporal";function kk(){const e=gx().unknown(void 0),t=e.domain,n=e.range;let r,i,a=[0,1],o=!1,s=0,l=0,u=.5;function c(){const e=t().length,c=a[1]<a[0],f=a[1-c],d=tk(e,s,l);let h=a[c-0];r=(f-h)/(d||1),o&&(r=Math.floor(r)),h+=(f-h-r*(e-s))*u,i=r*(1-s),o&&(h=Math.round(h),i=Math.round(i));const p=ed(e).map((e=>h+r*e));return n(c?p.reverse():p)}return delete e.unknown,e.domain=function(e){return arguments.length?(t(e),c()):t()},e.range=function(e){return arguments.length?(a=[+e[0],+e[1]],c()):a.slice()},e.rangeRound=function(e){return a=[+e[0],+e[1]],o=!0,c()},e.bandwidth=function(){return i},e.step=function(){return r},e.round=function(e){return arguments.length?(o=!!e,c()):o},e.padding=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),s=l,c()):s},e.paddingInner=function(e){return arguments.length?(s=Math.max(0,Math.min(1,e)),c()):s},e.paddingOuter=function(e){return arguments.length?(l=Math.max(0,Math.min(1,e)),c()):l},e.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),c()):u},e.invertRange=function(e){if(null==e[0]||null==e[1])return;const r=a[1]<a[0],o=r?n().reverse():n(),s=o.length-1;let l,u,c,f=+e[0],d=+e[1];return f!=f||d!=d||(d<f&&(c=f,f=d,d=c),d<o[0]||f>a[1-r])?void 0:(l=Math.max(0,Pf(o,f)-1),u=f===d?l:Pf(o,d)-1,f-o[l]>i+1e-10&&++l,r&&(c=l,l=s-u,u=s-c),l>u?void 0:t().slice(l,u+1))},e.invert=function(t){const n=e.invertRange([t,t]);return n?n[0]:n},e.copy=function(){return kk().domain(t()).range(a).round(o).paddingInner(s).paddingOuter(l).align(u)},c()}function Ok(e){const t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,e.copy=function(){return Ok(t())},e}var Sk=Array.prototype.map;function $k(e){return Sk.call(e,Iu)}const Ek=Array.prototype.slice;const Ak={};function Dk(e,t,n){const r=function(){const n=t();return n.invertRange||(n.invertRange=n.invert?function(e){return function(t){let n,r=t[0],i=t[1];return i<r&&(n=r,r=i,i=n),[e.invert(r),e.invert(i)]}}(n):n.invertExtent?function(e){return function(t){const n=e.range();let r,i,a,o,s=t[0],l=t[1],u=-1;for(l<s&&(i=s,s=l,l=i),a=0,o=n.length;a<o;++a)n[a]>=s&&n[a]<=l&&(u<0&&(u=a),r=a);if(!(u<0))return s=e.invertExtent(n[u]),l=e.invertExtent(n[r]),[void 0===s[0]?s[1]:s[0],void 0===l[1]?l[0]:l[1]]}}(n):void 0),n.type=e,n};return r.metadata=Uc(ac(n)),r}function Ck(e,t,n){return arguments.length>1?(Ak[e]=Dk(e,t,n),this):Mk(e)?Ak[e]:void 0}function Mk(e){return bc(Ak,e)}function jk(e,t){const n=Ak[e];return n&&n.metadata[t]}function Fk(e){return jk(e,vk)}function Tk(e){return jk(e,bk)}function Nk(e){return jk(e,xk)}function Rk(e){return jk(e,rk)}function Pk(e){return jk(e,wk)}function zk(e){return jk(e,fk)}Ck("identity",(function e(t){var n;function r(e){return isNaN(e=+e)?n:e}return r.invert=r,r.domain=r.range=function(e){return arguments.length?(t=Array.from(e,h_),r):t.slice()},r.unknown=function(e){return arguments.length?(n=e,r):n},r.copy=function(){return e(t).unknown(n)},t=arguments.length?Array.from(t,h_):[0,1],k_(r)})),Ck(nk,(function e(){var t=w_();return t.copy=function(){return b_(t,e())},hx.apply(t,arguments),k_(t)}),vk),Ck(rk,(function e(){var t=M_(x_()).domain([1,10]);return t.copy=function(){return b_(t,e()).base(t.base())},hx.apply(t,arguments),t}),[vk,rk]),Ck(ik,B_,vk),Ck(ak,(function(){return B_.apply(null,arguments).exponent(.5)}),vk),Ck(ok,(function e(){var t=T_(x_());return t.copy=function(){return b_(t,e()).constant(t.constant())},hx.apply(t,arguments)}),vk),Ck(sk,(function(){return hx.apply(X_(zd,Pd,Td,jd,Md,Cd,Dd,kd,lp).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}),[vk,_k]),Ck(lk,(function(){return hx.apply(X_(Gd,Hd,Ud,Id,Ld,Bd,Dd,kd,cp).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}),[vk,_k]),Ck(uk,K_,[vk,wk]),Ck("".concat(uk,"-").concat(nk),K_,[vk,wk]),Ck("".concat(uk,"-").concat(rk),(function e(){var t=M_(Y_()).domain([1,10]);return t.copy=function(){return J_(t,e()).base(t.base())},px.apply(t,arguments)}),[vk,wk,rk]),Ck("".concat(uk,"-").concat(ik),Q_,[vk,wk]),Ck("".concat(uk,"-").concat(ak),(function(){return Q_.apply(null,arguments).exponent(.5)}),[vk,wk]),Ck("".concat(uk,"-").concat(ok),(function e(){var t=T_(Y_());return t.copy=function(){return J_(t,e()).constant(t.constant())},px.apply(t,arguments)}),[vk,wk]),Ck("".concat(ck,"-").concat(nk),(function e(){var t=k_(Z_()(m_));return t.copy=function(){return J_(t,e())},px.apply(t,arguments)}),[vk,wk]),Ck("".concat(ck,"-").concat(rk),(function e(){var t=M_(Z_()).domain([.1,1,10]);return t.copy=function(){return J_(t,e()).base(t.base())},px.apply(t,arguments)}),[vk,wk,rk]),Ck("".concat(ck,"-").concat(ik),ek,[vk,wk]),Ck("".concat(ck,"-").concat(ak),(function(){return ek.apply(null,arguments).exponent(.5)}),[vk,wk]),Ck("".concat(ck,"-").concat(ok),(function e(){var t=T_(Z_());return t.copy=function(){return J_(t,e()).constant(t.constant())},px.apply(t,arguments)}),[vk,wk]),Ck(fk,(function e(){var t,n=[],r=[],i=[];function a(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=Kf(n,e/t);return o}function o(e){return isNaN(e=+e)?t:r[Pf(i,e)]}return o.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},o.domain=function(e){if(!arguments.length)return n.slice();n=[];for(let t of e)null==t||isNaN(t=+t)||n.push(t);return n.sort(Ff),a()},o.range=function(e){return arguments.length?(r=Array.from(e),a()):r.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return i.slice()},o.copy=function(){return e().domain(n).range(r).unknown(t)},hx.apply(o,arguments)}),[xk,fk]),Ck(dk,(function e(){var t,n=0,r=1,i=1,a=[.5],o=[0,1];function s(e){return e<=e?o[Pf(a,e,0,i)]:t}function l(){var e=-1;for(a=new Array(i);++e<i;)a[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?([n,r]=e,n=+n,r=+r,l()):[n,r]},s.range=function(e){return arguments.length?(i=(o=Array.from(e)).length-1,l()):o.slice()},s.invertExtent=function(e){var t=o.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,a[0]]:t>=i?[a[i-1],r]:[a[t-1],a[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return a.slice()},s.copy=function(){return e().domain([n,r]).range(o).unknown(t)},hx.apply(k_(s),arguments)}),xk),Ck(hk,(function e(){var t,n=[.5],r=[0,1],i=1;function a(e){return e<=e?r[Pf(n,e,0,i)]:t}return a.domain=function(e){return arguments.length?(n=Array.from(e),i=Math.min(n.length,r.length-1),a):n.slice()},a.range=function(e){return arguments.length?(r=Array.from(e),i=Math.min(n.length,r.length-1),a):r.slice()},a.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},a.unknown=function(e){return arguments.length?(t=e,a):t},a.copy=function(){return e().domain(n).range(r).unknown(t)},hx.apply(a,arguments)}),xk),Ck(yk,(function e(){let t=[],n=[];function r(e){return null==e||e!=e?void 0:n[(Pf(t,e)-1)%n.length]}return r.domain=function(e){return arguments.length?(t=$k(e),r):t.slice()},r.range=function(e){return arguments.length?(n=Ek.call(e),r):n.slice()},r.tickFormat=function(e,n){return __(t[0],Lu(t),null==e?10:e,n)},r.copy=function(){return e().domain(r.domain()).range(r.range())},r}),[bk,xk]),Ck(pk,gx,bk),Ck(gk,kk,bk),Ck(mk,(function(){return Ok(kk().paddingInner(1))}),bk);const Bk=["clamp","base","constant","exponent"];function Lk(e,t){const n=t[0],r=Lu(t)-n;return function(t){return e(n+t*r)}}function Ik(e,t,n){return f_(Vk(t||"rgb",n),e)}function qk(e,t){const n=new Array(t),r=t+1;for(let i=0;i<t;)n[i]=e(++i/r);return n}function Uk(e,t,n){const r=n-t;let i,a,o;return r&&Number.isFinite(r)?(i=(a=e.type).indexOf("-"),a=i<0?a:a.slice(i+1),o=Ck(a)().domain([t,n]).range([0,1]),Bk.forEach((t=>e[t]?o[t](e[t]()):0)),o):hc(.5)}function Vk(e,t){const n=d_[function(e){return"interpolate"+e.toLowerCase().split("-").map((e=>e[0].toUpperCase()+e.slice(1))).join("")}(e)];return null!=t&&n&&n.gamma?n.gamma(t):n}function Wk(e){const t=e.length/6|0,n=new Array(t);for(let r=0;r<t;)n[r]="#"+e.slice(6*r,6*++r);return n}function Hk(e,t){for(const n in e)Xk(n,t(e[n]))}const Gk={};function Xk(e,t){return e=e&&e.toLowerCase(),arguments.length>1?(Gk[e]=t,this):Gk[e]}Hk({category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"},Wk),Hk({blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"},(e=>Ik(Wk(e))));const Yk="symbol",Jk=e=>Tu(e)?e.map((e=>String(e))):String(e),Kk=(e,t)=>e[1]-t[1],Qk=(e,t)=>t[1]-e[1];function Zk(e,t,n){let r;return Ac(t)&&(e.bins&&(t=Math.max(t,e.bins.length)),null!=n&&(t=Math.min(t,Math.floor(Pc(e.domain())/n||1)))),Nu(t)&&(r=t.step,t=t.interval),Cc(t)&&(t=e.type===sk?Th(t):e.type==lk?Nh(t):ku("Only time and utc scales accept interval strings."),r&&(t=t.every(r))),t}function eO(e,t,n){let r=e.range(),i=r[0],a=Lu(r),o=Kk;if(i>a&&(r=a,a=i,i=r,o=Qk),i=Math.floor(i),a=Math.ceil(a),t=t.map((t=>[t,e(t)])).filter((e=>i<=e[1]&&e[1]<=a)).sort(o).map((e=>e[0])),n>0&&t.length>1){const e=[t[0],Lu(t)];for(;t.length>n&&t.length>=3;)t=t.filter(((e,t)=>!(t%2)));t.length<3&&(t=e)}return t}function tO(e,t){return e.bins?eO(e,e.bins):e.ticks?e.ticks(t):e.domain()}function nO(e,t,n,r,i,a){const o=t.type;let s=Jk;if(o===sk||i===sk)s=e.timeFormat(r);else if(o===lk||i===lk)s=e.utcFormat(r);else if(Rk(o)){const i=e.formatFloat(r);if(a||t.bins)s=i;else{const e=rO(t,n,!1);s=t=>e(t)?i(t):""}}else if(t.tickFormat){const i=t.domain();s=e.formatSpan(i[0],i[i.length-1],n,r)}else r&&(s=e.format(r));return s}function rO(e,t,n){const r=tO(e,t),i=e.base(),a=Math.log(i),o=Math.max(1,i*t/r.length),s=e=>{let t=e/Math.pow(i,Math.round(Math.log(e)/a));return t*i<i-.5&&(t*=i),t<=o};return n?r.filter(s):s}const iO={[fk]:"quantiles",[dk]:"thresholds",[hk]:"domain"},aO={[fk]:"quantiles",[dk]:"domain"};function oO(e,t){return e.bins?function(e){const t=e.slice(0,-1);return t.max=Lu(e),t}(e.bins):e.type===rk?rO(e,t,!0):iO[e.type]?function(e){const t=[-1/0].concat(e);return t.max=1/0,t}(e[iO[e.type]]()):tO(e,t)}function sO(e,t,n,r,i,a,o){const s=aO[t.type]&&a!==sk&&a!==lk?function(e,t,n){const r=t[aO[t.type]](),i=r.length;let a,o=i>1?r[1]-r[0]:r[0];for(a=1;a<i;++a)o=Math.min(o,r[a]-r[a-1]);return e.formatSpan(0,o,30,n)}(e,t,i):nO(e,t,n,i,a,o);return r===Yk&&(e=>iO[e.type]||e.bins)(t)?lO(s):"discrete"===r?cO(s):fO(s)}const lO=e=>(t,n,r)=>{const i=uO(r[n+1],uO(r.max,1/0)),a=dO(t,e),o=dO(i,e);return a&&o?a+" – "+o:o?"< "+o:"≥ "+a},uO=(e,t)=>null!=e?e:t,cO=e=>(t,n)=>n?e(t):null,fO=e=>t=>e(t),dO=(e,t)=>Number.isFinite(e)?t(e):null;function hO(e,t,n,r){const i=r||t.type;return Cc(n)&&function(e){return jk(e,_k)}(i)&&(n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")),n||i!==sk?n||i!==lk?sO(e,t,5,null,n,r,!0):e.utcFormat("%A, %d %B %Y, %X UTC"):e.timeFormat("%A, %d %B %Y, %X")}function pO(e,t,n){n=n||{};const r=Math.max(3,n.maxlen||7),i=hO(e,t,n.format,n.formatType);if(Nk(t.type)){const e=oO(t).slice(1).map(i),n=e.length;return"".concat(n," boundar").concat(1===n?"y":"ies",": ").concat(e.join(", "))}if(Tk(t.type)){const e=t.domain(),n=e.length,a=n>r?e.slice(0,r-2).map(i).join(", ")+", ending with "+e.slice(-1).map(i):e.map(i).join(", ");return"".concat(n," value").concat(1===n?"":"s",": ").concat(a)}{const e=t.domain();return"values from ".concat(i(e[0])," to ").concat(i(Lu(e)))}}let mO=0;const gO="p_";function yO(e){return e&&e.gradient}function vO(e,t,n){const r=e.gradient;let i=e.id,a="radial"===r?gO:"";return i||(i=e.id="gradient_"+mO++,"radial"===r?(e.x1=bO(e.x1,.5),e.y1=bO(e.y1,.5),e.r1=bO(e.r1,0),e.x2=bO(e.x2,.5),e.y2=bO(e.y2,.5),e.r2=bO(e.r2,.5),a=gO):(e.x1=bO(e.x1,0),e.y1=bO(e.y1,0),e.x2=bO(e.x2,1),e.y2=bO(e.y2,0))),t[i]=e,"url("+(n||"")+"#"+a+i+")"}function bO(e,t){return null!=e?e:t}function xO(e,t){var n,r=[];return n={gradient:"linear",x1:e?e[0]:0,y1:e?e[1]:0,x2:t?t[0]:1,y2:t?t[1]:0,stops:r,stop:function(e,t){return r.push({offset:e,color:t}),n}}}const wO={basis:{curve:function(e){return new Nb(e)}},"basis-closed":{curve:function(e){return new Rb(e)}},"basis-open":{curve:function(e){return new Pb(e)}},bundle:{curve:Bb,tension:"beta",value:.85},cardinal:{curve:qb,tension:"tension",value:0},"cardinal-open":{curve:Hb,tension:"tension",value:0},"cardinal-closed":{curve:Vb,tension:"tension",value:0},"catmull-rom":{curve:Yb,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Kb,tension:"alpha",value:.5},"catmull-rom-open":{curve:Zb,tension:"alpha",value:.5},linear:{curve:Eb},"linear-closed":{curve:function(e){return new ex(e)}},monotone:{horizontal:function(e){return new ox(e)},vertical:function(e){return new ax(e)}},natural:{curve:function(e){return new lx(e)}},step:{curve:function(e){return new cx(e,.5)}},"step-after":{curve:function(e){return new cx(e,1)}},"step-before":{curve:function(e){return new cx(e,0)}}};function _O(e,t,n){var r=bc(wO,e)&&wO[e],i=null;return r&&(i=r.curve||r[t||"vertical"],r.tension&&null!=n&&(i=i[r.tension](n))),i}const kO={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},OO=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\.\d+)(\.\d)/g,/(\d)([-+])/g,/\s|,|###/];function SO(e){const t=[];let n,r,i,a,o,s,l,u,c,f;const d=e.slice().replace(OO[0],"###$1").split(OO[1]).slice(1);for(l=0,c=d.length;l<c;++l){for(n=d[l],r=n.slice(1).trim().replace(OO[2],"$1###$2").replace(OO[3],"$1###$2").split(OO[4]),o=n.charAt(0),i=[o],u=0,f=r.length;u<f;++u)(a=+r[u])===a&&i.push(a);if(s=kO[o.toLowerCase()],i.length-1>s){const e=i.length;for(u=1,t.push([o].concat(i.slice(u,u+=s))),o="M"===o?"L":"m"===o?"l":o;u<e;u+=s)t.push([o].concat(i.slice(u,u+s)))}else t.push(i)}return t}const $O=Math.PI/180,EO=Math.PI/2,AO=2*Math.PI,DO=Math.sqrt(3)/2;var CO={},MO={},jO=[].join;function FO(e){const t=jO.call(e);if(MO[t])return MO[t];var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7];const c=u*o,f=-l*s,d=l*o,h=u*s,p=Math.cos(i),m=Math.sin(i),g=Math.cos(a),y=Math.sin(a),v=.5*(a-i),b=Math.sin(.5*v),x=8/3*b*b/Math.sin(v),w=n+p-x*m,_=r+m+x*p,k=n+g,O=r+y,S=k+x*y,$=O-x*g;return MO[t]=[c*w+f*_,d*w+h*_,c*S+f*$,d*S+h*$,c*k+f*O,d*k+h*O]}const TO=["l",0,0,0,0,0,0,0];function NO(e,t,n){const r=TO[0]=e[0];if("a"===r||"A"===r)TO[1]=t*e[1],TO[2]=n*e[2],TO[3]=e[3],TO[4]=e[4],TO[5]=e[5],TO[6]=t*e[6],TO[7]=n*e[7];else if("h"===r||"H"===r)TO[1]=t*e[1];else if("v"===r||"V"===r)TO[1]=n*e[1];else for(var i=1,a=e.length;i<a;++i)TO[i]=(i%2==1?t:n)*e[i];return TO}function RO(e,t,n,r,i,a){var o,s,l,u,c,f=null,d=0,h=0,p=0,m=0;null==n&&(n=0),null==r&&(r=0),null==i&&(i=1),null==a&&(a=i),e.beginPath&&e.beginPath();for(var g=0,y=t.length;g<y;++g){switch(o=t[g],1===i&&1===a||(o=NO(o,i,a)),o[0]){case"l":d+=o[1],h+=o[2],e.lineTo(d+n,h+r);break;case"L":d=o[1],h=o[2],e.lineTo(d+n,h+r);break;case"h":d+=o[1],e.lineTo(d+n,h+r);break;case"H":d=o[1],e.lineTo(d+n,h+r);break;case"v":h+=o[1],e.lineTo(d+n,h+r);break;case"V":h=o[1],e.lineTo(d+n,h+r);break;case"m":d+=o[1],h+=o[2],e.moveTo(d+n,h+r);break;case"M":d=o[1],h=o[2],e.moveTo(d+n,h+r);break;case"c":s=d+o[5],l=h+o[6],p=d+o[3],m=h+o[4],e.bezierCurveTo(d+o[1]+n,h+o[2]+r,p+n,m+r,s+n,l+r),d=s,h=l;break;case"C":d=o[5],h=o[6],p=o[3],m=o[4],e.bezierCurveTo(o[1]+n,o[2]+r,p+n,m+r,d+n,h+r);break;case"s":s=d+o[3],l=h+o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,d+o[1]+n,h+o[2]+r,s+n,l+r),p=d+o[1],m=h+o[2],d=s,h=l;break;case"S":s=o[3],l=o[4],p=2*d-p,m=2*h-m,e.bezierCurveTo(p+n,m+r,o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"q":s=d+o[3],l=h+o[4],p=d+o[1],m=h+o[2],e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"Q":s=o[3],l=o[4],e.quadraticCurveTo(o[1]+n,o[2]+r,s+n,l+r),d=s,h=l,p=o[1],m=o[2];break;case"t":s=d+o[1],l=h+o[2],null===f[0].match(/[QqTt]/)?(p=d,m=h):"t"===f[0]?(p=2*d-u,m=2*h-c):"q"===f[0]&&(p=2*d-p,m=2*h-m),u=p,c=m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),h=l,p=(d=s)+o[1],m=h+o[2];break;case"T":s=o[1],l=o[2],p=2*d-p,m=2*h-m,e.quadraticCurveTo(p+n,m+r,s+n,l+r),d=s,h=l;break;case"a":PO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+d+n,o[7]+h+r]),d+=o[6],h+=o[7];break;case"A":PO(e,d+n,h+r,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+r]),d=o[6],h=o[7];break;case"z":case"Z":e.closePath()}f=o}}function PO(e,t,n,r){const i=function(e,t,n,r,i,a,o,s,l){const u=jO.call(arguments);if(CO[u])return CO[u];const c=o*$O,f=Math.sin(c),d=Math.cos(c),h=d*(s-e)*.5+f*(l-t)*.5,p=d*(l-t)*.5-f*(s-e)*.5;let m=h*h/((n=Math.abs(n))*n)+p*p/((r=Math.abs(r))*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);const g=d/n,y=f/n,v=-f/r,b=d/r,x=g*s+y*l,w=v*s+b*l,_=g*e+y*t,k=v*e+b*t;let O=1/((_-x)*(_-x)+(k-w)*(k-w))-.25;O<0&&(O=0);let S=Math.sqrt(O);a==i&&(S=-S);const $=.5*(x+_)-S*(k-w),E=.5*(w+k)+S*(_-x),A=Math.atan2(w-E,x-$);let D=Math.atan2(k-E,_-$)-A;D<0&&1===a?D+=AO:D>0&&0===a&&(D-=AO);const C=Math.ceil(Math.abs(D/(EO+.001))),M=[];for(let e=0;e<C;++e){const t=A+e*D/C,i=A+(e+1)*D/C;M[e]=[$,E,t,i,n,r,f,d]}return CO[u]=M}(r[5],r[6],r[0],r[1],r[3],r[4],r[2],t,n);for(let t=0;t<i.length;++t){const n=FO(i[t]);e.bezierCurveTo(n[0],n[1],n[2],n[3],n[4],n[5])}}const zO=.5773502691896257,BO={circle:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(n,0),e.arc(0,0,n,0,AO)}},cross:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/2.5;e.moveTo(-n,-r),e.lineTo(-n,r),e.lineTo(-r,r),e.lineTo(-r,n),e.lineTo(r,n),e.lineTo(r,r),e.lineTo(n,r),e.lineTo(n,-r),e.lineTo(r,-r),e.lineTo(r,-n),e.lineTo(-r,-n),e.lineTo(-r,-r),e.closePath()}},diamond:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(0,-n),e.lineTo(n,0),e.lineTo(0,n),e.closePath()}},square:{draw:function(e,t){var n=Math.sqrt(t),r=-n/2;e.rect(r,r,n,n)}},arrow:{draw:function(e,t){var n=Math.sqrt(t)/2,r=n/7,i=n/2.5,a=n/8;e.moveTo(-r,n),e.lineTo(r,n),e.lineTo(r,-a),e.lineTo(i,-a),e.lineTo(0,-n),e.lineTo(-i,-a),e.lineTo(-r,-a),e.closePath()}},wedge:{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n,i=r-n*zO,a=n/4;e.moveTo(0,-r-i),e.lineTo(-a,r-i),e.lineTo(a,r-i),e.closePath()}},triangle:{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n,i=r-n*zO;e.moveTo(0,-r-i),e.lineTo(-n,r-i),e.lineTo(n,r-i),e.closePath()}},"triangle-up":{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n;e.moveTo(0,-r),e.lineTo(-n,r),e.lineTo(n,r),e.closePath()}},"triangle-down":{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n;e.moveTo(0,r),e.lineTo(-n,-r),e.lineTo(n,-r),e.closePath()}},"triangle-right":{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n;e.moveTo(r,0),e.lineTo(-r,-n),e.lineTo(-r,n),e.closePath()}},"triangle-left":{draw:function(e,t){var n=Math.sqrt(t)/2,r=DO*n;e.moveTo(-r,0),e.lineTo(r,-n),e.lineTo(r,n),e.closePath()}},stroke:{draw:function(e,t){const n=Math.sqrt(t)/2;e.moveTo(-n,0),e.lineTo(n,0)}}};function LO(e){return bc(BO,e)?BO[e]:function(e){if(!bc(IO,e)){const t=SO(e);IO[e]={draw:function(e,n){RO(e,t,0,0,Math.sqrt(n)/2)}}}return IO[e]}(e)}var IO={};const qO=.448084975506;function UO(e){return e.x}function VO(e){return e.y}function WO(e){return e.width}function HO(e){return e.height}function GO(e){return"function"==typeof e?e:()=>+e}function XO(e,t,n){return Math.max(t,Math.min(e,n))}function YO(){var e=UO,t=VO,n=WO,r=HO,i=GO(0),a=i,o=i,s=i,l=null;function u(u,c,f){var d,h=null!=c?c:+e.call(this,u),p=null!=f?f:+t.call(this,u),m=+n.call(this,u),g=+r.call(this,u),y=Math.min(m,g)/2,v=XO(+i.call(this,u),0,y),b=XO(+a.call(this,u),0,y),x=XO(+o.call(this,u),0,y),w=XO(+s.call(this,u),0,y);if(l||(l=d=rb()),v<=0&&b<=0&&x<=0&&w<=0)l.rect(h,p,m,g);else{var _=h+m,k=p+g;l.moveTo(h+v,p),l.lineTo(_-b,p),l.bezierCurveTo(_-qO*b,p,_,p+qO*b,_,p+b),l.lineTo(_,k-w),l.bezierCurveTo(_,k-qO*w,_-qO*w,k,_-w,k),l.lineTo(h+x,k),l.bezierCurveTo(h+qO*x,k,h,k-qO*x,h,k-x),l.lineTo(h,p+v),l.bezierCurveTo(h,p+qO*v,h+qO*v,p,h+v,p),l.closePath()}if(d)return l=null,d+""||null}return u.x=function(t){return arguments.length?(e=GO(t),u):e},u.y=function(e){return arguments.length?(t=GO(e),u):t},u.width=function(e){return arguments.length?(n=GO(e),u):n},u.height=function(e){return arguments.length?(r=GO(e),u):r},u.cornerRadius=function(e,t,n,r){return arguments.length?(i=GO(e),a=null!=t?GO(t):i,s=null!=n?GO(n):i,o=null!=r?GO(r):a,u):i},u.context=function(e){return arguments.length?(l=null==e?null:e,u):l},u}function JO(){var e,t,n,r,i,a,o,s,l=null;function u(e,t,n){const r=n/2;if(i){var u=o-t,c=e-a;if(u||c){var f=Math.sqrt(u*u+c*c),d=(u/=f)*s,h=(c/=f)*s,p=Math.atan2(c,u);l.moveTo(a-d,o-h),l.lineTo(e-u*r,t-c*r),l.arc(e,t,r,p-Math.PI,p),l.lineTo(a+d,o+h),l.arc(a,o,s,p,p+Math.PI)}else l.arc(e,t,r,0,AO);l.closePath()}else i=1;a=e,o=t,s=r}function c(a){var o,s,c,f=a.length,d=!1;for(null==l&&(l=c=rb()),o=0;o<=f;++o)!(o<f&&r(s=a[o],o,a))===d&&(d=!d)&&(i=0),d&&u(+e(s,o,a),+t(s,o,a),+n(s,o,a));if(c)return l=null,c+""||null}return c.x=function(t){return arguments.length?(e=t,c):e},c.y=function(e){return arguments.length?(t=e,c):t},c.size=function(e){return arguments.length?(n=e,c):n},c.defined=function(e){return arguments.length?(r=e,c):r},c.context=function(e){return arguments.length?(l=null==e?null:e,c):l},c}function KO(e,t){return null!=e?e:t}const QO=e=>e.x||0,ZO=e=>e.y||0,eS=e=>!(!1===e.defined),tS=function(){var e=vb,t=bb,n=ib(0),r=null,i=xb,a=wb,o=_b,s=null;function l(){var l,u,c=+e.apply(this,arguments),f=+t.apply(this,arguments),d=i.apply(this,arguments)-pb,h=a.apply(this,arguments)-pb,p=ab(h-d),m=h>d;if(s||(s=l=rb()),f<c&&(u=f,f=c,c=u),f>db)if(p>mb-db)s.moveTo(f*sb(d),f*cb(d)),s.arc(0,0,f,d,h,!m),c>db&&(s.moveTo(c*sb(h),c*cb(h)),s.arc(0,0,c,h,d,m));else{var g,y,v=d,b=h,x=d,w=h,_=p,k=p,O=o.apply(this,arguments)/2,S=O>db&&(r?+r.apply(this,arguments):fb(c*c+f*f)),$=ub(ab(f-c)/2,+n.apply(this,arguments)),E=$,A=$;if(S>db){var D=yb(S/c*cb(O)),C=yb(S/f*cb(O));(_-=2*D)>db?(x+=D*=m?1:-1,w-=D):(_=0,x=w=(d+h)/2),(k-=2*C)>db?(v+=C*=m?1:-1,b-=C):(k=0,v=b=(d+h)/2)}var M=f*sb(v),j=f*cb(v),F=c*sb(w),T=c*cb(w);if($>db){var N,R=f*sb(b),P=f*cb(b),z=c*sb(x),B=c*cb(x);if(p<hb&&(N=kb(M,j,z,B,R,P,F,T))){var L=M-N[0],I=j-N[1],q=R-N[0],U=P-N[1],V=1/cb(gb((L*q+I*U)/(fb(L*L+I*I)*fb(q*q+U*U)))/2),W=fb(N[0]*N[0]+N[1]*N[1]);E=ub($,(c-W)/(V-1)),A=ub($,(f-W)/(V+1))}}k>db?A>db?(g=Ob(z,B,M,j,f,A,m),y=Ob(R,P,F,T,f,A,m),s.moveTo(g.cx+g.x01,g.cy+g.y01),A<$?s.arc(g.cx,g.cy,A,ob(g.y01,g.x01),ob(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,A,ob(g.y01,g.x01),ob(g.y11,g.x11),!m),s.arc(0,0,f,ob(g.cy+g.y11,g.cx+g.x11),ob(y.cy+y.y11,y.cx+y.x11),!m),s.arc(y.cx,y.cy,A,ob(y.y11,y.x11),ob(y.y01,y.x01),!m))):(s.moveTo(M,j),s.arc(0,0,f,v,b,!m)):s.moveTo(M,j),c>db&&_>db?E>db?(g=Ob(F,T,R,P,c,-E,m),y=Ob(M,j,z,B,c,-E,m),s.lineTo(g.cx+g.x01,g.cy+g.y01),E<$?s.arc(g.cx,g.cy,E,ob(g.y01,g.x01),ob(y.y01,y.x01),!m):(s.arc(g.cx,g.cy,E,ob(g.y01,g.x01),ob(g.y11,g.x11),!m),s.arc(0,0,c,ob(g.cy+g.y11,g.cx+g.x11),ob(y.cy+y.y11,y.cx+y.x11),m),s.arc(y.cx,y.cy,E,ob(y.y11,y.x11),ob(y.y01,y.x01),!m))):s.arc(0,0,c,w,x,m):s.lineTo(F,T)}else s.moveTo(0,0);if(s.closePath(),l)return s=null,l+""||null}return l.centroid=function(){var n=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,r=(+i.apply(this,arguments)+ +a.apply(this,arguments))/2-hb/2;return[sb(r)*n,cb(r)*n]},l.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:ib(+t),l):e},l.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:ib(+e),l):t},l.cornerRadius=function(e){return arguments.length?(n="function"==typeof e?e:ib(+e),l):n},l.padRadius=function(e){return arguments.length?(r=null==e?null:"function"==typeof e?e:ib(+e),l):r},l.startAngle=function(e){return arguments.length?(i="function"==typeof e?e:ib(+e),l):i},l.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:ib(+e),l):a},l.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:ib(+e),l):o},l.context=function(e){return arguments.length?(s=null==e?null:e,l):s},l}().startAngle((e=>e.startAngle||0)).endAngle((e=>e.endAngle||0)).padAngle((e=>e.padAngle||0)).innerRadius((e=>e.innerRadius||0)).outerRadius((e=>e.outerRadius||0)).cornerRadius((e=>e.cornerRadius||0)),nS=Mb().x(QO).y1(ZO).y0((e=>(e.y||0)+(e.height||0))).defined(eS),rS=Mb().y(ZO).x1(QO).x0((e=>(e.x||0)+(e.width||0))).defined(eS),iS=Cb().x(QO).y(ZO).defined(eS),aS=YO().x(QO).y(ZO).width((e=>e.width||0)).height((e=>e.height||0)).cornerRadius((e=>KO(e.cornerRadiusTopLeft,e.cornerRadius)||0),(e=>KO(e.cornerRadiusTopRight,e.cornerRadius)||0),(e=>KO(e.cornerRadiusBottomRight,e.cornerRadius)||0),(e=>KO(e.cornerRadiusBottomLeft,e.cornerRadius)||0)),oS=function(e,t){var n=null;function r(){var r;if(n||(n=r=rb()),e.apply(this,arguments).draw(n,+t.apply(this,arguments)),r)return n=null,r+""||null}return e="function"==typeof e?e:ib(e||jb),t="function"==typeof t?t:ib(void 0===t?64:+t),r.type=function(t){return arguments.length?(e="function"==typeof t?t:ib(t),r):e},r.size=function(e){return arguments.length?(t="function"==typeof e?e:ib(+e),r):t},r.context=function(e){return arguments.length?(n=null==e?null:e,r):n},r}().type((e=>LO(e.shape||"circle"))).size((e=>KO(e.size,64))),sS=JO().x(QO).y(ZO).defined(eS).size((e=>e.size||1));function lS(e){return e.cornerRadius||e.cornerRadiusTopLeft||e.cornerRadiusTopRight||e.cornerRadiusBottomRight||e.cornerRadiusBottomLeft}function uS(e,t,n,r){return aS.context(e)(t,n,r)}var cS=1;function fS(){cS=1}function dS(e,t,n){var r=t.clip,i=e._defs,a=t.clip_id||(t.clip_id="clip"+cS++),o=i.clipping[a]||(i.clipping[a]={id:a});return sc(r)?o.path=r(null):lS(n)?o.path=uS(null,n,0,0):(o.width=n.width||0,o.height=n.height||0),"url(#"+a+")"}function hS(e){this.clear(),e&&this.union(e)}function pS(e){this.mark=e,this.bounds=this.bounds||new hS}function mS(e){pS.call(this,e),this.items=this.items||[]}function gS(e){this._pending=0,this._loader=e||Wm()}function yS(e){e._pending+=1}function vS(e){e._pending-=1}function bS(e,t,n){if(t.stroke&&0!==t.opacity&&0!==t.strokeOpacity){const r=null!=t.strokeWidth?+t.strokeWidth:1;e.expand(r+(n?function(e,t){return e.strokeJoin&&"miter"!==e.strokeJoin?0:t}(t,r):0))}return e}hS.prototype={clone(){return new hS(this)},clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(e){return this.x1===e.x1&&this.y1===e.y1&&this.x2===e.x2&&this.y2===e.y2},set(e,t,n,r){return n<e?(this.x2=e,this.x1=n):(this.x1=e,this.x2=n),r<t?(this.y2=t,this.y1=r):(this.y1=t,this.y2=r),this},add(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},expand(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},scale(e){return this.x1*=e,this.y1*=e,this.x2*=e,this.y2*=e,this},translate(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},rotate(e,t,n){const r=this.rotatedPoints(e,t,n);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])},rotatedPoints(e,t,n){var{x1:r,y1:i,x2:a,y2:o}=this,s=Math.cos(e),l=Math.sin(e),u=t-t*s+n*l,c=n-t*l-n*s;return[s*r-l*i+u,l*r+s*i+c,s*r-l*o+u,l*r+s*o+c,s*a-l*i+u,l*a+s*i+c,s*a-l*o+u,l*a+s*o+c]},union(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},intersect(e){return e.x1>this.x1&&(this.x1=e.x1),e.y1>this.y1&&(this.y1=e.y1),e.x2<this.x2&&(this.x2=e.x2),e.y2<this.y2&&(this.y2=e.y2),this},encloses(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},alignsWith(e){return e&&(this.x1==e.x1||this.x2==e.x2||this.y1==e.y1||this.y2==e.y2)},intersects(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},contains(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}},kc(mS,pS),gS.prototype={pending(){return this._pending},sanitizeURL(e){const t=this;return yS(t),t._loader.sanitize(e,{context:"href"}).then((e=>(vS(t),e))).catch((()=>(vS(t),null)))},loadImage(e){const t=this,n=dx();return yS(t),t._loader.sanitize(e,{context:"image"}).then((e=>{const r=e.href;if(!r||!n)throw{url:r};const i=new n,a=bc(e,"crossOrigin")?e.crossOrigin:"anonymous";return null!=a&&(i.crossOrigin=a),i.onload=()=>vS(t),i.onerror=()=>vS(t),i.src=r,i})).catch((e=>(vS(t),{complete:!1,width:0,height:0,src:e&&e.url||""})))},ready(){const e=this;return new Promise((t=>{!function n(r){e.pending()?setTimeout((()=>{n(!0)}),10):t(r)}(!1)}))}};const xS=AO-1e-8;let wS,_S,kS,OS,SS,$S,ES,AS;const DS=(e,t)=>wS.add(e,t),CS=(e,t)=>DS(_S=e,kS=t),MS=e=>DS(e,wS.y1),jS=e=>DS(wS.x1,e),FS=(e,t)=>SS*e+ES*t,TS=(e,t)=>$S*e+AS*t,NS=(e,t)=>DS(FS(e,t),TS(e,t)),RS=(e,t)=>CS(FS(e,t),TS(e,t));function PS(e,t){return wS=e,t?(OS=t*$O,SS=AS=Math.cos(OS),$S=Math.sin(OS),ES=-$S):(SS=AS=1,OS=$S=ES=0),zS}const zS={beginPath(){},closePath(){},moveTo:RS,lineTo:RS,rect(e,t,n,r){OS?(NS(e+n,t),NS(e+n,t+r),NS(e,t+r),RS(e,t)):(DS(e+n,t+r),CS(e,t))},quadraticCurveTo(e,t,n,r){const i=FS(e,t),a=TS(e,t),o=FS(n,r),s=TS(n,r);BS(_S,i,o,MS),BS(kS,a,s,jS),CS(o,s)},bezierCurveTo(e,t,n,r,i,a){const o=FS(e,t),s=TS(e,t),l=FS(n,r),u=TS(n,r),c=FS(i,a),f=TS(i,a);LS(_S,o,l,c,MS),LS(kS,s,u,f,jS),CS(c,f)},arc(e,t,n,r,i,a){if(r+=OS,i+=OS,_S=n*Math.cos(i)+e,kS=n*Math.sin(i)+t,Math.abs(i-r)>xS)DS(e-n,t-n),DS(e+n,t+n);else{const o=r=>DS(n*Math.cos(r)+e,n*Math.sin(r)+t);let s,l;if(o(r),o(i),i!==r)if((r%=AO)<0&&(r+=AO),(i%=AO)<0&&(i+=AO),i<r&&(a=!a,s=r,r=i,i=s),a)for(i-=AO,s=r-r%EO,l=0;l<4&&s>i;++l,s-=EO)o(s);else for(s=r-r%EO+EO,l=0;l<4&&s<i;++l,s+=EO)o(s)}}};function BS(e,t,n,r){const i=(e-t)/(e+n-2*t);0<i&&i<1&&r(e+(t-e)*i)}function LS(e,t,n,r,i){const a=r-e+3*t-3*n,o=e+n-2*t,s=e-t;let l,u=0,c=0;Math.abs(a)>1e-14?(l=o*o+s*a,l>=0&&(l=Math.sqrt(l),u=(-o+l)/a,c=(-o-l)/a)):u=.5*s/o,0<u&&u<1&&i(IS(u,e,t,n,r)),0<c&&c<1&&i(IS(c,e,t,n,r))}function IS(e,t,n,r,i){const a=1-e,o=a*a,s=e*e;return o*a*t+3*o*e*n+3*a*s*r+s*e*i}var qS=(qS=fx(1,1))?qS.getContext("2d"):null;const US=new hS;function VS(e){return function(t,n){if(!qS)return!0;e(qS,t),US.clear().union(t.bounds).intersect(n).round();const{x1:r,y1:i,x2:a,y2:o}=US;for(let e=i;e<=o;++e)for(let t=r;t<=a;++t)if(qS.isPointInPath(t,e))return!0;return!1}}function WS(e,t){return t.contains(e.x||0,e.y||0)}function HS(e,t){const n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0;return t.intersects(US.set(n,r,n+i,r+a))}function GS(e,t){const n=e.x||0,r=e.y||0;return XS(t,n,r,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r)}function XS(e,t,n,r,i){const{x1:a,y1:o,x2:s,y2:l}=e,u=r-t,c=i-n;let f,d,h,p,m=0,g=1;for(p=0;p<4;++p){if(0===p&&(f=-u,d=-(a-t)),1===p&&(f=u,d=s-t),2===p&&(f=-c,d=-(o-n)),3===p&&(f=c,d=l-n),Math.abs(f)<1e-10&&d<0)return!1;if(h=d/f,f<0){if(h>g)return!1;h>m&&(m=h)}else if(f>0){if(h<m)return!1;h<g&&(g=h)}}return!0}function YS(e,t){e.globalCompositeOperation=t.blend||"source-over"}function JS(e,t){return null==e?t:e}function KS(e,t){const n=t.length;for(let r=0;r<n;++r)e.addColorStop(t[r].offset,t[r].color);return e}function QS(e,t,n){return yO(n)?function(e,t,n){const r=n.width(),i=n.height();let a;if("radial"===t.gradient)a=e.createRadialGradient(n.x1+JS(t.x1,.5)*r,n.y1+JS(t.y1,.5)*i,Math.max(r,i)*JS(t.r1,0),n.x1+JS(t.x2,.5)*r,n.y1+JS(t.y2,.5)*i,Math.max(r,i)*JS(t.r2,.5));else{const o=JS(t.x1,0),s=JS(t.y1,0),l=JS(t.x2,1),u=JS(t.y2,0);if(o!==l&&s!==u&&r!==i){const n=fx(Math.ceil(r),Math.ceil(i)),a=n.getContext("2d");return a.scale(r,i),a.fillStyle=KS(a.createLinearGradient(o,s,l,u),t.stops),a.fillRect(0,0,r,i),e.createPattern(n,"no-repeat")}a=e.createLinearGradient(n.x1+o*r,n.y1+s*i,n.x1+l*r,n.y1+u*i)}return KS(a,t.stops)}(e,n,t.bounds):n}function ZS(e,t,n){return(n*=null==t.fillOpacity?1:t.fillOpacity)>0&&(e.globalAlpha=n,e.fillStyle=QS(e,t,t.fill),!0)}var e$=[];function t$(e,t,n){var r=null!=(r=t.strokeWidth)?r:1;return!(r<=0)&&((n*=null==t.strokeOpacity?1:t.strokeOpacity)>0&&(e.globalAlpha=n,e.strokeStyle=QS(e,t,t.stroke),e.lineWidth=r,e.lineCap=t.strokeCap||"butt",e.lineJoin=t.strokeJoin||"miter",e.miterLimit=t.strokeMiterLimit||10,e.setLineDash&&(e.setLineDash(t.strokeDash||e$),e.lineDashOffset=t.strokeDashOffset||0),!0))}function n$(e,t){return e.zindex-t.zindex||e.index-t.index}function r$(e){if(!e.zdirty)return e.zitems;var t,n,r,i=e.items,a=[];for(n=0,r=i.length;n<r;++n)(t=i[n]).index=n,t.zindex&&a.push(t);return e.zdirty=!1,e.zitems=a.sort(n$)}function i$(e,t){var n,r,i=e.items;if(!i||!i.length)return;const a=r$(e);if(a&&a.length){for(n=0,r=i.length;n<r;++n)i[n].zindex||t(i[n]);i=a}for(n=0,r=i.length;n<r;++n)t(i[n])}function a$(e,t){var n,r,i=e.items;if(!i||!i.length)return null;const a=r$(e);for(a&&a.length&&(i=a),r=i.length;--r>=0;)if(n=t(i[r]))return n;if(i===a)for(r=(i=e.items).length;--r>=0;)if(!i[r].zindex&&(n=t(i[r])))return n;return null}function o$(e){return function(t,n,r){i$(n,(n=>{r&&!r.intersects(n.bounds)||l$(e,t,n,n)}))}}function s$(e){return function(t,n,r){!n.items.length||r&&!r.intersects(n.bounds)||l$(e,t,n.items[0],n.items)}}function l$(e,t,n,r){var i=null==n.opacity?1:n.opacity;0!==i&&(e(t,r)||(YS(t,n),n.fill&&ZS(t,n,i)&&t.fill(),n.stroke&&t$(t,n,i)&&t.stroke()))}function u$(e){return e=e||Cu,function(t,n,r,i,a,o){return r*=t.pixelRatio,i*=t.pixelRatio,a$(n,(n=>{const s=n.bounds;if((!s||s.contains(a,o))&&s)return e(t,n,r,i,a,o)?n:void 0}))}}function c$(e,t){return function(n,r,i,a){var o,s,l=Array.isArray(r)?r[0]:r,u=null==t?l.fill:t,c=l.stroke&&n.isPointInStroke;return c&&(o=l.strokeWidth,s=l.strokeCap,n.lineWidth=null!=o?o:1,n.lineCap=null!=s?s:"butt"),!e(n,r)&&(u&&n.isPointInPath(i,a)||c&&n.isPointInStroke(i,a))}}function f$(e){return u$(c$(e))}function d$(e,t){return"translate("+e+","+t+")"}function h$(e){return"rotate("+e+")"}function p$(e){return d$(e.x||0,e.y||0)}function m$(e,t,n){function r(e,n){var r=n.x||0,i=n.y||0,a=n.angle||0;e.translate(r,i),a&&e.rotate(a*=$O),e.beginPath(),t(e,n),a&&e.rotate(-a),e.translate(-r,-i)}return{type:e,tag:"path",nested:!1,attr:function(e,n){e("transform",function(e){return d$(e.x||0,e.y||0)+(e.angle?" "+h$(e.angle):"")}(n)),e("d",t(null,n))},bound:function(e,n){return t(PS(e,n.angle),n),bS(e,n).translate(n.x||0,n.y||0)},draw:o$(r),pick:f$(r),isect:n||VS(r)}}var g$=m$("arc",(function(e,t){return tS.context(e)(t)}));function y$(e,t,n){function r(e,n){e.beginPath(),t(e,n)}const i=c$(r);return{type:e,tag:"path",nested:!0,attr:function(e,n){var r=n.mark.items;r.length&&e("d",t(null,r))},bound:function(e,n){var r=n.items;return 0===r.length?e:(t(PS(e),r),bS(e,r[0]))},draw:s$(r),pick:function(e,t,n,r,a,o){var s=t.items,l=t.bounds;return!s||!s.length||l&&!l.contains(a,o)?null:(n*=e.pixelRatio,r*=e.pixelRatio,i(e,s,n,r)?s[0]:null)},isect:WS,tip:n}}var v$=y$("area",(function(e,t){const n=t[0],r=n.interpolate||"linear";return("horizontal"===n.orient?rS:nS).curve(_O(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i="horizontal"===e[0].orient?t[1]:t[0],a="horizontal"===e[0].orient?"y":"x",o=e.length,s=1/0;--o>=0;)!1!==e[o].defined&&(r=Math.abs(e[o][a]-i))<s&&(s=r,n=e[o]);return n}));function b$(e,t){e.beginPath(),lS(t)?uS(e,t,0,0):e.rect(0,0,t.width||0,t.height||0),e.clip()}function x$(e){const t=JS(e.strokeWidth,1);return null!=e.strokeOffset?e.strokeOffset:e.stroke&&t>.5&&t<1.5?.5-Math.abs(t-1):0}function w$(e,t){const n=x$(t);e("d",uS(null,t,n,n))}function _$(e,t,n,r){const i=x$(t);e.beginPath(),uS(e,t,(n||0)+i,(r||0)+i)}const k$=c$(_$),O$=c$(_$,!1),S$=c$(_$,!0);var $$={type:"group",tag:"g",nested:!1,attr:function(e,t){e("transform",p$(t))},bound:function(e,t){if(!t.clip&&t.items){const n=t.items,r=n.length;for(let t=0;t<r;++t)e.union(n[t].bounds)}return(t.clip||t.width||t.height)&&!t.noBound&&e.add(0,0).add(t.width||0,t.height||0),bS(e,t),e.translate(t.x||0,t.y||0)},draw:function(e,t,n){i$(t,(t=>{const r=t.x||0,i=t.y||0,a=t.strokeForeground,o=null==t.opacity?1:t.opacity;(t.stroke||t.fill)&&o&&(_$(e,t,r,i),YS(e,t),t.fill&&ZS(e,t,o)&&e.fill(),t.stroke&&!a&&t$(e,t,o)&&e.stroke()),e.save(),e.translate(r,i),t.clip&&b$(e,t),n&&n.translate(-r,-i),i$(t,(t=>{this.draw(e,t,n)})),n&&n.translate(r,i),e.restore(),a&&t.stroke&&o&&(_$(e,t,r,i),YS(e,t),t$(e,t,o)&&e.stroke())}))},pick:function(e,t,n,r,i,a){if(t.bounds&&!t.bounds.contains(i,a)||!t.items)return null;const o=n*e.pixelRatio,s=r*e.pixelRatio;return a$(t,(l=>{let u,c,f;const d=l.bounds;if(d&&!d.contains(i,a))return;c=l.x||0,f=l.y||0;const h=c+(l.width||0),p=f+(l.height||0),m=l.clip;if(m&&(i<c||i>h||a<f||a>p))return;if(e.save(),e.translate(c,f),c=i-c,f=a-f,m&&lS(l)&&!S$(e,l,o,s))return e.restore(),null;const g=l.strokeForeground,y=!1!==t.interactive;return y&&g&&l.stroke&&O$(e,l,o,s)?(e.restore(),l):(u=a$(l,(e=>function(e,t,n){return(!1!==e.interactive||"group"===e.marktype)&&e.bounds&&e.bounds.contains(t,n)}(e,c,f)?this.pick(e,n,r,c,f):null)),!u&&y&&(l.fill||!g&&l.stroke)&&k$(e,l,o,s)&&(u=l),e.restore(),u||null)}))},isect:HS,content:function(e,t,n){e("clip-path",t.clip?dS(n,t,t):null)},background:function(e,t){e("class","background"),e("aria-hidden",!0),w$(e,t)},foreground:function(e,t){e("class","foreground"),e("aria-hidden",!0),t.strokeForeground?w$(e,t):e("d","")}},E$={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function A$(e,t){var n=e.image;return(!n||e.url&&e.url!==n.url)&&(n={complete:!1,width:0,height:0},t.loadImage(e.url).then((t=>{e.image=t,e.image.url=e.url}))),n}function D$(e,t){return null!=e.width?e.width:t&&t.width?!1!==e.aspect&&e.height?e.height*t.width/t.height:t.width:0}function C$(e,t){return null!=e.height?e.height:t&&t.height?!1!==e.aspect&&e.width?e.width*t.height/t.width:t.height:0}function M$(e,t){return"center"===e?t/2:"right"===e?t:0}function j$(e,t){return"middle"===e?t/2:"bottom"===e?t:0}var F$={type:"image",tag:"image",nested:!1,attr:function(e,t,n){const r=A$(t,n),i=D$(t,r),a=C$(t,r),o=(t.x||0)-M$(t.align,i),s=(t.y||0)-j$(t.baseline,a);e("href",!r.src&&r.toDataURL?r.toDataURL():r.src||"",E$["xmlns:xlink"],"xlink:href"),e("transform",d$(o,s)),e("width",i),e("height",a),e("preserveAspectRatio",!1===t.aspect?"none":"xMidYMid")},bound:function(e,t){const n=t.image,r=D$(t,n),i=C$(t,n),a=(t.x||0)-M$(t.align,r),o=(t.y||0)-j$(t.baseline,i);return e.set(a,o,a+r,o+i)},draw:function(e,t,n){i$(t,(t=>{if(n&&!n.intersects(t.bounds))return;const r=A$(t,this);let i,a,o,s,l=D$(t,r),u=C$(t,r),c=(t.x||0)-M$(t.align,l),f=(t.y||0)-j$(t.baseline,u);!1!==t.aspect&&(a=r.width/r.height,o=t.width/t.height,a==a&&o==o&&a!==o&&(o<a?(s=l/a,f+=(u-s)/2,u=s):(s=u*a,c+=(l-s)/2,l=s))),(r.complete||r.toDataURL)&&(YS(e,t),e.globalAlpha=null!=(i=t.opacity)?i:1,e.imageSmoothingEnabled=!1!==t.smooth,e.drawImage(r,c,f,l,u))}))},pick:u$(),isect:Cu,get:A$,xOffset:M$,yOffset:j$},T$=y$("line",(function(e,t){const n=t[0],r=n.interpolate||"linear";return iS.curve(_O(r,n.orient,n.tension)).context(e)(t)}),(function(e,t){for(var n,r,i=Math.pow(e[0].strokeWidth||1,2),a=e.length;--a>=0;)if(!1!==e[a].defined&&(n=e[a].x-t[0])*n+(r=e[a].y-t[1])*r<i)return e[a];return null}));function N$(e,t){var n=t.path;if(null==n)return!0;var r=t.x||0,i=t.y||0,a=t.scaleX||1,o=t.scaleY||1,s=(t.angle||0)*$O,l=t.pathCache;l&&l.path===n||((t.pathCache=l=SO(n)).path=n),s&&e.rotate&&e.translate?(e.translate(r,i),e.rotate(s),RO(e,l,0,0,a,o),e.rotate(-s),e.translate(-r,-i)):RO(e,l,r,i,a,o)}var R$={type:"path",tag:"path",nested:!1,attr:function(e,t){var n=t.scaleX||1,r=t.scaleY||1;1===n&&1===r||e("vector-effect","non-scaling-stroke"),e("transform",function(e){return d$(e.x||0,e.y||0)+(e.angle?" "+h$(e.angle):"")+(e.scaleX||e.scaleY?" "+(t=e.scaleX||1,n=e.scaleY||1,"scale("+t+","+n+")"):"");var t,n}(t)),e("d",t.path)},bound:function(e,t){return N$(PS(e,t.angle),t)?e.set(0,0,0,0):bS(e,t,!0)},draw:o$(N$),pick:f$(N$),isect:VS(N$)};function P$(e,t){e.beginPath(),uS(e,t)}var z$={type:"rect",tag:"path",nested:!1,attr:function(e,t){e("d",uS(null,t))},bound:function(e,t){var n,r;return bS(e.set(n=t.x||0,r=t.y||0,n+t.width||0,r+t.height||0),t)},draw:o$(P$),pick:f$(P$),isect:HS};function B$(e,t,n){var r,i,a,o;return!(!t.stroke||!t$(e,t,n))&&(r=t.x||0,i=t.y||0,a=null!=t.x2?t.x2:r,o=null!=t.y2?t.y2:i,e.beginPath(),e.moveTo(r,i),e.lineTo(a,o),!0)}var L$={type:"rule",tag:"line",nested:!1,attr:function(e,t){e("transform",p$(t)),e("x2",null!=t.x2?t.x2-(t.x||0):0),e("y2",null!=t.y2?t.y2-(t.y||0):0)},bound:function(e,t){var n,r;return bS(e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t)},draw:function(e,t,n){i$(t,(t=>{if(!n||n.intersects(t.bounds)){var r=null==t.opacity?1:t.opacity;r&&B$(e,t,r)&&(YS(e,t),e.stroke())}}))},pick:u$((function(e,t,n,r){return!!e.isPointInStroke&&(B$(e,t,1)&&e.isPointInStroke(n,r))})),isect:GS},I$=m$("shape",(function(e,t){return(t.mark.shape||t.shape).context(e)(t)})),q$=m$("symbol",(function(e,t){return oS.context(e)(t)}),WS);const U$=Fc();var V$={height:J$,measureWidth:X$,estimateWidth:H$,width:H$,canvas:W$};function W$(e){V$.width=e&&qS?X$:H$}function H$(e,t){return G$(eE(e,t),J$(e))}function G$(e,t){return~~(.8*e.length*t)}function X$(e,t){return J$(e)<=0||!(t=eE(e,t))?0:Y$(t,nE(e))}function Y$(e,t){const n="(".concat(t,") ").concat(e);let r=U$.get(n);return void 0===r&&(qS.font=t,r=qS.measureText(e).width,U$.set(n,r)),r}function J$(e){return null!=e.fontSize?+e.fontSize||0:11}function K$(e){return null!=e.lineHeight?e.lineHeight:J$(e)+2}function Q$(e){return function(e){return Tu(e)?e.length>1?e:e[0]:e}(e.lineBreak&&e.text&&!Tu(e.text)?e.text.split(e.lineBreak):e.text)}function Z$(e){const t=Q$(e);return(Tu(t)?t.length-1:0)*K$(e)}function eE(e,t){const n=null==t?"":(t+"").trim();return e.limit>0&&n.length?function(e,t){var n=+e.limit,r=function(e){if(V$.width===X$){const t=nE(e);return e=>Y$(e,t)}{const t=J$(e);return e=>G$(e,t)}}(e);if(r(t)<n)return t;var i,a=e.ellipsis||"…",o="rtl"===e.dir,s=0,l=t.length;if(n-=r(a),o){for(;s<l;)i=s+l>>>1,r(t.slice(i))>n?s=i+1:l=i;return a+t.slice(s)}for(;s<l;)i=1+(s+l>>>1),r(t.slice(0,i))<n?s=i:l=i-1;return t.slice(0,s)+a}(e,n):n}function tE(e,t){var n=e.font;return(t&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function nE(e,t){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+J$(e)+"px "+tE(e,t)}function rE(e){var t=e.baseline,n=J$(e);return Math.round("top"===t?.79*n:"middle"===t?.3*n:"bottom"===t?-.21*n:"line-top"===t?.29*n+.5*K$(e):"line-bottom"===t?.29*n-.5*K$(e):0)}W$(!0);const iE={left:"start",center:"middle",right:"end"},aE=new hS;function oE(e){var t,n=e.x||0,r=e.y||0,i=e.radius||0;return i&&(t=(e.theta||0)-EO,n+=i*Math.cos(t),r+=i*Math.sin(t)),aE.x1=n,aE.y1=r,aE}function sE(e,t,n){var r,i=V$.height(t),a=t.align,o=oE(t),s=o.x1,l=o.y1,u=t.dx||0,c=(t.dy||0)+rE(t)-Math.round(.8*i),f=Q$(t);if(Tu(f)?(i+=K$(t)*(f.length-1),r=f.reduce(((e,n)=>Math.max(e,V$.width(t,n))),0)):r=V$.width(t,f),"center"===a?u-=r/2:"right"===a&&(u-=r),e.set(u+=s,c+=l,u+r,c+i),t.angle&&!n)e.rotate(t.angle*$O,s,l);else if(2===n)return e.rotatedPoints(t.angle*$O,s,l);return e}var lE={arc:g$,area:v$,group:$$,image:F$,line:T$,path:R$,rect:z$,rule:L$,shape:I$,symbol:q$,text:{type:"text",tag:"text",nested:!1,attr:function(e,t){var n,r=t.dx||0,i=(t.dy||0)+rE(t),a=oE(t),o=a.x1,s=a.y1,l=t.angle||0;e("text-anchor",iE[t.align]||"start"),l?(n=d$(o,s)+" "+h$(l),(r||i)&&(n+=" "+d$(r,i))):n=d$(o+r,s+i),e("transform",n)},bound:sE,draw:function(e,t,n){i$(t,(t=>{var r,i,a,o,s,l,u,c=null==t.opacity?1:t.opacity;if(!(n&&!n.intersects(t.bounds)||0===c||t.fontSize<=0||null==t.text||0===t.text.length)){if(e.font=nE(t),e.textAlign=t.align||"left",i=(r=oE(t)).x1,a=r.y1,t.angle&&(e.save(),e.translate(i,a),e.rotate(t.angle*$O),i=a=0),i+=t.dx||0,a+=(t.dy||0)+rE(t),l=Q$(t),YS(e,t),Tu(l))for(s=K$(t),o=0;o<l.length;++o)u=eE(t,l[o]),t.fill&&ZS(e,t,c)&&e.fillText(u,i,a),t.stroke&&t$(e,t,c)&&e.strokeText(u,i,a),a+=s;else u=eE(t,l),t.fill&&ZS(e,t,c)&&e.fillText(u,i,a),t.stroke&&t$(e,t,c)&&e.strokeText(u,i,a);t.angle&&e.restore()}}))},pick:u$((function(e,t,n,r,i,a){if(t.fontSize<=0)return!1;if(!t.angle)return!0;var o=oE(t),s=o.x1,l=o.y1,u=sE(aE,t,1),c=-t.angle*$O,f=Math.cos(c),d=Math.sin(c),h=f*i-d*a+(s-f*s+d*l),p=d*i+f*a+(l-d*s-f*l);return u.contains(h,p)})),isect:function(e,t){const n=sE(aE,e,2);return XS(t,n[0],n[1],n[2],n[3])||XS(t,n[0],n[1],n[4],n[5])||XS(t,n[4],n[5],n[6],n[7])||XS(t,n[2],n[3],n[6],n[7])}},trail:y$("trail",(function(e,t){return sS.context(e)(t)}),(function(e,t){for(var n,r,i=e.length;--i>=0;)if(!1!==e[i].defined&&(n=e[i].x-t[0])*n+(r=e[i].y-t[1])*r<(n=e[i].size||1)*n)return e[i];return null}))};function uE(e,t,n){var r=lE[e.mark.marktype],i=t||r.bound;return r.nested&&(e=e.mark),i(e.bounds||(e.bounds=new hS),e,n)}var cE={mark:null};function fE(e,t,n){var r,i,a,o,s=lE[e.marktype],l=s.bound,u=e.items,c=u&&u.length;if(s.nested)return c?a=u[0]:(cE.mark=e,a=cE),o=uE(a,l,n),t=t&&t.union(o)||o;if(t=t||e.bounds&&e.bounds.clear()||new hS,c)for(r=0,i=u.length;r<i;++r)t.union(uE(u[r],l,n));return e.bounds=t}const dE=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function hE(e,t){return JSON.stringify(e,dE,t)}function pE(e){return mE("string"==typeof e?JSON.parse(e):e)}function mE(e){var t,n,r,i=e.marktype,a=e.items;if(a)for(n=0,r=a.length;n<r;++n)t=i?"mark":"group",a[n][t]=e,a[n].zindex&&(a[n][t].zdirty=!0),"group"===(i||t)&&mE(a[n]);return i&&fE(e),e}function gE(e){arguments.length?this.root=pE(e):(this.root=yE({marktype:"group",name:"root",role:"frame"}),this.root.items=[new mS(this.root)])}function yE(e,t){const n={bounds:new hS,clip:!!e.clip,group:t,interactive:!1!==e.interactive,items:[],marktype:e.marktype,name:e.name||void 0,role:e.role||void 0,zindex:e.zindex||0};return null!=e.aria&&(n.aria=e.aria),e.description&&(n.description=e.description),n}function vE(e,t,n){return!e&&"undefined"!=typeof document&&document.createElement&&(e=document),e?n?e.createElementNS(n,t):e.createElement(t):null}function bE(e,t){t=t.toLowerCase();for(var n=e.childNodes,r=0,i=n.length;r<i;++r)if(n[r].tagName.toLowerCase()===t)return n[r]}function xE(e,t,n,r){var i,a=e.childNodes[t];return a&&a.tagName.toLowerCase()===n.toLowerCase()||(i=a||null,a=vE(e.ownerDocument,n,r),e.insertBefore(a,i)),a}function wE(e,t){for(var n=e.childNodes,r=n.length;r>t;)e.removeChild(n[--r]);return e}function _E(e){return"mark-"+e.marktype+(e.role?" role-"+e.role:"")+(e.name?" "+e.name:"")}function kE(e,t){const n=t.getBoundingClientRect();return[e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0)]}function OE(e,t){this._active=null,this._handlers={},this._loader=e||Wm(),this._tooltip=t||SE}function SE(e,t,n,r){e.element().setAttribute("title",r||"")}function $E(e){this._el=null,this._bgcolor=null,this._loader=new gS(e)}gE.prototype={toJSON(e){return hE(this.root,e||0)},mark(e,t,n){const r=yE(e,t=t||this.root.items[0]);return t.items[n]=r,r.zindex&&(r.group.zdirty=!0),r}},OE.prototype={initialize(e,t,n){return this._el=e,this._obj=n||null,this.origin(t)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(e){return arguments.length?(this._origin=e||[0,0],this):this._origin.slice()},scene(e){return arguments.length?(this._scene=e,this):this._scene},on(){},off(){},_handlerIndex(e,t,n){for(let r=e?e.length:0;--r>=0;)if(e[r].type===t&&(!n||e[r].handler===n))return r;return-1},handlers(e){const t=this._handlers,n=[];if(e)n.push(...t[this.eventName(e)]);else for(const e in t)n.push(...t[e]);return n},eventName(e){const t=e.indexOf(".");return t<0?e:e.slice(0,t)},handleHref(e,t,n){this._loader.sanitize(n,{context:"href"}).then((t=>{const n=new MouseEvent(e.type,e),r=vE(null,"a");for(const e in t)r.setAttribute(e,t[e]);r.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(e,t,n){if(t&&null!=t.tooltip){t=function(e,t,n,r){var i,a,o=e&&e.mark;if(o&&(i=lE[o.marktype]).tip){for((a=kE(t,n))[0]-=r[0],a[1]-=r[1];e=e.mark.group;)a[0]-=e.x||0,a[1]-=e.y||0;e=i.tip(o.items,a)}return e}(t,e,this.canvas(),this._origin);const r=n&&t&&t.tooltip||null;this._tooltip.call(this._obj,this,e,t,r)}},getItemBoundingClientRect(e){const t=this.canvas();if(!t)return;const n=t.getBoundingClientRect(),r=this._origin,i=e.bounds,a=i.width(),o=i.height();let s=i.x1+r[0]+n.left,l=i.y1+r[1]+n.top;for(;e.mark&&(e=e.mark.group);)s+=e.x||0,l+=e.y||0;return{x:s,y:l,width:a,height:o,left:s,top:l,right:s+a,bottom:l+o}}},$E.prototype={initialize(e,t,n,r,i){return this._el=e,this.resize(t,n,r,i)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(e){return 0===arguments.length?this._bgcolor:(this._bgcolor=e,this)},resize(e,t,n,r){return this._width=e,this._height=t,this._origin=n||[0,0],this._scale=r||1,this},dirty(){},render(e){const t=this;return t._call=function(){t._render(e)},t._call(),t._call=null,t},_render(){},renderAsync(e){const t=this.render(e);return this._ready?this._ready.then((()=>t)):Promise.resolve(t)},_load(e,t){var n=this,r=n._loader[e](t);if(!n._ready){const e=n._call;n._ready=n._loader.ready().then((t=>{t&&e(),n._ready=null}))}return r},sanitizeURL(e){return this._load("sanitizeURL",e)},loadImage(e){return this._load("loadImage",e)}};const EE="dragenter",AE="dragleave",DE="dragover",CE="mousedown",ME="mousemove",jE="mouseout",FE="mouseover",TE="click",NE="mousewheel",RE="touchstart",PE="touchmove",zE="touchend",BE=ME,LE=jE,IE=TE;function qE(e,t){OE.call(this,e,t),this._down=null,this._touch=null,this._first=!0,this._events={}}function UE(e,t){(e=>e===RE||e===PE||e===zE?[RE,PE,zE]:[e])(t).forEach((t=>function(e,t){const n=e.canvas();n&&!e._events[t]&&(e._events[t]=1,n.addEventListener(t,e[t]?n=>e[t](n):n=>e.fire(t,n)))}(e,t)))}function VE(e,t,n){return function(r){const i=this._active,a=this.pickEvent(r);a===i||(i&&i.exit||this.fire(n,r),this._active=a,this.fire(t,r)),this.fire(e,r)}}function WE(e){return function(t){this.fire(e,t),this._active=null}}kc(qE,OE,{initialize(e,t,n){return this._canvas=e&&bE(e,"canvas"),[TE,CE,ME,jE,AE].forEach((e=>UE(this,e))),OE.prototype.initialize.call(this,e,t,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:["keydown","keypress","keyup",EE,AE,DE,CE,"mouseup",ME,jE,FE,TE,"dblclick","wheel",NE,RE,PE,zE],DOMMouseScroll(e){this.fire(NE,e)},mousemove:VE(ME,FE,jE),dragover:VE(DE,EE,AE),mouseout:WE(jE),dragleave:WE(AE),mousedown(e){this._down=this._active,this.fire(CE,e)},click(e){this._down===this._active&&(this.fire(TE,e),this._down=null)},touchstart(e){this._touch=this.pickEvent(e.changedTouches[0]),this._first&&(this._active=this._touch,this._first=!1),this.fire(RE,e,!0)},touchmove(e){this.fire(PE,e,!0)},touchend(e){this.fire(zE,e,!0),this._touch=null},fire(e,t,n){const r=n?this._touch:this._active,i=this._handlers[e];if(t.vegaType=e,e===IE&&r&&r.href?this.handleHref(t,r,r.href):e!==BE&&e!==LE||this.handleTooltip(t,r,e!==LE),i)for(let e=0,n=i.length;e<n;++e)i[e].handler.call(this._obj,t,r)},on(e,t){const n=this.eventName(e),r=this._handlers;return this._handlerIndex(r[n],e,t)<0&&(UE(this,e),(r[n]||(r[n]=[])).push({type:e,handler:t})),this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&r.splice(i,1),this},pickEvent(e){const t=kE(e,this._canvas),n=this._origin;return this.pick(this._scene,t[0],t[1],t[0]-n[0],t[1]-n[1])},pick(e,t,n,r,i){const a=this.context();return lE[e.marktype].pick.call(this,a,e,t,n,r,i)}});var HE="undefined"!=typeof window&&window.devicePixelRatio||1;function GE(e){$E.call(this,e),this._options={},this._redraw=!1,this._dirty=new hS,this._tempb=new hS}const XE=$E.prototype;function YE(e,t){OE.call(this,e,t);const n=this;n._hrefHandler=JE(n,((e,t)=>{t&&t.href&&n.handleHref(e,t,t.href)})),n._tooltipHandler=JE(n,((e,t)=>{n.handleTooltip(e,t,e.type!==LE)}))}kc(GE,$E,{initialize(e,t,n,r,i,a){return this._options=a||{},this._canvas=this._options.externalContext?null:fx(1,1,this._options.type),e&&this._canvas&&(wE(e,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),XE.initialize.call(this,e,t,n,r,i)},resize(e,t,n,r){if(XE.resize.call(this,e,t,n,r),this._canvas)!function(e,t,n,r,i,a){const o="undefined"!=typeof HTMLElement&&e instanceof HTMLElement&&null!=e.parentNode,s=e.getContext("2d"),l=o?HE:i;e.width=t*l,e.height=n*l;for(const e in a)s[e]=a[e];o&&1!==l&&(e.style.width=t+"px",e.style.height=n+"px"),s.pixelRatio=l,s.setTransform(l,0,0,l,l*r[0],l*r[1])}(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context);else{const e=this._options.externalContext;e||ku("CanvasRenderer is missing a valid canvas or context"),e.scale(this._scale,this._scale),e.translate(this._origin[0],this._origin[1])}return this._redraw=!0,this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(e){const t=this._tempb.clear().union(e.bounds);let n=e.mark.group;for(;n;)t.translate(n.x||0,n.y||0),n=n.mark.group;this._dirty.union(t)},_render(e){const t=this.context(),n=this._origin,r=this._width,i=this._height,a=this._dirty,o=((e,t,n)=>(new hS).set(0,0,t,n).translate(-e[0],-e[1]))(n,r,i);t.save();const s=this._redraw||a.empty()?(this._redraw=!1,o.expand(1)):function(e,t,n){return t.expand(1).round(),e.pixelRatio%1&&t.scale(e.pixelRatio).round().scale(1/e.pixelRatio),t.translate(-n[0]%1,-n[1]%1),e.beginPath(),e.rect(t.x1,t.y1,t.width(),t.height()),e.clip(),t}(t,o.intersect(a),n);return this.clear(-n[0],-n[1],r,i),this.draw(t,e,s),t.restore(),a.clear(),this},draw(e,t,n){const r=lE[t.marktype];t.clip&&function(e,t){var n=t.clip;e.save(),sc(n)?(e.beginPath(),n(e),e.clip()):b$(e,t.group)}(e,t),r.draw.call(this,e,t,n),t.clip&&e.restore()},clear(e,t,n,r){const i=this._options,a=this.context();"pdf"===i.type||i.externalContext||a.clearRect(e,t,n,r),null!=this._bgcolor&&(a.fillStyle=this._bgcolor,a.fillRect(e,t,n,r))}});const JE=(e,t)=>n=>{let r=n.target.__data__;r=Array.isArray(r)?r[0]:r,n.vegaType=n.type,t.call(e._obj,n,r)};kc(YE,OE,{initialize(e,t,n){let r=this._svg;return r&&(r.removeEventListener(IE,this._hrefHandler),r.removeEventListener(BE,this._tooltipHandler),r.removeEventListener(LE,this._tooltipHandler)),this._svg=r=e&&bE(e,"svg"),r&&(r.addEventListener(IE,this._hrefHandler),r.addEventListener(BE,this._tooltipHandler),r.addEventListener(LE,this._tooltipHandler)),OE.prototype.initialize.call(this,e,t,n)},canvas(){return this._svg},on(e,t){const n=this.eventName(e),r=this._handlers;if(this._handlerIndex(r[n],e,t)<0){const i={type:e,handler:t,listener:JE(this,t)};(r[n]||(r[n]=[])).push(i),this._svg&&this._svg.addEventListener(n,i.listener)}return this},off(e,t){const n=this.eventName(e),r=this._handlers[n],i=this._handlerIndex(r,e,t);return i>=0&&(this._svg&&this._svg.removeEventListener(n,r[i].listener),r.splice(i,1)),this}});const KE="aria-hidden",QE="aria-label",ZE="role",eA="aria-roledescription",tA="graphics-object",nA="graphics-symbol",rA=(e,t,n)=>({[ZE]:e,[eA]:t,[QE]:n||void 0}),iA=Uc(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]),aA={axis:{desc:"axis",caption:function(e){const t=e.datum,n=e.orient,r=t.title?cA(e):null,i=e.context,a=i.scales[t.scale].value,o=i.dataflow.locale(),s=a.type;return"".concat("left"===n||"right"===n?"Y":"X","-axis")+(r?" titled '".concat(r,"'"):"")+" for a ".concat(Tk(s)?"discrete":s," scale")+" with ".concat(pO(o,a,e))}},legend:{desc:"legend",caption:function(e){const t=e.datum,n=t.title?cA(e):null,r="".concat(t.type||""," legend").trim(),i=t.scales,a=Object.keys(i),o=e.context,s=o.scales[i[a[0]]].value,l=o.dataflow.locale();return u=r,(u.length?u[0].toUpperCase()+u.slice(1):u)+(n?" titled '".concat(n,"'"):"")+" for ".concat(function(e){return(e=e.map((e=>e+("fill"===e||"stroke"===e?" color":"")))).length<2?e[0]:e.slice(0,-1).join(", ")+" and "+Lu(e)}(a))+" with ".concat(pO(l,s,e));var u}},"title-text":{desc:"title",caption:e=>"Title text '".concat(uA(e),"'")},"title-subtitle":{desc:"subtitle",caption:e=>"Subtitle text '".concat(uA(e),"'")}},oA={ariaRole:ZE,ariaRoleDescription:eA,description:QE};function sA(e,t){const n=!1===t.aria;if(e(KE,n||void 0),n||null==t.description)for(const t in oA)e(oA[t],void 0);else{const n=t.mark.marktype;e(QE,t.description),e(ZE,t.ariaRole||("group"===n?tA:nA)),e(eA,t.ariaRoleDescription||"".concat(n," mark"))}}function lA(e){return!1===e.aria?{[KE]:!0}:iA[e.role]?null:aA[e.role]?function(e,t){try{const n=e.items[0],r=t.caption||(()=>"");return rA(t.role||nA,t.desc,n.description||r(n))}catch(e){return null}}(e,aA[e.role]):function(e){const t=e.marktype,n="group"===t||"text"===t||e.items.some((e=>null!=e.description&&!1!==e.aria));return rA(n?tA:nA,"".concat(t," mark container"),e.description)}(e)}function uA(e){return ac(e.text).join(" ")}function cA(e){try{return ac(Lu(e.items).items[0].text).join(" ")}catch(e){return null}}const fA=e=>(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");function dA(){let e="",t="",n="";const r=[],i=()=>t=n="",a=(e,n)=>(null!=n&&(t+=" ".concat(e,'="').concat(fA(n).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"),'"')),o),o={open(s,...l){(a=>{t&&(e+="".concat(t,">").concat(n),i()),r.push(a)})(s),t="<"+s;for(const e of l)for(const t in e)a(t,e[t]);return o},close(){const a=r.pop();return e+=t?t+(n?">".concat(n,"</").concat(a,">"):"/>"):"</".concat(a,">"),i(),o},attr:a,text:e=>(n+=fA(e),o),toString:()=>e};return o}const hA=e=>pA(dA(),e)+"";function pA(e,t){if(e.open(t.tagName),t.hasAttributes()){const n=t.attributes,r=n.length;for(let t=0;t<r;++t)e.attr(n[t].name,n[t].value)}if(t.hasChildNodes()){const n=t.childNodes,r=n.length;for(let t=0;t<r;t++){const r=n[t];3===r.nodeType?e.text(r.nodeValue):pA(e,r)}}return e.close()}const mA={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity",blend:"mix-blend-mode"},gA={fill:"none","stroke-miterlimit":10},yA=E$.xmlns;function vA(e){$E.call(this,e),this._dirtyID=0,this._dirty=[],this._svg=null,this._root=null,this._defs=null}const bA=$E.prototype;function xA(e,t){for(;e&&e.dirty!==t;e=e.mark.group){if(e.dirty=t,!e.mark||e.mark.dirty===t)return;e.mark.dirty=t}}function wA(e,t,n){let r,i,a;if("radial"===t.gradient){let r=xE(e,n++,"pattern",yA);DA(r,{id:gO+t.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),r=xE(r,0,"rect",yA),DA(r,{width:1,height:1,fill:"url(".concat(MA(),"#").concat(t.id,")")}),DA(e=xE(e,n++,"radialGradient",yA),{id:t.id,fx:t.x1,fy:t.y1,fr:t.r1,cx:t.x2,cy:t.y2,r:t.r2})}else DA(e=xE(e,n++,"linearGradient",yA),{id:t.id,x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2});for(r=0,i=t.stops.length;r<i;++r)a=xE(e,r,"stop",yA),a.setAttribute("offset",t.stops[r].offset),a.setAttribute("stop-color",t.stops[r].color);return wE(e,r),n}function _A(e,t,n){let r;return(e=xE(e,n,"clipPath",yA)).setAttribute("id",t.id),t.path?(r=xE(e,0,"path",yA),r.setAttribute("d",t.path)):(r=xE(e,0,"rect",yA),DA(r,{x:0,y:0,width:t.width,height:t.height})),wE(e,1),n+1}function kA(e,t,n,r,i){let a,o=e._svg;if(!o&&(a=t.ownerDocument,o=vE(a,r,yA),e._svg=o,e.mark&&(o.__data__=e,o.__values__={fill:"default"},"g"===r))){const t=vE(a,"path",yA);o.appendChild(t),t.__data__=e;const n=vE(a,"g",yA);o.appendChild(n),n.__data__=e;const r=vE(a,"path",yA);o.appendChild(r),r.__data__=e,r.__values__={fill:"default"}}return(o.ownerSVGElement!==i||function(e,t){return e.parentNode&&e.parentNode.childNodes.length>1&&e.previousSibling!=t}(o,n))&&t.insertBefore(o,n?n.nextSibling:t.firstChild),o}kc(vA,$E,{initialize(e,t,n,r,i){return this._defs={},this._clearDefs(),e&&(this._svg=xE(e,0,"svg",yA),DA(this._svg,E$),this._svg.setAttribute("class","marks"),wE(e,1),this._root=xE(this._svg,0,"g",yA),DA(this._root,gA),wE(this._svg,1)),this.background(this._bgcolor),bA.initialize.call(this,e,t,n,r,i)},background(e){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",e),bA.background.apply(this,arguments)},resize(e,t,n,r){return bA.resize.call(this,e,t,n,r),this._svg&&(DA(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}),this._root.setAttribute("transform","translate(".concat(this._origin,")"))),this._dirty=[],this},canvas(){return this._svg},svg(){const e=this._svg,t=this._bgcolor;if(!e)return null;let n;t&&(e.removeAttribute("style"),n=xE(e,0,"rect",yA),DA(n,{width:this._width,height:this._height,fill:t}));const r=hA(e);return t&&(e.removeChild(n),this._svg.style.setProperty("background-color",t)),r},_render(e){return this._dirtyCheck()&&(this._dirtyAll&&this._clearDefs(),this.mark(this._root,e),wE(this._root,1)),this.defs(),this._dirty=[],++this._dirtyID,this},dirty(e){e.dirty!==this._dirtyID&&(e.dirty=this._dirtyID,this._dirty.push(e))},isDirty(e){return this._dirtyAll||!e._svg||e.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=!0;const e=this._dirty;if(!e.length||!this._dirtyID)return!0;const t=++this._dirtyID;let n,r,i,a,o,s,l;for(o=0,s=e.length;o<s;++o)n=e[o],r=n.mark,r.marktype!==i&&(i=r.marktype,a=lE[i]),r.zdirty&&r.dirty!==t&&(this._dirtyAll=!1,xA(n,t),r.items.forEach((e=>{e.dirty=t}))),r.zdirty||(n.exit?(a.nested&&r.items.length?(l=r.items[0],l._svg&&this._update(a,l._svg,l)):n._svg&&(l=n._svg.parentNode,l&&l.removeChild(n._svg)),n._svg=null):(n=a.nested?r.items[0]:n,n._update!==t&&(n._svg&&n._svg.ownerSVGElement?this._update(a,n._svg,n):(this._dirtyAll=!1,xA(n,t)),n._update=t)));return!this._dirtyAll},mark(e,t,n){if(!this.isDirty(t))return t._svg;const r=this._svg,i=lE[t.marktype],a=!1===t.interactive?"none":null,o="g"===i.tag;let s=null,l=0;const u=kA(t,e,n,"g",r);u.setAttribute("class",_E(t));const c=lA(t);for(const e in c)CA(u,e,c[e]);o||CA(u,"pointer-events",a),CA(u,"clip-path",t.clip?dS(this,t,t.group):null);const f=e=>{const t=this.isDirty(e),n=kA(e,u,s,i.tag,r);t&&(this._update(i,n,e),o&&function(e,t,n){t=t.lastChild.previousSibling;let r,i=0;i$(n,(n=>{r=e.mark(t,n,r),++i})),wE(t,1+i)}(this,n,e)),s=n,++l};return i.nested?t.items.length&&f(t.items[0]):i$(t,f),wE(u,l),u},_update(e,t,n){OA=t,SA=t.__values__,sA(EA,n),e.attr(EA,n,this);const r=$A[e.type];r&&r.call(this,e,t,n),OA&&this.style(OA,n)},style(e,t){if(null!=t)for(const n in mA){let r="font"===n?tE(t):t[n];if(r===SA[n])continue;const i=mA[n];null==r?e.removeAttribute(i):(yO(r)&&(r=vO(r,this._defs.gradient,MA())),e.setAttribute(i,r+"")),SA[n]=r}},defs(){const e=this._svg,t=this._defs;let n=t.el,r=0;for(const i in t.gradient)n||(t.el=n=xE(e,1,"defs",yA)),r=wA(n,t.gradient[i],r);for(const i in t.clipping)n||(t.el=n=xE(e,1,"defs",yA)),r=_A(n,t.clipping[i],r);n&&(0===r?(e.removeChild(n),t.el=null):wE(n,r))},_clearDefs(){const e=this._defs;e.gradient={},e.clipping={}}});let OA=null,SA=null;const $A={group(e,t,n){const r=OA=t.childNodes[2];SA=r.__values__,e.foreground(EA,n,this),SA=t.__values__,OA=t.childNodes[1],e.content(EA,n,this);const i=OA=t.childNodes[0];e.background(EA,n,this);const a=!1===n.mark.interactive?"none":null;if(a!==SA.events&&(CA(r,"pointer-events",a),CA(i,"pointer-events",a),SA.events=a),n.strokeForeground&&n.stroke){const e=n.fill;CA(r,"display",null),this.style(i,n),CA(i,"stroke",null),e&&(n.fill=null),SA=r.__values__,this.style(r,n),e&&(n.fill=e),OA=null}else CA(r,"display","none")},image(e,t,n){!1===n.smooth?(AA(t,"image-rendering","optimizeSpeed"),AA(t,"image-rendering","pixelated")):AA(t,"image-rendering",null)},text(e,t,n){const r=Q$(n);let i,a,o,s;Tu(r)?(a=r.map((e=>eE(n,e))),i=a.join("\n"),i!==SA.text&&(wE(t,0),o=t.ownerDocument,s=K$(n),a.forEach(((e,r)=>{const i=vE(o,"tspan",yA);i.__data__=n,i.textContent=e,r&&(i.setAttribute("x",0),i.setAttribute("dy",s)),t.appendChild(i)})),SA.text=i)):(a=eE(n,r),a!==SA.text&&(t.textContent=a,SA.text=a)),CA(t,"font-family",tE(n)),CA(t,"font-size",J$(n)+"px"),CA(t,"font-style",n.fontStyle),CA(t,"font-variant",n.fontVariant),CA(t,"font-weight",n.fontWeight)}};function EA(e,t,n){t!==SA[e]&&(n?function(e,t,n,r){null!=n?e.setAttributeNS(r,t,n):e.removeAttributeNS(r,t)}(OA,e,t,n):CA(OA,e,t),SA[e]=t)}function AA(e,t,n){n!==SA[t]&&(null==n?e.style.removeProperty(t):e.style.setProperty(t,n+""),SA[t]=n)}function DA(e,t){for(const n in t)CA(e,n,t[n])}function CA(e,t,n){null!=n?e.setAttribute(t,n):e.removeAttribute(t)}function MA(){let e;return"undefined"==typeof window?"":(e=window.location).hash?e.href.slice(0,-e.hash.length):e.href}function jA(e){$E.call(this,e),this._text=null,this._defs={gradient:{},clipping:{}}}kc(jA,$E,{svg(){return this._text},_render(e){const t=dA();t.open("svg",mc({},E$,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:"0 0 ".concat(this._width," ").concat(this._height)}));const n=this._bgcolor;return n&&"transparent"!==n&&"none"!==n&&t.open("rect",{width:this._width,height:this._height,fill:n}).close(),t.open("g",gA,{transform:"translate("+this._origin+")"}),this.mark(t,e),t.close(),this.defs(t),this._text=t.close()+"",this},mark(e,t){const n=lE[t.marktype],r=n.tag,i=[sA,n.attr];e.open("g",{class:_E(t),"clip-path":t.clip?dS(this,t,t.group):null},lA(t),{"pointer-events":"g"!==r&&!1===t.interactive?"none":null});const a=a=>{const o=this.href(a);if(o&&e.open("a",o),e.open(r,this.attr(t,a,i,"g"!==r?r:null)),"text"===r){const t=Q$(a);if(Tu(t)){const n={x:0,dy:K$(a)};for(let r=0;r<t.length;++r)e.open("tspan",r?n:null).text(eE(a,t[r])).close()}else e.text(eE(a,t))}else if("g"===r){const r=a.strokeForeground,i=a.fill,o=a.stroke;r&&o&&(a.stroke=null),e.open("path",this.attr(t,a,n.background,"bgrect")).close(),e.open("g",this.attr(t,a,n.content)),i$(a,(t=>this.mark(e,t))),e.close(),r&&o?(i&&(a.fill=null),a.stroke=o,e.open("path",this.attr(t,a,n.foreground,"bgrect")).close(),i&&(a.fill=i)):e.open("path",this.attr(t,a,n.foreground,"bgfore")).close()}e.close(),o&&e.close()};return n.nested?t.items&&t.items.length&&a(t.items[0]):i$(t,a),e.close()},href(e){const t=e.href;let n;if(t){if(n=this._hrefs&&this._hrefs[t])return n;this.sanitizeURL(t).then((e=>{e["xlink:href"]=e.href,e.href=null,(this._hrefs||(this._hrefs={}))[t]=e}))}return null},attr(e,t,n,r){const i={},a=(e,t,n,r)=>{i[r||e]=t};return Array.isArray(n)?n.forEach((e=>e(a,t,this))):n(a,t,this),r&&function(e,t,n,r,i){if(null==t)return e;"bgrect"===r&&!1===n.interactive&&(e["pointer-events"]="none");if("bgfore"===r&&(!1===n.interactive&&(e["pointer-events"]="none"),e.display="none",null!==t.fill))return e;"image"===r&&!1===t.smooth&&(e.style="image-rendering: optimizeSpeed; image-rendering: pixelated;");"text"===r&&(e["font-family"]=tE(t),e["font-size"]=J$(t)+"px",e["font-style"]=t.fontStyle,e["font-variant"]=t.fontVariant,e["font-weight"]=t.fontWeight);for(const n in mA){let r=t[n];const a=mA[n];("transparent"!==r||"fill"!==a&&"stroke"!==a)&&null!=r&&(yO(r)&&(r=vO(r,i.gradient,"")),e[a]=r)}}(i,t,e,r,this._defs),i},defs(e){const t=this._defs.gradient,n=this._defs.clipping;if(0!==Object.keys(t).length+Object.keys(n).length){e.open("defs");for(const n in t){const r=t[n],i=r.stops;"radial"===r.gradient?(e.open("pattern",{id:gO+n,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"}),e.open("rect",{width:"1",height:"1",fill:"url(#"+n+")"}).close(),e.close(),e.open("radialGradient",{id:n,fx:r.x1,fy:r.y1,fr:r.r1,cx:r.x2,cy:r.y2,r:r.r2})):e.open("linearGradient",{id:n,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2});for(let t=0;t<i.length;++t)e.open("stop",{offset:i[t].offset,"stop-color":i[t].color}).close();e.close()}for(const t in n){const r=n[t];e.open("clipPath",{id:t}),r.path?e.open("path",{d:r.path}).close():e.open("rect",{x:0,y:0,width:r.width,height:r.height}).close(),e.close()}e.close()}}});const FA="canvas",TA="none",NA={Canvas:FA,PNG:"png",SVG:"svg",None:TA},RA={};function PA(e,t){return e=String(e||"").toLowerCase(),arguments.length>1?(RA[e]=t,this):RA[e]}function zA(e,t,n){const r=[],i=(new hS).union(t),a=e.marktype;return a?BA(e,i,n,r):"group"===a?LA(e,i,n,r):ku("Intersect scene must be mark node or group item.")}function BA(e,t,n,r){if(function(e,t,n){return e.bounds&&t.intersects(e.bounds)&&("group"===e.marktype||!1!==e.interactive&&(!n||n(e)))}(e,t,n)){const i=e.items,a=e.marktype,o=i.length;let s=0;if("group"===a)for(;s<o;++s)LA(i[s],t,n,r);else for(const e=lE[a].isect;s<o;++s){const n=i[s];IA(n,t,e)&&r.push(n)}}return r}function LA(e,t,n,r){n&&n(e.mark)&&IA(e,t,lE.group.isect)&&r.push(e);const i=e.items,a=i&&i.length;if(a){const o=e.x||0,s=e.y||0;t.translate(-o,-s);for(let e=0;e<a;++e)BA(i[e],t,n,r);t.translate(o,s)}return r}function IA(e,t,n){const r=e.bounds;return t.encloses(r)||t.intersects(r)&&n(e,t)}RA.canvas=RA.png={renderer:GE,headless:GE,handler:qE},RA.svg={renderer:vA,headless:jA,handler:YE},RA.none={};const qA=new hS;function UA(e){const t=e.clip;if(sc(t))t(PS(qA.clear()));else{if(!t)return;qA.set(0,0,e.group.width,e.group.height)}e.bounds.intersect(qA)}function VA(e,t,n){return e===t||("path"===n?WA(e,t):e instanceof Date&&t instanceof Date?+e==+t:Ac(e)&&Ac(t)?Math.abs(e-t)<=1e-9:e&&t&&(Nu(e)||Nu(t))?function(e,t){var n,r,i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(i.sort(),a.sort(),r=i.length-1;r>=0;r--)if(i[r]!=a[r])return!1;for(r=i.length-1;r>=0;r--)if(!VA(e[n=i[r]],t[n],n))return!1;return typeof e==typeof t}(e,t):e==t)}function WA(e,t){return VA(SO(e),SO(t))}const HA="top",GA="left",XA="right",YA="bottom",JA="start",KA="middle",QA="end",ZA="group",eD="axis",tD="title",nD="frame",rD="scope",iD="legend",aD="row-header",oD="row-footer",sD="row-title",lD="column-header",uD="column-footer",cD="column-title",fD="padding",dD="fit",hD="fit-x",pD="fit-y",mD="none",gD="all",yD="each",vD="flush",bD="column",xD="row";function wD(e){Cg.call(this,null,e)}function _D(e,t,n){return t(e.bounds.clear(),e,n)}kc(wD,Cg,{transform(e,t){const n=t.dataflow,r=e.mark,i=r.marktype,a=lE[i],o=a.bound;let s,l=r.bounds;if(a.nested)r.items.length&&n.dirty(r.items[0]),l=_D(r,o),r.items.forEach((e=>{e.bounds.clear().union(l)}));else if(i===ZA||e.modified())switch(t.visit(t.MOD,(e=>n.dirty(e))),l.clear(),r.items.forEach((e=>l.union(_D(e,o)))),r.role){case eD:case iD:case tD:t.reflow()}else s=t.changed(t.REM),t.visit(t.ADD,(e=>{l.union(_D(e,o))})),t.visit(t.MOD,(e=>{s=s||l.alignsWith(e.bounds),n.dirty(e),l.union(_D(e,o))})),s&&(l.clear(),r.items.forEach((e=>l.union(e.bounds))));return UA(r),t.modifies("bounds")}});const kD=":vega_identifier:";function OD(e){Cg.call(this,0,e)}function SD(e){Cg.call(this,null,e)}function $D(e){Cg.call(this,null,e)}OD.Definition={type:"Identifier",metadata:{modifies:!0},params:[{name:"as",type:"string",required:!0}]},kc(OD,Cg,{transform(e,t){const n=(i=t.dataflow)._signals[kD]||(i._signals[kD]=i.add(0)),r=e.as;var i;let a=n.value;return t.visit(t.ADD,(e=>e[r]=e[r]||++a)),n.set(this.value=a),t}}),kc(SD,Cg,{transform(e,t){let n=this.value;n||(n=t.dataflow.scenegraph().mark(e.markdef,function(e){const t=e.groups,n=e.parent;return t&&1===t.size?t.get(Object.keys(t.object)[0]):t&&n?t.lookup(n):null}(e),e.index),n.group.context=e.context,e.context.group||(e.context.group=n.group),n.source=this.source,n.clip=e.clip,n.interactive=e.interactive,this.value=n);const r=n.marktype===ZA?mS:pS;return t.visit(t.ADD,(e=>r.call(e,n))),(e.modified("clip")||e.modified("interactive"))&&(n.clip=e.clip,n.interactive=!!e.interactive,n.zdirty=!0,t.reflow()),n.items=t.source,t}});const ED={parity:e=>e.filter(((e,t)=>t%2?e.opacity=0:1)),greedy:(e,t)=>{let n;return e.filter(((e,r)=>r&&AD(n.bounds,e.bounds,t)?e.opacity=0:(n=e,1)))}},AD=(e,t,n)=>n>Math.max(t.x1-e.x2,e.x1-t.x2,t.y1-e.y2,e.y1-t.y2),DD=(e,t)=>{for(var n,r=1,i=e.length,a=e[0].bounds;r<i;a=n,++r)if(AD(a,n=e[r].bounds,t))return!0},CD=e=>{const t=e.bounds;return t.width()>1&&t.height()>1},MD=e=>(e.forEach((e=>e.opacity=1)),e),jD=(e,t)=>e.reflow(t.modified()).modifies("opacity");function FD(e){Cg.call(this,null,e)}kc($D,Cg,{transform(e,t){const n=ED[e.method]||ED.parity,r=e.separation||0;let i,a,o=t.materialize(t.SOURCE).source;if(!o||!o.length)return;if(!e.method)return e.modified("method")&&(MD(o),t=jD(t,e)),t;if(o=o.filter(CD),!o.length)return;if(e.sort&&(o=o.slice().sort(e.sort)),i=MD(o),t=jD(t,e),i.length>=3&&DD(i,r)){do{i=n(i,r)}while(i.length>=3&&DD(i,r));i.length<3&&!Lu(o).opacity&&(i.length>1&&(Lu(i).opacity=0),Lu(o).opacity=1)}e.boundScale&&e.boundTolerance>=0&&(a=((e,t,n)=>{var r=e.range(),i=new hS;return t===HA||t===YA?i.set(r[0],-1/0,r[1],1/0):i.set(-1/0,r[0],1/0,r[1]),i.expand(n||1),e=>i.encloses(e.bounds)})(e.boundScale,e.boundOrient,+e.boundTolerance),o.forEach((e=>{a(e)||(e.opacity=0)})));const s=i[0].mark.bounds.clear();return o.forEach((e=>{e.opacity&&s.union(e.bounds)})),t}}),kc(FD,Cg,{transform(e,t){const n=t.dataflow;if(t.visit(t.ALL,(e=>n.dirty(e))),t.fields&&t.fields.zindex){const e=t.source&&t.source[0];e&&(e.mark.zdirty=!0)}}});const TD=new hS;function ND(e,t,n){return e[t]===n?0:(e[t]=n,1)}function RD(e){var t=e.items[0].orient;return t===GA||t===XA}function PD(e,t,n,r){var i,a,o=t.items[0],s=o.datum,l=null!=o.translate?o.translate:.5,u=o.orient,c=function(e){let t=+e.grid;return[e.ticks?t++:-1,e.labels?t++:-1,t+ +e.domain]}(s),f=o.range,d=o.offset,h=o.position,p=o.minExtent,m=o.maxExtent,g=s.title&&o.items[c[2]].items[0],y=o.titlePadding,v=o.bounds,b=g&&Z$(g),x=0,w=0;switch(TD.clear().union(v),v.clear(),(i=c[0])>-1&&v.union(o.items[i].bounds),(i=c[1])>-1&&v.union(o.items[i].bounds),u){case HA:x=h||0,w=-d,a=Math.max(p,Math.min(m,-v.y1)),v.add(0,-a).add(f,0),g&&zD(e,g,a,y,b,0,-1,v);break;case GA:x=-d,w=h||0,a=Math.max(p,Math.min(m,-v.x1)),v.add(-a,0).add(0,f),g&&zD(e,g,a,y,b,1,-1,v);break;case XA:x=n+d,w=h||0,a=Math.max(p,Math.min(m,v.x2)),v.add(0,0).add(a,f),g&&zD(e,g,a,y,b,1,1,v);break;case YA:x=h||0,w=r+d,a=Math.max(p,Math.min(m,v.y2)),v.add(0,0).add(f,a),g&&zD(e,g,a,y,0,0,1,v);break;default:x=o.x,w=o.y}return bS(v.translate(x,w),o),ND(o,"x",x+l)|ND(o,"y",w+l)&&(o.bounds=TD,e.dirty(o),o.bounds=v,e.dirty(o)),o.mark.bounds.clear().union(v)}function zD(e,t,n,r,i,a,o,s){const l=t.bounds;if(t.auto){const s=o*(n+i+r);let u=0,c=0;e.dirty(t),a?u=(t.x||0)-(t.x=s):c=(t.y||0)-(t.y=s),t.mark.bounds.clear().union(l.translate(-u,-c)),e.dirty(t)}s.union(l)}const BD=(e,t)=>Math.floor(Math.min(e,t)),LD=(e,t)=>Math.ceil(Math.max(e,t));function ID(e){return(new hS).set(0,0,e.width||0,e.height||0)}function qD(e){const t=e.bounds.clone();return t.empty()?t.set(0,0,0,0):t.translate(-(e.x||0),-(e.y||0))}function UD(e,t,n){const r=Nu(e)?e[t]:e;return null!=r?r:void 0!==n?n:0}function VD(e){return e<0?Math.ceil(-e):0}function WD(e,t,n){var r,i,a,o,s,l,u,c,f,d,h,p=!n.nodirty,m=n.bounds===vD?ID:qD,g=TD.set(0,0,0,0),y=UD(n.align,bD),v=UD(n.align,xD),b=UD(n.padding,bD),x=UD(n.padding,xD),w=n.columns||t.length,_=w<=0?1:Math.ceil(t.length/w),k=t.length,O=Array(k),S=Array(w),$=0,E=Array(k),A=Array(_),D=0,C=Array(k),M=Array(k),j=Array(k);for(i=0;i<w;++i)S[i]=0;for(i=0;i<_;++i)A[i]=0;for(i=0;i<k;++i)l=t[i],s=j[i]=m(l),l.x=l.x||0,C[i]=0,l.y=l.y||0,M[i]=0,a=i%w,o=~~(i/w),$=Math.max($,u=Math.ceil(s.x2)),D=Math.max(D,c=Math.ceil(s.y2)),S[a]=Math.max(S[a],u),A[o]=Math.max(A[o],c),O[i]=b+VD(s.x1),E[i]=x+VD(s.y1),p&&e.dirty(t[i]);for(i=0;i<k;++i)i%w==0&&(O[i]=0),i<w&&(E[i]=0);if(y===yD)for(a=1;a<w;++a){for(h=0,i=a;i<k;i+=w)h<O[i]&&(h=O[i]);for(i=a;i<k;i+=w)O[i]=h+S[a-1]}else if(y===gD){for(h=0,i=0;i<k;++i)i%w&&h<O[i]&&(h=O[i]);for(i=0;i<k;++i)i%w&&(O[i]=h+$)}else for(y=!1,a=1;a<w;++a)for(i=a;i<k;i+=w)O[i]+=S[a-1];if(v===yD)for(o=1;o<_;++o){for(h=0,r=(i=o*w)+w;i<r;++i)h<E[i]&&(h=E[i]);for(i=o*w;i<r;++i)E[i]=h+A[o-1]}else if(v===gD){for(h=0,i=w;i<k;++i)h<E[i]&&(h=E[i]);for(i=w;i<k;++i)E[i]=h+D}else for(v=!1,o=1;o<_;++o)for(r=(i=o*w)+w;i<r;++i)E[i]+=A[o-1];for(f=0,i=0;i<k;++i)f=O[i]+(i%w?f:0),C[i]+=f-t[i].x;for(a=0;a<w;++a)for(d=0,i=a;i<k;i+=w)d+=E[i],M[i]+=d-t[i].y;if(y&&UD(n.center,bD)&&_>1)for(i=0;i<k;++i)(f=(s=y===gD?$:S[i%w])-j[i].x2-t[i].x-C[i])>0&&(C[i]+=f/2);if(v&&UD(n.center,xD)&&1!==w)for(i=0;i<k;++i)(d=(s=v===gD?D:A[~~(i/w)])-j[i].y2-t[i].y-M[i])>0&&(M[i]+=d/2);for(i=0;i<k;++i)g.union(j[i].translate(C[i],M[i]));switch(f=UD(n.anchor,"x"),d=UD(n.anchor,"y"),UD(n.anchor,bD)){case QA:f-=g.width();break;case KA:f-=g.width()/2}switch(UD(n.anchor,xD)){case QA:d-=g.height();break;case KA:d-=g.height()/2}for(f=Math.round(f),d=Math.round(d),g.clear(),i=0;i<k;++i)t[i].mark.bounds.clear();for(i=0;i<k;++i)(l=t[i]).x+=C[i]+=f,l.y+=M[i]+=d,g.union(l.mark.bounds.union(l.bounds.translate(C[i],M[i]))),p&&e.dirty(l);return g}function HD(e,t,n){var r,i,a,o,s,l,u,c=function(e){var t,n,r=e.items,i=r.length,a=0;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;a<i;++a)if(n=(t=r[a]).items,t.marktype===ZA)switch(t.role){case eD:case iD:case tD:break;case aD:o.rowheaders.push(...n);break;case oD:o.rowfooters.push(...n);break;case lD:o.colheaders.push(...n);break;case uD:o.colfooters.push(...n);break;case sD:o.rowtitle=n[0];break;case cD:o.coltitle=n[0];break;default:o.marks.push(...n)}return o}(t),f=c.marks,d=n.bounds===vD?GD:XD,h=n.offset,p=n.columns||f.length,m=p<=0?1:Math.ceil(f.length/p),g=m*p;const y=WD(e,f,n);y.empty()&&y.set(0,0,0,0),c.rowheaders&&(l=UD(n.headerBand,xD,null),r=YD(e,c.rowheaders,f,p,m,-UD(h,"rowHeader"),BD,0,d,"x1",0,p,1,l)),c.colheaders&&(l=UD(n.headerBand,bD,null),i=YD(e,c.colheaders,f,p,p,-UD(h,"columnHeader"),BD,1,d,"y1",0,1,p,l)),c.rowfooters&&(l=UD(n.footerBand,xD,null),a=YD(e,c.rowfooters,f,p,m,UD(h,"rowFooter"),LD,0,d,"x2",p-1,p,1,l)),c.colfooters&&(l=UD(n.footerBand,bD,null),o=YD(e,c.colfooters,f,p,p,UD(h,"columnFooter"),LD,1,d,"y2",g-p,1,p,l)),c.rowtitle&&(s=UD(n.titleAnchor,xD),u=UD(h,"rowTitle"),u=s===QA?a+u:r-u,l=UD(n.titleBand,xD,.5),JD(e,c.rowtitle,u,0,y,l)),c.coltitle&&(s=UD(n.titleAnchor,bD),u=UD(h,"columnTitle"),u=s===QA?o+u:i-u,l=UD(n.titleBand,bD,.5),JD(e,c.coltitle,u,1,y,l))}function GD(e,t){return"x1"===t?e.x||0:"y1"===t?e.y||0:"x2"===t?(e.x||0)+(e.width||0):"y2"===t?(e.y||0)+(e.height||0):void 0}function XD(e,t){return e.bounds[t]}function YD(e,t,n,r,i,a,o,s,l,u,c,f,d,h){var p,m,g,y,v,b,x,w,_,k=n.length,O=0,S=0;if(!k)return O;for(p=c;p<k;p+=f)n[p]&&(O=o(O,l(n[p],u)));if(!t.length)return O;for(t.length>i&&(e.warn("Grid headers exceed limit: "+i),t=t.slice(0,i)),O+=a,m=0,y=t.length;m<y;++m)e.dirty(t[m]),t[m].mark.bounds.clear();for(p=c,m=0,y=t.length;m<y;++m,p+=f){for(v=(b=t[m]).mark.bounds,g=p;g>=0&&null==(x=n[g]);g-=d);s?(w=null==h?x.x:Math.round(x.bounds.x1+h*x.bounds.width()),_=O):(w=O,_=null==h?x.y:Math.round(x.bounds.y1+h*x.bounds.height())),v.union(b.bounds.translate(w-(b.x||0),_-(b.y||0))),b.x=w,b.y=_,e.dirty(b),S=o(S,v[u])}return S}function JD(e,t,n,r,i,a){if(t){e.dirty(t);var o=n,s=n;r?o=Math.round(i.x1+a*i.width()):s=Math.round(i.y1+a*i.height()),t.bounds.translate(o-(t.x||0),s-(t.y||0)),t.mark.bounds.clear().union(t.bounds),t.x=o,t.y=s,e.dirty(t)}}function KD(e,t,n,r,i,a,o){const s=function(e,t){const n=e[t]||{};return(t,r)=>null!=n[t]?n[t]:null!=e[t]?e[t]:r}(n,t),l=function(e,t){let n=-1/0;return e.forEach((e=>{null!=e.offset&&(n=Math.max(n,e.offset))})),n>-1/0?n:t}(e,s("offset",0)),u=s("anchor",JA),c=u===QA?1:u===KA?.5:0,f={align:yD,bounds:s("bounds",vD),columns:"vertical"===s("direction")?1:e.length,padding:s("margin",8),center:s("center"),nodirty:!0};switch(t){case GA:f.anchor={x:Math.floor(r.x1)-l,column:QA,y:c*(o||r.height()+2*r.y1),row:u};break;case XA:f.anchor={x:Math.ceil(r.x2)+l,y:c*(o||r.height()+2*r.y1),row:u};break;case HA:f.anchor={y:Math.floor(i.y1)-l,row:QA,x:c*(a||i.width()+2*i.x1),column:u};break;case YA:f.anchor={y:Math.ceil(i.y2)+l,x:c*(a||i.width()+2*i.x1),column:u};break;case"top-left":f.anchor={x:l,y:l};break;case"top-right":f.anchor={x:a-l,y:l,column:QA};break;case"bottom-left":f.anchor={x:l,y:o-l,row:QA};break;case"bottom-right":f.anchor={x:a-l,y:o-l,column:QA,row:QA}}return f}function QD(e,t){var n,r,i=t.items[0],a=i.datum,o=i.orient,s=i.bounds,l=i.x,u=i.y;return i._bounds?i._bounds.clear().union(s):i._bounds=s.clone(),s.clear(),function(e,t,n){var r=t.padding,i=r-n.x,a=r-n.y;if(t.datum.title){var o=t.items[1].items[0],s=o.anchor,l=t.titlePadding||0,u=r-o.x,c=r-o.y;switch(o.orient){case GA:i+=Math.ceil(o.bounds.width())+l;break;case XA:case YA:break;default:a+=o.bounds.height()+l}switch((i||a)&&eC(e,n,i,a),o.orient){case GA:c+=ZD(t,n,o,s,1,1);break;case XA:u+=ZD(t,n,o,QA,0,0)+l,c+=ZD(t,n,o,s,1,1);break;case YA:u+=ZD(t,n,o,s,0,0),c+=ZD(t,n,o,QA,-1,0,1)+l;break;default:u+=ZD(t,n,o,s,0,0)}(u||c)&&eC(e,o,u,c),(u=Math.round(o.bounds.x1-r))<0&&(eC(e,n,-u,0),eC(e,o,-u,0))}else(i||a)&&eC(e,n,i,a)}(e,i,i.items[0].items[0]),s=function(e,t){return e.items.forEach((e=>t.union(e.bounds))),t.x1=e.padding,t.y1=e.padding,t}(i,s),n=2*i.padding,r=2*i.padding,s.empty()||(n=Math.ceil(s.width()+n),r=Math.ceil(s.height()+r)),"symbol"===a.type&&function(e){const t=e.reduce(((e,t)=>(e[t.column]=Math.max(t.bounds.x2-t.x,e[t.column]||0),e)),{});e.forEach((e=>{e.width=t[e.column],e.height=e.bounds.y2-e.y}))}(i.items[0].items[0].items[0].items),o!==mD&&(i.x=l=0,i.y=u=0),i.width=n,i.height=r,bS(s.set(l,u,l+n,u+r),i),i.mark.bounds.clear().union(s),i}function ZD(e,t,n,r,i,a,o){const s="symbol"!==e.datum.type,l=n.datum.vgrad,u=(!s||!a&&l||o?t:t.items[0]).bounds[i?"y2":"x2"]-e.padding,c=l&&a?u:0,f=l&&a?0:u,d=i<=0?0:Z$(n);return Math.round(r===JA?c:r===QA?f-d:.5*(u-d))}function eC(e,t,n,r){t.x+=n,t.y+=r,t.bounds.translate(n,r),t.mark.bounds.translate(n,r),e.dirty(t)}function tC(e){Cg.call(this,null,e)}kc(tC,Cg,{transform(e,t){const n=t.dataflow;return e.mark.items.forEach((t=>{e.layout&&HD(n,t,e.layout),function(e,t,n){var r,i,a,o,s,l=t.items,u=Math.max(0,t.width||0),c=Math.max(0,t.height||0),f=(new hS).set(0,0,u,c),d=f.clone(),h=f.clone(),p=[];for(o=0,s=l.length;o<s;++o)switch((i=l[o]).role){case eD:(RD(i)?d:h).union(PD(e,i,u,c));break;case tD:r=i;break;case iD:p.push(QD(e,i));break;case nD:case rD:case aD:case oD:case sD:case lD:case uD:case cD:d.union(i.bounds),h.union(i.bounds);break;default:f.union(i.bounds)}if(p.length){const t={};p.forEach((e=>{(a=e.orient||XA)!==mD&&(t[a]||(t[a]=[])).push(e)}));for(const r in t){const i=t[r];WD(e,i,KD(i,r,n.legends,d,h,u,c))}p.forEach((t=>{const r=t.bounds;if(r.equals(t._bounds)||(t.bounds=t._bounds,e.dirty(t),t.bounds=r,e.dirty(t)),n.autosize&&n.autosize.type===dD)switch(t.orient){case GA:case XA:f.add(r.x1,0).add(r.x2,0);break;case HA:case YA:f.add(0,r.y1).add(0,r.y2)}else f.union(r)}))}f.union(d).union(h),r&&f.union(function(e,t,n,r,i){var a,o=t.items[0],s=o.frame,l=o.orient,u=o.anchor,c=o.offset,f=o.padding,d=o.items[0].items[0],h=o.items[1]&&o.items[1].items[0],p=l===GA||l===XA?r:n,m=0,g=0,y=0,v=0,b=0;if(s!==ZA?l===GA?(m=i.y2,p=i.y1):l===XA?(m=i.y1,p=i.y2):(m=i.x1,p=i.x2):l===GA&&(m=r,p=0),a=u===JA?m:u===QA?p:(m+p)/2,h&&h.text){switch(l){case HA:case YA:b=d.bounds.height()+f;break;case GA:v=d.bounds.width()+f;break;case XA:v=-d.bounds.width()-f}TD.clear().union(h.bounds),TD.translate(v-(h.x||0),b-(h.y||0)),ND(h,"x",v)|ND(h,"y",b)&&(e.dirty(h),h.bounds.clear().union(TD),h.mark.bounds.clear().union(TD),e.dirty(h)),TD.clear().union(h.bounds)}else TD.clear();switch(TD.union(d.bounds),l){case HA:g=a,y=i.y1-TD.height()-c;break;case GA:g=i.x1-TD.width()-c,y=a;break;case XA:g=i.x2+TD.width()+c,y=a;break;case YA:g=a,y=i.y2+c;break;default:g=o.x,y=o.y}return ND(o,"x",g)|ND(o,"y",y)&&(TD.translate(g,y),e.dirty(o),o.bounds.clear().union(TD),t.bounds.clear().union(TD),e.dirty(o)),o.bounds}(e,r,u,c,f));t.clip&&f.set(0,0,t.width||0,t.height||0);!function(e,t,n,r){const i=r.autosize||{},a=i.type;if(e._autosize<1||!a)return;let o=e._width,s=e._height,l=Math.max(0,t.width||0),u=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,t.height||0),f=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-l)),h=Math.max(0,Math.ceil(n.y2-c));if(i.contains===fD){const t=e.padding();o-=t.left+t.right,s-=t.top+t.bottom}a===mD?(u=0,f=0,l=o,c=s):a===dD?(l=Math.max(0,o-u-d),c=Math.max(0,s-f-h)):a===hD?(l=Math.max(0,o-u-d),s=c+f+h):a===pD?(o=l+u+d,c=Math.max(0,s-f-h)):"pad"===a&&(o=l+u+d,s=c+f+h);e._resizeView(o,s,l,c,[u,f],i.resize)}(e,t,f,n)}(n,t,e)})),function(e){return e&&"legend-entry"!==e.mark.role}(e.mark.group)?t.reflow():t}});var nC=Object.freeze({__proto__:null,bound:wD,identifier:OD,mark:SD,overlap:$D,render:FD,viewlayout:tC});function rC(e){Cg.call(this,null,e)}function iC(e){Cg.call(this,null,e)}function aC(){return Zm({})}function oC(e){Cg.call(this,null,e)}function sC(e){Cg.call(this,[],e)}kc(rC,Cg,{transform(e,t){if(this.value&&!e.modified())return t.StopPropagation;var n=t.dataflow.locale(),r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=this.value,a=e.scale,o=Zk(a,null==e.count?e.values?e.values.length:10:e.count,e.minstep),s=e.format||nO(n,a,o,e.formatSpecifier,e.formatType,!!e.values),l=e.values?eO(a,e.values,o):tO(a,o);return i&&(r.rem=i),i=l.map(((e,t)=>Zm({index:t/(l.length-1||1),value:e,label:s(e)}))),e.extra&&i.length&&i.push(Zm({index:-1,extra:{value:i[0].value},label:""})),r.source=i,r.add=i,this.value=i,r}}),kc(iC,Cg,{transform(e,t){var n=t.dataflow,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=e.item||aC,a=e.key||Km,o=this.value;return Tu(r.encode)&&(r.encode=null),o&&(e.modified("key")||t.modified(a))&&ku("DataJoin does not support modified key function or fields."),o||(t=t.addAll(),this.value=o=function(e){const t=wc().test((e=>e.exit));return t.lookup=n=>t.get(e(n)),t}(a)),t.visit(t.ADD,(e=>{const t=a(e);let n=o.get(t);n?n.exit?(o.empty--,r.add.push(n)):r.mod.push(n):(n=i(e),o.set(t,n),r.add.push(n)),n.datum=e,n.exit=!1})),t.visit(t.MOD,(e=>{const t=a(e),n=o.get(t);n&&(n.datum=e,r.mod.push(n))})),t.visit(t.REM,(e=>{const t=a(e),n=o.get(t);e!==n.datum||n.exit||(r.rem.push(n),n.exit=!0,++o.empty)})),t.changed(t.ADD_MOD)&&r.modifies("datum"),(t.clean()||e.clean&&o.empty>n.cleanThreshold)&&n.runAfter(o.clean),r}}),kc(oC,Cg,{transform(e,t){var n=t.fork(t.ADD_REM),r=e.mod||!1,i=e.encoders,a=t.encode;if(Tu(a)){if(!n.changed()&&!a.every((e=>i[e])))return t.StopPropagation;a=a[0],n.encode=null}var o="enter"===a,s=i.update||Mu,l=i.enter||Mu,u=i.exit||Mu,c=(a&&!o?i[a]:s)||Mu;if(t.changed(t.ADD)&&(t.visit(t.ADD,(t=>{l(t,e),s(t,e)})),n.modifies(l.output),n.modifies(s.output),c!==Mu&&c!==s&&(t.visit(t.ADD,(t=>{c(t,e)})),n.modifies(c.output))),t.changed(t.REM)&&u!==Mu&&(t.visit(t.REM,(t=>{u(t,e)})),n.modifies(u.output)),o||c!==Mu){const i=t.MOD|(e.modified()?t.REFLOW:0);o?(t.visit(i,(t=>{const i=l(t,e)||r;(c(t,e)||i)&&n.mod.push(t)})),n.mod.length&&n.modifies(l.output)):t.visit(i,(t=>{(c(t,e)||r)&&n.mod.push(t)})),n.mod.length&&n.modifies(c.output)}return n.changed()?n:t.StopPropagation}}),kc(sC,Cg,{transform(e,t){if(null!=this.value&&!e.modified())return t.StopPropagation;var n,r,i,a,o,s=t.dataflow.locale(),l=t.fork(t.NO_SOURCE|t.NO_FIELDS),u=this.value,c=e.type||Yk,f=e.scale,d=+e.limit,h=Zk(f,null==e.count?5:e.count,e.minstep),p=!!e.values||c===Yk,m=e.format||sO(s,f,h,c,e.formatSpecifier,e.formatType,p),g=e.values||oO(f,h);return u&&(l.rem=u),c===Yk?(d&&g.length>d?(t.dataflow.warn("Symbol legend count exceeds limit, filtering items."),u=g.slice(0,d-1),o=!0):u=g,sc(i=e.size)?(e.values||0!==f(u[0])||(u=u.slice(1)),a=u.reduce(((t,n)=>Math.max(t,i(n,e))),0)):i=hc(a=i||8),u=u.map(((t,n)=>Zm({index:n,label:m(t,n,u),value:t,offset:a,size:i(t,e)}))),o&&(o=g[u.length],u.push(Zm({index:u.length,label:"…".concat(g.length-u.length," entries"),value:o,offset:a,size:i(o,e)})))):"gradient"===c?(n=f.domain(),r=Uk(f,n[0],Lu(n)),g.length<3&&!e.values&&n[0]!==Lu(n)&&(g=[n[0],Lu(n)]),u=g.map(((e,t)=>Zm({index:t,label:m(e,t,g),value:e,perc:r(e)})))):(i=g.length-1,r=function(e){const t=e.domain(),n=t.length-1;let r=+t[0],i=+Lu(t),a=i-r;if(e.type===hk){const e=n?a/n:.1;r-=e,i+=e,a=i-r}return e=>(e-r)/a}(f),u=g.map(((e,t)=>Zm({index:t,label:m(e,t,g),value:e,perc:t?r(e):0,perc2:t===i?1:r(g[t+1])})))),l.source=u,l.add=u,this.value=u,l}});const lC=e=>e.source.x,uC=e=>e.source.y,cC=e=>e.target.x,fC=e=>e.target.y;function dC(e){Cg.call(this,{},e)}dC.Definition={type:"LinkPath",metadata:{modifies:!0},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]},kc(dC,Cg,{transform(e,t){var n=e.sourceX||lC,r=e.sourceY||uC,i=e.targetX||cC,a=e.targetY||fC,o=e.as||"path",s=e.orient||"vertical",l=e.shape||"line",u=gC.get(l+"-"+s)||gC.get(l);return u||ku("LinkPath unsupported type: "+e.shape+(e.orient?"-"+e.orient:"")),t.visit(t.SOURCE,(e=>{e[o]=u(n(e),r(e),i(e),a(e))})),t.reflow(e.modified()).modifies(o)}});const hC=(e,t,n,r)=>"M"+e+","+t+"L"+n+","+r,pC=(e,t,n,r)=>{var i=n-e,a=r-t,o=Math.sqrt(i*i+a*a)/2;return"M"+e+","+t+"A"+o+","+o+" "+180*Math.atan2(a,i)/Math.PI+" 0 1 "+n+","+r},mC=(e,t,n,r)=>{const i=n-e,a=r-t,o=.2*(i+a),s=.2*(a-i);return"M"+e+","+t+"C"+(e+o)+","+(t+s)+" "+(n+s)+","+(r-o)+" "+n+","+r},gC=wc({line:hC,"line-radial":(e,t,n,r)=>hC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),arc:pC,"arc-radial":(e,t,n,r)=>pC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),curve:mC,"curve-radial":(e,t,n,r)=>mC(t*Math.cos(e),t*Math.sin(e),r*Math.cos(n),r*Math.sin(n)),"orthogonal-horizontal":(e,t,n,r)=>"M"+e+","+t+"V"+r+"H"+n,"orthogonal-vertical":(e,t,n,r)=>"M"+e+","+t+"H"+n+"V"+r,"orthogonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n);return"M"+t*i+","+t*a+"A"+t+","+t+" 0 0,"+((Math.abs(n-e)>Math.PI?n<=e:n>e)?1:0)+" "+t*o+","+t*s+"L"+r*o+","+r*s},"diagonal-horizontal":(e,t,n,r)=>{const i=(e+n)/2;return"M"+e+","+t+"C"+i+","+t+" "+i+","+r+" "+n+","+r},"diagonal-vertical":(e,t,n,r)=>{const i=(t+r)/2;return"M"+e+","+t+"C"+e+","+i+" "+n+","+i+" "+n+","+r},"diagonal-radial":(e,t,n,r)=>{const i=Math.cos(e),a=Math.sin(e),o=Math.cos(n),s=Math.sin(n),l=(t+r)/2;return"M"+t*i+","+t*a+"C"+l*i+","+l*a+" "+l*o+","+l*s+" "+r*o+","+r*s}});function yC(e){Cg.call(this,null,e)}yC.Definition={type:"Pie",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:!1},{name:"as",type:"string",array:!0,length:2,default:["startAngle","endAngle"]}]},kc(yC,Cg,{transform(e,t){var n,r,i,a=e.as||["startAngle","endAngle"],o=a[0],s=a[1],l=e.field||Du,u=e.startAngle||0,c=null!=e.endAngle?e.endAngle:2*Math.PI,f=t.source,d=f.map(l),h=d.length,p=u,m=(c-u)/td(d),g=ed(h);for(e.sort&&g.sort(((e,t)=>d[e]-d[t])),n=0;n<h;++n)i=d[g[n]],(r=f[g[n]])[o]=p,r[s]=p+=i*m;return this.value=d,t.reflow(e.modified()).modifies(a)}});function vC(e){return Fk(e)&&e!==uk}const bC=Uc(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function xC(e){Cg.call(this,null,e),this.modified(!0)}function wC(e,t,n){Rk(e)&&(Math.abs(t.reduce(((e,t)=>e+(t<0?-1:t>0?1:0)),0))!==t.length&&n.warn("Log scale domain includes zero: "+zc(t)));return t}function _C(e,t,n){return sc(e)&&(t||n)?Lk(e,kC(t||[0,1],n)):e}function kC(e,t){return t?e.slice().reverse():e}function OC(e){Cg.call(this,null,e)}kc(xC,Cg,{transform(e,t){var n=t.dataflow,r=this.value,i=function(e){var t,n=e.type,r="";if(n===uk)return"sequential-linear";(function(e){const t=e.type;return Fk(t)&&t!==sk&&t!==lk&&(e.scheme||e.range&&e.range.length&&e.range.every(Cc))})(e)&&(r=2===(t=e.rawDomain?e.rawDomain.length:e.domain?e.domain.length+ +(null!=e.domainMid):0)?"sequential-":3===t?"diverging-":"");return(r+n||nk).toLowerCase()}(e);for(i in r&&i===r.type||(this.value=r=Ck(i)()),e)if(!bC[i]){if("padding"===i&&vC(r.type))continue;sc(r[i])?r[i](e[i]):n.warn("Unsupported scale property: "+i)}return function(e,t,n){var r=e.type,i=t.round||!1,a=t.range;if(null!=t.rangeStep)a=function(e,t,n){e!==gk&&e!==mk&&ku("Only band and point scales support rangeStep.");var r=(null!=t.paddingOuter?t.paddingOuter:t.padding)||0,i=e===mk?1:(null!=t.paddingInner?t.paddingInner:t.padding)||0;return[0,t.rangeStep*tk(n,i,r)]}(r,t,n);else if(t.scheme&&(a=function(e,t,n){var r,i=t.schemeExtent;Tu(t.scheme)?r=Ik(t.scheme,t.interpolate,t.interpolateGamma):(r=Xk(t.scheme.toLowerCase()))||ku("Unrecognized scheme name: ".concat(t.scheme));return n=e===hk?n+1:e===yk?n-1:e===fk||e===dk?+t.schemeCount||5:n,Pk(e)?_C(r,i,t.reverse):sc(r)?qk(_C(r,i),n):e===pk?r:r.slice(0,n)}(r,t,n),sc(a))){if(e.interpolator)return e.interpolator(a);ku("Scale type ".concat(r," does not support interpolating color schemes."))}if(a&&Pk(r))return e.interpolator(Ik(kC(a,t.reverse),t.interpolate,t.interpolateGamma));a&&t.interpolate&&e.interpolate?e.interpolate(Vk(t.interpolate,t.interpolateGamma)):sc(e.round)?e.round(i):sc(e.rangeRound)&&e.interpolate(i?Hw:Ww);a&&e.range(kC(a,t.reverse))}(r,e,function(e,t,n){let r=t.bins;if(r&&!Tu(r)){const t=e.domain(),n=t[0],i=Lu(t),a=r.step;let o=null==r.start?n:r.start,s=null==r.stop?i:r.stop;a||ku("Scale bins parameter missing step property."),o<n&&(o=a*Math.ceil(n/a)),s>i&&(s=a*Math.floor(i/a)),r=ed(o,s+a/2,a)}r?e.bins=r:e.bins&&delete e.bins;e.type===yk&&(r?t.domain||t.domainRaw||(e.domain(r),n=r.length):e.bins=e.domain());return n}(r,e,function(e,t,n){const r=function(e,t,n){return t?(e.domain(wC(e.type,t,n)),t.length):-1}(e,t.domainRaw,n);if(r>-1)return r;var i,a,o=t.domain,s=e.type,l=t.zero||void 0===t.zero&&function(e){const t=e.type;return!e.bins&&(t===nk||t===ik||t===ak)}(e);if(!o)return 0;vC(s)&&t.padding&&o[0]!==Lu(o)&&(o=function(e,t,n,r,i,a){var o=Math.abs(Lu(n)-n[0]),s=o/(o-2*r),l=e===rk?ec(t,null,s):e===ak?tc(t,null,s,.5):e===ik?tc(t,null,s,i||1):e===ok?nc(t,null,s,a||1):Zu(t,null,s);return(t=t.slice())[0]=l[0],t[t.length-1]=l[1],t}(s,o,t.range,t.padding,t.exponent,t.constant));if((l||null!=t.domainMin||null!=t.domainMax||null!=t.domainMid)&&(i=(o=o.slice()).length-1||1,l&&(o[0]>0&&(o[0]=0),o[i]<0&&(o[i]=0)),null!=t.domainMin&&(o[0]=t.domainMin),null!=t.domainMax&&(o[i]=t.domainMax),null!=t.domainMid)){const e=(a=t.domainMid)>o[i]?i+1:a<o[0]?0:i;e!==i&&n.warn("Scale domainMid exceeds domain min or max.",a),o.splice(e,0,a)}e.domain(wC(s,o,n)),s===pk&&e.unknown(t.domainImplicit?mx:void 0);t.nice&&e.nice&&e.nice(!0!==t.nice&&Zk(e,t.nice)||null);return o.length}(r,e,n))),t.fork(t.NO_SOURCE|t.NO_FIELDS)}}),kc(OC,Cg,{transform(e,t){const n=e.modified("sort")||t.changed(t.ADD)||t.modified(e.sort.fields)||t.modified("datum");return n&&t.source.sort(rg(e.sort)),this.modified(n),t}});const SC="zero",$C="center",EC="normalize",AC=["y0","y1"];function DC(e){Cg.call(this,null,e)}function CC(e,t,n,r,i){for(var a,o=(t-e.sum)/2,s=e.length,l=0;l<s;++l)(a=e[l])[r]=o,a[i]=o+=Math.abs(n(a))}function MC(e,t,n,r,i){for(var a,o=1/e.sum,s=0,l=e.length,u=0,c=0;u<l;++u)(a=e[u])[r]=s,a[i]=s=o*(c+=Math.abs(n(a)))}function jC(e,t,n,r,i){for(var a,o,s=0,l=0,u=e.length,c=0;c<u;++c)(a=+n(o=e[c]))<0?(o[r]=l,o[i]=l+=a):(o[r]=s,o[i]=s+=a)}DC.Definition={type:"Stack",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:!0},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:SC,values:[SC,$C,EC]},{name:"as",type:"string",array:!0,length:2,default:AC}]},kc(DC,Cg,{transform(e,t){var n,r,i,a,o=e.as||AC,s=o[0],l=o[1],u=rg(e.sort),c=e.field||Du,f=e.offset===$C?CC:e.offset===EC?MC:jC;for(n=function(e,t,n,r){var i,a,o,s,l,u,c,f,d,h=[],p=e=>e(l);if(null==t)h.push(e.slice());else for(i={},a=0,o=e.length;a<o;++a)l=e[a],(c=i[u=t.map(p)])||(i[u]=c=[],h.push(c)),c.push(l);for(u=0,d=0,s=h.length;u<s;++u){for(a=0,f=0,o=(c=h[u]).length;a<o;++a)f+=Math.abs(r(c[a]));c.sum=f,f>d&&(d=f),n&&c.sort(n)}return h.max=d,h}(t.source,e.groupby,u,c),r=0,i=n.length,a=n.max;r<i;++r)f(n[r],a,c,s,l);return t.reflow(e.modified()).modifies(o)}});var FC=Object.freeze({__proto__:null,axisticks:rC,datajoin:iC,encode:oC,legendentries:sC,linkpath:dC,pie:yC,scale:xC,sortitems:OC,stack:DC}),TC=1e-6,NC=1e-12,RC=Math.PI,PC=RC/2,zC=RC/4,BC=2*RC,LC=180/RC,IC=RC/180,qC=Math.abs,UC=Math.atan,VC=Math.atan2,WC=Math.cos,HC=Math.ceil,GC=Math.exp,XC=Math.hypot,YC=Math.log,JC=Math.pow,KC=Math.sin,QC=Math.sign||function(e){return e>0?1:e<0?-1:0},ZC=Math.sqrt,eM=Math.tan;function tM(e){return e>1?0:e<-1?RC:Math.acos(e)}function nM(e){return e>1?PC:e<-1?-PC:Math.asin(e)}function rM(){}function iM(e,t){e&&oM.hasOwnProperty(e.type)&&oM[e.type](e,t)}var aM={Feature:function(e,t){iM(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)iM(n[r].geometry,t)}},oM={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){sM(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)sM(n[r],t,0)},Polygon:function(e,t){lM(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)lM(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)iM(n[r],t)}};function sM(e,t,n){var r,i=-1,a=e.length-n;for(t.lineStart();++i<a;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function lM(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)sM(e[n],t,1);t.polygonEnd()}function uM(e,t){e&&aM.hasOwnProperty(e.type)?aM[e.type](e,t):iM(e,t)}var cM,fM,dM,hM,pM,mM,gM,yM,vM,bM,xM,wM,_M,kM,OM,SM,$M=new Bf,EM=new Bf,AM={point:rM,lineStart:rM,lineEnd:rM,polygonStart:function(){$M=new Bf,AM.lineStart=DM,AM.lineEnd=CM},polygonEnd:function(){var e=+$M;EM.add(e<0?BC+e:e),this.lineStart=this.lineEnd=this.point=rM},sphere:function(){EM.add(BC)}};function DM(){AM.point=MM}function CM(){jM(cM,fM)}function MM(e,t){AM.point=jM,cM=e,fM=t,dM=e*=IC,hM=WC(t=(t*=IC)/2+zC),pM=KC(t)}function jM(e,t){var n=(e*=IC)-dM,r=n>=0?1:-1,i=r*n,a=WC(t=(t*=IC)/2+zC),o=KC(t),s=pM*o,l=hM*a+s*WC(i),u=s*r*KC(i);$M.add(VC(u,l)),dM=e,hM=a,pM=o}function FM(e){return[VC(e[1],e[0]),nM(e[2])]}function TM(e){var t=e[0],n=e[1],r=WC(n);return[r*WC(t),r*KC(t),KC(n)]}function NM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function RM(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function PM(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function zM(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function BM(e){var t=ZC(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}var LM,IM,qM,UM,VM,WM,HM,GM,XM,YM,JM,KM,QM,ZM,ej,tj,nj={point:rj,lineStart:aj,lineEnd:oj,polygonStart:function(){nj.point=sj,nj.lineStart=lj,nj.lineEnd=uj,kM=new Bf,AM.polygonStart()},polygonEnd:function(){AM.polygonEnd(),nj.point=rj,nj.lineStart=aj,nj.lineEnd=oj,$M<0?(mM=-(yM=180),gM=-(vM=90)):kM>TC?vM=90:kM<-1e-6&&(gM=-90),SM[0]=mM,SM[1]=yM},sphere:function(){mM=-(yM=180),gM=-(vM=90)}};function rj(e,t){OM.push(SM=[mM=e,yM=e]),t<gM&&(gM=t),t>vM&&(vM=t)}function ij(e,t){var n=TM([e*IC,t*IC]);if(_M){var r=RM(_M,n),i=RM([r[1],-r[0],0],r);BM(i),i=FM(i);var a,o=e-bM,s=o>0?1:-1,l=i[0]*LC*s,u=qC(o)>180;u^(s*bM<l&&l<s*e)?(a=i[1]*LC)>vM&&(vM=a):u^(s*bM<(l=(l+360)%360-180)&&l<s*e)?(a=-i[1]*LC)<gM&&(gM=a):(t<gM&&(gM=t),t>vM&&(vM=t)),u?e<bM?cj(mM,e)>cj(mM,yM)&&(yM=e):cj(e,yM)>cj(mM,yM)&&(mM=e):yM>=mM?(e<mM&&(mM=e),e>yM&&(yM=e)):e>bM?cj(mM,e)>cj(mM,yM)&&(yM=e):cj(e,yM)>cj(mM,yM)&&(mM=e)}else OM.push(SM=[mM=e,yM=e]);t<gM&&(gM=t),t>vM&&(vM=t),_M=n,bM=e}function aj(){nj.point=ij}function oj(){SM[0]=mM,SM[1]=yM,nj.point=rj,_M=null}function sj(e,t){if(_M){var n=e-bM;kM.add(qC(n)>180?n+(n>0?360:-360):n)}else xM=e,wM=t;AM.point(e,t),ij(e,t)}function lj(){AM.lineStart()}function uj(){sj(xM,wM),AM.lineEnd(),qC(kM)>TC&&(mM=-(yM=180)),SM[0]=mM,SM[1]=yM,_M=null}function cj(e,t){return(t-=e)<0?t+360:t}function fj(e,t){return e[0]-t[0]}function dj(e,t){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var hj={sphere:rM,point:pj,lineStart:gj,lineEnd:bj,polygonStart:function(){hj.lineStart=xj,hj.lineEnd=wj},polygonEnd:function(){hj.lineStart=gj,hj.lineEnd=bj}};function pj(e,t){e*=IC;var n=WC(t*=IC);mj(n*WC(e),n*KC(e),KC(t))}function mj(e,t,n){++LM,qM+=(e-qM)/LM,UM+=(t-UM)/LM,VM+=(n-VM)/LM}function gj(){hj.point=yj}function yj(e,t){e*=IC;var n=WC(t*=IC);ZM=n*WC(e),ej=n*KC(e),tj=KC(t),hj.point=vj,mj(ZM,ej,tj)}function vj(e,t){e*=IC;var n=WC(t*=IC),r=n*WC(e),i=n*KC(e),a=KC(t),o=VC(ZC((o=ej*a-tj*i)*o+(o=tj*r-ZM*a)*o+(o=ZM*i-ej*r)*o),ZM*r+ej*i+tj*a);IM+=o,WM+=o*(ZM+(ZM=r)),HM+=o*(ej+(ej=i)),GM+=o*(tj+(tj=a)),mj(ZM,ej,tj)}function bj(){hj.point=pj}function xj(){hj.point=_j}function wj(){kj(KM,QM),hj.point=pj}function _j(e,t){KM=e,QM=t,e*=IC,t*=IC,hj.point=kj;var n=WC(t);ZM=n*WC(e),ej=n*KC(e),tj=KC(t),mj(ZM,ej,tj)}function kj(e,t){e*=IC;var n=WC(t*=IC),r=n*WC(e),i=n*KC(e),a=KC(t),o=ej*a-tj*i,s=tj*r-ZM*a,l=ZM*i-ej*r,u=XC(o,s,l),c=nM(u),f=u&&-c/u;XM.add(f*o),YM.add(f*s),JM.add(f*l),IM+=c,WM+=c*(ZM+(ZM=r)),HM+=c*(ej+(ej=i)),GM+=c*(tj+(tj=a)),mj(ZM,ej,tj)}function Oj(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return(n=t.invert(n,r))&&e.invert(n[0],n[1])}),n}function Sj(e,t){return[qC(e)>RC?e+Math.round(-e/BC)*BC:e,t]}function $j(e,t,n){return(e%=BC)?t||n?Oj(Aj(e),Dj(t,n)):Aj(e):t||n?Dj(t,n):Sj}function Ej(e){return function(t,n){return[(t+=e)>RC?t-BC:t<-RC?t+BC:t,n]}}function Aj(e){var t=Ej(e);return t.invert=Ej(-e),t}function Dj(e,t){var n=WC(e),r=KC(e),i=WC(t),a=KC(t);function o(e,t){var o=WC(t),s=WC(e)*o,l=KC(e)*o,u=KC(t),c=u*n+s*r;return[VC(l*i-c*a,s*n-u*r),nM(c*i+l*a)]}return o.invert=function(e,t){var o=WC(t),s=WC(e)*o,l=KC(e)*o,u=KC(t),c=u*i-l*a;return[VC(l*i+u*a,s*n+c*r),nM(c*n-s*r)]},o}function Cj(e,t){(t=TM(t))[0]-=e,BM(t);var n=tM(-t[1]);return((-t[2]<0?-n:n)+BC-TC)%BC}function Mj(){var e,t=[];return{point:function(t,n,r){e.push([t,n,r])},lineStart:function(){t.push(e=[])},lineEnd:rM,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function jj(e,t){return qC(e[0]-t[0])<TC&&qC(e[1]-t[1])<TC}function Fj(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Tj(e,t,n,r,i){var a,o,s=[],l=[];if(e.forEach((function(e){if(!((t=e.length-1)<=0)){var t,n,r=e[0],o=e[t];if(jj(r,o)){if(!r[2]&&!o[2]){for(i.lineStart(),a=0;a<t;++a)i.point((r=e[a])[0],r[1]);return void i.lineEnd()}o[0]+=2e-6}s.push(n=new Fj(r,e,null,!0)),l.push(n.o=new Fj(r,null,n,!1)),s.push(n=new Fj(o,e,null,!1)),l.push(n.o=new Fj(o,null,n,!0))}})),s.length){for(l.sort(t),Nj(s),Nj(l),a=0,o=l.length;a<o;++a)l[a].e=n=!n;for(var u,c,f=s[0];;){for(var d=f,h=!0;d.v;)if((d=d.n)===f)return;u=d.z,i.lineStart();do{if(d.v=d.o.v=!0,d.e){if(h)for(a=0,o=u.length;a<o;++a)i.point((c=u[a])[0],c[1]);else r(d.x,d.n.x,1,i);d=d.n}else{if(h)for(u=d.p.z,a=u.length-1;a>=0;--a)i.point((c=u[a])[0],c[1]);else r(d.x,d.p.x,-1,i);d=d.p}u=(d=d.o).z,h=!h}while(!d.v);i.lineEnd()}}}function Nj(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Rj(e){return qC(e[0])<=RC?e[0]:QC(e[0])*((qC(e[0])+RC)%BC-RC)}function Pj(e,t,n,r){return function(i){var a,o,s,l=t(i),u=Mj(),c=t(u),f=!1,d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=y,d.lineStart=v,d.lineEnd=b,o=[],a=[]},polygonEnd:function(){d.point=h,d.lineStart=m,d.lineEnd=g,o=Zf(o);var e=function(e,t){var n=Rj(t),r=t[1],i=KC(r),a=[KC(n),-WC(n),0],o=0,s=0,l=new Bf;1===i?r=PC+TC:-1===i&&(r=-PC-TC);for(var u=0,c=e.length;u<c;++u)if(d=(f=e[u]).length)for(var f,d,h=f[d-1],p=Rj(h),m=h[1]/2+zC,g=KC(m),y=WC(m),v=0;v<d;++v,p=x,g=_,y=k,h=b){var b=f[v],x=Rj(b),w=b[1]/2+zC,_=KC(w),k=WC(w),O=x-p,S=O>=0?1:-1,$=S*O,E=$>RC,A=g*_;if(l.add(VC(A*S*KC($),y*k+A*WC($))),o+=E?O+S*BC:O,E^p>=n^x>=n){var D=RM(TM(h),TM(b));BM(D);var C=RM(a,D);BM(C);var M=(E^O>=0?-1:1)*nM(C[2]);(r>M||r===M&&(D[0]||D[1]))&&(s+=E^O>=0?1:-1)}}return(o<-1e-6||o<TC&&l<-1e-12)^1&s}(a,r);o.length?(f||(i.polygonStart(),f=!0),Tj(o,Bj,e,n,i)):e&&(f||(i.polygonStart(),f=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),f&&(i.polygonEnd(),f=!1),o=a=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function h(t,n){e(t,n)&&i.point(t,n)}function p(e,t){l.point(e,t)}function m(){d.point=p,l.lineStart()}function g(){d.point=h,l.lineEnd()}function y(e,t){s.push([e,t]),c.point(e,t)}function v(){c.lineStart(),s=[]}function b(){y(s[0][0],s[0][1]),c.lineEnd();var e,t,n,r,l=c.clean(),d=u.result(),h=d.length;if(s.pop(),a.push(s),s=null,h)if(1&l){if((t=(n=d[0]).length-1)>0){for(f||(i.polygonStart(),f=!0),i.lineStart(),e=0;e<t;++e)i.point((r=n[e])[0],r[1]);i.lineEnd()}}else h>1&&2&l&&d.push(d.pop().concat(d.shift())),o.push(d.filter(zj))}return d}}function zj(e){return e.length>1}function Bj(e,t){return((e=e.x)[0]<0?e[1]-PC-TC:PC-e[1])-((t=t.x)[0]<0?t[1]-PC-TC:PC-t[1])}Sj.invert=Sj;var Lj=Pj((function(){return!0}),(function(e){var t,n=NaN,r=NaN,i=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,o){var s=a>0?RC:-RC,l=qC(a-n);qC(l-RC)<TC?(e.point(n,r=(r+o)/2>0?PC:-PC),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),e.point(a,r),t=0):i!==s&&l>=RC&&(qC(n-i)<TC&&(n-=i*TC),qC(a-s)<TC&&(a-=s*TC),r=function(e,t,n,r){var i,a,o=KC(e-n);return qC(o)>TC?UC((KC(t)*(a=WC(r))*KC(n)-KC(r)*(i=WC(t))*KC(e))/(i*a*o)):(t+r)/2}(n,r,a,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(s,r),t=0),e.point(n=a,r=o),i=s},lineEnd:function(){e.lineEnd(),n=r=NaN},clean:function(){return 2-t}}}),(function(e,t,n,r){var i;if(null==e)i=n*PC,r.point(-RC,i),r.point(0,i),r.point(RC,i),r.point(RC,0),r.point(RC,-i),r.point(0,-i),r.point(-RC,-i),r.point(-RC,0),r.point(-RC,i);else if(qC(e[0]-t[0])>TC){var a=e[0]<t[0]?RC:-RC;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(t[0],t[1])}),[-RC,-PC]);function Ij(e){var t=WC(e),n=6*IC,r=t>0,i=qC(t)>TC;function a(e,n){return WC(e)*WC(n)>t}function o(e,n,r){var i=[1,0,0],a=RM(TM(e),TM(n)),o=NM(a,a),s=a[0],l=o-s*s;if(!l)return!r&&e;var u=t*o/l,c=-t*s/l,f=RM(i,a),d=zM(i,u);PM(d,zM(a,c));var h=f,p=NM(d,h),m=NM(h,h),g=p*p-m*(NM(d,d)-1);if(!(g<0)){var y=ZC(g),v=zM(h,(-p-y)/m);if(PM(v,d),v=FM(v),!r)return v;var b,x=e[0],w=n[0],_=e[1],k=n[1];w<x&&(b=x,x=w,w=b);var O=w-x,S=qC(O-RC)<TC;if(!S&&k<_&&(b=_,_=k,k=b),S||O<TC?S?_+k>0^v[1]<(qC(v[0]-x)<TC?_:k):_<=v[1]&&v[1]<=k:O>RC^(x<=v[0]&&v[0]<=w)){var $=zM(h,(-p+y)/m);return PM($,d),[v,FM($)]}}}function s(t,n){var i=r?e:RC-e,a=0;return t<-i?a|=1:t>i&&(a|=2),n<-i?a|=4:n>i&&(a|=8),a}return Pj(a,(function(e){var t,n,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(f,d){var h,p=[f,d],m=a(f,d),g=r?m?0:s(f,d):m?s(f+(f<0?RC:-RC),d):0;if(!t&&(u=l=m)&&e.lineStart(),m!==l&&(!(h=o(t,p))||jj(t,h)||jj(p,h))&&(p[2]=1),m!==l)c=0,m?(e.lineStart(),h=o(p,t),e.point(h[0],h[1])):(h=o(t,p),e.point(h[0],h[1],2),e.lineEnd()),t=h;else if(i&&t&&r^m){var y;g&n||!(y=o(p,t,!0))||(c=0,r?(e.lineStart(),e.point(y[0][0],y[0][1]),e.point(y[1][0],y[1][1]),e.lineEnd()):(e.point(y[1][0],y[1][1]),e.lineEnd(),e.lineStart(),e.point(y[0][0],y[0][1],3)))}!m||t&&jj(t,p)||e.point(p[0],p[1]),t=p,l=m,n=g},lineEnd:function(){l&&e.lineEnd(),t=null},clean:function(){return c|(u&&l)<<1}}}),(function(t,r,i,a){!function(e,t,n,r,i,a){if(n){var o=WC(t),s=KC(t),l=r*n;null==i?(i=t+r*BC,a=t-l/2):(i=Cj(o,i),a=Cj(o,a),(r>0?i<a:i>a)&&(i+=r*BC));for(var u,c=i;r>0?c>a:c<a;c-=l)u=FM([o,-s*WC(c),-s*KC(c)]),e.point(u[0],u[1])}}(a,e,n,i,t,r)}),r?[0,-e]:[-RC,e-RC])}var qj=1e9,Uj=-qj;function Vj(e,t,n,r){function i(i,a){return e<=i&&i<=n&&t<=a&&a<=r}function a(i,a,s,u){var c=0,f=0;if(null==i||(c=o(i,s))!==(f=o(a,s))||l(i,a)<0^s>0)do{u.point(0===c||3===c?e:n,c>1?r:t)}while((c=(c+s+4)%4)!==f);else u.point(a[0],a[1])}function o(r,i){return qC(r[0]-e)<TC?i>0?0:3:qC(r[0]-n)<TC?i>0?2:1:qC(r[1]-t)<TC?i>0?1:0:i>0?3:2}function s(e,t){return l(e.x,t.x)}function l(e,t){var n=o(e,1),r=o(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){var l,u,c,f,d,h,p,m,g,y,v,b=o,x=Mj(),w={point:_,lineStart:function(){w.point=k,u&&u.push(c=[]);y=!0,g=!1,p=m=NaN},lineEnd:function(){l&&(k(f,d),h&&g&&x.rejoin(),l.push(x.result()));w.point=_,g&&b.lineEnd()},polygonStart:function(){b=x,l=[],u=[],v=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,i=u.length;n<i;++n)for(var a,o,s=u[n],l=1,c=s.length,f=s[0],d=f[0],h=f[1];l<c;++l)a=d,o=h,d=(f=s[l])[0],h=f[1],o<=r?h>r&&(d-a)*(r-o)>(h-o)*(e-a)&&++t:h<=r&&(d-a)*(r-o)<(h-o)*(e-a)&&--t;return t}(),n=v&&t,i=(l=Zf(l)).length;(n||i)&&(o.polygonStart(),n&&(o.lineStart(),a(null,null,1,o),o.lineEnd()),i&&Tj(l,s,t,a,o),o.polygonEnd());b=o,l=u=c=null}};function _(e,t){i(e,t)&&b.point(e,t)}function k(a,o){var s=i(a,o);if(u&&c.push([a,o]),y)f=a,d=o,h=s,y=!1,s&&(b.lineStart(),b.point(a,o));else if(s&&g)b.point(a,o);else{var l=[p=Math.max(Uj,Math.min(qj,p)),m=Math.max(Uj,Math.min(qj,m))],x=[a=Math.max(Uj,Math.min(qj,a)),o=Math.max(Uj,Math.min(qj,o))];!function(e,t,n,r,i,a){var o,s=e[0],l=e[1],u=0,c=1,f=t[0]-s,d=t[1]-l;if(o=n-s,f||!(o>0)){if(o/=f,f<0){if(o<u)return;o<c&&(c=o)}else if(f>0){if(o>c)return;o>u&&(u=o)}if(o=i-s,f||!(o<0)){if(o/=f,f<0){if(o>c)return;o>u&&(u=o)}else if(f>0){if(o<u)return;o<c&&(c=o)}if(o=r-l,d||!(o>0)){if(o/=d,d<0){if(o<u)return;o<c&&(c=o)}else if(d>0){if(o>c)return;o>u&&(u=o)}if(o=a-l,d||!(o<0)){if(o/=d,d<0){if(o>c)return;o>u&&(u=o)}else if(d>0){if(o<u)return;o<c&&(c=o)}return u>0&&(e[0]=s+u*f,e[1]=l+u*d),c<1&&(t[0]=s+c*f,t[1]=l+c*d),!0}}}}}(l,x,e,t,n,r)?s&&(b.lineStart(),b.point(a,o),v=!1):(g||(b.lineStart(),b.point(l[0],l[1])),b.point(x[0],x[1]),s||b.lineEnd(),v=!1)}p=a,m=o,g=s}return w}}function Wj(e,t,n){var r=ed(e,t-TC,n).concat(t);return function(e){return r.map((function(t){return[e,t]}))}}function Hj(e,t,n){var r=ed(e,t-TC,n).concat(t);return function(e){return r.map((function(t){return[t,e]}))}}var Gj,Xj,Yj,Jj,Kj=e=>e,Qj=new Bf,Zj=new Bf,eF={point:rM,lineStart:rM,lineEnd:rM,polygonStart:function(){eF.lineStart=tF,eF.lineEnd=iF},polygonEnd:function(){eF.lineStart=eF.lineEnd=eF.point=rM,Qj.add(qC(Zj)),Zj=new Bf},result:function(){var e=Qj/2;return Qj=new Bf,e}};function tF(){eF.point=nF}function nF(e,t){eF.point=rF,Gj=Yj=e,Xj=Jj=t}function rF(e,t){Zj.add(Jj*e-Yj*t),Yj=e,Jj=t}function iF(){rF(Gj,Xj)}var aF=1/0,oF=aF,sF=-aF,lF=sF,uF={point:function(e,t){e<aF&&(aF=e);e>sF&&(sF=e);t<oF&&(oF=t);t>lF&&(lF=t)},lineStart:rM,lineEnd:rM,polygonStart:rM,polygonEnd:rM,result:function(){var e=[[aF,oF],[sF,lF]];return sF=lF=-(oF=aF=1/0),e}};var cF,fF,dF,hF,pF=0,mF=0,gF=0,yF=0,vF=0,bF=0,xF=0,wF=0,_F=0,kF={point:OF,lineStart:SF,lineEnd:AF,polygonStart:function(){kF.lineStart=DF,kF.lineEnd=CF},polygonEnd:function(){kF.point=OF,kF.lineStart=SF,kF.lineEnd=AF},result:function(){var e=_F?[xF/_F,wF/_F]:bF?[yF/bF,vF/bF]:gF?[pF/gF,mF/gF]:[NaN,NaN];return pF=mF=gF=yF=vF=bF=xF=wF=_F=0,e}};function OF(e,t){pF+=e,mF+=t,++gF}function SF(){kF.point=$F}function $F(e,t){kF.point=EF,OF(dF=e,hF=t)}function EF(e,t){var n=e-dF,r=t-hF,i=ZC(n*n+r*r);yF+=i*(dF+e)/2,vF+=i*(hF+t)/2,bF+=i,OF(dF=e,hF=t)}function AF(){kF.point=OF}function DF(){kF.point=MF}function CF(){jF(cF,fF)}function MF(e,t){kF.point=jF,OF(cF=dF=e,fF=hF=t)}function jF(e,t){var n=e-dF,r=t-hF,i=ZC(n*n+r*r);yF+=i*(dF+e)/2,vF+=i*(hF+t)/2,bF+=i,xF+=(i=hF*e-dF*t)*(dF+e),wF+=i*(hF+t),_F+=3*i,OF(dF=e,hF=t)}function FF(e){this._context=e}FF.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,BC)}},result:rM};var TF,NF,RF,PF,zF,BF=new Bf,LF={point:rM,lineStart:function(){LF.point=IF},lineEnd:function(){TF&&qF(NF,RF),LF.point=rM},polygonStart:function(){TF=!0},polygonEnd:function(){TF=null},result:function(){var e=+BF;return BF=new Bf,e}};function IF(e,t){LF.point=qF,NF=PF=e,RF=zF=t}function qF(e,t){PF-=e,zF-=t,BF.add(ZC(PF*PF+zF*zF)),PF=e,zF=t}function UF(){this._string=[]}function VF(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function WF(e,t){var n,r,i=4.5;function a(e){return e&&("function"==typeof i&&r.pointRadius(+i.apply(this,arguments)),uM(e,n(r))),r.result()}return a.area=function(e){return uM(e,n(eF)),eF.result()},a.measure=function(e){return uM(e,n(LF)),LF.result()},a.bounds=function(e){return uM(e,n(uF)),uF.result()},a.centroid=function(e){return uM(e,n(kF)),kF.result()},a.projection=function(t){return arguments.length?(n=null==t?(e=null,Kj):(e=t).stream,a):e},a.context=function(e){return arguments.length?(r=null==e?(t=null,new UF):new FF(t=e),"function"!=typeof i&&r.pointRadius(i),a):t},a.pointRadius=function(e){return arguments.length?(i="function"==typeof e?e:(r.pointRadius(+e),+e),a):i},a.projection(e).context(t)}function HF(e){return function(t){var n=new GF;for(var r in e)n[r]=e[r];return n.stream=t,n}}function GF(){}function XF(e,t,n){var r=e.clipExtent&&e.clipExtent();return e.scale(150).translate([0,0]),null!=r&&e.clipExtent(null),uM(n,e.stream(uF)),t(uF.result()),null!=r&&e.clipExtent(r),e}function YF(e,t,n){return XF(e,(function(n){var r=t[1][0]-t[0][0],i=t[1][1]-t[0][1],a=Math.min(r/(n[1][0]-n[0][0]),i/(n[1][1]-n[0][1])),o=+t[0][0]+(r-a*(n[1][0]+n[0][0]))/2,s=+t[0][1]+(i-a*(n[1][1]+n[0][1]))/2;e.scale(150*a).translate([o,s])}),n)}function JF(e,t,n){return YF(e,[[0,0],t],n)}function KF(e,t,n){return XF(e,(function(n){var r=+t,i=r/(n[1][0]-n[0][0]),a=(r-i*(n[1][0]+n[0][0]))/2,o=-i*n[0][1];e.scale(150*i).translate([a,o])}),n)}function QF(e,t,n){return XF(e,(function(n){var r=+t,i=r/(n[1][1]-n[0][1]),a=-i*n[0][0],o=(r-i*(n[1][1]+n[0][1]))/2;e.scale(150*i).translate([a,o])}),n)}UF.prototype={_radius:4.5,_circle:VF(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=VF(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(this._string.length){var e=this._string.join("");return this._string=[],e}return null}},GF.prototype={constructor:GF,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ZF=WC(30*IC);function eT(e,t){return+t?function(e,t){function n(r,i,a,o,s,l,u,c,f,d,h,p,m,g){var y=u-r,v=c-i,b=y*y+v*v;if(b>4*t&&m--){var x=o+d,w=s+h,_=l+p,k=ZC(x*x+w*w+_*_),O=nM(_/=k),S=qC(qC(_)-1)<TC||qC(a-f)<TC?(a+f)/2:VC(w,x),$=e(S,O),E=$[0],A=$[1],D=E-r,C=A-i,M=v*D-y*C;(M*M/b>t||qC((y*D+v*C)/b-.5)>.3||o*d+s*h+l*p<ZF)&&(n(r,i,a,o,s,l,E,A,S,x/=k,w/=k,_,m,g),g.point(E,A),n(E,A,S,x,w,_,u,c,f,d,h,p,m,g))}}return function(t){var r,i,a,o,s,l,u,c,f,d,h,p,m={point:g,lineStart:y,lineEnd:b,polygonStart:function(){t.polygonStart(),m.lineStart=x},polygonEnd:function(){t.polygonEnd(),m.lineStart=y}};function g(n,r){n=e(n,r),t.point(n[0],n[1])}function y(){c=NaN,m.point=v,t.lineStart()}function v(r,i){var a=TM([r,i]),o=e(r,i);n(c,f,u,d,h,p,c=o[0],f=o[1],u=r,d=a[0],h=a[1],p=a[2],16,t),t.point(c,f)}function b(){m.point=g,t.lineEnd()}function x(){y(),m.point=w,m.lineEnd=_}function w(e,t){v(r=e,t),i=c,a=f,o=d,s=h,l=p,m.point=v}function _(){n(c,f,u,d,h,p,i,a,r,o,s,l,16,t),m.lineEnd=b,b()}return m}}(e,t):function(e){return HF({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}(e)}var tT=HF({point:function(e,t){this.stream.point(e*IC,t*IC)}});function nT(e,t,n,r,i,a){if(!a)return function(e,t,n,r,i){function a(a,o){return[t+e*(a*=r),n-e*(o*=i)]}return a.invert=function(a,o){return[(a-t)/e*r,(n-o)/e*i]},a}(e,t,n,r,i);var o=WC(a),s=KC(a),l=o*e,u=s*e,c=o/e,f=s/e,d=(s*n-o*t)/e,h=(s*t+o*n)/e;function p(e,a){return[l*(e*=r)-u*(a*=i)+t,n-u*e-l*a]}return p.invert=function(e,t){return[r*(c*e-f*t+d),i*(h-f*e-c*t)]},p}function rT(e){return iT((function(){return e}))()}function iT(e){var t,n,r,i,a,o,s,l,u,c,f=150,d=480,h=250,p=0,m=0,g=0,y=0,v=0,b=0,x=1,w=1,_=null,k=Lj,O=null,S=Kj,$=.5;function E(e){return l(e[0]*IC,e[1]*IC)}function A(e){return(e=l.invert(e[0],e[1]))&&[e[0]*LC,e[1]*LC]}function D(){var e=nT(f,0,0,x,w,b).apply(null,t(p,m)),r=nT(f,d-e[0],h-e[1],x,w,b);return n=$j(g,y,v),s=Oj(t,r),l=Oj(n,s),o=eT(s,$),C()}function C(){return u=c=null,E}return E.stream=function(e){return u&&c===e?u:u=tT(function(e){return HF({point:function(t,n){var r=e(t,n);return this.stream.point(r[0],r[1])}})}(n)(k(o(S(c=e)))))},E.preclip=function(e){return arguments.length?(k=e,_=void 0,C()):k},E.postclip=function(e){return arguments.length?(S=e,O=r=i=a=null,C()):S},E.clipAngle=function(e){return arguments.length?(k=+e?Ij(_=e*IC):(_=null,Lj),C()):_*LC},E.clipExtent=function(e){return arguments.length?(S=null==e?(O=r=i=a=null,Kj):Vj(O=+e[0][0],r=+e[0][1],i=+e[1][0],a=+e[1][1]),C()):null==O?null:[[O,r],[i,a]]},E.scale=function(e){return arguments.length?(f=+e,D()):f},E.translate=function(e){return arguments.length?(d=+e[0],h=+e[1],D()):[d,h]},E.center=function(e){return arguments.length?(p=e[0]%360*IC,m=e[1]%360*IC,D()):[p*LC,m*LC]},E.rotate=function(e){return arguments.length?(g=e[0]%360*IC,y=e[1]%360*IC,v=e.length>2?e[2]%360*IC:0,D()):[g*LC,y*LC,v*LC]},E.angle=function(e){return arguments.length?(b=e%360*IC,D()):b*LC},E.reflectX=function(e){return arguments.length?(x=e?-1:1,D()):x<0},E.reflectY=function(e){return arguments.length?(w=e?-1:1,D()):w<0},E.precision=function(e){return arguments.length?(o=eT(s,$=e*e),C()):ZC($)},E.fitExtent=function(e,t){return YF(E,e,t)},E.fitSize=function(e,t){return JF(E,e,t)},E.fitWidth=function(e,t){return KF(E,e,t)},E.fitHeight=function(e,t){return QF(E,e,t)},function(){return t=e.apply(this,arguments),E.invert=t.invert&&A,D()}}function aT(e){var t=0,n=RC/3,r=iT(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*IC,n=e[1]*IC):[t*LC,n*LC]},i}function oT(e,t){var n=KC(e),r=(n+KC(t))/2;if(qC(r)<TC)return function(e){var t=WC(e);function n(e,n){return[e*t,KC(n)/t]}return n.invert=function(e,n){return[e/t,nM(n*t)]},n}(e);var i=1+n*(2*r-n),a=ZC(i)/r;function o(e,t){var n=ZC(i-2*r*KC(t))/r;return[n*KC(e*=r),a-n*WC(e)]}return o.invert=function(e,t){var n=a-t,o=VC(e,qC(n))*QC(n);return n*r<0&&(o-=RC*QC(e)*QC(n)),[o/r,nM((i-(e*e+n*n)*r*r)/(2*r))]},o}function sT(){return aT(oT).scale(155.424).center([0,33.6442])}function lT(){return sT().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function uT(e){return function(t,n){var r=WC(t),i=WC(n),a=e(r*i);return a===1/0?[2,0]:[a*i*KC(t),a*KC(n)]}}function cT(e){return function(t,n){var r=ZC(t*t+n*n),i=e(r),a=KC(i),o=WC(i);return[VC(t*a,r*o),nM(r&&n*a/r)]}}var fT=uT((function(e){return ZC(2/(1+e))}));fT.invert=cT((function(e){return 2*nM(e/2)}));var dT=uT((function(e){return(e=tM(e))&&e/KC(e)}));function hT(e,t){return[e,YC(eM((PC+t)/2))]}function pT(e){var t,n,r,i=rT(e),a=i.center,o=i.scale,s=i.translate,l=i.clipExtent,u=null;function c(){var a=RC*o(),s=i(function(e){function t(t){return(t=e(t[0]*IC,t[1]*IC))[0]*=LC,t[1]*=LC,t}return e=$j(e[0]*IC,e[1]*IC,e.length>2?e[2]*IC:0),t.invert=function(t){return(t=e.invert(t[0]*IC,t[1]*IC))[0]*=LC,t[1]*=LC,t},t}(i.rotate()).invert([0,0]));return l(null==u?[[s[0]-a,s[1]-a],[s[0]+a,s[1]+a]]:e===hT?[[Math.max(s[0]-a,u),t],[Math.min(s[0]+a,n),r]]:[[u,Math.max(s[1]-a,t)],[n,Math.min(s[1]+a,r)]])}return i.scale=function(e){return arguments.length?(o(e),c()):o()},i.translate=function(e){return arguments.length?(s(e),c()):s()},i.center=function(e){return arguments.length?(a(e),c()):a()},i.clipExtent=function(e){return arguments.length?(null==e?u=t=n=r=null:(u=+e[0][0],t=+e[0][1],n=+e[1][0],r=+e[1][1]),c()):null==u?null:[[u,t],[n,r]]},c()}function mT(e){return eM((PC+e)/2)}function gT(e,t){var n=WC(e),r=e===t?KC(e):YC(n/WC(t))/YC(mT(t)/mT(e)),i=n*JC(mT(e),r)/r;if(!r)return hT;function a(e,t){i>0?t<-PC+TC&&(t=-PC+TC):t>PC-TC&&(t=PC-TC);var n=i/JC(mT(t),r);return[n*KC(r*e),i-n*WC(r*e)]}return a.invert=function(e,t){var n=i-t,a=QC(r)*ZC(e*e+n*n),o=VC(e,qC(n))*QC(n);return n*r<0&&(o-=RC*QC(e)*QC(n)),[o/r,2*UC(JC(i/a,1/r))-PC]},a}function yT(e,t){return[e,t]}function vT(e,t){var n=WC(e),r=e===t?KC(e):(n-WC(t))/(t-e),i=n/r+e;if(qC(r)<TC)return yT;function a(e,t){var n=i-t,a=r*e;return[n*KC(a),i-n*WC(a)]}return a.invert=function(e,t){var n=i-t,a=VC(e,qC(n))*QC(n);return n*r<0&&(a-=RC*QC(e)*QC(n)),[a/r,i-QC(r)*ZC(e*e+n*n)]},a}dT.invert=cT((function(e){return e})),hT.invert=function(e,t){return[e,2*UC(GC(t))-PC]},yT.invert=yT;var bT=1.340264,xT=-.081106,wT=893e-6,_T=.003796,kT=ZC(3)/2;function OT(e,t){var n=nM(kT*KC(t)),r=n*n,i=r*r*r;return[e*WC(n)/(kT*(bT+3*xT*r+i*(7*wT+9*_T*r))),n*(bT+xT*r+i*(wT+_T*r))]}function ST(e,t){var n=WC(t),r=WC(e)*n;return[n*KC(e)/r,KC(t)/r]}function $T(e,t){var n=t*t,r=n*n;return[e*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791)),t*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))]}function ET(e,t){return[WC(t)*KC(e),KC(t)]}function AT(e,t){var n=WC(t),r=1+WC(e)*n;return[n*KC(e)/r,KC(t)/r]}function DT(e,t){return[YC(eM((PC+t)/2)),-e]}OT.invert=function(e,t){for(var n,r=t,i=r*r,a=i*i*i,o=0;o<12&&(a=(i=(r-=n=(r*(bT+xT*i+a*(wT+_T*i))-t)/(bT+3*xT*i+a*(7*wT+9*_T*i)))*r)*i*i,!(qC(n)<NC));++o);return[kT*e*(bT+3*xT*i+a*(7*wT+9*_T*i))/WC(r),nM(KC(r)/kT)]},ST.invert=cT(UC),$T.invert=function(e,t){var n,r=t,i=25;do{var a=r*r,o=a*a;r-=n=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))}while(qC(n)>TC&&--i>0);return[e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979)),r]},ET.invert=cT(nM),AT.invert=cT((function(e){return 2*UC(e)})),DT.invert=function(e,t){return[-t,2*UC(GC(e))-PC]};var CT=Math.abs,MT=Math.cos,jT=Math.sin,FT=Math.PI,TT=FT/2,NT=function(e){return e>0?Math.sqrt(e):0}(2);function RT(e){return e>1?TT:e<-1?-TT:Math.asin(e)}function PT(e,t){var n,r=e*jT(t),i=30;do{t-=n=(t+jT(t)-r)/(1+MT(t))}while(CT(n)>1e-6&&--i>0);return t/2}var zT=function(e,t,n){function r(r,i){return[e*r*MT(i=PT(n,i)),t*jT(i)]}return r.invert=function(r,i){return i=RT(i/t),[r/(e*MT(i)),RT((2*i+jT(2*i))/n)]},r}(NT/TT,NT,FT);const BT=WF(),LT=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function IT(e,t){return function n(){const r=t();return r.type=e,r.path=WF().projection(r),r.copy=r.copy||function(){const e=n();return LT.forEach((t=>{r[t]&&e[t](r[t]())})),e.path.pointRadius(r.path.pointRadius()),e},r}}function qT(e,t){if(!e||"string"!=typeof e)throw new Error("Projection type must be a name string.");return e=e.toLowerCase(),arguments.length>1?(VT[e]=IT(e,t),this):VT[e]||null}function UT(e){return e&&e.path||BT}const VT={albers:lT,albersusa:function(){var e,t,n,r,i,a,o=lT(),s=sT().rotate([154,0]).center([-2,58.5]).parallels([55,65]),l=sT().rotate([157,0]).center([-3,19.9]).parallels([8,18]),u={point:function(e,t){a=[e,t]}};function c(e){var t=e[0],o=e[1];return a=null,n.point(t,o),a||(r.point(t,o),a)||(i.point(t,o),a)}function f(){return e=t=null,c}return c.invert=function(e){var t=o.scale(),n=o.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&i<.234&&r>=-.425&&r<-.214?s:i>=.166&&i<.234&&r>=-.214&&r<-.115?l:o).invert(e)},c.stream=function(n){return e&&t===n?e:(r=[o.stream(t=n),s.stream(n),l.stream(n)],i=r.length,e={point:function(e,t){for(var n=-1;++n<i;)r[n].point(e,t)},sphere:function(){for(var e=-1;++e<i;)r[e].sphere()},lineStart:function(){for(var e=-1;++e<i;)r[e].lineStart()},lineEnd:function(){for(var e=-1;++e<i;)r[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<i;)r[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<i;)r[e].polygonEnd()}});var r,i},c.precision=function(e){return arguments.length?(o.precision(e),s.precision(e),l.precision(e),f()):o.precision()},c.scale=function(e){return arguments.length?(o.scale(e),s.scale(.35*e),l.scale(e),c.translate(o.translate())):o.scale()},c.translate=function(e){if(!arguments.length)return o.translate();var t=o.scale(),a=+e[0],c=+e[1];return n=o.translate(e).clipExtent([[a-.455*t,c-.238*t],[a+.455*t,c+.238*t]]).stream(u),r=s.translate([a-.307*t,c+.201*t]).clipExtent([[a-.425*t+TC,c+.12*t+TC],[a-.214*t-TC,c+.234*t-TC]]).stream(u),i=l.translate([a-.205*t,c+.212*t]).clipExtent([[a-.214*t+TC,c+.166*t+TC],[a-.115*t-TC,c+.234*t-TC]]).stream(u),f()},c.fitExtent=function(e,t){return YF(c,e,t)},c.fitSize=function(e,t){return JF(c,e,t)},c.fitWidth=function(e,t){return KF(c,e,t)},c.fitHeight=function(e,t){return QF(c,e,t)},c.scale(1070)},azimuthalequalarea:function(){return rT(fT).scale(124.75).clipAngle(179.999)},azimuthalequidistant:function(){return rT(dT).scale(79.4188).clipAngle(179.999)},conicconformal:function(){return aT(gT).scale(109.5).parallels([30,30])},conicequalarea:sT,conicequidistant:function(){return aT(vT).scale(131.154).center([0,13.9389])},equalEarth:function(){return rT(OT).scale(177.158)},equirectangular:function(){return rT(yT).scale(152.63)},gnomonic:function(){return rT(ST).scale(144.049).clipAngle(60)},identity:function(){var e,t,n,r,i,a,o,s=1,l=0,u=0,c=1,f=1,d=0,h=null,p=1,m=1,g=HF({point:function(e,t){var n=b([e,t]);this.stream.point(n[0],n[1])}}),y=Kj;function v(){return p=s*c,m=s*f,a=o=null,b}function b(n){var r=n[0]*p,i=n[1]*m;if(d){var a=i*e-r*t;r=r*e+i*t,i=a}return[r+l,i+u]}return b.invert=function(n){var r=n[0]-l,i=n[1]-u;if(d){var a=i*e+r*t;r=r*e-i*t,i=a}return[r/p,i/m]},b.stream=function(e){return a&&o===e?a:a=g(y(o=e))},b.postclip=function(e){return arguments.length?(y=e,h=n=r=i=null,v()):y},b.clipExtent=function(e){return arguments.length?(y=null==e?(h=n=r=i=null,Kj):Vj(h=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),v()):null==h?null:[[h,n],[r,i]]},b.scale=function(e){return arguments.length?(s=+e,v()):s},b.translate=function(e){return arguments.length?(l=+e[0],u=+e[1],v()):[l,u]},b.angle=function(n){return arguments.length?(t=KC(d=n%360*IC),e=WC(d),v()):d*LC},b.reflectX=function(e){return arguments.length?(c=e?-1:1,v()):c<0},b.reflectY=function(e){return arguments.length?(f=e?-1:1,v()):f<0},b.fitExtent=function(e,t){return YF(b,e,t)},b.fitSize=function(e,t){return JF(b,e,t)},b.fitWidth=function(e,t){return KF(b,e,t)},b.fitHeight=function(e,t){return QF(b,e,t)},b},mercator:function(){return pT(hT).scale(961/BC)},mollweide:function(){return rT(zT).scale(169.529)},naturalEarth1:function(){return rT($T).scale(175.295)},orthographic:function(){return rT(ET).scale(249.5).clipAngle(90.000001)},stereographic:function(){return rT(AT).scale(250).clipAngle(142)},transversemercator:function(){var e=pT(DT),t=e.center,n=e.rotate;return e.center=function(e){return arguments.length?t([-e[1],e[0]]):[(e=t())[1],-e[0]]},e.rotate=function(e){return arguments.length?n([e[0],e[1],e.length>2?e[2]+90:90]):[(e=n())[0],e[1],e[2]-90]},n([0,0,90]).scale(159.155)}};for(const e in VT)qT(e,VT[e]);function WT(){}const HT=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function GT(){var e=1,t=1,n=o;function r(e,t){return t.map((t=>i(e,t)))}function i(r,i){var o=[],s=[];return function(n,r,i){var o,s,l,u,c,f,d=new Array,h=new Array;o=s=-1,u=n[0]>=r,HT[u<<1].forEach(p);for(;++o<e-1;)l=u,u=n[o+1]>=r,HT[l|u<<1].forEach(p);HT[u<<0].forEach(p);for(;++s<t-1;){for(o=-1,u=n[s*e+e]>=r,c=n[s*e]>=r,HT[u<<1|c<<2].forEach(p);++o<e-1;)l=u,u=n[s*e+e+o+1]>=r,f=c,c=n[s*e+o+1]>=r,HT[l|u<<1|c<<2|f<<3].forEach(p);HT[u|c<<3].forEach(p)}o=-1,c=n[s*e]>=r,HT[c<<2].forEach(p);for(;++o<e-1;)f=c,c=n[s*e+o+1]>=r,HT[c<<2|f<<3].forEach(p);function p(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],u=a(r),c=a(l);(t=h[u])?(n=d[c])?(delete h[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=h[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete h[t.end],t.ring.push(l),h[t.end=c]=t):(t=d[c])?(n=h[u])?(delete d[t.start],delete h[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=h[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=u]=t):d[u]=h[c]={start:u,end:c,ring:[r,l]}}HT[c<<3].forEach(p)}(r,i,(e=>{n(e,r,i),function(e){var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];for(;++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)})),s.forEach((e=>{for(var t,n=0,r=o.length;n<r;++n)if(-1!==XT((t=o[n])[0],e))return void t.push(e)})),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function o(n,r,i){n.forEach((n=>{var a,o=n[0],s=n[1],l=0|o,u=0|s,c=r[u*e+l];o>0&&o<e&&l===o&&(a=r[u*e+l-1],n[0]=o+(i-a)/(c-a)-.5),s>0&&s<t&&u===s&&(a=r[(u-1)*e+l],n[1]=s+(i-a)/(c-a)-.5)}))}return r.contour=i,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),a=Math.floor(n[1]);return i>=0&&a>=0||ku("invalid size"),e=i,t=a,r},r.smooth=function(e){return arguments.length?(n=e?o:WT,r):n===o},r}function XT(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=YT(e,t[r]))return n;return 0}function YT(e,t){for(var n=t[0],r=t[1],i=-1,a=0,o=e.length,s=o-1;a<o;s=a++){var l=e[a],u=l[0],c=l[1],f=e[s],d=f[0],h=f[1];if(JT(l,f,t))return 0;c>r!=h>r&&n<(d-u)*(r-c)/(h-c)+u&&(i=-i)}return i}function JT(e,t,n){var r,i,a,o;return function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])}(e,t,n)&&(i=e[r=+(e[0]===t[0])],a=n[r],o=t[r],i<=a&&a<=o||o<=a&&a<=i)}function KT(e,t,n){return function(r){var i=gc(r),a=n?Math.min(i[0],0):i[0],o=i[1],s=o-a,l=t?Wf(a,o,e):s/(e+1);return ed(a+l,o,l)}}function QT(e){Cg.call(this,null,e)}function ZT(e,t,n,r,i){const a=e.x1||0,o=e.y1||0,s=t*n<0;function l(e){e.forEach(u)}function u(e){s&&e.reverse(),e.forEach(c)}function c(e){e[0]=(e[0]-a)*t+r,e[1]=(e[1]-o)*n+i}return function(e){return e.coordinates.forEach(l),e}}function eN(e,t,n){const r=e>=0?e:Pg(t,n);return Math.round((Math.sqrt(4*r*r+1)-1)/2)}function tN(e){return sc(e)?e:hc(+e)}function nN(){var e=e=>e[0],t=e=>e[1],n=Du,r=[-1,-1],i=960,a=500,o=2;function s(s,l){const u=eN(r[0],s,e)>>o,c=eN(r[1],s,t)>>o,f=u?u+2:0,d=c?c+2:0,h=2*f+(i>>o),p=2*d+(a>>o),m=new Float32Array(h*p),g=new Float32Array(h*p);let y=m;s.forEach((r=>{const i=f+(+e(r)>>o),a=d+(+t(r)>>o);i>=0&&i<h&&a>=0&&a<p&&(m[i+a*h]+=+n(r))})),u>0&&c>0?(rN(h,p,m,g,u),iN(h,p,g,m,c),rN(h,p,m,g,u),iN(h,p,g,m,c),rN(h,p,m,g,u),iN(h,p,g,m,c)):u>0?(rN(h,p,m,g,u),rN(h,p,g,m,u),rN(h,p,m,g,u),y=g):c>0&&(iN(h,p,m,g,c),iN(h,p,g,m,c),iN(h,p,m,g,c),y=g);const v=l?Math.pow(2,-2*o):1/td(y);for(let e=0,t=h*p;e<t;++e)y[e]*=v;return{values:y,scale:1<<o,width:h,height:p,x1:f,y1:d,x2:f+(i>>o),y2:d+(a>>o)}}return s.x=function(t){return arguments.length?(e=tN(t),s):e},s.y=function(e){return arguments.length?(t=tN(e),s):t},s.weight=function(e){return arguments.length?(n=tN(e),s):n},s.size=function(e){if(!arguments.length)return[i,a];var t=+e[0],n=+e[1];return t>=0&&n>=0||ku("invalid size"),i=t,a=n,s},s.cellSize=function(e){return arguments.length?((e=+e)>=1||ku("invalid cell size"),o=Math.floor(Math.log(e)/Math.LN2),s):1<<o},s.bandwidth=function(e){return arguments.length?(1===(e=ac(e)).length&&(e=[+e[0],+e[0]]),2!==e.length&&ku("invalid bandwidth"),r=e,s):r},s}function rN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<t;++o)for(let t=0,s=0;t<e+i;++t)t<e&&(s+=n[t+o*e]),t>=i&&(t>=a&&(s-=n[t-a+o*e]),r[t-i+o*e]=s/Math.min(t+1,e-1+a-t,a))}function iN(e,t,n,r,i){const a=1+(i<<1);for(let o=0;o<e;++o)for(let s=0,l=0;s<t+i;++s)s<t&&(l+=n[o+s*e]),s>=i&&(s>=a&&(l-=n[o+(s-a)*e]),r[o+(s-i)*e]=l/Math.min(s+1,t-1+a-s,a))}function aN(e){Cg.call(this,null,e)}QT.Definition={type:"Isocontour",metadata:{generates:!0},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:!0},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:!0},{name:"smooth",type:"boolean",default:!0},{name:"scale",type:"number",expr:!0},{name:"translate",type:"number",array:!0,expr:!0},{name:"as",type:"string",null:!0,default:"contour"}]},kc(QT,Cg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n=t.fork(t.NO_SOURCE|t.NO_FIELDS),r=t.materialize(t.SOURCE).source,i=e.field||Eu,a=GT().smooth(!1!==e.smooth),o=e.thresholds||function(e,t,n){const r=KT(n.levels||10,n.nice,!1!==n.zero);return"shared"!==n.resolve?r:r(e.map((e=>Hf(t(e).values))))}(r,i,e),s=null===e.as?null:e.as||"contour",l=[];return r.forEach((t=>{const n=i(t),r=a.size([n.width,n.height])(n.values,Tu(o)?o:o(n.values));!function(e,t,n,r){let i=r.scale||t.scale,a=r.translate||t.translate;sc(i)&&(i=i(n,r));sc(a)&&(a=a(n,r));if((1===i||null==i)&&!a)return;const o=(Ac(i)?i:i[0])||1,s=(Ac(i)?i:i[1])||1,l=a&&a[0]||0,u=a&&a[1]||0;e.forEach(ZT(t,o,s,l,u))}(r,n,t,e),r.forEach((e=>{l.push(tg(t,Zm(null!=s?{[s]:e}:e)))}))})),this.value&&(n.rem=this.value),this.value=n.source=n.add=l,n}}),aN.Definition={type:"KDE2D",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"weight",type:"field"},{name:"groupby",type:"field",array:!0},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:!0,length:2},{name:"counts",type:"boolean",default:!1},{name:"as",type:"string",default:"grid"}]};const oN=["x","y","weight","size","cellSize","bandwidth"];function sN(e,t){return oN.forEach((n=>null!=t[n]?e[n](t[n]):0)),e}function lN(e){Cg.call(this,null,e)}kc(aN,Cg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r=t.fork(t.NO_SOURCE|t.NO_FIELDS),i=function(e,t){var n,r,i,a,o,s,l=[],u=e=>e(a);if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}(t.materialize(t.SOURCE).source,e.groupby),a=(e.groupby||[]).map(vu),o=sN(nN(),e),s=e.as||"grid";return n=i.map((t=>Zm(function(e,t){for(let n=0;n<a.length;++n)e[a[n]]=t[n];return e}({[s]:o(t,e.counts)},t.dims)))),this.value&&(r.rem=this.value),this.value=r.source=r.add=n,r}}),lN.Definition={type:"Contour",metadata:{generates:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"values",type:"number",array:!0},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:!1},{name:"thresholds",type:"number",array:!0},{name:"smooth",type:"boolean",default:!0}]},kc(lN,Cg,{transform(e,t){if(this.value&&!t.changed()&&!e.modified())return t.StopPropagation;var n,r,i=t.fork(t.NO_SOURCE|t.NO_FIELDS),a=GT().smooth(!1!==e.smooth),o=e.values,s=e.thresholds||KT(e.count||10,e.nice,!!o),l=e.size;return o||(o=t.materialize(t.SOURCE).source,r=ZT(n=sN(nN(),e)(o,!0),n.scale||1,n.scale||1,0,0),l=[n.width,n.height],o=n.values),s=Tu(s)?s:s(o),o=a.size(l)(o,s),r&&o.forEach(r),this.value&&(i.rem=this.value),this.value=i.source=i.add=(o||[]).map(Zm),i}});const uN="Feature",cN="FeatureCollection";function fN(e){Cg.call(this,null,e)}function dN(e){Cg.call(this,null,e)}function hN(e){Cg.call(this,null,e)}function pN(e){Cg.call(this,null,e)}function mN(e){Cg.call(this,[],e),this.generator=function(){var e,t,n,r,i,a,o,s,l,u,c,f,d=10,h=d,p=90,m=360,g=2.5;function y(){return{type:"MultiLineString",coordinates:v()}}function v(){return ed(HC(r/p)*p,n,p).map(c).concat(ed(HC(s/m)*m,o,m).map(f)).concat(ed(HC(t/d)*d,e,d).filter((function(e){return qC(e%p)>TC})).map(l)).concat(ed(HC(a/h)*h,i,h).filter((function(e){return qC(e%m)>TC})).map(u))}return y.lines=function(){return v().map((function(e){return{type:"LineString",coordinates:e}}))},y.outline=function(){return{type:"Polygon",coordinates:[c(r).concat(f(o).slice(1),c(n).reverse().slice(1),f(s).reverse().slice(1))]}},y.extent=function(e){return arguments.length?y.extentMajor(e).extentMinor(e):y.extentMinor()},y.extentMajor=function(e){return arguments.length?(r=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],r>n&&(e=r,r=n,n=e),s>o&&(e=s,s=o,o=e),y.precision(g)):[[r,s],[n,o]]},y.extentMinor=function(n){return arguments.length?(t=+n[0][0],e=+n[1][0],a=+n[0][1],i=+n[1][1],t>e&&(n=t,t=e,e=n),a>i&&(n=a,a=i,i=n),y.precision(g)):[[t,a],[e,i]]},y.step=function(e){return arguments.length?y.stepMajor(e).stepMinor(e):y.stepMinor()},y.stepMajor=function(e){return arguments.length?(p=+e[0],m=+e[1],y):[p,m]},y.stepMinor=function(e){return arguments.length?(d=+e[0],h=+e[1],y):[d,h]},y.precision=function(d){return arguments.length?(g=+d,l=Wj(a,i,90),u=Hj(t,e,g),c=Wj(s,o,90),f=Hj(r,n,g),y):g},y.extentMajor([[-180,-89.999999],[180,89.999999]]).extentMinor([[-180,-80.000001],[180,80.000001]])}()}function gN(e){Cg.call(this,null,e)}function yN(e){if(!sc(e))return!1;const t=Uc(bu(e));return t.$x||t.$y||t.$value||t.$max}function vN(e){Cg.call(this,null,e),this.modified(!0)}function bN(e,t,n){sc(e[t])&&e[t](n)}fN.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:!0,length:2},{name:"geojson",type:"field"}]},kc(fN,Cg,{transform(e,t){var n,r=this._features,i=this._points,a=e.fields,o=a&&a[0],s=a&&a[1],l=e.geojson||!a&&Eu,u=t.ADD;n=e.modified()||t.changed(t.REM)||t.modified(bu(l))||o&&t.modified(bu(o))||s&&t.modified(bu(s)),this.value&&!n||(u=t.SOURCE,this._features=r=[],this._points=i=[]),l&&t.visit(u,(e=>r.push(l(e)))),o&&s&&(t.visit(u,(e=>{var t=o(e),n=s(e);null!=t&&null!=n&&(t=+t)===t&&(n=+n)===n&&i.push([t,n])})),r=r.concat({type:uN,geometry:{type:"MultiPoint",coordinates:i}})),this.value={type:cN,features:r}}}),dN.Definition={type:"GeoPath",metadata:{modifies:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"path"}]},kc(dN,Cg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.field||Eu,a=e.as||"path",o=n.SOURCE;!r||e.modified()?(this.value=r=UT(e.projection),n.materialize().reflow()):o=i===Eu||t.modified(i.fields)?n.ADD_MOD:n.ADD;const s=function(e,t){const n=e.pointRadius();e.context(null),null!=t&&e.pointRadius(t);return n}(r,e.pointRadius);return n.visit(o,(e=>e[a]=r(i(e)))),r.pointRadius(s),n.modifies(a)}}),hN.Definition={type:"GeoPoint",metadata:{modifies:!0},params:[{name:"projection",type:"projection",required:!0},{name:"fields",type:"field",array:!0,required:!0,length:2},{name:"as",type:"string",array:!0,length:2,default:["x","y"]}]},kc(hN,Cg,{transform(e,t){var n,r=e.projection,i=e.fields[0],a=e.fields[1],o=e.as||["x","y"],s=o[0],l=o[1];function u(e){const t=r([i(e),a(e)]);t?(e[s]=t[0],e[l]=t[1]):(e[s]=void 0,e[l]=void 0)}return e.modified()?t=t.materialize().reflow(!0).visit(t.SOURCE,u):(n=t.modified(i.fields)||t.modified(a.fields),t.visit(n?t.ADD_MOD:t.ADD,u)),t.modifies(o)}}),pN.Definition={type:"GeoShape",metadata:{modifies:!0,nomod:!0},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:!0},{name:"as",type:"string",default:"shape"}]},kc(pN,Cg,{transform(e,t){var n=t.fork(t.ALL),r=this.value,i=e.as||"shape",a=n.ADD;return r&&!e.modified()||(this.value=r=function(e,t,n){const r=null==n?n=>e(t(n)):r=>{var i=e.pointRadius(),a=e.pointRadius(n)(t(r));return e.pointRadius(i),a};return r.context=t=>(e.context(t),r),r}(UT(e.projection),e.field||Su("datum"),e.pointRadius),n.materialize().reflow(),a=n.SOURCE),n.visit(a,(e=>e[i]=r)),n.modifies(i)}}),mN.Definition={type:"Graticule",metadata:{changes:!0,generates:!0},params:[{name:"extent",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMajor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"extentMinor",type:"array",array:!0,length:2,content:{type:"number",array:!0,length:2}},{name:"step",type:"number",array:!0,length:2},{name:"stepMajor",type:"number",array:!0,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:!0,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]},kc(mN,Cg,{transform(e,t){var n,r=this.value,i=this.generator;if(!r.length||e.modified())for(const t in e)sc(i[t])&&i[t](e[t]);return n=i(),r.length?t.mod.push(ng(r[0],n)):t.add.push(Zm(n)),r[0]=n,t}}),gN.Definition={type:"heatmap",metadata:{modifies:!0},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:!0},{name:"opacity",type:"number",expr:!0},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]},kc(gN,Cg,{transform(e,t){if(!t.changed()&&!e.modified())return t.StopPropagation;var n=t.materialize(t.SOURCE).source,r="shared"===e.resolve,i=e.field||Eu,a=function(e,t){let n;sc(e)?(n=n=>e(n,t),n.dep=yN(e)):e?n=hc(e):(n=e=>e.$value/e.$max||0,n.dep=!0);return n}(e.opacity,e),o=function(e,t){let n;sc(e)?(n=n=>Bx(e(n,t)),n.dep=yN(e)):n=hc(Bx(e||"#888"));return n}(e.color,e),s=e.as||"image",l={$x:0,$y:0,$value:0,$max:r?Hf(n.map((e=>Hf(i(e).values)))):0};return n.forEach((e=>{const t=i(e),n=mc({},e,l);r||(n.$max=Hf(t.values||[])),e[s]=function(e,t,n,r){const i=e.width,a=e.height,o=e.x1||0,s=e.y1||0,l=e.x2||i,u=e.y2||a,c=e.values,f=c?e=>c[e]:Au,d=fx(l-o,u-s),h=d.getContext("2d"),p=h.getImageData(0,0,l-o,u-s),m=p.data;for(let e=s,a=0;e<u;++e){t.$y=e-s;for(let s=o,u=e*i;s<l;++s,a+=4){t.$x=s-o,t.$value=f(s+u);const e=n(t);m[a+0]=e.r,m[a+1]=e.g,m[a+2]=e.b,m[a+3]=~~(255*r(t))}}return h.putImageData(p,0,0),d}(t,n,o.dep?o:hc(o(n)),a.dep?a:hc(a(n)))})),t.reflow(!0).modifies(s)}}),kc(vN,Cg,{transform(e,t){let n=this.value;return!n||e.modified("type")?(this.value=n=function(e){const t=qT((e||"mercator").toLowerCase());t||ku("Unrecognized projection type: "+e);return t()}(e.type),LT.forEach((t=>{null!=e[t]&&bN(n,t,e[t])}))):LT.forEach((t=>{e.modified(t)&&bN(n,t,e[t])})),null!=e.pointRadius&&n.path.pointRadius(e.pointRadius),e.fit&&function(e,t){const n=function(e){return 1===(e=ac(e)).length?e[0]:{type:cN,features:e.reduce(((e,t)=>e.concat(function(e){return e.type===cN?e.features:ac(e).filter((e=>null!=e)).map((e=>e.type===uN?e:{type:uN,geometry:e}))}(t))),[])}}(t.fit);t.extent?e.fitExtent(t.extent,n):t.size&&e.fitSize(t.size,n)}(n,e),t.fork(t.NO_SOURCE|t.NO_FIELDS)}});var xN=Object.freeze({__proto__:null,contour:lN,geojson:fN,geopath:dN,geopoint:hN,geoshape:pN,graticule:mN,heatmap:gN,isocontour:QT,kde2d:aN,projection:vN});function wN(e,t,n,r){if(isNaN(t)||isNaN(n))return e;var i,a,o,s,l,u,c,f,d,h=e._root,p={data:r},m=e._x0,g=e._y0,y=e._x1,v=e._y1;if(!h)return e._root=p,e;for(;h.length;)if((u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o,i=h,!(h=h[f=c<<1|u]))return i[f]=p,e;if(s=+e._x.call(null,h.data),l=+e._y.call(null,h.data),t===s&&n===l)return p.next=h,i?i[f]=p:e._root=p,e;do{i=i?i[f]=new Array(4):e._root=new Array(4),(u=t>=(a=(m+y)/2))?m=a:y=a,(c=n>=(o=(g+v)/2))?g=o:v=o}while((f=c<<1|u)==(d=(l>=o)<<1|s>=a));return i[d]=h,i[f]=p,e}function _N(e,t,n,r,i){this.node=e,this.x0=t,this.y0=n,this.x1=r,this.y1=i}function kN(e){return e[0]}function ON(e){return e[1]}function SN(e,t,n){var r=new $N(null==t?kN:t,null==n?ON:n,NaN,NaN,NaN,NaN);return null==e?r:r.addAll(e)}function $N(e,t,n,r,i,a){this._x=e,this._y=t,this._x0=n,this._y0=r,this._x1=i,this._y1=a,this._root=void 0}function EN(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var AN=SN.prototype=$N.prototype;function DN(e){return function(){return e}}function CN(e){return 1e-6*(e()-.5)}function MN(e){return e.x+e.vx}function jN(e){return e.y+e.vy}function FN(e){return e.index}function TN(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}AN.copy=function(){var e,t,n=new $N(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root;if(!r)return n;if(!r.length)return n._root=EN(r),n;for(e=[{source:r,target:n._root=new Array(4)}];r=e.pop();)for(var i=0;i<4;++i)(t=r.source[i])&&(t.length?e.push({source:t,target:r.target[i]=new Array(4)}):r.target[i]=EN(t));return n},AN.add=function(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return wN(this.cover(t,n),t,n,e)},AN.addAll=function(e){var t,n,r,i,a=e.length,o=new Array(a),s=new Array(a),l=1/0,u=1/0,c=-1/0,f=-1/0;for(n=0;n<a;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(o[n]=r,s[n]=i,r<l&&(l=r),r>c&&(c=r),i<u&&(u=i),i>f&&(f=i));if(l>c||u>f)return this;for(this.cover(l,u).cover(c,f),n=0;n<a;++n)wN(this,o[n],s[n],e[n]);return this},AN.cover=function(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,r=this._y0,i=this._x1,a=this._y1;if(isNaN(n))i=(n=Math.floor(e))+1,a=(r=Math.floor(t))+1;else{for(var o,s,l=i-n||1,u=this._root;n>e||e>=i||r>t||t>=a;)switch(s=(t<r)<<1|e<n,(o=new Array(4))[s]=u,u=o,l*=2,s){case 0:i=n+l,a=r+l;break;case 1:n=i-l,a=r+l;break;case 2:i=n+l,r=a-l;break;case 3:n=i-l,r=a-l}this._root&&this._root.length&&(this._root=u)}return this._x0=n,this._y0=r,this._x1=i,this._y1=a,this},AN.data=function(){var e=[];return this.visit((function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)})),e},AN.extent=function(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},AN.find=function(e,t,n){var r,i,a,o,s,l,u,c=this._x0,f=this._y0,d=this._x1,h=this._y1,p=[],m=this._root;for(m&&p.push(new _N(m,c,f,d,h)),null==n?n=1/0:(c=e-n,f=t-n,d=e+n,h=t+n,n*=n);l=p.pop();)if(!(!(m=l.node)||(i=l.x0)>d||(a=l.y0)>h||(o=l.x1)<c||(s=l.y1)<f))if(m.length){var g=(i+o)/2,y=(a+s)/2;p.push(new _N(m[3],g,y,o,s),new _N(m[2],i,y,g,s),new _N(m[1],g,a,o,y),new _N(m[0],i,a,g,y)),(u=(t>=y)<<1|e>=g)&&(l=p[p.length-1],p[p.length-1]=p[p.length-1-u],p[p.length-1-u]=l)}else{var v=e-+this._x.call(null,m.data),b=t-+this._y.call(null,m.data),x=v*v+b*b;if(x<n){var w=Math.sqrt(n=x);c=e-w,f=t-w,d=e+w,h=t+w,r=m.data}}return r},AN.remove=function(e){if(isNaN(a=+this._x.call(null,e))||isNaN(o=+this._y.call(null,e)))return this;var t,n,r,i,a,o,s,l,u,c,f,d,h=this._root,p=this._x0,m=this._y0,g=this._x1,y=this._y1;if(!h)return this;if(h.length)for(;;){if((u=a>=(s=(p+g)/2))?p=s:g=s,(c=o>=(l=(m+y)/2))?m=l:y=l,t=h,!(h=h[f=c<<1|u]))return this;if(!h.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(n=t,d=f)}for(;h.data!==e;)if(r=h,!(h=h.next))return this;return(i=h.next)&&delete h.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(h=t[0]||t[1]||t[2]||t[3])&&h===(t[3]||t[2]||t[1]||t[0])&&!h.length&&(n?n[d]=h:this._root=h),this):(this._root=i,this)},AN.removeAll=function(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},AN.root=function(){return this._root},AN.size=function(){var e=0;return this.visit((function(t){if(!t.length)do{++e}while(t=t.next)})),e},AN.visit=function(e){var t,n,r,i,a,o,s=[],l=this._root;for(l&&s.push(new _N(l,this._x0,this._y0,this._x1,this._y1));t=s.pop();)if(!e(l=t.node,r=t.x0,i=t.y0,a=t.x1,o=t.y1)&&l.length){var u=(r+a)/2,c=(i+o)/2;(n=l[3])&&s.push(new _N(n,u,c,a,o)),(n=l[2])&&s.push(new _N(n,r,c,u,o)),(n=l[1])&&s.push(new _N(n,u,i,a,c)),(n=l[0])&&s.push(new _N(n,r,i,u,c))}return this},AN.visitAfter=function(e){var t,n=[],r=[];for(this._root&&n.push(new _N(this._root,this._x0,this._y0,this._x1,this._y1));t=n.pop();){var i=t.node;if(i.length){var a,o=t.x0,s=t.y0,l=t.x1,u=t.y1,c=(o+l)/2,f=(s+u)/2;(a=i[0])&&n.push(new _N(a,o,s,c,f)),(a=i[1])&&n.push(new _N(a,c,s,l,f)),(a=i[2])&&n.push(new _N(a,o,f,c,u)),(a=i[3])&&n.push(new _N(a,c,f,l,u))}r.push(t)}for(;t=r.pop();)e(t.node,t.x0,t.y0,t.x1,t.y1);return this},AN.x=function(e){return arguments.length?(this._x=e,this):this._x},AN.y=function(e){return arguments.length?(this._y=e,this):this._y};var NN={value:()=>{}};function RN(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new PN(r)}function PN(e){this._=e}function zN(e,t){return e.trim().split(/^|\s+/).map((function(e){var n="",r=e.indexOf(".");if(r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:n}}))}function BN(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function LN(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=NN,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}PN.prototype=RN.prototype={constructor:PN,on:function(e,t){var n,r=this._,i=zN(e+"",r),a=-1,o=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(n=(e=i[a]).type)r[n]=LN(r[n],e.name,t);else if(null==t)for(n in r)r[n]=LN(r[n],e.name,null);return this}for(;++a<o;)if((n=(e=i[a]).type)&&(n=BN(r[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new PN(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),a=0;a<n;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,n=(r=this._[e]).length;a<n;++a)r[a].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,a=r.length;i<a;++i)r[i].value.apply(t,n)}};var IN,qN,UN=0,VN=0,WN=0,HN=0,GN=0,XN=0,YN="object"==typeof performance&&performance.now?performance:Date,JN="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function KN(){return GN||(JN(QN),GN=YN.now()+XN)}function QN(){GN=0}function ZN(){this._call=this._time=this._next=null}function eR(e,t,n){var r=new ZN;return r.restart(e,t,n),r}function tR(){GN=(HN=YN.now())+XN,UN=VN=0;try{!function(){KN(),++UN;for(var e,t=IN;t;)(e=GN-t._time)>=0&&t._call.call(null,e),t=t._next;--UN}()}finally{UN=0,function(){var e,t,n=IN,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:IN=t);qN=e,rR(r)}(),GN=0}}function nR(){var e=YN.now(),t=e-HN;t>1e3&&(XN-=t,HN=e)}function rR(e){UN||(VN&&(VN=clearTimeout(VN)),e-GN>24?(e<1/0&&(VN=setTimeout(tR,e-YN.now()-XN)),WN&&(WN=clearInterval(WN))):(WN||(HN=YN.now(),WN=setInterval(nR,1e3)),UN=1,JN(tR)))}ZN.prototype=eR.prototype={constructor:ZN,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?KN():+n)+(null==t?0:+t),this._next||qN===this||(qN?qN._next=this:IN=this,qN=this),this._call=e,this._time=n,rR()},stop:function(){this._call&&(this._call=null,this._time=1/0,rR())}};const iR=4294967296;function aR(e){return e.x}function oR(e){return e.y}var sR=Math.PI*(3-Math.sqrt(5));function lR(e){var t,n=1,r=.001,i=1-Math.pow(r,1/300),a=0,o=.6,s=new Map,l=eR(f),u=RN("tick","end"),c=function(){let e=1;return()=>(e=(1664525*e+1013904223)%iR)/iR}();function f(){d(),u.call("tick",t),n<r&&(l.stop(),u.call("end",t))}function d(r){var l,u,c=e.length;void 0===r&&(r=1);for(var f=0;f<r;++f)for(n+=(a-n)*i,s.forEach((function(e){e(n)})),l=0;l<c;++l)null==(u=e[l]).fx?u.x+=u.vx*=o:(u.x=u.fx,u.vx=0),null==u.fy?u.y+=u.vy*=o:(u.y=u.fy,u.vy=0);return t}function h(){for(var t,n=0,r=e.length;n<r;++n){if((t=e[n]).index=n,null!=t.fx&&(t.x=t.fx),null!=t.fy&&(t.y=t.fy),isNaN(t.x)||isNaN(t.y)){var i=10*Math.sqrt(.5+n),a=n*sR;t.x=i*Math.cos(a),t.y=i*Math.sin(a)}(isNaN(t.vx)||isNaN(t.vy))&&(t.vx=t.vy=0)}}function p(t){return t.initialize&&t.initialize(e,c),t}return null==e&&(e=[]),h(),t={tick:d,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(n){return arguments.length?(e=n,h(),s.forEach(p),t):e},alpha:function(e){return arguments.length?(n=+e,t):n},alphaMin:function(e){return arguments.length?(r=+e,t):r},alphaDecay:function(e){return arguments.length?(i=+e,t):+i},alphaTarget:function(e){return arguments.length?(a=+e,t):a},velocityDecay:function(e){return arguments.length?(o=1-e,t):1-o},randomSource:function(e){return arguments.length?(c=e,s.forEach(p),t):c},force:function(e,n){return arguments.length>1?(null==n?s.delete(e):s.set(e,p(n)),t):s.get(e)},find:function(t,n,r){var i,a,o,s,l,u=0,c=e.length;for(null==r?r=1/0:r*=r,u=0;u<c;++u)(o=(i=t-(s=e[u]).x)*i+(a=n-s.y)*a)<r&&(l=s,r=o);return l},on:function(e,n){return arguments.length>1?(u.on(e,n),t):u.on(e)}}}const uR={center:function(e,t){var n,r=1;function i(){var i,a,o=n.length,s=0,l=0;for(i=0;i<o;++i)s+=(a=n[i]).x,l+=a.y;for(s=(s/o-e)*r,l=(l/o-t)*r,i=0;i<o;++i)(a=n[i]).x-=s,a.y-=l}return null==e&&(e=0),null==t&&(t=0),i.initialize=function(e){n=e},i.x=function(t){return arguments.length?(e=+t,i):e},i.y=function(e){return arguments.length?(t=+e,i):t},i.strength=function(e){return arguments.length?(r=+e,i):r},i},collide:function(e){var t,n,r,i=1,a=1;function o(){for(var e,o,l,u,c,f,d,h=t.length,p=0;p<a;++p)for(o=SN(t,MN,jN).visitAfter(s),e=0;e<h;++e)l=t[e],f=n[l.index],d=f*f,u=l.x+l.vx,c=l.y+l.vy,o.visit(m);function m(e,t,n,a,o){var s=e.data,h=e.r,p=f+h;if(!s)return t>u+p||a<u-p||n>c+p||o<c-p;if(s.index>l.index){var m=u-s.x-s.vx,g=c-s.y-s.vy,y=m*m+g*g;y<p*p&&(0===m&&(y+=(m=CN(r))*m),0===g&&(y+=(g=CN(r))*g),y=(p-(y=Math.sqrt(y)))/y*i,l.vx+=(m*=y)*(p=(h*=h)/(d+h)),l.vy+=(g*=y)*p,s.vx-=m*(p=1-p),s.vy-=g*p)}}}function s(e){if(e.data)return e.r=n[e.data.index];for(var t=e.r=0;t<4;++t)e[t]&&e[t].r>e.r&&(e.r=e[t].r)}function l(){if(t){var r,i,a=t.length;for(n=new Array(a),r=0;r<a;++r)i=t[r],n[i.index]=+e(i,r,t)}}return"function"!=typeof e&&(e=DN(null==e?1:+e)),o.initialize=function(e,n){t=e,r=n,l()},o.iterations=function(e){return arguments.length?(a=+e,o):a},o.strength=function(e){return arguments.length?(i=+e,o):i},o.radius=function(t){return arguments.length?(e="function"==typeof t?t:DN(+t),l(),o):e},o},nbody:function(){var e,t,n,r,i,a=DN(-30),o=1,s=1/0,l=.81;function u(n){var i,a=e.length,o=SN(e,aR,oR).visitAfter(f);for(r=n,i=0;i<a;++i)t=e[i],o.visit(d)}function c(){if(e){var t,n,r=e.length;for(i=new Array(r),t=0;t<r;++t)n=e[t],i[n.index]=+a(n,t,e)}}function f(e){var t,n,r,a,o,s=0,l=0;if(e.length){for(r=a=o=0;o<4;++o)(t=e[o])&&(n=Math.abs(t.value))&&(s+=t.value,l+=n,r+=n*t.x,a+=n*t.y);e.x=r/l,e.y=a/l}else{(t=e).x=t.data.x,t.y=t.data.y;do{s+=i[t.data.index]}while(t=t.next)}e.value=s}function d(e,a,u,c){if(!e.value)return!0;var f=e.x-t.x,d=e.y-t.y,h=c-a,p=f*f+d*d;if(h*h/l<p)return p<s&&(0===f&&(p+=(f=CN(n))*f),0===d&&(p+=(d=CN(n))*d),p<o&&(p=Math.sqrt(o*p)),t.vx+=f*e.value*r/p,t.vy+=d*e.value*r/p),!0;if(!(e.length||p>=s)){(e.data!==t||e.next)&&(0===f&&(p+=(f=CN(n))*f),0===d&&(p+=(d=CN(n))*d),p<o&&(p=Math.sqrt(o*p)));do{e.data!==t&&(h=i[e.data.index]*r/p,t.vx+=f*h,t.vy+=d*h)}while(e=e.next)}}return u.initialize=function(t,r){e=t,n=r,c()},u.strength=function(e){return arguments.length?(a="function"==typeof e?e:DN(+e),c(),u):a},u.distanceMin=function(e){return arguments.length?(o=e*e,u):Math.sqrt(o)},u.distanceMax=function(e){return arguments.length?(s=e*e,u):Math.sqrt(s)},u.theta=function(e){return arguments.length?(l=e*e,u):Math.sqrt(l)},u},link:function(e){var t,n,r,i,a,o,s=FN,l=function(e){return 1/Math.min(i[e.source.index],i[e.target.index])},u=DN(30),c=1;function f(r){for(var i=0,s=e.length;i<c;++i)for(var l,u,f,d,h,p,m,g=0;g<s;++g)u=(l=e[g]).source,d=(f=l.target).x+f.vx-u.x-u.vx||CN(o),h=f.y+f.vy-u.y-u.vy||CN(o),d*=p=((p=Math.sqrt(d*d+h*h))-n[g])/p*r*t[g],h*=p,f.vx-=d*(m=a[g]),f.vy-=h*m,u.vx+=d*(m=1-m),u.vy+=h*m}function d(){if(r){var o,l,u=r.length,c=e.length,f=new Map(r.map(((e,t)=>[s(e,t,r),e])));for(o=0,i=new Array(u);o<c;++o)(l=e[o]).index=o,"object"!=typeof l.source&&(l.source=TN(f,l.source)),"object"!=typeof l.target&&(l.target=TN(f,l.target)),i[l.source.index]=(i[l.source.index]||0)+1,i[l.target.index]=(i[l.target.index]||0)+1;for(o=0,a=new Array(c);o<c;++o)l=e[o],a[o]=i[l.source.index]/(i[l.source.index]+i[l.target.index]);t=new Array(c),h(),n=new Array(c),p()}}function h(){if(r)for(var n=0,i=e.length;n<i;++n)t[n]=+l(e[n],n,e)}function p(){if(r)for(var t=0,i=e.length;t<i;++t)n[t]=+u(e[t],t,e)}return null==e&&(e=[]),f.initialize=function(e,t){r=e,o=t,d()},f.links=function(t){return arguments.length?(e=t,d(),f):e},f.id=function(e){return arguments.length?(s=e,f):s},f.iterations=function(e){return arguments.length?(c=+e,f):c},f.strength=function(e){return arguments.length?(l="function"==typeof e?e:DN(+e),h(),f):l},f.distance=function(e){return arguments.length?(u="function"==typeof e?e:DN(+e),p(),f):u},f},x:function(e){var t,n,r,i=DN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vx+=(r[a]-i.x)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=DN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:DN(+e),o(),a):i},a.x=function(t){return arguments.length?(e="function"==typeof t?t:DN(+t),o(),a):e},a},y:function(e){var t,n,r,i=DN(.1);function a(e){for(var i,a=0,o=t.length;a<o;++a)(i=t[a]).vy+=(r[a]-i.y)*n[a]*e}function o(){if(t){var a,o=t.length;for(n=new Array(o),r=new Array(o),a=0;a<o;++a)n[a]=isNaN(r[a]=+e(t[a],a,t))?0:+i(t[a],a,t)}}return"function"!=typeof e&&(e=DN(null==e?0:+e)),a.initialize=function(e){t=e,o()},a.strength=function(e){return arguments.length?(i="function"==typeof e?e:DN(+e),o(),a):i},a.y=function(t){return arguments.length?(e="function"==typeof t?t:DN(+t),o(),a):e},a}},cR="forces",fR=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],dR=["static","iterations"],hR=["x","y","vx","vy"];function pR(e){Cg.call(this,null,e)}function mR(e,t,n,r){var i,a,o,s,l=ac(t.forces);for(i=0,a=fR.length;i<a;++i)(o=fR[i])!==cR&&t.modified(o)&&e[o](t[o]);for(i=0,a=l.length;i<a;++i)s=cR+i,(o=n||t.modified(cR,i)?yR(l[i]):r&&gR(l[i],r)?e.force(s):null)&&e.force(s,o);for(a=e.numForces||0;i<a;++i)e.force(cR+i,null);return e.numForces=l.length,e}function gR(e,t){var n,r;for(n in e)if(sc(r=e[n])&&t.modified(bu(r)))return 1;return 0}function yR(e){var t,n;for(n in bc(uR,e.force)||ku("Unrecognized force: "+e.force),t=uR[e.force](),e)sc(t[n])&&vR(t[n],e[n],e);return t}function vR(e,t,n){e(sc(t)?e=>t(e,n):t)}pR.Definition={type:"Force",metadata:{modifies:!0},params:[{name:"static",type:"boolean",default:!1},{name:"restart",type:"boolean",default:!1},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:!0,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:!0},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:!0},{name:"strength",type:"number",expr:!0},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:!0,modify:!1,default:hR}]},kc(pR,Cg,{transform(e,t){var n,r,i=this.value,a=t.changed(t.ADD_REM),o=e.modified(fR),s=e.iterations||300;if(i?(a&&(t.modifies("index"),i.nodes(t.source)),(o||t.changed(t.MOD))&&mR(i,e,0,t)):(this.value=i=function(e,t){const n=lR(e),r=n.stop,i=n.restart;let a=!1;return n.stopped=()=>a,n.restart=()=>(a=!1,i()),n.stop=()=>(a=!0,r()),mR(n,t,!0).on("end",(()=>a=!0))}(t.source,e),i.on("tick",(n=t.dataflow,r=this,()=>n.touch(r).run())),e.static||(a=!0,i.tick()),t.modifies("index")),o||a||e.modified(dR)||t.changed()&&e.restart)if(i.alpha(Math.max(i.alpha(),e.alpha||1)).alphaDecay(1-Math.pow(i.alphaMin(),1/s)),e.static)for(i.stop();--s>=0;)i.tick();else if(i.stopped()&&i.restart(),!a)return t.StopPropagation;return this.finish(e,t)},finish(e,t){const n=t.dataflow;for(let e,t=this._argops,s=0,l=t.length;s<l;++s)if(e=t[s],e.name===cR&&"link"===e.op._argval.force)for(var r,i=e.op._argops,a=0,o=i.length;a<o;++a)if("links"===i[a].name&&(r=i[a].op.source)){n.pulse(r,n.changeset().reflow());break}return t.reflow(e.modified()).modifies(hR)}});var bR=Object.freeze({__proto__:null,force:pR});function xR(e,t){return e.parent===t.parent?1:2}function wR(e,t){return e+t.x}function _R(e,t){return Math.max(e,t.y)}function kR(e){var t=0,n=e.children,r=n&&n.length;if(r)for(;--r>=0;)t+=n[r].value;else t=1;e.value=t}function OR(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=$R)):void 0===t&&(t=SR);for(var n,r,i,a,o,s=new DR(e),l=[s];n=l.pop();)if((i=t(n.data))&&(o=(i=Array.from(i)).length))for(n.children=i,a=o-1;a>=0;--a)l.push(r=i[a]=new DR(i[a])),r.parent=n,r.depth=n.depth+1;return s.eachBefore(AR)}function SR(e){return e.children}function $R(e){return Array.isArray(e)?e[1]:null}function ER(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function AR(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function DR(e){this.data=e,this.depth=this.height=0,this.parent=null}function CR(e){for(var t,n,r=0,i=(e=function(e){for(var t,n,r=e.length;r;)n=Math.random()*r--|0,t=e[r],e[r]=e[n],e[n]=t;return e}(Array.from(e))).length,a=[];r<i;)t=e[r],n&&FR(n,t)?++r:(n=NR(a=MR(a,t)),r=0);return n}function MR(e,t){var n,r;if(TR(t,e))return[t];for(n=0;n<e.length;++n)if(jR(t,e[n])&&TR(RR(e[n],t),e))return[e[n],t];for(n=0;n<e.length-1;++n)for(r=n+1;r<e.length;++r)if(jR(RR(e[n],e[r]),t)&&jR(RR(e[n],t),e[r])&&jR(RR(e[r],t),e[n])&&TR(PR(e[n],e[r],t),e))return[e[n],e[r],t];throw new Error}function jR(e,t){var n=e.r-t.r,r=t.x-e.x,i=t.y-e.y;return n<0||n*n<r*r+i*i}function FR(e,t){var n=e.r-t.r+1e-9*Math.max(e.r,t.r,1),r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function TR(e,t){for(var n=0;n<t.length;++n)if(!FR(e,t[n]))return!1;return!0}function NR(e){switch(e.length){case 1:return function(e){return{x:e.x,y:e.y,r:e.r}}(e[0]);case 2:return RR(e[0],e[1]);case 3:return PR(e[0],e[1],e[2])}}function RR(e,t){var n=e.x,r=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-n,u=o-r,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(n+a+l/f*c)/2,y:(r+o+u/f*c)/2,r:(f+i+s)/2}}function PR(e,t,n){var r=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=n.x,c=n.y,f=n.r,d=r-o,h=r-u,p=i-s,m=i-c,g=l-a,y=f-a,v=r*r+i*i-a*a,b=v-o*o-s*s+l*l,x=v-u*u-c*c+f*f,w=h*p-d*m,_=(p*x-m*b)/(2*w)-r,k=(m*g-p*y)/w,O=(h*b-d*x)/(2*w)-i,S=(d*y-h*g)/w,$=k*k+S*S-1,E=2*(a+_*k+O*S),A=_*_+O*O-a*a,D=-($?(E+Math.sqrt(E*E-4*$*A))/(2*$):A/E);return{x:r+_+k*D,y:i+O+S*D,r:D}}function zR(e,t,n){var r,i,a,o,s=e.x-t.x,l=e.y-t.y,u=s*s+l*l;u?(i=t.r+n.r,i*=i,o=e.r+n.r,i>(o*=o)?(r=(u+o-i)/(2*u),a=Math.sqrt(Math.max(0,o/u-r*r)),n.x=e.x-r*s-a*l,n.y=e.y-r*l+a*s):(r=(u+i-o)/(2*u),a=Math.sqrt(Math.max(0,i/u-r*r)),n.x=t.x+r*s-a*l,n.y=t.y+r*l+a*s)):(n.x=t.x+n.r,n.y=t.y)}function BR(e,t){var n=e.r+t.r-1e-6,r=t.x-e.x,i=t.y-e.y;return n>0&&n*n>r*r+i*i}function LR(e){var t=e._,n=e.next._,r=t.r+n.r,i=(t.x*n.r+n.x*t.r)/r,a=(t.y*n.r+n.y*t.r)/r;return i*i+a*a}function IR(e){this._=e,this.next=null,this.previous=null}function qR(e){if(!(i=(e=function(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(e)).length))return 0;var t,n,r,i,a,o,s,l,u,c,f;if((t=e[0]).x=0,t.y=0,!(i>1))return t.r;if(n=e[1],t.x=-n.r,n.x=t.r,n.y=0,!(i>2))return t.r+n.r;zR(n,t,r=e[2]),t=new IR(t),n=new IR(n),r=new IR(r),t.next=r.previous=n,n.next=t.previous=r,r.next=n.previous=t;e:for(s=3;s<i;++s){zR(t._,n._,r=e[s]),r=new IR(r),l=n.next,u=t.previous,c=n._.r,f=t._.r;do{if(c<=f){if(BR(l._,r._)){n=l,t.next=n,n.previous=t,--s;continue e}c+=l._.r,l=l.next}else{if(BR(u._,r._)){(t=u).next=n,n.previous=t,--s;continue e}f+=u._.r,u=u.previous}}while(l!==u.next);for(r.previous=t,r.next=n,t.next=n.previous=n=r,a=LR(t);(r=r.next)!==n;)(o=LR(r))<a&&(t=r,a=o);n=t.next}for(t=[n._],r=n;(r=r.next)!==n;)t.push(r._);for(r=CR(t),s=0;s<i;++s)(t=e[s]).x-=r.x,t.y-=r.y;return r.r}function UR(e){return null==e?null:VR(e)}function VR(e){if("function"!=typeof e)throw new Error;return e}function WR(){return 0}function HR(e){return function(){return e}}function GR(e){return Math.sqrt(e.value)}function XR(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function YR(e,t){return function(n){if(r=n.children){var r,i,a,o=r.length,s=e(n)*t||0;if(s)for(i=0;i<o;++i)r[i].r+=s;if(a=qR(r),s)for(i=0;i<o;++i)r[i].r-=s;n.r=a+s}}}function JR(e){return function(t){var n=t.parent;t.r*=e,n&&(t.x=n.x+e*t.x,t.y=n.y+e*t.y)}}function KR(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function QR(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(r-t)/e.value;++s<l;)(a=o[s]).y0=n,a.y1=i,a.x0=t,a.x1=t+=a.value*u}DR.prototype=OR.prototype={constructor:DR,count:function(){return this.eachAfter(kR)},each:function(e,t){let n=-1;for(const r of this)e.call(t,r,++n,this);return this},eachAfter:function(e,t){for(var n,r,i,a=this,o=[a],s=[],l=-1;a=o.pop();)if(s.push(a),n=a.children)for(r=0,i=n.length;r<i;++r)o.push(n[r]);for(;a=s.pop();)e.call(t,a,++l,this);return this},eachBefore:function(e,t){for(var n,r,i=this,a=[i],o=-1;i=a.pop();)if(e.call(t,i,++o,this),n=i.children)for(r=n.length-1;r>=0;--r)a.push(n[r]);return this},find:function(e,t){let n=-1;for(const r of this)if(e.call(t,r,++n,this))return r},sum:function(e){return this.eachAfter((function(t){for(var n=+e(t.data)||0,r=t.children,i=r&&r.length;--i>=0;)n+=r[i].value;t.value=n}))},sort:function(e){return this.eachBefore((function(t){t.children&&t.children.sort(e)}))},path:function(e){for(var t=this,n=function(e,t){if(e===t)return e;var n=e.ancestors(),r=t.ancestors(),i=null;e=n.pop(),t=r.pop();for(;e===t;)i=e,e=n.pop(),t=r.pop();return i}(t,e),r=[t];t!==n;)t=t.parent,r.push(t);for(var i=r.length;e!==n;)r.splice(i,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore((function(t){t.children||e.push(t)})),e},links:function(){var e=this,t=[];return e.each((function(n){n!==e&&t.push({source:n.parent,target:n})})),t},copy:function(){return OR(this).eachBefore(ER)},[Symbol.iterator]:function*(){var e,t,n,r,i=this,a=[i];do{for(e=a.reverse(),a=[];i=e.pop();)if(yield i,t=i.children)for(n=0,r=t.length;n<r;++n)a.push(t[n])}while(a.length)}};var ZR={depth:-1},eP={};function tP(e){return e.id}function nP(e){return e.parentId}function rP(){var e=tP,t=nP;function n(n){var r,i,a,o,s,l,u,c=Array.from(n),f=c.length,d=new Map;for(i=0;i<f;++i)r=c[i],s=c[i]=new DR(r),null!=(l=e(r,i,n))&&(l+="")&&(u=s.id=l,d.set(u,d.has(u)?eP:s)),null!=(l=t(r,i,n))&&(l+="")&&(s.parent=l);for(i=0;i<f;++i)if(l=(s=c[i]).parent){if(!(o=d.get(l)))throw new Error("missing: "+l);if(o===eP)throw new Error("ambiguous: "+l);o.children?o.children.push(s):o.children=[s],s.parent=o}else{if(a)throw new Error("multiple roots");a=s}if(!a)throw new Error("no root");if(a.parent=ZR,a.eachBefore((function(e){e.depth=e.parent.depth+1,--f})).eachBefore(AR),a.parent=null,f>0)throw new Error("cycle");return a}return n.id=function(t){return arguments.length?(e=VR(t),n):e},n.parentId=function(e){return arguments.length?(t=VR(e),n):t},n}function iP(e,t){return e.parent===t.parent?1:2}function aP(e){var t=e.children;return t?t[0]:e.t}function oP(e){var t=e.children;return t?t[t.length-1]:e.t}function sP(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function lP(e,t,n){return e.a.parent===t.parent?e.a:n}function uP(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function cP(e,t,n,r,i){for(var a,o=e.children,s=-1,l=o.length,u=e.value&&(i-n)/e.value;++s<l;)(a=o[s]).x0=t,a.x1=r,a.y0=n,a.y1=n+=a.value*u}uP.prototype=Object.create(DR.prototype);var fP=(1+Math.sqrt(5))/2;function dP(e,t,n,r,i,a){for(var o,s,l,u,c,f,d,h,p,m,g,y=[],v=t.children,b=0,x=0,w=v.length,_=t.value;b<w;){l=i-n,u=a-r;do{c=v[x++].value}while(!c&&x<w);for(f=d=c,g=c*c*(m=Math.max(u/l,l/u)/(_*e)),p=Math.max(d/g,g/f);x<w;++x){if(c+=s=v[x].value,s<f&&(f=s),s>d&&(d=s),g=c*c*m,(h=Math.max(d/g,g/f))>p){c-=s;break}p=h}y.push(o={value:c,dice:l<u,children:v.slice(b,x)}),o.dice?QR(o,n,r,i,_?r+=u*c/_:a):cP(o,n,r,_?n+=l*c/_:i,a),_-=c,b=x}return y}var hP=function e(t){function n(e,n,r,i,a){dP(t,e,n,r,i,a)}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(fP);var pP=function e(t){function n(e,n,r,i,a){if((o=e._squarify)&&o.ratio===t)for(var o,s,l,u,c,f=-1,d=o.length,h=e.value;++f<d;){for(l=(s=o[f]).children,u=s.value=0,c=l.length;u<c;++u)s.value+=l[u].value;s.dice?QR(s,n,r,i,h?r+=(a-r)*s.value/h:a):cP(s,n,r,h?n+=(i-n)*s.value/h:i,a),h-=s.value}else e._squarify=o=dP(t,e,n,r,i,a),o.ratio=t}return n.ratio=function(t){return e((t=+t)>1?t:1)},n}(fP);function mP(e,t,n){const r={};return e.each((e=>{const i=e.data;n(i)&&(r[t(i)]=e)})),e.lookup=r,e}function gP(e){Cg.call(this,null,e)}gP.Definition={type:"Nest",metadata:{treesource:!0,changes:!0},params:[{name:"keys",type:"field",array:!0},{name:"generate",type:"boolean"}]};const yP=e=>e.values;function vP(){const e=[],t={entries:e=>r(n(e,0),0),key:n=>(e.push(n),t)};function n(t,r){if(r>=e.length)return t;const i=t.length,a=e[r++],o={},s={};let l,u,c,f=-1;for(;++f<i;)l=a(u=t[f])+"",(c=o[l])?c.push(u):o[l]=[u];for(l in o)s[l]=n(o[l],r);return s}function r(t,n){if(++n>e.length)return t;const i=[];for(const e in t)i.push({key:e,values:r(t[e],n)});return i}return t}function bP(e){Cg.call(this,null,e)}kc(gP,Cg,{transform(e,t){t.source||ku("Nest transform requires an upstream data source.");var n=e.generate,r=e.modified(),i=t.clone(),a=this.value;return(!a||r||t.changed())&&(a&&a.each((e=>{e.children&&Jm(e.data)&&i.rem.push(e.data)})),this.value=a=OR({values:ac(e.keys).reduce(((e,t)=>(e.key(t),e)),vP()).entries(i.source)},yP),n&&a.each((e=>{e.children&&(e=Zm(e.data),i.add.push(e),i.source.push(e))})),mP(a,Km,Km)),i.source.root=a,i}});const xP=(e,t)=>e.parent===t.parent?1:2;kc(bP,Cg,{transform(e,t){t.source&&t.source.root||ku(this.constructor.name+" transform requires a backing tree data source.");const n=this.layout(e.method),r=this.fields,i=t.source.root,a=e.as||r;e.field?i.sum(e.field):i.count(),e.sort&&i.sort(rg(e.sort,(e=>e.data))),function(e,t,n){for(let r,i=0,a=t.length;i<a;++i)r=t[i],r in n&&e[r](n[r])}(n,this.params,e),n.separation&&n.separation(!1!==e.separation?xP:Du);try{this.value=n(i)}catch(e){ku(e)}return i.each((e=>function(e,t,n){const r=e.data,i=t.length-1;for(let a=0;a<i;++a)r[n[a]]=e[t[a]];r[n[i]]=e.children?e.children.length:0}(e,r,a))),t.reflow(e.modified()).modifies(a).modifies("leaf")}});const wP=["x","y","r","depth","children"];function _P(e){bP.call(this,e)}_P.Definition={type:"Pack",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:wP.length,default:wP}]},kc(_P,bP,{layout:function(){var e=null,t=1,n=1,r=WR;function i(i){return i.x=t/2,i.y=n/2,e?i.eachBefore(XR(e)).eachAfter(YR(r,.5)).eachBefore(JR(1)):i.eachBefore(XR(GR)).eachAfter(YR(WR,1)).eachAfter(YR(r,i.r/Math.min(t,n))).eachBefore(JR(Math.min(t,n)/(2*i.r))),i}return i.radius=function(t){return arguments.length?(e=UR(t),i):e},i.size=function(e){return arguments.length?(t=+e[0],n=+e[1],i):[t,n]},i.padding=function(e){return arguments.length?(r="function"==typeof e?e:HR(+e),i):r},i},params:["radius","size","padding"],fields:wP});const kP=["x0","y0","x1","y1","depth","children"];function OP(e){bP.call(this,e)}function SP(e){Cg.call(this,null,e)}OP.Definition={type:"Partition",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:kP.length,default:kP}]},kc(OP,bP,{layout:function(){var e=1,t=1,n=0,r=!1;function i(i){var a=i.height+1;return i.x0=i.y0=n,i.x1=e,i.y1=t/a,i.eachBefore(function(e,t){return function(r){r.children&&QR(r,r.x0,e*(r.depth+1)/t,r.x1,e*(r.depth+2)/t);var i=r.x0,a=r.y0,o=r.x1-n,s=r.y1-n;o<i&&(i=o=(i+o)/2),s<a&&(a=s=(a+s)/2),r.x0=i,r.y0=a,r.x1=o,r.y1=s}}(t,a)),r&&i.eachBefore(KR),i}return i.round=function(e){return arguments.length?(r=!!e,i):r},i.size=function(n){return arguments.length?(e=+n[0],t=+n[1],i):[e,t]},i.padding=function(e){return arguments.length?(n=+e,i):n},i},params:["size","round","padding"],fields:kP}),SP.Definition={type:"Stratify",metadata:{treesource:!0},params:[{name:"key",type:"field",required:!0},{name:"parentKey",type:"field",required:!0}]},kc(SP,Cg,{transform(e,t){t.source||ku("Stratify transform requires an upstream data source.");let n=this.value;const r=e.modified(),i=t.fork(t.ALL).materialize(t.SOURCE),a=!n||r||t.changed(t.ADD_REM)||t.modified(e.key.fields)||t.modified(e.parentKey.fields);return i.source=i.source.slice(),a&&(n=i.source.length?mP(rP().id(e.key).parentId(e.parentKey)(i.source),e.key,Cu):mP(rP()([{}]),e.key,e.key)),i.source.root=this.value=n,i}});const $P={tidy:function(){var e=iP,t=1,n=1,r=null;function i(i){var l=function(e){for(var t,n,r,i,a,o=new uP(e,0),s=[o];t=s.pop();)if(r=t._.children)for(t.children=new Array(a=r.length),i=a-1;i>=0;--i)s.push(n=t.children[i]=new uP(r[i],i)),n.parent=t;return(o.parent=new uP(null,0)).children=[o],o}(i);if(l.eachAfter(a),l.parent.m=-l.z,l.eachBefore(o),r)i.eachBefore(s);else{var u=i,c=i,f=i;i.eachBefore((function(e){e.x<u.x&&(u=e),e.x>c.x&&(c=e),e.depth>f.depth&&(f=e)}));var d=u===c?1:e(u,c)/2,h=d-u.x,p=t/(c.x+d+h),m=n/(f.depth||1);i.eachBefore((function(e){e.x=(e.x+h)*p,e.y=e.depth*m}))}return i}function a(t){var n=t.children,r=t.parent.children,i=t.i?r[t.i-1]:null;if(n){!function(e){for(var t,n=0,r=0,i=e.children,a=i.length;--a>=0;)(t=i[a]).z+=n,t.m+=n,n+=t.s+(r+=t.c)}(t);var a=(n[0].z+n[n.length-1].z)/2;i?(t.z=i.z+e(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+e(t._,i._));t.parent.A=function(t,n,r){if(n){for(var i,a=t,o=t,s=n,l=a.parent.children[0],u=a.m,c=o.m,f=s.m,d=l.m;s=oP(s),a=aP(a),s&&a;)l=aP(l),(o=oP(o)).a=t,(i=s.z+f-a.z-u+e(s._,a._))>0&&(sP(lP(s,t,r),t,i),u+=i,c+=i),f+=s.m,u+=a.m,d+=l.m,c+=o.m;s&&!oP(o)&&(o.t=s,o.m+=f-c),a&&!aP(l)&&(l.t=a,l.m+=u-d,r=t)}return r}(t,i,t.parent.A||r[0])}function o(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function s(e){e.x*=t,e.y=e.depth*n}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i},cluster:function(){var e=xR,t=1,n=1,r=!1;function i(i){var a,o=0;i.eachAfter((function(t){var n=t.children;n?(t.x=function(e){return e.reduce(wR,0)/e.length}(n),t.y=function(e){return 1+e.reduce(_R,0)}(n)):(t.x=a?o+=e(t,a):0,t.y=0,a=t)}));var s=function(e){for(var t;t=e.children;)e=t[0];return e}(i),l=function(e){for(var t;t=e.children;)e=t[t.length-1];return e}(i),u=s.x-e(s,l)/2,c=l.x+e(l,s)/2;return i.eachAfter(r?function(e){e.x=(e.x-i.x)*t,e.y=(i.y-e.y)*n}:function(e){e.x=(e.x-u)/(c-u)*t,e.y=(1-(i.y?e.y/i.y:1))*n})}return i.separation=function(t){return arguments.length?(e=t,i):e},i.size=function(e){return arguments.length?(r=!1,t=+e[0],n=+e[1],i):r?null:[t,n]},i.nodeSize=function(e){return arguments.length?(r=!0,t=+e[0],n=+e[1],i):r?[t,n]:null},i}},EP=["x","y","depth","children"];function AP(e){bP.call(this,e)}function DP(e){Cg.call(this,[],e)}AP.Definition={type:"Tree",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:!0,length:2},{name:"nodeSize",type:"number",array:!0,length:2},{name:"separation",type:"boolean",default:!0},{name:"as",type:"string",array:!0,length:EP.length,default:EP}]},kc(AP,bP,{layout(e){const t=e||"tidy";if(bc($P,t))return $P[t]();ku("Unrecognized Tree layout method: "+t)},params:["size","nodeSize"],fields:EP}),DP.Definition={type:"TreeLinks",metadata:{tree:!0,generates:!0,changes:!0},params:[]},kc(DP,Cg,{transform(e,t){const n=this.value,r=t.source&&t.source.root,i=t.fork(t.NO_SOURCE),a={};return r||ku("TreeLinks transform requires a tree data source."),t.changed(t.ADD_REM)?(i.rem=n,t.visit(t.SOURCE,(e=>a[Km(e)]=1)),r.each((e=>{const t=e.data,n=e.parent&&e.parent.data;n&&a[Km(t)]&&a[Km(n)]&&i.add.push(Zm({source:n,target:t}))})),this.value=i.add):t.changed(t.MOD)&&(t.visit(t.MOD,(e=>a[Km(e)]=1)),n.forEach((e=>{(a[Km(e.source)]||a[Km(e.target)])&&i.mod.push(e)}))),i}});const CP={binary:function(e,t,n,r,i){var a,o,s=e.children,l=s.length,u=new Array(l+1);for(u[0]=o=a=0;a<l;++a)u[a+1]=o+=s[a].value;!function e(t,n,r,i,a,o,l){if(t>=n-1){var c=s[t];return c.x0=i,c.y0=a,c.x1=o,void(c.y1=l)}var f=u[t],d=r/2+f,h=t+1,p=n-1;for(;h<p;){var m=h+p>>>1;u[m]<d?h=m+1:p=m}d-u[h-1]<u[h]-d&&t+1<h&&--h;var g=u[h]-f,y=r-g;if(o-i>l-a){var v=r?(i*y+o*g)/r:o;e(t,h,g,i,a,v,l),e(h,n,y,v,a,o,l)}else{var b=r?(a*y+l*g)/r:l;e(t,h,g,i,a,o,b),e(h,n,y,i,b,o,l)}}(0,l,e.value,t,n,r,i)},dice:QR,slice:cP,slicedice:function(e,t,n,r,i){(1&e.depth?cP:QR)(e,t,n,r,i)},squarify:hP,resquarify:pP},MP=["x0","y0","x1","y1","depth","children"];function jP(e){bP.call(this,e)}jP.Definition={type:"Treemap",metadata:{tree:!0,modifies:!0},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:!1},{name:"size",type:"number",array:!0,length:2},{name:"as",type:"string",array:!0,length:MP.length,default:MP}]},kc(jP,bP,{layout(){const e=function(){var e=hP,t=!1,n=1,r=1,i=[0],a=WR,o=WR,s=WR,l=WR,u=WR;function c(e){return e.x0=e.y0=0,e.x1=n,e.y1=r,e.eachBefore(f),i=[0],t&&e.eachBefore(KR),e}function f(t){var n=i[t.depth],r=t.x0+n,c=t.y0+n,f=t.x1-n,d=t.y1-n;f<r&&(r=f=(r+f)/2),d<c&&(c=d=(c+d)/2),t.x0=r,t.y0=c,t.x1=f,t.y1=d,t.children&&(n=i[t.depth+1]=a(t)/2,r+=u(t)-n,c+=o(t)-n,(f-=s(t)-n)<r&&(r=f=(r+f)/2),(d-=l(t)-n)<c&&(c=d=(c+d)/2),e(t,r,c,f,d))}return c.round=function(e){return arguments.length?(t=!!e,c):t},c.size=function(e){return arguments.length?(n=+e[0],r=+e[1],c):[n,r]},c.tile=function(t){return arguments.length?(e=VR(t),c):e},c.padding=function(e){return arguments.length?c.paddingInner(e).paddingOuter(e):c.paddingInner()},c.paddingInner=function(e){return arguments.length?(a="function"==typeof e?e:HR(+e),c):a},c.paddingOuter=function(e){return arguments.length?c.paddingTop(e).paddingRight(e).paddingBottom(e).paddingLeft(e):c.paddingTop()},c.paddingTop=function(e){return arguments.length?(o="function"==typeof e?e:HR(+e),c):o},c.paddingRight=function(e){return arguments.length?(s="function"==typeof e?e:HR(+e),c):s},c.paddingBottom=function(e){return arguments.length?(l="function"==typeof e?e:HR(+e),c):l},c.paddingLeft=function(e){return arguments.length?(u="function"==typeof e?e:HR(+e),c):u},c}();return e.ratio=t=>{const n=e.tile();n.ratio&&e.tile(n.ratio(t))},e.method=t=>{bc(CP,t)?e.tile(CP[t]):ku("Unrecognized Treemap layout method: "+t)},e},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:MP});var FP=Object.freeze({__proto__:null,nest:gP,pack:_P,partition:OP,stratify:SP,tree:AP,treelinks:DP,treemap:jP});function TP(e,t,n,r){const i=e.width,a=e.height,o=n||r,s=fx(i,a).getContext("2d");t.forEach((e=>NP(s,e,o)));const l=new Uint32Array(s.getImageData(0,0,i,a).data.buffer),u=e.bitmap(),c=o&&e.bitmap();let f,d,h,p,m;for(d=0;d<a;++d)for(f=0;f<i;++f)m=4278190080&l[d*i+f],m&&(h=e(f),p=e(d),r||u.set(h,p),o&&268435456^m&&c.set(h,p));return[u,c]}function NP(e,t,n){if(!t.length)return;const r=t[0].mark.marktype;"group"===r?t.forEach((t=>{t.items.forEach((t=>NP(e,t.items,n)))})):lE[r].draw(e,{items:n?t.map(RP):t})}function RP(e){const t=tg(e,{});return t.stroke&&(t.strokeOpacity=1),t.fill&&(t.fillOpacity=.0625,t.stroke="#000",t.strokeOpacity=1,t.strokeWidth=2),t}const PP=31,zP=new Uint32Array(33),BP=new Uint32Array(33);BP[0]=0,zP[0]=~BP[0];for(let e=1;e<=32;++e)BP[e]=BP[e-1]<<1|1,zP[e]=~BP[e];function LP(e,t,n){const r=Math.max(1,Math.sqrt(e*t/1e6)),i=~~((e+2*n+r)/r),a=~~((t+2*n+r)/r),o=e=>~~((e+n)/r);return o.invert=e=>e*r-n,o.bitmap=()=>function(e,t){const n=new Uint32Array(~~((e*t+32)/32));function r(e,t){n[e]|=t}function i(e,t){n[e]&=t}return{array:n,get:(t,r)=>{const i=r*e+t;return n[i>>>5]&1<<(i&PP)},set:(t,n)=>{const i=n*e+t;r(i>>>5,1<<(i&PP))},clear:(t,n)=>{const r=n*e+t;i(r>>>5,~(1<<(r&PP)))},getRange:(t,r,i,a)=>{let o,s,l,u,c=a;for(;c>=r;--c)if(o=c*e+t,s=c*e+i,l=o>>>5,u=s>>>5,l===u){if(n[l]&zP[o&PP]&BP[1+(s&PP)])return!0}else{if(n[l]&zP[o&PP])return!0;if(n[u]&BP[1+(s&PP)])return!0;for(let e=l+1;e<u;++e)if(n[e])return!0}return!1},setRange:(t,n,i,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+i,l=o>>>5,u=s>>>5,l===u)r(l,zP[o&PP]&BP[1+(s&PP)]);else for(r(l,zP[o&PP]),r(u,BP[1+(s&PP)]),c=l+1;c<u;++c)r(c,4294967295)},clearRange:(t,n,r,a)=>{let o,s,l,u,c;for(;n<=a;++n)if(o=n*e+t,s=n*e+r,l=o>>>5,u=s>>>5,l===u)i(l,BP[o&PP]|zP[1+(s&PP)]);else for(i(l,BP[o&PP]),i(u,zP[1+(s&PP)]),c=l+1;c<u;++c)i(c,0)},outOfBounds:(n,r,i,a)=>n<0||r<0||a>=t||i>=e}}(i,a),o.ratio=r,o.padding=n,o.width=e,o.height=t,o}function IP(e,t,n,r,i,a){let o=n/2;return e-o<0||e+o>i||t-(o=r/2)<0||t+o>a}function qP(e,t,n,r,i,a,o,s){const l=i*a/(2*r),u=e(t-l),c=e(t+l),f=e(n-(a/=2)),d=e(n+a);return o.outOfBounds(u,f,c,d)||o.getRange(u,f,c,d)||s&&s.getRange(u,f,c,d)}const UP=[-1,-1,1,1],VP=[-1,1,-1,1];const WP=["right","center","left"],HP=["bottom","middle","top"];function GP(e,t,n,r,i,a,o,s,l,u,c,f){return!(i.outOfBounds(e,n,t,r)||(f&&a?a.getRange(e,n,t,r)||!function(e,t,n,r,i){return i[0]<=e&&n<=i[2]&&i[3]<=t&&r<=i[5]}(o,l,s,u,c):i.getRange(e,n,t,r)))}const XP={"top-left":0,top:1,"top-right":2,left:4,middle:5,right:6,"bottom-left":8,bottom:9,"bottom-right":10},YP={naive:function(e,t,n,r){const i=e.width,a=e.height;return function(e){const t=e.datum.datum.items[r].items,n=t.length,o=e.datum.fontSize,s=V$.width(e.datum,e.datum.text);let l,u,c,f,d,h,p,m=0;for(let r=0;r<n;++r)l=t[r].x,c=t[r].y,u=void 0===t[r].x2?l:t[r].x2,f=void 0===t[r].y2?c:t[r].y2,d=(l+u)/2,h=(c+f)/2,p=Math.abs(u-l+f-c),p>=m&&(m=p,e.x=d,e.y=h);return d=s/2,h=o/2,l=e.x-d,u=e.x+d,c=e.y-h,f=e.y+h,e.align="center",l<0&&u<=i?e.align="left":0<=l&&i<u&&(e.align="right"),e.baseline="middle",c<0&&f<=a?e.baseline="top":0<=c&&a<f&&(e.baseline="bottom"),!0}},"reduced-search":function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1];function l(t,n,r,l,u){const c=e.invert(t),f=e.invert(n);let d,h=r,p=a;if(!IP(c,f,l,u,i,a)&&!qP(e,c,f,u,l,h,o,s)&&!qP(e,c,f,u,l,u,o,null)){for(;p-h>=1;)d=(h+p)/2,qP(e,c,f,u,l,d,o,s)?p=d:h=d;if(h>r)return[c,f,h,!0]}}return function(t){const s=t.datum.datum.items[r].items,u=s.length,c=t.datum.fontSize,f=V$.width(t.datum,t.datum.text);let d,h,p,m,g,y,v,b,x,w,_,k,O,S,$,E,A,D=n?c:0,C=!1,M=!1,j=0;for(let r=0;r<u;++r){for(d=s[r].x,p=s[r].y,h=void 0===s[r].x2?d:s[r].x2,m=void 0===s[r].y2?p:s[r].y2,d>h&&(A=d,d=h,h=A),p>m&&(A=p,p=m,m=A),x=e(d),_=e(h),w=~~((x+_)/2),k=e(p),S=e(m),O=~~((k+S)/2),v=w;v>=x;--v)for(b=O;b>=k;--b)E=l(v,b,D,f,c),E&&([t.x,t.y,D,C]=E);for(v=w;v<=_;++v)for(b=O;b<=S;++b)E=l(v,b,D,f,c),E&&([t.x,t.y,D,C]=E);C||n||($=Math.abs(h-d+m-p),g=(d+h)/2,y=(p+m)/2,$>=j&&!IP(g,y,f,c,i,a)&&!qP(e,g,y,c,f,c,o,null)&&(j=$,t.x=g,t.y=y,M=!0))}return!(!C&&!M)&&(g=f/2,y=c/2,o.setRange(e(t.x-g),e(t.y-y),e(t.x+g),e(t.y+y)),t.align="center",t.baseline="middle",!0)}},floodfill:function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=e.bitmap();return function(t){const u=t.datum.datum.items[r].items,c=u.length,f=t.datum.fontSize,d=V$.width(t.datum,t.datum.text),h=[];let p,m,g,y,v,b,x,w,_,k,O,S,$=n?f:0,E=!1,A=!1,D=0;for(let r=0;r<c;++r){for(p=u[r].x,g=u[r].y,m=void 0===u[r].x2?p:u[r].x2,y=void 0===u[r].y2?g:u[r].y2,h.push([e((p+m)/2),e((g+y)/2)]);h.length;)if([x,w]=h.pop(),!(o.get(x,w)||s.get(x,w)||l.get(x,w))){l.set(x,w);for(let e=0;e<4;++e)v=x+UP[e],b=w+VP[e],l.outOfBounds(v,b,v,b)||h.push([v,b]);if(v=e.invert(x),b=e.invert(w),_=$,k=a,!IP(v,b,d,f,i,a)&&!qP(e,v,b,f,d,_,o,s)&&!qP(e,v,b,f,d,f,o,null)){for(;k-_>=1;)O=(_+k)/2,qP(e,v,b,f,d,O,o,s)?k=O:_=O;_>$&&(t.x=v,t.y=b,$=_,E=!0)}}E||n||(S=Math.abs(m-p+y-g),v=(p+m)/2,b=(g+y)/2,S>=D&&!IP(v,b,d,f,i,a)&&!qP(e,v,b,f,d,f,o,null)&&(D=S,t.x=v,t.y=b,A=!0))}return!(!E&&!A)&&(v=d/2,b=f/2,o.setRange(e(t.x-v),e(t.y-b),e(t.x+v),e(t.y+b)),t.align="center",t.baseline="middle",!0)}}};function JP(e,t,n,r,i,a,o,s,l,u,c){if(!e.length)return e;const f=Math.max(r.length,i.length),d=function(e,t){const n=new Float64Array(t),r=e.length;for(let t=0;t<r;++t)n[t]=e[t]||0;for(let e=r;e<t;++e)n[e]=n[r-1];return n}(r,f),h=function(e,t){const n=new Int8Array(t),r=e.length;for(let t=0;t<r;++t)n[t]|=XP[e[t]];for(let e=r;e<t;++e)n[e]=n[r-1];return n}(i,f),p=(x=e[0].datum)&&x.mark&&x.mark.marktype,m="group"===p&&e[0].datum.items[l].marktype,g="area"===m,y=function(e,t,n,r){const i=e=>[e.x,e.x,e.x,e.y,e.y,e.y];return e?"line"===e||"area"===e?e=>i(e.datum):"line"===t?e=>{const t=e.datum.items[r].items;return i(t.length?t["start"===n?0:t.length-1]:{x:NaN,y:NaN})}:e=>{const t=e.datum.bounds;return[t.x1,(t.x1+t.x2)/2,t.x2,t.y1,(t.y1+t.y2)/2,t.y2]}:i}(p,m,s,l),v=LP(t[0],t[1],u),b=g&&"naive"===c;var x;const w=e.map((e=>({datum:e,opacity:0,x:void 0,y:void 0,align:void 0,baseline:void 0,boundary:y(e)})));let _;if(!b){n&&w.sort(((e,t)=>n(e.datum,t.datum)));let t=!1;for(let e=0;e<h.length&&!t;++e)t=5===h[e]||d[e]<0;p&&(o||g)&&(a=[e.map((e=>e.datum))].concat(a)),_=a.length?TP(v,a,t,g):function(e,t){const n=e.bitmap();return(t||[]).forEach((t=>n.set(e(t.boundary[0]),e(t.boundary[3])))),[n,void 0]}(v,o&&w)}const k=g?YP[c](v,_,o,l):function(e,t,n,r){const i=e.width,a=e.height,o=t[0],s=t[1],l=r.length;return function(t){const u=t.boundary,c=t.datum.fontSize;if(u[2]<0||u[5]<0||u[0]>i||u[3]>a)return!1;let f,d,h,p,m,g,y,v,b,x,w,_,k,O,S,$=0;for(let i=0;i<l;++i){if(f=(3&n[i])-1,d=(n[i]>>>2&3)-1,h=0===f&&0===d||r[i]<0,p=f&&d?Math.SQRT1_2:1,m=r[i]<0?-1:1,g=u[1+f]+r[i]*f*p,w=u[4+d]+m*c*d/2+r[i]*d*p,v=w-c/2,b=w+c/2,_=e(g),O=e(v),S=e(b),!$){if(!GP(_,_,O,S,o,s,g,g,v,b,u,h))continue;$=V$.width(t.datum,t.datum.text)}if(x=g+m*$*f/2,g=x-$/2,y=x+$/2,_=e(g),k=e(y),GP(_,k,O,S,o,s,g,y,v,b,u,h))return t.x=f?f*m<0?y:g:x,t.y=d?d*m<0?b:v:w,t.align=WP[f*m+1],t.baseline=HP[d*m+1],o.setRange(_,O,k,S),!0}return!1}}(v,_,h,d);return w.forEach((e=>e.opacity=+k(e))),w}const KP=["x","y","opacity","align","baseline"],QP=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function ZP(e){Cg.call(this,null,e)}ZP.Definition={type:"Label",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2,required:!0},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:!0,default:QP},{name:"offset",type:"number",array:!0,default:[1]},{name:"padding",type:"number",default:0},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:!0},{name:"avoidMarks",type:"data",array:!0},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:!0,length:KP.length,default:KP}]},kc(ZP,Cg,{transform(e,t){const n=e.modified();if(!(n||t.changed(t.ADD_REM)||function(n){const r=e[n];return sc(r)&&t.modified(r.fields)}("sort")))return;e.size&&2===e.size.length||ku("Size parameter should be specified as a [width, height] array.");const r=e.as||KP;return JP(t.materialize(t.SOURCE).source,e.size,e.sort,ac(e.offset||1),ac(e.anchor||QP),e.avoidMarks||[],!1!==e.avoidBaseMark,e.lineAnchor||"end",e.markIndex||0,e.padding||0,e.method||"naive").forEach((e=>{const t=e.datum;t[r[0]]=e.x,t[r[1]]=e.y,t[r[2]]=e.opacity,t[r[3]]=e.align,t[r[4]]=e.baseline})),t.reflow(n).modifies(r)}});var ez=Object.freeze({__proto__:null,label:ZP});function tz(e,t){var n,r,i,a,o,s,l=[],u=function(e){return e(a)};if(null==t)l.push(e);else for(n={},r=0,i=e.length;r<i;++r)a=e[r],(s=n[o=t.map(u)])||(n[o]=s=[],s.dims=o,l.push(s)),s.push(a);return l}function nz(e){Cg.call(this,null,e)}nz.Definition={type:"Loess",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:!0}]},kc(nz,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=tz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(vu),a=i.length,o=e.as||[vu(e.x),vu(e.y)],s=[];r.forEach((t=>{by(t,e.x,e.y,e.bandwidth||.3).forEach((e=>{const n={};for(let e=0;e<a;++e)n[i[e]]=t.dims[e];n[o[0]]=e[0],n[o[1]]=e[1],s.push(Zm(n))}))})),this.value&&(n.rem=this.value),this.value=n.add=n.source=s}return n}});const rz={linear:dy,log:hy,exp:py,pow:my,quad:gy,poly:yy};function iz(e){Cg.call(this,null,e)}iz.Definition={type:"Regression",metadata:{generates:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"groupby",type:"field",array:!0},{name:"method",type:"string",default:"linear",values:Object.keys(rz)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:!0,length:2},{name:"params",type:"boolean",default:!1},{name:"as",type:"string",array:!0}]},kc(iz,Cg,{transform(e,t){const n=t.fork(t.NO_SOURCE|t.NO_FIELDS);if(!this.value||t.changed()||e.modified()){const r=tz(t.materialize(t.SOURCE).source,e.groupby),i=(e.groupby||[]).map(vu),a=e.method||"linear",o=e.order||3,s=((e,t)=>"poly"===e?t:"quad"===e?2:1)(a,o),l=e.as||[vu(e.x),vu(e.y)],u=rz[a],c=[];let f=e.extent;bc(rz,a)||ku("Invalid regression method: "+a),null!=f&&"log"===a&&f[0]<=0&&(t.dataflow.warn("Ignoring extent with values <= 0 for log regression."),f=null),r.forEach((n=>{if(n.length<=s)return void t.dataflow.warn("Skipping regression with more parameters than data points.");const r=u(n,e.x,e.y,o);if(e.params)return void c.push(Zm({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));const d=f||gc(n,e.x),h=e=>{const t={};for(let e=0;e<i.length;++e)t[i[e]]=n.dims[e];t[l[0]]=e[0],t[l[1]]=e[1],c.push(Zm(t))};"linear"===a?d.forEach((e=>h([e,r.predict(e)]))):ky(r.predict,d,25,200).forEach(h)})),this.value&&(n.rem=this.value),this.value=n.add=n.source=c}return n}});var az=Object.freeze({__proto__:null,loess:nz,regression:iz});const oz=Math.pow(2,-52),sz=new Uint32Array(512);class lz{static from(e,t=gz,n=yz){const r=e.length,i=new Float64Array(2*r);for(let a=0;a<r;a++){const r=e[a];i[2*a]=t(r),i[2*a+1]=n(r)}return new lz(i)}constructor(e){const t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw new Error("Expected coords to contain numbers.");this.coords=e;const n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){const{coords:e,_hullPrev:t,_hullNext:n,_hullTri:r,_hullHash:i}=this,a=e.length>>1;let o=1/0,s=1/0,l=-1/0,u=-1/0;for(let t=0;t<a;t++){const n=e[2*t],r=e[2*t+1];n<o&&(o=n),r<s&&(s=r),n>l&&(l=n),r>u&&(u=r),this._ids[t]=t}const c=(o+l)/2,f=(s+u)/2;let d,h,p,m=1/0;for(let t=0;t<a;t++){const n=uz(c,f,e[2*t],e[2*t+1]);n<m&&(d=t,m=n)}const g=e[2*d],y=e[2*d+1];m=1/0;for(let t=0;t<a;t++){if(t===d)continue;const n=uz(g,y,e[2*t],e[2*t+1]);n<m&&n>0&&(h=t,m=n)}let v=e[2*h],b=e[2*h+1],x=1/0;for(let t=0;t<a;t++){if(t===d||t===h)continue;const n=hz(g,y,v,b,e[2*t],e[2*t+1]);n<x&&(p=t,x=n)}let w=e[2*p],_=e[2*p+1];if(x===1/0){for(let t=0;t<a;t++)this._dists[t]=e[2*t]-e[0]||e[2*t+1]-e[1];pz(this._ids,this._dists,0,a-1);const t=new Uint32Array(a);let n=0;for(let e=0,r=-1/0;e<a;e++){const i=this._ids[e];this._dists[i]>r&&(t[n++]=i,r=this._dists[i])}return this.hull=t.subarray(0,n),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(fz(g,y,v,b,w,_)){const e=h,t=v,n=b;h=p,v=w,b=_,p=e,w=t,_=n}const k=function(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l);return{x:e+(u*c-s*f)*d,y:t+(o*f-l*c)*d}}(g,y,v,b,w,_);this._cx=k.x,this._cy=k.y;for(let t=0;t<a;t++)this._dists[t]=uz(e[2*t],e[2*t+1],k.x,k.y);pz(this._ids,this._dists,0,a-1),this._hullStart=d;let O=3;n[d]=t[p]=h,n[h]=t[d]=p,n[p]=t[h]=d,r[d]=0,r[h]=1,r[p]=2,i.fill(-1),i[this._hashKey(g,y)]=d,i[this._hashKey(v,b)]=h,i[this._hashKey(w,_)]=p,this.trianglesLen=0,this._addTriangle(d,h,p,-1,-1,-1);for(let a,o,s=0;s<this._ids.length;s++){const l=this._ids[s],u=e[2*l],c=e[2*l+1];if(s>0&&Math.abs(u-a)<=oz&&Math.abs(c-o)<=oz)continue;if(a=u,o=c,l===d||l===h||l===p)continue;let f=0;for(let e=0,t=this._hashKey(u,c);e<this._hashSize&&(f=i[(t+e)%this._hashSize],-1===f||f===n[f]);e++);f=t[f];let m,g=f;for(;m=n[g],!fz(u,c,e[2*g],e[2*g+1],e[2*m],e[2*m+1]);)if(g=m,g===f){g=-1;break}if(-1===g)continue;let y=this._addTriangle(g,l,n[g],-1,-1,r[g]);r[l]=this._legalize(y+2),r[g]=y,O++;let v=n[g];for(;m=n[v],fz(u,c,e[2*v],e[2*v+1],e[2*m],e[2*m+1]);)y=this._addTriangle(v,l,m,r[l],-1,r[v]),r[l]=this._legalize(y+2),n[v]=v,O--,v=m;if(g===f)for(;m=t[g],fz(u,c,e[2*m],e[2*m+1],e[2*g],e[2*g+1]);)y=this._addTriangle(m,l,g,-1,r[g],r[m]),this._legalize(y+2),r[m]=y,n[g]=g,O--,g=m;this._hullStart=t[l]=g,n[g]=t[v]=l,n[l]=v,i[this._hashKey(u,c)]=l,i[this._hashKey(e[2*g],e[2*g+1])]=g}this.hull=new Uint32Array(O);for(let e=0,t=this._hullStart;e<O;e++)this.hull[e]=t,t=n[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){const n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){const{_triangles:t,_halfedges:n,coords:r}=this;let i=0,a=0;for(;;){const o=n[e],s=e-e%3;if(a=s+(e+2)%3,-1===o){if(0===i)break;e=sz[--i];continue}const l=o-o%3,u=s+(e+1)%3,c=l+(o+2)%3,f=t[a],d=t[e],h=t[u],p=t[c];if(dz(r[2*f],r[2*f+1],r[2*d],r[2*d+1],r[2*h],r[2*h+1],r[2*p],r[2*p+1])){t[e]=p,t[o]=f;const r=n[c];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===c){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(o,n[a]),this._link(a,c);const s=l+(o+1)%3;i<sz.length&&(sz[i++]=s)}else{if(0===i)break;e=sz[--i]}}return a}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,a){const o=this.trianglesLen;return this._triangles[o]=e,this._triangles[o+1]=t,this._triangles[o+2]=n,this._link(o,r),this._link(o+1,i),this._link(o+2,a),this.trianglesLen+=3,o}}function uz(e,t,n,r){const i=e-n,a=t-r;return i*i+a*a}function cz(e,t,n,r,i,a){const o=(r-t)*(i-e),s=(n-e)*(a-t);return Math.abs(o-s)>=33306690738754716e-32*Math.abs(o+s)?o-s:0}function fz(e,t,n,r,i,a){return(cz(i,a,e,t,n,r)||cz(e,t,n,r,i,a)||cz(n,r,i,a,e,t))<0}function dz(e,t,n,r,i,a,o,s){const l=e-o,u=t-s,c=n-o,f=r-s,d=i-o,h=a-s,p=c*c+f*f,m=d*d+h*h;return l*(f*m-p*h)-u*(c*m-p*d)+(l*l+u*u)*(c*h-f*d)<0}function hz(e,t,n,r,i,a){const o=n-e,s=r-t,l=i-e,u=a-t,c=o*o+s*s,f=l*l+u*u,d=.5/(o*u-s*l),h=(u*c-s*f)*d,p=(o*f-l*c)*d;return h*h+p*p}function pz(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){const r=e[i],a=t[r];let o=i-1;for(;o>=n&&t[e[o]]>a;)e[o+1]=e[o--];e[o+1]=r}else{let i=n+1,a=r;mz(e,n+r>>1,i),t[e[n]]>t[e[r]]&&mz(e,n,r),t[e[i]]>t[e[r]]&&mz(e,i,r),t[e[n]]>t[e[i]]&&mz(e,n,i);const o=e[i],s=t[o];for(;;){do{i++}while(t[e[i]]<s);do{a--}while(t[e[a]]>s);if(a<i)break;mz(e,i,a)}e[n+1]=e[a],e[a]=o,r-i+1>=a-n?(pz(e,t,i,r),pz(e,t,n,a-1)):(pz(e,t,n,a-1),pz(e,t,i,r))}}function mz(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function gz(e){return e[0]}function yz(e){return e[1]}const vz=1e-6;class bz{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){const r=(e=+e)+(n=+n),i=t=+t;if(n<0)throw new Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>vz||Math.abs(this._y1-i)>vz)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class xz{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class wz{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t)&&(i=+i)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:e,hull:t,triangles:n},vectors:r}=this,i=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t,r,a=0,o=0,s=n.length;a<s;a+=3,o+=2){const s=2*n[a],l=2*n[a+1],u=2*n[a+2],c=e[s],f=e[s+1],d=e[l],h=e[l+1],p=e[u],m=e[u+1],g=d-c,y=h-f,v=p-c,b=m-f,x=g*g+y*y,w=v*v+b*b,_=2*(g*b-y*v);if(_)if(Math.abs(_)<1e-8)t=(c+p)/2,r=(f+m)/2;else{const e=1/_;t=c+(b*x-y*w)*e,r=f+(g*w-v*x)*e}else t=(c+p)/2-1e8*b,r=(f+m)/2+1e8*v;i[o]=t,i[o+1]=r}let a,o,s,l=t[t.length-1],u=4*l,c=e[2*l],f=e[2*l+1];r.fill(0);for(let n=0;n<t.length;++n)l=t[n],a=u,o=c,s=f,u=4*l,c=e[2*l],f=e[2*l+1],r[a+2]=r[u]=s-f,r[a+3]=r[u+1]=c-o}render(e){const t=null==e?e=new bz:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:a,vectors:o}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){const r=n[t];if(r<t)continue;const i=2*Math.floor(t/3),o=2*Math.floor(r/3),s=a[i],l=a[i+1],u=a[o],c=a[o+1];this._renderSegment(s,l,u,c,e)}let s,l=i[i.length-1];for(let t=0;t<i.length;++t){s=l,l=i[t];const n=2*Math.floor(r[l]/3),u=a[n],c=a[n+1],f=4*s,d=this._project(u,c,o[f+2],o[f+3]);d&&this._renderSegment(u,c,d[0],d[1],e)}return t&&t.value()}renderBounds(e){const t=null==e?e=new bz:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){const n=null==t?t=new bz:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)r[e]===r[e-2]&&r[e+1]===r[e-1]||t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){const{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){const e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){const t=new xz;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let a;const o=this._regioncode(e,t),s=this._regioncode(n,r);0===o&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(a=this._clipSegment(e,t,n,r,o,s))&&(i.moveTo(a[0],a[1]),i.lineTo(a[2],a[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){const t=this._clip(e);if(t)for(const n of this.delaunay.neighbors(e)){const e=this._clip(n);if(e)e:for(let r=0,i=t.length;r<i;r+=2)for(let a=0,o=e.length;a<o;a+=2)if(t[r]==e[a]&&t[r+1]==e[a+1]&&t[(r+2)%i]==e[(a+o-2)%o]&&t[(r+3)%i]==e[(a+o-1)%o]){yield n;break e}}}_cell(e){const{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,a=n[e];if(-1===a)return null;const o=[];let s=a;do{const n=Math.floor(s/3);if(o.push(t[2*n],t[2*n+1]),s=s%3==2?s-2:s+1,i[s]!==e)break;s=r[s]}while(s!==a&&-1!==s);return o}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const t=this._cell(e);if(null===t)return null;const{vectors:n}=this,r=4*e;return n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t)}_clipFinite(e,t){const n=t.length;let r,i,a,o,s,l=null,u=t[n-2],c=t[n-1],f=this._regioncode(u,c);for(let d=0;d<n;d+=2)if(r=u,i=c,u=t[d],c=t[d+1],a=f,f=this._regioncode(u,c),0===a&&0===f)o=s,s=0,l?l.push(u,c):l=[u,c];else{let t,n,d,h,p;if(0===a){if(null===(t=this._clipSegment(r,i,u,c,a,f)))continue;[n,d,h,p]=t}else{if(null===(t=this._clipSegment(u,c,r,i,f,a)))continue;[h,p,n,d]=t,o=s,s=this._edgecode(n,d),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(n,d):l=[n,d]}o=s,s=this._edgecode(h,p),o&&s&&this._edge(e,o,s,l,l.length),l?l.push(h,p):l=[h,p]}if(l)o=s,s=this._edgecode(l[0],l[1]),o&&s&&this._edge(e,o,s,l,l.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return l}_clipSegment(e,t,n,r,i,a){for(;;){if(0===i&&0===a)return[e,t,n,r];if(i&a)return null;let o,s,l=i||a;8&l?(o=e+(n-e)*(this.ymax-t)/(r-t),s=this.ymax):4&l?(o=e+(n-e)*(this.ymin-t)/(r-t),s=this.ymin):2&l?(s=t+(r-t)*(this.xmax-e)/(n-e),o=this.xmax):(s=t+(r-t)*(this.xmin-e)/(n-e),o=this.xmin),i?(e=o,t=s,i=this._regioncode(e,t)):(n=o,r=s,a=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,a){let o,s=Array.from(t);if((o=this._project(s[0],s[1],n,r))&&s.unshift(o[0],o[1]),(o=this._project(s[s.length-2],s[s.length-1],i,a))&&s.push(o[0],o[1]),s=this._clipFinite(e,s))for(let t,n=0,r=s.length,i=this._edgecode(s[r-2],s[r-1]);n<r;n+=2)t=i,i=this._edgecode(s[n],s[n+1]),t&&i&&(n=this._edge(e,t,i,s,n),r=s.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(s=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return s}_edge(e,t,n,r,i){for(;t!==n;){let n,a;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,a=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,a=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,a=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,a=this.ymin}r[i]===n&&r[i+1]===a||!this.contains(e,n,a)||(r.splice(i,0,n,a),i+=2)}if(r.length>4)for(let e=0;e<r.length;e+=2){const t=(e+2)%r.length,n=(e+4)%r.length;(r[e]===r[t]&&r[t]===r[n]||r[e+1]===r[t+1]&&r[t+1]===r[n+1])&&(r.splice(t,2),e-=2)}return i}_project(e,t,n,r){let i,a,o,s=1/0;if(r<0){if(t<=this.ymin)return null;(i=(this.ymin-t)/r)<s&&(o=this.ymin,a=e+(s=i)*n)}else if(r>0){if(t>=this.ymax)return null;(i=(this.ymax-t)/r)<s&&(o=this.ymax,a=e+(s=i)*n)}if(n>0){if(e>=this.xmax)return null;(i=(this.xmax-e)/n)<s&&(a=this.xmax,o=t+(s=i)*r)}else if(n<0){if(e<=this.xmin)return null;(i=(this.xmin-e)/n)<s&&(a=this.xmin,o=t+(s=i)*r)}return[a,o]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}const _z=2*Math.PI,kz=Math.pow;function Oz(e){return e[0]}function Sz(e){return e[1]}function $z(e,t,n){return[e+Math.sin(e+t)*n,t+Math.cos(e-t)*n]}class Ez{static from(e,t=Oz,n=Sz,r){return new Ez("length"in e?function(e,t,n,r){const i=e.length,a=new Float64Array(2*i);for(let o=0;o<i;++o){const i=e[o];a[2*o]=t.call(r,i,o,e),a[2*o+1]=n.call(r,i,o,e)}return a}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(const a of e)yield t.call(r,a,i,e),yield n.call(r,a,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new lz(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){const{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){const r=2*t[e],i=2*t[e+1],a=2*t[e+2];if((n[a]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[a+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},((e,t)=>t)).sort(((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]));const e=this.collinear[0],n=this.collinear[this.collinear.length-1],r=[t[2*e],t[2*e+1],t[2*n],t[2*n+1]],i=1e-8*Math.hypot(r[3]-r[1],r[2]-r[0]);for(let e=0,n=t.length/2;e<n;++e){const n=$z(t[2*e],t[2*e+1],i);t[2*e]=n[0],t[2*e+1]=n[1]}this._delaunator=new lz(t)}else delete this.collinear;const n=this.halfedges=this._delaunator.halfedges,r=this.hull=this._delaunator.hull,i=this.triangles=this._delaunator.triangles,a=this.inedges.fill(-1),o=this._hullIndex.fill(-1);for(let e=0,t=n.length;e<t;++e){const t=i[e%3==2?e-2:e+1];-1!==n[e]&&-1!==a[t]||(a[t]=e)}for(let e=0,t=r.length;e<t;++e)o[r[e]]=e;r.length<=2&&r.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=r[0],this.triangles[1]=r[1],this.triangles[2]=r[1],a[r[0]]=1,2===r.length&&(a[r[1]]=0))}voronoi(e){return new wz(this,e)}*neighbors(e){const{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:a,collinear:o}=this;if(o){const t=o.indexOf(e);return t>0&&(yield o[t-1]),void(t<o.length-1&&(yield o[t+1]))}const s=t[e];if(-1===s)return;let l=s,u=-1;do{if(yield u=a[l],l=l%3==2?l-2:l+1,a[l]!==e)return;if(l=i[l],-1===l){const t=n[(r[e]+1)%n.length];return void(t!==u&&(yield t))}}while(l!==s)}find(e,t,n=0){if((e=+e)!=e||(t=+t)!=t)return-1;const r=n;let i;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){const{inedges:r,hull:i,_hullIndex:a,halfedges:o,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let u=e,c=kz(t-l[2*e],2)+kz(n-l[2*e+1],2);const f=r[e];let d=f;do{let r=s[d];const f=kz(t-l[2*r],2)+kz(n-l[2*r+1],2);if(f<c&&(c=f,u=r),d=d%3==2?d-2:d+1,s[d]!==e)break;if(d=o[d],-1===d){if(d=i[(a[e]+1)%i.length],d!==r&&kz(t-l[2*d],2)+kz(n-l[2*d+1],2)<c)return d;break}}while(d!==f);return u}render(e){const t=null==e?e=new bz:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(a<t)continue;const o=2*i[t],s=2*i[a];e.moveTo(n[o],n[o+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t=2){const n=null==e?e=new bz:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){const i=r[n],a=r[n+1];e.moveTo(i+t,a),e.arc(i,a,t,0,_z)}return n&&n.value()}renderHull(e){const t=null==e?e=new bz:void 0,{hull:n,points:r}=this,i=2*n[0],a=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<a;++t){const i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){const e=new xz;return this.renderHull(e),e.value()}renderTriangle(e,t){const n=null==t?t=new bz:void 0,{points:r,triangles:i}=this,a=2*i[e*=3],o=2*i[e+1],s=2*i[e+2];return t.moveTo(r[a],r[a+1]),t.lineTo(r[o],r[o+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){const{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){const t=new xz;return this.renderTriangle(e,t),t.value()}}function Az(e){Cg.call(this,null,e)}Az.Definition={type:"Voronoi",metadata:{modifies:!0},params:[{name:"x",type:"field",required:!0},{name:"y",type:"field",required:!0},{name:"size",type:"number",array:!0,length:2},{name:"extent",type:"array",array:!0,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:!0,length:2}},{name:"as",type:"string",default:"path"}]};const Dz=[-1e5,-1e5,1e5,1e5];function Cz(e){const t=e[0][0],n=e[0][1];let r=e.length-1;for(;e[r][0]===t&&e[r][1]===n;--r);return"M"+e.slice(0,r+1).join("L")+"Z"}kc(Az,Cg,{transform(e,t){const n=e.as||"path",r=t.source;if(!r||!r.length)return t;let i=e.size;i=i?[0,0,i[0],i[1]]:(i=e.extent)?[i[0][0],i[0][1],i[1][0],i[1][1]]:Dz;const a=this.value=Ez.from(r,e.x,e.y).voronoi(i);for(let e=0,t=r.length;e<t;++e){const t=a.cellPolygon(e);r[e][n]=t?Cz(t):null}return t.reflow(e.modified()).modifies(n)}});var Mz=Object.freeze({__proto__:null,voronoi:Az}),jz=Math.PI/180,Fz=2048;function Tz(){var e,t,n,r,i,a,o,s=[256,256],l=Bz,u=[],c=Math.random,f={};function d(e,t,n){for(var r,i,a,o=t.x,u=t.y,f=Math.sqrt(s[0]*s[0]+s[1]*s[1]),d=l(s),h=c()<.5?1:-1,p=-h;(r=d(p+=h))&&(i=~~r[0],a=~~r[1],!(Math.min(Math.abs(i),Math.abs(a))>=f));)if(t.x=o+i,t.y=u+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>s[0]||t.y+t.y1>s[1])&&(!n||!Rz(t,e,s[0]))&&(!n||zz(t,n))){for(var m,g=t.sprite,y=t.width>>5,v=s[0]>>5,b=t.x-(y<<4),x=127&b,w=32-x,_=t.y1-t.y0,k=(t.y+t.y0)*v+(b>>5),O=0;O<_;O++){m=0;for(var S=0;S<=y;S++)e[k+S]|=m<<w|(S<y?(m=g[O*y+S])>>>x:0);k+=v}return t.sprite=null,!0}return!1}return f.layout=function(){for(var l=function(e){e.width=e.height=1;var t=Math.sqrt(e.getContext("2d").getImageData(0,0,1,1).data.length>>2);e.width=2048/t,e.height=Fz/t;var n=e.getContext("2d");return n.fillStyle=n.strokeStyle="red",n.textAlign="center",{context:n,ratio:t}}(fx()),f=function(e){var t=[],n=-1;for(;++n<e;)t[n]=0;return t}((s[0]>>5)*s[1]),h=null,p=u.length,m=-1,g=[],y=u.map((s=>({text:e(s),font:t(s),style:r(s),weight:i(s),rotate:a(s),size:~~(n(s)+1e-14),padding:o(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s}))).sort(((e,t)=>t.size-e.size));++m<p;){var v=y[m];v.x=s[0]*(c()+.5)>>1,v.y=s[1]*(c()+.5)>>1,Nz(l,v,y,m),v.hasText&&d(f,v,h)&&(g.push(v),h?Pz(h,v):h=[{x:v.x+v.x0,y:v.y+v.y0},{x:v.x+v.x1,y:v.y+v.y1}],v.x-=s[0]>>1,v.y-=s[1]>>1)}return g},f.words=function(e){return arguments.length?(u=e,f):u},f.size=function(e){return arguments.length?(s=[+e[0],+e[1]],f):s},f.font=function(e){return arguments.length?(t=Lz(e),f):t},f.fontStyle=function(e){return arguments.length?(r=Lz(e),f):r},f.fontWeight=function(e){return arguments.length?(i=Lz(e),f):i},f.rotate=function(e){return arguments.length?(a=Lz(e),f):a},f.text=function(t){return arguments.length?(e=Lz(t),f):e},f.spiral=function(e){return arguments.length?(l=Iz[e]||e,f):l},f.fontSize=function(e){return arguments.length?(n=Lz(e),f):n},f.padding=function(e){return arguments.length?(o=Lz(e),f):o},f.random=function(e){return arguments.length?(c=e,f):c},f}function Nz(e,t,n,r){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,2048/a,Fz/a);var o,s,l,u,c,f=0,d=0,h=0,p=n.length;for(--r;++r<p;){if(t=n[r],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font,o=i.measureText(t.text+"m").width*a,l=t.size<<1,t.rotate){var m=Math.sin(t.rotate*jz),g=Math.cos(t.rotate*jz),y=o*g,v=o*m,b=l*g,x=l*m;o=Math.max(Math.abs(y+x),Math.abs(y-x))+31>>5<<5,l=~~Math.max(Math.abs(v+b),Math.abs(v-b))}else o=o+31>>5<<5;if(l>h&&(h=l),f+o>=2048&&(f=0,d+=h,h=0),d+l>=Fz)break;i.translate((f+(o>>1))/a,(d+(l>>1))/a),t.rotate&&i.rotate(t.rotate*jz),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=o,t.height=l,t.xoff=f,t.yoff=d,t.x1=o>>1,t.y1=l>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,f+=o}for(var w=i.getImageData(0,0,2048/a,Fz/a).data,_=[];--r>=0;)if((t=n[r]).hasText){for(s=(o=t.width)>>5,l=t.y1-t.y0,u=0;u<l*s;u++)_[u]=0;if(null==(f=t.xoff))return;d=t.yoff;var k=0,O=-1;for(c=0;c<l;c++){for(u=0;u<o;u++){var S=s*c+(u>>5),$=w[2048*(d+c)+(f+u)<<2]?1<<31-u%32:0;_[S]|=$,k|=$}k?O=c:(t.y0++,l--,c--,d++)}t.y1=t.y0+O,t.sprite=_.slice(0,(t.y1-t.y0)*s)}}}function Rz(e,t,n){n>>=5;for(var r,i=e.sprite,a=e.width>>5,o=e.x-(a<<4),s=127&o,l=32-s,u=e.y1-e.y0,c=(e.y+e.y0)*n+(o>>5),f=0;f<u;f++){r=0;for(var d=0;d<=a;d++)if((r<<l|(d<a?(r=i[f*a+d])>>>s:0))&t[c+d])return!0;c+=n}return!1}function Pz(e,t){var n=e[0],r=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>r.x&&(r.x=t.x+t.x1),t.y+t.y1>r.y&&(r.y=t.y+t.y1)}function zz(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function Bz(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function Lz(e){return"function"==typeof e?e:function(){return e}}var Iz={archimedean:Bz,rectangular:function(e){var t=4*e[0]/e[1],n=0,r=0;return function(e){var i=e<0?-1:1;switch(Math.sqrt(1+4*i*e)-i&3){case 0:n+=t;break;case 1:r+=4;break;case 2:n-=t;break;default:r-=4}return[n,r]}}};const qz=["x","y","font","fontSize","fontStyle","fontWeight","angle"],Uz=["text","font","rotate","fontSize","fontStyle","fontWeight"];function Vz(e){Cg.call(this,Tz(),e)}Vz.Definition={type:"Wordcloud",metadata:{modifies:!0},params:[{name:"size",type:"number",array:!0,length:2},{name:"font",type:"string",expr:!0,default:"sans-serif"},{name:"fontStyle",type:"string",expr:!0,default:"normal"},{name:"fontWeight",type:"string",expr:!0,default:"normal"},{name:"fontSize",type:"number",expr:!0,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:!0,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:!0},{name:"as",type:"string",array:!0,length:7,default:qz}]},kc(Vz,Cg,{transform(e,t){!e.size||e.size[0]&&e.size[1]||ku("Wordcloud size dimensions must be non-zero.");const n=e.modified();if(!(n||t.changed(t.ADD_REM)||Uz.some((function(n){const r=e[n];return sc(r)&&t.modified(r.fields)}))))return;const r=t.materialize(t.SOURCE).source,i=this.value,a=e.as||qz;let o,s=e.fontSize||14;if(sc(s)?o=e.fontSizeRange:s=hc(s),o){const e=s,t=Ck("sqrt")().domain(gc(r,e)).range(o);s=n=>t(e(n))}r.forEach((e=>{e[a[0]]=NaN,e[a[1]]=NaN,e[a[3]]=0}));const l=i.words(r).text(e.text).size(e.size||[500,500]).padding(e.padding||1).spiral(e.spiral||"archimedean").rotate(e.rotate||0).font(e.font||"sans-serif").fontStyle(e.fontStyle||"normal").fontWeight(e.fontWeight||"normal").fontSize(s).random(Bg).layout(),u=i.size(),c=u[0]>>1,f=u[1]>>1,d=l.length;for(let e,t,n=0;n<d;++n)e=l[n],t=e.datum,t[a[0]]=e.x+c,t[a[1]]=e.y+f,t[a[2]]=e.font,t[a[3]]=e.size,t[a[4]]=e.style,t[a[5]]=e.weight,t[a[6]]=e.rotate;return t.reflow(n).modifies(a)}});var Wz=Object.freeze({__proto__:null,wordcloud:Vz});const Hz=e=>new Uint8Array(e),Gz=e=>new Uint16Array(e),Xz=e=>new Uint32Array(e);function Yz(e,t,n){const r=(t<257?Hz:t<65537?Gz:Xz)(e);return n&&r.set(n),r}function Jz(e,t,n){const r=1<<t;return{one:r,zero:~r,range:n.slice(),bisect:e.bisect,index:e.index,size:e.size,onAdd(e,t){const n=this,i=n.bisect(n.range,e.value),a=e.index,o=i[0],s=i[1],l=a.length;let u;for(u=0;u<o;++u)t[a[u]]|=r;for(u=s;u<l;++u)t[a[u]]|=r;return n}}}function Kz(){let e=Xz(0),t=[],n=0;return{insert:function(r,i,a){if(!i.length)return[];const o=n,s=i.length,l=Xz(s);let u,c,f,d=Array(s);for(f=0;f<s;++f)d[f]=r(i[f]),l[f]=f;if(d=function(e,t){return e.sort.call(t,((t,n)=>{const r=e[t],i=e[n];return r<i?-1:r>i?1:0})),function(e,t){return Array.from(t,(t=>e[t]))}(e,t)}(d,l),o)u=t,c=e,t=Array(o+s),e=Xz(o+s),function(e,t,n,r,i,a,o,s,l){let u,c=0,f=0;for(u=0;c<r&&f<o;++u)t[c]<i[f]?(s[u]=t[c],l[u]=n[c++]):(s[u]=i[f],l[u]=a[f++]+e);for(;c<r;++c,++u)s[u]=t[c],l[u]=n[c];for(;f<o;++f,++u)s[u]=i[f],l[u]=a[f]+e}(a,u,c,o,d,l,s,t,e);else{if(a>0)for(f=0;f<s;++f)l[f]+=a;t=d,e=l}return n=o+s,{index:l,value:d}},remove:function(r,i){const a=n;let o,s,l;for(s=0;!i[e[s]]&&s<a;++s);for(l=s;s<a;++s)i[o=e[s]]||(e[l]=o,t[l]=t[s],++l);n=a-r},bisect:function(e,r){let i;return r?i=r.length:(r=t,i=n),[zf(r,e[0],0,i),Pf(r,e[1],0,i)]},reindex:function(t){for(let r=0,i=n;r<i;++r)e[r]=t[e[r]]},index:()=>e,size:()=>n}}function Qz(e){Cg.call(this,function(){let e=8,t=[],n=Xz(0),r=Yz(0,e),i=Yz(0,e);return{data:()=>t,seen:()=>n=function(e,t,n){return e.length>=t?e:((n=n||new e.constructor(t)).set(e),n)}(n,t.length),add(e){for(let n,r=0,i=t.length,a=e.length;r<a;++r)n=e[r],n._index=i++,t.push(n)},remove(e,n){const a=t.length,o=Array(a-e),s=t;let l,u,c;for(u=0;!n[u]&&u<a;++u)o[u]=t[u],s[u]=u;for(c=u;u<a;++u)l=t[u],n[u]?s[u]=-1:(s[u]=c,r[c]=r[u],i[c]=i[u],o[c]=l,l._index=c++),r[u]=0;return t=o,s},size:()=>t.length,curr:()=>r,prev:()=>i,reset:e=>i[e]=r[e],all:()=>e<257?255:e<65537?65535:4294967295,set(e,t){r[e]|=t},clear(e,t){r[e]&=~t},resize(t,n){(t>r.length||n>e)&&(e=Math.max(n,e),r=Yz(t,e,r),i=Yz(t,e))}}}(),e),this._indices=null,this._dims=null}function Zz(e){Cg.call(this,null,e)}Qz.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:!0,required:!0},{name:"query",type:"array",array:!0,required:!0,content:{type:"number",array:!0,length:2}}]},kc(Qz,Cg,{transform(e,t){return this._dims?e.modified("fields")||e.fields.some((e=>t.modified(e.fields)))?this.reinit(e,t):this.eval(e,t):this.init(e,t)},init(e,t){const n=e.fields,r=e.query,i=this._indices={},a=this._dims=[],o=r.length;let s,l,u=0;for(;u<o;++u)s=n[u].fname,l=i[s]||(i[s]=Kz()),a.push(Jz(l,u,r[u]));return this.eval(e,t)},reinit(e,t){const n=t.materialize().fork(),r=e.fields,i=e.query,a=this._indices,o=this._dims,s=this.value,l=s.curr(),u=s.prev(),c=s.all(),f=n.rem=n.add,d=n.mod,h=i.length,p={};let m,g,y,v,b,x,w,_,k;if(u.set(l),t.rem.length&&(b=this.remove(e,t,n)),t.add.length&&s.add(t.add),t.mod.length)for(x={},v=t.mod,w=0,_=v.length;w<_;++w)x[v[w]._index]=1;for(w=0;w<h;++w)k=r[w],(!o[w]||e.modified("fields",w)||t.modified(k.fields))&&(y=k.fname,(m=p[y])||(a[y]=g=Kz(),p[y]=m=g.insert(k,t.source,0)),o[w]=Jz(g,w,i[w]).onAdd(m,l));for(w=0,_=s.data().length;w<_;++w)b[w]||(u[w]!==l[w]?f.push(w):x[w]&&l[w]!==c&&d.push(w));return s.mask=(1<<h)-1,n},eval(e,t){const n=t.materialize().fork(),r=this._dims.length;let i=0;return t.rem.length&&(this.remove(e,t,n),i|=(1<<r)-1),e.modified("query")&&!e.modified("fields")&&(i|=this.update(e,t,n)),t.add.length&&(this.insert(e,t,n),i|=(1<<r)-1),t.mod.length&&(this.modify(t,n),i|=(1<<r)-1),this.value.mask=i,n},insert(e,t,n){const r=t.add,i=this.value,a=this._dims,o=this._indices,s=e.fields,l={},u=n.add,c=i.size()+r.length,f=a.length;let d,h,p,m=i.size();i.resize(c,f),i.add(r);const g=i.curr(),y=i.prev(),v=i.all();for(d=0;d<f;++d)h=s[d].fname,p=l[h]||(l[h]=o[h].insert(s[d],r,m)),a[d].onAdd(p,g);for(;m<c;++m)y[m]=v,g[m]!==v&&u.push(m)},modify(e,t){const n=t.mod,r=this.value,i=r.curr(),a=r.all(),o=e.mod;let s,l,u;for(s=0,l=o.length;s<l;++s)u=o[s]._index,i[u]!==a&&n.push(u)},remove(e,t,n){const r=this._indices,i=this.value,a=i.curr(),o=i.prev(),s=i.all(),l={},u=n.rem,c=t.rem;let f,d,h,p;for(f=0,d=c.length;f<d;++f)h=c[f]._index,l[h]=1,o[h]=p=a[h],a[h]=s,p!==s&&u.push(h);for(h in r)r[h].remove(d,l);return this.reindex(t,d,l),l},reindex(e,t,n){const r=this._indices,i=this.value;e.runAfter((()=>{const e=i.remove(t,n);for(const t in r)r[t].reindex(e)}))},update(e,t,n){const r=this._dims,i=e.query,a=t.stamp,o=r.length;let s,l,u=0;for(n.filters=0,l=0;l<o;++l)e.modified("query",l)&&(s=l,++u);if(1===u)u=r[s].one,this.incrementOne(r[s],i[s],n.add,n.rem);else for(l=0,u=0;l<o;++l)e.modified("query",l)&&(u|=r[l].one,this.incrementAll(r[l],i[l],a,n.add),n.rem=n.add);return u},incrementAll(e,t,n,r){const i=this.value,a=i.seen(),o=i.curr(),s=i.prev(),l=e.index(),u=e.bisect(e.range),c=e.bisect(t),f=c[0],d=c[1],h=u[0],p=u[1],m=e.one;let g,y,v;if(f<h)for(g=f,y=Math.min(h,d);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(f>h)for(g=h,y=Math.min(f,p);g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;if(d>p)for(g=Math.max(f,p),y=d;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;else if(d<p)for(g=Math.max(h,d),y=p;g<y;++g)v=l[g],a[v]!==n&&(s[v]=o[v],a[v]=n,r.push(v)),o[v]^=m;e.range=t.slice()},incrementOne(e,t,n,r){const i=this.value.curr(),a=e.index(),o=e.bisect(e.range),s=e.bisect(t),l=s[0],u=s[1],c=o[0],f=o[1],d=e.one;let h,p,m;if(l<c)for(h=l,p=Math.min(c,u);h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(l>c)for(h=c,p=Math.min(l,f);h<p;++h)m=a[h],i[m]^=d,r.push(m);if(u>f)for(h=Math.max(l,f),p=u;h<p;++h)m=a[h],i[m]^=d,n.push(m);else if(u<f)for(h=Math.max(c,u),p=f;h<p;++h)m=a[h],i[m]^=d,r.push(m);e.range=t.slice()}}),Zz.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:!0,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:!0,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]},kc(Zz,Cg,{transform(e,t){const n=~(e.ignore||0),r=e.filter,i=r.mask;if(0==(i&n))return t.StopPropagation;const a=t.fork(t.ALL),o=r.data(),s=r.curr(),l=r.prev(),u=e=>s[e]&n?null:o[e];return a.filter(a.MOD,u),i&i-1?(a.filter(a.ADD,(e=>{const t=s[e]&n;return!t&&t^l[e]&n?o[e]:null})),a.filter(a.REM,(e=>{const t=s[e]&n;return t&&!(t^t^l[e]&n)?o[e]:null}))):(a.filter(a.ADD,u),a.filter(a.REM,(e=>(s[e]&n)===i?o[e]:null))),a.filter(a.SOURCE,(e=>u(e._index)))}});var eB=Object.freeze({__proto__:null,crossfilter:Qz,resolvefilter:Zz});const tB="RawCode",nB="Literal",rB="Property",iB="Identifier",aB="ArrayExpression",oB="BinaryExpression",sB="CallExpression",lB="ConditionalExpression",uB="LogicalExpression",cB="MemberExpression",fB="ObjectExpression",dB="UnaryExpression";function hB(e){this.type=e}var pB,mB,gB,yB,vB;hB.prototype.visit=function(e){let t,n,r;if(e(this))return 1;for(t=function(e){switch(e.type){case aB:return e.elements;case oB:case uB:return[e.left,e.right];case sB:return[e.callee].concat(e.arguments);case lB:return[e.test,e.consequent,e.alternate];case cB:return[e.object,e.property];case fB:return e.properties;case rB:return[e.key,e.value];case dB:return[e.argument];case iB:case nB:case tB:default:return[]}}(this),n=0,r=t.length;n<r;++n)if(t[n].visit(e))return 1};(pB={})[1]="Boolean",pB[2]="<end>",pB[3]="Identifier",pB[4]="Keyword",pB[5]="Null",pB[6]="Numeric",pB[7]="Punctuator",pB[8]="String",pB[9]="RegularExpression";var bB="Identifier",xB="Unexpected token %0",wB="Invalid regular expression",_B="Invalid regular expression: missing /",kB="Octal literals are not allowed in strict mode.",OB="ILLEGAL",SB="Disabled.",$B=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),EB=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function AB(e,t){if(!e)throw new Error("ASSERT: "+t)}function DB(e){return e>=48&&e<=57}function CB(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function MB(e){return"01234567".indexOf(e)>=0}function jB(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function FB(e){return 10===e||13===e||8232===e||8233===e}function TB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&$B.test(String.fromCharCode(e))}function NB(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&EB.test(String.fromCharCode(e))}const RB={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function PB(){for(;gB<yB;){const e=mB.charCodeAt(gB);if(!jB(e)&&!FB(e))break;++gB}}function zB(e){var t,n,r,i=0;for(n="u"===e?4:2,t=0;t<n;++t)gB<yB&&CB(mB[gB])?(r=mB[gB++],i=16*i+"0123456789abcdef".indexOf(r.toLowerCase())):eL({},xB,OB);return String.fromCharCode(i)}function BB(){var e,t,n,r;for(t=0,"}"===(e=mB[gB])&&eL({},xB,OB);gB<yB&&CB(e=mB[gB++]);)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&eL({},xB,OB),t<=65535?String.fromCharCode(t):(n=55296+(t-65536>>10),r=56320+(t-65536&1023),String.fromCharCode(n,r))}function LB(){var e,t;for(e=mB.charCodeAt(gB++),t=String.fromCharCode(e),92===e&&(117!==mB.charCodeAt(gB)&&eL({},xB,OB),++gB,(e=zB("u"))&&"\\"!==e&&TB(e.charCodeAt(0))||eL({},xB,OB),t=e);gB<yB&&NB(e=mB.charCodeAt(gB));)++gB,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==mB.charCodeAt(gB)&&eL({},xB,OB),++gB,(e=zB("u"))&&"\\"!==e&&NB(e.charCodeAt(0))||eL({},xB,OB),t+=e);return t}function IB(){var e,t;return e=gB,{type:1===(t=92===mB.charCodeAt(gB)?LB():function(){var e,t;for(e=gB++;gB<yB;){if(92===(t=mB.charCodeAt(gB)))return gB=e,LB();if(!NB(t))break;++gB}return mB.slice(e,gB)}()).length?3:RB.hasOwnProperty(t)?4:"null"===t?5:"true"===t||"false"===t?1:3,value:t,start:e,end:gB}}function qB(){var e,t,n,r,i=gB,a=mB.charCodeAt(gB),o=mB[gB];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++gB,{type:7,value:String.fromCharCode(a),start:i,end:gB};default:if(61===(e=mB.charCodeAt(gB+1)))switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return gB+=2,{type:7,value:String.fromCharCode(a)+String.fromCharCode(e),start:i,end:gB};case 33:case 61:return gB+=2,61===mB.charCodeAt(gB)&&++gB,{type:7,value:mB.slice(i,gB),start:i,end:gB}}}return">>>="===(r=mB.substr(gB,4))?{type:7,value:r,start:i,end:gB+=4}:">>>"===(n=r.substr(0,3))||"<<="===n||">>="===n?{type:7,value:n,start:i,end:gB+=3}:o===(t=n.substr(0,2))[1]&&"+-<>&|".indexOf(o)>=0||"=>"===t?{type:7,value:t,start:i,end:gB+=2}:("//"===t&&eL({},xB,OB),"<>=!+-*%&|^/".indexOf(o)>=0?{type:7,value:o,start:i,end:++gB}:void eL({},xB,OB))}function UB(){var e,t,n;if(AB(DB((n=mB[gB]).charCodeAt(0))||"."===n,"Numeric literal must start with a decimal digit or a decimal point"),t=gB,e="","."!==n){if(e=mB[gB++],n=mB[gB],"0"===e){if("x"===n||"X"===n)return++gB,function(e){let t="";for(;gB<yB&&CB(mB[gB]);)t+=mB[gB++];return 0===t.length&&eL({},xB,OB),TB(mB.charCodeAt(gB))&&eL({},xB,OB),{type:6,value:parseInt("0x"+t,16),start:e,end:gB}}(t);if(MB(n))return function(e){let t="0"+mB[gB++];for(;gB<yB&&MB(mB[gB]);)t+=mB[gB++];return(TB(mB.charCodeAt(gB))||DB(mB.charCodeAt(gB)))&&eL({},xB,OB),{type:6,value:parseInt(t,8),octal:!0,start:e,end:gB}}(t);n&&DB(n.charCodeAt(0))&&eL({},xB,OB)}for(;DB(mB.charCodeAt(gB));)e+=mB[gB++];n=mB[gB]}if("."===n){for(e+=mB[gB++];DB(mB.charCodeAt(gB));)e+=mB[gB++];n=mB[gB]}if("e"===n||"E"===n)if(e+=mB[gB++],"+"!==(n=mB[gB])&&"-"!==n||(e+=mB[gB++]),DB(mB.charCodeAt(gB)))for(;DB(mB.charCodeAt(gB));)e+=mB[gB++];else eL({},xB,OB);return TB(mB.charCodeAt(gB))&&eL({},xB,OB),{type:6,value:parseFloat(e),start:t,end:gB}}function VB(){var e,t,n,r;return vB=null,PB(),e=gB,t=function(){var e,t,n,r;for(AB("/"===(e=mB[gB]),"Regular expression literal must start with a slash"),t=mB[gB++],n=!1,r=!1;gB<yB;)if(t+=e=mB[gB++],"\\"===e)FB((e=mB[gB++]).charCodeAt(0))&&eL({},_B),t+=e;else if(FB(e.charCodeAt(0)))eL({},_B);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||eL({},_B),{value:t.substr(1,t.length-2),literal:t}}(),n=function(){var e,t,n;for(t="",n="";gB<yB&&NB((e=mB[gB]).charCodeAt(0));)++gB,"\\"===e&&gB<yB?eL({},xB,OB):(n+=e,t+=e);return n.search(/[^gimuy]/g)>=0&&eL({},wB,n),{value:n,literal:t}}(),r=function(e,t){let n=e;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((e,t)=>{if(parseInt(t,16)<=1114111)return"x";eL({},wB)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{new RegExp(n)}catch(e){eL({},wB)}try{return new RegExp(e,t)}catch(e){return null}}(t.value,n.value),{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:gB}}function WB(){if(PB(),gB>=yB)return{type:2,start:gB,end:gB};const e=mB.charCodeAt(gB);return TB(e)?IB():40===e||41===e||59===e?qB():39===e||34===e?function(){var e,t,n,r,i="",a=!1;for(AB("'"===(e=mB[gB])||'"'===e,"String literal must starts with a quote"),t=gB,++gB;gB<yB;){if((n=mB[gB++])===e){e="";break}if("\\"===n)if((n=mB[gB++])&&FB(n.charCodeAt(0)))"\r"===n&&"\n"===mB[gB]&&++gB;else switch(n){case"u":case"x":"{"===mB[gB]?(++gB,i+=BB()):i+=zB(n);break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;default:MB(n)?(0!==(r="01234567".indexOf(n))&&(a=!0),gB<yB&&MB(mB[gB])&&(a=!0,r=8*r+"01234567".indexOf(mB[gB++]),"0123".indexOf(n)>=0&&gB<yB&&MB(mB[gB])&&(r=8*r+"01234567".indexOf(mB[gB++]))),i+=String.fromCharCode(r)):i+=n}else{if(FB(n.charCodeAt(0)))break;i+=n}}return""!==e&&eL({},xB,OB),{type:8,value:i,octal:a,start:t,end:gB}}():46===e?DB(mB.charCodeAt(gB+1))?UB():qB():DB(e)?UB():qB()}function HB(){const e=vB;return gB=e.end,vB=WB(),gB=e.end,e}function GB(){const e=gB;vB=WB(),gB=e}function XB(e,t,n){const r=new hB("||"===e||"&&"===e?"LogicalExpression":"BinaryExpression");return r.operator=e,r.left=t,r.right=n,r}function YB(e,t){const n=new hB("CallExpression");return n.callee=e,n.arguments=t,n}function JB(e){const t=new hB(bB);return t.name=e,t}function KB(e){const t=new hB("Literal");return t.value=e.value,t.raw=mB.slice(e.start,e.end),e.regex&&("//"===t.raw&&(t.raw="/(?:)/"),t.regex=e.regex),t}function QB(e,t,n){const r=new hB("MemberExpression");return r.computed="["===e,r.object=t,r.property=n,r.computed||(n.member=!0),r}function ZB(e,t,n){const r=new hB("Property");return r.key=t,r.value=n,r.kind=e,r}function eL(e,t){var n,r=Array.prototype.slice.call(arguments,2),i=t.replace(/%(\d)/g,((e,t)=>(AB(t<r.length,"Message reference must be in range"),r[t])));throw(n=new Error(i)).index=gB,n.description=i,n}function tL(e){2===e.type&&eL(e,"Unexpected end of input"),6===e.type&&eL(e,"Unexpected number"),8===e.type&&eL(e,"Unexpected string"),3===e.type&&eL(e,"Unexpected identifier"),4===e.type&&eL(e,"Unexpected reserved word"),eL(e,xB,e.value)}function nL(e){const t=HB();7===t.type&&t.value===e||tL(t)}function rL(e){return 7===vB.type&&vB.value===e}function iL(e){return 4===vB.type&&vB.value===e}function aL(){const e=[];for(gB=vB.start,nL("[");!rL("]");)rL(",")?(HB(),e.push(null)):(e.push(yL()),rL("]")||nL(","));return HB(),function(e){const t=new hB("ArrayExpression");return t.elements=e,t}(e)}function oL(){gB=vB.start;const e=HB();return 8===e.type||6===e.type?(e.octal&&eL(e,kB),KB(e)):JB(e.value)}function sL(){var e,t,n;return gB=vB.start,3===(e=vB).type?(n=oL(),nL(":"),ZB("init",n,yL())):2!==e.type&&7!==e.type?(t=oL(),nL(":"),ZB("init",t,yL())):void tL(e)}function lL(){var e,t,n=[],r={},i=String;for(gB=vB.start,nL("{");!rL("}");)t="$"+((e=sL()).key.type===bB?e.key.name:i(e.key.value)),Object.prototype.hasOwnProperty.call(r,t)?eL({},"Duplicate data property in object literal not allowed in strict mode"):r[t]=!0,n.push(e),rL("}")||nL(",");return nL("}"),function(e){const t=new hB("ObjectExpression");return t.properties=e,t}(n)}const uL={if:1};function cL(){var e,t,n;if(rL("("))return function(){nL("(");const e=vL();return nL(")"),e}();if(rL("["))return aL();if(rL("{"))return lL();if(e=vB.type,gB=vB.start,3===e||uL[vB.value])n=JB(HB().value);else if(8===e||6===e)vB.octal&&eL(vB,kB),n=KB(HB());else{if(4===e)throw new Error(SB);1===e?((t=HB()).value="true"===t.value,n=KB(t)):5===e?((t=HB()).value=null,n=KB(t)):rL("/")||rL("/=")?(n=KB(VB()),GB()):tL(HB())}return n}function fL(){const e=[];if(nL("("),!rL(")"))for(;gB<yB&&(e.push(yL()),!rL(")"));)nL(",");return nL(")"),e}function dL(){return nL("."),function(){gB=vB.start;const e=HB();return function(e){return 3===e.type||4===e.type||1===e.type||5===e.type}(e)||tL(e),JB(e.value)}()}function hL(){nL("[");const e=vL();return nL("]"),e}function pL(){const e=function(){var e;for(e=cL();;)if(rL("."))e=QB(".",e,dL());else if(rL("("))e=YB(e,fL());else{if(!rL("["))break;e=QB("[",e,hL())}return e}();if(7===vB.type&&(rL("++")||rL("--")))throw new Error(SB);return e}function mL(){var e,t;if(7!==vB.type&&4!==vB.type)t=pL();else{if(rL("++")||rL("--"))throw new Error(SB);if(rL("+")||rL("-")||rL("~")||rL("!"))e=HB(),t=mL(),t=function(e,t){const n=new hB("UnaryExpression");return n.operator=e,n.argument=t,n.prefix=!0,n}(e.value,t);else{if(iL("delete")||iL("void")||iL("typeof"))throw new Error(SB);t=pL()}}return t}function gL(e){let t=0;if(7!==e.type&&4!==e.type)return 0;switch(e.value){case"||":t=1;break;case"&&":t=2;break;case"|":t=3;break;case"^":t=4;break;case"&":t=5;break;case"==":case"!=":case"===":case"!==":t=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":t=7;break;case"<<":case">>":case">>>":t=8;break;case"+":case"-":t=9;break;case"*":case"/":case"%":t=11}return t}function yL(){var e,t;return e=function(){var e,t,n,r,i,a,o,s,l,u;if(e=vB,l=mL(),0===(i=gL(r=vB)))return l;for(r.prec=i,HB(),t=[e,vB],a=[l,r,o=mL()];(i=gL(vB))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)o=a.pop(),s=a.pop().value,l=a.pop(),t.pop(),n=XB(s,l,o),a.push(n);(r=HB()).prec=i,a.push(r),t.push(vB),n=mL(),a.push(n)}for(n=a[u=a.length-1],t.pop();u>1;)t.pop(),n=XB(a[u-1].value,a[u-2],n),u-=2;return n}(),rL("?")&&(HB(),t=yL(),nL(":"),e=function(e,t,n){const r=new hB("ConditionalExpression");return r.test=e,r.consequent=t,r.alternate=n,r}(e,t,yL())),e}function vL(){const e=yL();if(rL(","))throw new Error(SB);return e}function bL(e){gB=0,yB=(mB=e).length,vB=null,GB();const t=vL();if(2!==vB.type)throw new Error("Unexpect token after expression.");return t}var xL={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function wL(e){function t(t,n,r){return i=>function(t,n,r,i){let a=e(n[0]);return r&&(a=r+"("+a+")",0===r.lastIndexOf("new ",0)&&(a="("+a+")")),a+"."+t+(i<0?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}(t,i,n,r)}const n="new Date",r="String",i="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(t){t.length<3&&ku("Missing arguments to clamp function."),t.length>3&&ku("Too many arguments to clamp function.");const n=t.map(e);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:n,date:t("getDate",n,0),day:t("getDay",n,0),year:t("getFullYear",n,0),month:t("getMonth",n,0),hours:t("getHours",n,0),minutes:t("getMinutes",n,0),seconds:t("getSeconds",n,0),milliseconds:t("getMilliseconds",n,0),time:t("getTime",n,0),timezoneoffset:t("getTimezoneOffset",n,0),utcdate:t("getUTCDate",n,0),utcday:t("getUTCDay",n,0),utcyear:t("getUTCFullYear",n,0),utcmonth:t("getUTCMonth",n,0),utchours:t("getUTCHours",n,0),utcminutes:t("getUTCMinutes",n,0),utcseconds:t("getUTCSeconds",n,0),utcmilliseconds:t("getUTCMilliseconds",n,0),length:t("length",null,-1),join:t("join",null),indexof:t("indexOf",null),lastindexof:t("lastIndexOf",null),slice:t("slice",null),reverse:function(t){return"("+e(t[0])+").slice().reverse()"},parseFloat:"parseFloat",parseInt:"parseInt",upper:t("toUpperCase",r,0),lower:t("toLowerCase",r,0),substring:t("substring",r),split:t("split",r),replace:t("replace",r),trim:t("trim",r,0),regexp:i,test:t("test",i),if:function(t){t.length<3&&ku("Missing arguments to if function."),t.length>3&&ku("Too many arguments to if function.");const n=t.map(e);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}const _L="intersect",kL="union";var OL="index:unit";function SL(e,t){for(var n,r,i=t.fields,a=t.values,o=i.length,s=0;s<o;++s)if((r=i[s]).getter=Su.getter||Su(r.field),$c(n=r.getter(e))&&(n=Iu(n)),$c(a[s])&&(a[s]=Iu(a[s])),$c(a[s][0])&&(a[s]=a[s].map(Iu)),"E"===r.type){if(Tu(a[s])?a[s].indexOf(n)<0:n!==a[s])return!1}else if("R"===r.type){if(!Oc(n,a[s]))return!1}else if("R-RE"===r.type){if(!Oc(n,a[s],!0,!1))return!1}else if("R-E"===r.type){if(!Oc(n,a[s],!1,!1))return!1}else if("R-LE"===r.type&&!Oc(n,a[s],!1,!0))return!1;return!0}var $L={E_union:function(e,t){if(!e.length)return t;for(var n=0,r=t.length;n<r;++n)e.indexOf(t[n])<0&&e.push(t[n]);return e},E_intersect:function(e,t){return e.length?e.filter((e=>t.indexOf(e)>=0)):t},R_union:function(e,t){var n=Iu(t[0]),r=Iu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?(e[0]>n&&(e[0]=n),e[1]<r&&(e[1]=r),e):[n,r]},R_intersect:function(e,t){var n=Iu(t[0]),r=Iu(t[1]);return n>r&&(n=t[1],r=t[0]),e.length?r<e[0]||e[1]<n?[]:(e[0]<n&&(e[0]=n),e[1]>r&&(e[1]=r),e):[n,r]}};function EL(e,t,n,r){t[0].type!==nB&&ku("First argument to selection functions must be a string literal.");const i=t[0].value,a="unit",o="@unit",s=":"+i;(t.length>=2&&Lu(t).value)!==_L||bc(r,o)||(r["@unit"]=n.getData(i).indataRef(n,a)),bc(r,s)||(r[s]=n.getData(i).tuplesRef())}function AL(e){const t=this.context.data[e];return t?t.values.value:[]}const DL=e=>function(t,n){return this.context.dataflow.locale()[e](n)(t)},CL=DL("format"),ML=DL("timeFormat"),jL=DL("utcFormat"),FL=DL("timeParse"),TL=DL("utcParse"),NL=new Date(2e3,0,1);function RL(e,t,n){return Number.isInteger(e)&&Number.isInteger(t)?(NL.setYear(2e3),NL.setMonth(e),NL.setDate(t),ML.call(this,NL,n)):""}function PL(e,t,n,r){t[0].type!==nB&&ku("First argument to data functions must be a string literal.");const i=t[0].value,a=":"+i;if(!bc(a,r))try{r[a]=n.getData(i).tuplesRef()}catch(e){}}function zL(e,t,n,r){if(t[0].type===nB)BL(n,r,t[0].value);else for(e in n.scales)BL(n,r,e)}function BL(e,t,n){const r="%"+n;if(!bc(t,r))try{t[r]=e.scaleRef(n)}catch(e){}}function LL(e,t){let n;return sc(e)?e:Cc(e)?(n=t.scales[e])&&n.value:void 0}function IL(e,t,n){t.__bandwidth=e=>e&&e.bandwidth?e.bandwidth():0,n._bandwidth=zL,n._range=zL,n._scale=zL;const r=t=>"_["+(t.type===nB?zc("%"+t.value):zc("%")+"+"+e(t))+"]";return{_bandwidth:e=>"this.__bandwidth(".concat(r(e[0]),")"),_range:e=>"".concat(r(e[0]),".range()"),_scale:t=>"".concat(r(t[0]),"(").concat(e(t[1]),")")}}function qL(e,t){return function(n,r,i){if(n){const t=LL(n,(i||this).context);return t&&t.path[e](r)}return t(r)}}const UL=qL("area",(function(e){return EM=new Bf,uM(e,AM),2*EM})),VL=qL("bounds",(function(e){var t,n,r,i,a,o,s;if(vM=yM=-(mM=gM=1/0),OM=[],uM(e,nj),n=OM.length){for(OM.sort(fj),t=1,a=[r=OM[0]];t<n;++t)dj(r,(i=OM[t])[0])||dj(r,i[1])?(cj(r[0],i[1])>cj(r[0],r[1])&&(r[1]=i[1]),cj(i[0],r[1])>cj(r[0],r[1])&&(r[0]=i[0])):a.push(r=i);for(o=-1/0,t=0,r=a[n=a.length-1];t<=n;r=i,++t)i=a[t],(s=cj(r[1],i[0]))>o&&(o=s,mM=i[0],yM=r[1])}return OM=SM=null,mM===1/0||gM===1/0?[[NaN,NaN],[NaN,NaN]]:[[mM,gM],[yM,vM]]})),WL=qL("centroid",(function(e){LM=IM=qM=UM=VM=WM=HM=GM=0,XM=new Bf,YM=new Bf,JM=new Bf,uM(e,hj);var t=+XM,n=+YM,r=+JM,i=XC(t,n,r);return i<NC&&(t=WM,n=HM,r=GM,IM<TC&&(t=qM,n=UM,r=VM),(i=XC(t,n,r))<NC)?[NaN,NaN]:[VC(n,t)*LC,nM(r/i)*LC]}));function HL(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function GL(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}function XL(e){const t=Bx(e);return.2126*GL(t.r)+.7152*GL(t.g)+.0722*GL(t.b)}function YL(e,t){return e===t||e!=e&&t!=t||(Tu(e)?!(!Tu(t)||e.length!==t.length)&&function(e,t){for(let n=0,r=e.length;n<r;++n)if(!YL(e[n],t[n]))return!1;return!0}(e,t):!(!Nu(e)||!Nu(t))&&JL(e,t))}function JL(e,t){for(const n in e)if(!YL(e[n],t[n]))return!1;return!0}function KL(e){return t=>JL(e,t)}const QL=e=>e.data;function ZL(e,t){const n=AL.call(t,e);return n.root&&n.root.lookup||{}}const eI=()=>"undefined"!=typeof window&&window||null;const tI={random:()=>Bg(),cumulativeNormal:Gg,cumulativeLogNormal:Zg,cumulativeUniform:ay,densityNormal:Hg,densityLogNormal:Qg,densityUniform:iy,quantileNormal:Xg,quantileLogNormal:ey,quantileUniform:oy,sampleNormal:Wg,sampleLogNormal:Kg,sampleUniform:ry,isArray:Tu,isBoolean:Sc,isDate:$c,isDefined:e=>void 0!==e,isNumber:Ac,isObject:Nu,isRegExp:Dc,isString:Cc,isTuple:Jm,isValid:e=>null!=e&&e==e,toBoolean:Bc,toDate:Ic,toNumber:Iu,toString:qc,flush:_c,lerp:jc,merge:function(){const e=[].slice.call(arguments);return e.unshift({}),mc(...e)},pad:Rc,peek:Lu,span:Pc,inrange:Oc,truncate:Vc,rgb:Bx,lab:rw,hcl:cw,hsl:Hx,luminance:XL,contrast:function(e,t){const n=XL(e),r=XL(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)},sequence:ed,format:CL,utcFormat:jL,utcParse:TL,utcOffset:zh,utcSequence:Ih,timeFormat:ML,timeParse:FL,timeOffset:Ph,timeSequence:Lh,timeUnitSpecifier:uh,monthFormat:function(e){return RL.call(this,e,1,"%B")},monthAbbrevFormat:function(e){return RL.call(this,e,1,"%b")},dayFormat:function(e){return RL.call(this,0,2+e,"%A")},dayAbbrevFormat:function(e){return RL.call(this,0,2+e,"%a")},quarter:rc,utcquarter:ic,week:hh,utcweek:bh,dayofyear:dh,utcdayofyear:vh,warn:function(){return HL(this.context.dataflow,"warn",arguments)},info:function(){return HL(this.context.dataflow,"info",arguments)},debug:function(){return HL(this.context.dataflow,"debug",arguments)},extent:gc,inScope:function(e){const t=this.context.group;let n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},intersect:function(e,t,n){if(!e)return[];const[r,i]=e,a=(new hS).set(r[0],r[1],i[0],i[1]);return zA(n||this.context.dataflow.scenegraph().root,a,function(e){let t=null;if(e){const n=ac(e.marktype),r=ac(e.markname);t=e=>(!n.length||n.some((t=>e.marktype===t)))&&(!r.length||r.some((t=>e.name===t)))}return t}(t))},clampRange:oc,pinchDistance:function(e){const t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){const t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){const e=eI();return e?e.screen:{}},containerSize:function(){const e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){const e=eI();return e?[e.innerWidth,e.innerHeight]:[void 0,void 0]},bandspace:function(e,t,n){return tk(e||0,t||0,n||0)},setdata:function(e,t){const n=this.context.dataflow,r=this.context.data[e].input;return n.pulse(r,n.changeset().remove(Cu).insert(t)),1},pathShape:function(e){let t=null;return function(n){return n?RO(n,t=t||SO(e)):e}},panLinear:Xu,panLog:Yu,panPow:Ju,panSymlog:Ku,zoomLinear:Zu,zoomLog:ec,zoomPow:tc,zoomSymlog:nc,encode:function(e,t,n){if(e){const n=this.context.dataflow,r=e.mark.source;n.pulse(r,n.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,t,n,r,i,a){const o=this.context.dataflow,s=this.context.data[e],l=s.input,u=o.stamp();let c,f,d=s.changes;if(!1===o._trigger||!(l.value.length||t||r))return 0;if((!d||d.stamp<u)&&(s.changes=d=o.changeset(),d.stamp=u,o.runAfter((()=>{s.modified=!0,o.pulse(l,d).run()}),!0,1)),n&&(c=!0===n?Cu:Tu(n)||Jm(n)?n:KL(n),d.remove(c)),t&&d.insert(t),r&&(c=KL(r),l.value.some(c)?d.remove(c):d.insert(r)),i)for(f in a)d.modify(i,f,a[f]);return 1}},nI=["view","item","group","xy","x","y"],rI="this.",iI={},aI={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:e=>"_[".concat(zc("$"+e),"]"),functions:function(e){const t=wL(e);nI.forEach((e=>t[e]="event.vega."+e));for(const e in tI)t[e]=rI+e;return mc(t,IL(e,tI,iI)),t},constants:xL,visitors:iI},oI=function(e){const t=(e=e||{}).allowed?Uc(e.allowed):{},n=e.forbidden?Uc(e.forbidden):{},r=e.constants||xL,i=(e.functions||wL)(f),a=e.globalvar,o=e.fieldvar,s=sc(a)?a:e=>"".concat(a,'["').concat(e,'"]');let l={},u={},c=0;function f(e){if(Cc(e))return e;const t=d[e.type];return null==t&&ku("Unsupported type: "+e.type),t(e)}const d={Literal:e=>e.raw,Identifier:e=>{const i=e.name;return c>0?i:bc(n,i)?ku("Illegal identifier: "+i):bc(r,i)?r[i]:bc(t,i)?i:(l[i]=1,s(i))},MemberExpression:e=>{const t=!e.computed,n=f(e.object);t&&(c+=1);const r=f(e.property);return n===o&&(u[function(e){const t=e&&e.length-1;return t&&('"'===e[0]&&'"'===e[t]||"'"===e[0]&&"'"===e[t])?e.slice(1,-1):e}(r)]=1),t&&(c-=1),n+(t?"."+r:"["+r+"]")},CallExpression:e=>{"Identifier"!==e.callee.type&&ku("Illegal callee type: "+e.callee.type);const t=e.callee.name,n=e.arguments,r=bc(i,t)&&i[t];return r||ku("Unrecognized function: "+t),sc(r)?r(n):r+"("+n.map(f).join(",")+")"},ArrayExpression:e=>"["+e.elements.map(f).join(",")+"]",BinaryExpression:e=>"("+f(e.left)+" "+e.operator+" "+f(e.right)+")",UnaryExpression:e=>"("+e.operator+f(e.argument)+")",ConditionalExpression:e=>"("+f(e.test)+"?"+f(e.consequent)+":"+f(e.alternate)+")",LogicalExpression:e=>"("+f(e.left)+e.operator+f(e.right)+")",ObjectExpression:e=>"{"+e.properties.map(f).join(",")+"}",Property:e=>{c+=1;const t=f(e.key);return c-=1,t+":"+f(e.value)}};function h(e){const t={code:f(e),globals:Object.keys(l),fields:Object.keys(u)};return l={},u={},t}return h.functions=i,h.constants=r,h}(aI);function sI(e,t,n){return 1===arguments.length?tI[e]:(tI[e]=t,n&&(iI[e]=n),oI&&(oI.functions[e]=rI+e),this)}function lI(e,t){const n={};let r;try{r=bL(e=Cc(e)?e:zc(e)+"")}catch(t){ku("Expression parse error: "+e)}r.visit((e=>{if(e.type!==sB)return;const r=e.callee.name,i=aI.visitors[r];i&&i(r,e.arguments,t,n)}));const i=oI(r);return i.globals.forEach((e=>{const r="$"+e;!bc(n,r)&&t.getSignal(e)&&(n[r]=t.signalRef(e))})),{$expr:mc({code:i.code},t.options.ast?{ast:r}:null),$fields:i.fields,$params:n}}sI("bandwidth",(function(e,t){const n=LL(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0}),zL),sI("copy",(function(e,t){const n=LL(e,(t||this).context);return n?n.copy():void 0}),zL),sI("domain",(function(e,t){const n=LL(e,(t||this).context);return n?n.domain():[]}),zL),sI("range",(function(e,t){const n=LL(e,(t||this).context);return n&&n.range?n.range():[]}),zL),sI("invert",(function(e,t,n){const r=LL(e,(n||this).context);return r?Tu(t)?(r.invertRange||r.invert)(t):(r.invert||r.invertExtent)(t):void 0}),zL),sI("scale",(function(e,t,n){const r=LL(e,(n||this).context);return r?r(t):void 0}),zL),sI("gradient",(function(e,t,n,r,i){e=LL(e,(i||this).context);const a=xO(t,n);let o=e.domain(),s=o[0],l=Lu(o),u=Eu;return l-s?u=Uk(e,s,l):e=(e.interpolator?Ck("sequential")().interpolator(e.interpolator()):Ck("linear")().interpolate(e.interpolate()).range(e.range())).domain([s=0,l=1]),e.ticks&&(o=e.ticks(+r||15),s!==o[0]&&o.unshift(s),l!==Lu(o)&&o.push(l)),o.forEach((t=>a.stop(u(t),e(t)))),a}),zL),sI("geoArea",UL,zL),sI("geoBounds",VL,zL),sI("geoCentroid",WL,zL),sI("geoShape",(function(e,t,n){const r=LL(e,(n||this).context);return function(e){return r?r.path.context(e)(t):""}}),zL),sI("indata",(function(e,t,n){const r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i}),(function(e,t,n,r){t[0].type!==nB&&ku("First argument to indata must be a string literal."),t[1].type!==nB&&ku("Second argument to indata must be a string literal.");const i=t[0].value,a=t[1].value,o="@"+a;bc(o,r)||(r[o]=n.getData(i).indataRef(n,a))})),sI("data",AL,PL),sI("treePath",(function(e,t,n){const r=ZL(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(QL):void 0}),PL),sI("treeAncestors",(function(e,t){const n=ZL(e,this)[t];return n?n.ancestors().map(QL):void 0}),PL),sI("vlSelectionTest",(function(e,t,n){for(var r,i,a,o,s,l=this.context.data[e],u=l?l.values.value:[],c=l?l[OL]&&l[OL].value:void 0,f=n===_L,d=u.length,h=0;h<d;++h)if(r=u[h],c&&f){if(-1===(a=(i=i||{})[o=r.unit]||0))continue;if(s=SL(t,r),i[o]=s?-1:++a,s&&1===c.size)return!0;if(!s&&a===c.get(o).count)return!1}else if(f^(s=SL(t,r)))return s;return d&&f}),EL),sI("vlSelectionResolve",(function(e,t,n){for(var r,i,a,o,s,l,u,c,f,d,h,p=this.context.data[e],m=p?p.values.value:[],g={},y={},v={},b=m.length,x=0;x<b;++x){for(o=(r=m[x]).unit,i=r.fields,a=r.values,d=0,h=i.length;d<h;++d)s=i[d],u=(l=g[s.field]||(g[s.field]={}))[o]||(l[o]=[]),v[s.field]=c=s.type.charAt(0),f=$L[c+"_union"],l[o]=f(u,ac(a[d]));n&&(u=y[o]||(y[o]=[])).push(ac(a).reduce(((e,t,n)=>(e[i[n].field]=t,e)),{}))}return t=t||kL,Object.keys(g).forEach((e=>{g[e]=Object.keys(g[e]).map((t=>g[e][t])).reduce(((n,r)=>void 0===n?r:$L[v[e]+"_"+t](n,r)))})),m=Object.keys(y),n&&m.length&&(g.vlMulti=t===kL?{or:m.reduce(((e,t)=>(e.push(...y[t]),e)),[])}:{and:m.map((e=>({or:y[e]})))}),g}),EL);const uI=Uc(["rule"]),cI=Uc(["group","image","rect"]);function fI(e){return(e+"").toLowerCase()}function dI(e,t,n){";"!==n[n.length-1]&&(n="return("+n+");");const r=Function(...t.concat(n));return e&&e.functions?r.bind(e.functions):r}var hI={operator:(e,t)=>dI(e,["_"],t.code),parameter:(e,t)=>dI(e,["datum","_"],t.code),event:(e,t)=>dI(e,["event"],t.code),handler:(e,t)=>dI(e,["_","event"],"var datum=event.item&&event.item.datum;return ".concat(t.code,";")),encode:(e,t)=>{const{marktype:n,channels:r}=t;let i="var o=item,datum=o.datum,m=0,$;";for(const e in r){const t="o["+zc(e)+"]";i+="$=".concat(r[e].code,";if(").concat(t,"!==$)").concat(t,"=$,m=1;")}return i+=function(e,t){let n="";return uI[t]||(e.x2&&(e.x?(cI[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(cI[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;")),n}(r,n),i+="return m;",dI(e,["item","_"],i)},codegen:{get(e){const t="[".concat(e.map(zc).join("]["),"]"),n=Function("_","return _".concat(t,";"));return n.path=t,n},comparator(e,t){let n;const r=Function("a","b","var u, v; return "+e.map(((e,r)=>{const i=t[r];let a,o;return e.path?(a="a".concat(e.path),o="b".concat(e.path)):((n=n||{})["f"+r]=e,a="this.f".concat(r,"(a)"),o="this.f".concat(r,"(b)")),function(e,t,n,r){return"((u = ".concat(e,") < (v = ").concat(t,") || u == null) && v != null ? ").concat(n,"\n  : (u > v || v == null) && u != null ? ").concat(r,"\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ").concat(n,"\n  : v !== v && u === u ? ").concat(r," : ")}(a,o,-i,i)})).join("")+"0;");return n?r.bind(n):r}}};function pI(e,t,n){if(!e||!Nu(e))return e;for(let r,i=0,a=mI.length;i<a;++i)if(r=mI[i],bc(e,r.key))return r.parse(e,t,n);return e}var mI=[{key:"$ref",parse:function(e,t){return t.get(e.$ref)||ku("Operator not defined: "+e.$ref)}},{key:"$key",parse:function(e,t){const n="k:"+e.$key+"_"+!!e.$flat;return t.fn[n]||(t.fn[n]=Mc(e.$key,e.$flat,t.expr.codegen))}},{key:"$expr",parse:function(e,t,n){e.$params&&t.parseParameters(e.$params,n);const r="e:"+e.$expr.code+"_"+e.$name;return t.fn[r]||(t.fn[r]=yu(t.parameterExpression(e.$expr),e.$fields,e.$name))}},{key:"$field",parse:function(e,t){if(!e.$field)return null;const n="f:"+e.$field+"_"+e.$name;return t.fn[n]||(t.fn[n]=Su(e.$field,e.$name,t.expr.codegen))}},{key:"$encode",parse:function(e,t){const n=e.$encode,r={};for(const e in n){const i=n[e];r[e]=yu(t.encodeExpression(i.$expr),i.$fields),r[e].output=i.$output}return r}},{key:"$compare",parse:function(e,t){const n="c:"+e.$compare+"_"+e.$order,r=ac(e.$compare).map((e=>e&&e.$tupleid?Km:e));return t.fn[n]||(t.fn[n]=lc(r,e.$order,t.expr.codegen))}},{key:"$context",parse:function(e,t){return t}},{key:"$subflow",parse:function(e,t){const n=e.$subflow;return function(e,r,i){const a=t.fork().parse(n),o=a.get(n.operators[0].id),s=a.signals.parent;return s&&s.set(i),o.detachSubflow=()=>t.detach(a),o}}},{key:"$tupleid",parse:function(){return Km}}];const gI={skip:!0};function yI(e,t,n,r){return new vI(e,t,n,r)}function vI(e,t,n,r){this.dataflow=e,this.transforms=t,this.events=e.events.bind(e),this.expr=r||hI,this.signals={},this.scales={},this.nodes={},this.data={},this.fn={},n&&(this.functions=Object.create(n),this.functions.context=this)}function bI(e){this.dataflow=e.dataflow,this.transforms=e.transforms,this.events=e.events,this.expr=e.expr,this.signals=Object.create(e.signals),this.scales=Object.create(e.scales),this.nodes=Object.create(e.nodes),this.data=Object.create(e.data),this.fn=Object.create(e.fn),e.functions&&(this.functions=Object.create(e.functions),this.functions.context=this)}function xI(e,t){e&&(null==t?e.removeAttribute("aria-label"):e.setAttribute("aria-label",t))}vI.prototype=bI.prototype={fork(){const e=new bI(this);return(this.subcontext||(this.subcontext=[])).push(e),e},detach(e){this.subcontext=this.subcontext.filter((t=>t!==e));const t=Object.keys(e.nodes);for(const n of t)e.nodes[n]._targets=null;for(const n of t)e.nodes[n].detach();e.nodes=null},get(e){return this.nodes[e]},set(e,t){return this.nodes[e]=t},add(e,t){const n=this,r=n.dataflow,i=e.value;if(n.set(e.id,t),function(e){return"collect"===fI(e)}(e.type)&&i&&(i.$ingest?r.ingest(t,i.$ingest,i.$format):i.$request?r.preload(t,i.$request,i.$format):r.pulse(t,r.changeset().insert(i))),e.root&&(n.root=t),e.parent){let i=n.get(e.parent.$ref);i?(r.connect(i,[t]),t.targets().add(i)):(n.unresolved=n.unresolved||[]).push((()=>{i=n.get(e.parent.$ref),r.connect(i,[t]),t.targets().add(i)}))}if(e.signal&&(n.signals[e.signal]=t),e.scale&&(n.scales[e.scale]=t),e.data)for(const r in e.data){const i=n.data[r]||(n.data[r]={});e.data[r].forEach((e=>i[e]=t))}},resolve(){return(this.unresolved||[]).forEach((e=>e())),delete this.unresolved,this},operator(e,t){this.add(e,this.dataflow.add(e.value,t))},transform(e,t){this.add(e,this.dataflow.add(this.transforms[fI(t)]))},stream(e,t){this.set(e.id,t)},update(e,t,n,r,i){this.dataflow.on(t,n,r,i,e.options)},operatorExpression(e){return this.expr.operator(this,e)},parameterExpression(e){return this.expr.parameter(this,e)},eventExpression(e){return this.expr.event(this,e)},handlerExpression(e){return this.expr.handler(this,e)},encodeExpression(e){return this.expr.encode(this,e)},parse:function(e){const t=this,n=e.operators||[];return e.background&&(t.background=e.background),e.eventConfig&&(t.eventConfig=e.eventConfig),e.locale&&(t.locale=e.locale),n.forEach((e=>t.parseOperator(e))),n.forEach((e=>t.parseOperatorParameters(e))),(e.streams||[]).forEach((e=>t.parseStream(e))),(e.updates||[]).forEach((e=>t.parseUpdate(e))),t.resolve()},parseOperator:function(e){const t=this;!function(e){return"operator"===fI(e)}(e.type)&&e.type?t.transform(e,e.type):t.operator(e,e.update?t.operatorExpression(e.update):null)},parseOperatorParameters:function(e){const t=this;if(e.params){const n=t.get(e.id);n||ku("Invalid operator id: "+e.id),t.dataflow.connect(n,n.parameters(t.parseParameters(e.params),e.react,e.initonly))}},parseParameters:function(e,t){t=t||{};const n=this;for(const r in e){const i=e[r];t[r]=Tu(i)?i.map((e=>pI(e,n,t))):pI(i,n,t)}return t},parseStream:function(e){var t,n=this,r=null!=e.filter?n.eventExpression(e.filter):void 0,i=null!=e.stream?n.get(e.stream):void 0;e.source?i=n.events(e.source,e.type,r):e.merge&&(i=(t=e.merge.map((e=>n.get(e))))[0].merge.apply(t[0],t.slice(1))),e.between&&(t=e.between.map((e=>n.get(e))),i=i.between(t[0],t[1])),e.filter&&(i=i.filter(r)),null!=e.throttle&&(i=i.throttle(+e.throttle)),null!=e.debounce&&(i=i.debounce(+e.debounce)),null==i&&ku("Invalid stream definition: "+JSON.stringify(e)),e.consume&&i.consume(!0),n.stream(e,i)},parseUpdate:function(e){var t,n=this,r=Nu(r=e.source)?r.$ref:r,i=n.get(r),a=e.update,o=void 0;i||ku("Source not defined: "+e.source),t=e.target&&e.target.$expr?n.eventExpression(e.target.$expr):n.get(e.target),a&&a.$expr&&(a.$params&&(o=n.parseParameters(a.$params)),a=n.handlerExpression(a.$expr)),n.update(e,i,t,a,o)},getState:function(e){var t=this,n={};if(e.signals){var r=n.signals={};Object.keys(t.signals).forEach((n=>{const i=t.signals[n];e.signals(n,i)&&(r[n]=i.value)}))}if(e.data){var i=n.data={};Object.keys(t.data).forEach((n=>{const r=t.data[n];e.data(n,r)&&(i[n]=r.input.value)}))}return t.subcontext&&!1!==e.recurse&&(n.subcontext=t.subcontext.map((t=>t.getState(e)))),n},setState:function(e){var t=this,n=t.dataflow,r=e.data,i=e.signals;Object.keys(i||{}).forEach((e=>{n.update(t.signals[e],i[e],gI)})),Object.keys(r||{}).forEach((e=>{n.pulse(t.data[e].input,n.changeset().remove(Cu).insert(r[e]))})),(e.subcontext||[]).forEach(((e,n)=>{const r=t.subcontext[n];r&&r.setState(e)}))}};const wI="default";function _I(e,t){const n=e.globalCursor()?"undefined"!=typeof document&&document.body:e.container();if(n)return null==t?n.style.removeProperty("cursor"):n.style.cursor=t}function kI(e,t){var n=e._runtime.data;return bc(n,t)||ku("Unrecognized data set: "+t),n[t]}function OI(e,t){ig(t)||ku("Second argument to changes must be a changeset.");const n=kI(this,e);return n.modified=!0,this.pulse(n.input,t)}function SI(e){var t=e.padding();return Math.max(0,e._viewWidth+t.left+t.right)}function $I(e){var t=e.padding();return Math.max(0,e._viewHeight+t.top+t.bottom)}function EI(e){var t=e.padding(),n=e._origin;return[t.left+n[0],t.top+n[1]]}function AI(e,t,n){var r,i,a=e._renderer,o=a&&a.canvas();return o&&(i=EI(e),(r=kE(t.changedTouches?t.changedTouches[0]:t,o))[0]-=i[0],r[1]-=i[1]),t.dataflow=e,t.item=n,t.vega=function(e,t,n){const r=t?"group"===t.mark.marktype?t:t.mark.group:null;function i(e){var n,i=r;if(e)for(n=t;n;n=n.mark.group)if(n.mark.name===e){i=n;break}return i&&i.mark&&i.mark.interactive?i:{}}function a(e){if(!e)return n;Cc(e)&&(e=i(e));const t=n.slice();for(;e;)t[0]-=e.x||0,t[1]-=e.y||0,e=e.mark&&e.mark.group;return t}return{view:hc(e),item:hc(t||{}),group:i,xy:a,x:function(e){return a(e)[0]},y:function(e){return a(e)[1]}}}(e,n,r),t}const DI="view",CI={trap:!1};function MI(e,t,n){const r=e._eventConfig&&e._eventConfig[t];return!(!1===r||Nu(r)&&!r[n])||(e.warn("Blocked ".concat(t," ").concat(n," event listener.")),!1)}function jI(e){return e.item}function FI(e){return e.item.mark.source}function TI(e){return function(t,n){return n.vega.view().changeset().encode(n.item,e)}}function NI(e,t,n){const r=document.createElement(e);for(const e in t)r.setAttribute(e,t[e]);return null!=n&&(r.textContent=n),r}const RI="vega-bind",PI="vega-bind-name";function zI(e,t,n){if(!t)return;const r=n.param;let i=n.state;return i||(i=n.state={elements:null,active:!1,set:null,update:t=>{t!==e.signal(r.signal)&&e.runAsync(null,(()=>{i.source=!0,e.signal(r.signal,t)}))}},r.debounce&&(i.update=pc(r.debounce,i.update))),function(e,t,n,r){const i=NI("div",{class:RI}),a="radio"===n.input?i:i.appendChild(NI("label"));a.appendChild(NI("span",{class:PI},n.name||n.signal)),t.appendChild(i);let o=BI;switch(n.input){case"checkbox":o=LI;break;case"select":o=II;break;case"radio":o=qI;break;case"range":o=UI}o(e,a,n,r)}(i,t,r,e.signal(r.signal)),i.active||(e.on(e._signals[r.signal],null,(()=>{i.source?i.source=!1:i.set(e.signal(r.signal))})),i.active=!0),i}function BI(e,t,n,r){const i=NI("input");for(const e in n)"signal"!==e&&"element"!==e&&i.setAttribute("input"===e?"type":e,n[e]);i.setAttribute("name",n.signal),i.value=r,t.appendChild(i),i.addEventListener("input",(()=>e.update(i.value))),e.elements=[i],e.set=e=>i.value=e}function LI(e,t,n,r){const i={type:"checkbox",name:n.signal};r&&(i.checked=!0);const a=NI("input",i);t.appendChild(a),a.addEventListener("change",(()=>e.update(a.checked))),e.elements=[a],e.set=e=>a.checked=!!e||null}function II(e,t,n,r){const i=NI("select",{name:n.signal}),a=n.labels||[];n.options.forEach(((e,t)=>{const n={value:e};VI(e,r)&&(n.selected=!0),i.appendChild(NI("option",n,(a[t]||e)+""))})),t.appendChild(i),i.addEventListener("change",(()=>{e.update(n.options[i.selectedIndex])})),e.elements=[i],e.set=e=>{for(let t=0,r=n.options.length;t<r;++t)if(VI(n.options[t],e))return void(i.selectedIndex=t)}}function qI(e,t,n,r){const i=NI("span",{class:"vega-bind-radio"}),a=n.labels||[];t.appendChild(i),e.elements=n.options.map(((t,o)=>{const s={type:"radio",name:n.signal,value:t};VI(t,r)&&(s.checked=!0);const l=NI("input",s);l.addEventListener("change",(()=>e.update(t)));const u=NI("label",{},(a[o]||t)+"");return u.prepend(l),i.appendChild(u),l})),e.set=t=>{const n=e.elements,r=n.length;for(let e=0;e<r;++e)VI(n[e].value,t)&&(n[e].checked=!0)}}function UI(e,t,n,r){r=void 0!==r?r:(+n.max+ +n.min)/2;const i=null!=n.max?n.max:Math.max(100,+r)||100,a=n.min||Math.min(0,i,+r)||0,o=n.step||Wf(a,i,100),s=NI("input",{type:"range",name:n.signal,min:a,max:i,step:o});s.value=r;const l=NI("span",{},+r);t.appendChild(s),t.appendChild(l);const u=()=>{l.textContent=s.value,e.update(+s.value)};s.addEventListener("input",u),s.addEventListener("change",u),e.elements=[s],e.set=e=>{s.value=e,l.textContent=e}}function VI(e,t){return e===t||e+""==t+""}function WI(e,t,n,r,i,a){return(t=t||new r(e.loader())).initialize(n,SI(e),$I(e),EI(e),i,a).background(e.background())}function HI(e,t){return t?function(){try{t.apply(this,arguments)}catch(t){e.error(t)}}:null}function GI(e,t){if("string"==typeof t){if("undefined"==typeof document)return e.error("DOM document instance not found."),null;if(!(t=document.querySelector(t)))return e.error("Signal bind element not found: "+t),null}if(t)try{t.innerHTML=""}catch(n){t=null,e.error(n)}return t}const XI=e=>+e||0;function YI(e){return Nu(e)?{top:XI(e.top),bottom:XI(e.bottom),left:XI(e.left),right:XI(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(XI(e))}async function JI(e,t,n,r){const i=PA(t),a=i&&i.headless;return a||ku("Unrecognized renderer type: "+t),await e.runAsync(),WI(e,null,null,a,n,r).renderAsync(e._scenegraph.root)}var KI="width",QI="height",ZI="padding",eq={skip:!0};function tq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===ZI?r.left+r.right:0)}function nq(e,t){var n=e.autosize(),r=e.padding();return t-(n&&n.contains===ZI?r.top+r.bottom:0)}function rq(e,t){return t.modified&&Tu(t.input.value)&&e.indexOf("_:vega:_")}function iq(e,t){return!("parent"===e||t instanceof Mg.proxy)}function aq(e,t,n,r){const i=e.element();i&&i.setAttribute("title",function(e){return null==e?"":Tu(e)?oq(e):Nu(e)&&!$c(e)?(t=e,Object.keys(t).map((e=>{const n=t[e];return e+": "+(Tu(n)?oq(n):sq(n))})).join("\n")):e+"";var t}(r))}function oq(e){return"["+e.map(sq).join(", ")+"]"}function sq(e){return Tu(e)?"[…]":Nu(e)&&!$c(e)?"{…}":e}function lq(e,t){const n=this;if(t=t||{},Ag.call(n),t.loader&&n.loader(t.loader),t.logger&&n.logger(t.logger),null!=t.logLevel&&n.logLevel(t.logLevel),t.locale||e.locale){const r=mc({},e.locale,t.locale);n.locale(qm(r.number,r.time))}n._el=null,n._elBind=null,n._renderType=t.renderer||NA.Canvas,n._scenegraph=new gE;const r=n._scenegraph.root;n._renderer=null,n._tooltip=t.tooltip||aq,n._redraw=!0,n._handler=(new qE).scene(r),n._globalCursor=!1,n._preventDefault=!1,n._timers=[],n._eventListeners=[],n._resizeListeners=[],n._eventConfig=function(e){const t=mc({defaults:{}},e),n=(e,t)=>{t.forEach((t=>{Tu(e[t])&&(e[t]=Uc(e[t]))}))};return n(t.defaults,["prevent","allow"]),n(t,["view","window","selector"]),t}(e.eventConfig),n.globalCursor(n._eventConfig.globalCursor);const i=function(e,t,n){return yI(e,Mg,tI,n).parse(t)}(n,e,t.expr);n._runtime=i,n._signals=i.signals,n._bind=(e.bindings||[]).map((e=>({state:null,param:mc({},e)}))),i.root&&i.root.set(r),r.source=i.data.root.input,n.pulse(i.data.root.input,n.changeset().insert(r.items)),n._width=n.width(),n._height=n.height(),n._viewWidth=tq(n,n._width),n._viewHeight=nq(n,n._height),n._origin=[0,0],n._resize=0,n._autosize=1,function(e){var t=e._signals,n=t.width,r=t.height,i=t.padding;function a(){e._autosize=e._resize=1}e._resizeWidth=e.add(null,(t=>{e._width=t.size,e._viewWidth=tq(e,t.size),a()}),{size:n}),e._resizeHeight=e.add(null,(t=>{e._height=t.size,e._viewHeight=nq(e,t.size),a()}),{size:r});const o=e.add(null,a,{pad:i});e._resizeWidth.rank=n.rank+1,e._resizeHeight.rank=r.rank+1,o.rank=i.rank+1}(n),function(e){e.add(null,(t=>(e._background=t.bg,e._resize=1,t.bg)),{bg:e._signals.background})}(n),function(e){const t=e._signals.cursor||(e._signals.cursor=e.add({user:wI,item:null}));e.on(e.events("view","mousemove"),t,((e,n)=>{const r=t.value,i=r?Cc(r)?r:r.user:wI,a=n.item&&n.item.cursor||null;return r&&i===r.user&&a==r.item?r:{user:i,item:a}})),e.add(null,(function(t){let n=t.cursor,r=this.value;return Cc(n)||(r=n.item,n=n.user),_I(e,n&&n!==wI?n:r||n),r}),{cursor:t})}(n),n.description(e.description),t.hover&&n.hover(),t.container&&n.initialize(t.container,t.bind)}function uq(e,t){return bc(e._signals,t)?e._signals[t]:ku("Unrecognized signal name: "+zc(t))}function cq(e,t){const n=(e._targets||[]).filter((e=>e._update&&e._update.handler===t));return n.length?n[0]:null}function fq(e,t,n,r){let i=cq(n,r);return i||(i=HI(e,(()=>r(t,n.value))),i.handler=r,e.on(n,null,i)),e}function dq(e,t,n){const r=cq(t,n);return r&&t._targets.remove(r),e}kc(lq,Ag,{async evaluate(e,t,n){if(await Ag.prototype.evaluate.call(this,e,t),this._redraw||this._resize)try{this._renderer&&(this._resize&&(this._resize=0,function(e){var t=EI(e),n=SI(e),r=$I(e);e._renderer.background(e.background()),e._renderer.resize(n,r,t),e._handler.origin(t),e._resizeListeners.forEach((t=>{try{t(n,r)}catch(t){e.error(t)}}))}(this)),await this._renderer.renderAsync(this._scenegraph.root)),this._redraw=!1}catch(e){this.error(e)}return n&&Gm(this,n),this},dirty(e){this._redraw=!0,this._renderer&&this._renderer.dirty(e)},description(e){if(arguments.length){const t=null!=e?e+"":null;return t!==this._desc&&xI(this._el,this._desc=t),this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(e,t,n){const r=uq(this,e);return 1===arguments.length?r.value:this.update(r,t,n)},width(e){return arguments.length?this.signal("width",e):this.signal("width")},height(e){return arguments.length?this.signal("height",e):this.signal("height")},padding(e){return arguments.length?this.signal("padding",YI(e)):YI(this.signal("padding"))},autosize(e){return arguments.length?this.signal("autosize",e):this.signal("autosize")},background(e){return arguments.length?this.signal("background",e):this.signal("background")},renderer(e){return arguments.length?(PA(e)||ku("Unrecognized renderer type: "+e),e!==this._renderType&&(this._renderType=e,this._resetRenderer()),this):this._renderType},tooltip(e){return arguments.length?(e!==this._tooltip&&(this._tooltip=e,this._resetRenderer()),this):this._tooltip},loader(e){return arguments.length?(e!==this._loader&&(Ag.prototype.loader.call(this,e),this._resetRenderer()),this):this._loader},resize(){return this._autosize=1,this.touch(uq(this,"autosize"))},_resetRenderer(){this._renderer&&(this._renderer=null,this.initialize(this._el,this._elBind))},_resizeView:function(e,t,n,r,i,a){this.runAfter((o=>{let s=0;o._autosize=0,o.width()!==n&&(s=1,o.signal(KI,n,eq),o._resizeWidth.skip(!0)),o.height()!==r&&(s=1,o.signal(QI,r,eq),o._resizeHeight.skip(!0)),o._viewWidth!==e&&(o._resize=1,o._viewWidth=e),o._viewHeight!==t&&(o._resize=1,o._viewHeight=t),o._origin[0]===i[0]&&o._origin[1]===i[1]||(o._resize=1,o._origin=i),s&&o.run("enter"),a&&o.runAfter((e=>e.resize()))}),!1,1)},addEventListener(e,t,n){let r=t;return n&&!1===n.trap||(r=HI(this,t),r.raw=t),this._handler.on(e,r),this},removeEventListener(e,t){for(var n,r,i=this._handler.handlers(e),a=i.length;--a>=0;)if(r=i[a].type,n=i[a].handler,e===r&&(t===n||t===n.raw)){this._handler.off(r,n);break}return this},addResizeListener(e){const t=this._resizeListeners;return t.indexOf(e)<0&&t.push(e),this},removeResizeListener(e){var t=this._resizeListeners,n=t.indexOf(e);return n>=0&&t.splice(n,1),this},addSignalListener(e,t){return fq(this,e,uq(this,e),t)},removeSignalListener(e,t){return dq(this,uq(this,e),t)},addDataListener(e,t){return fq(this,e,kI(this,e).values,t)},removeDataListener(e,t){return dq(this,kI(this,e).values,t)},globalCursor(e){if(arguments.length){if(this._globalCursor!==!!e){const t=_I(this,null);this._globalCursor=!!e,t&&_I(this,t)}return this}return this._globalCursor},preventDefault(e){return arguments.length?(this._preventDefault=e,this):this._preventDefault},timer:function(e,t){this._timers.push(function(e,t,n){var r=new ZN,i=t;return null==t?(r.restart(e,t,n),r):(r._restart=r.restart,r.restart=function(e,t,n){t=+t,n=null==n?KN():+n,r._restart((function a(o){o+=i,r._restart(a,i+=t,n),e(o)}),t,n)},r.restart(e,t,n),r)}((function(t){e({timestamp:Date.now(),elapsed:t})}),t))},events:function(e,t,n){var r,i=this,a=new hg(n),o=function(n,r){i.runAsync(null,(()=>{e===DI&&function(e,t){var n=e._eventConfig.defaults,r=n.prevent,i=n.allow;return!1!==r&&!0!==i&&(!0===r||!1===i||(r?r[t]:i?!i[t]:e.preventDefault()))}(i,t)&&n.preventDefault(),a.receive(AI(i,n,r))}))};if("timer"===e)MI(i,"timer",t)&&i.timer(o,t);else if(e===DI)MI(i,"view",t)&&i.addEventListener(t,o,CI);else if("window"===e?MI(i,"window",t)&&"undefined"!=typeof window&&(r=[window]):"undefined"!=typeof document&&MI(i,"selector",t)&&(r=document.querySelectorAll(e)),r){for(var s=0,l=r.length;s<l;++s)r[s].addEventListener(t,o);i._eventListeners.push({type:t,sources:r,handler:o})}else i.warn("Can not resolve event source: "+e);return a},finalize:function(){var e,t,n,r=this._tooltip,i=this._timers,a=this._eventListeners;for(e=i.length;--e>=0;)i[e].stop();for(e=a.length;--e>=0;)for(t=(n=a[e]).sources.length;--t>=0;)n.sources[t].removeEventListener(n.type,n.handler);return r&&r.call(this,this._handler,null,null,null),this},hover:function(e,t){return t=[t||"update",(e=[e||"hover"])[0]],this.on(this.events("view","mouseover",jI),FI,TI(e)),this.on(this.events("view","mouseout",jI),FI,TI(t)),this},data:function(e,t){return arguments.length<2?kI(this,e).values.value:OI.call(this,e,ag().remove(Cu).insert(t))},change:OI,insert:function(e,t){return OI.call(this,e,ag().insert(t))},remove:function(e,t){return OI.call(this,e,ag().remove(t))},scale:function(e){var t=this._runtime.scales;return bc(t,e)||ku("Unrecognized scale or projection: "+e),t[e].value},initialize:function(e,t){const n=this,r=n._renderType,i=n._eventConfig.bind,a=PA(r);e=n._el=e?GI(n,e):null,function(e){const t=e.container();t&&(t.setAttribute("role","graphics-document"),t.setAttribute("aria-roleDescription","visualization"),xI(t,e.description()))}(n),a||n.error("Unrecognized renderer type: "+r);const o=a.handler||qE,s=e?a.renderer:a.headless;return n._renderer=s?WI(n,n._renderer,e,s):null,n._handler=function(e,t,n,r){const i=new r(e.loader(),HI(e,e.tooltip())).scene(e.scenegraph().root).initialize(n,EI(e),e);return t&&t.handlers().forEach((e=>{i.on(e.type,e.handler)})),i}(n,n._handler,e,o),n._redraw=!0,e&&"none"!==i&&(t=t?n._elBind=GI(n,t):e.appendChild(NI("form",{class:"vega-bindings"})),n._bind.forEach((e=>{e.param.element&&"container"!==i&&(e.element=GI(n,e.param.element))})),n._bind.forEach((e=>{zI(n,e.element||t,e)}))),n},toImageURL:async function(e,t){e!==NA.Canvas&&e!==NA.SVG&&e!==NA.PNG&&ku("Unrecognized image type: "+e);const n=await JI(this,e,t);return e===NA.SVG?function(e,t){const n=new Blob([e],{type:t});return window.URL.createObjectURL(n)}(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")},toCanvas:async function(e,t){return(await JI(this,NA.Canvas,e,t)).canvas()},toSVG:async function(e){return(await JI(this,NA.SVG,e)).svg()},getState:function(e){return this._runtime.getState(e||{data:rq,signals:iq,recurse:!0})},setState:function(e){return this.runAsync(null,(t=>{t._trigger=!1,t._runtime.setState(e)}),(e=>{e._trigger=!0})),this}});const hq="[",pq="]",mq=/[[\]{}]/,gq={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let yq,vq;function bq(e,t,n){return yq=t||"view",vq=n||gq,wq(e.trim()).map(_q)}function xq(e,t,n,r,i){const a=e.length;let o,s=0;for(;t<a;++t){if(o=e[t],!s&&o===n)return t;i&&i.indexOf(o)>=0?--s:r&&r.indexOf(o)>=0&&++s}return t}function wq(e){const t=[],n=e.length;let r=0,i=0;for(;i<n;)i=xq(e,i,",","[{","]}"),t.push(e.substring(r,i).trim()),r=++i;if(0===t.length)throw"Empty event selector: "+e;return t}function _q(e){return"["===e[0]?function(e){const t=e.length;let n,r=1;if(r=xq(e,r,pq,hq,pq),r===t)throw"Empty between selector: "+e;if(n=wq(e.substring(1,r)),2!==n.length)throw"Between selector must have two elements: "+e;if(">"!==(e=e.slice(r+1).trim())[0])throw"Expected '>' after between selector: "+e;n=n.map(_q);const i=_q(e.slice(1).trim());if(i.between)return{between:n,stream:i};i.between=n;return i}(e):function(e){const t={source:yq},n=[];let r,i,a=[0,0],o=0,s=0,l=e.length,u=0;if("}"===e[l-1]){if(u=e.lastIndexOf("{"),!(u>=0))throw"Unmatched right brace: "+e;try{a=function(e){const t=e.split(",");if(!e.length||t.length>2)throw e;return t.map((t=>{const n=+t;if(n!=n)throw e;return n}))}(e.substring(u+1,l-1))}catch(t){throw"Invalid throttle specification: "+e}l=(e=e.slice(0,u).trim()).length,u=0}if(!l)throw e;"@"===e[0]&&(o=++u);r=xq(e,u,":"),r<l&&(n.push(e.substring(s,r).trim()),s=u=++r);if(u=xq(e,u,hq),u===l)n.push(e.substring(s,l).trim());else if(n.push(e.substring(s,u).trim()),i=[],s=++u,s===l)throw"Unmatched left bracket: "+e;for(;u<l;){if(u=xq(e,u,pq),u===l)throw"Unmatched left bracket: "+e;if(i.push(e.substring(s,u).trim()),u<l-1&&e[++u]!==hq)throw"Expected left bracket: "+e;s=++u}if(!(l=n.length)||mq.test(n[l-1]))throw"Invalid event selector: "+e;l>1?(t.type=n[1],o?t.markname=n[0].slice(1):!function(e){return vq[e]}(n[0])?t.source=n[0]:t.marktype=n[0]):t.type=n[0];"!"===t.type.slice(-1)&&(t.consume=!0,t.type=t.type.slice(0,-1));null!=i&&(t.filter=i);a[0]&&(t.throttle=a[0]);a[1]&&(t.debounce=a[1]);return t}(e)}function kq(e){return Nu(e)?e:{type:e||"pad"}}const Oq=e=>+e||0;function Sq(e){return Nu(e)?e.signal?e:{top:Oq(e.top),bottom:Oq(e.bottom),left:Oq(e.left),right:Oq(e.right)}:(e=>({top:e,bottom:e,left:e,right:e}))(Oq(e))}const $q=e=>Nu(e)&&!Tu(e)?mc({},e):{value:e};function Eq(e,t,n,r){if(null!=n){return Nu(n)&&!Tu(n)||Tu(n)&&n.length&&Nu(n[0])?e.update[t]=n:e[r||"enter"][t]={value:n},1}return 0}function Aq(e,t,n){for(const n in t)Eq(e,n,t[n]);for(const t in n)Eq(e,t,n[t],"update")}function Dq(e,t,n){for(const r in t)n&&bc(n,r)||(e[r]=mc(e[r]||{},t[r]));return e}function Cq(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}const Mq="mark",jq="frame",Fq="scope",Tq="legend-label",Nq="title-text",Rq="title-subtitle";function Pq(e,t,n){e[t]=n&&n.signal?{signal:n.signal}:{value:n}}const zq=e=>Cc(e)?zc(e):e.signal?"(".concat(e.signal,")"):qq(e);function Bq(e){if(null!=e.gradient)return function(e){const t=[e.start,e.stop,e.count].map((e=>null==e?null:zc(e)));for(;t.length&&null==Lu(t);)t.pop();return t.unshift(zq(e.gradient)),"gradient(".concat(t.join(","),")")}(e);let t=e.signal?"(".concat(e.signal,")"):e.color?function(e){return e.c?Lq("hcl",e.h,e.c,e.l):e.h||e.s?Lq("hsl",e.h,e.s,e.l):e.l||e.a?Lq("lab",e.l,e.a,e.b):e.r||e.g||e.b?Lq("rgb",e.r,e.g,e.b):null}(e.color):null!=e.field?qq(e.field):void 0!==e.value?zc(e.value):void 0;return null!=e.scale&&(t=function(e,t){const n=zq(e.scale);null!=e.range?t="lerp(_range(".concat(n,"), ").concat(+e.range,")"):(void 0!==t&&(t="_scale(".concat(n,", ").concat(t,")")),e.band&&(t=(t?t+"+":"")+"_bandwidth(".concat(n,")")+(1==+e.band?"":"*"+Iq(e.band)),e.extra&&(t="(datum.extra ? _scale(".concat(n,", datum.extra.value) : ").concat(t,")"))),null==t&&(t="0"));return t}(e,t)),void 0===t&&(t=null),null!=e.exponent&&(t="pow(".concat(t,",").concat(Iq(e.exponent),")")),null!=e.mult&&(t+="*".concat(Iq(e.mult))),null!=e.offset&&(t+="+".concat(Iq(e.offset))),e.round&&(t="round(".concat(t,")")),t}const Lq=(e,t,n,r)=>"(".concat(e,"(").concat([t,n,r].map(Bq).join(","),")+'')");function Iq(e){return Nu(e)?"("+Bq(e)+")":e}function qq(e){return Uq(Nu(e)?e:{datum:e})}function Uq(e){let t,n,r;if(e.signal)t="datum",r=e.signal;else if(e.group||e.parent){for(n=Math.max(1,e.level||1),t="item";n-- >0;)t+=".mark.group";e.parent?(r=e.parent,t+=".datum"):r=e.group}else e.datum?(t="datum",r=e.datum):ku("Invalid field reference: "+zc(e));return e.signal||(r=Cc(r)?Ou(r).map(zc).join("]["):Uq(r)),t+"["+r+"]"}function Vq(e,t,n,r,i,a){const o={};(a=a||{}).encoders={$encode:o},e=function(e,t,n,r,i){const a={},o={};let s,l,u,c;for(l in l="lineBreak","text"!==t||null==i[l]||Cq(l,e)||Pq(a,l,i[l]),("legend"==n||String(n).startsWith("axis"))&&(n=null),c=n===jq?i.group:n===Mq?mc({},i.mark,i[t]):null,c)u=Cq(l,e)||("fill"===l||"stroke"===l)&&(Cq("fill",e)||Cq("stroke",e)),u||Pq(a,l,c[l]);for(l in ac(r).forEach((t=>{const n=i.style&&i.style[t];for(const t in n)Cq(t,e)||Pq(a,t,n[t])})),e=mc({},e),a)c=a[l],c.signal?(s=s||{})[l]=c:o[l]=c;return e.enter=mc(o,e.enter),s&&(e.update=mc(s,e.update)),e}(e,t,n,r,i.config);for(const n in e)o[n]=Wq(e[n],t,a,i);return a}function Wq(e,t,n,r){const i={},a={};for(const t in e)null!=e[t]&&(i[t]=Hq((o=e[t],Tu(o)?function(e){let t="";return e.forEach((e=>{const n=Bq(e);t+=e.test?"(".concat(e.test,")?").concat(n,":"):n})),":"===Lu(t)&&(t+="null"),t}(o):Bq(o)),r,n,a));var o;return{$expr:{marktype:t,channels:i},$fields:Object.keys(a),$output:Object.keys(e)}}function Hq(e,t,n,r){const i=lI(e,t);return i.$fields.forEach((e=>r[e]=1)),mc(n,i.$params),i.$expr}const Gq=["value","update","init","react","bind"];function Xq(e,t){ku(e+' for "outer" push: '+zc(t))}function Yq(e,t){const n=e.name;if("outer"===e.push)t.signals[n]||Xq("No prior signal definition",n),Gq.forEach((t=>{void 0!==e[t]&&Xq("Invalid property ",t)}));else{const r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}}function Jq(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Kq(e,t,n,r){return new Jq(e,t,n,r)}function Qq(e,t){return Kq("operator",e,t)}function Zq(e){const t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function eU(e,t){return t?{$field:e,$name:t}:{$field:e}}const tU=eU("key");function nU(e,t){return{$compare:e,$order:t}}function rU(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}const iU="scope",aU="view";function oU(e){return e&&e.signal}function sU(e){if(oU(e))return!0;if(Nu(e))for(const t in e)if(sU(e[t]))return!0;return!1}function lU(e,t){return null!=e?e:t}function uU(e){return e&&e.signal||e}const cU="timer";function fU(e,t){return(e.merge?dU:e.stream?hU:e.type?pU:ku("Invalid stream specification: "+zc(e)))(e,t)}function dU(e,t){const n=mU({merge:e.merge.map((e=>fU(e,t)))},e,t);return t.addStream(n).id}function hU(e,t){const n=mU({stream:fU(e.stream,t)},e,t);return t.addStream(n).id}function pU(e,t){let n;e.type===cU?(n=t.event(cU,e.throttle),e={between:e.between,filter:e.filter}):n=t.event(function(e){return e===iU?aU:e||aU}(e.source),e.type);const r=mU({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function mU(e,t,n){let r=t.between;return r&&(2!==r.length&&ku('Stream "between" parameter must have 2 entries: '+zc(t)),e.between=[fU(r[0],n),fU(r[1],n)]),r=t.filter?[].concat(t.filter):[],(t.marktype||t.markname||t.markrole)&&r.push(function(e,t,n){const r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}(t.marktype,t.markname,t.markrole)),t.source===iU&&r.push("inScope(event.item)"),r.length&&(e.filter=lI("("+r.join(")&&(")+")",n).$expr),null!=(r=t.throttle)&&(e.throttle=+r),null!=(r=t.debounce)&&(e.debounce=+r),t.consume&&(e.consume=!0),e}const gU={code:"_.$value",ast:{type:"Identifier",value:"value"}};function yU(e,t,n){const r=e.encode,i={target:n};let a=e.events,o=e.update,s=[];a||ku("Signal update missing events specification."),Cc(a)&&(a=bq(a,t.isSubscope()?iU:aU)),a=ac(a).filter((e=>e.signal||e.scale?(s.push(e),0):1)),s.length>1&&(s=[vU(s)]),a.length&&s.push(a.length>1?{merge:a}:a[0]),null!=r&&(o&&ku("Signal encode and update are mutually exclusive."),o="encode(item(),"+zc(r)+")"),i.update=Cc(o)?lI(o,t):null!=o.expr?lI(o.expr,t):null!=o.value?o.value:null!=o.signal?{$expr:gU,$params:{$value:t.signalRef(o.signal)}}:ku("Invalid signal update specification."),e.force&&(i.options={force:!0}),s.forEach((e=>t.addUpdate(mc(function(e,t){return{source:e.signal?t.signalRef(e.signal):e.scale?t.scaleRef(e.scale):fU(e,t)}}(e,t),i))))}function vU(e){return{signal:"["+e.map((e=>e.scale?'scale("'+e.scale+'")':e.signal))+"]"}}const bU=e=>(t,n,r)=>Kq(e,n,t||void 0,r),xU=bU("aggregate"),wU=bU("axisticks"),_U=bU("bound"),kU=bU("collect"),OU=bU("compare"),SU=bU("datajoin"),$U=bU("encode"),EU=bU("expression"),AU=bU("facet"),DU=bU("field"),CU=bU("key"),MU=bU("legendentries"),jU=bU("load"),FU=bU("mark"),TU=bU("multiextent"),NU=bU("multivalues"),RU=bU("overlap"),PU=bU("params"),zU=bU("prefacet"),BU=bU("projection"),LU=bU("proxy"),IU=bU("relay"),qU=bU("render"),UU=bU("scale"),VU=bU("sieve"),WU=bU("sortitems"),HU=bU("viewlayout"),GU=bU("values");let XU=0;const YU={min:"min",max:"max",count:"sum"};function JU(e,t){const n=t.getScale(e.name).params;let r;for(r in n.domain=eV(e.domain,e,t),null!=e.range&&(n.range=lV(e,t,n)),null!=e.interpolate&&function(e,t){t.interpolate=KU(e.type||e),null!=e.gamma&&(t.interpolateGamma=KU(e.gamma))}(e.interpolate,n),null!=e.nice&&(n.nice=function(e){return Nu(e)?{interval:KU(e.interval),step:KU(e.step)}:KU(e)}(e.nice)),null!=e.bins&&(n.bins=function(e,t){return e.signal||Tu(e)?QU(e,t):t.objectProperty(e)}(e.bins,t)),e)bc(n,r)||"name"===r||(n[r]=KU(e[r],t))}function KU(e,t){return Nu(e)?e.signal?t.signalRef(e.signal):ku("Unsupported object: "+zc(e)):e}function QU(e,t){return e.signal?t.signalRef(e.signal):e.map((e=>KU(e,t)))}function ZU(e){ku("Can not find data set: "+zc(e))}function eV(e,t,n){if(e)return e.signal?n.signalRef(e.signal):(Tu(e)?tV:e.fields?rV:nV)(e,t,n);null==t.domainMin&&null==t.domainMax||ku("No scale domain defined for domainMin/domainMax to override.")}function tV(e,t,n){return e.map((e=>KU(e,n)))}function nV(e,t,n){const r=n.getData(e.data);return r||ZU(e.data),Tk(t.type)?r.valuesRef(n,e.field,aV(e.sort,!1)):zk(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function rV(e,t,n){const r=e.data,i=e.fields.reduce(((e,t)=>(t=Cc(t)?{data:r,field:t}:Tu(t)||t.signal?function(e,t){const n="_:vega:_"+XU++,r=kU({});if(Tu(e))r.value={$ingest:e};else if(e.signal){const i="setdata("+zc(n)+","+e.signal+")";r.params.input=t.signalRef(i)}return t.addDataPipeline(n,[r,VU({})]),{data:n,field:"data"}}(t,n):t,e.push(t),e)),[]);return(Tk(t.type)?iV:zk(t.type)?oV:sV)(e,n,i)}function iV(e,t,n){const r=aV(e.sort,!0);let i,a;const o=n.map((e=>{const n=t.getData(e.data);return n||ZU(e.data),n.countsRef(t,e.field,r)})),s={groupby:tU,pulse:o};r&&(i=r.op||"count",a=r.field?rU(i,r.field):"count",s.ops=[YU[i]],s.fields=[t.fieldRef(a)],s.as=[a]),i=t.add(xU(s));const l=t.add(kU({pulse:Zq(i)}));return a=t.add(GU({field:tU,sort:t.sortRef(r),pulse:Zq(l)})),Zq(a)}function aV(e,t){return e&&(e.field||e.op?e.field||"count"===e.op?t&&e.field&&e.op&&!YU[e.op]&&ku("Multiple domain scales can not be sorted using "+e.op):ku("No field provided for sort aggregate op: "+e.op):Nu(e)?e.field="key":e={field:"key"}),e}function oV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||ZU(e.data),n.domainRef(t,e.field)}));return Zq(t.add(NU({values:r})))}function sV(e,t,n){const r=n.map((e=>{const n=t.getData(e.data);return n||ZU(e.data),n.extentRef(t,e.field)}));return Zq(t.add(TU({extents:r})))}function lV(e,t,n){const r=t.config.range;let i=e.range;if(i.signal)return t.signalRef(i.signal);if(Cc(i)){if(r&&bc(r,i))return lV(e=mc({},e,{range:r[i]}),t,n);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=Tk(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:ku("Unrecognized scale range value: "+zc(i))}else{if(i.scheme)return n.scheme=Tu(i.scheme)?QU(i.scheme,t):KU(i.scheme,t),i.extent&&(n.schemeExtent=QU(i.extent,t)),void(i.count&&(n.schemeCount=KU(i.count,t)));if(i.step)return void(n.rangeStep=KU(i.step,t));if(Tk(e.type)&&!Tu(i))return eV(i,e,t);Tu(i)||ku("Unsupported range type: "+zc(i))}return i.map((e=>(Tu(e)?QU:KU)(e,t)))}function uV(e,t,n){return Tu(e)?e.map((e=>uV(e,t,n))):Nu(e)?e.signal?n.signalRef(e.signal):"fit"===t?e:ku("Unsupported parameter object: "+zc(e)):e}const cV="top",fV="left",dV="right",hV="bottom",pV="center",mV="index",gV="label",yV="perc",vV="value",bV="guide-label",xV="guide-title",wV="group-title",_V="group-subtitle",kV="symbol",OV="gradient",SV="discrete",$V="size",EV=[$V,"shape","fill","stroke","strokeWidth","strokeDash","opacity"],AV={name:1,style:1,interactive:1},DV={value:0},CV={value:1},MV="group",jV="rect",FV="rule",TV="text";function NV(e){return e.type=MV,e.interactive=e.interactive||!1,e}function RV(e,t){const n=(n,r)=>lU(e[n],lU(t[n],r));return n.isVertical=n=>"vertical"===lU(e.direction,t.direction||(n?t.symbolDirection:t.gradientDirection)),n.gradientLength=()=>lU(e.gradientLength,t.gradientLength||t.gradientWidth),n.gradientThickness=()=>lU(e.gradientThickness,t.gradientThickness||t.gradientHeight),n.entryColumns=()=>lU(e.columns,lU(t.columns,+n.isVertical(!0))),n}function PV(e,t){const n=t&&(t.update&&t.update[e]||t.enter&&t.enter[e]);return n&&n.signal?n:n?n.value:null}function zV(e,t,n){return"item.anchor === '".concat("start","' ? ").concat(e," : item.anchor === '").concat("end","' ? ").concat(t," : ").concat(n)}const BV=zV(zc(fV),zc(dV),zc(pV));function LV(e,t){return t?e?Nu(e)?Object.assign({},e,{offset:LV(e.offset,t)}):{value:e,offset:t}:t:e}function IV(e,t){return t?(e.name=t.name,e.style=t.style||e.style,e.interactive=!!t.interactive,e.encode=Dq(e.encode,t,AV)):e.interactive=!1,e}function qV(e,t,n,r){const i=RV(e,n),a=i.isVertical(),o=i.gradientThickness(),s=i.gradientLength();let l,u,c,f,d;a?(u=[0,1],c=[0,0],f=o,d=s):(u=[0,0],c=[1,0],f=s,d=o);const h={enter:l={opacity:DV,x:DV,y:DV,width:$q(f),height:$q(d)},update:mc({},l,{opacity:CV,fill:{gradient:t,start:u,stop:c}}),exit:{opacity:DV}};return Aq(h,{stroke:i("gradientStrokeColor"),strokeWidth:i("gradientStrokeWidth")},{opacity:i("gradientOpacity")}),IV({type:jV,role:"legend-gradient",encode:h},r)}function UV(e,t,n,r,i){const a=RV(e,n),o=a.isVertical(),s=a.gradientThickness(),l=a.gradientLength();let u,c,f,d,h="";o?(u="y",f="y2",c="x",d="width",h="1-"):(u="x",f="x2",c="y",d="height");const p={opacity:DV,fill:{scale:t,field:vV}};p[u]={signal:h+"datum."+yV,mult:l},p[c]=DV,p[f]={signal:h+"datum.perc2",mult:l},p[d]=$q(s);const m={enter:p,update:mc({},p,{opacity:CV}),exit:{opacity:DV}};return Aq(m,{stroke:a("gradientStrokeColor"),strokeWidth:a("gradientStrokeWidth")},{opacity:a("gradientOpacity")}),IV({type:jV,role:"legend-band",key:vV,from:i,encode:m},r)}const VV="datum.".concat(yV,'<=0?"').concat(fV,'":datum.').concat(yV,'>=1?"').concat(dV,'":"').concat(pV,'"'),WV="datum.".concat(yV,'<=0?"').concat(hV,'":datum.').concat(yV,'>=1?"').concat(cV,'":"').concat("middle",'"');function HV(e,t,n,r){const i=RV(e,t),a=i.isVertical(),o=$q(i.gradientThickness()),s=i.gradientLength();let l,u,c,f,d=i("labelOverlap"),h="";const p={enter:l={opacity:DV},update:u={opacity:CV,text:{field:gV}},exit:{opacity:DV}};return Aq(p,{fill:i("labelColor"),fillOpacity:i("labelOpacity"),font:i("labelFont"),fontSize:i("labelFontSize"),fontStyle:i("labelFontStyle"),fontWeight:i("labelFontWeight"),limit:lU(e.labelLimit,t.gradientLabelLimit)}),a?(l.align={value:"left"},l.baseline=u.baseline={signal:WV},c="y",f="x",h="1-"):(l.align=u.align={signal:VV},l.baseline={value:"top"},c="x",f="y"),l[c]=u[c]={signal:h+"datum."+yV,mult:s},l[f]=u[f]=o,o.offset=lU(e.labelOffset,t.gradientLabelOffset)||0,d=d?{separation:i("labelSeparation"),method:d,order:"datum.index"}:void 0,IV({type:TV,role:Tq,style:bV,key:vV,from:r,encode:p,overlap:d},n)}function GV(e,t,n,r,i){const a=RV(e,t),o=n.entries,s=!(!o||!o.interactive),l=o?o.name:void 0,u=a("clipHeight"),c=a("symbolOffset"),f={data:"value"},d="(".concat(i,") ? datum.").concat("offset"," : datum.").concat($V),h=u?$q(u):{field:$V},p="datum.".concat(mV),m="max(1, ".concat(i,")");let g,y,v,b,x;h.mult=.5,g={enter:y={opacity:DV,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:CV,x:y.x,y:y.y},exit:{opacity:DV}};let w=null,_=null;e.fill||(w=t.symbolBaseFillColor,_=t.symbolBaseStrokeColor),Aq(g,{fill:a("symbolFillColor",w),shape:a("symbolType"),size:a("symbolSize"),stroke:a("symbolStrokeColor",_),strokeDash:a("symbolDash"),strokeDashOffset:a("symbolDashOffset"),strokeWidth:a("symbolStrokeWidth")},{opacity:a("symbolOpacity")}),EV.forEach((t=>{e[t]&&(v[t]=y[t]={scale:e[t],field:vV})}));const k=IV({type:"symbol",role:"legend-symbol",key:vV,from:f,clip:!!u||void 0,encode:g},n.symbols),O=$q(c);O.offset=a("labelOffset"),g={enter:y={opacity:DV,x:{signal:d,offset:O},y:h},update:v={opacity:CV,text:{field:gV},x:y.x,y:y.y},exit:{opacity:DV}},Aq(g,{align:a("labelAlign"),baseline:a("labelBaseline"),fill:a("labelColor"),fillOpacity:a("labelOpacity"),font:a("labelFont"),fontSize:a("labelFontSize"),fontStyle:a("labelFontStyle"),fontWeight:a("labelFontWeight"),limit:a("labelLimit")});const S=IV({type:TV,role:Tq,style:bV,key:vV,from:f,encode:g},n.labels);return g={enter:{noBound:{value:!u},width:DV,height:u?$q(u):DV,opacity:DV},exit:{opacity:DV},update:v={opacity:CV,row:{signal:null},column:{signal:null}}},a.isVertical(!0)?(b="ceil(item.mark.items.length / ".concat(m,")"),v.row.signal="".concat(p,"%").concat(b),v.column.signal="floor(".concat(p," / ").concat(b,")"),x={field:["row",p]}):(v.row.signal="floor(".concat(p," / ").concat(m,")"),v.column.signal="".concat(p," % ").concat(m),x={field:p}),v.column.signal="(".concat(i,")?").concat(v.column.signal,":").concat(p),NV({role:Fq,from:r={facet:{data:r,name:"value",groupby:mV}},encode:Dq(g,o,AV),marks:[k,S],name:l,interactive:s,sort:x})}const XV='item.orient === "left"',YV='item.orient === "right"',JV="(".concat(XV," || ").concat(YV,")"),KV="datum.vgrad && ".concat(JV),QV=zV('"top"','"bottom"','"middle"'),ZV=zV('"right"','"left"','"center"'),eW="datum.vgrad && ".concat(YV," ? (").concat(ZV,") : (").concat(JV," && !(datum.vgrad && ").concat(XV,')) ? "left" : ').concat(BV),tW="item._anchor || (".concat(JV,' ? "middle" : "start")'),nW="".concat(KV," ? (").concat(XV," ? -90 : 90) : 0"),rW="".concat(JV," ? (datum.vgrad ? (").concat(YV,' ? "bottom" : "top") : ').concat(QV,') : "top"');function iW(e,t){let n;return Nu(e)&&(e.signal?n=e.signal:e.path?n="pathShape("+aW(e.path)+")":e.sphere&&(n="geoShape("+aW(e.sphere)+', {type: "Sphere"})')),n?t.signalRef(n):!!e}function aW(e){return Nu(e)&&e.signal?e.signal:zc(e)}function oW(e){const t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")&&t.indexOf("title")?e.type===MV?Fq:t||Mq:t}function sW(e){return{marktype:e.type,name:e.name||void 0,role:e.role||oW(e),zindex:+e.zindex||void 0,aria:e.aria,description:e.description}}function lW(e,t){return e&&e.signal?t.signalRef(e.signal):!1!==e}function uW(e,t){const n=jg(e.type);n||ku("Unrecognized transform type: "+zc(e.type));const r=Kq(n.type.toLowerCase(),null,cW(n,e,t));return e.signal&&t.addSignal(e.signal,t.proxy(r)),r.metadata=n.metadata||{},r}function cW(e,t,n){const r={},i=e.params.length;for(let a=0;a<i;++a){const i=e.params[a];r[i.name]=fW(i,t,n)}return r}function fW(e,t,n){const r=e.type,i=t[e.name];return"index"===r?function(e,t,n){Cc(t.from)||ku('Lookup "from" parameter must be a string literal.');return n.getData(t.from).lookupRef(n,t.key)}(0,t,n):void 0!==i?"param"===r?function(e,t,n){const r=t[e.name];return e.array?(Tu(r)||ku("Expected an array of sub-parameters. Instead: "+zc(r)),r.map((t=>hW(e,t,n)))):hW(e,r,n)}(e,t,n):"projection"===r?n.projectionRef(t[e.name]):e.array&&!oU(i)?i.map((t=>dW(e,t,n))):dW(e,i,n):void(e.required&&ku("Missing required "+zc(t.type)+" parameter: "+zc(e.name)))}function dW(e,t,n){const r=e.type;if(oU(t))return yW(r)?ku("Expression references can not be signals."):vW(r)?n.fieldRef(t):bW(r)?n.compareRef(t):n.signalRef(t.signal);{const i=e.expr||vW(r);return i&&pW(t)?n.exprRef(t.expr,t.as):i&&mW(t)?eU(t.field,t.as):yW(r)?lI(t,n):gW(r)?Zq(n.getData(t).values):vW(r)?eU(t):bW(r)?n.compareRef(t):t}}function hW(e,t,n){const r=e.params.length;let i;for(let n=0;n<r;++n){i=e.params[n];for(const e in i.key)if(i.key[e]!==t[e]){i=null;break}if(i)break}i||ku("Unsupported parameter: "+zc(t));const a=mc(cW(i,t,n),i.key);return Zq(n.add(PU(a)))}const pW=e=>e&&e.expr,mW=e=>e&&e.field,gW=e=>"data"===e,yW=e=>"expr"===e,vW=e=>"field"===e,bW=e=>"compare"===e;function xW(e,t){return e.$ref?e:e.data&&e.data.$ref?e.data:Zq(t.getData(e.data).output)}function wW(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function _W(e){return Cc(e)?e:null}function kW(e,t,n){const r=rU(n.op,n.field);let i;if(t.ops){for(let e=0,n=t.as.length;e<n;++e)if(t.as[e]===r)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((i=n.op.signal)?e.signalRef(i):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(r))}function OW(e,t,n,r,i,a,o){const s=t[n]||(t[n]={}),l=function(e){return Nu(e)?("descending"===e.order?"-":"+")+rU(e.op,e.field):""}(a);let u,c,f=_W(i);if(null!=f&&(e=t.scope,f+=l?"|"+l:"",u=s[f]),!u){const n=a?{field:tU,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:Zq(t.output)};l&&(n.sort=e.sortRef(a)),c=e.add(Kq(r,void 0,n)),o&&(t.index[i]=c),u=Zq(c),null!=f&&(s[f]=u)}return u}function SW(e,t,n){const r=e.remove,i=e.insert,a=e.toggle,o=e.modify,s=e.values,l=t.add(Qq()),u=lI("if("+e.trigger+',modify("'+n+'",'+[i,r,a,o,s].map((e=>null==e?"null":e)).join(",")+"),0)",t);l.update=u.$expr,l.params=u.$params}function $W(e,t){const n=oW(e),r=e.type===MV,i=e.from&&e.from.facet,a=e.overlap;let o,s,l,u,c,f,d,h=e.layout||n===Fq||n===jq;const p=n===Mq||h||i,m=function(e,t,n){let r,i,a,o,s;return e?(r=e.facet)&&(t||ku("Only group marks can be faceted."),null!=r.field?o=s=xW(r,n):(e.data?s=Zq(n.getData(e.data).aggregate):(a=uW(mc({type:"aggregate",groupby:ac(r.groupby)},r.aggregate),n),a.params.key=n.keyRef(r.groupby),a.params.pulse=xW(r,n),o=s=Zq(n.add(a))),i=n.keyRef(r.groupby,!0))):o=Zq(n.add(kU(null,[{}]))),o||(o=xW(e,n)),{key:i,pulse:o,parent:s}}(e.from,r,t);s=t.add(SU({key:m.key||(e.key?eU(e.key):void 0),pulse:m.pulse,clean:!r}));const g=Zq(s);s=l=t.add(kU({pulse:g})),s=t.add(FU({markdef:sW(e),interactive:lW(e.interactive,t),clip:iW(e.clip,t),context:{$context:!0},groups:t.lookup(),parent:t.signals.parent?t.signalRef("parent"):null,index:t.markpath(),pulse:Zq(s)}));const y=Zq(s);s=u=t.add($U(Vq(e.encode,e.type,n,e.style,t,{mod:!1,pulse:y}))),s.params.parent=t.encode(),e.transform&&e.transform.forEach((e=>{const n=uW(e,t),r=n.metadata;(r.generates||r.changes)&&ku("Mark transforms should not generate new data."),r.nomod||(u.params.mod=!0),n.params.pulse=Zq(s),t.add(s=n)})),e.sort&&(s=t.add(WU({sort:t.compareRef(e.sort),pulse:Zq(s)})));const v=Zq(s);(i||h)&&(h=t.add(HU({layout:t.objectProperty(e.layout),legends:t.legends,mark:y,pulse:v})),f=Zq(h));const b=t.add(_U({mark:y,pulse:f||v}));d=Zq(b),r&&(p&&(o=t.operators,o.pop(),h&&o.pop()),t.pushState(v,f||d,g),i?function(e,t,n){const r=e.from.facet,i=r.name,a=xW(r,t);let o;r.name||ku("Facet must have a name: "+zc(r)),r.data||ku("Facet must reference a data set: "+zc(r)),r.field?o=t.add(zU({field:t.fieldRef(r.field),pulse:a})):r.groupby?o=t.add(AU({key:t.keyRef(r.groupby),group:Zq(t.proxy(n.parent)),pulse:a})):ku("Facet must specify groupby or field: "+zc(r));const s=t.fork(),l=s.add(kU()),u=s.add(VU({pulse:Zq(l)}));s.addData(i,new wW(s,l,l,u)),s.addSignal("parent",null),o.params.subflow={$subflow:s.parse(e).toRuntime()}}(e,t,m):p?function(e,t,n){const r=t.add(zU({pulse:n.pulse})),i=t.fork();i.add(VU()),i.addSignal("parent",null),r.params.subflow={$subflow:i.parse(e).toRuntime()}}(e,t,m):t.parse(e),t.popState(),p&&(h&&o.push(h),o.push(b))),a&&(d=function(e,t,n){const r=e.method,i=e.bound,a=e.separation,o={separation:oU(a)?n.signalRef(a.signal):a,method:oU(r)?n.signalRef(r.signal):r,pulse:t};e.order&&(o.sort=n.compareRef({field:e.order}));if(i){const e=i.tolerance;o.boundTolerance=oU(e)?n.signalRef(e.signal):+e,o.boundScale=n.scaleRef(i.scale),o.boundOrient=i.orient}return Zq(n.add(RU(o)))}(a,d,t));const x=t.add(qU({pulse:d})),w=t.add(VU({pulse:Zq(x)},void 0,t.parent()));null!=e.name&&(c=e.name,t.addData(c,new wW(t,l,x,w)),e.on&&e.on.forEach((e=>{(e.insert||e.remove||e.toggle)&&ku("Marks only support modify triggers."),SW(e,t,c)})))}function EW(e,t){const n=t.config.legend,r=e.encode||{},i=RV(e,n),a=r.legend||{},o=a.name||void 0,s=a.interactive,l=a.style,u={};let c,f,d,h=0;EV.forEach((t=>e[t]?(u[t]=e[t],h=h||e[t]):0)),h||ku("Missing valid scale for legend.");const p=function(e,t){let n=e.type||kV;e.type||1!==function(e){return EV.reduce(((t,n)=>t+(e[n]?1:0)),0)}(e)||!e.fill&&!e.stroke||(n=Fk(t)?OV:Nk(t)?SV:kV);return n!==OV?n:Nk(t)?SV:OV}(e,t.scaleType(h)),m={title:null!=e.title,scales:u,type:p,vgrad:"symbol"!==p&&i.isVertical()},g=Zq(t.add(kU(null,[m]))),y=Zq(t.add(MU(f={type:p,scale:t.scaleRef(h),count:t.objectProperty(i("tickCount")),limit:t.property(i("symbolLimit")),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)})));return p===OV?(d=[qV(e,h,n,r.gradient),HV(e,n,r.labels,y)],f.count=f.count||t.signalRef("max(2,2*floor((".concat(uU(i.gradientLength()),")/100))"))):p===SV?d=[UV(e,h,n,r.gradient,y),HV(e,n,r.labels,y)]:(c=function(e,t){const n=RV(e,t);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:!0,column:!1},padding:{row:n("rowPadding"),column:n("columnPadding")}}}(e,n),d=[GV(e,n,r,y,uU(c.columns))],f.size=function(e,t,n){const r=uU(DW("size",e,n)),i=uU(DW("strokeWidth",e,n)),a=uU(function(e,t,n){return PV("fontSize",e)||function(e,t,n){const r=t.config.style[n];return r&&r[e]}("fontSize",t,n)}(n[1].encode,t,bV));return lI("max(ceil(sqrt(".concat(r,")+").concat(i,"),").concat(a,")"),t)}(e,t,d[0].marks)),d=[NV({role:"legend-entry",from:g,encode:{enter:{x:{value:0},y:{value:0}}},marks:d,layout:c,interactive:s})],m.title&&d.push(function(e,t,n,r){const i=RV(e,t),a={enter:{opacity:DV},update:{opacity:CV,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:DV}};return Aq(a,{orient:i("titleOrient"),_anchor:i("titleAnchor"),anchor:{signal:tW},angle:{signal:nW},align:{signal:eW},baseline:{signal:rW},text:e.title,fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),baseline:i("titleBaseline")}),IV({type:TV,role:"legend-title",style:xV,from:r,encode:a},n)}(e,n,r.title,g)),$W(NV({role:"legend",from:g,encode:Dq(AW(i,e,n),a,AV),marks:d,aria:i("aria"),description:i("description"),zindex:i("zindex"),name:o,interactive:s,style:l}),t)}function AW(e,t,n){const r={enter:{},update:{}};return Aq(r,{orient:e("orient"),offset:e("offset"),padding:e("padding"),titlePadding:e("titlePadding"),cornerRadius:e("cornerRadius"),fill:e("fillColor"),stroke:e("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:e("legendX"),y:e("legendY"),format:t.format,formatType:t.formatType}),r}function DW(e,t,n){return t[e]?'scale("'.concat(t[e],'",datum)'):PV(e,n[0].encode)}wW.fromEntries=function(e,t){const n=t.length,r=t[n-1],i=t[n-2];let a=t[0],o=null,s=1;for(a&&"load"===a.type&&(a=t[1]),e.add(t[0]);s<n;++s)t[s].params.pulse=Zq(t[s-1]),e.add(t[s]),"aggregate"===t[s].type&&(o=t[s]);return new wW(e,a,i,r,o)},wW.prototype={countsRef(e,t,n){const r=this,i=r.counts||(r.counts={}),a=_W(t);let o,s,l;return null!=a&&(e=r.scope,o=i[a]),o?n&&n.field&&kW(e,o.agg.params,n):(l={groupby:e.fieldRef(t,"key"),pulse:Zq(r.output)},n&&n.field&&kW(e,l,n),s=e.add(xU(l)),o=e.add(kU({pulse:Zq(s)})),o={agg:s,ref:Zq(o)},null!=a&&(i[a]=o)),o.ref},tuplesRef(){return Zq(this.values)},extentRef(e,t){return OW(e,this,"extent","extent",t,!1)},domainRef(e,t){return OW(e,this,"domain","values",t,!1)},valuesRef(e,t,n){return OW(e,this,"vals","values",t,n||!0)},lookupRef(e,t){return OW(e,this,"lookup","tupleindex",t,!1)},indataRef(e,t){return OW(e,this,"indata","tupleindex",t,!0,!0)}};const CW='item.orient==="'.concat(fV,'"?-90:item.orient==="').concat(dV,'"?90:0');function MW(e,t){const n=RV(e=Cc(e)?{text:e}:e,t.config.title),r=e.encode||{},i=r.group||{},a=i.name||void 0,o=i.interactive,s=i.style,l=[],u=Zq(t.add(kU(null,[{}])));return l.push(function(e,t,n,r){const i={value:0},a=e.text,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Aq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("color"),font:t("font"),fontSize:t("fontSize"),fontStyle:t("fontStyle"),fontWeight:t("fontWeight"),lineHeight:t("lineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),IV({type:TV,role:Nq,style:wV,from:r,encode:o},n)}(e,n,function(e){const t=e.encode;return t&&t.title||mc({name:e.name,interactive:e.interactive,style:e.style},t)}(e),u)),e.subtitle&&l.push(function(e,t,n,r){const i={value:0},a=e.subtitle,o={enter:{opacity:i},update:{opacity:{value:1}},exit:{opacity:i}};return Aq(o,{text:a,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:t("dx"),dy:t("dy"),fill:t("subtitleColor"),font:t("subtitleFont"),fontSize:t("subtitleFontSize"),fontStyle:t("subtitleFontStyle"),fontWeight:t("subtitleFontWeight"),lineHeight:t("subtitleLineHeight")},{align:t("align"),angle:t("angle"),baseline:t("baseline")}),IV({type:TV,role:Rq,style:_V,from:r,encode:o},n)}(e,n,r.subtitle,u)),$W(NV({role:"title",from:u,encode:jW(n,i),marks:l,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:a,interactive:o,style:s}),t)}function jW(e,t){const n={enter:{},update:{}};return Aq(n,{orient:e("orient"),anchor:e("anchor"),align:{signal:BV},angle:{signal:CW},limit:e("limit"),frame:e("frame"),offset:e("offset")||0,padding:e("subtitlePadding")}),Dq(n,t,AV)}function FW(e,t){const n=[];e.transform&&e.transform.forEach((e=>{n.push(uW(e,t))})),e.on&&e.on.forEach((n=>{SW(n,t,e.name)})),t.addDataPipeline(e.name,function(e,t,n){const r=[];let i,a,o,s,l,u=null,c=!1,f=!1;e.values?sU(e.values)||sU(e.format)?(r.push(NW(t,e)),r.push(u=TW())):r.push(u=TW({$ingest:e.values,$format:e.format})):e.url?sU(e.url)||sU(e.format)?(r.push(NW(t,e)),r.push(u=TW())):r.push(u=TW({$request:e.url,$format:e.format})):e.source&&(u=i=ac(e.source).map((e=>Zq(t.getData(e).output))),r.push(null));for(a=0,o=n.length;a<o;++a)s=n[a],l=s.metadata,u||l.source||r.push(u=TW()),r.push(s),l.generates&&(f=!0),l.modifies&&!f&&(c=!0),l.source?u=s:l.changes&&(u=null);i&&(o=i.length-1,r[0]=IU({derive:c,pulse:o?i:i[0]}),(c||o)&&r.splice(1,0,TW()));u||r.push(TW());return r.push(VU({})),r}(e,t,n))}function TW(e){const t=kU({},e);return t.metadata={source:!0},t}function NW(e,t){return jU({url:t.url?e.property(t.url):void 0,async:t.async?e.property(t.async):void 0,values:t.values?e.property(t.values):void 0,format:e.objectProperty(t.format)})}const RW=e=>e===hV||e===cV,PW=(e,t,n)=>oU(e)?UW(e.signal,t,n):e===fV||e===cV?t:n,zW=(e,t,n)=>oU(e)?IW(e.signal,t,n):RW(e)?t:n,BW=(e,t,n)=>oU(e)?qW(e.signal,t,n):RW(e)?n:t,LW=(e,t,n)=>oU(e)?VW(e.signal,t,n):e===cV?{value:t}:{value:n},IW=(e,t,n)=>HW("".concat(e," === '").concat(cV,"' || ").concat(e," === '").concat(hV,"'"),t,n),qW=(e,t,n)=>HW("".concat(e," !== '").concat(cV,"' && ").concat(e," !== '").concat(hV,"'"),t,n),UW=(e,t,n)=>XW("".concat(e," === '").concat(fV,"' || ").concat(e," === '").concat(cV,"'"),t,n),VW=(e,t,n)=>XW("".concat(e," === '").concat(cV,"'"),t,n),WW=(e,t,n)=>XW("".concat(e," === '").concat(dV,"'"),t,n),HW=(e,t,n)=>(t=null!=t?$q(t):t,n=null!=n?$q(n):n,GW(t)&&GW(n)?(t=t?t.signal||zc(t.value):null,n=n?n.signal||zc(n.value):null,{signal:"".concat(e," ? (").concat(t,") : (").concat(n,")")}):[mc({test:e},t)].concat(n||[])),GW=e=>null==e||1===Object.keys(e).length,XW=(e,t,n)=>({signal:"".concat(e," ? (").concat(JW(t),") : (").concat(JW(n),")")}),YW=(e,t,n,r,i)=>({signal:(null!=r?"".concat(e," === '").concat(fV,"' ? (").concat(JW(r),") : "):"")+(null!=n?"".concat(e," === '").concat(hV,"' ? (").concat(JW(n),") : "):"")+(null!=i?"".concat(e," === '").concat(dV,"' ? (").concat(JW(i),") : "):"")+(null!=t?"".concat(e," === '").concat(cV,"' ? (").concat(JW(t),") : "):"")+"(null)"}),JW=e=>oU(e)?e.signal:null==e?null:zc(e),KW=(e,t)=>{const n=e.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+t.signal}:e};function QW(e,t,n,r){let i;if(t&&bc(t,e))return t[e];if(bc(n,e))return n[e];if(e.startsWith("title")){switch(e){case"titleColor":i="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":i=e[5].toLowerCase()+e.slice(6)}return r["guide-title"][i]}if(e.startsWith("label")){switch(e){case"labelColor":i="fill";break;case"labelFont":case"labelFontSize":i=e[5].toLowerCase()+e.slice(6)}return r["guide-label"][i]}return null}function ZW(e){const t={};for(const n of e)if(n)for(const e in n)t[e]=1;return Object.keys(t)}function eH(e,t){return{scale:e.scale,range:t}}function tH(e,t,n,r,i){const a=RV(e,t),o=e.orient,s=e.gridScale,l=PW(o,1,-1),u=function(e,t){if(1===t);else if(Nu(e)){let n=e=mc({},e);for(;null!=n.mult;){if(!Nu(n.mult))return n.mult=oU(t)?{signal:"(".concat(n.mult,") * (").concat(t.signal,")")}:n.mult*t,e;n=n.mult=mc({},n.mult)}n.mult=t}else e=oU(t)?{signal:"(".concat(t.signal,") * (").concat(e||0,")")}:t*(e||0);return e}(e.offset,l);let c,f,d;const h={enter:c={opacity:DV},update:d={opacity:CV},exit:f={opacity:DV}};Aq(h,{stroke:a("gridColor"),strokeCap:a("gridCap"),strokeDash:a("gridDash"),strokeDashOffset:a("gridDashOffset"),strokeOpacity:a("gridOpacity"),strokeWidth:a("gridWidth")});const p={scale:e.scale,field:vV,band:i.band,extra:i.extra,offset:i.offset,round:a("tickRound")},m=zW(o,{signal:"height"},{signal:"width"}),g=s?{scale:s,range:0,mult:l,offset:u}:{value:0,offset:u},y=s?{scale:s,range:1,mult:l,offset:u}:mc(m,{mult:l,offset:u});return c.x=d.x=zW(o,p,g),c.y=d.y=BW(o,p,g),c.x2=d.x2=BW(o,y),c.y2=d.y2=zW(o,y),f.x=zW(o,p),f.y=BW(o,p),IV({type:FV,role:"axis-grid",key:vV,from:r,encode:h},n)}function nH(e,t,n,r,i){return{signal:'flush(range("'+e+'"), scale("'+e+'", datum.value), '+t+","+n+","+r+","+i+")"}}function rH(e,t,n,r,i,a){const o=RV(e,t),s=e.orient,l=e.scale,u=PW(s,-1,1),c=uU(o("labelFlush")),f=uU(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p,m=0===c||!!c;const g=$q(i);g.mult=u,g.offset=$q(o("labelPadding")||0),g.offset.mult=u;const y={scale:l,field:vV,band:.5,offset:LV(a.offset,o("labelOffset"))},v=zW(s,m?nH(l,c,'"left"','"right"','"center"'):{value:"center"},((e,t,n)=>oU(e)?WW(e.signal,t,n):e===dV?{value:t}:{value:n})(s,"left","right")),b=zW(s,LW(s,"bottom","top"),m?nH(l,c,'"top"','"bottom"','"middle"'):{value:"middle"}),x=nH(l,c,"-(".concat(f,")"),f,0);m=m&&f;const w={opacity:DV,x:zW(s,y,g),y:BW(s,y,g)},_={enter:w,update:p={opacity:CV,text:{field:gV},x:w.x,y:w.y,align:v,baseline:b},exit:{opacity:DV,x:w.x,y:w.y}};Aq(_,{dx:!d&&m?zW(s,x):null,dy:!h&&m?BW(s,x):null}),Aq(_,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const k=o("labelBound");let O=o("labelOverlap");return O=O||k?{separation:o("labelSeparation"),method:O,order:"datum.index",bound:k?{scale:l,orient:s,tolerance:k}:null}:void 0,p.align!==v&&(p.align=KW(p.align,v)),p.baseline!==b&&(p.baseline=KW(p.baseline,b)),IV({type:TV,role:"axis-label",style:bV,key:vV,from:r,encode:_,overlap:O},n)}function iH(e,t,n,r){const i=RV(e,t),a=e.orient,o=PW(a,-1,1);let s,l;const u={enter:s={opacity:DV,anchor:$q(i("titleAnchor",null)),align:{signal:BV}},update:l=mc({},s,{opacity:CV,text:$q(e.title)}),exit:{opacity:DV}},c={signal:'lerp(range("'.concat(e.scale,'"), ').concat(zV(0,1,.5),")")};return l.x=zW(a,c),l.y=BW(a,c),s.angle=zW(a,DV,((e,t)=>0===t?0:oU(e)?{signal:"(".concat(e.signal,") * ").concat(t)}:{value:e*t})(o,90)),s.baseline=zW(a,LW(a,hV,cV),{value:hV}),l.angle=s.angle,l.baseline=s.baseline,Aq(u,{fill:i("titleColor"),fillOpacity:i("titleOpacity"),font:i("titleFont"),fontSize:i("titleFontSize"),fontStyle:i("titleFontStyle"),fontWeight:i("titleFontWeight"),limit:i("titleLimit"),lineHeight:i("titleLineHeight")},{align:i("titleAlign"),angle:i("titleAngle"),baseline:i("titleBaseline")}),function(e,t,n,r){const i=(e,t)=>null!=e?(n.update[t]=KW($q(e),n.update[t]),!1):!Cq(t,r),a=i(e("titleX"),"x"),o=i(e("titleY"),"y");n.enter.auto=o===a?$q(o):zW(t,$q(o),$q(a))}(i,a,u,n),u.update.align=KW(u.update.align,s.align),u.update.angle=KW(u.update.angle,s.angle),u.update.baseline=KW(u.update.baseline,s.baseline),IV({type:TV,role:"axis-title",style:xV,from:r,encode:u},n)}function aH(e,t){const n=function(e,t){var n,r,i,a=t.config,o=a.style,s=a.axis,l="band"===t.scaleType(e.scale)&&a.axisBand,u=e.orient;if(oU(u)){const e=ZW([a.axisX,a.axisY]),t=ZW([a.axisTop,a.axisBottom,a.axisLeft,a.axisRight]);for(i of(n={},e))n[i]=zW(u,QW(i,a.axisX,s,o),QW(i,a.axisY,s,o));for(i of(r={},t))r[i]=YW(u.signal,QW(i,a.axisTop,s,o),QW(i,a.axisBottom,s,o),QW(i,a.axisLeft,s,o),QW(i,a.axisRight,s,o))}else n=u===cV||u===hV?a.axisX:a.axisY,r=a["axis"+u[0].toUpperCase()+u.slice(1)];return n||r||l?mc({},s,n,r,l):s}(e,t),r=e.encode||{},i=r.axis||{},a=i.name||void 0,o=i.interactive,s=i.style,l=RV(e,n),u=function(e){const t=e("tickBand");let n,r,i=e("tickOffset");return t?t.signal?(n={signal:"(".concat(t.signal,") === 'extent' ? 1 : 0.5")},r={signal:"(".concat(t.signal,") === 'extent'")},Nu(i)||(i={signal:"(".concat(t.signal,") === 'extent' ? 0 : ").concat(i)})):"extent"===t?(n=1,r=!0,i=0):(n=.5,r=!1):(n=e("bandPosition"),r=e("tickExtra")),{extra:r,band:n,offset:i}}(l),c={scale:e.scale,ticks:!!l("ticks"),labels:!!l("labels"),grid:!!l("grid"),domain:!!l("domain"),title:null!=e.title},f=Zq(t.add(kU({},[c]))),d=Zq(t.add(wU({scale:t.scaleRef(e.scale),extra:t.property(u.extra),count:t.objectProperty(e.tickCount),values:t.objectProperty(e.values),minstep:t.property(e.tickMinStep),formatType:t.property(e.formatType),formatSpecifier:t.property(e.format)}))),h=[];let p;return c.grid&&h.push(tH(e,n,r.grid,d,u)),c.ticks&&(p=l("tickSize"),h.push(function(e,t,n,r,i,a){const o=RV(e,t),s=e.orient,l=PW(s,-1,1);let u,c,f;const d={enter:u={opacity:DV},update:f={opacity:CV},exit:c={opacity:DV}};Aq(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=$q(i);h.mult=l;const p={scale:e.scale,field:vV,band:a.band,extra:a.extra,offset:a.offset,round:o("tickRound")};return f.y=u.y=zW(s,DV,p),f.y2=u.y2=zW(s,h),c.x=zW(s,p),f.x=u.x=BW(s,DV,p),f.x2=u.x2=BW(s,h),c.y=BW(s,p),IV({type:FV,role:"axis-tick",key:vV,from:r,encode:d},n)}(e,n,r.ticks,d,p,u))),c.labels&&(p=c.ticks?p:0,h.push(rH(e,n,r.labels,d,p,u))),c.domain&&h.push(function(e,t,n,r){const i=RV(e,t),a=e.orient;let o,s;const l={enter:o={opacity:DV},update:s={opacity:CV},exit:{opacity:DV}};Aq(l,{stroke:i("domainColor"),strokeCap:i("domainCap"),strokeDash:i("domainDash"),strokeDashOffset:i("domainDashOffset"),strokeWidth:i("domainWidth"),strokeOpacity:i("domainOpacity")});const u=eH(e,0),c=eH(e,1);return o.x=s.x=zW(a,u,DV),o.x2=s.x2=zW(a,c),o.y=s.y=BW(a,u,DV),o.y2=s.y2=BW(a,c),IV({type:FV,role:"axis-domain",from:r,encode:l},n)}(e,n,r.domain,f)),c.title&&h.push(iH(e,n,r.title,f)),$W(NV({role:"axis",from:f,encode:Dq(oH(l,e),i,AV),marks:h,aria:l("aria"),description:l("description"),zindex:l("zindex"),name:a,interactive:o,style:s}),t)}function oH(e,t){const n={enter:{},update:{}};return Aq(n,{orient:e("orient"),offset:e("offset")||0,position:lU(t.position,0),titlePadding:e("titlePadding"),minExtent:e("minExtent"),maxExtent:e("maxExtent"),range:{signal:'abs(span(range("'.concat(t.scale,'")))')},translate:e("translate"),format:t.format,formatType:t.formatType}),n}function sH(e,t,n){const r=ac(e.signals),i=ac(e.scales);return n||r.forEach((e=>Yq(e,t))),ac(e.projections).forEach((e=>function(e,t){const n=t.config.projection||{},r={};for(const n in e)"name"!==n&&(r[n]=uV(e[n],n,t));for(const e in n)null==r[e]&&(r[e]=uV(n[e],e,t));t.addProjection(e.name,r)}(e,t))),i.forEach((e=>function(e,t){const n=e.type||"linear";Mk(n)||ku("Unrecognized scale type: "+zc(n)),t.addScale(e.name,{type:n,domain:void 0})}(e,t))),ac(e.data).forEach((e=>FW(e,t))),i.forEach((e=>JU(e,t))),(n||r).forEach((e=>function(e,t){const n=t.getSignal(e.name);let r=e.update;e.init&&(r?ku("Signals can not include both init and update expressions."):(r=e.init,n.initonly=!0)),r&&(r=lI(r,t),n.update=r.$expr,n.params=r.$params),e.on&&e.on.forEach((e=>yU(e,t,n.id)))}(e,t))),ac(e.axes).forEach((e=>aH(e,t))),ac(e.marks).forEach((e=>$W(e,t))),ac(e.legends).forEach((e=>EW(e,t))),e.title&&MW(e.title,t),t.parseLambdas(),t}function lH(e,t){const n=t.config,r=Zq(t.root=t.add(Qq())),i=function(e,t){const n=n=>lU(e[n],t[n]),r=[uH("background",n("background")),uH("autosize",kq(n("autosize"))),uH("padding",Sq(n("padding"))),uH("width",n("width")||0),uH("height",n("height")||0)],i=r.reduce(((e,t)=>(e[t.name]=t,e)),{}),a={};return ac(e.signals).forEach((e=>{bc(i,e.name)?e=mc(i[e.name],e):r.push(e),a[e.name]=e})),ac(t.signals).forEach((e=>{bc(a,e.name)||bc(i,e.name)||r.push(e)})),r}(e,n);i.forEach((e=>Yq(e,t))),t.description=e.description||n.description,t.eventConfig=n.events,t.legends=t.objectProperty(n.legend&&n.legend.layout),t.locale=n.locale;const a=t.add(kU()),o=t.add($U(Vq((e=>Dq({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e))(e.encode),MV,jq,e.style,t,{pulse:Zq(a)}))),s=t.add(HU({layout:t.objectProperty(e.layout),legends:t.legends,autosize:t.signalRef("autosize"),mark:r,pulse:Zq(o)}));t.operators.pop(),t.pushState(Zq(o),Zq(s),null),sH(e,t,i),t.operators.push(s);let l=t.add(_U({mark:r,pulse:Zq(s)}));return l=t.add(qU({pulse:Zq(l)})),l=t.add(VU({pulse:Zq(l)})),t.addData("root",new wW(t,a,a,l)),t}function uH(e,t){return t&&t.signal?{name:e,update:t.signal}:{name:e,value:t}}function cH(e,t){this.config=e||{},this.options=t||{},this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.eventConfig=null,this.locale=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function fH(e){this.config=e.config,this.options=e.options,this.legends=e.legends,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function dH(e){return(Tu(e)?hH:pH)(e)}function hH(e){const t=e.length;let n="[";for(let r=0;r<t;++r){const t=e[r];n+=(r>0?",":"")+(Nu(t)?t.signal||dH(t):zc(t))}return n+"]"}function pH(e){let t,n,r="{",i=0;for(t in e)n=e[t],r+=(++i>1?",":"")+zc(t)+":"+(Nu(n)?n.signal||dH(n):zc(n));return r+"}"}cH.prototype=fH.prototype={parse(e){return sH(e,this)},fork(){return new fH(this)},isSubscope(){return this._subid>0},toRuntime(){return this.finish(),{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach((t=>{t.$ref=e.id})),e.refs=null),e},proxy(e){const t=e instanceof Jq?Zq(e):e;return this.add(LU({value:t}))},addStream(e){return this.streams.push(e),e.id=this.id(),e},addUpdate(e){return this.updates.push(e),e},finish(){let e,t;for(e in this.root&&(this.root.root=!0),this.signals)this.signals[e].signal=e;for(e in this.scales)this.scales[e].scale=e;function n(e,t,n){let r,i;e&&(r=e.data||(e.data={}),i=r[t]||(r[t]=[]),i.push(n))}for(e in this.data){t=this.data[e],n(t.input,e,"input"),n(t.output,e,"output"),n(t.values,e,"values");for(const r in t.index)n(t.index[r],e,"index:"+r)}return this},pushState(e,t,n){this._encode.push(Zq(this.add(VU({pulse:e})))),this._parent.push(t),this._lookup.push(n?Zq(this.proxy(n)):null),this._markpath.push(-1)},popState(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},parent(){return Lu(this._parent)},encode(){return Lu(this._encode)},lookup(){return Lu(this._lookup)},markpath(){const e=this._markpath;return++e[e.length-1]},fieldRef(e,t){if(Cc(e))return eU(e,t);e.signal||ku("Unsupported field reference: "+zc(e));const n=e.signal;let r=this.field[n];if(!r){const e={name:this.signalRef(n)};t&&(e.as=t),this.field[n]=r=Zq(this.add(DU(e)))}return r},compareRef(e){let t=!1;const n=e=>oU(e)?(t=!0,this.signalRef(e.signal)):function(e){return e&&e.expr}(e)?(t=!0,this.exprRef(e.expr)):e,r=ac(e.field).map(n),i=ac(e.order).map(n);return t?Zq(this.add(OU({fields:r,orders:i}))):nU(r,i)},keyRef(e,t){let n=!1;const r=this.signals;return e=ac(e).map((e=>oU(e)?(n=!0,Zq(r[e.signal])):e)),n?Zq(this.add(CU({fields:e,flat:t}))):function(e,t){const n={$key:e};return t&&(n.$flat=!0),n}(e,t)},sortRef(e){if(!e)return e;const t=rU(e.op,e.field),n=e.order||"ascending";return n.signal?Zq(this.add(OU({fields:t,orders:this.signalRef(n.signal)}))):nU(t,n)},event(e,t){const n=e+":"+t;if(!this.events[n]){const r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},hasOwnSignal(e){return bc(this.signals,e)},addSignal(e,t){this.hasOwnSignal(e)&&ku("Duplicate signal name: "+zc(e));const n=t instanceof Jq?t:this.add(Qq(t));return this.signals[e]=n},getSignal(e){return this.signals[e]||ku("Unrecognized signal name: "+zc(e)),this.signals[e]},signalRef(e){return this.signals[e]?Zq(this.signals[e]):(bc(this.lambdas,e)||(this.lambdas[e]=this.add(Qq(null))),Zq(this.lambdas[e]))},parseLambdas(){const e=Object.keys(this.lambdas);for(let t=0,n=e.length;t<n;++t){const n=e[t],r=lI(n,this),i=this.lambdas[n];i.params=r.$params,i.update=r.$expr}},property(e){return e&&e.signal?this.signalRef(e.signal):e},objectProperty(e){return e&&Nu(e)?this.signalRef(e.signal||dH(e)):e},exprRef(e,t){const n={expr:lI(e,this)};return t&&(n.expr.$name=t),Zq(this.add(EU(n)))},addBinding(e,t){this.bindings||ku("Nested signals do not support binding: "+zc(e)),this.bindings.push(mc({signal:e},t))},addScaleProj(e,t){bc(this.scales,e)&&ku("Duplicate scale or projection name: "+zc(e)),this.scales[e]=this.add(t)},addScale(e,t){this.addScaleProj(e,UU(t))},addProjection(e,t){this.addScaleProj(e,BU(t))},getScale(e){return this.scales[e]||ku("Unrecognized scale name: "+zc(e)),this.scales[e]},scaleRef(e){return Zq(this.getScale(e))},scaleType(e){return this.getScale(e).params.type},projectionRef(e){return this.scaleRef(e)},projectionType(e){return this.scaleType(e)},addData(e,t){return bc(this.data,e)&&ku("Duplicate data set name: "+zc(e)),this.data[e]=t},getData(e){return this.data[e]||ku("Undefined data set name: "+zc(e)),this.data[e]},addDataPipeline(e,t){return bc(this.data,e)&&ku("Duplicate data set name: "+zc(e)),this.addData(e,wW.fromEntries(this,t))}};mc(Mg,Kv,nC,FC,xN,bR,ez,FP,az,Mz,Wz,eB);var mH=Object.freeze({__proto__:null,version:"5.17.1",Dataflow:Ag,EventStream:hg,MultiPulse:kg,Operator:cg,Parameters:sg,Pulse:bg,Transform:Cg,changeset:ag,definition:jg,ingest:Zm,isTuple:Jm,transform:Fg,transforms:Mg,tupleid:Km,interpolate:Vk,interpolateColors:Ik,interpolateRange:Lk,quantizeInterpolator:qk,scale:Ck,scheme:Xk,projection:qT,View:lq,defaultLocale:Um,formatLocale:Nm,locale:qm,resetDefaultLocale:function(){return Fm(),zm(),Um()},timeFormatLocale:Lm,expressionFunction:sI,parse:function(e,t,n){return Nu(e)||ku("Input Vega specification must be an object."),lH(e,new cH(t=Pu(function(){const e="sans-serif",t="#4c78a8",n="#000",r="#888",i="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:t},area:{fill:t},image:null,line:{stroke:t,strokeWidth:2},path:{stroke:t},rect:{fill:t},rule:{stroke:n},shape:{stroke:t},symbol:{fill:t,size:64},text:{fill:n,font:e,fontSize:11},trail:{fill:t,size:2},style:{"guide-label":{fill:n,font:e,fontSize:10},"guide-title":{fill:n,font:e,fontSize:11,fontWeight:"bold"},"group-title":{fill:n,font:e,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:n,font:e,fontSize:12},point:{size:30,strokeWidth:2,shape:"circle"},circle:{size:30,strokeWidth:2},square:{size:30,strokeWidth:2,shape:"square"},cell:{fill:"transparent",stroke:i}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:r,grid:!1,gridWidth:1,gridColor:i,labels:!0,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:!0,tickColor:r,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:i,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:!0,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:r,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}(),t,e.config),n)).toRuntime()},runtimeContext:yI,Debug:4,Error:1,Info:3,None:0,Warn:2,accessor:yu,accessorFields:bu,accessorName:vu,array:ac,ascending:uc,clampRange:oc,compare:lc,constant:hc,debounce:pc,error:ku,extend:mc,extent:gc,extentIndex:yc,falsy:Mu,fastmap:wc,field:Su,flush:_c,hasOwnProperty:bc,id:$u,identity:Eu,inherits:kc,inrange:Oc,isArray:Tu,isBoolean:Sc,isDate:$c,isFunction:sc,isIterable:Ec,isNumber:Ac,isObject:Nu,isRegExp:Dc,isString:Cc,key:Mc,lerp:jc,logger:Fu,lruCache:Fc,merge:Tc,mergeConfig:Pu,one:Du,pad:Rc,panLinear:Xu,panLog:Yu,panPow:Ju,panSymlog:Ku,peek:Lu,quarter:rc,repeat:Nc,span:Pc,splitAccessPath:Ou,stringValue:zc,toBoolean:Bc,toDate:Ic,toNumber:Iu,toSet:Uc,toString:qc,truncate:Vc,truthy:Cu,utcquarter:ic,visitArray:Wc,writeConfig:zu,zero:Au,zoomLinear:Zu,zoomLog:ec,zoomPow:tc,zoomSymlog:nc,bandwidthNRD:Pg,bin:zg,bootstrapCI:Lg,cumulativeLogNormal:Zg,cumulativeNormal:Gg,cumulativeUniform:ay,densityLogNormal:Qg,densityNormal:Hg,densityUniform:iy,dotbin:Ig,quantileLogNormal:ey,quantileNormal:Xg,quantileUniform:oy,quantiles:Ng,quartiles:Rg,get random(){return Bg},randomInteger:function(e,t){let n,r,i;null==t&&(t=e,e=0);const a={min(e){return arguments.length?(n=e||0,i=r-n,a):n},max(e){return arguments.length?(r=e||0,i=r-n,a):r},sample:()=>n+Math.floor(i*Bg()),pdf:e=>e===Math.floor(e)&&e>=n&&e<r?1/i:0,cdf(e){const t=Math.floor(e);return t<n?0:t>=r?1:(t-n+1)/i},icdf:e=>e>=0&&e<=1?n-1+Math.floor(e*i):NaN};return a.min(e).max(t)},randomKDE:Jg,randomLCG:function(e){return function(){return(e=(1103515245*e+12345)%2147483647)/2147483647}},randomLogNormal:ty,randomMixture:ny,randomNormal:Yg,randomUniform:sy,regressionExp:py,regressionLinear:dy,regressionLoess:by,regressionLog:hy,regressionPoly:yy,regressionPow:my,regressionQuad:gy,sampleCurve:ky,sampleLogNormal:Kg,sampleNormal:Wg,sampleUniform:ry,setRandom:function(e){Bg=e},DATE:Qd,DAY:Zd,DAYOFYEAR:eh,HOURS:th,MILLISECONDS:ih,MINUTES:nh,MONTH:Jd,QUARTER:Yd,SECONDS:rh,TIME_UNITS:ah,WEEK:Kd,YEAR:Xd,dayofyear:dh,timeBin:np,timeFloor:Ah,timeInterval:Th,timeOffset:Ph,timeSequence:Lh,timeUnitSpecifier:uh,timeUnits:sh,utcFloor:Mh,utcInterval:Nh,utcOffset:zh,utcSequence:Ih,utcdayofyear:vh,utcweek:bh,week:hh,read:Vm,inferType:lf,inferTypes:uf,typeParsers:af,format:Cf,formats:Mf,responseType:jf,loader:Wm,Bounds:hS,CanvasHandler:qE,CanvasRenderer:GE,Gradient:xO,GroupItem:mS,Handler:OE,Item:pS,Marks:lE,RenderType:NA,Renderer:$E,ResourceLoader:gS,SVGHandler:YE,SVGRenderer:vA,SVGStringRenderer:jA,Scenegraph:gE,boundClip:UA,boundContext:PS,boundItem:uE,boundMark:fE,boundStroke:bS,domChild:xE,domClear:wE,domCreate:vE,domFind:bE,font:nE,fontFamily:tE,fontSize:J$,intersect:zA,intersectBoxLine:XS,intersectPath:VS,intersectPoint:WS,intersectRule:GS,lineHeight:K$,markup:dA,multiLineOffset:Z$,pathCurves:_O,pathEqual:WA,pathParse:SO,pathRectangle:YO,pathRender:RO,pathSymbols:LO,pathTrail:JO,point:kE,renderModule:PA,resetSVGClipId:fS,resetSVGDefIds:function(){fS(),mO=0},sceneEqual:VA,sceneFromJSON:pE,scenePickVisit:a$,sceneToJSON:hE,sceneVisit:i$,sceneZOrder:r$,serializeXML:hA,textMetrics:V$});Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var gH=ds((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(a,s,l,u,c){"object"==typeof s&&(l=s.depth,u=s.prototype,c=s.includeNonEnumerable,s=s.circular);var f=[],d=[],h="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===l&&(l=1/0),function a(l,p){if(null===l)return null;if(0===p)return l;var m,g;if("object"!=typeof l)return l;if(e(l,t))m=new t;else if(e(l,n))m=new n;else if(e(l,r))m=new r((function(e,t){l.then((function(t){e(a(t,p-1))}),(function(e){t(a(e,p-1))}))}));else if(i.__isArray(l))m=[];else if(i.__isRegExp(l))m=new RegExp(l.source,o(l)),l.lastIndex&&(m.lastIndex=l.lastIndex);else if(i.__isDate(l))m=new Date(l.getTime());else{if(h&&Buffer.isBuffer(l))return m=Buffer.allocUnsafe?Buffer.allocUnsafe(l.length):new Buffer(l.length),l.copy(m),m;e(l,Error)?m=Object.create(l):void 0===u?(g=Object.getPrototypeOf(l),m=Object.create(g)):(m=Object.create(u),g=u)}if(s){var y=f.indexOf(l);if(-1!=y)return d[y];f.push(l),d.push(m)}for(var v in e(l,t)&&l.forEach((function(e,t){var n=a(t,p-1),r=a(e,p-1);m.set(n,r)})),e(l,n)&&l.forEach((function(e){var t=a(e,p-1);m.add(t)})),l){var b;g&&(b=Object.getOwnPropertyDescriptor(g,v)),b&&null==b.set||(m[v]=a(l[v],p-1))}if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(l);for(v=0;v<x.length;v++){var w=x[v];(!(k=Object.getOwnPropertyDescriptor(l,w))||k.enumerable||c)&&(m[w]=a(l[w],p-1),k.enumerable||Object.defineProperty(m,w,{enumerable:!1}))}}if(c){var _=Object.getOwnPropertyNames(l);for(v=0;v<_.length;v++){var k,O=_[v];(k=Object.getOwnPropertyDescriptor(l,O))&&k.enumerable||(m[O]=a(l[O],p-1),Object.defineProperty(m,O,{enumerable:!1}))}}return m}(a,l)}function a(e){return Object.prototype.toString.call(e)}function o(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=a,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===a(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===a(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===a(e)},i.__getRegExpFlags=o,i}();e.exports&&(e.exports=t)})),yH=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},a={key:r,value:e[r]};return n(i,a)}}),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,o;if(Array.isArray(t)){for(o="[",n=0;n<t.length;n++)n&&(o+=","),o+=e(t[n])||"null";return o+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=a.push(t)-1,l=Object.keys(t).sort(i&&i(t));for(o="",n=0;n<l.length;n++){var u=l[n],c=e(t[u]);c&&(o&&(o+=","),o+=JSON.stringify(u)+":"+c)}return a.splice(s,1),"{"+o+"}"}}(e)};function vH(e){return!!e.or}function bH(e){return!!e.and}function xH(e){return!!e.not}function wH(e,t){if(xH(e))wH(e.not,t);else if(bH(e))for(const n of e.and)wH(n,t);else if(vH(e))for(const n of e.or)wH(n,t);else t(e)}function _H(e,t){return xH(e)?{not:_H(e.not,t)}:bH(e)?{and:e.and.map((e=>_H(e,t)))}:vH(e)?{or:e.or.map((e=>_H(e,t)))}:t(e)}const kH=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,a;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(i=r;0!=i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(a=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(i=r;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,a[i]))return!1;for(i=r;0!=i--;){var o=a[i];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n},OH=gH;function SH(e,t){const n={};for(const r of t)bc(e,r)&&(n[r]=e[r]);return n}function $H(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>yH(e))).join(",")})`};const EH=yH;function AH(e){if(Ac(e))return e;const t=Cc(e)?e:yH(e);if(t.length<250)return t;let n=0;for(let e=0;e<t.length;e++){n=(n<<5)-n+t.charCodeAt(e),n&=n}return n}function DH(e){return!1===e||null===e}function CH(e,t){return e.indexOf(t)>-1}function MH(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}function jH(e,t){let n=0;for(const[r,i]of e.entries())if(!t(i,r,n++))return!1;return!0}function FH(e,...t){for(const n of t)TH(e,null!=n?n:{});return e}function TH(e,t){for(const n of IH(t))zu(e,n,t[n],!0)}function NH(e,t){const n=[],r={};let i;for(const a of e)i=t(a),i in r||(r[i]=1,n.push(a));return n}function RH(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function PH(e,t){for(const n of e)if(t.has(n))return!0;return!1}function zH(e){const t=new Set;for(const n of e){const e=Ou(n).map(((e,t)=>0===t?e:`[${e}]`)),r=e.map(((t,n)=>e.slice(0,n+1).join("")));for(const e of r)t.add(e)}return t}function BH(e,t){return void 0===e||void 0===t||PH(zH(e),zH(t))}function LH(e){return 0===IH(e).length}const IH=Object.keys,qH=Object.values,UH=Object.entries;function VH(e){return!0===e||!1===e}function WH(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function HH(e,t){return xH(e)?"!("+HH(e.not,t)+")":bH(e)?"("+e.and.map((e=>HH(e,t))).join(") && (")+")":vH(e)?"("+e.or.map((e=>HH(e,t))).join(") || (")+")":t(e)}function GH(e,t){if(0===t.length)return!0;const n=t.shift();return n in e&&GH(e[n],t)&&delete e[n],LH(e)}function XH(e){return e.charAt(0).toUpperCase()+e.substr(1)}function YH(e,t="datum"){const n=Ou(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(zc).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}function JH(e,t="datum"){return`${t}[${zc(Ou(e).join("."))}]`}function KH(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function QH(e){return`${Ou(e).map(KH).join("\\.")}`}function ZH(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function eG(e){return`${Ou(e).join(".")}`}function tG(e){return e?Ou(e).length:0}function nG(...e){for(const t of e)if(void 0!==t)return t}let rG=42;function iG(e){const t=++rG;return e?String(e)+t:t}function aG(e){return oG(e)?e:`__${e}`}function oG(e){return 0===e.indexOf("__")}function sG(e){if(void 0!==e)return(e%360+360)%360}function lG(e){return!!Ac(e)||!isNaN(e)&&!isNaN(parseFloat(e))}const uG={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function cG(e){return e&&e.condition}const fG=["domain","grid","labels","ticks","title"],dG={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},hG={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},pG=Object.assign(Object.assign({},hG),{style:1,labelExpr:1,encoding:1});function mG(e){return!!pG[e]}const gG=IH({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1}),yG={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},vG={count:1,min:1,max:1};function bG(e){return!!e&&!!e.argmin}function xG(e){return!!e&&!!e.argmax}function wG(e){return Cc(e)&&!!yG[e]}const _G=["count","valid","missing","distinct"];function kG(e){return Cc(e)&&CH(_G,e)}const OG=["count","sum","distinct","valid","missing"],SG=Uc(["mean","average","median","q1","q3","min","max"]);var $G=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const EG="row",AG="column",DG="facet",CG="x",MG="y",jG="x2",FG="y2",TG="radius",NG="radius2",RG="theta",PG="theta2",zG="latitude",BG="longitude",LG="latitude2",IG="longitude2",qG="color",UG="fill",VG="stroke",WG="shape",HG="size",GG="angle",XG="opacity",YG="fillOpacity",JG="strokeOpacity",KG="strokeWidth",QG="strokeDash",ZG="text",eX="order",tX="detail",nX="key",rX="tooltip",iX="href",aX="url",oX="description",sX={theta:1,theta2:1,radius:1,radius2:1};function lX(e){return e in sX}const uX={longitude:1,longitude2:1,latitude:1,latitude2:1};const cX=IH(uX),fX=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),sX),uX),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function dX(e){return e===qG||e===UG||e===VG}const hX={row:1,column:1,facet:1},pX=IH(hX),mX=Object.assign(Object.assign({},fX),hX),gX=IH(mX),yX=$G(mX,["order","detail","tooltip"]),vX=$G(yX,["row","column","facet"]);function bX(e){return!!mX[e]}const xX=[jG,FG,LG,IG,PG,NG];function wX(e){return _X(e)!==e}function _X(e){switch(e){case jG:return CG;case FG:return MG;case LG:return zG;case IG:return BG;case PG:return RG;case NG:return TG}return e}function kX(e){if(lX(e))switch(e){case RG:return"startAngle";case PG:return"endAngle";case TG:return"outerRadius";case NG:return"innerRadius"}return e}function OX(e){switch(e){case CG:return jG;case MG:return FG;case zG:return LG;case BG:return IG;case RG:return PG;case TG:return NG}}function SX(e){switch(e){case CG:case jG:return"width";case MG:case FG:return"height"}}const $X=$G(fX,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),EX=IH($X),AX={x:1,y:1},DX=IH(AX);function CX(e){return e in AX}const MX={theta:1,radius:1},jX=IH(MX);function FX(e){return"width"===e?CG:MG}const TX=$G($X,["text","tooltip","href","url","description","detail","key","order"]),NX=IH(TX);const RX=Object.assign(Object.assign(Object.assign({},AX),MX),TX),PX=IH(RX);function zX(e){return!!RX[e]}function BX(e,t){return function(e){switch(e){case qG:case UG:case VG:case oX:case tX:case nX:case rX:case iX:case eX:case XG:case YG:case JG:case KG:case DG:case EG:case AG:return LX;case CG:case MG:case zG:case BG:return IX;case jG:case FG:case LG:case IG:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case HG:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case QG:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case WG:return{point:"always",geoshape:"always"};case ZG:return{text:"always"};case GG:return{point:"always",square:"always",text:"always"};case aX:return{image:"always"};case RG:case TG:return{text:"always",arc:"always"};case PG:case NG:return{arc:"always"}}}(e)[t]}const LX={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},IX=$G(LX,["geoshape"]);function qX(e){switch(e){case CG:case MG:case RG:case TG:case HG:case GG:case KG:case XG:case YG:case JG:case jG:case FG:case PG:case NG:return;case DG:case EG:case AG:case WG:case QG:case ZG:case rX:case iX:case aX:case oX:return"discrete";case qG:case UG:case VG:return"flexible";case zG:case BG:case LG:case IG:case tX:case nX:case eX:return}}function UX(e){return Sc(e)&&(e=AQ(e,void 0)),"bin"+IH(e).map((t=>GX(e[t])?WH(`_${t}_${UH(e[t])}`):WH(`_${t}_${e[t]}`))).join("")}function VX(e){return!0===e||HX(e)&&!e.binned}function WX(e){return"binned"===e||HX(e)&&!0===e.binned}function HX(e){return Nu(e)}function GX(e){return null==e?void 0:e.selection}function XX(e){switch(e){case EG:case AG:case HG:case qG:case UG:case VG:case KG:case XG:case YG:case JG:case WG:return 6;case QG:return 4;default:return 10}}function YX(e){return`Invalid specification ${JSON.stringify(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const JX='Autosize "fit" only works for single views and layered views.';function KX(e){return`${"width"==e?"Width":"Height"} "container" only works for single views and layered views.`}function QX(e){return`${"width"==e?"Width":"Height"} "container" only works well with autosize "fit" or "fit-${"width"==e?"x":"y"}".`}function ZX(e){return e?`Dropping "fit-${e}" because spec has discrete ${SX(e)}.`:'Dropping "fit" because spec has discrete size.'}function eY(e){return`Unknown field for ${e}. Cannot calculate view size.`}function tY(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function nY(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function rY(e){return`Selection not supported for ${e} yet.`}const iY="The same selection must be used to override scale domains in a layered view.";function aY(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}function oY(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}function sY(e){return`Ignoring an invalid transform: ${EH(e)}.`}function lY(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function uY(e){return`Invalid field type "${e}".`}function cY(e,t){const{fill:n,stroke:r}=t;return`Dropping color ${e} as the plot also has ${n&&r?"fill and stroke":n?"fill":"stroke"}.`}function fY(e,t){return`Dropping ${EH(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}function dY(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function hY(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function pY(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function mY(e){return`Using unaggregated domain with raw field has no effect (${EH(e)}).`}function gY(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function yY(e){return`Unaggregated domain is currently unsupported for log scale (${EH(e)}).`}function vY(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function bY(e){return`The step for "${e}" is dropped because the ${"width"===e?"x":"y"} is continuous.`}const xY="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";function wY(e,t){return`Invalid ${e}: ${EH(t)}.`}function _Y(e){return`1D error band does not support ${e}.`}function kY(e){return`Channel ${e} is required for "binned" bin.`}const OY=Fu(2);let SY=OY;function $Y(...e){SY.warn(...e)}function EY(e){if(e&&Nu(e))for(const t of RY)if(t in e)return!0;return!1}const AY=["january","february","march","april","may","june","july","august","september","october","november","december"],DY=AY.map((e=>e.substr(0,3))),CY=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],MY=CY.map((e=>e.substr(0,3)));function jY(e,t){const n=[];if(t&&void 0!==e.day&&IH(e).length>1&&($Y(function(e){return`Dropping day from datetime ${EH(e)} as day cannot be combined with other units.`}(e)),delete(e=OH(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(lG(e)&&(e=+e),Ac(e))return e-1;{const t=e.toLowerCase(),n=AY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=DY.indexOf(r);if(-1!==i)return i;throw new Error(wY("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(lG(e)&&(e=+e),Ac(e))return e>4&&$Y(wY("quarter",e)),e-1;throw new Error(wY("quarter",e))}(e.quarter):e.quarter;n.push(Ac(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(lG(e)&&(e=+e),Ac(e))return e%7;{const t=e.toLowerCase(),n=CY.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=MY.indexOf(r);if(-1!==i)return i;throw new Error(wY("day",e))}}(e.day):e.day;n.push(Ac(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function FY(e){const t=jY(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}var TY=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const NY={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},RY=IH(NY);function PY(e){return e.startsWith("utc")}const zY={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function BY(e){const t=[];for(const n of RY)LY(e,n)&&t.push(n);return t}function LY(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function IY(e,t,{end:n}={end:!1}){const r=YH(t),i=PY(e)?"utc":"";let a;const o={};for(const t of RY)LY(e,t)&&(o[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,a=t);var s;return n&&(o[a]+="+1"),function(e){const t=jY(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(o)}function qY(e){if(!e)return;const t=BY(e);return`timeUnitSpecifier(${yH(t)}, ${yH(zY)})`}function UY(e){if(!e)return;let t;return Cc(e)?t={unit:e}:Nu(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),PY(t.unit)&&(t.utc=!0,t.unit=function(e){return e.substr(3)}(t.unit)),t}function VY(e){return e&&!!e.signal}function WY(e){return!!e.step}function HY(e){return!Tu(e)&&("field"in e&&"data"in e)}const GY=IH({aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1}),XY={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},YY=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function JY(e){return e&&!!e.field&&void 0!==e.equal}function KY(e){return e&&!!e.field&&void 0!==e.lt}function QY(e){return e&&!!e.field&&void 0!==e.lte}function ZY(e){return e&&!!e.field&&void 0!==e.gt}function eJ(e){return e&&!!e.field&&void 0!==e.gte}function tJ(e){if(e&&e.field){if(Tu(e.range)&&2===e.range.length)return!0;if(VY(e.range))return!0}return!1}function nJ(e){return e&&!!e.field&&(Tu(e.oneOf)||Tu(e.in))}function rJ(e){return nJ(e)||JY(e)||tJ(e)||KY(e)||ZY(e)||QY(e)||eJ(e)}function iJ(e,t){return MQ(e,{timeUnit:t,wrapTime:!0})}function aJ(e,t=!0){var n;const{field:r}=e,i=null===(n=UY(e.timeUnit))||void 0===n?void 0:n.unit,a=i?"time("+IY(i,r)+")":hQ(e,{expr:"datum"});if(JY(e))return a+"==="+iJ(e.equal,i);if(KY(e)){return`${a}<${iJ(e.lt,i)}`}if(ZY(e)){return`${a}>${iJ(e.gt,i)}`}if(QY(e)){return`${a}<=${iJ(e.lte,i)}`}if(eJ(e)){return`${a}>=${iJ(e.gte,i)}`}if(nJ(e))return`indexof([${function(e,t){return e.map((e=>iJ(e,t)))}(e.oneOf,i).join(",")}], ${a}) !== -1`;if(function(e){return e&&!!e.field&&void 0!==e.valid}(e))return oJ(a,e.valid);if(tJ(e)){const{range:n}=e,r=VY(n)?{signal:`${n.signal}[0]`}:n[0],o=VY(n)?{signal:`${n.signal}[1]`}:n[1];if(null!==r&&null!==o&&t)return"inrange("+a+", ["+iJ(r,i)+", "+iJ(o,i)+"])";const s=[];return null!==r&&s.push(`${a} >= ${iJ(r,i)}`),null!==o&&s.push(`${a} <= ${iJ(o,i)}`),s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${JSON.stringify(e)}`)}function oJ(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function sJ(e){var t;return rJ(e)&&e.timeUnit?Object.assign(Object.assign({},e),{timeUnit:null===(t=UY(e.timeUnit))||void 0===t?void 0:t.unit}):e}const lJ="quantitative",uJ="ordinal",cJ="temporal",fJ="nominal",dJ="geojson";var hJ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const pJ="linear",mJ="log",gJ="pow",yJ="sqrt",vJ="symlog",bJ="time",xJ="utc",wJ="quantile",_J="quantize",kJ="threshold",OJ="point",SJ="band",$J={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function EJ(e,t){const n=$J[e],r=$J[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}const AJ={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function DJ(e){return AJ[e]}const CJ=["linear","log","pow","sqrt","symlog","time","utc"],MJ=Uc(CJ),jJ=Uc(["linear","log","pow","sqrt","symlog"]);const FJ=Uc(["quantile","quantize","threshold"]),TJ=Uc(CJ.concat(["quantile","quantize","threshold","sequential","identity"])),NJ=Uc(["ordinal","bin-ordinal","point","band"]);function RJ(e){return e in NJ}function PJ(e){return e in TJ}function zJ(e){return e in MJ}function BJ(e){return e in FJ}function LJ(e){return null==e?void 0:e.selection}const IJ=hJ({type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},["type","domain","range","rangeMax","rangeMin","scheme"]),qJ=IH(IJ);function UJ(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!CH(["point","band","identity"],e);case"bins":return!CH(["point","band","identity","ordinal"],e);case"round":return zJ(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return zJ(e)||CH(["point","band"],e);case"paddingOuter":case"align":return CH(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return zJ(e);case"nice":return zJ(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return PJ(e)&&!CH(["log","time","utc","threshold","quantile"],e)}}function VJ(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return dX(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function WJ(e){return e&&!!e.expr}function HJ(e){const t=IH(e||{}),n={};for(const r of t)n[r]=BQ(e[r]);return n}const GJ={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},XJ=GJ.arc,YJ=GJ.area,JJ=GJ.bar,KJ=GJ.image,QJ=GJ.line,ZJ=GJ.point,eK=GJ.rect,tK=GJ.rule,nK=GJ.text,rK=GJ.tick,iK=GJ.trail,aK=GJ.circle,oK=GJ.square,sK=GJ.geoshape;function lK(e){return CH(["line","area","trail"],e)}function uK(e){return CH(["rect","bar","image","arc"],e)}const cK=IH(GJ);function fK(e){return e.type}Uc(cK);const dK=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit","fill","fillOpacity"],hK=IH({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),pK=IH({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),mK={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},gK={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},yK={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};function vK(e){const{channel:t,channelDef:n,markDef:r,scale:i,config:a}=e,o=OK(e);return eQ(n)&&!kG(n.aggregate)&&i&&zJ(i.get("type"))&&!1===i.get("zero")?bK({fieldDef:n,channel:t,markDef:r,ref:o,config:a}):o}function bK({fieldDef:e,channel:t,markDef:n,ref:r,config:i}){if(lK(n.type))return r;return null===WQ("invalid",n,i)?r:[xK(e,t),r]}function xK(e,t){const n=wK(e,!0),r="y"===_X(t)?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function wK(e,t=!0){return oJ(Cc(e)?e:hQ(e,{expr:"datum"}),!t)}function _K(e,t,n,r){const i={};if(t&&(i.scale=t),nQ(e)){const{datum:t}=e;EY(t)?i.signal=FY(t):VY(t)?i.signal=t.signal:WJ(t)?i.signal=t.expr:i.value=t}else i.field=hQ(e,n);if(r){const{offset:e,band:t}=r;e&&(i.offset=e),t&&(i.band=t)}return i}function kK({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:r,startSuffix:i,band:a=.5}){const o=0<a&&a<1?"datum":void 0,s=hQ(t,{expr:o,suffix:i}),l=void 0!==n?hQ(n,{expr:o}):hQ(t,{suffix:"end",expr:o}),u={};if(0===a||1===a){u.scale=e;const t=0===a?s:l;u.field=t}else{const t=`${a} * ${s} + ${1-a} * ${l}`;u.signal=`scale("${e}", ${t})`}return r&&(u.offset=r),u}function OK({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u,band:c}){var f;if(t){if(aQ(t)){if(oQ(t)){c=null!=c?c:YK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:s,config:i,isMidPoint:!0});const{bin:o,timeUnit:u,type:f}=t;if(VX(o)||c&&u&&f===cJ)return s&&s.impute?_K(t,a,{binSuffix:"mid"},{offset:l}):c?kK({scaleName:a,fieldOrDatumDef:t,band:c,offset:l}):_K(t,a,FQ(t,e)?{binSuffix:"range"}:{},{offset:l});if(WX(o)){if(eQ(n))return kK({scaleName:a,fieldOrDatumDef:t,fieldOrDatumDef2:n,band:c,offset:l});$Y(kY(e===CG?jG:FG))}}const u=null==o?void 0:o.get("type");return _K(t,a,RJ(u)?{binSuffix:"range"}:{},{offset:l,band:"band"===u?null!==(f=null!=c?c:t.band)&&void 0!==f?f:.5:void 0})}if(sQ(t)){const n=t.value,r=l?{offset:l}:{};return Object.assign(Object.assign({},SK(e,n)),r)}}return sc(u)&&(u=u()),u?Object.assign(Object.assign({},u),l?{offset:l}:{}):u}function SK(e,t){return CH(["x","x2"],e)&&"width"===t?{field:{group:"width"}}:CH(["y","y2"],e)&&"height"===t?{field:{group:"height"}}:IQ(t)}function $K(e){return e&&"number"!==e&&"time"!==e}function EK(e,t,n){return`${e}(${t}${n?`, ${JSON.stringify(n)}`:""})`}function AK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a}){var o,s;if($K(n))return CK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,config:a});const l=DK(e,r,i);if(CQ(e)){const n=function(e,t,n,r,i){return!t||n?`${i?"utc":"time"}Format(${e}, '${n=Cc(n)?n:r}')`:function(e,t,n){if(!e)return;const r=qY(e);return`${n||PY(e)?"utc":"time"}Format(${t}, ${r})`}(t,e,i)}(l,eQ(e)?null===(o=UY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,t,a.timeFormat,lQ(e)&&(null===(s=e.scale)||void 0===s?void 0:s.type)===xJ);return n?{signal:n}:void 0}if(t=FK(tQ(e),t,a),eQ(e)&&VX(e.bin)){return{signal:RK(l,hQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return t||"quantitative"===tQ(e)?{signal:`${TK(l,t)}`}:{signal:`isValid(${l}) ? ${l} : ""+${l}`}}function DK(e,t,n){return eQ(e)?n?`${hQ(e,{expr:t,suffix:"end"})}-${hQ(e,{expr:t,suffix:"start"})}`:hQ(e,{expr:t}):function(e){const{datum:t}=e;return EY(t)?FY(t):`${JSON.stringify(t)}`}(e)}function CK({fieldOrDatumDef:e,format:t,formatType:n,expr:r,normalizeStack:i,config:a,field:o}){if(o=null!=o?o:DK(e,r,i),eQ(e)&&VX(e.bin)){return{signal:RK(o,hQ(e,{expr:r,binSuffix:"end"}),t,n,a)}}return{signal:EK(n,o,t)}}function MK(e,t,n,r,i,a){var o;if(!$K(r)){if(CQ(e)){return function(e,t,n,r){if(e)return e;if(t)return{signal:qY(t)};return r?void 0:n.timeFormat}(n,eQ(e)?null===(o=UY(e.timeUnit))||void 0===o?void 0:o.unit:void 0,i,a)}return FK(t,n,i)}}function jK(e,t,n){return e&&(VY(e)||"number"===e||"time"===e)?e:CQ(t)&&"time"!==n&&"utc"!==n?"time":void 0}function FK(e,t,n){return Cc(t)?t:e===lJ?n.numberFormat:void 0}function TK(e,t){return`format(${e}, "${t||""}")`}function NK(e,t,n,r){var i;return $K(n)?EK(n,e,t):TK(e,null!==(i=Cc(t)?t:void 0)&&void 0!==i?i:r.numberFormat)}function RK(e,t,n,r,i){const a=NK(e,n,r,i),o=NK(t,n,r,i);return`${oJ(e,!1)} ? "null" : ${a} + " – " + ${o}`}const PK="min",zK={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function BK(e){return e in zK}function LK(e){return!!e&&!!e.encoding}function IK(e){return!(!e||"count"!==e.op&&!e.field)}function qK(e){return!!e&&Tu(e)}function UK(e){return"row"in e||"column"in e}function VK(e){return!!e&&"header"in e}function WK(e){return"facet"in e}var HK=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function GK(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})}function XK(e){return"sort"in e}function YK({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:a,isMidPoint:o}){if(aQ(t)&&void 0!==t.band)return t.band;if(eQ(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return o?HQ("timeUnitBandPosition",r,a):uK(r.type)?HQ("timeUnitBand",r,a):0;if(VX(i))return uK(r.type)&&!o?1:.5}return(null==i?void 0:i.fieldChannel)===e&&o?.5:void 0}function JK(e,t,n,r,i,a){return!!(VX(t.bin)||t.timeUnit&&oQ(t)&&"temporal"===t.type)&&!!YK({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:a})}function KK(e){return!!e&&"condition"in e}function QK(e){const t=e&&e.condition;return!!t&&!Tu(t)&&eQ(t)}function ZK(e){const t=e&&e.condition;return!!t&&!Tu(t)&&aQ(t)}function eQ(e){return!(!e||!e.field&&"count"!==e.aggregate)}function tQ(e){return e&&e.type}function nQ(e){return!!e&&"datum"in e}function rQ(e){return oQ(e)&&mQ(e)||iQ(e)}function iQ(e){return nQ(e)&&Ac(e.datum)}function aQ(e){return eQ(e)||nQ(e)}function oQ(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function sQ(e){return e&&"value"in e&&"value"in e}function lQ(e){return!!e&&("scale"in e||"sort"in e)}function uQ(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function cQ(e){return!!e&&"legend"in e}function fQ(e){return!!e&&("format"in e||"formatType"in e)}function dQ(e){return $H(e,["legend","axis","header","scale"])}function hQ(e,t={}){var n,r,i;let a=e.field;const o=t.prefix;let s=t.suffix,l="";if(function(e){return"count"===e.aggregate}(e))a=aG("count");else{let o;if(!t.nofn)if(function(e){return"op"in e}(e))o=e.op;else{const{bin:u,aggregate:c,timeUnit:f}=e;VX(u)?(o=UX(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):c?xG(c)?(l=`["${a}"]`,a=`argmax_${c.argmax}`):bG(c)?(l=`["${a}"]`,a=`argmin_${c.argmin}`):o=String(c):f&&(o=function(e){const t=UY(e),{utc:n}=t,r=TY(t,["utc"]);return r.unit?(n?"utc":"")+IH(r).map((e=>WH(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+IH(r).map((e=>WH(`_${e}_${r[e]}`))).join("")}(f),s=(!CH(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}o&&(a=a?`${o}_${a}`:o)}return s&&(a=`${a}_${s}`),o&&(a=`${o}_${a}`),t.forAs?eG(a):t.expr?JH(a,t.expr)+l:QH(a)+l}function pQ(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return eQ(e)&&!!e.bin;case"temporal":return!1}throw new Error(uY(e.type))}function mQ(e){return!pQ(e)}const gQ=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return function(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(xG(t))return`${i} for argmax(${t.argmax})`;if(bG(t))return`${i} for argmin(${t.argmin})`;const a=UY(r),o=t||(null==a?void 0:a.unit)||(null==a?void 0:a.maxbins)&&"timeunit"||VX(n)&&"bin";return o?o.toUpperCase()+"("+i+")":i}(e);default:return function(e,t){var n;const{field:r,bin:i,timeUnit:a,aggregate:o}=e;if("count"===o)return t.countTitle;if(VX(i))return`${r} (binned)`;if(a){const e=null===(n=UY(a))||void 0===n?void 0:n.unit;if(e)return`${r} (${BY(e).join("-")})`}else if(o)return xG(o)?`${r} for max ${o.argmax}`:bG(o)?`${r} for min ${o.argmin}`:`${XH(o)} of ${r}`;return r}(e,t)}};let yQ=gQ;function vQ(e){yQ=e}function bQ(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,a;const o=null===(i=xQ(e))||void 0===i?void 0:i.title;if(!eQ(e))return o;const s=e,l=r?wQ(s,t):void 0;return n?nG(o,s.title,l):null!==(a=null!=o?o:s.title)&&void 0!==a?a:l}function xQ(e){return uQ(e)&&e.axis?e.axis:cQ(e)&&e.legend?e.legend:VK(e)&&e.header?e.header:void 0}function wQ(e,t){return yQ(e,t)}function _Q(e){var t;if(fQ(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=xQ(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function kQ(e){return eQ(e)?e:QK(e)?e.condition:void 0}function OQ(e){return aQ(e)?e:ZK(e)?e.condition:void 0}function SQ(e,t,n,r={}){if(Cc(e)||Ac(e)||Sc(e)){return $Y(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${EH(n)}}.`}(t,Cc(e)?"string":Ac(e)?"number":"boolean",e)),{value:e}}return aQ(e)?$Q(e,t,n,r):ZK(e)?Object.assign(Object.assign({},e),{condition:$Q(e.condition,t,n,r)}):e}function $Q(e,t,n,r){if(fQ(e)){const{format:i,formatType:a}=e,o=HK(e,["format","formatType"]);if($K(a)&&!n.customFormatTypes)return $Y(lY(t)),$Q(o,t,n,r)}else{const i=uQ(e)?"axis":cQ(e)?"legend":VK(e)?"header":null;if(i&&e[i]){const a=e[i],{format:o,formatType:s}=a,l=HK(a,["format","formatType"]);if($K(s)&&!n.customFormatTypes)return $Y(lY(t)),$Q(Object.assign(Object.assign({},e),{[i]:l}),t,n,r)}}return eQ(e)?EQ(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=Ac(n)?"quantitative":Cc(n)?"nominal":EY(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function EQ(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:a,field:o}=e,s=Object.assign({},e);if(n||!r||wG(r)||xG(r)||bG(r)||($Y(function(e){return`Invalid aggregation operator "${e}".`}(r)),delete s.aggregate),i&&(s.timeUnit=UY(i)),o&&(s.field=`${o}`),VX(a)&&(s.bin=AQ(a,t)),WX(a)&&!CX(t)&&$Y(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),oQ(s)){const{type:e}=s,t=function(e){if(e)switch(e=e.toLowerCase()){case"q":case lJ:return"quantitative";case"t":case cJ:return"temporal";case"o":case uJ:return"ordinal";case"n":case fJ:return"nominal";case dJ:return"geojson"}}(e);e!==t&&(s.type=t),"quantitative"!==e&&kG(r)&&($Y(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,r)),s.type="quantitative")}else if(!wX(t)){const e=function(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(XK(e)&&Tu(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:a}=e;if(a)return"temporal";if(i||r&&!xG(r)&&!bG(r))return"quantitative";if(lQ(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch($J[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}(s,t);s.type=e}if(oQ(s)){const{compatible:e,warning:n}=function(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case EG:case AG:case DG:return mQ(e)?{compatible:!1,warning:hY(t)}:DQ;case CG:case MG:case qG:case UG:case VG:case ZG:case tX:case nX:case rX:case iX:case aX:case GG:case RG:case TG:case oX:return DQ;case BG:case IG:case zG:case LG:return n!==lJ?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:DQ;case XG:case YG:case JG:case KG:case HG:case PG:case NG:case jG:case FG:return"nominal"!==n||e.sort?DQ:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case QG:return CH(["ordinal","nominal"],e.type)?DQ:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case WG:return CH(["ordinal","nominal","geojson"],e.type)?DQ:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case eX:return"nominal"!==e.type||"sort"in e?DQ:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}(s,t)||{};!1===e&&$Y(n)}if(XK(s)&&Cc(s.sort)){const{sort:e}=s;if(BK(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&BK(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(VK(s)){const{header:e}=s,{orient:t}=e,n=HK(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function AQ(e,t){return Sc(e)?{maxbins:XX(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:XX(t)})}const DQ={compatible:!0};function CQ(e){const{formatType:t}=_Q(e);return"time"===t||!t&&function(e){return e&&("temporal"===e.type||eQ(e)&&!!e.timeUnit)}(e)}function MQ(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var a;const o=t&&(null===(a=UY(t))||void 0===a?void 0:a.unit);let s,l=o||"temporal"===n;return WJ(e)?s=e.expr:VY(e)?s=e.signal:EY(e)?(l=!0,s=FY(e)):(Cc(e)||Ac(e))&&l&&(s=`datetime(${JSON.stringify(e)})`,function(e){return!!NY[e]}(o)&&(Ac(e)&&e<1e4||Cc(e)&&isNaN(Date.parse(e)))&&(s=FY({[o]:e}))),s?r&&l?`time(${s})`:s:i?void 0:JSON.stringify(e)}function jQ(e,t){const{type:n}=e;return t.map((t=>{const r=MQ(t,{timeUnit:eQ(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))}function FQ(e,t){return VX(e.bin)?zX(t)&&CH(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}var TQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function NQ(e){const{anchor:t,frame:n,offset:r,orient:i,color:a,subtitleColor:o,subtitleFont:s,subtitleFontSize:l,subtitleFontStyle:u,subtitleFontWeight:c,subtitleLineHeight:f,subtitlePadding:d}=e,h=TQ(e,["anchor","frame","offset","orient","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]),p=Object.assign(Object.assign({},h),a?{fill:a}:{}),m=Object.assign(Object.assign(Object.assign(Object.assign({},t?{anchor:t}:{}),n?{frame:n}:{}),r?{offset:r}:{}),i?{orient:i}:{}),g=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},o?{subtitleColor:o}:{}),s?{subtitleFont:s}:{}),l?{subtitleFontSize:l}:{}),u?{subtitleFontStyle:u}:{}),c?{subtitleFontWeight:c}:{}),f?{subtitleLineHeight:f}:{}),d?{subtitlePadding:d}:{});return{titleMarkConfig:p,subtitleMarkConfig:SH(p,["align","baseline","dx","dy","limit"]),nonMark:m,subtitle:g}}function RQ(e){return Cc(e)||Tu(e)&&Cc(e[0])}var PQ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zQ(e){const t=Tu(e.condition)?e.condition.map(LQ):LQ(e.condition);return Object.assign(Object.assign({},BQ(e)),{condition:t})}function BQ(e){if(WJ(e)){const{expr:t}=e,n=PQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function LQ(e){if(WJ(e)){const{expr:t}=e,n=PQ(e,["expr"]);return Object.assign({signal:t},n)}return e}function IQ(e){if(WJ(e)){const{expr:t}=e,n=PQ(e,["expr"]);return Object.assign({signal:t},n)}return VY(e)?e:void 0!==e?{value:e}:void 0}function qQ(e){return VY(e)?e.signal:zc(e.value)}function UQ(e){return VY(e)?e.signal:null==e?null:zc(e)}function VQ(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}function WQ(e,t,n,r={}){const{vgChannel:i,ignoreVgConfig:a}=r;return i&&void 0!==t[i]?t[i]:void 0!==t[e]?t[e]:!a||i&&i!==e?HQ(e,t,n,r):void 0}function HQ(e,t,n,{vgChannel:r}={}){return nG(r?GQ(e,t,n.style):void 0,GQ(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function GQ(e,t,n){return XQ(e,VQ(t),n)}function XQ(e,t,n){let r;t=ac(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}function YQ(e,t){return ac(e).reduce(((e,n)=>{var r;return e.field.push(hQ(n,t)),e.order.push(null!==(r=n.sort)&&void 0!==r?r:"ascending"),e}),{field:[],order:[]})}function JQ(e,t){const n=[...e];return t.forEach((e=>{for(const t of n)if(kH(t,e))return;n.push(e)})),n}function KQ(e,t){return kH(e,t)||!t?e:e?[...ac(e),...ac(t)].join(", "):t}function QQ(e,t){const n=e.value,r=t.value;if(null==n||null===r)return{explicit:e.explicit,value:null};if((RQ(n)||VY(n))&&(RQ(r)||VY(r)))return{explicit:e.explicit,value:KQ(n,r)};if(RQ(n)||VY(n))return{explicit:e.explicit,value:n};if(RQ(r)||VY(r))return{explicit:e.explicit,value:r};if(!(RQ(n)||VY(n)||RQ(r)||VY(r)))return{explicit:e.explicit,value:JQ(n,r)};throw new Error("It should never reach here")}function ZQ(e){return"mark"in e}class eZ{constructor(e,t){this.name=e,this.run=t}hasMatchingType(e){return!!ZQ(e)&&function(e){return fK(e)?e.type:e}(e.mark)===this.name}}var tZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function nZ(e,t){const n=e&&e[t];return!!n&&(Tu(n)?MH(n,(e=>!!e.field)):eQ(n)||QK(n))}function rZ(e){return MH(gX,(t=>{if(nZ(e,t)){const n=e[t];if(Tu(n))return MH(n,(e=>!!e.aggregate));{const e=kQ(n);return e&&!!e.aggregate}}return!1}))}function iZ(e,t){const n=[],r=[],i=[],a=[],o={};return sZ(e,((s,l)=>{if(eQ(s)){const{field:u,aggregate:c,bin:f,timeUnit:d}=s,h=tZ(s,["field","aggregate","bin","timeUnit"]);if(c||d||f){const e=xQ(s),p=e&&e.title;let m=hQ(s,{forAs:!0});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:bQ(s,t,{allowDisabling:!0})}),h),{field:m});if(c){let e;if(xG(c)?(e="argmax",m=hQ({op:"argmax",field:c.argmax},{forAs:!0}),g.field=`${m}.${u}`):bG(c)?(e="argmin",m=hQ({op:"argmin",field:c.argmin},{forAs:!0}),g.field=`${m}.${u}`):"boxplot"!==c&&"errorbar"!==c&&"errorband"!==c&&(e=c),e){const t={op:e,as:m};u&&(t.field=u),a.push(t)}}else if(n.push(m),oQ(s)&&VX(f)){if(r.push({bin:f,field:u,as:m}),n.push(hQ(s,{binSuffix:"end"})),FQ(s,l)&&n.push(hQ(s,{binSuffix:"range"})),CX(l)){const e={field:m+"_end"};o[l+"2"]=e}g.bin="binned",wX(l)||(g.type=lJ)}else if(d){i.push({timeUnit:d,field:u,as:m});const e=oQ(s)&&s.type!==cJ&&"time";e&&(l===ZG||l===rX?g.formatType=e:!function(e){return!!$X[e]}(l)?CX(l)&&(g.axis=Object.assign({formatType:e},g.axis)):g.legend=Object.assign({formatType:e},g.legend))}o[l]=g}else n.push(u),o[l]=e[l]}else o[l]=e[l]})),{bins:r,timeUnits:i,aggregate:a,groupby:n,encoding:o}}function aZ(e,t,n,r){return IH(e).reduce(((i,a)=>{if(!bX(a))return $Y(function(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}(a)),i;const o=e[a];if("angle"!==a||"arc"!==t||e.theta||($Y("Arc marks uses theta channel rather than angle, replacing angle with theta."),a=RG),!function(e,t,n){const r=BX(t,n);if(!r)return!1;if("binned"===r){const n=e[t===jG?CG:MG];return!!(eQ(n)&&eQ(e[t])&&WX(n.bin))}return!0}(e,a,t))return $Y(dY(a,t)),i;if(a===HG&&"line"===t){const t=kQ(e[a]);if(null==t?void 0:t.aggregate)return $Y("Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead."),i}if(a===qG&&(n?"fill"in e:"stroke"in e))return $Y(cY("encoding",{fill:"fill"in e,stroke:"stroke"in e})),i;if(a===tX||a===eX&&!Tu(o)&&!sQ(o)||a===rX&&Tu(o))o&&(i[a]=ac(o).reduce(((e,t)=>(eQ(t)?e.push(EQ(t,a)):$Y(fY(t,a)),e)),[]));else{if(a===rX&&null===o)i[a]=null;else if(!(eQ(o)||nQ(o)||sQ(o)||KK(o)||VY(o)))return $Y(fY(o,a)),i;i[a]=SQ(o,a,r)}return i}),{})}function oZ(e,t){const n={};for(const r of IH(e)){const i=SQ(e[r],r,t,{compositeMark:!0});n[r]=i}return n}function sZ(e,t,n){if(e)for(const r of IH(e)){const i=e[r];if(Tu(i))for(const e of i)t.call(n,e,r);else t.call(n,i,r)}}function lZ(e,t){return IH(t).reduce(((n,r)=>{switch(r){case CG:case MG:case iX:case oX:case aX:case jG:case FG:case RG:case PG:case TG:case NG:case zG:case BG:case LG:case IG:case ZG:case WG:case GG:case rX:return n;case eX:if("line"===e||"trail"===e)return n;case tX:case nX:{const e=t[r];if(Tu(e)||eQ(e))for(const t of ac(e))t.aggregate||n.push(hQ(t,{}));return n}case HG:if("trail"===e)return n;case qG:case UG:case VG:case XG:case YG:case JG:case QG:case KG:{const e=kQ(t[r]);return e&&!e.aggregate&&n.push(hQ(e,{})),n}}}),[])}var uZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function cZ(e,t,n,r=!0){if("tooltip"in n)return{tooltip:n.tooltip};return{tooltip:[...e.map((({fieldPrefix:e,titlePrefix:n})=>{const i=r?` of ${fZ(t)}`:"";return{field:e+t.field,type:t.type,title:VY(n)?{signal:n+`"${escape(i)}"`}:n+i}})),...NH(function(e){const t=[];for(const n of IH(e))if(nZ(e,n)){const r=ac(e[n]);for(const e of r)eQ(e)?t.push(e):QK(e)&&t.push(e.condition)}return t}(n).map(dQ),AH)]}}function fZ(e){const{title:t,field:n}=e;return nG(t,n)}function dZ(e,t,n,r,i){const{scale:a,axis:o}=n;return({partName:s,mark:l,positionPrefix:u,endPositionPrefix:c,extraEncoding:f={}})=>{const d=fZ(n);return hZ(e,s,i,{mark:l,encoding:Object.assign(Object.assign(Object.assign({[t]:Object.assign(Object.assign(Object.assign({field:u+"_"+n.field,type:n.type},void 0!==d?{title:d}:{}),void 0!==a?{scale:a}:{}),void 0!==o?{axis:o}:{})},Cc(c)?{[t+"2"]:{field:c+"_"+n.field}}:{}),r),f)})}}function hZ(e,t,n,r){const{clip:i,color:a,opacity:o}=e,s=e.type;return e[t]||void 0===e[t]&&n[t]?[Object.assign(Object.assign({},r),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[t]),i?{clip:i}:{}),a?{color:a}:{}),o?{opacity:o}:{}),fK(r.mark)?r.mark:{type:r.mark}),{style:`${s}-${t}`}),Sc(e[t])?{}:e[t])})]:[]}function pZ(e,t,n){const{encoding:r}=e,i="vertical"===t?"y":"x",a=r[i],o=r[i+"2"],s=r[i+"Error"],l=r[i+"Error2"];return{continuousAxisChannelDef:mZ(a,n),continuousAxisChannelDef2:mZ(o,n),continuousAxisChannelDefError:mZ(s,n),continuousAxisChannelDefError2:mZ(l,n),continuousAxis:i}}function mZ(e,t){if(e&&e.aggregate){const{aggregate:n}=e,r=uZ(e,["aggregate"]);return n!==t&&$Y(function(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}(n,t)),r}return e}function gZ(e,t){const{mark:n,encoding:r}=e,{x:i,y:a}=r;if(fK(n)&&n.orient)return n.orient;if(rQ(i)){if(rQ(a)){const e=eQ(i)&&i.aggregate,n=eQ(a)&&a.aggregate;if(e||n!==t){if(n||e!==t){if(e===t&&n===t)throw new Error("Both x and y cannot have aggregate");return CQ(a)&&!CQ(i)?"horizontal":"vertical"}return"horizontal"}return"vertical"}return"horizontal"}if(rQ(a))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}var yZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const vZ="boxplot",bZ=new eZ(vZ,wZ);function xZ(e){return Ac(e)?"tukey":e}function wZ(e,{config:t}){var n,r;e=Object.assign(Object.assign({},e),{encoding:oZ(e.encoding,t)});const{mark:i,encoding:a,selection:o,projection:s}=e,l=yZ(e,["mark","encoding","selection","projection"]),u=fK(i)?i:{type:i};o&&$Y(rY("boxplot"));const c=null!==(n=u.extent)&&void 0!==n?n:t.boxplot.extent,f=WQ("size",u,t),d=xZ(c),{bins:h,timeUnits:p,transform:m,continuousAxisChannelDef:g,continuousAxis:y,groupby:v,aggregate:b,encodingWithoutContinuousAxis:x,ticksOrient:w,boxOrient:_,customTooltipWithoutAggregatedField:k}=function(e,t,n){const r=gZ(e,vZ),{continuousAxisChannelDef:i,continuousAxis:a}=pZ(e,r,vZ),o=i.field,s=xZ(t),l=[..._Z(o),{op:"median",field:o,as:"mid_box_"+o},{op:"min",field:o,as:("min-max"===s?"lower_whisker_":"min_")+o},{op:"max",field:o,as:("min-max"===s?"upper_whisker_":"max_")+o}],u="min-max"===s||"tukey"===s?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:"iqr_"+o},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:"upper_whisker_"+o},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:"lower_whisker_"+o}],c=e.encoding,f=a,d=(c[f],yZ(c,["symbol"==typeof f?f:f+""])),{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=function(e){const{tooltip:t}=e,n=uZ(e,["tooltip"]);if(!t)return{filteredEncoding:n};let r,i;if(Tu(t)){for(const e of t)e.aggregate?(r||(r=[]),r.push(e)):(i||(i=[]),i.push(e));r&&(n.tooltip=r)}else t.aggregate?n.tooltip=t:i=t;return Tu(i)&&1===i.length&&(i=i[0]),{customTooltipWithoutAggregatedField:i,filteredEncoding:n}}(d),{bins:m,timeUnits:g,aggregate:y,groupby:v,encoding:b}=iZ(p,n),x="vertical"===r?"horizontal":"vertical",w=r,_=[...m,...g,{aggregate:[...y,...l],groupby:v},...u];return{bins:m,timeUnits:g,transform:_,groupby:v,aggregate:y,continuousAxisChannelDef:i,continuousAxis:a,encodingWithoutContinuousAxis:b,ticksOrient:x,boxOrient:w,customTooltipWithoutAggregatedField:h}}(e,c,t),{color:O,size:S}=x,$=yZ(x,["color","size"]),E=e=>dZ(u,y,g,e,t.boxplot),A=E($),D=E(x),C=E(Object.assign(Object.assign({},$),S?{size:S}:{})),M=cZ([{fieldPrefix:"min-max"===d?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:"min-max"===d?"lower_whisker_":"min_",titlePrefix:"Min"}],g,x),j={type:"tick",color:"black",opacity:1,orient:w,invalid:null,aria:!1},F="min-max"===d?M:cZ([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,x),T=[...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...A({partName:"rule",mark:{type:"rule",invalid:null,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"lower_whisker",extraEncoding:F}),...A({partName:"ticks",mark:j,positionPrefix:"upper_whisker",extraEncoding:F})],N=[..."tukey"!==d?T:[],...D({partName:"box",mark:Object.assign(Object.assign({type:"bar"},f?{size:f}:{}),{orient:_,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},Nu(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{}),f?{size:f}:{}),{orient:w,aria:!1}),positionPrefix:"mid_box",extraEncoding:M})];if("min-max"===d)return Object.assign(Object.assign({},l),{transform:(null!==(r=l.transform)&&void 0!==r?r:[]).concat(m),layer:N});const R=`datum["lower_box_${g.field}"]`,P=`datum["upper_box_${g.field}"]`,z=`(${P} - ${R})`,B=`${R} - ${c} * ${z}`,L=`${P} + ${c} * ${z}`,I=`datum["${g.field}"]`,q={joinaggregate:_Z(g.field),groupby:v},U={transform:[{filter:`(${B} <= ${I}) && (${I} <= ${L})`},{aggregate:[{op:"min",field:g.field,as:"lower_whisker_"+g.field},{op:"max",field:g.field,as:"upper_whisker_"+g.field},{op:"min",field:"lower_box_"+g.field,as:"lower_box_"+g.field},{op:"max",field:"upper_box_"+g.field,as:"upper_box_"+g.field},...b],groupby:v}],layer:T},V=yZ($,["tooltip"]),{scale:W,axis:H}=g,G=fZ(g),X=$H(H,["title"]),Y=hZ(u,"outliers",t.boxplot,{transform:[{filter:`(${I} < ${B}) || (${I} > ${L})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[y]:Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},void 0!==G?{title:G}:{}),void 0!==W?{scale:W}:{}),LH(X)?{}:{axis:X})},V),O?{color:O}:{}),k?{tooltip:k}:{})})[0];let J;const K=[...h,...p,q];return Y?J={transform:K,layer:[Y,U]}:(J=U,J.transform.unshift(...K)),Object.assign(Object.assign({},l),{layer:[J,{transform:m,layer:N}]})}function _Z(e){return[{op:"q1",field:e,as:"lower_box_"+e},{op:"q3",field:e,as:"upper_box_"+e}]}var kZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const OZ="errorbar",SZ=new eZ(OZ,$Z);function $Z(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:oZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,ticksOrient:o,markDef:s,outerSpec:l,tooltipEncoding:u}=AZ(e,OZ,t);delete a.size;const c=dZ(s,i,r,a,t.errorbar),f=s.thickness,d=s.size,h=Object.assign(Object.assign({type:"tick",orient:o,aria:!1},void 0!==f?{thickness:f}:{}),void 0!==d?{size:d}:{}),p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:u}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:u}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},void 0!==f?{size:f}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:u})];return Object.assign(Object.assign(Object.assign({},l),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function EZ(e,t){const{encoding:n}=e;if(function(e){return(aQ(e.x)||aQ(e.y))&&!aQ(e.x2)&&!aQ(e.y2)&&!aQ(e.xError)&&!aQ(e.xError2)&&!aQ(e.yError)&&!aQ(e.yError2)}(n))return{orient:gZ(e,t),inputType:"raw"};const r=function(e){return aQ(e.x2)||aQ(e.y2)}(n),i=function(e){return aQ(e.xError)||aQ(e.xError2)||aQ(e.yError)||aQ(e.yError2)}(n),a=n.x,o=n.y;if(r){if(i)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const e=n.x2,r=n.y2;if(aQ(e)&&aQ(r))throw new Error(`${t} cannot have both x2 and y2`);if(aQ(e)){if(rQ(a))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}if(aQ(r)){if(rQ(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}{const e=n.xError,r=n.xError2,i=n.yError,s=n.yError2;if(aQ(r)&&!aQ(e))throw new Error(`${t} cannot have xError2 without xError`);if(aQ(s)&&!aQ(i))throw new Error(`${t} cannot have yError2 without yError`);if(aQ(e)&&aQ(i))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(aQ(e)){if(rQ(a))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}if(aQ(i)){if(rQ(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function AZ(e,t,n){var r;const{mark:i,encoding:a,selection:o,projection:s}=e,l=kZ(e,["mark","encoding","selection","projection"]),u=fK(i)?i:{type:i};o&&$Y(rY(t));const{orient:c,inputType:f}=EZ(e,t),{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=pZ(e,c,t),{errorBarSpecificAggregate:y,postAggregateCalculates:v,tooltipSummary:b,tooltipTitleWithFieldName:x}=function(e,t,n,r,i,a,o,s){let l=[],u=[];const c=t.field;let f,d=!1;if("raw"===a){const t=e.center?e.center:e.extent?"iqr"===e.extent?"median":"mean":s.errorbar.center,n=e.extent?e.extent:"mean"===t?"stderr":"iqr";if("median"===t!=("iqr"===n)&&$Y(function(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}(t,n,o)),"stderr"===n||"stdev"===n)l=[{op:n,field:c,as:"extent_"+c},{op:t,field:c,as:"center_"+c}],u=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:"upper_"+c},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:"lower_"+c}],f=[{fieldPrefix:"center_",titlePrefix:XH(t)},{fieldPrefix:"upper_",titlePrefix:DZ(t,n,"+")},{fieldPrefix:"lower_",titlePrefix:DZ(t,n,"-")}],d=!0;else{let e,t,r;"ci"===n?(e="mean",t="ci0",r="ci1"):(e="median",t="q1",r="q3"),l=[{op:t,field:c,as:"lower_"+c},{op:r,field:c,as:"upper_"+c},{op:e,field:c,as:"center_"+c}],f=[{fieldPrefix:"upper_",titlePrefix:bQ({field:c,aggregate:r,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:bQ({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:bQ({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&$Y(function(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}(e.center,e.extent)),"aggregated-upper-lower"===a?(f=[],u=[{calculate:`datum["${n.field}"]`,as:"upper_"+c},{calculate:`datum["${c}"]`,as:"lower_"+c}]):"aggregated-error"===a&&(f=[{fieldPrefix:"",titlePrefix:c}],u=[{calculate:`datum["${c}"] + datum["${r.field}"]`,as:"upper_"+c}],i?u.push({calculate:`datum["${c}"] + datum["${i.field}"]`,as:"lower_"+c}):u.push({calculate:`datum["${c}"] - datum["${r.field}"]`,as:"lower_"+c}));for(const e of u)f.push({fieldPrefix:e.as.substring(0,6),titlePrefix:ZH(ZH(e.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:u,errorBarSpecificAggregate:l,tooltipSummary:f,tooltipTitleWithFieldName:d}}(u,d,h,p,m,f,t,n),w=a,_=g,k=(w[_],"x"===g?"x2":"y2"),O=(w[k],"x"===g?"xError":"yError"),S=(w[O],"x"===g?"xError2":"yError2"),$=(w[S],kZ(w,["symbol"==typeof _?_:_+"","symbol"==typeof k?k:k+"","symbol"==typeof O?O:O+"","symbol"==typeof S?S:S+""])),{bins:E,timeUnits:A,aggregate:D,groupby:C,encoding:M}=iZ($,n),j=[...D,...y],F="raw"!==f?[]:C,T=cZ(b,d,M,x);return{transform:[...null!==(r=l.transform)&&void 0!==r?r:[],...E,...A,...0===j.length?[]:[{aggregate:j,groupby:F}],...v],groupby:F,continuousAxisChannelDef:d,continuousAxis:g,encodingWithoutContinuousAxis:M,ticksOrient:"vertical"===c?"horizontal":"vertical",markDef:u,outerSpec:l,tooltipEncoding:T}}function DZ(e,t,n){return XH(e)+" "+n+" "+t}const CZ="errorband",MZ=new eZ(CZ,jZ);function jZ(e,{config:t}){e=Object.assign(Object.assign({},e),{encoding:oZ(e.encoding,t)});const{transform:n,continuousAxisChannelDef:r,continuousAxis:i,encodingWithoutContinuousAxis:a,markDef:o,outerSpec:s,tooltipEncoding:l}=AZ(e,CZ,t),u=o,c=dZ(u,i,r,a,t.errorband),f=void 0!==e.encoding.x&&void 0!==e.encoding.y;let d={type:f?"area":"rect"},h={type:f?"line":"rule"};const p=Object.assign(Object.assign({},u.interpolate?{interpolate:u.interpolate}:{}),u.tension&&u.interpolate?{tension:u.tension}:{});return f?(d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"}),h=Object.assign(Object.assign(Object.assign({},h),p),{aria:!1})):u.interpolate?$Y(_Y("interpolate")):u.tension&&$Y(_Y("tension")),Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:l}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:l})]})}const FZ={};function TZ(e,t,n){const r=new eZ(e,t);FZ[e]={normalizer:r,parts:n}}TZ(vZ,wZ,["box","median","outliers","rule","ticks"]),TZ(OZ,$Z,["ticks","rule"]),TZ(CZ,jZ,["band","borders"]);const NZ=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],RZ={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},PZ={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},zZ=IH(RZ),BZ=IH(PZ),LZ=IH({header:1,headerRow:1,headerColumn:1,headerFacet:1}),IZ=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];var qZ=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function UZ(e){const t=[];for(const n of e||[]){const{expr:e,bind:r}=n,i=qZ(n,["expr","bind"]);if(r&&e){const n=Object.assign(Object.assign({},i),{bind:r,init:e});t.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},i),e?{update:e}:{}),r?{bind:r}:{});t.push(n)}}return t}const VZ="_vgsid_",WZ={single:{on:"click",fields:[VZ],resolve:"global",empty:"all",clear:"dblclick"},multi:{on:"click",fields:[VZ],toggle:"event.shiftKey",resolve:"global",empty:"all",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function HZ(e){return!(!e||"legend"!==e&&!e.legend)}function GZ(e){return HZ(e)&&Nu(e)}function XZ(e){return"concat"in e}function YZ(e){return"vconcat"in e}function JZ(e){return"hconcat"in e}function KZ(e){return Nu(e)&&void 0!==e.step}function QZ(e){return e.view||e.width||e.height}const ZZ=IH({align:1,bounds:1,center:1,columns:1,spacing:1});var e0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function t0(e,t){var n;return null!==(n=e[t])&&void 0!==n?n:e["width"===t?"continuousWidth":"continuousHeight"]}function n0(e,t){const n=r0(e,t);return KZ(n)?n.step:i0}function r0(e,t){var n;return nG(null!==(n=e[t])&&void 0!==n?n:e["width"===t?"discreteWidth":"discreteHeight"],{step:e.step})}const i0=20,a0={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:{continuousWidth:200,continuousHeight:200,step:i0},mark:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},arc:{},area:{},bar:gK,circle:{},geoshape:{},image:{},line:{},point:{},rect:yK,rule:{color:"black"},square:{},text:{color:"black"},tick:{thickness:1},trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},projection:{},legend:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:WZ,style:{},title:{},facet:{spacing:20},concat:{spacing:20}},o0=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],s0={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},l0={blue:o0[0],orange:o0[1],red:o0[2],teal:o0[3],green:o0[4],yellow:o0[5],purple:o0[6],pink:o0[7],brown:o0[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function u0(e){const t=IH(e||{}),n={};for(const r of t){const t=e[r];n[r]=cG(t)?zQ(t):BQ(t)}return n}const c0=[...pK,...gG,...LZ,"background","padding","legend","lineBreak","scale","style","title","view"];function f0(e={}){const{color:t,font:n,fontSize:r}=e,i=e0(e,["color","font","fontSize"]),a=Pu({},a0,n?function(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}(n):{},t?function(e={}){return{signals:[{name:"color",value:Nu(e)?Object.assign(Object.assign({},l0),e):l0}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}(t):{},r?function(e){return{signals:[{name:"fontSize",value:Nu(e)?Object.assign(Object.assign({},s0),e):s0}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}(r):{},i||{}),o=$H(a,c0);for(const e of["background","lineBreak","padding"])a[e]&&(o[e]=BQ(a[e]));for(const e of pK)a[e]&&(o[e]=HJ(a[e]));for(const e of gG)a[e]&&(o[e]=u0(a[e]));for(const e of LZ)a[e]&&(o[e]=HJ(a[e]));return a.legend&&(o.legend=HJ(a.legend)),a.scale&&(o.scale=HJ(a.scale)),a.style&&(o.style=function(e){const t=IH(e),n={};for(const r of t)n[r]=u0(e[r]);return n}(a.style)),a.title&&(o.title=HJ(a.title)),a.view&&(o.view=HJ(a.view)),o}const d0=["view",...cK],h0=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],p0=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]});function m0(e){e=OH(e);for(const t of h0)delete e[t];if(e.axis)for(const t in e.axis)cG(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of NZ)delete e.legend[t];if(e.mark){for(const t of hK)delete e.mark[t];e.mark.tooltip&&Nu(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(UZ(e.params)),delete e.params);for(const t of d0){for(const n of hK)delete e[t][n];const n=p0[t];if(n)for(const r of n)delete e[t][r];g0(e,t)}for(const t of IH(FZ))delete e[t];!function(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:r}=NQ(e.title);LH(t)||(e.style["group-title"]=Object.assign(Object.assign({},e.style["group-title"]),t));LH(n)||(e.style["group-subtitle"]=Object.assign(Object.assign({},e.style["group-subtitle"]),n));LH(r)?delete e.title:e.title=r}(e);for(const t in e)Nu(e[t])&&LH(e[t])&&delete e[t];return LH(e)?void 0:e}function g0(e,t,n,r){const i=r?e[t][r]:e[t];"view"===t&&(n="cell");const a=Object.assign(Object.assign({},i),e.style[null!=n?n:t]);LH(a)||(e.style[null!=n?n:t]=a),r||delete e[t]}function y0(e){return"layer"in e}var v0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const b0={zero:1,center:1,normalize:1};const x0=new Set([XJ,JJ,YJ,tK,ZJ,aK,oK,QJ,nK,rK]),w0=new Set([JJ,YJ,XJ]);function _0(e,t){var n,r;const i="x"===t?"y":"radius",a=e[t],o=e[i];if(eQ(a)&&eQ(o))if("quantitative"===tQ(a)&&"quantitative"===tQ(o)){if(a.stack)return t;if(o.stack)return i;const e=eQ(a)&&!!a.aggregate;if(e!==(eQ(o)&&!!o.aggregate))return e?t:i;{const e=null===(n=a.scale)||void 0===n?void 0:n.type,s=null===(r=o.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===tQ(a))return t;if("quantitative"===tQ(o))return i}else{if("quantitative"===tQ(a))return t;if("quantitative"===tQ(o))return i}}function k0(e,t,n={}){const r=fK(e)?e.type:e;if(!x0.has(r))return null;const i=_0(t,"x")||_0(t,"theta");if(!i)return null;const a=t[i],o=eQ(a)?hQ(a,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),l=t[s],u=eQ(l)?hQ(l,{}):void 0;u===o&&(u=void 0,l=void 0,s=void 0);const c=EX.reduce(((e,n)=>{if("tooltip"!==n&&nZ(t,n)){const r=t[n];for(const t of ac(r)){const r=kQ(t);if(r.aggregate)continue;const i=hQ(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e}),[]);let f;if(void 0!==a.stack?f=Sc(a.stack)?a.stack?"zero":null:a.stack:c.length>0&&w0.has(r)&&(f="zero"),!f||!(f in b0))return null;var d;if(rZ(t)&&0===c.length)return null;if(a.scale&&a.scale.type&&a.scale.type!==pJ){if(n.disallowNonLinearStack)return null;$Y(function(e){return`Cannot stack non-linear scale (${e}).`}(a.scale.type))}return aQ(t[OX(i)])?(void 0!==a.stack&&$Y(`Cannot stack "${d=i}" if there is already "${d}2".`),null):(eQ(a)&&a.aggregate&&!CH(OG,a.aggregate)&&$Y(`Stacking is applied even though the aggregate function is non-summative ("${a.aggregate}").`),{groupbyChannel:l?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==a.impute&&lK(r),stackBy:c,offset:f})}var O0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function S0(e){const t=O0(e,["point","line"]);return IH(t).length>1?t:t.type}function $0(e){for(const t of["line","area","rule","trail"])e[t]&&(e=Object.assign(Object.assign({},e),{[t]:$H(e[t],["point","line"])}));return e}function E0(e,t={},n){return"transparent"===e.point?{opacity:0}:e.point?Nu(e.point)?e.point:{}:void 0!==e.point?null:t.point||n.shape?Nu(t.point)?t.point:{}:void 0}function A0(e,t={}){return e.line?!0===e.line?{}:e.line:void 0!==e.line?null:t.line?!0===t.line?{}:t.line:void 0}class D0{constructor(){this.name="path-overlay"}hasMatchingType(e,t){if(ZQ(e)){const{mark:n,encoding:r}=e,i=fK(n)?n:{type:n};switch(i.type){case"line":case"rule":case"trail":return!!E0(i,t[i.type],r);case"area":return!!E0(i,t[i.type],r)||!!A0(i,t[i.type])}}return!1}run(e,t,n){const{config:r}=t,{selection:i,projection:a,mark:o,encoding:s}=e,l=O0(e,["selection","projection","mark","encoding"]),u=oZ(s,r),c=fK(o)?o:{type:o},f=E0(c,r[c.type],u),d="area"===c.type&&A0(c,r[c.type]),h=[Object.assign(Object.assign({},i?{selection:i}:{}),{mark:S0(Object.assign(Object.assign({},"area"===c.type&&void 0===c.opacity&&void 0===c.fillOpacity?{opacity:.7}:{}),c)),encoding:$H(u,["shape"])})],p=k0(c,u);let m=u;if(p){const{fieldChannel:e,offset:t}=p;m=Object.assign(Object.assign({},u),{[e]:Object.assign(Object.assign({},u[e]),t?{stack:t}:{})})}return d&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"line"},SH(c,["clip","interpolate","tension","tooltip"])),d),encoding:m})),f&&h.push(Object.assign(Object.assign({},a?{projection:a}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:!0},SH(c,["clip","tooltip"])),f),encoding:m})),n(Object.assign(Object.assign({},l),{layer:h}),Object.assign(Object.assign({},t),{config:$0(r)}))}}var C0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class M0{constructor(){this.name="RangeStep"}hasMatchingType(e){var t;if(ZQ(e)&&e.encoding)for(const n of DX){const r=e.encoding[n];if(r&&aQ(r)&&(null===(t=null==r?void 0:r.scale)||void 0===t?void 0:t.rangeStep))return!0}return!1}run(e){var t;const n={};let r=Object.assign({},e.encoding);for(const e of DX){const i=SX(e),a=r[e];if(a&&aQ(a)&&(null===(t=null==a?void 0:a.scale)||void 0===t?void 0:t.rangeStep)){const{scale:t}=a,o=C0(a,["scale"]),s=C0(t,["rangeStep"]);n[i]={step:t.rangeStep},$Y('Scale\'s "rangeStep" is deprecated and will be removed in Vega-Lite 5.0. Please use "width"/"height": {"step": ...} instead. See https://vega.github.io/vega-lite/docs/size.html.'),r=Object.assign(Object.assign({},r),{[e]:Object.assign(Object.assign({},o),LH(s)?{}:{scale:s})})}}return Object.assign(Object.assign(Object.assign({},n),e),{encoding:r})}}var j0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function F0(e,t){return t?UK(e)?B0(e,t):R0(e,t):e}function T0(e,t){return t?B0(e,t):e}function N0(e,t,n){const r=t[e];return function(e){return e&&!Cc(e)&&"repeat"in e}(r)?r.repeat in n?Object.assign(Object.assign({},t),{[e]:n[r.repeat]}):void $Y(function(e){return`Unknown repeated value "${e}".`}(r.repeat)):t}function R0(e,t){if(void 0!==(e=N0("field",e,t))){if(null===e)return null;if(XK(e)&&IK(e.sort)){const n=N0("field",e.sort,t);e=Object.assign(Object.assign({},e),n?{sort:n}:{})}return e}}function P0(e,t){if(eQ(e))return R0(e,t);{const n=N0("datum",e,t);return n===e||n.type||(n.type="nominal"),n}}function z0(e,t){if(!aQ(e)){if(ZK(e)){const n=P0(e.condition,t);if(n)return Object.assign(Object.assign({},e),{condition:n});return j0(e,["condition"])}return e}{const n=P0(e,t);if(n)return n;if(KK(e))return{condition:e.condition}}}function B0(e,t){const n={};for(const r in e)if(bc(e,r)){const i=e[r];if(Tu(i))n[r]=i.map((e=>z0(e,t))).filter((e=>e));else{const e=z0(i,t);void 0!==e&&(n[r]=e)}}return n}class L0{constructor(){this.name="RuleForRangedLine"}hasMatchingType(e){if(ZQ(e)){const{encoding:t,mark:n}=e;if("line"===n)for(const e of xX){const n=t[_X(e)];if(t[e]&&(eQ(n)&&!WX(n.bin)||nQ(n)))return!0}}return!1}run(e,t,n){const{encoding:r}=e;var i,a;return $Y((i=!!r.x2,a=!!r.y2,`Line mark is for continuous lines and thus cannot be used with ${i&&a?"x2 and y2":i?"x2":"y2"}. We will use the rule mark (line segments) instead.`)),n(Object.assign(Object.assign({},e),{mark:"rule"}),t)}}var I0=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function q0({parentEncoding:e,encoding:t={},layer:n}){let r={};if(e){const i=new Set([...IH(e),...IH(t)]);for(const a of i){const i=t[a],o=e[a];if(aQ(i)){const e=Object.assign(Object.assign({},o),i);r[a]=e}else ZK(i)?r[a]=Object.assign(Object.assign({},i),{condition:Object.assign(Object.assign({},o),i.condition)}):i||null===i?r[a]=i:(n||sQ(o)||VY(o)||aQ(o)||Tu(o))&&(r[a]=o)}}else r=t;return!r||LH(r)?void 0:r}function U0(e){const{parentProjection:t,projection:n}=e;return t&&n&&$Y(function(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${EH(t)} is overridden by a child projection ${EH(n)}.`}({parentProjection:t,projection:n})),null!=n?n:t}function V0(e,t){void 0===t&&(t=f0(e.config));const n=function(e,t={}){return W0.map(e,{config:t})}(e,t),{width:r,height:i}=e,a=function(e,t,n){let{width:r,height:i}=t;const a=ZQ(e)||y0(e),o={};a?"container"==r&&"container"==i?(o.type="fit",o.contains="padding"):"container"==r?(o.type="fit-x",o.contains="padding"):"container"==i&&(o.type="fit-y",o.contains="padding"):("container"==r&&($Y(KX("width")),r=void 0),"container"==i&&($Y(KX("height")),i=void 0));const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?H0(n.autosize):{}),H0(e.autosize));"fit"!==s.type||a||($Y(JX),s.type="pad");"container"==r&&"fit"!=s.type&&"fit-x"!=s.type&&$Y(QX("width"));"container"==i&&"fit"!=s.type&&"fit-y"!=s.type&&$Y(QX("height"));if(kH(s,{type:"pad"}))return;return s}(n,{width:r,height:i,autosize:e.autosize},t);return Object.assign(Object.assign({},n),a?{autosize:a}:{})}const W0=new class extends class{map(e,t){return WK(e)?this.mapFacet(e,t):function(e){return"repeat"in e}(e)?this.mapRepeat(e,t):JZ(e)?this.mapHConcat(e,t):YZ(e)?this.mapVConcat(e,t):XZ(e)?this.mapConcat(e,t):this.mapLayerOrUnit(e,t)}mapLayerOrUnit(e,t){if(y0(e))return this.mapLayer(e,t);if(ZQ(e))return this.mapUnit(e,t);throw new Error(YX(e))}mapLayer(e,t){return Object.assign(Object.assign({},e),{layer:e.layer.map((e=>this.mapLayerOrUnit(e,t)))})}mapHConcat(e,t){return Object.assign(Object.assign({},e),{hconcat:e.hconcat.map((e=>this.map(e,t)))})}mapVConcat(e,t){return Object.assign(Object.assign({},e),{vconcat:e.vconcat.map((e=>this.map(e,t)))})}mapConcat(e,t){const{concat:n}=e,r=v0(e,["concat"]);return Object.assign(Object.assign({},r),{concat:n.map((e=>this.map(e,t)))})}mapFacet(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}mapRepeat(e,t){return Object.assign(Object.assign({},e),{spec:this.map(e.spec,t)})}}{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[bZ,SZ,MZ,new D0,new L0,new M0]}map(e,t){if(ZQ(e)){const n=nZ(e.encoding,EG),r=nZ(e.encoding,AG),i=nZ(e.encoding,DG);if(n||r||i)return this.mapFacetedUnit(e,t)}return super.map(e,t)}mapUnit(e,t){const{parentEncoding:n,parentProjection:r}=t,i=T0(e.encoding,t.repeater),a=Object.assign(Object.assign({},e),i?{encoding:i}:{});if(n||r)return this.mapUnitWithParentEncodingOrProjection(a,t);const o=this.mapLayerOrUnit.bind(this);for(const e of this.nonFacetUnitNormalizers)if(e.hasMatchingType(a,t.config))return e.run(a,t,o);return a}mapRepeat(e,t){return function(e){return!Tu(e.repeat)&&e.repeat.layer}(e)?this.mapLayerRepeat(e,t):this.mapNonLayerRepeat(e,t)}mapLayerRepeat(e,t){const{repeat:n,spec:r}=e,i=I0(e,["repeat","spec"]),{row:a,column:o,layer:s}=n,{repeater:l={},repeaterPrefix:u=""}=t;return a||o?this.mapRepeat(Object.assign(Object.assign({},e),{repeat:Object.assign(Object.assign({},a?{row:a}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:r}}),t):Object.assign(Object.assign({},i),{layer:s.map((e=>{const n=Object.assign(Object.assign({},l),{layer:e}),i=(r.name||"")+u+`child__layer_${WH(e)}`,a=this.mapLayerOrUnit(r,Object.assign(Object.assign({},t),{repeater:n,repeaterPrefix:i}));return a.name=i,a}))})}mapNonLayerRepeat(e,t){var n;const{repeat:r,spec:i,data:a}=e,o=I0(e,["repeat","spec","data"]);!Tu(r)&&e.columns&&(e=$H(e,["columns"]),$Y(aY("repeat")));const s=[],{repeater:l={},repeaterPrefix:u=""}=t,c=!Tu(r)&&r.row||[l?l.row:null],f=!Tu(r)&&r.column||[l?l.column:null],d=Tu(r)&&r||[l?l.repeat:null];for(const e of d)for(const n of c)for(const a of f){const o={repeat:e,row:n,column:a,layer:l.layer},c=(i.name||"")+u+"child__"+(Tu(r)?`${WH(e)}`:(r.row?`row_${WH(n)}`:"")+(r.column?`column_${WH(a)}`:"")),f=this.map(i,Object.assign(Object.assign({},t),{repeater:o,repeaterPrefix:c}));f.name=c,s.push($H(f,["data"]))}const h=Tu(r)?e.columns:r.column?r.column.length:1;return Object.assign(Object.assign({data:null!==(n=i.data)&&void 0!==n?n:a,align:"all"},o),{columns:h,concat:s})}mapFacet(e,t){const{facet:n}=e;return UK(n)&&e.columns&&(e=$H(e,["columns"]),$Y(aY("facet"))),super.mapFacet(e,t)}mapUnitWithParentEncodingOrProjection(e,t){const{encoding:n,projection:r}=e,{parentEncoding:i,parentProjection:a,config:o}=t,s=U0({parentProjection:a,projection:r}),l=q0({parentEncoding:i,encoding:T0(n,t.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},e),s?{projection:s}:{}),l?{encoding:l}:{}),{config:o})}mapFacetedUnit(e,t){const n=e.encoding,{row:r,column:i,facet:a}=n,o=I0(n,["row","column","facet"]),{mark:s,width:l,projection:u,height:c,view:f,selection:d,encoding:h}=e,p=I0(e,["mark","width","projection","height","view","selection","encoding"]),{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:r,column:i,facet:a},t),y=T0(o,t.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},l?{width:l}:{}),c?{height:c}:{}),f?{view:f}:{}),u?{projection:u}:{}),{mark:s,encoding:y}),d?{selection:d}:{})}),t)}getFacetMappingAndLayout(e,t){var n;const{row:r,column:i,facet:a}=e;if(r||i){a&&$Y(`Facet encoding dropped as ${(o=[...r?[EG]:[],...i?[AG]:[]]).join(" and ")} ${o.length>1?"are":"is"} also specified.`);const t={},s={};for(const r of[EG,AG]){const i=e[r];if(i){const e=I0(i,["align","center","spacing","columns"]);t[r]=e;for(const e of["align","center","spacing"])void 0!==i[e]&&(s[e]=null!==(n=s[e])&&void 0!==n?n:{},s[e][r]=i[e])}}return{facetMapping:t,layout:s}}{const{align:e,center:n,spacing:r,columns:i}=a;return{facetMapping:F0(I0(a,["align","center","spacing","columns"]),t.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},e?{align:e}:{}),n?{center:n}:{}),r?{spacing:r}:{}),i?{columns:i}:{})}}var o}mapLayer(e,t){var{parentEncoding:n,parentProjection:r}=t,i=I0(t,["parentEncoding","parentProjection"]);const{encoding:a,projection:o}=e,s=I0(e,["encoding","projection"]),l=Object.assign(Object.assign({},i),{parentEncoding:q0({parentEncoding:n,encoding:a,layer:!0}),parentProjection:U0({parentProjection:r,projection:o})});return super.mapLayer(s,l)}};function H0(e){return Cc(e)?{type:e}:null!=e?e:{}}const G0=["background","padding"];function X0(e,t){const n={};for(const t of G0)e&&void 0!==e[t]&&(n[t]=BQ(e[t]));return t&&(n.params=e.params),n}class Y0{constructor(e={},t={}){this.explicit=e,this.implicit=t}clone(){return new Y0(OH(this.explicit),OH(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(e){return nG(this.explicit[e],this.implicit[e])}getWithExplicit(e){return void 0!==this.explicit[e]?{explicit:!0,value:this.explicit[e]}:void 0!==this.implicit[e]?{explicit:!1,value:this.implicit[e]}:{explicit:!1,value:void 0}}setWithExplicit(e,t){void 0!==t.value&&this.set(e,t.value,t.explicit)}set(e,t,n){return delete this[n?"implicit":"explicit"][e],this[n?"explicit":"implicit"][e]=t,this}copyKeyFromSplit(e,t){void 0!==t.explicit[e]?this.set(e,t.explicit[e],!0):void 0!==t.implicit[e]&&this.set(e,t.implicit[e],!1)}copyKeyFromObject(e,t){void 0!==t[e]&&this.set(e,t[e],!0)}copyAll(e){for(const t of IH(e.combine())){const n=e.getWithExplicit(t);this.setWithExplicit(t,n)}}}function J0(e){return{explicit:!0,value:e}}function K0(e){return{explicit:!1,value:e}}function Q0(e){return(t,n,r,i)=>{const a=e(t.value,n.value);return a>0?t:a<0?n:Z0(t,n,r,i)}}function Z0(e,t,n,r){return e.explicit&&t.explicit&&$Y(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${EH(n)} and ${EH(r)}). Using ${EH(n)}.`}(n,r,e.value,t.value)),e}function e1(e,t,n,r,i=Z0){return void 0===e||void 0===e.value?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:kH(e.value,t.value)?e:i(e,t,n,r)}class t1 extends Y0{constructor(e={},t={},n=!1){super(e,t),this.explicit=e,this.implicit=t,this.parseNothing=n}clone(){const e=super.clone();return e.parseNothing=this.parseNothing,e}}function n1(e){return"url"in e}function r1(e){return"values"in e}function i1(e){return"name"in e&&!n1(e)&&!r1(e)&&!a1(e)}function a1(e){return e&&(o1(e)||s1(e)||l1(e))}function o1(e){return"sequence"in e}function s1(e){return"sphere"in e}function l1(e){return"graticule"in e}var u1;function c1(e){return"filter"in e}function f1(e){return void 0!==(null==e?void 0:e.stop)}function d1(e){return"lookup"in e}function h1(e){return"pivot"in e}function p1(e){return"density"in e}function m1(e){return"quantile"in e}function g1(e){return"regression"in e}function y1(e){return"loess"in e}function v1(e){return"sample"in e}function b1(e){return"window"in e}function x1(e){return"joinaggregate"in e}function w1(e){return"flatten"in e}function _1(e){return"calculate"in e}function k1(e){return"bin"in e}function O1(e){return"impute"in e}function S1(e){return"timeUnit"in e}function $1(e){return"aggregate"in e}function E1(e){return"stack"in e}function A1(e){return"fold"in e}function D1(e,t,n,r){const i=KK(t)&&t.condition,a=r(t);if(i){return{[n]:[...ac(i).map((t=>{const n=r(t),i=function(e){return e.selection}(t)?e3(e,t.selection):n3(e,t.test);return Object.assign({test:i},n)})),...void 0!==a?[a]:[]]}}return void 0!==a?{[n]:a}:{}}function C1(e,t="text"){const n=e.encoding[t];return D1(e,n,t,(t=>M1(t,e.config)))}function M1(e,t,n="datum"){if(e){if(sQ(e))return IQ(e.value);if(aQ(e)){const{format:r,formatType:i}=_Q(e);return AK({fieldOrDatumDef:e,format:r,formatType:i,expr:n,config:t})}}}function j1(e,t={}){const{encoding:n,markDef:r,config:i,stack:a}=e,o=n.tooltip;if(Tu(o))return{tooltip:T1({tooltip:o},a,i,t)};{const s=t.reactiveGeom?"datum.datum":"datum";return D1(e,o,"tooltip",(e=>{const o=M1(e,i,s);if(o)return o;if(null===e)return;let l=WQ("tooltip",r,i);return!0===l&&(l={content:"encoding"}),Cc(l)?{value:l}:Nu(l)?VY(l)?l:"encoding"===l.content?T1(n,a,i,t):{signal:s}:void 0}))}}function F1(e,t,n,{reactiveGeom:r}={}){const i={},a=r?"datum.datum":"datum",o=[];function s(r,s){const l=_X(s),u=oQ(r)?r:Object.assign(Object.assign({},r),{type:e[l].type}),c=ac(u.title||wQ(u,n)).join(", ");let f;if(CX(s)){const r="x"===s?"x2":"y2",o=kQ(e[r]);if(WX(u.bin)&&o){const e=hQ(u,{expr:a}),t=hQ(o,{expr:a}),{format:s,formatType:l}=_Q(u);f=RK(e,t,s,l,n),i[r]=!0}else if(t&&t.fieldChannel===s&&"normalize"===t.offset){const{format:e,formatType:t}=_Q(u);f=AK({fieldOrDatumDef:u,format:e,formatType:t,expr:a,config:n,normalizeStack:!0}).signal}}f=null!=f?f:M1(u,n,a).signal,o.push({channel:s,key:c,value:f})}sZ(e,((e,t)=>{eQ(e)?s(e,t):QK(e)&&s(e.condition,t)}));const l={};for(const{channel:e,key:t,value:n}of o)i[e]||l[t]||(l[t]=n);return l}function T1(e,t,n,{reactiveGeom:r}={}){const i=F1(e,t,n,{reactiveGeom:r}),a=UH(i).map((([e,t])=>`"${e}": ${t}`));return a.length>0?{signal:`{${a.join(", ")}}`}:void 0}function N1(e){const{markDef:t,config:n}=e,r=WQ("aria",t,n);return!1===r?{}:Object.assign(Object.assign(Object.assign({},r?{aria:r}:{}),function(e){const{mark:t,markDef:n,config:r}=e;if(!1===r.aria)return{};const i=WQ("ariaRoleDescription",n,r);if(null!=i)return{ariaRoleDescription:{value:i}};return t in XY?{}:{ariaRoleDescription:{value:t}}}(e)),function(e){const{encoding:t,markDef:n,config:r,stack:i}=e,a=t.description;if(a)return D1(e,a,"description",(t=>M1(t,e.config)));const o=WQ("description",n,r);if(null!=o)return{description:IQ(o)};if(!1===r.aria)return{};const s=F1(t,i,r);if(LH(s))return;return{description:{signal:UH(s).map((([e,t],n)=>`"${n>0?"; ":""}${e}: " + (${t})`)).join(" + ")}}}(e))}function R1(e,t,n={}){const{markDef:r,encoding:i,config:a}=t,{vgChannel:o}=n;let{defaultRef:s,defaultValue:l}=n;void 0===s&&(l=null!=l?l:WQ(e,r,a,{vgChannel:o,ignoreVgConfig:!0}),void 0!==l&&(s=IQ(l)));const u=i[e];return D1(t,u,null!=o?o:e,(n=>OK({channel:e,channelDef:n,markDef:r,config:a,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:s})))}function P1(e,t={filled:void 0}){var n,r,i,a;const{markDef:o,encoding:s,config:l}=e,{type:u}=o,c=null!==(n=t.filled)&&void 0!==n?n:WQ("filled",o,l),f=CH(["bar","point","circle","square","geoshape"],u)?"transparent":void 0,d=null!==(i=null!==(r=WQ(!0===c?"color":void 0,o,l,{vgChannel:"fill"}))&&void 0!==r?r:l.mark[!0===c&&"color"])&&void 0!==i?i:f,h=null!==(a=WQ(!1===c?"color":void 0,o,l,{vgChannel:"stroke"}))&&void 0!==a?a:l.mark[!1===c&&"color"],p=c?"fill":"stroke",m=Object.assign(Object.assign({},d?{fill:IQ(d)}:{}),h?{stroke:IQ(h)}:{});return o.color&&(c?o.fill:o.stroke)&&$Y(cY("property",{fill:"fill"in o,stroke:"stroke"in o})),Object.assign(Object.assign(Object.assign(Object.assign({},m),R1("color",e,{vgChannel:p,defaultValue:c?d:h})),R1("fill",e,{defaultValue:s.fill?d:void 0})),R1("stroke",e,{defaultValue:s.stroke?h:void 0}))}function z1(e,t){const n=t[function(e){switch(e){case CG:return"xOffset";case MG:return"yOffset";case jG:return"x2Offset";case FG:return"y2Offset";case RG:return"thetaOffset";case TG:return"radiusOffset";case PG:return"theta2Offset";case NG:return"radius2Offset"}}(e)];if(n)return n}function B1(e,t,{defaultPos:n,vgChannel:r,isMidPoint:i}){const{encoding:a,markDef:o,config:s,stack:l}=t,u=a[e],c=a[OX(e)],f=t.scaleName(e),d=t.getScaleComponent(e),h=z1(e,o),p=L1({model:t,defaultPos:n,channel:e,scaleName:f,scale:d}),m=!u&&CX(e)&&(a.latitude||a.longitude)?{field:t.getName(e)}:function(e){const{channel:t,channelDef:n,isMidPoint:r,scaleName:i,stack:a,offset:o,markDef:s,config:l}=e;if(aQ(n)&&a&&t===a.fieldChannel){if(eQ(n)){const e=YK({channel:t,fieldDef:n,isMidPoint:r,markDef:s,stack:a,config:l});if(void 0!==e)return kK({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",band:e,offset:o})}return _K(n,i,{suffix:"end"},{offset:o})}return vK(e)}({channel:e,channelDef:u,channel2Def:c,markDef:o,config:s,isMidPoint:i,scaleName:f,scale:d,stack:l,offset:h,defaultRef:p});return m?{[r||e]:m}:void 0}function L1({model:e,defaultPos:t,channel:n,scaleName:r,scale:i}){const{markDef:a,config:o}=e;return()=>{const s=_X(n),l=kX(n),u=WQ(n,a,o,{vgChannel:l});if(void 0!==u)return SK(n,u);switch(t){case"zeroOrMin":case"zeroOrMax":if(r){const e=i.get("type");if(CH([mJ,bJ,xJ],e));else if(i.domainDefinitelyIncludesZero())return{scale:r,value:0}}if("zeroOrMin"===t)return"y"===s?{field:{group:"height"}}:{value:0};switch(s){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":{const t=e[SX(n)];return Object.assign(Object.assign({},t),{mult:.5})}}}}!function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"}(u1||(u1={}));const I1={left:"x",center:"xc",right:"x2"},q1={top:"y",middle:"yc",bottom:"y2"};function U1(e,t,n,r="middle"){if("radius"===e||"theta"===e)return kX(e);const i="x"===e?"align":"baseline",a=WQ(i,t,n);let o;return VY(a)?($Y(function(e){return`The ${e} for range marks cannot be an expression`}(i)),o=void 0):o=a,"x"===e?I1[o||("top"===r?"left":"center")]:q1[o||r]}function V1(e,t,{defaultPos:n,defaultPos2:r,range:i}){return i?W1(e,t,{defaultPos:n,defaultPos2:r}):B1(e,t,{defaultPos:n})}function W1(e,t,{defaultPos:n,defaultPos2:r}){const{markDef:i,config:a}=t,o=OX(e),s=SX(e),l=function(e,t,n){const{encoding:r,mark:i,markDef:a,stack:o,config:s}=e,l=_X(n),u=SX(n),c=kX(n),f=r[l],d=e.scaleName(l),h=e.getScaleComponent(l),p=z1(n in r||n in a?n:l,e.markDef);if(!f&&("x2"===n||"y2"===n)&&(r.latitude||r.longitude))return{[c]:{field:e.getName(n)}};const m=function({channel:e,channelDef:t,channel2Def:n,markDef:r,config:i,scaleName:a,scale:o,stack:s,offset:l,defaultRef:u}){if(aQ(t)&&s&&e.charAt(0)===s.fieldChannel.charAt(0))return _K(t,a,{suffix:"start"},{offset:l});return vK({channel:e,channelDef:n,scaleName:a,scale:o,stack:s,markDef:r,config:i,offset:l,defaultRef:u})}({channel:n,channelDef:f,channel2Def:r[n],markDef:a,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:void 0});if(void 0!==m)return{[c]:m};return H1(n,a)||H1(n,{[n]:GQ(n,a,s.style),[u]:GQ(u,a,s.style)})||H1(n,s[i])||H1(n,s.mark)||{[c]:L1({model:e,defaultPos:t,channel:n,scaleName:d,scale:h})()}}(t,r,o),u=l[s]?U1(e,i,a):kX(e);return Object.assign(Object.assign({},B1(e,t,{defaultPos:n,vgChannel:u})),l)}function H1(e,t){const n=SX(e),r=kX(e);return void 0!==t[r]?{[r]:SK(e,t[r])}:void 0!==t[e]?{[r]:SK(e,t[e])}:t[n]?{[n]:SK(e,t[n])}:void 0}function G1(e,t,n){var r,i,a,o;const{config:s,encoding:l,markDef:u,stack:c}=e,f=OX(t),d=SX(t),h=l[t],p=l[f],m=e.getScaleComponent(t),g=m?m.get("type"):void 0,y=e.scaleName(t),v=u.orient,b=null!==(i=null!==(r=l[d])&&void 0!==r?r:l.size)&&void 0!==i?i:WQ("size",u,s,{vgChannel:d}),x="bar"===n&&("x"===t?"vertical"===v:"horizontal"===v);if(eQ(h)&&(VX(h.bin)||WX(h.bin)||h.timeUnit&&!p)&&!b&&!RJ(g)){const n=YK({channel:t,fieldDef:h,stack:c,markDef:u,config:s}),r=null===(a=e.component.axes[t])||void 0===a?void 0:a[0];return function({fieldDef:e,fieldDef2:t,channel:n,band:r,scaleName:i,markDef:a,spacing:o=0,axisTranslate:s,reverse:l,config:u}){const c=OX(n),f=kX(n),d=kX(c),h=z1(n,a);if(VX(e.bin)||e.timeUnit)return{[d]:J1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:(1-r)/2,offset:Y1(c,o,l,s,h),config:u}),[f]:J1({channel:n,fieldDef:e,scaleName:i,markDef:a,band:1-(1-r)/2,offset:Y1(n,o,l,s,h),config:u})};if(WX(e.bin)){const r=_K(e,i,{},{offset:Y1(c,o,l,s,h)});if(eQ(t))return{[d]:r,[f]:_K(t,i,{},{offset:Y1(n,o,l,s,h)})};if(HX(e.bin)&&e.bin.step)return{[d]:r,[f]:{signal:`scale("${i}", ${hQ(e,{expr:"datum"})} + ${e.bin.step})`,offset:Y1(n,o,l,s,h)}}}return void $Y(kY(c))}({fieldDef:h,fieldDef2:p,channel:t,markDef:u,scaleName:y,band:n,axisTranslate:null!==(o=null==r?void 0:r.get("translate"))&&void 0!==o?o:.5,spacing:CX(t)?WQ("binSpacing",u,s):void 0,reverse:m.get("reverse"),config:s})}return(aQ(h)&&RJ(g)||x)&&!p?function(e,t,n,r){var i;const{markDef:a,encoding:o,config:s,stack:l}=r,u=a.orient,c=r.scaleName(n),f=r.getScaleComponent(n),d=SX(n),h=OX(n),p="horizontal"===u&&"y"===n||"vertical"===u&&"x"===n,m=WQ(p?"size":d,a,s,{vgChannel:d});let g;(o.size||void 0!==m)&&(p?g=R1("size",r,{vgChannel:d,defaultValue:m}):$Y(function(e){return`Cannot apply size to non-oriented mark "${e}".`}(a.type)));const y=null!==(i=aQ(t)?YK({channel:n,fieldDef:t,markDef:a,stack:l,config:s}):void 0)&&void 0!==i?i:1;g=g||{[d]:X1(e,d,c,f,s,y)};const v="band"!==(null==f?void 0:f.get("type"))||!("band"in g[d]),b=U1(n,a,s,v?"middle":"top"),x=z1(n,a),w=vK({channel:n,channelDef:t,markDef:a,config:s,scaleName:c,scale:f,stack:l,offset:x,defaultRef:L1({model:r,defaultPos:"mid",channel:n,scaleName:c,scale:f}),band:v?.5:(1-y)/2});if(d)return Object.assign({[b]:w},g);{const e=kX(h),t=g[d],n=x?Object.assign(Object.assign({},t),{offset:x}):t;return{[b]:w,[e]:Tu(w)?[w[0],Object.assign(Object.assign({},w[1]),{offset:n})]:Object.assign(Object.assign({},w),{offset:n})}}}(n,h,t,e):W1(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function X1(e,t,n,r,i,a){if(r){const t=r.get("type");if("point"===t||"band"===t){if(void 0!==i[e].discreteBandSize)return{value:i[e].discreteBandSize};if(t===OJ){const e=r.get("range");return WY(e)&&Ac(e.step)?{value:e.step-2}:{value:i0-2}}return{scale:n,band:a}}return{value:i[e].continuousBandSize}}const o=n0(i.view,t),s=nG(i[e].discreteBandSize,o-2);return void 0!==s?{value:s}:void 0}function Y1(e,t,n,r,i){if(lX(e))return 0;const a="x"===e||"y2"===e?-t/2:t/2;if(VY(n)||VY(i)||VY(r)){const e=UQ(n),t=UQ(i),o=UQ(r);return{signal:(o?`${o} + `:"")+(e?`(${e} ? -1 : 1) * `:"")+(t?`(${t} + ${a})`:a)}}return i=i||0,r+(n?-i-a:+i+a)}function J1({channel:e,fieldDef:t,scaleName:n,markDef:r,band:i,offset:a,config:o}){return bK({fieldDef:t,channel:e,markDef:r,ref:kK({scaleName:n,fieldOrDatumDef:t,band:i,offset:a}),config:o})}const K1=new Set(["aria"]);function Q1(e,t){const{fill:n,stroke:r}="include"===t.color?P1(e):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},function(e,t){return GY.reduce(((n,r)=>(K1.has(r)||void 0===e[r]||"ignore"===t[r]||(n[r]=IQ(e[r])),n)),{})}(e.markDef,t)),Z1(e,"fill",n)),Z1(e,"stroke",r)),R1("opacity",e)),R1("fillOpacity",e)),R1("strokeOpacity",e)),R1("strokeWidth",e)),R1("strokeDash",e)),function(e){const{encoding:t,mark:n}=e,r=t.order;return!lK(n)&&sQ(r)?D1(e,r,"zindex",(e=>IQ(e.value))):{}}(e)),j1(e)),C1(e,"href")),N1(e))}function Z1(e,t,n){const{config:r,mark:i,markDef:a}=e;if("hide"===WQ("invalid",a,r)&&n&&!lK(i)){const r=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&PJ(i)&&(t[a]=!0)}return t}),{}),i=IH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>wK(e,t))).join(` ${e} `)}return}(e,{invalid:!0,channels:PX});if(r)return{[t]:[{test:r,value:null},...ac(n)]}}return n?{[t]:n}:{}}function e2(e){const{config:t,markDef:n}=e;if(WQ("invalid",n,t)){const t=function(e,{invalid:t=!1,channels:n}){const r=n.reduce(((t,n)=>{const r=e.getScaleComponent(n);if(r){const i=r.get("type"),a=e.vgField(n,{expr:"datum"});a&&PJ(i)&&(t[a]=!0)}return t}),{}),i=IH(r);if(i.length>0){const e=t?"||":"&&";return i.map((e=>wK(e,t))).join(` ${e} `)}return}(e,{channels:DX});if(t)return{defined:{signal:t}}}return{}}function t2(e,t){if(void 0!==t)return{[e]:IQ(t)}}const n2="voronoi",r2={has:e=>"interval"!==e.type&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(n2)},marks:(e,t,n)=>{const{x:r,y:i}=t.project.hasChannel,a=e.mark;if(lK(a))return $Y(`The "nearest" transform is not supported for ${a} marks.`),n;const o={name:e.getName(n2),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}},j1(e,{reactiveGeom:!0}))},transform:[{type:"voronoi",x:{expr:r||!i?"datum.datum.x || 0":"0"},y:{expr:i||!r?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let s=0,l=!1;return n.forEach(((t,n)=>{var r;const i=null!==(r=t.name)&&void 0!==r?r:"";i===e.component.mark[0].name?s=n:i.indexOf(n2)>=0&&(l=!0)})),l||n.splice(s+1,0,o),n}};class i2{constructor(e,t){this.debugName=t,this._children=[],this._parent=null,e&&(this.parent=e)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(e){this._parent=e,e&&e.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(e,t){this._children.indexOf(e)>-1?$Y("Attempt to add the same child twice."):void 0!==t?this._children.splice(t,0,e):this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);return this._children.splice(t,1),t}remove(){let e=this._parent.removeChild(this);for(const t of this._children)t._parent=this._parent,this._parent.addChild(t,e++)}insertAsParentOf(e){const t=e.parent;t.removeChild(this),this.parent=t,e.parent=this}swapWithParent(){const e=this._parent,t=e.parent;for(const t of this._children)t.parent=e;this._children=[],e.removeChild(this),e.parent.removeChild(e),this.parent=t,e.parent=this}}class a2 extends i2{constructor(e,t,n,r){super(e,t),this.type=n,this.refCounts=r,this._source=this._name=t,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}clone(){const e=new this.constructor;return e.debugName="clone_"+this.debugName,e._source=this._source,e._name="clone_"+this._name,e.type=this.type,e.refCounts=this.refCounts,e.refCounts[e._name]=0,e}dependentFields(){return new Set}producedFields(){return new Set}hash(){return void 0===this._hash&&(this._hash=`Output ${iG()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(e){this._source=e}}var o2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class s2 extends i2{constructor(e,t){super(e),this.formula=t}clone(){return new s2(null,OH(this.formula))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{const{field:i,timeUnit:a}=n,o=T4(t)?t.encoding[OX(r)]:void 0,s=T4(t)&&JK(r,n,o,t.stack,t.markDef,t.config);if(a){const t=hQ(n,{forAs:!0});e[AH({as:t,field:i,timeUnit:a})]=Object.assign({as:t,field:i,timeUnit:a},s?{band:!0}:{})}return e}),{});return LH(n)?null:new s2(e,n)}static makeFromTransform(e,t){const n=Object.assign({},t),{timeUnit:r}=n,i=o2(n,["timeUnit"]),a=UY(r),o=Object.assign(Object.assign({},i),{timeUnit:a});return new s2(e,{[AH(o)]:o})}merge(e){this.formula=Object.assign({},this.formula);for(const t in e.formula)this.formula[t]&&!e.formula[t].band||(this.formula[t]=e.formula[t]);for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}removeFormulas(e){const t={};for(const[n,r]of UH(this.formula))e.has(r.as)||(t[n]=r);this.formula=t}producedFields(){return new Set(qH(this.formula).map((e=>e.as)))}dependentFields(){return new Set(qH(this.formula).map((e=>e.field)))}hash(){return`TimeUnit ${AH(this.formula)}`}assemble(){const e=[];for(const t of qH(this.formula)){const{field:n,as:r,timeUnit:i}=t,a=UY(i),{unit:o,utc:s}=a,l=o2(a,["unit","utc"]);e.push(Object.assign(Object.assign(Object.assign(Object.assign({field:QH(n),type:"timeunit"},o?{units:BY(o)}:{}),s?{timezone:"utc"}:{}),l),{as:[r,`${r}_end`]}))}return e}}var l2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const u2="_tuple_fields";class c2{constructor(...e){this.items=e,this.hasChannel={},this.hasField={}}}const f2={has:e=>"single"===e.type&&"global"===e.resolve&&e.bind&&"scales"!==e.bind&&!HZ(e.bind),parse:(e,t,n,r)=>{r.on||delete t.events,r.clear||delete t.clear},topLevelSignals:(e,t,n)=>{const r=t.name,i=t.project,a=t.bind,o=t.init&&t.init[0],s=r2.has(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return i.items.forEach(((e,i)=>{var l,u;const c=WH(`${r}_${e.field}`);n.filter((e=>e.name===c)).length||n.unshift(Object.assign(Object.assign({name:c},o?{init:C2(o[i])}:{value:null}),{on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${zc(e.field)}] : null`}]:[],bind:null!==(u=null!==(l=a[e.field])&&void 0!==l?l:a[e.channel])&&void 0!==u?u:a}))})),n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.filter((e=>e.name===r+q2))[0],o=r+u2,s=i.items.map((e=>WH(`${r}_${e.field}`))),l=s.map((e=>`${e} !== null`)).join(" && ");return s.length&&(a.update=`${l} ? {fields: ${o}, values: [${s.join(", ")}]} : null`),delete a.value,delete a.on,n}},d2="_toggle",h2={has:e=>"multi"===e.type&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+d2,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+q2,r=t.name+d2;return`${r} ? null : ${n}, `+("global"===t.resolve?`${r} ? null : true, `:`${r} ? null : {unit: ${G2(e)}}, `)+`${r} ? ${n} : null`}},p2={has:e=>void 0!==e.clear&&!1!==e.clear,parse:(e,t,n)=>{n.clear&&(t.clear=Cc(n.clear)?bq(n.clear,"scope"):n.clear)},topLevelSignals:(e,t,n)=>{if(f2.has(t))for(const e of t.project.items){const r=n.findIndex((n=>n.name===WH(`${t.name}_${e.field}`)));-1!==r&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function r(e,r){-1!==e&&n[e].on&&n[e].on.push({events:t.clear,update:r})}if("interval"===t.type)for(const e of t.project.items){const t=n.findIndex((t=>t.name===e.signals.visual));if(r(t,"[0, 0]"),-1===t){r(n.findIndex((t=>t.name===e.signals.data)),"null")}}else{let e=n.findIndex((e=>e.name===t.name+q2));r(e,"null"),h2.has(t)&&(e=n.findIndex((e=>e.name===t.name+d2)),r(e,"false"))}return n}},m2={has:e=>"interval"===e.type&&"global"===e.resolve&&e.bind&&"scales"===e.bind,parse:(e,t)=>{const n=t.scales=[];for(const r of t.project.items){const i=r.channel;if(!zX(i))continue;const a=e.getScaleComponent(i),o=a?a.get("type"):void 0;if(!a||!PJ(o)){$Y("Scale bindings are currently only supported for scales with unbinned, continuous domains.");continue}const s={selection:t.name,field:r.field};a.set("selectionExtent",s,!0),n.push(r)}},topLevelSignals:(e,t,n)=>{const r=t.scales.filter((e=>0===n.filter((t=>t.name===e.signals.data)).length));if(!e.parent||y2(e)||0===r.length)return n;const i=n.filter((e=>e.name===t.name))[0];let a=i.update;if(a.indexOf(V2)>=0)i.update=`{${r.map((e=>`${zc(e.field)}: ${e.signals.data}`)).join(", ")}}`;else{for(const e of r){const t=`${zc(e.field)}: ${e.signals.data}`;a.indexOf(t)<0&&(a=`${a.substring(0,a.length-1)}, ${t}}`)}i.update=a}return n.concat(r.map((e=>({name:e.signals.data}))))},signals:(e,t,n)=>{if(e.parent&&!y2(e))for(const e of t.scales){const t=n.filter((t=>t.name===e.signals.data))[0];t.push="outer",delete t.value,delete t.update}return n}};function g2(e,t){return`domain(${zc(e.scaleName(t))})`}function y2(e){var t;return e.parent&&P4(e.parent)&&(null!==(t=!e.parent.parent)&&void 0!==t?t:y2(e.parent.parent))}const v2={has:e=>{const t="global"===e.resolve&&e.bind&&HZ(e.bind),n=1===e.project.items.length&&e.project.items[0].field!==VZ;return t&&!n&&$Y("Legend bindings are only supported for selections over an individual field or encoding channel."),t&&n},parse:(e,t,n,r)=>{var i;if(r.on||delete t.events,r.clear||delete t.clear,r.on||r.clear){const e='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of t.events)n.filter=ac(null!==(i=n.filter)&&void 0!==i?i:[]),n.filter.indexOf(e)<0&&n.filter.push(e)}const a=GZ(t.bind)?t.bind.legend:"click",o=Cc(a)?bq(a,"view"):ac(a);t.bind={legend:{merge:o}}},topLevelSignals:(e,t,n)=>{const r=t.name,i=GZ(t.bind)&&t.bind.legend,a=e=>t=>{const n=OH(t);return n.markname=e,n};for(const e of t.project.items){if(!e.hasLegend)continue;const o=`${WH(e.field)}_legend`,s=`${r}_${o}`;if(0===n.filter((e=>e.name===s)).length){const e=i.merge.map(a(`${o}_symbols`)).concat(i.merge.map(a(`${o}_labels`))).concat(i.merge.map(a(`${o}_entries`)));n.unshift(Object.assign(Object.assign({name:s},t.init?{}:{value:null}),{on:[{events:e,update:"datum.value || item().items[0].items[0].datum.value",force:!0},{events:i.merge,update:`!event.item || !datum ? null : ${s}`,force:!0}]}))}}return n},signals:(e,t,n)=>{const r=t.name,i=t.project,a=n.find((e=>e.name===r+q2)),o=r+u2,s=i.items.filter((e=>e.hasLegend)).map((e=>WH(`${r}_${WH(e.field)}_legend`))),l=`${s.map((e=>`${e} !== null`)).join(" && ")} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;t.events&&s.length>0?a.on.push({events:s.map((e=>({signal:e}))),update:l}):s.length>0&&(a.update=l,delete a.value,delete a.on);const u=n.find((e=>e.name===r+d2)),c=GZ(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push(Object.assign(Object.assign({},u.on[0]),{events:c})):u.on[0].events=c),n}};const b2="_translate_anchor",x2="_translate_delta",w2={has:e=>"interval"===e.type&&e.translate,signals:(e,t,n)=>{const r=t.name,i=m2.has(t),a=r+b2,{x:o,y:s}=t.project.hasChannel;let l=bq(t.translate,"scope");return i||(l=l.map((e=>(e.between[0].markname=r+T2,e)))),n.push({name:a,value:{},on:[{events:l.map((e=>e.between[0])),update:"{x: x(unit), y: y(unit)"+(void 0!==o?", extent_x: "+(i?g2(e,CG):`slice(${o.signals.visual})`):"")+(void 0!==s?", extent_y: "+(i?g2(e,MG):`slice(${s.signals.visual})`):"")+"}"}]},{name:r+x2,value:{},on:[{events:l,update:`{x: ${a}.x - x(unit), y: ${a}.y - y(unit)}`}]}),void 0!==o&&_2(e,t,o,"width",n),void 0!==s&&_2(e,t,s,"height",n),n}};function _2(e,t,n,r,i){var a;const o=t.name,s=o+b2,l=o+x2,u=n.channel,c=m2.has(t),f=i.filter((e=>e.name===n.signals[c?"data":"visual"]))[0],d=e.getSizeSignalRef(r).signal,h=e.getScaleComponent(u),p=h.get("type"),m=`${s}.extent_${u}`,g=`${c?"log"===p?"panLog":"pow"===p?"panPow":"panLinear":"panLinear"}(${m}, ${`${c&&u===CG?"-":""}${l}.${u} / `+(c?`${d}`:`span(${m})`)}`+(c&&"pow"===p?`, ${null!==(a=h.get("exponent"))&&void 0!==a?a:1}`:"")+")";f.on.push({events:{signal:l},update:c?g:`clampRange(${g}, 0, ${d})`})}const k2="_zoom_anchor",O2="_zoom_delta",S2={has:e=>"interval"===e.type&&e.zoom,signals:(e,t,n)=>{const r=t.name,i=m2.has(t),a=r+O2,{x:o,y:s}=t.project.hasChannel,l=zc(e.scaleName(CG)),u=zc(e.scaleName(MG));let c=bq(t.zoom,"scope");return i||(c=c.map((e=>(e.markname=r+T2,e)))),n.push({name:r+k2,on:[{events:c,update:i?"{"+[l?`x: invert(${l}, x(unit))`:"",u?`y: invert(${u}, y(unit))`:""].filter((e=>!!e)).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:a,on:[{events:c,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),void 0!==o&&$2(e,t,o,"width",n),void 0!==s&&$2(e,t,s,"height",n),n}};function $2(e,t,n,r,i){var a;const o=t.name,s=n.channel,l=m2.has(t),u=i.filter((e=>e.name===n.signals[l?"data":"visual"]))[0],c=e.getSizeSignalRef(r).signal,f=e.getScaleComponent(s),d=f.get("type"),h=l?g2(e,s):u.name,p=o+O2,m=`${l?"log"===d?"zoomLog":"pow"===d?"zoomPow":"zoomLinear":"zoomLinear"}(${h}, ${`${o}${k2}.${s}`}, ${p}`+(l&&"pow"===d?`, ${null!==(a=f.get("exponent"))&&void 0!==a?a:1}`:"")+")";u.on.push({events:{signal:p},update:l?m:`clampRange(${m}, 0, ${c})`})}const E2=[{has:()=>!0,parse:(e,t,n)=>{var r,i,a;const o=t.name,s=null!==(r=t.project)&&void 0!==r?r:t.project=new c2,l={},u={},c=new Set,f=(e,t)=>{const n="visual"===t?e.channel:e.field;let r=WH(`${o}_${n}`);for(let e=1;c.has(r);e++)r=WH(`${o}_${n}_${e}`);return c.add(r),{[t]:r}};if(!n.fields&&!n.encodings){const t=e.config.selection[n.type];if(n.init)for(const e of ac(n.init))for(const r of IH(e))vX[r]?(n.encodings||(n.encodings=[])).push(r):"interval"===n.type?($Y('Interval selections should be initialized using "x" and/or "y" keys.'),n.encodings=t.encodings):(n.fields||(n.fields=[])).push(r);else n.encodings=t.encodings,n.fields=t.fields}for(const e of null!==(i=n.fields)&&void 0!==i?i:[]){const t={type:"E",field:e};t.signals=Object.assign({},f(t,"data")),s.items.push(t),s.hasField[e]=t}for(const r of null!==(a=n.encodings)&&void 0!==a?a:[]){const n=e.fieldDef(r);if(n){let i=n.field;if(n.aggregate){$Y(nY(r,n.aggregate));continue}if(!i){$Y(tY(r));continue}if(n.timeUnit){i=e.vgField(r);const t={timeUnit:n.timeUnit,as:i,field:n.field};u[AH(t)]=t}if(!l[i]){let a="E";if("interval"===t.type){PJ(e.getScaleComponent(r).get("type"))&&(a="R")}else n.bin&&(a="R-RE");const o={field:i,channel:r,type:a};o.signals=Object.assign(Object.assign({},f(o,"data")),f(o,"visual")),s.items.push(l[i]=o),s.hasField[i]=s.hasChannel[r]=l[i]}}else $Y(tY(r))}if(n.init){const e=e=>s.items.map((t=>void 0!==e[t.channel]?e[t.channel]:e[t.field]));if("interval"===n.type)t.init=e(n.init);else{const r=ac(n.init);t.init=r.map(e)}}LH(u)||(s.timeUnit=new s2(null,u))},signals:(e,t,n)=>{const r=t.name+u2;return n.filter((e=>e.name===r)).length>0?n:n.concat({name:r,value:t.project.items.map((e=>{const t=l2(e,["signals","hasLegend"]);return t.field=QH(t.field),t}))})}},h2,m2,v2,w2,S2,f2,r2,p2];function A2(e,t){for(const n of E2)n.has(e)&&t(n)}var D2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function C2(e,t=!0,n=Eu){if(Tu(e)){const r=e.map((e=>C2(e,t,n)));return t?`[${r.join(", ")}]`:r}return EY(e)?n(t?FY(e):function(e){const t=jY(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}(e)):t?n(JSON.stringify(e)):e}function M2(e,t){return H2(e,((n,r)=>{t=r.marks?r.marks(e,n,t):t,A2(n,(r=>{r.marks&&(t=r.marks(e,n,t))}))})),t}function j2(e){return e.map((e=>(e.on&&!e.on.length&&delete e.on,e)))}var F2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const T2="_brush",N2="_scale_trigger",R2={signals:(e,t)=>{const n=t.name,r=n+u2,i=m2.has(t),a=[],o=[],s=[];if(t.translate&&!i){const e=`!event.item || event.item.mark.name !== ${zc(n+T2)}`;P2(t,((t,n)=>{var r;const i=ac(null!==(r=n.between[0].filter)&&void 0!==r?r:n.between[0].filter=[]);return i.indexOf(e)<0&&i.push(e),t}))}t.project.items.forEach(((n,r)=>{const i=n.channel;if(i!==CG&&i!==MG)return void $Y("Interval selections only support x and y encoding channels.");const l=t.init?t.init[r]:null,u=function(e,t,n,r){const i=n.channel,a=n.signals.visual,o=n.signals.data,s=m2.has(t),l=zc(e.scaleName(i)),u=e.getScaleComponent(i),c=u?u.get("type"):void 0,f=e=>`scale(${l}, ${e})`,d=e.getSizeSignalRef(i===CG?"width":"height").signal,h=`${i}(unit)`,p=P2(t,((e,t)=>[...e,{events:t.between[0],update:`[${h}, ${h}]`},{events:t,update:`[${a}[0], clamp(${h}, 0, ${d})]`}]));return p.push({events:{signal:t.name+N2},update:PJ(c)?`[${f(`${o}[0]`)}, ${f(`${o}[1]`)}]`:"[0, 0]"}),s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:a},r?{init:C2(r,!0,f)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},r?{init:C2(r)}:{}),{on:[{events:{signal:a},update:`${a}[0] === ${a}[1] ? null : invert(${l}, ${a})`}]})]}(e,t,n,l),c=n.signals.data,f=n.signals.visual,d=zc(e.scaleName(i)),h=PJ(e.getScaleComponent(i).get("type"))?"+":"";a.push(...u),o.push(c),s.push({scaleName:e.scaleName(i),expr:`(!isArray(${c}) || (${h}invert(${d}, ${f})[0] === ${h}${c}[0] && ${h}invert(${d}, ${f})[1] === ${h}${c}[1]))`})})),i||a.push({name:n+N2,value:{},on:[{events:s.map((e=>({scale:e.scaleName}))),update:s.map((e=>e.expr)).join(" && ")+` ? ${n+N2} : {}`}]});const l=t.init,u=`unit: ${G2(e)}, fields: ${r}, values`;return a.concat(Object.assign(Object.assign({name:n+q2},l?{init:`{${u}: ${C2(l)}}`}:{}),{on:[{events:[{signal:o.join(" || ")}],update:o.join(" && ")+` ? {${u}: [${o}]} : null`}]}))},modifyExpr:(e,t)=>t.name+q2+", "+("global"===t.resolve?"true":`{unit: ${G2(e)}}`),marks:(e,t,n)=>{const r=t.name,{x:i,y:a}=t.project.hasChannel,o=i&&i.signals.visual,s=a&&a.signals.visual,l=`data(${zc(t.name+I2)})`;if(m2.has(t))return n;const u={x:void 0!==i?{signal:`${o}[0]`}:{value:0},y:void 0!==a?{signal:`${s}[0]`}:{value:0},x2:void 0!==i?{signal:`${o}[1]`}:{field:{group:"width"}},y2:void 0!==a?{signal:`${s}[1]`}:{field:{group:"height"}}};if("global"===t.resolve)for(const t of IH(u))u[t]=[Object.assign({test:`${l}.length && ${l}[0].unit === ${G2(e)}`},u[t]),{value:0}];const c=t.mark,{fill:f,fillOpacity:d,cursor:h}=c,p=F2(c,["fill","fillOpacity","cursor"]),m=IH(p).reduce(((e,t)=>(e[t]=[{test:[void 0!==i&&`${o}[0] !== ${o}[1]`,void 0!==a&&`${s}[0] !== ${s}[1]`].filter((e=>e)).join(" && "),value:p[t]},{value:null}],e)),{});return[{name:r+T2+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:f},fillOpacity:{value:d}},update:u}},...n,{name:r+T2,type:"rect",clip:!0,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},u),m)}}]}};function P2(e,t){return e.events.reduce(((e,n)=>n.between?t(e,n):($Y(`${n} is not an ordered event stream for interval selections.`),e)),[])}function z2(e,t){const n=t.name,r=n+u2,i=t.project,a="(item().isVoronoi ? datum.datum : datum)",o=i.items.map((t=>{const n=e.fieldDef(t.channel);return n&&n.bin?`[${a}[${zc(e.vgField(t.channel,{}))}], ${a}[${zc(e.vgField(t.channel,{binSuffix:"end"}))}]]`:`${a}[${zc(t.field)}]`})).join(", "),s=`unit: ${G2(e)}, fields: ${r}, values`,l=t.events;return[{name:n+q2,on:l?[{events:l,update:`datum && item().mark.marktype !== 'group' ? {${s}: [${o}]} : null`,force:!0}]:[]}]}const B2={signals:z2,modifyExpr:(e,t)=>t.name+q2+", "+("global"===t.resolve?"null":`{unit: ${G2(e)}}`)},L2={signals:z2,modifyExpr:(e,t)=>t.name+q2+", "+("global"===t.resolve?"true":`{unit: ${G2(e)}}`)},I2="_store",q2="_tuple",U2="_modify",V2="vlSelectionResolve",W2={single:L2,multi:B2,interval:R2};function H2(e,t){const n=e.component.selection;if(n)for(const e of qH(n)){if(!0===t(e,W2[e.type]))break}}function G2(e,{escape:t}={escape:!0}){let n=t?zc(e.name):e.name;const r=function(e){let t=e.parent;for(;t&&!N4(t);)t=t.parent;return t}(e);if(r){const{facet:e}=r;for(const t of pX)e[t]&&(n+=` + '__facet_${t}_' + (facet[${zc(r.vgField(t))}])`)}return n}function X2(e){let t=!1;return H2(e,(e=>{t=t||e.project.items.some((e=>e.field===VZ))})),t}function Y2(e){const t=[];return"Identifier"===e.type?[e.name]:"Literal"===e.type?[e.value]:("MemberExpression"===e.type&&(t.push(...Y2(e.object)),t.push(...Y2(e.property))),t)}function J2(e){return"MemberExpression"===e.object.type?J2(e.object):"datum"===e.object.name}function K2(e){const t=bL(e),n=new Set;return t.visit((e=>{"MemberExpression"===e.type&&J2(e)&&n.add(Y2(e).slice(1).join("."))})),n}class Q2 extends i2{constructor(e,t,n){super(e),this.model=t,this.filter=n,this.expr=n3(this.model,this.filter,this),this._dependentFields=K2(this.expr)}clone(){return new Q2(null,this.model,OH(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}var Z2=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function e3(e,t,n,r="datum"){const i=[];const a=HH(t,(function(t){const a=WH(t),o=e.getSelectionComponent(a,t),s=zc(a+I2);if(o.project.timeUnit){const t=null!=n?n:e.component.data.raw,r=o.project.timeUnit.clone();t.parent?r.insertAsParentOf(t):t.parent=r}return"none"!==o.empty&&i.push(s),`vlSelectionTest(${s}, ${r}`+("global"===o.resolve?")":`, ${zc(o.resolve)})`)}));return(i.length?"!("+i.map((e=>`length(data(${e}))`)).join(" || ")+") || ":"")+`(${a})`}function t3(e,t){const n=t.encoding;let r=t.field;if(n||r){if(n&&!r){const i=e.project.items.filter((e=>e.channel===n));!i.length||i.length>1?(r=e.project.items[0].field,$Y((i.length?"Multiple ":"No ")+`matching ${zc(n)} encoding found for selection ${zc(t.selection)}. `+`Using "field": ${zc(r)}.`)):r=i[0].field}}else r=e.project.items[0].field,e.project.items.length>1&&$Y(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${zc(r)}.`);return`${e.name}[${zc(r)}]`}function n3(e,t,n){return HH(t,(t=>Cc(t)?t:function(e){return null==e?void 0:e.selection}(t)?e3(e,t.selection,n):aJ(t)))}var r3=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function i3(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}function a3(e,t,n,r={header:!1}){var i,a;const o=e.combine(),{disable:s,orient:l,scale:u,labelExpr:c,title:f,zindex:d}=o,h=r3(o,["disable","orient","scale","labelExpr","title","zindex"]);if(!s){for(const e in h){const n=dG[e],r=h[e];if(n&&n!==t&&"both"!==n)delete h[e];else if(cG(r)){const{condition:t}=r,n=r3(r,["condition"]),i=ac(t),a=uG[e];if(a){const{vgProp:t,part:r}=a;i3(h,r,t,[...i.map((e=>{const{test:t}=e,n=r3(e,["test"]);return Object.assign({test:n3(null,t)},n)})),n]),delete h[e]}else if(null===a){const t={signal:i.map((e=>{const{test:t}=e,n=r3(e,["test"]);return`${n3(null,t)} ? ${qQ(n)} : `})).join("")+qQ(n)};h[e]=t}}else if(VY(r)){const t=uG[e];if(t){const{vgProp:n,part:i}=t;i3(h,i,n,r),delete h[e]}}}if("grid"===t){if(!h.grid)return;if(h.encode){const{grid:e}=h.encode;h.encode=Object.assign({},e?{grid:e}:{}),LH(h.encode)&&delete h.encode}return Object.assign(Object.assign({scale:u,orient:l},h),{domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:nG(d,0)})}{if(!r.header&&e.mainExtracted)return;if(void 0!==c){let e=c;(null===(a=null===(i=h.encode)||void 0===i?void 0:i.labels)||void 0===a?void 0:a.update)&&VY(h.encode.labels.update.text)&&(e=ZH(c,"datum.label",h.encode.labels.update.text.signal)),i3(h,"labels","text",{signal:e})}if(null===h.labelAlign&&delete h.labelAlign,h.encode){for(const t of fG)e.hasAxisPart(t)||delete h.encode[t];LH(h.encode)&&delete h.encode}const t=function(e,t){if(e)return Tu(e)&&!RQ(e)?e.map((e=>wQ(e,t))).join(", "):e}(f,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:u,orient:l,grid:!1},t?{title:t}:{}),h),!1===n.aria?{aria:!1}:{}),{zindex:nG(d,0)})}}}function o3(e){const{axes:t}=e.component,n=[];for(const r of DX)if(t[r])for(const i of t[r])if(!i.get("disable")&&!i.get("gridScale")){const t="x"===r?"height":"width",i=e.getSizeSignalRef(t).signal;t!==i&&n.push({name:t,update:i})}return n}function s3(e,t,n,r){return Object.assign.apply(null,[{},...e.map((e=>{if("axisOrient"===e){const e="x"===n?"bottom":"left",i=t["x"===n?"axisBottom":"axisLeft"]||{},a=t["x"===n?"axisTop":"axisRight"]||{},o=new Set([...IH(i),...IH(a)]),s={};for(const t of o.values())s[t]={signal:`${r.signal} === "${e}" ? ${UQ(i[t])} : ${UQ(a[t])}`};return s}return t[e]}))])}function l3(e,t,n,r){const i="band"===t?["axisDiscrete","axisBand"]:"point"===t?["axisDiscrete","axisPoint"]:function(e){return e in jJ}(t)?["axisQuantitative"]:"time"===t||"utc"===t?["axisTemporal"]:[],a="x"===e?"axisX":"axisY",o=VY(n)?"axisOrient":"axis"+XH(n),s=[...i,...i.map((e=>a+e.substr(4)))],l=["axis",o,a];return{vlOnlyAxisConfig:s3(s,r,e,n),vgAxisConfig:s3(l,r,e,n),axisConfigStyle:u3([...l,...s],r)}}function u3(e,t){var n;const r=[{}];for(const i of e){let e=null===(n=t[i])||void 0===n?void 0:n.style;if(e){e=ac(e);for(const n of e)r.push(t.style[n])}}return Object.assign.apply(null,r)}function c3(e,t,n,r={}){var i;const a=XQ(e,n,t);if(void 0!==a)return{configFrom:"style",configValue:a};for(const t of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(void 0!==(null===(i=r[t])||void 0===i?void 0:i[e]))return{configFrom:t,configValue:r[t][e]};return{}}const f3={scale:({model:e,channel:t})=>e.scaleName(t),format:({fieldOrDatumDef:e,config:t,axis:n})=>{const{format:r,formatType:i}=n;return MK(e,e.type,r,i,t,!0)},formatType:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return jK(r,t,n)},grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var r;return(!eQ(e)||!WX(e.bin))&&(null!==(r=t.grid)&&void 0!==r?r:function(e,t){return!RJ(e)&&eQ(t)&&!VX(null==t?void 0:t.bin)}(n,e))},gridScale:({model:e,channel:t})=>function(e,t){const n="x"===t?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n);return}(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelAlign||p3(t,n,r),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:r})=>e.labelBaseline||h3(t,n,r),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var r;return null!==(r=e.labelFlush)&&void 0!==r?r:function(e,t){if("x"===t&&CH(["quantitative","temporal"],e))return!0;return}(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var r;return null!==(r=e.labelOverlap)&&void 0!==r?r:function(e,t,n,r){if(n&&!Nu(r)||"nominal"!==e&&"ordinal"!==e)return"log"!==t&&"symlog"!==t||"greedy";return}(t.type,n,eQ(t)&&!!t.timeUnit,eQ(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:r,scaleType:i})=>{var a;const o="x"===e?"width":"y"===e?"height":void 0,s=o?t.getSizeSignalRef(o):void 0;return null!==(a=n.tickCount)&&void 0!==a?a:function({fieldOrDatumDef:e,scaleType:t,size:n,values:r}){var i;if(!r&&!RJ(t)&&"log"!==t){if(eQ(e)){if(VX(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&CH(["month","hours","day","quarter"],null===(i=UY(e.timeUnit))||void 0===i?void 0:i.unit))return}return{signal:`ceil(${n.signal}/40)`}}return}({fieldOrDatumDef:r,scaleType:i,size:s,values:n.values})},title:({axis:e,model:t,channel:n})=>{if(void 0!==e.title)return e.title;const r=m3(t,n);if(void 0!==r)return r;const i=t.typedFieldDef(n),a="x"===n?"x2":"y2",o=t.fieldDef(a);return JQ(i?[GK(i)]:[],eQ(o)?[GK(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>function(e,t){const n=e.values;if(Tu(n))return jQ(t,n);if(VY(n))return n;return}(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var r;return null!==(r=e.zindex)&&void 0!==r?r:function(e,t){if("rect"===e&&pQ(t))return 1;return 0}(n,t)}};function d3(e){return`(((${e.signal} % 360) + 360) % 360)`}function h3(e,t,n,r){if(void 0!==e){if("x"===n){if(VY(e)){const n=d3(e);return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :(${n} <= 45 || 315 <= ${n}) === ${VY(t)?`(${t.signal} === "top")`:"top"===t} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(VY(t)){const n=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${n} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==("top"===t)?"bottom":"top"}if(VY(e)){const n=d3(e);return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${r?'"middle"':"null"} : (45 <= ${n} && ${n} <= 135) === ${VY(t)?`(${t.signal} === "left")`:"left"===t} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return r?"middle":null;if(VY(t)){const n=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==("left"===t)?"top":"bottom"}}function p3(e,t,n){if(void 0===e)return;const r="x"===n,i=r?0:90,a=r?"bottom":"left";if(VY(e)){const n=d3(e);return{signal:`(${i?"("+n+" + 90)":n} % 180 === 0) ? ${r?null:'"center"'} :(${i} < ${n} && ${n} < ${180+i}) === ${VY(t)?`(${t.signal} === "${a}")`:t===a} ? "left" : "right"`}}if((e+i)%180==0)return r?null:"center";if(VY(t)){const n=i<e&&e<180+i?"===":"!==";return{signal:`${`${t.signal} ${n} "${a}"`} ? "left" : "right"`}}return(i<e&&e<180+i)==(t===a)?"left":"right"}function m3(e,t){const n="x"===t?"x2":"y2",r=e.fieldDef(t),i=e.fieldDef(n),a=r?r.title:void 0,o=i?i.title:void 0;return a&&o?KQ(a,o):a||(o||(void 0!==a?a:void 0!==o?o:void 0))}class g3 extends i2{constructor(e,t){super(e),this.transform=t,this._dependentFields=K2(this.transform.calculate)}clone(){return new g3(null,OH(this.transform))}static parseAllForSortIndex(e,t){return t.forEachFieldDef(((t,n)=>{if(lQ(t)&&qK(t.sort)){const{field:r,timeUnit:i}=t,a=t.sort,o=a.map(((e,t)=>`${aJ({field:r,timeUnit:i,equal:e})} ? ${t} : `)).join("")+a.length;e=new g3(e,{calculate:o,as:y3(t,n,{forAs:!0})})}})),e}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${AH(this.transform)}`}}function y3(e,t,n){return hQ(e,Object.assign({prefix:t,suffix:"sort_index"},null!=n?n:{}))}function v3(e,t){return CH(["top","bottom"],t)?"column":CH(["left","right"],t)||"row"===e?"row":"column"}function b3(e,t,n,r){const i="row"===r?n.headerRow:"column"===r?n.headerColumn:n.headerFacet;return nG((t||{})[e],i[e],n.header[e])}function x3(e,t,n,r){const i={};for(const a of e){const e=b3(a,t||{},n,r);void 0!==e&&(i[a]=e)}return i}const w3=["row","column"],_3=["header","footer"];function k3(e,t){const n=e.component.layoutHeaders[t].title,r=e.config?e.config:void 0,i=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:a,titleAngle:o,titleOrient:s}=x3(["titleAnchor","titleAngle","titleOrient"],i.header,r,t),l=v3(t,s),u=sG(o);return{name:`${t}-title`,type:"group",role:`${l}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},"row"===t?{orient:"left"}:{}),{style:"guide-title"}),S3(u,l)),O3(l,u,a)),j3(r,i,t,zZ,RZ))}}function O3(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const r=p3(t,"row"===e?"left":"top","row"===e?"y":"x");return r?{align:r}:{}}function S3(e,t){const n=h3(e,"row"===t?"left":"top","row"===t?"y":"x",!0);return n?{baseline:n}:{}}function $3(e,t){const n=e.component.layoutHeaders[t],r=[];for(const i of _3)if(n[i])for(const a of n[i]){const o=D3(e,t,i,n,a);null!=o&&r.push(o)}return r}function E3(e,t){var n;const{sort:r}=e;return IK(r)?{field:hQ(r,{expr:"datum"}),order:null!==(n=r.order)&&void 0!==n?n:"ascending"}:Tu(r)?{field:y3(e,t,{expr:"datum"}),order:"ascending"}:{field:hQ(e,{expr:"datum"}),order:null!=r?r:"ascending"}}function A3(e,t,n){const{format:r,formatType:i,labelAngle:a,labelAnchor:o,labelOrient:s,labelExpr:l}=x3(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),u=AK({fieldOrDatumDef:e,format:r,formatType:i,expr:"parent",config:n}).signal,c=v3(t,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:l?ZH(ZH(l,"datum.label",u),"datum.value",hQ(e,{expr:"parent"})):u}},"row"===t?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),S3(a,c)),O3(c,a,o)),j3(n,e,t,BZ,PZ))}function D3(e,t,n,r,i){if(i){let a=null;const{facetFieldDef:o}=r,s=e.config?e.config:void 0;if(o&&i.labels){const{labelOrient:e}=x3(["labelOrient"],o.header,s,t);("row"===t&&!CH(["top","bottom"],e)||"column"===t&&!CH(["left","right"],e))&&(a=A3(o,t,s))}const l=N4(e)&&!UK(e.facet),u=i.axes,c=(null==u?void 0:u.length)>0;if(a||c){const s="row"===t?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`},r.facetFieldDef?{from:{data:e.getName(t+"_domain")},sort:E3(o,t)}:{}),c&&l?{from:{data:e.getName(`facet_domain_${t}`)}}:{}),a?{title:a}:{}),i.sizeSignal?{encode:{update:{[s]:i.sizeSignal}}}:{}),c?{axes:u}:{})}}return null}const C3={column:{start:0,end:1},row:{start:1,end:0}};function M3(e,t){return C3[t][e]}function j3(e,t,n,r,i){const a={};for(const o of r){if(!i[o])continue;const r=b3(o,null==t?void 0:t.header,e,n);void 0!==r&&(a[i[o]]=r)}return a}function F3(e){return[...T3(e,"width"),...T3(e,"height"),...T3(e,"childWidth"),...T3(e,"childHeight")]}function T3(e,t){const n="width"===t?"x":"y",r=e.component.layoutSize.get(t);if(!r||"merged"===r)return[];const i=e.getSizeSignalRef(t).signal;if("step"===r){const t=e.getScaleComponent(n);if(t){const r=t.get("type"),a=t.get("range");if(RJ(r)&&WY(a)){const r=e.scaleName(n);if(N4(e.parent)){if("independent"===e.parent.component.resolve.scale[n])return[N3(r,a)]}return[N3(r,a),{name:i,update:R3(r,t,`domain('${r}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}if("container"==r){const t=i.endsWith("width"),n=t?"containerSize()[0]":"containerSize()[1]",r=`isFinite(${n}) ? ${n} : ${t0(e.config.view,t?"width":"height")}`;return[{name:i,init:r,on:[{update:r,events:"window:resize"}]}]}return[{name:i,value:r}]}function N3(e,t){return{name:e+"_step",value:t.step}}function R3(e,t,n){const r=t.get("type"),i=t.get("padding"),a=nG(t.get("paddingOuter"),i);let o=t.get("paddingInner");return o="band"===r?void 0!==o?o:i:1,`bandspace(${n}, ${UQ(o)}, ${UQ(a)}) * ${e}_step`}function P3(e){return"childWidth"===e?"width":"childHeight"===e?"height":e}function z3(e,t){return IH(e).reduce(((n,r)=>{const i=e[r];return Object.assign(Object.assign({},n),D1(t,i,r,(e=>IQ(e.value))))}),{})}function B3(e,t){if(P4(t)||N4(t))return"shared";if(R4(t))return CX(e)?"independent":"shared";throw new Error("invalid model type for resolve")}function L3(e,t){const n=e.scale[t],r=CX(t)?"axis":"legend";return"independent"===n?("shared"===e[r][t]&&$Y(function(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}(t)),"independent"):e[r][t]||"shared"}const I3=Object.assign(Object.assign({},{aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1}),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1}),q3=IH(I3);class U3 extends Y0{}const V3={symbols:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i,legendType:a}){var o,s,l,u,c,f,d,h;if("symbol"!==a)return;const{markDef:p,encoding:m,config:g,mark:y}=n,v=p.filled&&"trail"!==y;let b=Object.assign(Object.assign({},function(e,t,n){for(const r of n){const n=HQ(r,t.markDef,t.config);void 0!==n&&(e[r]=IQ(n))}return e}({},n,dK)),P1(n,{filled:v}));const x=null!==(o=i.get("symbolOpacity"))&&void 0!==o?o:g.legend.symbolOpacity,w=null!==(s=i.get("symbolFillColor"))&&void 0!==s?s:g.legend.symbolFillColor,_=null!==(l=i.get("symbolStrokeColor"))&&void 0!==l?l:g.legend.symbolStrokeColor,k=void 0===x?null!==(u=W3(m.opacity))&&void 0!==u?u:p.opacity:void 0;if(b.fill)if("fill"===r||v&&r===qG)delete b.fill;else if(b.fill.field)w?delete b.fill:(b.fill=IQ(null!==(c=g.legend.symbolBaseFillColor)&&void 0!==c?c:"black"),b.fillOpacity=IQ(null!=k?k:1));else if(Tu(b.fill)){const e=null!==(h=null!==(d=H3(null!==(f=m.fill)&&void 0!==f?f:m.color))&&void 0!==d?d:p.fill)&&void 0!==h?h:v&&p.color;e&&(b.fill=IQ(e))}if(b.stroke)if("stroke"===r||!v&&r===qG)delete b.stroke;else if(b.stroke.field||_)delete b.stroke;else if(Tu(b.stroke)){const e=nG(H3(m.stroke||m.color),p.stroke,v?p.color:void 0);e&&(b.stroke={value:e})}if(r!==XG){const e=eQ(t)&&X3(n,i,t);e?b.opacity=[Object.assign({test:e},IQ(null!=k?k:1)),IQ(g.legend.unselectedOpacity)]:k&&(b.opacity=IQ(k))}return b=Object.assign(Object.assign({},b),e),LH(b)?void 0:b},gradient:function(e,{model:t,legendType:n,legendCmpt:r}){var i;if("gradient"!==n)return;const{config:a,markDef:o,encoding:s}=t;let l={};const u=void 0===(null!==(i=r.get("gradientOpacity"))&&void 0!==i?i:a.legend.gradientOpacity)?W3(s.opacity)||o.opacity:void 0;u&&(l.opacity=IQ(u));return l=Object.assign(Object.assign({},l),e),LH(l)?void 0:l},labels:function(e,{fieldOrDatumDef:t,model:n,channel:r,legendCmpt:i}){const a=n.legend(r)||{},o=n.config,s=eQ(t)?X3(n,i,t):void 0,l=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:u,formatType:c}=a,f=$K(c)?CK({fieldOrDatumDef:t,field:"datum.value",format:u,formatType:c,config:o}):void 0,d=Object.assign(Object.assign(Object.assign({},l?{opacity:l}:{}),f?{text:f}:{}),e);return LH(d)?void 0:d},entries:function(e,{legendCmpt:t}){const n=t.get("selections");return(null==n?void 0:n.length)?Object.assign(Object.assign({},e),{fill:{value:"transparent"}}):e}};function W3(e){return G3(e,((e,t)=>Math.max(e,t.value)))}function H3(e){return G3(e,((e,t)=>nG(e,t.value)))}function G3(e,t){return function(e){const t=e&&e.condition;return!!t&&(Tu(t)||sQ(t))}(e)?ac(e.condition).reduce(t,e.value):sQ(e)?e.value:void 0}function X3(e,t,n){const r=t.get("selections");if(!(null==r?void 0:r.length))return;const i=zc(n.field);return r.map((e=>`(!length(data(${zc(WH(e)+I2)})) || (${e}[${i}] && indexof(${e}[${i}], datum.value) >= 0))`)).join(" || ")}const Y3={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:r,formatType:i}=t;return MK(e,e.type,r,i,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:r}=e;return jK(r,t,n)},gradientLength:e=>{var t,n;const{legend:r,legendConfig:i}=e;return null!==(n=null!==(t=r.gradientLength)&&void 0!==t?t:i.gradientLength)&&void 0!==n?n:function({legendConfig:e,model:t,direction:n,orient:r,scaleType:i}){const{gradientHorizontalMaxLength:a,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:l}=e;if(zJ(i))return"horizontal"===n?"top"===r||"bottom"===r?Q3(t,"width",o,a):o:Q3(t,"height",l,s);return}(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var r,i;return null!==(i=null!==(r=e.labelOverlap)&&void 0!==r?r:t.labelOverlap)&&void 0!==i?i:function(e){if(CH(["quantile","threshold","log","symlog"],e))return"greedy";return}(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:r})=>{var i;return null!==(i=e.symbolType)&&void 0!==i?i:function(e,t,n,r){var i;if("shape"!==t){const e=null!==(i=H3(n))&&void 0!==i?i:r;if(e)return e}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}(t.type,n,r.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>bQ(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(dX(n)&&zJ(t)){if("gradient"===e)return}else if("symbol"===e)return;return e},values:({fieldOrDatumDef:e,legend:t})=>function(e,t){const n=e.values;if(Tu(n))return jQ(t,n);if(VY(n))return n;return}(t,e)};function J3(e){const{legend:t}=e;return nG(t.type,function({channel:e,timeUnit:t,scaleType:n}){if(dX(e)){if(CH(["quarter","month","day"],t))return"symbol";if(zJ(n))return"gradient"}return"symbol"}(e))}function K3({legendConfig:e,legendType:t,orient:n,legend:r}){var i,a;return null!==(a=null!==(i=r.direction)&&void 0!==i?i:e[t?"gradientDirection":"symbolDirection"])&&void 0!==a?a:function(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return"gradient"===t?"horizontal":void 0}}(n,t)}function Q3(e,t,n,r){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${r})`}}function Z3(e){const t=T4(e)?function(e){const{encoding:t}=e,n={};for(const r of[qG,...IZ]){const i=OQ(t[r]);i&&e.getScaleComponent(r)&&(r===WG&&eQ(i)&&i.type===dJ||(n[r]=t5(e,r)))}return n}(e):function(e){const{legends:t,resolve:n}=e.component;for(const r of e.children){Z3(r);for(const i of IH(r.component.legends))n.legend[i]=L3(e.component.resolve,i),"shared"===n.legend[i]&&(t[i]=n5(t[i],r.component.legends[i]),t[i]||(n.legend[i]="independent",delete t[i]))}for(const r of IH(t))for(const t of e.children)t.component.legends[r]&&"shared"===n.legend[r]&&delete t.component.legends[r];return t}(e);return e.component.legends=t,t}function e5(e,t,n,r){switch(t){case"disable":return void 0!==n;case"values":return!!(null==n?void 0:n.values);case"title":if("title"===t&&e===(null==r?void 0:r.title))return!0}return e===(n||{})[t]}function t5(e,t){var n,r,i;let a=e.legend(t);const{markDef:o,encoding:s,config:l}=e,u=l.legend,c=new U3({},function(e,t){const n=e.scaleName(t);if("trail"===e.mark){if("color"===t)return{stroke:n};if("size"===t)return{strokeWidth:n}}return"color"===t?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}(e,t));!function(e,t,n){var r;const i=null===(r=e.fieldDef(t))||void 0===r?void 0:r.field;H2(e,(e=>{var r,a;const o=null!==(r=e.project.hasField[i])&&void 0!==r?r:e.project.hasChannel[t];if(o&&v2.has(e)){const t=null!==(a=n.get("selections"))&&void 0!==a?a:[];t.push(e.name),n.set("selections",t,!1),o.hasLegend=!0}}))}(e,t,c);const f=void 0!==a?!a:u.disable;if(c.set("disable",f,void 0!==a),f)return c;a=a||{};const d=e.getScaleComponent(t).get("type"),h=OQ(s[t]),p=eQ(h)?null===(n=UY(h.timeUnit))||void 0===n?void 0:n.unit:void 0,m=a.orient||l.legend.orient||"right",g=J3({legend:a,channel:t,timeUnit:p,scaleType:d}),y={legend:a,channel:t,model:e,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:u,config:l,scaleType:d,orient:m,legendType:g,direction:K3({legend:a,legendType:g,orient:m,legendConfig:u})};for(const n of q3){if("gradient"===g&&n.startsWith("symbol")||"symbol"===g&&n.startsWith("gradient"))continue;const r=n in Y3?Y3[n](y):a[n];if(void 0!==r){const i=e5(r,n,a,e.fieldDef(t));(i||void 0===l.legend[n])&&c.set(n,r,i)}}const v=null!==(r=null==a?void 0:a.encoding)&&void 0!==r?r:{},b=c.get("selections"),x={},w={fieldOrDatumDef:h,model:e,channel:t,legendCmpt:c,legendType:g};for(const t of["labels","legend","title","symbols","gradient","entries"]){const n=z3(null!==(i=v[t])&&void 0!==i?i:{},e),r=t in V3?V3[t](n,w):n;void 0===r||LH(r)||(x[t]=Object.assign(Object.assign(Object.assign({},(null==b?void 0:b.length)&&eQ(h)?{name:`${WH(h.field)}_legend_${t}`}:{}),(null==b?void 0:b.length)?{interactive:!!b}:{}),{update:r}))}return LH(x)||c.set("encode",x,!!(null==a?void 0:a.encoding)),c}function n5(e,t){var n,r,i,a;if(!e)return t.clone();const o=e.getWithExplicit("orient"),s=t.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value)return;let l=!1;for(const n of q3){const r=e1(e.getWithExplicit(n),t.getWithExplicit(n),n,"legend",((e,t)=>{switch(n){case"symbolType":return r5(e,t);case"title":return QQ(e,t);case"type":return l=!0,K0("symbol")}return Z0(e,t,n,"legend")}));e.setWithExplicit(n,r)}return l&&((null===(r=null===(n=e.implicit)||void 0===n?void 0:n.encode)||void 0===r?void 0:r.gradient)&&GH(e.implicit,["encode","gradient"]),(null===(a=null===(i=e.explicit)||void 0===i?void 0:i.encode)||void 0===a?void 0:a.gradient)&&GH(e.explicit,["encode","gradient"])),e}function r5(e,t){return"circle"===t.value?t:e}var i5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function a5(e){const t=e.component.legends,n={};for(const r of IH(t)){const i=e.getScaleComponent(r),a=EH(i.get("domains"));if(n[a])for(const e of n[a]){n5(e,t[r])||n[a].push(t[r])}else n[a]=[t[r].clone()]}return qH(n).flat().map((t=>function(e,t){var n,r,i;const a=e.combine(),{disable:o,labelExpr:s,selections:l}=a,u=i5(a,["disable","labelExpr","selections"]);if(o)return;!1===t.aria&&null==u.aria&&(u.aria=!1);if(null===(n=u.encode)||void 0===n?void 0:n.symbols){const e=u.encode.symbols.update;!e.fill||"transparent"===e.fill.value||e.stroke||u.stroke||(e.stroke={value:"transparent"});for(const t of IZ)u[t]&&delete e[t]}u.title||delete u.title;if(void 0!==s){let e=s;(null===(i=null===(r=u.encode)||void 0===r?void 0:r.labels)||void 0===i?void 0:i.update)&&VY(u.encode.labels.update.text)&&(e=ZH(s,"datum.label",u.encode.labels.update.text.signal)),function(e,t,n,r){var i,a,o;e.encode=null!==(i=e.encode)&&void 0!==i?i:{},e.encode[t]=null!==(a=e.encode[t])&&void 0!==a?a:{},e.encode[t].update=null!==(o=e.encode[t].update)&&void 0!==o?o:{},e.encode[t].update[n]=r}(u,"labels","text",{signal:e})}return u}(t,e.config))).filter((e=>void 0!==e))}function o5(e){return P4(e)||R4(e)?function(e){return e.children.reduce(((e,t)=>e.concat(t.assembleProjections())),s5(e))}(e):s5(e)}function s5(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:r}=n;if(t.data){const i={signal:`[${t.size.map((e=>e.signal)).join(", ")}]`},a=t.data.reduce(((t,n)=>{const r=VY(n)?n.signal:`data('${e.lookupDataSource(n)}')`;return CH(t,r)||t.push(r),t}),[]);if(a.length<=0)throw new Error("Projection's fit didn't find any data sources");return[Object.assign({name:r,size:i,fit:{signal:a.length>1?`[${a.join(", ")}]`:a[0]}},n)]}return[Object.assign(Object.assign({name:r},{translate:{signal:"[width / 2, height / 2]"}}),n)]}const l5=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class u5 extends Y0{constructor(e,t,n,r){super(Object.assign({},t),{name:e}),this.specifiedProjection=t,this.size=n,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function c5(e){e.component.projection=T4(e)?function(e){var t;if(e.hasProjection){const n=e.specifiedProjection,r=!(n&&(null!=n.scale||null!=n.translate)),i=r?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,a=r?function(e){const t=[],{encoding:n}=e;for(const r of[[BG,zG],[IG,LG]])(OQ(n[r[0]])||OQ(n[r[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});e.channelHasField(WG)&&e.typedFieldDef(WG).type===dJ&&t.push({signal:e.getName(`geojson_${t.length}`)});0===t.length&&t.push(e.requestDataName(u1.Main));return t}(e):void 0;return new u5(e.projectionName(!0),Object.assign(Object.assign({},null!==(t=e.config.projection)&&void 0!==t?t:{}),null!=n?n:{}),i,a)}return}(e):function(e){if(0===e.children.length)return;let t;for(const t of e.children)c5(t);const n=jH(e.children,(e=>{const n=e.component.projection;if(n){if(t){const e=function(e,t){const n=jH(l5,(n=>!bc(e.explicit,n)&&!bc(t.explicit,n)||!(!bc(e.explicit,n)||!bc(t.explicit,n)||EH(e.get(n))!==EH(t.get(n)))));if(EH(e.size)===EH(t.size)){if(n)return e;if(EH(e.explicit)===EH({}))return t;if(EH(t.explicit)===EH({}))return e}return null}(t,n);return e&&(t=e),!!e}return t=n,!0}return!0}));if(t&&n){const n=e.projectionName(!0),r=new u5(n,t.specifiedProjection,t.size,OH(t.data));for(const t of e.children){const e=t.component.projection;e&&(e.isFit&&r.data.push(...t.component.projection.data),t.renameProjection(e.get("name"),n),e.merged=!0)}return r}return}(e)}var f5=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function d5(e,t){return`${UX(e)}_${t}`}function h5(e,t,n){var r;const i=d5(null!==(r=AQ(n,void 0))&&void 0!==r?r:{},t);return e.getName(`${i}_bins`)}function p5(e,t,n){let r,i;r=function(e){return"as"in e}(e)?Cc(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:[hQ(e,{forAs:!0}),hQ(e,{binSuffix:"end",forAs:!0})];const a=Object.assign({},AQ(t,void 0)),o=d5(a,e.field),{signal:s,extentSignal:l}=function(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}(n,o);if(GX(a.extent)){const e=a.extent,t=e.selection;i=t3(n.getSelectionComponent(WH(t),t),e),delete a.extent}return{key:o,binComponent:Object.assign(Object.assign(Object.assign({bin:a,field:e.field,as:[r]},s?{signal:s}:{}),l?{extentSignal:l}:{}),i?{span:i}:{})}}class m5 extends i2{constructor(e,t){super(e),this.bins=t}clone(){return new m5(null,OH(this.bins))}static makeFromEncoding(e,t){const n=t.reduceFieldDef(((e,n,r)=>{if(oQ(n)&&VX(n.bin)){const{key:i,binComponent:a}=p5(n,n.bin,t);e[i]=Object.assign(Object.assign(Object.assign({},a),e[i]),function(e,t,n,r){var i,a;if(FQ(t,n)){const o=T4(e)&&null!==(a=null!==(i=e.axis(n))&&void 0!==i?i:e.legend(n))&&void 0!==a?a:{},s=hQ(t,{expr:"datum"}),l=hQ(t,{expr:"datum",binSuffix:"end"});return{formulaAs:hQ(t,{binSuffix:"range",forAs:!0}),formula:RK(s,l,o.format,o.formatType,r)}}return{}}(t,n,r,t.config))}return e}),{});return LH(n)?null:new m5(e,n)}static makeFromTransform(e,t,n){const{key:r,binComponent:i}=p5(t,t.bin,n);return new m5(e,{[r]:i})}merge(e,t){for(const n of IH(e.bins))n in this.bins?(t(e.bins[n].signal,this.bins[n].signal),this.bins[n].as=NH([...this.bins[n].as,...e.bins[n].as],AH)):this.bins[n]=e.bins[n];for(const t of e.children)e.removeChild(t),t.parent=this;e.remove()}producedFields(){return new Set(qH(this.bins).map((e=>e.as)).flat(2))}dependentFields(){return new Set(qH(this.bins).map((e=>e.field)))}hash(){return`Bin ${AH(this.bins)}`}assemble(){return qH(this.bins).flatMap((e=>{const t=[],[n,...r]=e.as,i=e.bin,{extent:a}=i,o=f5(i,["extent"]),s=Object.assign(Object.assign(Object.assign({type:"bin",field:QH(e.field),as:n,signal:e.signal},GX(a)?{extent:null}:{extent:a}),e.span?{span:{signal:`span(${e.span})`}}:{}),o);!a&&e.extentSignal&&(t.push({type:"extent",field:QH(e.field),signal:e.extentSignal}),s.extent={signal:e.extentSignal}),t.push(s);for(const e of r)for(let r=0;r<2;r++)t.push({type:"formula",expr:hQ({field:n[r]},{expr:"datum"}),as:e[r]});return e.formula&&t.push({type:"formula",expr:e.formula,as:e.formulaAs}),t}))}}function g5(e,t,n,r){const i=T4(r)?r.encoding[OX(t)]:void 0;if(oQ(n)&&T4(r)&&JK(t,n,i,r.stack,r.markDef,r.config))e.add(hQ(n,{})),e.add(hQ(n,{suffix:"end"})),n.bin&&FQ(n,t)&&e.add(hQ(n,{binSuffix:"range"}));else if(function(e){return e in uX}(t)){const n=function(e){switch(e){case zG:return"y";case LG:return"y2";case BG:return"x";case IG:return"x2"}}(t);e.add(r.getName(n))}else e.add(hQ(n));return e}class y5 extends i2{constructor(e,t,n){super(e),this.dimensions=t,this.measures=n}clone(){return new y5(null,new Set(this.dimensions),OH(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(e,t){let n=!1;t.forEachFieldDef((e=>{e.aggregate&&(n=!0)}));const r={},i=new Set;return n?(t.forEachFieldDef(((e,n)=>{var a,o,s,l;const{aggregate:u,field:c}=e;if(u)if("count"===u)r["*"]=null!==(a=r["*"])&&void 0!==a?a:{},r["*"].count=new Set([hQ(e,{forAs:!0})]);else{if(bG(u)||xG(u)){const e=bG(u)?"argmin":"argmax",t=u[e];r[t]=null!==(o=r[t])&&void 0!==o?o:{},r[t][e]=new Set([hQ({op:e,field:t},{forAs:!0})])}else r[c]=null!==(s=r[c])&&void 0!==s?s:{},r[c][u]=new Set([hQ(e,{forAs:!0})]);zX(n)&&"unaggregated"===t.scaleDomain(n)&&(r[c]=null!==(l=r[c])&&void 0!==l?l:{},r[c].min=new Set([hQ({field:c,aggregate:"min"},{forAs:!0})]),r[c].max=new Set([hQ({field:c,aggregate:"max"},{forAs:!0})]))}else g5(i,n,e,t)})),i.size+IH(r).length===0?null:new y5(e,i,r)):null}static makeFromTransform(e,t){var n,r,i;const a=new Set,o={};for(const e of t.aggregate){const{op:t,field:i,as:a}=e;t&&("count"===t?(o["*"]=null!==(n=o["*"])&&void 0!==n?n:{},o["*"].count=new Set([a||hQ(e,{forAs:!0})])):(o[i]=null!==(r=o[i])&&void 0!==r?r:{},o[i][t]=new Set([a||hQ(e,{forAs:!0})])))}for(const e of null!==(i=t.groupby)&&void 0!==i?i:[])a.add(e);return a.size+IH(o).length===0?null:new y5(e,a,o)}merge(e){return RH(this.dimensions,e.dimensions)?(function(e,t){var n;for(const r of IH(t)){const i=t[r];for(const t of IH(i))r in e?e[r][t]=new Set([...null!==(n=e[r][t])&&void 0!==n?n:[],...i[t]]):e[r]={[t]:i[t]}}}(this.measures,e.measures),!0):(function(...e){SY.debug(...e)}("different dimensions, cannot merge"),!1)}addDimensions(e){e.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...IH(this.measures)])}producedFields(){const e=new Set;for(const t of IH(this.measures))for(const n of IH(this.measures[t])){const r=this.measures[t][n];0===r.size?e.add(`${n}_${t}`):r.forEach(e.add,e)}return e}hash(){return`Aggregate ${AH({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const e=[],t=[],n=[];for(const r of IH(this.measures))for(const i of IH(this.measures[r]))for(const a of this.measures[r][i])n.push(a),e.push(i),t.push("*"===r?null:QH(r));return{type:"aggregate",groupby:[...this.dimensions].map(QH),ops:e,fields:t,as:n}}}class v5 extends i2{constructor(e,t,n,r){super(e),this.model=t,this.name=n,this.data=r;for(const e of pX){const n=t.facet[e];if(n){const{bin:r,sort:i}=n;this[e]=Object.assign({name:t.getName(`${e}_domain`),fields:[hQ(n),...VX(r)?[hQ(n,{binSuffix:"end"})]:[]]},IK(i)?{sortField:i}:Tu(i)?{sortIndexField:y3(n,e)}:{})}}this.childModel=t.child}hash(){let e="Facet";for(const t of pX)this[t]&&(e+=` ${t.charAt(0)}:${AH(this[t])}`);return e}get fields(){var e;const t=[];for(const n of pX)(null===(e=this[n])||void 0===e?void 0:e.fields)&&t.push(...this[n].fields);return t}dependentFields(){const e=new Set(this.fields);for(const t of pX)this[t]&&(this[t].sortField&&e.add(this[t].sortField.field),this[t].sortIndexField&&e.add(this[t].sortIndexField));return e}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const e={};for(const t of DX){const n=this.childModel.component.scales[t];if(n&&!n.merged){const r=n.get("type"),i=n.get("range");if(RJ(r)&&WY(i)){const n=f4(d4(this.childModel,t));n?e[t]=n:$Y(eY(t))}}}return e}assembleRowColumnHeaderData(e,t,n){const r={row:"y",column:"x"}[e],i=[],a=[],o=[];n&&n[r]&&(t?(i.push(`distinct_${n[r]}`),a.push("max")):(i.push(n[r]),a.push("distinct")),o.push(`distinct_${n[r]}`));const{sortField:s,sortIndexField:l}=this[e];if(s){const{op:e=PK,field:t}=s;i.push(t),a.push(e),o.push(hQ(s,{forAs:!0}))}else l&&(i.push(l),a.push("max"),o.push(l));return{name:this[e].name,source:null!=t?t:this.data,transform:[Object.assign({type:"aggregate",groupby:this[e].fields},i.length?{fields:i,ops:a,as:o}:{})]}}assembleFacetHeaderData(e){var t,n;const{columns:r}=this.model.layout,{layoutHeaders:i}=this.model.component,a=[],o={};for(const e of w3){for(const r of _3){const a=null!==(t=i[e]&&i[e][r])&&void 0!==t?t:[];for(const t of a)if((null===(n=t.axes)||void 0===n?void 0:n.length)>0){o[e]=!0;break}}if(o[e]){const t=`length(data("${this.facet.name}"))`,n="row"===e?r?{signal:`ceil(${t} / ${r})`}:1:r?{signal:`min(${t}, ${r})`}:{signal:t};a.push({name:`${this.facet.name}_${e}`,transform:[{type:"sequence",start:0,stop:n}]})}}const{row:s,column:l}=o;return(s||l)&&a.unshift(this.assembleRowColumnHeaderData("facet",null,e)),a}assemble(){var e,t;const n=[];let r=null;const i=this.getChildIndependentFieldsWithStep(),{column:a,row:o,facet:s}=this;if(a&&o&&(i.x||i.y)){r=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(null!==(e=i.x)&&void 0!==e?e:[],null!==(t=i.y)&&void 0!==t?t:[]),o=a.map((()=>"distinct"));n.push({name:r,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:o}]})}for(const e of[AG,EG])this[e]&&n.push(this.assembleRowColumnHeaderData(e,r,i));if(s){const e=this.assembleFacetHeaderData(i);e&&n.push(...e)}return n}}function b5(e){return"'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]?e.slice(1,-1):e}function x5(e){const t={};return wH(e.filter,(e=>{var n;if(rJ(e)){let r=null;JY(e)?r=BQ(e.equal):QY(e)?r=BQ(e.lte):KY(e)?r=BQ(e.lt):ZY(e)?r=BQ(e.gt):eJ(e)?r=BQ(e.gte):tJ(e)?r=e.range[0]:nJ(e)&&(r=(null!==(n=e.oneOf)&&void 0!==n?n:e.in)[0]),r&&(EY(r)?t[e.field]="date":Ac(r)?t[e.field]="number":Cc(r)&&(t[e.field]="string")),e.timeUnit&&(t[e.field]="date")}})),t}function w5(e){const t={};function n(e){var n;CQ(e)?t[e.field]="date":"quantitative"===e.type&&(Cc(n=e.aggregate)&&CH(["min","max"],n))?t[e.field]="number":tG(e.field)>1?e.field in t||(t[e.field]="flatten"):lQ(e)&&IK(e.sort)&&tG(e.sort.field)>1&&(e.sort.field in t||(t[e.sort.field]="flatten"))}if((T4(e)||N4(e))&&e.forEachFieldDef(((t,r)=>{if(oQ(t))n(t);else{const i=_X(r),a=e.fieldDef(i);n(Object.assign(Object.assign({},t),{type:a.type}))}})),T4(e)){const{mark:n,markDef:r,encoding:i}=e;if(lK(n)&&!e.encoding.order){const e=i["horizontal"===r.orient?"y":"x"];eQ(e)&&"quantitative"===e.type&&!(e.field in t)&&(t[e.field]="number")}}return t}class _5 extends i2{constructor(e,t){super(e),this._parse=t}clone(){return new _5(null,OH(this._parse))}hash(){return`Parse ${AH(this._parse)}`}static makeExplicit(e,t,n){let r={};const i=t.data;return!a1(i)&&i&&i.format&&i.format.parse&&(r=i.format.parse),this.makeWithAncestors(e,r,{},n)}static makeWithAncestors(e,t,n,r){for(const e of IH(n)){const t=r.getWithExplicit(e);void 0!==t.value&&(t.explicit||t.value===n[e]||"derived"===t.value||"flatten"===n[e]?delete n[e]:$Y(oY(e,n[e],t.value)))}for(const e of IH(t)){const n=r.get(e);void 0!==n&&(n===t[e]?delete t[e]:$Y(oY(e,t[e],n)))}const i=new Y0(t,n);r.copyAll(i);const a={};for(const e of IH(i.combine())){const t=i.get(e);null!==t&&(a[e]=t)}return 0===IH(a).length||r.parseNothing?null:new _5(e,a)}get parse(){return this._parse}merge(e){this._parse=Object.assign(Object.assign({},this._parse),e.parse),e.remove()}assembleFormatParse(){const e={};for(const t of IH(this._parse)){const n=this._parse[t];1===tG(t)&&(e[t]=n)}return e}producedFields(){return new Set(IH(this._parse))}dependentFields(){return new Set(IH(this._parse))}assembleTransforms(e=!1){return IH(this._parse).filter((t=>!e||tG(t)>1)).map((e=>{const t=function(e,t){const n=YH(e);if("number"===t)return`toNumber(${n})`;if("boolean"===t)return`toBoolean(${n})`;if("string"===t)return`toString(${n})`;if("date"===t)return`toDate(${n})`;if("flatten"===t)return n;if(0===t.indexOf("date:"))return`timeParse(${n},'${b5(t.slice(5,t.length))}')`;if(0===t.indexOf("utc:"))return`utcParse(${n},'${b5(t.slice(4,t.length))}')`;return $Y(`Unrecognized parse "${t}".`),null}(e,this._parse[e]);if(!t)return null;return{type:"formula",expr:t,as:eG(e)}})).filter((e=>null!==e))}}class k5 extends i2{clone(){return new k5(null)}constructor(e){super(e)}dependentFields(){return new Set}producedFields(){return new Set([VZ])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:VZ}}}class O5 extends i2{constructor(e,t){super(e),this.params=t}clone(){return new O5(null,this.params)}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${AH(this.params)}`}assemble(){return Object.assign({type:"graticule"},!0===this.params?{}:this.params)}}class S5 extends i2{constructor(e,t){super(e),this.params=t}clone(){return new S5(null,this.params)}dependentFields(){return new Set}producedFields(){var e;return new Set([null!==(e=this.params.as)&&void 0!==e?e:"data"])}hash(){return`Hash ${AH(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class $5 extends i2{constructor(e){let t;if(super(null),a1(e=null!=e?e:{name:"source"})||(t=e.format?Object.assign({},$H(e.format,["parse"])):{}),r1(e))this._data={values:e.values};else if(n1(e)){if(this._data={url:e.url},!t.type){let n=/(?:\.([^.]+))?$/.exec(e.url)[1];CH(["json","csv","tsv","dsv","topojson"],n)||(n="json"),t.type=n}}else s1(e)?this._data={values:[{type:"Sphere"}]}:(i1(e)||a1(e))&&(this._data={});this._generator=a1(e),e.name&&(this._name=e.name),t&&!LH(t)&&(this._data.format=t)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(e){this._name=e}set parent(e){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var E5,A5=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},D5=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};function C5(e){return e instanceof $5||e instanceof O5||e instanceof S5}class M5{constructor(){E5.set(this,void 0),A5(this,E5,!1)}setModified(){A5(this,E5,!0)}get modifiedFlag(){return D5(this,E5)}}E5=new WeakMap;class j5 extends M5{getNodeDepths(e,t,n){n.set(e,t);for(const r of e.children)this.getNodeDepths(r,t+1,n);return n}optimize(e){const t=[...this.getNodeDepths(e,0,new Map).entries()].sort(((e,t)=>t[1]-e[1]));for(const e of t)this.run(e[0]);return this.modifiedFlag}}class F5 extends M5{optimize(e){this.run(e);for(const t of e.children)this.optimize(t);return this.modifiedFlag}}class T5 extends F5{mergeNodes(e,t){const n=t.shift();for(const r of t)e.removeChild(r),r.parent=n,r.remove()}run(e){const t=e.children.map((e=>e.hash())),n={};for(let r=0;r<t.length;r++)void 0===n[t[r]]?n[t[r]]=[e.children[r]]:n[t[r]].push(e.children[r]);for(const t of IH(n))n[t].length>1&&(this.setModified(),this.mergeNodes(e,n[t]))}}class N5 extends F5{constructor(e){super(),this.requiresSelectionId=e&&X2(e)}run(e){e instanceof k5&&(this.requiresSelectionId&&(C5(e.parent)||e.parent instanceof y5||e.parent instanceof _5)||(this.setModified(),e.remove()))}}class R5 extends M5{optimize(e){return this.run(e,new Set),this.modifiedFlag}run(e,t){let n=new Set;e instanceof s2&&(n=e.producedFields(),PH(n,t)&&(this.setModified(),e.removeFormulas(t),0===e.producedFields.length&&e.remove()));for(const r of e.children)this.run(r,new Set([...t,...n]))}}class P5 extends F5{constructor(){super()}run(e){e instanceof a2&&!e.isRequired()&&(this.setModified(),e.remove())}}class z5 extends j5{run(e){if(!(C5(e)||e.numChildren()>1))for(const t of e.children)if(t instanceof _5)if(e instanceof _5)this.setModified(),e.merge(t);else{if(BH(e.producedFields(),t.dependentFields()))continue;this.setModified(),t.swapWithParent()}}}class B5 extends j5{run(e){const t=[...e.children],n=e.children.filter((e=>e instanceof _5));if(e.numChildren()>1&&n.length>=1){const r={},i=new Set;for(const e of n){const t=e.parse;for(const e of IH(t))e in r?r[e]!==t[e]&&i.add(e):r[e]=t[e]}for(const e of i)delete r[e];if(!LH(r)){this.setModified();const n=new _5(e,r);for(const i of t){if(i instanceof _5)for(const e of IH(r))delete i.parse[e];e.removeChild(i),i.parent=n,i instanceof _5&&0===IH(i.parse).length&&i.remove()}}}}}class L5 extends j5{run(e){e instanceof a2||e.numChildren()>0||e instanceof v5||e instanceof $5||(this.setModified(),e.remove())}}class I5 extends j5{run(e){const t=e.children.filter((e=>e instanceof s2)),n=t.pop();for(const e of t)this.setModified(),n.merge(e)}}class q5 extends j5{run(e){const t=e.children.filter((e=>e instanceof y5)),n={};for(const e of t){const t=AH(e.groupBy);t in n||(n[t]=[]),n[t].push(e)}for(const t of IH(n)){const r=n[t];if(r.length>1){const t=r.pop();for(const n of r)t.merge(n)&&(e.removeChild(n),n.parent=t,n.remove(),this.setModified())}}}}class U5 extends j5{constructor(e){super(),this.model=e}run(e){const t=!(C5(e)||e instanceof Q2||e instanceof _5||e instanceof k5),n=[],r=[];for(const i of e.children)i instanceof m5&&(t&&!BH(e.producedFields(),i.dependentFields())?n.push(i):r.push(i));if(n.length>0){const t=n.pop();for(const e of n)t.merge(e,this.model.renameSignal.bind(this.model));this.setModified(),e instanceof m5?e.merge(t,this.model.renameSignal.bind(this.model)):t.swapWithParent()}if(r.length>1){const e=r.pop();for(const t of r)e.merge(t,this.model.renameSignal.bind(this.model));this.setModified()}}}class V5 extends j5{run(e){const t=[...e.children];if(!MH(t,(e=>e instanceof a2))||e.numChildren()<=1)return;const n=[];let r;for(const i of t)if(i instanceof a2){let t=i;for(;1===t.numChildren();){const[e]=t.children;if(!(e instanceof a2))break;t=e}n.push(...t.children),r?(e.removeChild(i),i.parent=r.parent,r.parent.removeChild(r),r.parent=t,this.setModified()):r=t}else n.push(i);if(n.length){this.setModified();for(const e of n)e.parent.removeChild(e),e.parent=r}}}class W5 extends i2{constructor(e,t){super(e),this.transform=t}clone(){return new W5(null,OH(this.transform))}addDimensions(e){this.transform.groupby=NH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){const e=new Set;return this.transform.groupby&&this.transform.groupby.forEach(e.add,e),this.transform.joinaggregate.map((e=>e.field)).filter((e=>void 0!==e)).forEach(e.add,e),e}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:hQ(e)}hash(){return`JoinAggregateTransform ${AH(this.transform)}`}assemble(){const e=[],t=[],n=[];for(const r of this.transform.joinaggregate)t.push(r.op),n.push(this.getDefaultName(r)),e.push(void 0===r.field?null:r.field);const r=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:t,fields:e},void 0!==r?{groupby:r}:{})}}class H5 extends i2{constructor(e,t){super(e),this._stack=t}clone(){return new H5(null,OH(this._stack))}static makeFromTransform(e,t){const{stack:n,groupby:r,as:i,offset:a="zero"}=t,o=[],s=[];if(void 0!==t.sort)for(const e of t.sort)o.push(e.field),s.push(nG(e.order,"ascending"));const l={field:o,order:s};let u;return u=function(e){return Tu(e)&&e.every((e=>Cc(e)))&&e.length>1}(i)?i:Cc(i)?[i,i+"_end"]:[t.stack+"_start",t.stack+"_end"],new H5(e,{stackField:n,groupby:r,offset:a,sort:l,facetby:[],as:u})}static makeFromEncoding(e,t){const n=t.stack,{encoding:r}=t;if(!n)return null;const{groupbyChannel:i,fieldChannel:a,offset:o,impute:s}=n;let l;if(i){l=kQ(r[i])}const u=function(e){return e.stack.stackBy.reduce(((e,t)=>{const n=hQ(t.fieldDef);return n&&e.push(n),e}),[])}(t),c=t.encoding.order;let f;return f=Tu(c)||eQ(c)?YQ(c):u.reduce(((e,t)=>(e.field.push(t),e.order.push("y"===a?"descending":"ascending"),e)),{field:[],order:[]}),new H5(e,{dimensionFieldDef:l,stackField:t.vgField(a),facetby:[],stackby:u,sort:f,offset:o,impute:s,as:[t.vgField(a,{suffix:"start",forAs:!0}),t.vgField(a,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(e){this._stack.facetby.push(...e)}dependentFields(){const e=new Set;return e.add(this._stack.stackField),this.getGroupbyFields().forEach(e.add,e),this._stack.facetby.forEach(e.add,e),this._stack.sort.field.forEach(e.add,e),e}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${AH(this._stack)}`}getGroupbyFields(){const{dimensionFieldDef:e,impute:t,groupby:n}=this._stack;return e?e.bin?t?[hQ(e,{binSuffix:"mid"})]:[hQ(e,{}),hQ(e,{binSuffix:"end"})]:[hQ(e)]:null!=n?n:[]}assemble(){const e=[],{facetby:t,dimensionFieldDef:n,stackField:r,stackby:i,sort:a,offset:o,impute:s,as:l}=this._stack;if(s&&n){const{band:a=.5,bin:o}=n;o&&e.push({type:"formula",expr:`${a}*`+hQ(n,{expr:"datum"})+`+${1-a}*`+hQ(n,{expr:"datum",binSuffix:"end"}),as:hQ(n,{binSuffix:"mid",forAs:!0})}),e.push({type:"impute",field:r,groupby:[...i,...t],key:hQ(n,{binSuffix:"mid"}),method:"value",value:0})}return e.push({type:"stack",groupby:[...this.getGroupbyFields(),...t],field:r,sort:a,as:l,offset:o}),e}}class G5 extends i2{constructor(e,t){super(e),this.transform=t}clone(){return new G5(null,OH(this.transform))}addDimensions(e){this.transform.groupby=NH(this.transform.groupby.concat(e),(e=>e))}dependentFields(){var e,t;const n=new Set;return(null!==(e=this.transform.groupby)&&void 0!==e?e:[]).forEach(n.add,n),(null!==(t=this.transform.sort)&&void 0!==t?t:[]).forEach((e=>n.add(e.field))),this.transform.window.map((e=>e.field)).filter((e=>void 0!==e)).forEach(n.add,n),n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(e){var t;return null!==(t=e.as)&&void 0!==t?t:hQ(e)}hash(){return`WindowTransform ${AH(this.transform)}`}assemble(){var e;const t=[],n=[],r=[],i=[];for(const e of this.transform.window)n.push(e.op),r.push(this.getDefaultName(e)),i.push(void 0===e.param?null:e.param),t.push(void 0===e.field?null:e.field);const a=this.transform.frame,o=this.transform.groupby;if(a&&null===a[0]&&null===a[1]&&n.every((e=>wG(e))))return Object.assign({type:"joinaggregate",as:r,ops:n,fields:t},void 0!==o?{groupby:o}:{});const s=[],l=[];if(void 0!==this.transform.sort)for(const t of this.transform.sort)s.push(t.field),l.push(null!==(e=t.order)&&void 0!==e?e:"ascending");const u={field:s,order:l},c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:i,as:r,ops:n,fields:t,sort:u},void 0!==c?{ignorePeers:c}:{}),void 0!==o?{groupby:o}:{}),void 0!==a?{frame:a}:{})}}function X5(e){if(e instanceof v5)if(1!==e.numChildren()||e.children[0]instanceof a2){const n=e.model.component.data.main;Y5(n);const r=(t=e,function e(n){if(!(n instanceof v5)){const r=n.clone();if(r instanceof a2){const e=J5+r.getSource();r.setSource(e),t.model.component.data.outputNodes[e]=r}else(r instanceof y5||r instanceof H5||r instanceof G5||r instanceof W5)&&r.addDimensions(t.fields);for(const t of n.children.flatMap(e))t.parent=r;return[r]}return n.children.flatMap(e)}),i=e.children.map(r).flat();for(const e of i)e.parent=n}else{const t=e.children[0];(t instanceof y5||t instanceof H5||t instanceof G5||t instanceof W5)&&t.addDimensions(e.fields),t.swapWithParent(),X5(e)}else e.children.map(X5);var t}function Y5(e){if(e instanceof a2&&e.type===u1.Main&&1===e.numChildren()){const t=e.children[0];t instanceof v5||(t.swapWithParent(),Y5(e))}}const J5="scale_";function K5(e){for(const t of e){for(const e of t.children)if(e.parent!==t)return!1;if(!K5(t.children))return!1}return!0}function Q5(e,t){let n=!1;for(const r of t)n=e.optimize(r)||n;return n}function Z5(e,t,n){let r=e.sources,i=!1;return i=Q5(new P5,r)||i,i=Q5(new N5(t),r)||i,r=r.filter((e=>e.numChildren()>0)),i=Q5(new L5,r)||i,r=r.filter((e=>e.numChildren()>0)),n||(i=Q5(new z5,r)||i,i=Q5(new U5(t),r)||i,i=Q5(new R5,r)||i,i=Q5(new B5,r)||i,i=Q5(new q5,r)||i,i=Q5(new I5,r)||i,i=Q5(new T5,r)||i,i=Q5(new V5,r)||i),e.sources=r,i}class e4{constructor(e){Object.defineProperty(this,"signal",{enumerable:!0,get:e})}static fromName(e,t){return new e4((()=>e(t)))}}var t4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function n4(e){T4(e)?function(e){const t=e.component.scales;for(const n of IH(t)){const r=r4(e,n);if(t[n].setWithExplicit("domains",r),s4(e,n),e.component.data.isFaceted){let t=e;for(;!N4(t)&&t.parent;)t=t.parent;if("shared"===t.component.resolve.scale[n])for(const e of r.value)HY(e)&&(e.data=J5+e.data.replace(J5,""))}}}(e):function(e){for(const t of e.children)n4(t);const t=e.component.scales;for(const n of IH(t)){let r,i=null;for(const t of e.children){const e=t.component.scales[n];if(e){r=void 0===r?e.getWithExplicit("domains"):e1(r,e.getWithExplicit("domains"),"domains","scale",u4);const t=e.get("selectionExtent");i&&t&&i.selection!==t.selection&&$Y(iY),i=t}}t[n].setWithExplicit("domains",r),i&&t[n].set("selectionExtent",i,!0)}}(e)}function r4(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:r}=e,i=function(e,t,n,r){if("unaggregated"===e){const{valid:e,reason:r}=l4(t,n);if(!e)return void $Y(r)}else if(void 0===e&&r.useUnaggregatedDomain){const{valid:e}=l4(t,n);if(e)return"unaggregated"}return e}(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return i!==e.scaleDomain(t)&&(e.specifiedScales[t]=Object.assign(Object.assign({},e.specifiedScales[t]),{domain:i})),"x"===t&&OQ(r.x2)?OQ(r.x)?e1(a4(n,i,e,"x"),a4(n,i,e,"x2"),"domain","scale",u4):a4(n,i,e,"x2"):"y"===t&&OQ(r.y2)?OQ(r.y)?e1(a4(n,i,e,"y"),a4(n,i,e,"y2"),"domain","scale",u4):a4(n,i,e,"y2"):a4(n,i,e,t)}function i4(e,t,n){var r;const i=null===(r=UY(n))||void 0===r?void 0:r.unit;return"temporal"===t||i?function(e,t,n){return e.map((e=>({signal:`{data: ${MQ(e,{timeUnit:n,type:t})}}`})))}(e,t,i):[e]}function a4(e,t,n,r){const{encoding:i}=n,a=OQ(i[r]),{type:o}=a,s=a.timeUnit;if(function(e){return e&&e.unionWith}(t)){const i=a4(e,void 0,n,r),a=i4(t.unionWith,o,s);return J0([...i.value,...a])}if(VY(t))return J0([t]);if(t&&"unaggregated"!==t&&!LJ(t))return J0(i4(t,o,s));const l=n.stack;if(l&&r===l.fieldChannel){if("normalize"===l.offset)return K0([[0,1]]);const e=n.requestDataName(u1.Main);return K0([{data:e,field:n.vgField(r,{suffix:"start"})},{data:e,field:n.vgField(r,{suffix:"end"})}])}const u=zX(r)&&eQ(a)?function(e,t,n){if(!RJ(n))return;const r=e.fieldDef(t),i=r.sort;if(qK(i))return{op:"min",field:y3(r,t),order:"ascending"};const{stack:a}=e,o=a?[...a.groupbyField?[a.groupbyField]:[],...a.stackBy.map((e=>e.fieldDef.field))]:void 0;if(IK(i)){return o4(i,a&&!CH(o,i.field))}if(LK(i)){const{encoding:t,order:n}=i,r=e.fieldDef(t),{aggregate:s,field:l}=r,u=a&&!CH(o,l);if(bG(s)||xG(s))return o4({field:hQ(r),order:n},u);if(wG(s)||!s)return o4({op:s,field:l,order:n},u)}else{if("descending"===i)return{op:"min",field:e.vgField(t),order:"descending"};if(CH(["ascending",void 0],i))return!0}return}(n,r,e):void 0;if(nQ(a)){return K0(i4([a.datum],o,s))}const c=a;if("unaggregated"===t){const e=n.requestDataName(u1.Main),{field:t}=a;return K0([{data:e,field:hQ({field:t,aggregate:"min"})},{data:e,field:hQ({field:t,aggregate:"max"})}])}if(VX(c.bin)){if(RJ(e))return K0("bin-ordinal"===e?[]:[{data:VH(u)?n.requestDataName(u1.Main):n.requestDataName(u1.Raw),field:n.vgField(r,FQ(c,r)?{binSuffix:"range"}:{}),sort:!0!==u&&Nu(u)?u:{field:n.vgField(r,{}),op:"min"}}]);{const{bin:e}=c;if(VX(e)){const t=h5(n,c.field,e);return K0([new e4((()=>{const e=n.getSignalName(t);return`[${e}.start, ${e}.stop]`}))])}return K0([{data:n.requestDataName(u1.Main),field:n.vgField(r,{})}])}}if(c.timeUnit&&CH(["time","utc"],e)&&JK(r,c,T4(n)?n.encoding[OX(r)]:void 0,n.stack,n.markDef,n.config)){const e=n.requestDataName(u1.Main);return K0([{data:e,field:n.vgField(r)},{data:e,field:n.vgField(r,{suffix:"end"})}])}return K0(u?[{data:VH(u)?n.requestDataName(u1.Main):n.requestDataName(u1.Raw),field:n.vgField(r),sort:u}]:[{data:n.requestDataName(u1.Main),field:n.vgField(r)}])}function o4(e,t){const{op:n,field:r,order:i}=e;return Object.assign(Object.assign({op:null!=n?n:t?"sum":PK},r?{field:QH(r)}:{}),i?{order:i}:{})}function s4(e,t){var n;const r=e.component.scales[t],i=e.specifiedScales[t].domain,a=null===(n=e.fieldDef(t))||void 0===n?void 0:n.bin,o=LJ(i)&&i,s=HX(a)&&GX(a.extent)&&a.extent;(o||s)&&r.set("selectionExtent",null!=o?o:s,!0)}function l4(e,t){const{aggregate:n,type:r}=e;return n?Cc(n)&&!SG[n]?{valid:!1,reason:gY(n)}:"quantitative"===r&&"log"===t?{valid:!1,reason:yY(e)}:{valid:!0}:{valid:!1,reason:mY(e)}}function u4(e,t,n,r){return e.explicit&&t.explicit&&$Y(function(e,t,n,r){return`Conflicting ${t.toString()} property "${e.toString()}" (${EH(n)} and ${EH(r)}). Using the union of the two domains.`}(n,r,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function c4(e){const t=NH(e.map((e=>{if(HY(e)){return t4(e,["sort"])}return e})),AH),n=NH(e.map((e=>{if(HY(e)){const t=e.sort;return void 0===t||VH(t)||("op"in t&&"count"===t.op&&delete t.field,"ascending"===t.order&&delete t.order),t}})).filter((e=>void 0!==e)),AH);if(0===t.length)return;if(1===t.length){const t=e[0];if(HY(t)&&n.length>0){let e=n[0];if(n.length>1)$Y(xY),e=!0;else if(Nu(e)&&"field"in e){const n=e.field;t.field===n&&(e=!e.order||{order:e.order})}return Object.assign(Object.assign({},t),{sort:e})}return t}const r=NH(n.map((e=>VH(e)||!("op"in e)||Cc(e.op)&&e.op in vG?e:($Y(function(e){return`Dropping sort property ${EH(e)} as unioned domains only support boolean or op "count", "min", and "max".`}(e)),!0))),AH);let i;1===r.length?i=r[0]:r.length>1&&($Y(xY),i=!0);const a=NH(e.map((e=>HY(e)?e.data:null)),(e=>e));if(1===a.length&&null!==a[0]){return Object.assign({data:a[0],fields:t.map((e=>e.field))},i?{sort:i}:{})}return Object.assign({fields:t},i?{sort:i}:{})}function f4(e){if(HY(e)&&Cc(e.field))return e.field;if(function(e){return!Tu(e)&&"fields"in e&&!("data"in e)}(e)){let t;for(const n of e.fields)if(HY(n)&&Cc(n.field))if(t){if(t!==n.field)return $Y("Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect."),t}else t=n.field;return $Y("Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect."),t}if(function(e){return!Tu(e)&&"fields"in e&&"data"in e}(e)){$Y("Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.");const t=e.fields[0];return Cc(t)?t:void 0}}function d4(e,t){return c4(e.component.scales[t].get("domains").map((t=>(HY(t)&&(t.data=e.lookupDataSource(t.data)),t))))}var h4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function p4(e){return P4(e)||R4(e)?e.children.reduce(((e,t)=>e.concat(p4(t))),m4(e)):m4(e)}function m4(e){return IH(e.component.scales).reduce(((t,n)=>{const r=e.component.scales[n];if(r.merged)return t;const i=r.combine(),{name:a,type:o,selectionExtent:s,domains:l,range:u,reverse:c}=i,f=h4(i,["name","type","selectionExtent","domains","range","reverse"]),d=function(e,t,n,r){if(CX(n)){if(WY(e))return{step:{signal:t+"_step"}}}else if(Nu(e)&&HY(e))return Object.assign(Object.assign({},e),{data:r.lookupDataSource(e.data)});return e}(i.range,a,n,e);let h;s&&(h=function(e,t){const n=t.selection;return{signal:t3(e.getSelectionComponent(n,WH(n)),t)}}(e,s));const p=d4(e,n);return t.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:a,type:o},p?{domain:p}:{}),h?{domainRaw:h}:{}),{range:d}),void 0!==c?{reverse:c}:{}),f)),t}),[])}class g4 extends Y0{constructor(e,t){super({},{name:e}),this.merged=!1,this.setWithExplicit("type",t)}domainDefinitelyIncludesZero(){return!1!==this.get("zero")||MH(this.get("domains"),(e=>Tu(e)&&2===e.length&&e[0]<=0&&e[1]>=0))}}const y4=["range","scheme"];function v4(e){return"x"===e?"width":"y"===e?"height":void 0}function b4(e,t){const n=e.fieldDef(t);if(n&&n.bin&&VX(n.bin)){const r=h5(e,n.field,n.bin),i=v4(t),a=e.getName(i);return new e4((()=>{const t=e.getSignalName(r),n=`(${t}.stop - ${t}.start) / ${t}.step`;return`${e.getSignalName(a)} / (${n})`}))}}function x4(e,t){const n=t.specifiedScales[e],{size:r}=t,i=t.getScaleComponent(e).get("type");for(const r of y4)if(void 0!==n[r]){const a=UJ(i,r),o=VJ(e,r);if(a)if(o)$Y(o);else switch(r){case"range":{const r=n.range;if(Tu(r)){if(CX(e))return J0(r.map((e=>{if("width"===e||"height"===e){const n=t.getName(e),r=t.getSignalName.bind(t);return e4.fromName(r,n)}return e})))}else if(Nu(r))return J0({data:t.requestDataName(u1.Main),field:r.field,sort:{op:"min",field:t.vgField(e)}});return J0(r)}case"scheme":return J0(w4(n[r]))}else $Y(vY(i,r,e))}if(e===CG||e===MG){const t=e===CG?"width":"height",n=r[t];if(KZ(n)){if(RJ(i))return J0({step:n.step});$Y(bY(t))}}const{rangeMin:a,rangeMax:o}=n,s=function(e,t){const{size:n,config:r,mark:i,encoding:a}=t,o=t.getSignalName.bind(t),{type:s}=OQ(a[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:c}=t.specifiedScales[e];switch(e){case CG:case MG:{if(CH(["point","band"],l))if(e!==CG||n.width){if(e===MG&&!n.height){const e=r0(r.view,"height");if(KZ(e))return e}}else{const e=r0(r.view,"width");if(KZ(e))return e}const i=v4(e),a=t.getName(i);return e===MG&&PJ(l)?[e4.fromName(o,a),0]:[0,e4.fromName(o,a)]}case HG:{const a=_4(i,t.component.scales[e].get("zero"),r),o=function(e,t,n,r){const i={x:b4(n,"x"),y:b4(n,"y")};switch(e){case"bar":case"tick":{if(void 0!==r.scale.maxBandSize)return r.scale.maxBandSize;const e=O4(t,i,r.view);return Ac(e)?e-1:new e4((()=>`${e.signal} - 1`))}case"line":case"trail":case"rule":return r.scale.maxStrokeWidth;case"text":return r.scale.maxFontSize;case"point":case"square":case"circle":{if(r.scale.maxSize)return r.scale.maxSize;const e=O4(t,i,r.view);return Ac(e)?Math.pow(k4*e,2):new e4((()=>`pow(0.95 * ${e.signal}, 2)`))}}throw new Error(dY("size",e))}(i,n,t,r);return BJ(l)?function(e,t,n){const r=()=>{const r=UQ(t),i=UQ(e),a=`(${r} - ${i}) / (${n} - 1)`;return`sequence(${i}, ${r} + ${a}, ${a})`};return VY(t)?new e4(r):{signal:r()}}(a,o,function(e,t,n,r){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return void 0!==n&&Tu(n)?n.length+1:($Y(function(e){return`Domain for ${e} is required for threshold scale.`}(r)),3)}}(l,r,u,e)):[a,o]}case RG:return[0,2*Math.PI];case GG:return[0,360];case TG:return[0,new e4((()=>`min(${t.getSignalName("width")},${t.getSignalName("height")})/2`))];case KG:return[r.scale.minStrokeWidth,r.scale.maxStrokeWidth];case QG:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case WG:return"symbol";case qG:case UG:case VG:return"ordinal"===l?"nominal"===s?"category":"ordinal":void 0!==c?"diverging":"rect"===i||"geoshape"===i?"heatmap":"ramp";case XG:case YG:case JG:return[r.scale.minOpacity,r.scale.maxOpacity]}throw new Error(`Scale range undefined for channel ${e}`)}(e,t);return(void 0!==a||void 0!==o)&&UJ(i,"rangeMin")&&Tu(s)&&2===s.length?J0([null!=a?a:s[0],null!=o?o:s[1]]):K0(s)}function w4(e){return function(e){return!Cc(e)&&!!e.name}(e)?Object.assign({scheme:e.name},$H(e,["name"])):{scheme:e}}function _4(e,t,n){if(t)return VY(t)?{signal:`${t.signal} ? 0 : ${_4(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(dY("size",e))}const k4=.95;function O4(e,t,n){const r=KZ(e.width)?e.width.step:n0(n,"width"),i=KZ(e.height)?e.height.step:n0(n,"height");return t.x||t.y?new e4((()=>`min(${[t.x?t.x.signal:r,t.y?t.y.signal:i].join(", ")})`)):Math.min(r,i)}function S4(e,t){T4(e)?function(e,t){const n=e.component.scales,{config:r,encoding:i,markDef:a,specifiedScales:o}=e;for(const s of IH(n)){const l=o[s],u=n[s],c=e.getScaleComponent(s),f=OQ(i[s]),d=l[t],h=c.get("type"),p=c.get("padding"),m=c.get("paddingInner"),g=UJ(h,t),y=VJ(s,t);if(void 0!==d&&(g?y&&$Y(y):$Y(vY(h,t,s))),g&&void 0===y)if(void 0!==d){const e=f.timeUnit,n=f.type;switch(t){case"domainMax":case"domainMin":EY(l[t])||"temporal"===n||e?u.set(t,{signal:MQ(l[t],{type:n,timeUnit:e})},!0):u.set(t,l[t],!0);break;default:u.copyKeyFromObject(t,l)}}else{const n=t in $4?$4[t]({model:e,channel:s,fieldOrDatumDef:f,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:l.domain,markDef:a,config:r}):r.scale[t];void 0!==n&&u.set(t,n,!1)}}}(e,t):A4(e,t)}const $4={bins:({model:e,fieldOrDatumDef:t})=>eQ(t)?function(e,t){const n=t.bin;if(VX(n)){const r=h5(e,t.field,n);return new e4((()=>e.getSignalName(r)))}if(WX(n)&&HX(n)&&void 0!==n.step)return{step:n.step};return}(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>function(e,t){if(CH([qG,UG,VG],e)&&"nominal"!==t)return"hcl";return}(e,t.type),nice:({scaleType:e,channel:t,fieldOrDatumDef:n})=>function(e,t,n){var r;if((null===(r=kQ(n))||void 0===r?void 0:r.bin)||CH([bJ,xJ],e))return;return t in AX||void 0}(e,t,n),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:r,config:i})=>function(e,t,n,r,i,a){if(e in AX){if(zJ(t)){if(void 0!==n.continuousPadding)return n.continuousPadding;const{type:t,orient:o}=i;if("bar"===t&&(!eQ(r)||!r.bin&&!r.timeUnit)&&("vertical"===o&&"x"===e||"horizontal"===o&&"y"===e))return a.continuousBandSize}if(t===OJ)return n.pointPadding}return}(e,t,i.scale,n,r,i.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,config:r})=>function(e,t,n,r){if(void 0!==e)return;if(t in AX){const{bandPaddingInner:e,barBandPaddingInner:t,rectBandPaddingInner:i}=r;return nG(e,"bar"===n?t:i)}return}(e,t,n.type,r.scale),paddingOuter:({scalePadding:e,channel:t,scaleType:n,markDef:r,scalePaddingInner:i,config:a})=>function(e,t,n,r,i,a){if(void 0!==e)return;if(t in AX&&n===SJ){const{bandPaddingOuter:e}=a;return nG(e,VY(i)?{signal:`${i.signal}/2`}:i/2)}return}(e,t,n,r.type,i,a.scale),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:r})=>function(e,t,n,r){if("x"===n&&void 0!==r.xReverse)return PJ(e)&&"descending"===t?VY(r.xReverse)?{signal:`!${r.xReverse.signal}`}:!r.xReverse:r.xReverse;if(PJ(e)&&"descending"===t)return!0;return}(t,eQ(e)?e.sort:void 0,n,r.scale),zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:r,scaleType:i})=>function(e,t,n,r,i){if(n&&"unaggregated"!==n&&PJ(i)){if(Tu(n)){const e=n[0],t=n[n.length-1];if(e<=0&&t>=0)return!0}return!1}if("size"===e&&"quantitative"===t.type&&!BJ(i))return!0;if((!eQ(t)||!t.bin)&&CH([...DX,...jX],e)){const{orient:t,type:n}=r;return!CH(["bar","area","line","trail"],n)||!("horizontal"===t&&"y"===e||"vertical"===t&&"x"===e)}return!1}(e,t,n,r,i)};function E4(e){T4(e)?function(e){const t=e.component.scales;for(const n of PX){const r=t[n];if(!r)continue;const i=x4(n,e);r.setWithExplicit("range",i)}}(e):A4(e,"range")}function A4(e,t){const n=e.component.scales;for(const n of e.children)"range"===t?E4(n):S4(n,t);for(const r of IH(n)){let i;for(const n of e.children){const e=n.component.scales[r];if(e){i=e1(i,e.getWithExplicit(t),t,"scale",Q0(((e,n)=>{switch(t){case"range":return e.step&&n.step?e.step-n.step:0}return 0})))}}n[r].setWithExplicit(t,i)}}function D4(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(dX(e)||"discrete"===qX(e))return"shape"===e&&"ordinal"===t.type&&$Y(pY(e,"ordinal")),"ordinal";if(e in AX){if(CH(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in MX)return"band";return void 0!==t.band||uQ(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return dX(e)?"time":"discrete"===qX(e)?($Y(pY(e,"temporal")),"ordinal"):eQ(t)&&t.timeUnit&&UY(t.timeUnit).utc?"utc":"time";case"quantitative":return dX(e)?eQ(t)&&VX(t.bin)?"bin-ordinal":"linear":"discrete"===qX(e)?($Y(pY(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(uY(t.type))}(t,n,r),{type:a}=e;return zX(t)?void 0!==a?function(e,t){if(!zX(e))return!1;switch(e){case CG:case MG:case RG:case TG:return zJ(t)||CH(["band","point"],t);case HG:case KG:case XG:case YG:case JG:case GG:return zJ(t)||BJ(t)||CH(["band","point","ordinal"],t);case qG:case UG:case VG:return"band"!==t;case QG:return"ordinal"===t||BJ(t);case WG:return"ordinal"===t}}(t,a)?eQ(n)&&(o=a,s=n.type,!(CH([uJ,fJ],s)?void 0===o||RJ(o):s===cJ?CH([bJ,xJ,void 0],o):s!==lJ||CH([mJ,gJ,yJ,vJ,wJ,_J,kJ,pJ,void 0],o)))?($Y(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(a,i)),i):a:($Y(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,a,i)),i):i:null;var o,s}function C4(e){T4(e)?e.component.scales=function(e){const{encoding:t,mark:n}=e;return PX.reduce(((r,i)=>{const a=OQ(t[i]);if(a&&n===sK&&i===WG&&a.type===dJ)return r;let o=a&&a.scale;if(a&&null!==o&&!1!==o){o=null!=o?o:{};const t=D4(o,i,a,n);r[i]=new g4(e.scaleName(i+"",!0),{value:t,explicit:o.type===t})}return r}),{})}(e):e.component.scales=function(e){var t;const n=e.component.scales={},r={},i=e.component.resolve;for(const n of e.children){C4(n);for(const a of IH(n.component.scales))if(i.scale[a]=null!==(t=i.scale[a])&&void 0!==t?t:B3(a,e),"shared"===i.scale[a]){const e=r[a],t=n.component.scales[a].getWithExplicit("type");e?EJ(e.value,t.value)?r[a]=e1(e,t,"type","scale",M4):(i.scale[a]="independent",delete r[a]):r[a]=t}}for(const t of IH(r)){const i=e.scaleName(t,!0),a=r[t];n[t]=new g4(i,a);for(const n of e.children){const e=n.component.scales[t];e&&(n.renameScale(e.get("name"),i),e.merged=!0)}}return n}(e)}const M4=Q0(((e,t)=>DJ(e)-DJ(t)));var j4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class F4{constructor(){this.nameMap={}}rename(e,t){this.nameMap[e]=t}has(e){return void 0!==this.nameMap[e]}get(e){for(;this.nameMap[e]&&e!==this.nameMap[e];)e=this.nameMap[e];return e}}function T4(e){return"unit"===(null==e?void 0:e.type)}function N4(e){return"facet"===(null==e?void 0:e.type)}function R4(e){return"concat"===(null==e?void 0:e.type)}function P4(e){return"layer"===(null==e?void 0:e.type)}class z4{constructor(e,t,n,r,i,a,o){var s,l;this.type=t,this.parent=n,this.config=i,this.children=[],this.correctDataNames=e=>(e.from&&e.from.data&&(e.from.data=this.lookupDataSource(e.from.data)),e.from&&e.from.facet&&e.from.facet.data&&(e.from.facet.data=this.lookupDataSource(e.from.facet.data)),e),this.parent=n,this.config=i,this.view=HJ(o),this.name=null!==(s=e.name)&&void 0!==s?s:r,this.title=RQ(e.title)?{text:e.title}:e.title?this.initTitle(e.title):void 0,this.scaleNameMap=n?n.scaleNameMap:new F4,this.projectionNameMap=n?n.projectionNameMap:new F4,this.signalNameMap=n?n.signalNameMap:new F4,this.data=e.data,this.description=e.description,this.transforms=function(e){return e.map((e=>c1(e)?{filter:_H(e.filter,sJ)}:e))}(null!==(l=e.transform)&&void 0!==l?l:[]),this.layout="layer"===t||"unit"===t?{}:function(e,t,n){var r,i;const a=n[t],o={},{spacing:s,columns:l}=a;void 0!==s&&(o.spacing=s),void 0!==l&&(WK(e)&&!UK(e.facet)||XZ(e))&&(o.columns=l),YZ(e)&&(o.columns=1);for(const t of ZZ)if(void 0!==e[t])if("spacing"===t){const n=e[t];o[t]=Ac(n)?n:{row:null!==(r=n.row)&&void 0!==r?r:s,column:null!==(i=n.column)&&void 0!==i?i:s}}else o[t]=e[t];return o}(e,t,i),this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:WK(e)||n&&n.component.data.isFaceted&&void 0===e.data},layoutSize:new Y0,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},a?OH(a):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}initTitle(e){const t=IH(e),n={text:BQ(e.text)};for(const r of t)n[r]=BQ(e[r]);return n}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){!function(e,{ignoreRange:t}={}){C4(e),n4(e);for(const t of qJ)S4(e,t);t||E4(e)}(this)}parseProjection(){c5(this)}renameTopLevelLayoutSizeSignal(){"width"!==this.getName("width")&&this.renameSignal(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameSignal(this.getName("height"),"height")}parseLegends(){Z3(this)}assembleGroupStyle(){var e,t;if("unit"===this.type||"layer"===this.type)return null!==(t=null===(e=this.view)||void 0===e?void 0:e.style)&&void 0!==t?t:"cell"}assembleEncodeFromView(e){const t=j4(e,["style"]),n={};for(const e of IH(t)){const r=t[e];void 0!==r&&(n[e]=IQ(r))}return n}assembleGroupEncodeEntry(e){let t={};return this.view&&(t=this.assembleEncodeFromView(this.view)),e||(this.description&&(t.description=IQ(this.description)),"unit"!==this.type&&"layer"!==this.type)?LH(t)?void 0:t:Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},null!=t?t:{})}assembleLayout(){if(!this.layout)return;const e=this.layout,{spacing:t}=e,n=j4(e,["spacing"]),{component:r,config:i}=this,a=function(e,t){const n={};for(const r of pX){const i=e[r];if(null==i?void 0:i.facetFieldDef){const{titleAnchor:e,titleOrient:a}=x3(["titleAnchor","titleOrient"],i.facetFieldDef.header,t,r),o=v3(r,a),s=M3(e,o);void 0!==s&&(n[o]=s)}}return LH(n)?void 0:n}(r.layoutHeaders,i);return Object.assign(Object.assign(Object.assign({padding:t},this.assembleDefaultLayout()),n),a?{titleBand:a}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:e}=this.component;let t=[];for(const n of pX)e[n].title&&t.push(k3(this,n));for(const e of w3)t=t.concat($3(this,e));return t}assembleAxes(){return function(e,t){const{x:n=[],y:r=[]}=e;return[...n.map((e=>a3(e,"grid",t))),...r.map((e=>a3(e,"grid",t))),...n.map((e=>a3(e,"main",t))),...r.map((e=>a3(e,"main",t)))].filter((e=>e))}(this.component.axes,this.config)}assembleLegends(){return a5(this)}assembleProjections(){return o5(this)}assembleTitle(){var e,t,n;const r=null!==(e=this.title)&&void 0!==e?e:{},{encoding:i}=r,a=j4(r,["encoding"]),o=Object.assign(Object.assign(Object.assign({},NQ(this.config.title).nonMark),a),i?{encode:{update:i}}:{});if(o.text)return CH(["unit","layer"],this.type)?CH(["middle",void 0],o.anchor)&&(o.frame=null!==(t=o.frame)&&void 0!==t?t:"group"):o.anchor=null!==(n=o.anchor)&&void 0!==n?n:"start",LH(o)?void 0:o}assembleGroup(e=[]){const t={};(e=e.concat(this.assembleSignals())).length>0&&(t.signals=e);const n=this.assembleLayout();n&&(t.layout=n),t.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||N4(this.parent)?p4(this):[];r.length>0&&(t.scales=r);const i=this.assembleAxes();i.length>0&&(t.axes=i);const a=this.assembleLegends();return a.length>0&&(t.legends=a),t}getName(e){return WH((this.name?this.name+"_":"")+e)}getDataName(e){return this.getName(u1[e].toLowerCase())}requestDataName(e){const t=this.getDataName(e),n=this.component.data.outputNodeRefCounts;return n[t]=(n[t]||0)+1,t}getSizeSignalRef(e){if(N4(this.parent)){const t=FX(P3(e)),n=this.component.scales[t];if(n&&!n.merged){const e=n.get("type"),r=n.get("range");if(RJ(e)&&WY(r)){const e=n.get("name"),r=f4(d4(this,t));if(r){return{signal:R3(e,n,hQ({aggregate:"distinct",field:r},{expr:"datum"}))}}return $Y(eY(t)),null}}}return{signal:this.signalNameMap.get(this.getName(e))}}lookupDataSource(e){const t=this.component.data.outputNodes[e];return t?t.getSource():e}getSignalName(e){return this.signalNameMap.get(e)}renameSignal(e,t){this.signalNameMap.rename(e,t)}renameScale(e,t){this.scaleNameMap.rename(e,t)}renameProjection(e,t){this.projectionNameMap.rename(e,t)}scaleName(e,t){return t?this.getName(e):bX(e)&&zX(e)&&this.component.scales[e]||this.scaleNameMap.has(this.getName(e))?this.scaleNameMap.get(this.getName(e)):void 0}projectionName(e){return e?this.getName("projection"):this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))?this.projectionNameMap.get(this.getName("projection")):void 0}getScaleComponent(e){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const t=this.component.scales[e];return t&&!t.merged?t:this.parent?this.parent.getScaleComponent(e):void 0}getSelectionComponent(e,t){let n=this.component.selection[e];if(!n&&this.parent&&(n=this.parent.getSelectionComponent(e,t)),!n)throw new Error(function(e){return`Cannot find a selection named "${e}".`}(t));return n}hasAxisOrientSignalRef(){var e,t;return(null===(e=this.component.axes.x)||void 0===e?void 0:e.some((e=>e.hasOrientSignalRef())))||(null===(t=this.component.axes.y)||void 0===t?void 0:t.some((e=>e.hasOrientSignalRef())))}}class B4 extends z4{vgField(e,t={}){const n=this.fieldDef(e);if(n)return hQ(n,t)}reduceFieldDef(e,t){return function(e,t,n,r){return e?IH(e).reduce(((n,i)=>{const a=e[i];return Tu(a)?a.reduce(((e,n)=>t.call(r,e,n,i)),n):t.call(r,n,a,i)}),n):n}(this.getMapping(),((t,n,r)=>{const i=kQ(n);return i?e(t,i,r):t}),t)}forEachFieldDef(e,t){sZ(this.getMapping(),((t,n)=>{const r=kQ(t);r&&e(r,n)}),t)}}var L4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class I4 extends i2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=OH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"value",null!==(i=a[1])&&void 0!==i?i:"density"]}clone(){return new I4(null,OH(this.transform))}dependentFields(){var e;return new Set([this.transform.density,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${AH(this.transform)}`}assemble(){const e=this.transform,{density:t}=e,n=L4(e,["density"]);return Object.assign({type:"kde",field:t},n)}}class q4 extends i2{constructor(e,t){super(e),this.filter=t}clone(){return new q4(null,Object.assign({},this.filter))}static make(e,t){const{config:n,mark:r,markDef:i}=t;if("filter"!==WQ("invalid",i,n))return null;const a=t.reduceFieldDef(((e,n,i)=>{const a=zX(i)&&t.getScaleComponent(i);if(a){PJ(a.get("type"))&&"count"!==n.aggregate&&!lK(r)&&(e[n.field]=n)}return e}),{});return IH(a).length?new q4(e,a):null}dependentFields(){return new Set(IH(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${AH(this.filter)}`}assemble(){const e=IH(this.filter).reduce(((e,t)=>{const n=this.filter[t],r=hQ(n,{expr:"datum"});return null!==n&&("temporal"===n.type?e.push(`(isDate(${r}) || (isValid(${r}) && isFinite(+${r})))`):"quantitative"===n.type&&(e.push(`isValid(${r})`),e.push(`isFinite(+${r})`))),e}),[]);return e.length>0?{type:"filter",expr:e.join(" && ")}:null}}class U4 extends i2{constructor(e,t){super(e),this.transform=t,this.transform=OH(t);const{flatten:n,as:r=[]}=this.transform;this.transform.as=n.map(((e,t)=>{var n;return null!==(n=r[t])&&void 0!==n?n:e}))}clone(){return new U4(this.parent,OH(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${AH(this.transform)}`}assemble(){const{flatten:e,as:t}=this.transform;return{type:"flatten",fields:e,as:t}}}class V4 extends i2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=OH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"key",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new V4(null,OH(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${AH(this.transform)}`}assemble(){const{fold:e,as:t}=this.transform;return{type:"fold",fields:e,as:t}}}class W4 extends i2{constructor(e,t,n,r){super(e),this.fields=t,this.geojson=n,this.signal=r}clone(){return new W4(null,OH(this.fields),this.geojson,this.signal)}static parseAll(e,t){if(t.component.projection&&!t.component.projection.isFit)return e;let n=0;for(const r of[[BG,zG],[IG,LG]]){const i=r.map((e=>{const n=OQ(t.encoding[e]);return eQ(n)?n.field:nQ(n)?{expr:`${n.datum}`}:sQ(n)?{expr:`${n.value}`}:void 0}));(i[0]||i[1])&&(e=new W4(e,i,null,t.getName("geojson_"+n++)))}if(t.channelHasField(WG)){const r=t.typedFieldDef(WG);r.type===dJ&&(e=new W4(e,null,r.field,t.getName("geojson_"+n++)))}return e}dependentFields(){var e;const t=(null!==(e=this.fields)&&void 0!==e?e:[]).filter(Cc);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${AH(this.fields)}`}assemble(){return Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})}}class H4 extends i2{constructor(e,t,n,r){super(e),this.projection=t,this.fields=n,this.as=r}clone(){return new H4(null,this.projection,OH(this.fields),OH(this.as))}static parseAll(e,t){if(!t.projectionName())return e;for(const n of[[BG,zG],[IG,LG]]){const r=n.map((e=>{const n=OQ(t.encoding[e]);return eQ(n)?n.field:nQ(n)?{expr:`${n.datum}`}:sQ(n)?{expr:`${n.value}`}:void 0})),i=n[0]===IG?"2":"";(r[0]||r[1])&&(e=new H4(e,t.projectionName(),r,[t.getName("x"+i),t.getName("y"+i)]))}return e}dependentFields(){return new Set(this.fields.filter(Cc))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${AH(this.fields)} ${AH(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class G4 extends i2{constructor(e,t){super(e),this.transform=t}clone(){return new G4(null,OH(this.transform))}dependentFields(){var e;return new Set([this.transform.impute,this.transform.key,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(e){const{start:t=0,stop:n,step:r}=e;return{signal:`sequence(${[t,n,...r?[r]:[]].join(",")})`}}static makeFromTransform(e,t){return new G4(e,t)}static makeFromEncoding(e,t){const n=t.encoding,r=n.x,i=n.y;if(eQ(r)&&eQ(i)){const a=r.impute?r:i.impute?i:void 0;if(void 0===a)return;const o=r.impute?i:i.impute?r:void 0,{method:s,value:l,frame:u,keyvals:c}=a.impute,f=lZ(t.mark,n);return new G4(e,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:a.field,key:o.field},s?{method:s}:{}),void 0!==l?{value:l}:{}),u?{frame:u}:{}),void 0!==c?{keyvals:c}:{}),f.length?{groupby:f}:{}))}return null}hash(){return`Impute ${AH(this.transform)}`}assemble(){const{impute:e,key:t,keyvals:n,method:r,groupby:i,value:a,frame:o=[null,null]}=this.transform,s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:e,key:t},n?{keyvals:f1(n)?this.processSequence(n):n}:{}),{method:"value"}),i?{groupby:i}:{}),{value:r&&"value"!==r?null:a});if(r&&"value"!==r){return[s,Object.assign({type:"window",as:[`imputed_${e}_value`],ops:[r],fields:[e],frame:o,ignorePeers:!1},i?{groupby:i}:{}),{type:"formula",expr:`datum.${e} === null ? datum.imputed_${e}_value : datum.${e}`,as:e}]}return[s]}}var X4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Y4 extends i2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=OH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.loess]}clone(){return new Y4(null,OH(this.transform))}dependentFields(){var e;return new Set([this.transform.loess,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${AH(this.transform)}`}assemble(){const e=this.transform,{loess:t,on:n}=e,r=X4(e,["loess","on"]);return Object.assign({type:"loess",x:n,y:t},r)}}class J4 extends i2{constructor(e,t,n){super(e),this.transform=t,this.secondary=n}clone(){return new J4(null,OH(this.transform),this.secondary)}static make(e,t,n,r){const i=t.component.data.sources,{from:a}=n;let o=null;if(function(e){return"data"in e}(a)){let e=p6(a.data,i);e||(e=new $5(a.data),i.push(e));const n=t.getName(`lookup_${r}`);o=new a2(e,n,u1.Lookup,t.component.data.outputNodeRefCounts),t.component.data.outputNodes[n]=o}else if(function(e){return"selection"in e}(a)){const e=a.selection;if(n=Object.assign({as:e},n),o=t.getSelectionComponent(WH(e),e).materialized,!o)throw new Error(function(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}(e))}return new J4(e,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?ac(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${AH({transform:this.transform,secondary:this.secondary})}`}assemble(){let e;if(this.transform.from.fields)e=Object.assign({values:this.transform.from.fields},this.transform.as?{as:ac(this.transform.as)}:{});else{let t=this.transform.as;Cc(t)||($Y('If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.'),t="_lookup"),e={as:[t]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},e),this.transform.default?{default:this.transform.default}:{})}}var K4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Q4 extends i2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=OH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:"prob",null!==(i=a[1])&&void 0!==i?i:"value"]}clone(){return new Q4(null,OH(this.transform))}dependentFields(){var e;return new Set([this.transform.quantile,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${AH(this.transform)}`}assemble(){const e=this.transform,{quantile:t}=e,n=K4(e,["quantile"]);return Object.assign({type:"quantile",field:t},n)}}var Z4=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class e6 extends i2{constructor(e,t){var n,r,i;super(e),this.transform=t,this.transform=OH(t);const a=null!==(n=this.transform.as)&&void 0!==n?n:[void 0,void 0];this.transform.as=[null!==(r=a[0])&&void 0!==r?r:t.on,null!==(i=a[1])&&void 0!==i?i:t.regression]}clone(){return new e6(null,OH(this.transform))}dependentFields(){var e;return new Set([this.transform.regression,this.transform.on,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${AH(this.transform)}`}assemble(){const e=this.transform,{regression:t,on:n}=e,r=Z4(e,["regression","on"]);return Object.assign({type:"regression",x:n,y:t},r)}}class t6 extends i2{constructor(e,t){super(e),this.transform=t}clone(){return new t6(null,OH(this.transform))}addDimensions(e){var t;this.transform.groupby=NH((null!==(t=this.transform.groupby)&&void 0!==t?t:[]).concat(e),(e=>e))}producedFields(){}dependentFields(){var e;return new Set([this.transform.pivot,this.transform.value,...null!==(e=this.transform.groupby)&&void 0!==e?e:[]])}hash(){return`PivotTransform ${AH(this.transform)}`}assemble(){const{pivot:e,value:t,groupby:n,limit:r,op:i}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:e,value:t},void 0!==r?{limit:r}:{}),void 0!==i?{op:i}:{}),void 0!==n?{groupby:n}:{})}}class n6 extends i2{constructor(e,t){super(e),this.transform=t}clone(){return new n6(null,OH(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${AH(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function r6(e){let t=0;return function n(r,i){var a;if(r instanceof $5&&!r.isGenerator&&!n1(r.data)){e.push(i);i={name:null,source:i.name,transform:[]}}if(r instanceof _5&&(r.parent instanceof $5&&!i.source?(i.format=Object.assign(Object.assign({},null!==(a=i.format)&&void 0!==a?a:{}),{parse:r.assembleFormatParse()}),i.transform.push(...r.assembleTransforms(!0))):i.transform.push(...r.assembleTransforms())),r instanceof v5){i.name||(i.name="data_"+t++),!i.source||i.transform.length>0?(e.push(i),r.data=i.name):r.data=i.source;for(const t of r.assemble())e.push(t)}else{if((r instanceof O5||r instanceof S5||r instanceof q4||r instanceof Q2||r instanceof g3||r instanceof H4||r instanceof W4||r instanceof y5||r instanceof J4||r instanceof G5||r instanceof W5||r instanceof V4||r instanceof U4||r instanceof I4||r instanceof Y4||r instanceof Q4||r instanceof e6||r instanceof k5||r instanceof n6||r instanceof t6)&&i.transform.push(r.assemble()),(r instanceof m5||r instanceof s2||r instanceof G4||r instanceof H5)&&i.transform.push(...r.assemble()),r instanceof a2)if(i.source&&0===i.transform.length)r.setSource(i.source);else if(r.parent instanceof a2)r.setSource(i.name);else if(i.name||(i.name="data_"+t++),r.setSource(i.name),1===r.numChildren()){e.push(i);i={name:null,source:i.name,transform:[]}}switch(r.numChildren()){case 0:r instanceof a2&&(!i.source||i.transform.length>0)&&e.push(i);break;case 1:n(r.children[0],i);break;default:{i.name||(i.name="data_"+t++);let a=i.name;!i.source||i.transform.length>0?e.push(i):a=i.source;for(const e of r.children){n(e,{name:null,source:a,transform:[]})}break}}}}}function i6(e){return"top"===e||"left"===e||VY(e)?"header":"footer"}function a6(e,t){var n;const{facet:r,config:i,child:a,component:o}=e;if(e.channelHasField(t)){const s=r[t],l=b3("title",null,i,t);let u=bQ(s,i,{allowDisabling:!0,includeDefault:void 0===l||!!l});a.component.layoutHeaders[t].title&&(u=Tu(u)?u.join(", "):u,u+=" / "+a.component.layoutHeaders[t].title,a.component.layoutHeaders[t].title=null);const c=b3("labelOrient",s,i,t),f=nG((null!==(n=s.header)&&void 0!==n?n:{}).labels,i.header.labels,!0),d=CH(["bottom","right"],c)?"footer":"header";o.layoutHeaders[t]={title:u,facetFieldDef:s,[d]:"facet"===t?[]:[o6(e,t,f)]}}}function o6(e,t,n){const r="row"===t?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(r)?e.child.getSizeSignalRef(r):void 0,axes:[]}}function s6(e,t){var n;const{child:r}=e;if(r.component.axes[t]){const{layoutHeaders:i,resolve:a}=e.component;if(a.axis[t]=L3(a,t),"shared"===a.axis[t]){const a="x"===t?"column":"row",o=i[a];for(const i of r.component.axes[t]){const t=i6(i.get("orient"));o[t]=null!==(n=o[t])&&void 0!==n?n:[o6(e,a,!1)];const r=a3(i,"main",e.config,{header:!0});r&&o[t][0].axes.push(r),i.mainExtracted=!0}}}}function l6(e){for(const t of e.children)t.parseLayoutSize()}function u6(e,t){const n=P3(t),r=FX(n),i=e.component.resolve,a=e.component.layoutSize;let o;for(const t of e.children){const e=t.component.layoutSize.getWithExplicit(n),a=i.scale[r];if("independent"===a&&"step"===e.value){o=void 0;break}if(o){if("independent"===a&&o.value!==e.value){o=void 0;break}o=e1(o,e,n,"")}else o=e}if(o){for(const r of e.children)e.renameSignal(r.getName(n),e.getName(t)),r.component.layoutSize.set(n,"merged",!1);a.setWithExplicit(t,o)}else a.setWithExplicit(t,{explicit:!1,value:void 0})}function c6(e,t){const n="width"===t?"x":"y",r=e.config,i=e.getScaleComponent(n);if(i){const e=i.get("type"),n=i.get("range");if(RJ(e)){const e=r0(r.view,t);return WY(n)||KZ(e)?"step":e}return t0(r.view,t)}if(e.hasProjection||"arc"===e.mark)return t0(r.view,t);{const e=r0(r.view,t);return KZ(e)?e.step:e}}var f6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function d6(e,t,n){return hQ(t,Object.assign({suffix:`by_${hQ(e)}`},null!=n?n:{}))}class h6 extends B4{constructor(e,t,n,r){super(e,"facet",t,n,r,e.resolve),this.child=R6(e.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(e.facet)}initFacet(e){if(!UK(e))return{facet:this.initFacetFieldDef(e,"facet")};const t=IH(e),n={};for(const r of t){if(!CH([EG,AG],r)){$Y(dY(r,"facet"));break}const t=e[r];if(void 0===t.field){$Y(fY(t,r));break}n[r]=this.initFacetFieldDef(t,r)}return n}initFacetFieldDef(e,t){const{header:n}=e,r=EQ(f6(e,["header"]),t);return n&&(r.header=HJ(n)),r}channelHasField(e){return!!this.facet[e]}fieldDef(e){return this.facet[e]}parseData(){this.component.data=m6(this),this.child.parseData()}parseLayoutSize(){l6(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),function(e){for(const t of pX)a6(e,t);s6(e,"x"),s6(e,"y")}(this)}assembleSelectionTopLevelSignals(e){return this.child.assembleSelectionTopLevelSignals(e)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(e){return this.child.assembleSelectionData(e)}getHeaderLayoutMixins(){var e,t,n;const r={};for(const i of pX)for(const a of _3){const o=this.component.layoutHeaders[i],s=o[a],{facetFieldDef:l}=o;if(l){const t=b3("titleOrient",l.header,this.config,i);if(CH(["right","bottom"],t)){const n=v3(i,t);r.titleAnchor=null!==(e=r.titleAnchor)&&void 0!==e?e:{},r.titleAnchor[n]="end"}}if(null==s?void 0:s[0]){const e="row"===i?"height":"width",s="header"===a?"headerBand":"footerBand";"facet"===i||this.child.component.layoutSize.get(e)||(r[s]=null!==(t=r[s])&&void 0!==t?t:{},r[s][i]=.5),o.title&&(r.offset=null!==(n=r.offset)&&void 0!==n?n:{},r.offset["row"===i?"rowTitle":"columnTitle"]=10)}}return r}assembleDefaultLayout(){const{column:e,row:t}=this.facet,n=e?this.columnDistinctSignal():t?1:void 0;let r="all";return(t||"independent"!==this.component.resolve.scale.x)&&(e||"independent"!==this.component.resolve.scale.y)||(r="none"),Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:r})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof h6)){return{signal:`length(data('${this.getName("column_domain")}'))`}}}assembleGroup(e){return this.parent&&this.parent instanceof h6?Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:hQ(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(e)):super.assembleGroup(e)}getCardinalityAggregateForChild(){const e=[],t=[],n=[];if(this.child instanceof h6){if(this.child.channelHasField("column")){const r=hQ(this.child.facet.column);e.push(r),t.push("distinct"),n.push(`distinct_${r}`)}}else for(const r of DX){const i=this.child.component.scales[r];if(i&&!i.merged){const a=i.get("type"),o=i.get("range");if(RJ(a)&&WY(o)){const i=f4(d4(this.child,r));i?(e.push(i),t.push("distinct"),n.push(`distinct_${i}`)):$Y(eY(r))}}}return{fields:e,ops:t,as:n}}assembleFacet(){const{name:e,data:t}=this.component.data.facetRoot,{row:n,column:r}=this.facet,{fields:i,ops:a,as:o}=this.getCardinalityAggregateForChild(),s=[];for(const e of pX){const t=this.facet[e];if(t){s.push(hQ(t));const{bin:l,sort:u}=t;if(VX(l)&&s.push(hQ(t,{binSuffix:"end"})),IK(u)){const{field:e,op:s=PK}=u,l=d6(t,u);n&&r?(i.push(l),a.push("max"),o.push(l)):(i.push(e),a.push(s),o.push(l))}else if(Tu(u)){const n=y3(t,e);i.push(n),a.push("max"),o.push(n)}}}const l=!!n&&!!r;return Object.assign({name:e,data:t,groupby:s},l||i.length>0?{aggregate:Object.assign(Object.assign({},l?{cross:l}:{}),i.length?{fields:i,ops:a,as:o}:{})}:{})}facetSortFields(e){const{facet:t}=this,n=t[e];return n?IK(n.sort)?[d6(n,n.sort,{expr:"datum"})]:Tu(n.sort)?[y3(n,e,{expr:"datum"})]:[hQ(n,{expr:"datum"})]:[]}facetSortOrder(e){const{facet:t}=this,n=t[e];if(n){const{sort:e}=n;return[(IK(e)?e.order:!Tu(e)&&e)||"ascending"]}return[]}assembleLabelTitle(){var e;const{facet:t,config:n}=this;if(t.facet)return A3(t.facet,"facet",n);const r={row:["top","bottom"],column:["left","right"]};for(const i of w3)if(t[i]){const a=b3("labelOrient",null===(e=t[i])||void 0===e?void 0:e.header,n,i);if(CH(r[i],a))return A3(t[i],i,n)}}assembleMarks(){const{child:e}=this,t=function(e){const t=[],n=r6(t);for(const t of e.children)n(t,{source:e.name,name:null,transform:[]});return t}(this.component.data.facetRoot),n=e.assembleGroupEncodeEntry(!1),r=this.assembleLabelTitle()||e.assembleTitle(),i=e.assembleGroupStyle();return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),i?{style:i}:{}),{from:{facet:this.assembleFacet()},sort:{field:pX.map((e=>this.facetSortFields(e))).flat(),order:pX.map((e=>this.facetSortOrder(e))).flat()}}),t.length>0?{data:t}:{}),n?{encode:{update:n}}:{}),e.assembleGroup(function(e,t){if(e.component.selection&&IH(e.component.selection).length){const n=zc(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:bq("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return j2(t)}(this,[])))]}getMapping(){return this.facet}}function p6(e,t){var n,r,i,a;for(const o of t){const t=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const s=null===(n=e.format)||void 0===n?void 0:n.mesh,l=null===(r=t.format)||void 0===r?void 0:r.feature;if(s&&l)continue;const u=null===(i=e.format)||void 0===i?void 0:i.feature;if((u||l)&&u!==l)continue;const c=null===(a=t.format)||void 0===a?void 0:a.mesh;if(!s&&!c||s===c)if(r1(e)&&r1(t)){if(kH(e.values,t.values))return o}else if(n1(e)&&n1(t)){if(e.url===t.url)return o}else if(i1(e)&&e.name===o.dataName)return o}return null}function m6(e){var t,n,r,i,a,o,s,l,u,c;let f=function(e,t){if(e.data||!e.parent){if(null===e.data){const e=new $5({values:[]});return t.push(e),e}const n=p6(e.data,t);if(n)return a1(e.data)||(n.data.format=FH({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const n=new $5(e.data);return t.push(n),n}}return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}(e,e.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=e.component.data,p=e.parent?e.parent.component.data.ancestorParse.clone():new t1,m=e.data;a1(m)?(o1(m)?f=new S5(f,m.sequence):l1(m)&&(f=new O5(f,m.graticule)),p.parseNothing=!0):null===(null===(t=null==m?void 0:m.format)||void 0===t?void 0:t.parse)&&(p.parseNothing=!0),f=null!==(n=_5.makeExplicit(f,e,p))&&void 0!==n?n:f,f=new k5(f);const g=e.parent&&P4(e.parent);(T4(e)||N4(e))&&g&&(f=null!==(r=m5.makeFromEncoding(f,e))&&void 0!==r?r:f),e.transforms.length>0&&(f=function(e,t,n){var r,i;let a=0;for(const o of t.transforms){let s,l;if(_1(o))l=e=new g3(e,o),s="derived";else if(c1(o)){const i=x5(o);l=e=null!==(r=_5.makeWithAncestors(e,{},i,n))&&void 0!==r?r:e,e=new Q2(e,t,o.filter)}else if(k1(o))l=e=m5.makeFromTransform(e,o,t),s="number";else if(S1(o))s="date",void 0===n.getWithExplicit(o.field).value&&(e=new _5(e,{[o.field]:s}),n.set(o.field,s,!1)),l=e=s2.makeFromTransform(e,o);else if($1(o))l=e=y5.makeFromTransform(e,o),s="number",X2(t)&&(e=new k5(e));else if(d1(o))l=e=J4.make(e,t,o,a++),s="derived";else if(b1(o))l=e=new G5(e,o),s="number";else if(x1(o))l=e=new W5(e,o),s="number";else if(E1(o))l=e=H5.makeFromTransform(e,o),s="derived";else if(A1(o))l=e=new V4(e,o),s="derived";else if(w1(o))l=e=new U4(e,o),s="derived";else if(h1(o))l=e=new t6(e,o),s="derived";else if(v1(o))e=new n6(e,o);else if(O1(o))l=e=G4.makeFromTransform(e,o),s="derived";else if(p1(o))l=e=new I4(e,o),s="derived";else if(m1(o))l=e=new Q4(e,o),s="derived";else if(g1(o))l=e=new e6(e,o),s="derived";else{if(!y1(o)){$Y(sY(o));continue}l=e=new Y4(e,o),s="derived"}if(l&&void 0!==s)for(const e of null!==(i=l.producedFields())&&void 0!==i?i:[])n.set(e,s,!1)}return e}(f,e,p));const y=function(e){const t={};if(T4(e)&&e.component.selection)for(const n of IH(e.component.selection)){const r=e.component.selection[n];for(const e of r.project.items)!e.channel&&tG(e.field)>1&&(t[e.field]="flatten")}return t}(e),v=w5(e);f=null!==(i=_5.makeWithAncestors(f,{},Object.assign(Object.assign({},y),v),p))&&void 0!==i?i:f,T4(e)&&(f=W4.parseAll(f,e),f=H4.parseAll(f,e)),(T4(e)||N4(e))&&(g||(f=null!==(a=m5.makeFromEncoding(f,e))&&void 0!==a?a:f),f=null!==(o=s2.makeFromEncoding(f,e))&&void 0!==o?o:f,f=g3.parseAllForSortIndex(f,e));const b=e.getDataName(u1.Raw),x=new a2(f,b,u1.Raw,h);if(d[b]=x,f=x,T4(e)){const t=y5.makeFromEncoding(f,e);t&&(f=t,X2(e)&&(f=new k5(f))),f=null!==(s=G4.makeFromEncoding(f,e))&&void 0!==s?s:f,f=null!==(l=H5.makeFromEncoding(f,e))&&void 0!==l?l:f}T4(e)&&(f=null!==(u=q4.make(f,e))&&void 0!==u?u:f);const w=e.getDataName(u1.Main),_=new a2(f,w,u1.Main,h);d[w]=_,f=_,T4(e)&&function(e,t){H2(e,(n=>{const r=n.name,i=e.getName(`lookup_${r}`);e.component.data.outputNodes[i]=n.materialized=new a2(new Q2(t,e,{selection:r}),i,u1.Lookup,e.component.data.outputNodeRefCounts)}))}(e,_);let k=null;if(N4(e)){const t=e.getName("facet");f=null!==(c=function(e,t){const{row:n,column:r}=t;if(n&&r){let t=null;for(const i of[n,r])if(IK(i.sort)){const{field:n,op:r=PK}=i.sort;e=t=new W5(e,{joinaggregate:[{op:r,field:n,as:d6(i,i.sort,{forAs:!0})}],groupby:[hQ(i)]})}return t}return null}(f,e.facet))&&void 0!==c?c:f,k=new v5(f,e,t,_.getSource()),d[t]=k}return Object.assign(Object.assign({},e.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:x,main:_,facetRoot:k,ancestorParse:p})}class g6 extends z4{constructor(e,t,n,r){var i,a,o,s;super(e,"concat",t,n,r,e.resolve),"shared"!==(null===(a=null===(i=e.resolve)||void 0===i?void 0:i.axis)||void 0===a?void 0:a.x)&&"shared"!==(null===(s=null===(o=e.resolve)||void 0===o?void 0:o.axis)||void 0===s?void 0:s.y)||$Y("Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415)."),this.children=this.getChildren(e).map(((e,t)=>R6(e,this,this.getName("concat_"+t),void 0,r)))}parseData(){this.component.data=m6(this);for(const e of this.children)e.parseData()}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of IH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){for(const e of this.children)e.parseAxesAndHeaders()}getChildren(e){return YZ(e)?e.vconcat:JZ(e)?e.hconcat:e.concat}parseLayoutSize(){!function(e){l6(e);const t=1===e.layout.columns?"width":"childWidth",n=void 0===e.layout.columns?"height":"childHeight";u6(e,t),u6(e,n)}(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.forEach((e=>e.assembleSignals())),[]}assembleLayoutSignals(){const e=F3(this);for(const t of this.children)e.push(...t.assembleLayoutSignals());return e}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleMarks(){return this.children.map((e=>{const t=e.assembleTitle(),n=e.assembleGroupStyle(),r=e.assembleGroupEncodeEntry(!1);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:e.getName("group")},t?{title:t}:{}),n?{style:n}:{}),r?{encode:{update:r}}:{}),e.assembleGroup())}))}assembleDefaultLayout(){const e=this.layout.columns;return Object.assign(Object.assign({},null!=e?{columns:e}:{}),{bounds:"full",align:"each"})}}const y6=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},hG),{labelExpr:1,encode:1}),v6=IH(y6);class b6 extends Y0{constructor(e={},t={},n=!1){super(),this.explicit=e,this.implicit=t,this.mainExtracted=n}clone(){return new b6(OH(this.explicit),OH(this.implicit),this.mainExtracted)}hasAxisPart(e){return"axis"===e||("grid"===e||"title"===e?!!this.get(e):!(!1===(t=this.get(e))||null===t));var t}hasOrientSignalRef(){return VY(this.explicit.orient)}}const x6={bottom:"top",top:"bottom",left:"right",right:"left"};function w6(e,t){if(!e)return t.map((e=>e.clone()));{if(e.length!==t.length)return;const n=e.length;for(let r=0;r<n;r++){const n=e[r],i=t[r];if(!!n!=!!i)return;if(n&&i){const t=n.getWithExplicit("orient"),a=i.getWithExplicit("orient");if(t.explicit&&a.explicit&&t.value!==a.value)return;e[r]=_6(n,i)}}}return e}function _6(e,t){for(const n of v6){const r=e1(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",((e,t)=>{switch(n){case"title":return QQ(e,t);case"gridScale":return{explicit:e.explicit,value:nG(e.value,t.value)}}return Z0(e,t,n,"axis")}));e.setWithExplicit(n,r)}return e}function k6(e,t,n,r,i){if("disable"===t)return void 0!==n;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(VY(n.labelAngle)?n.labelAngle:sG(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===m3(r,i))return!0}return e===n[t]}const O6=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function S6(e,t){var n,r,i;let a=t.axis(e);const o=new b6,s=OQ(t.encoding[e]),{mark:l,config:u}=t,c=(null==a?void 0:a.orient)||(null===(n=u["x"===e?"axisX":"axisY"])||void 0===n?void 0:n.orient)||(null===(r=u.axis)||void 0===r?void 0:r.orient)||function(e){return"x"===e?"bottom":"left"}(e),f=t.getScaleComponent(e).get("type"),d=l3(e,f,c,t.config),h=void 0!==a?!a:c3("disable",u.style,null==a?void 0:a.style,d).configValue;if(o.set("disable",h,void 0!==a),h)return o;a=a||{};const p=function(e,t,n,r,i){const a=null==t?void 0:t.labelAngle;if(void 0!==a)return VY(a)?a:sG(a);{const{configValue:a}=c3("labelAngle",r,null==t?void 0:t.style,i);return void 0!==a?sG(a):n!==CG||!CH([fJ,uJ],e.type)||eQ(e)&&e.timeUnit?void 0:270}}(s,a,e,u.style,d),m={fieldOrDatumDef:s,axis:a,channel:e,model:t,scaleType:f,orient:c,labelAngle:p,mark:l,config:u};for(const n of v6){const r=n in f3?f3[n](m):mG(n)?a[n]:void 0,i=void 0!==r,s=k6(r,n,a,t,e);if(i&&s)o.set(n,r,s);else{const{configValue:e,configFrom:t}=mG(n)&&"values"!==n?c3(n,u.style,a.style,d):{},l=void 0!==e;i&&!l?o.set(n,r,s):("vgAxisConfig"!==t||O6.has(n)&&l||cG(e)||VY(e))&&o.set(n,e,!1)}}const g=null!==(i=a.encoding)&&void 0!==i?i:{},y=fG.reduce(((n,r)=>{var i;if(!o.hasAxisPart(r))return n;const a=z3(null!==(i=g[r])&&void 0!==i?i:{},t),s="labels"===r?function(e,t,n){var r;const{encoding:i,config:a}=e,o=null!==(r=OQ(i[t]))&&void 0!==r?r:OQ(i[OX(t)]),s=e.axis(t)||{},{format:l,formatType:u}=s;return $K(u)?Object.assign({text:CK({fieldOrDatumDef:o,field:"datum.value",format:l,formatType:u,config:a})},n):n}(t,e,a):a;return void 0===s||LH(s)||(n[r]={update:s}),n}),{});return LH(y)||o.set("encode",y,!!a.encoding||void 0!==a.labelAngle),o}function $6(e,t,n){const r=HJ(e),i=WQ("orient",r,n);if(r.orient=function(e,t,n){switch(e){case ZJ:case aK:case oK:case nK:case eK:case KJ:return}const{x:r,y:i,x2:a,y2:o}=t;switch(e){case JJ:if(eQ(r)&&(WX(r.bin)||eQ(i)&&i.aggregate&&!r.aggregate))return"vertical";if(eQ(i)&&(WX(i.bin)||eQ(r)&&r.aggregate&&!i.aggregate))return"horizontal";if(o||a){if(n)return n;if(!a&&(eQ(r)&&r.type===lJ&&!VX(r.bin)||iQ(r)))return"horizontal";if(!o&&(eQ(i)&&i.type===lJ&&!VX(i.bin)||iQ(i)))return"vertical"}case tK:if(a&&(!eQ(r)||!WX(r.bin))&&o&&(!eQ(i)||!WX(i.bin)))return;case YJ:if(o)return eQ(i)&&WX(i.bin)?"horizontal":"vertical";if(a)return eQ(r)&&WX(r.bin)?"vertical":"horizontal";if(e===tK){if(r&&!i)return"vertical";if(i&&!r)return"horizontal"}case QJ:case rK:{const t=rQ(r),a=rQ(i);if(t&&!a)return"tick"!==e?"horizontal":"vertical";if(!t&&a)return"tick"!==e?"vertical":"horizontal";if(t&&a){const t=r,a=i,o=t.type===cJ,s=a.type===cJ;return o&&!s?"tick"!==e?"vertical":"horizontal":!o&&s?"tick"!==e?"horizontal":"vertical":!t.aggregate&&a.aggregate?"tick"!==e?"vertical":"horizontal":t.aggregate&&!a.aggregate?"tick"!==e?"horizontal":"vertical":n||"vertical"}return n||void 0}}return"vertical"}(r.type,t,i),void 0!==i&&i!==r.orient&&$Y(`Specified orient "${r.orient}" overridden with "${i}".`),"bar"===r.type&&r.orient){const e=WQ("cornerRadiusEnd",r,n);if(void 0!==e){const n="horizontal"===r.orient&&t.x2||"vertical"===r.orient&&t.y2?["cornerRadius"]:mK[r.orient];for(const t of n)r[t]=e;void 0!==r.cornerRadiusEnd&&delete r.cornerRadiusEnd}}void 0===WQ("opacity",r,n)&&(r.opacity=function(e,t){if(CH([ZJ,rK,aK,oK],e)&&!rZ(t))return.7;return}(r.type,t));return void 0===WQ("cursor",r,n)&&(r.cursor=function(e,t,n){if(t.href||e.href||WQ("href",e,n))return"pointer";return e.cursor}(r,t,n)),r}function E6(e,t){const{config:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),B1("x",e,{defaultPos:"mid"})),B1("y",e,{defaultPos:"mid"})),R1("size",e)),R1("angle",e)),function(e,t,n){if(n)return{shape:{value:n}};return R1("shape",e)}(e,0,t))}function A6(e){var t;const{config:n,markDef:r}=e,{orient:i}=r,a="horizontal"===i?"width":"height",o=e.getScaleComponent("horizontal"===i?"x":"y"),s=null!==(t=WQ("size",r,n,{vgChannel:a}))&&void 0!==t?t:n.tick.bandSize;if(void 0!==s)return s;{const e=o?o.get("range"):void 0;if(e&&WY(e)&&Ac(e.step))return 3*e.step/4;return 3*n0(n.view,a)/4}}const D6={arc:{vgMark:"arc",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),B1("x",e,{defaultPos:"mid"})),B1("y",e,{defaultPos:"mid"})),G1(e,"radius","arc")),G1(e,"theta","arc"))},area:{vgMark:"area",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),V1("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"horizontal"===e.markDef.orient})),V1("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:"vertical"===e.markDef.orient})),e2(e))},bar:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),G1(e,"x","bar")),G1(e,"y","bar"))},circle:{vgMark:"symbol",encodeEntry:e=>E6(e,"circle")},geoshape:{vgMark:"shape",encodeEntry:e=>Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[Object.assign({type:"geoshape",projection:e.projectionName()},n&&eQ(n)&&n.type===dJ?{field:hQ(n,{expr:"datum"})}:{})]}},image:{vgMark:"image",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),G1(e,"x","image")),G1(e,"y","image")),C1(e,"url"))},line:{vgMark:"line",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),B1("x",e,{defaultPos:"mid"})),B1("y",e,{defaultPos:"mid"})),R1("size",e,{vgChannel:"strokeWidth"})),e2(e))},point:{vgMark:"symbol",encodeEntry:e=>E6(e)},rect:{vgMark:"rect",encodeEntry:e=>Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),G1(e,"x","rect")),G1(e,"y","rect"))},rule:{vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return e.encoding.x||e.encoding.y||e.encoding.latitude||e.encoding.longitude?Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),V1("x",e,{defaultPos:"horizontal"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"vertical"!==n})),V1("y",e,{defaultPos:"vertical"===n?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:"horizontal"!==n})),R1("size",e,{vgChannel:"strokeWidth"})):{}}},square:{vgMark:"symbol",encodeEntry:e=>E6(e,"square")},text:{vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),B1("x",e,{defaultPos:"mid"})),B1("y",e,{defaultPos:"mid"})),C1(e)),R1("size",e,{vgChannel:"fontSize"})),R1("angle",e)),t2("align",function(e,t,n){if(void 0===WQ("align",e,n))return"center";return}(e.markDef,0,t))),t2("baseline",function(e,t,n){if(void 0===WQ("baseline",e,n))return"middle";return}(e.markDef,0,t))),B1("radius",e,{defaultPos:null,isMidPoint:!0})),B1("theta",e,{defaultPos:null,isMidPoint:!0}))}},tick:{vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,r=n.orient,i="horizontal"===r?"width":"height",a="horizontal"===r?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),B1("x",e,{defaultPos:"mid",vgChannel:"xc"})),B1("y",e,{defaultPos:"mid",vgChannel:"yc"})),R1("size",e,{defaultValue:A6(e),vgChannel:i})),{[a]:IQ(WQ("thickness",n,t))})}},trail:{vgMark:"trail",encodeEntry:e=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Q1(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),B1("x",e,{defaultPos:"mid"})),B1("y",e,{defaultPos:"mid"})),R1("size",e)),e2(e))}};function C6(e){if(CH([QJ,YJ,iK],e.mark)){const t=lZ(e.mark,e.encoding);if(t.length>0)return function(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:M6+e.requestDataName(u1.Main),data:e.requestDataName(u1.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:F6(e,{fromPrefix:M6})}]}(e,t)}else if(CH([JJ],e.mark)){const t=YY.some((t=>WQ(t,e.markDef,e.config)));if(e.stack&&!e.fieldDef("size")&&t)return function(e){const[t]=F6(e,{fromPrefix:j6}),n=e.scaleName(e.stack.fieldChannel),r=(t={})=>e.vgField(e.stack.fieldChannel,t),i=(e,t)=>`${e}(${[r({prefix:"min",suffix:"start",expr:t}),r({prefix:"max",suffix:"start",expr:t}),r({prefix:"min",suffix:"end",expr:t}),r({prefix:"max",suffix:"end",expr:t})].map((e=>`scale('${n}',${e})`)).join(",")})`;let a,o;"x"===e.stack.fieldChannel?(a=Object.assign(Object.assign({},SH(t.encode.update,["y","yc","y2","height",...YY])),{x:{signal:i("min","datum")},x2:{signal:i("max","datum")},clip:{value:!0}}),o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update=Object.assign(Object.assign({},$H(t.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})):(a=Object.assign(Object.assign({},SH(t.encode.update,["x","xc","x2","width"])),{y:{signal:i("min","datum")},y2:{signal:i("max","datum")},clip:{value:!0}}),o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update=Object.assign(Object.assign({},$H(t.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}}));for(const n of YY){const r=HQ(n,e.markDef,e.config);t.encode.update[n]?(a[n]=t.encode.update[n],delete t.encode.update[n]):r&&(a[n]=IQ(r)),r&&(t.encode.update[n]={value:0})}const s=e.fieldDef(e.stack.groupbyChannel),l=hQ(s)?[hQ(s)]:[];((null==s?void 0:s.bin)||(null==s?void 0:s.timeUnit))&&l.push(hQ(s,{binSuffix:"end"}));a=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce(((n,r)=>{if(t.encode.update[r])return Object.assign(Object.assign({},n),{[r]:t.encode.update[r]});{const t=HQ(r,e.markDef,e.config);return void 0!==t?Object.assign(Object.assign({},n),{[r]:IQ(t)}):n}}),a),a.stroke&&(a.strokeForeground={value:!0},a.strokeOffset={value:0});return[{type:"group",from:{facet:{data:e.requestDataName(u1.Main),name:j6+e.requestDataName(u1.Main),groupby:l,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:a},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}(e)}return F6(e)}const M6="faceted_path_";const j6="stack_group_";function F6(e,t={fromPrefix:""}){const{mark:n,markDef:r,encoding:i,config:a}=e,o=nG(r.clip,function(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return!!(t&&t.get("selectionExtent")||n&&n.get("selectionExtent"))||void 0}(e),function(e){const t=e.component.projection;return!(!t||t.isFit)||void 0}(e)),s=VQ(r),l=i.key,u=function(e){const{encoding:t,stack:n,mark:r,markDef:i,config:a}=e,o=t.order;if(!(!Tu(o)&&sQ(o)&&DH(o.value)||!o&&DH(WQ("order",i,a)))){if((Tu(o)||eQ(o))&&!n)return YQ(o,{expr:"datum"});if(lK(r)){const n="horizontal"===i.orient?"y":"x",r=t[n];if(eQ(r)){const t=r.sort;return Tu(t)?{field:hQ(r,{prefix:n,suffix:"sort_index",expr:"datum"})}:IK(t)?{field:hQ({aggregate:rZ(e.encoding)?t.op:void 0,field:t.field},{expr:"datum"})}:LK(t)?{field:hQ(e.fieldDef(t.encoding),{expr:"datum"}),order:t.order}:null===t?void 0:{field:hQ(r,{binSuffix:e.stack&&e.stack.impute?"mid":void 0,expr:"datum"})}}}}}(e),c=function(e){if(!e.component.selection)return null;const t=IH(e.component.selection).length;let n=t,r=e.parent;for(;r&&0===n;)n=IH(r.component.selection).length,r=r.parent;return n?{interactive:t>0||!!e.encoding.tooltip}:null}(e),f=WQ("aria",r,a),d=D6[n].postEncodingTransform?D6[n].postEncodingTransform(e):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:e.getName("marks"),type:D6[n].vgMark},o?{clip:!0}:{}),s?{style:s}:{}),l?{key:l.field}:{}),u?{sort:u}:{}),c||{}),!1===f?{aria:f}:{}),{from:{data:t.fromPrefix+e.requestDataName(u1.Main)},encode:{update:D6[n].encodeEntry(e)}}),d?{transform:d}:{})]}class T6 extends B4{constructor(e,t,n,r={},i){super(e,"unit",t,n,i,void 0,QZ(e)?e.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection={},this.children=[];const a=fK(e.mark)?Object.assign({},e.mark):{type:e.mark},o=a.type;void 0===a.filled&&(a.filled=function(e,t,{graticule:n}){if(n)return!1;const r=HQ("filled",e,t),i=e.type;return nG(r,i!==ZJ&&i!==QJ&&i!==tK)}(a,i,{graticule:e.data&&l1(e.data)}));const s=this.encoding=aZ(e.encoding||{},o,a.filled,i);this.markDef=$6(a,s,i),this.size=function({encoding:e,size:t}){for(const n of DX){const r=SX(n);KZ(t[r])&&rQ(e[n])&&(delete t[r],$Y(bY(r)))}return t}({encoding:s,size:QZ(e)?Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{}):r}),this.stack=k0(o,s),this.specifiedScales=this.initScales(o,s),this.specifiedAxes=this.initAxes(s),this.specifiedLegends=this.initLegends(s),this.specifiedProjection=e.projection,this.selection=e.selection}get hasProjection(){const{encoding:e}=this,t=this.mark===sK,n=e&&cX.some((t=>aQ(e[t])));return t||n}scaleDomain(e){const t=this.specifiedScales[e];return t?t.domain:void 0}axis(e){return this.specifiedAxes[e]}legend(e){return this.specifiedLegends[e]}initScales(e,t){return PX.reduce(((e,n)=>{var r;const i=OQ(t[n]);return i&&(e[n]=this.initScale(null!==(r=i.scale)&&void 0!==r?r:{})),e}),{})}initScale(e){const{domain:t,range:n}=e,r=HJ(e);return Tu(t)&&(r.domain=t.map(BQ)),Tu(n)&&(r.range=n.map(BQ)),r}initAxes(e){return DX.reduce(((t,n)=>{const r=e[n];if(aQ(r)||n===CG&&aQ(e.x2)||n===MG&&aQ(e.y2)){const e=aQ(r)?r.axis:void 0;t[n]=e?this.initAxis(Object.assign({},e)):e}return t}),{})}initAxis(e){const t=IH(e),n={};for(const r of t){const t=e[r];n[r]=cG(t)?zQ(t):BQ(t)}return n}initLegends(e){return NX.reduce(((t,n)=>{const r=OQ(e[n]);if(r&&function(e){switch(e){case qG:case UG:case VG:case HG:case WG:case XG:case KG:case QG:return!0;case YG:case JG:case GG:return!1}}(n)){const e=r.legend;t[n]=e?HJ(e):e}return t}),{})}parseData(){this.component.data=m6(this)}parseLayoutSize(){!function(e){const{size:t,component:n}=e;for(const r of DX){const i=SX(r);if(t[i]){const e=t[i];n.layoutSize.set(i,KZ(e)?"step":e,!0)}else{const t=c6(e,i);n.layoutSize.set(i,t,!1)}}}(this)}parseSelections(){this.component.selection=function(e,t){var n;const r={},i=e.config.selection;for(const a of IH(null!=t?t:{})){const o=OH(t[a]),s=i[o.type],l=Z2(s,["fields","encodings"]);for(const e in l)"encodings"===e&&o.fields||"fields"===e&&o.encodings||("mark"===e&&(o[e]=Object.assign(Object.assign({},l[e]),o[e])),void 0!==o[e]&&!0!==o[e]||(o[e]=null!==(n=l[e])&&void 0!==n?n:o[e]));const u=WH(a),c=r[u]=Object.assign(Object.assign({},o),{name:u,events:Cc(o.on)?bq(o.on,"scope"):OH(o.on)});A2(c,(n=>{n.has(c)&&n.parse&&n.parse(e,c,o,t[a])}))}return r}(this,this.selection)}parseMarkGroup(){this.component.mark=C6(this)}parseAxesAndHeaders(){var e;this.component.axes=(e=this,DX.reduce(((t,n)=>(e.component.scales[n]&&(t[n]=[S6(n,e)]),t)),{}))}assembleSelectionTopLevelSignals(e){return function(e,t){let n=!1;H2(e,((r,i)=>{const a=r.name,o=zc(a+I2);if(0===t.filter((e=>e.name===a)).length){const e="global"===r.resolve?"union":r.resolve,n="multi"===r.type?", true)":")";t.push({name:r.name,update:`${V2}(${o}, ${zc(e)}${n}`})}n=!0,i.topLevelSignals&&(t=i.topLevelSignals(e,r,t)),A2(r,(n=>{n.topLevelSignals&&(t=n.topLevelSignals(e,r,t))}))})),n&&0===t.filter((e=>"unit"===e.name)).length&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]});return j2(t)}(this,e)}assembleSignals(){return[...o3(this),...(e=this,t=[],H2(e,((n,r)=>{const i=n.name;let a=r.modifyExpr(e,n);t.push(...r.signals(e,n)),A2(n,(r=>{r.signals&&(t=r.signals(e,n,t)),r.modifyExpr&&(a=r.modifyExpr(e,n,a))})),t.push({name:i+U2,on:[{events:{signal:n.name+q2},update:`modify(${zc(n.name+I2)}, ${a})`}]})})),j2(t))];var e,t}assembleSelectionData(e){return function(e,t){const n=[...t];return H2(e,(t=>{const r={name:t.name+I2};if(t.init){const n=t.project.items.map((e=>D2(e,["signals"]))),i=t.init.map((e=>C2(e,!1)));r.values="interval"===t.type?[{unit:G2(e,{escape:!1}),fields:n,values:i}]:i.map((t=>({unit:G2(e,{escape:!1}),fields:n,values:t})))}n.filter((e=>e.name===t.name+I2)).length||n.push(r)})),n}(this,e)}assembleLayout(){return null}assembleLayoutSignals(){return F3(this)}assembleMarks(){var e;let t=null!==(e=this.component.mark)&&void 0!==e?e:[];return this.parent&&P4(this.parent)||(t=M2(this,t)),t.map(this.correctDataNames)}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(e){return nZ(this.encoding,e)}fieldDef(e){return kQ(this.encoding[e])}typedFieldDef(e){const t=this.fieldDef(e);return oQ(t)?t:null}}class N6 extends z4{constructor(e,t,n,r,i){super(e,"layer",t,n,i,e.resolve,e.view);const a=Object.assign(Object.assign(Object.assign({},r),e.width?{width:e.width}:{}),e.height?{height:e.height}:{});this.children=e.layer.map(((e,t)=>{if(y0(e))return new N6(e,this,this.getName("layer_"+t),a,i);if(ZQ(e))return new T6(e,this,this.getName("layer_"+t),a,i);throw new Error(YX(e))}))}parseData(){this.component.data=m6(this);for(const e of this.children)e.parseData()}parseLayoutSize(){var e;l6(e=this),u6(e,"width"),u6(e,"height")}parseSelections(){this.component.selection={};for(const e of this.children){e.parseSelections();for(const t of IH(e.component.selection))this.component.selection[t]=e.component.selection[t]}}parseMarkGroup(){for(const e of this.children)e.parseMarkGroup()}parseAxesAndHeaders(){!function(e){var t;const{axes:n,resolve:r}=e.component,i={top:0,bottom:0,right:0,left:0};for(const t of e.children){t.parseAxesAndHeaders();for(const i of IH(t.component.axes))r.axis[i]=L3(e.component.resolve,i),"shared"===r.axis[i]&&(n[i]=w6(n[i],t.component.axes[i]),n[i]||(r.axis[i]="independent",delete n[i]))}for(const a of DX){for(const o of e.children)if(o.component.axes[a]){if("independent"===r.axis[a]){n[a]=(null!==(t=n[a])&&void 0!==t?t:[]).concat(o.component.axes[a]);for(const e of o.component.axes[a]){const{value:t,explicit:n}=e.getWithExplicit("orient");if(!VY(t)){if(i[t]>0&&!n){const n=x6[t];i[t]>i[n]&&e.set("orient",n,!1)}i[t]++}}}delete o.component.axes[a]}if("independent"===r.axis[a]&&n[a]&&n[a].length>1)for(const e of n[a])e.get("grid")&&!e.explicit.grid&&(e.implicit.grid=!1)}}(this)}assembleSelectionTopLevelSignals(e){return this.children.reduce(((e,t)=>t.assembleSelectionTopLevelSignals(e)),e)}assembleSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleSignals())),o3(this))}assembleLayoutSignals(){return this.children.reduce(((e,t)=>e.concat(t.assembleLayoutSignals())),F3(this))}assembleSelectionData(e){return this.children.reduce(((e,t)=>t.assembleSelectionData(e)),e)}assembleTitle(){let e=super.assembleTitle();if(e)return e;for(const t of this.children)if(e=t.assembleTitle(),e)return e}assembleLayout(){return null}assembleMarks(){return function(e,t){for(const n of e.children)T4(n)&&(t=M2(n,t));return t}(this,this.children.flatMap((e=>e.assembleMarks())))}assembleLegends(){return this.children.reduce(((e,t)=>e.concat(t.assembleLegends())),a5(this))}}function R6(e,t,n,r,i){if(WK(e))return new h6(e,t,n,i);if(y0(e))return new N6(e,t,n,r,i);if(ZQ(e))return new T6(e,t,n,r,i);if(function(e){return YZ(e)||JZ(e)||XZ(e)}(e))return new g6(e,t,n,i);throw new Error(YX(e))}var P6=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};var z6=Object.freeze({__proto__:null,normalize:V0,version:"4.17.0",compile:function(e,t={}){var n;t.logger&&(n=t.logger,SY=n),t.fieldTitle&&vQ(t.fieldTitle);try{const n=f0(Pu(t.config,e.config)),r=V0(e,n),i=R6(r,null,"",void 0,n);i.parse(),function(e,t){K5(e.sources);let n=0,r=0;for(let r=0;r<5&&Z5(e,t,!0);r++)n++;e.sources.map(X5);for(let n=0;n<5&&Z5(e,t,!1);n++)r++;K5(e.sources),5===Math.max(n,r)&&$Y("Maximum optimization runs(5) reached.")}(i.component.data,i);return{spec:function(e,t,n={},r){const i=e.config?m0(e.config):void 0,a=[].concat(e.assembleSelectionData([]),function(e,t){var n,r;const i=[],a=r6(i);let o=0;for(const t of e.sources){t.hasName()||(t.dataName="source_"+o++);const e=t.assemble();a(t,e)}for(const e of i)0===e.transform.length&&delete e.transform;let s=0;for(const[e,t]of i.entries())0!==(null!==(n=t.transform)&&void 0!==n?n:[]).length||t.source||i.splice(s++,0,i.splice(e,1)[0]);for(const t of i)for(const n of null!==(r=t.transform)&&void 0!==r?r:[])"lookup"===n.type&&(n.from=e.outputNodes[n.from].getSource());for(const e of i)e.name in t&&(e.values=t[e.name]);return i}(e.component.data,n)),o=e.assembleProjections(),s=e.assembleTitle(),l=e.assembleGroupStyle(),u=e.assembleGroupEncodeEntry(!0);let c=e.assembleLayoutSignals();c=c.filter((e=>"width"!==e.name&&"height"!==e.name||void 0===e.value||(t[e.name]=+e.value,!1)));const{params:f}=t,d=P6(t,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},e.description?{description:e.description}:{}),d),s?{title:s}:{}),l?{style:l}:{}),u?{encode:{update:u}}:{}),{data:a}),o.length>0?{projections:o}:{}),e.assembleGroup([...c,...e.assembleSelectionTopLevelSignals([]),...UZ(f)])),i?{config:i}:{}),r?{usermeta:r}:{})}(i,function(e,t,n,r){const i=r.component.layoutSize.get("width"),a=r.component.layoutSize.get("height");void 0===t?(t={type:"pad"},r.hasAxisOrientSignalRef()&&(t.resize=!0)):Cc(t)&&(t={type:t});if(i&&a&&(o=t.type,"fit"===o||"fit-x"===o||"fit-y"===o))if("step"===i&&"step"===a)$Y(ZX()),t.type="pad";else if("step"===i||"step"===a){const e="step"===i?"width":"height";$Y(ZX(FX(e)));const n="width"===e?"height":"width";t.type=function(e){return e?`fit-${FX(e)}`:"fit"}(n)}var o;return Object.assign(Object.assign(Object.assign({},1===IH(t).length&&t.type?"pad"===t.type?{}:{autosize:t.type}:{autosize:t}),X0(n,!1)),X0(e,!0))}(e,r.autosize,n,i),e.datasets,e.usermeta),normalized:r}}finally{t.logger&&(SY=OY),t.fieldTitle&&vQ(gQ)}},deepEqual:kH,duplicate:OH,pick:SH,omit:$H,stringify:EH,hash:AH,isNullOrFalse:DH,contains:CH,some:MH,every:jH,mergeDeep:FH,unique:NH,isEqual:function(e,t){const n=IH(e),r=IH(t);if(n.length!==r.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0},setEqual:RH,hasIntersection:PH,prefixGenerator:zH,fieldIntersection:BH,isEmpty:LH,keys:IH,vals:qH,entries:UH,isBoolean:VH,varName:WH,logicalExpr:HH,deleteNestedProperty:GH,titleCase:XH,accessPathWithDatum:YH,flatAccessWithDatum:JH,replacePathInField:QH,replaceAll:ZH,removePathFromField:eG,accessPathDepth:tG,getFirstDefined:nG,uniqueId:iG,resetIdCounter:function(){rG=42},internalField:aG,isInternalField:oG,normalizeAngle:sG,isNumeric:lG});function B6(e){const[t,n]=/\/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}const L6="#fff",I6={background:"#333",title:{color:L6},style:{"guide-label":{fill:L6},"guide-title":{fill:L6}},axis:{domainColor:L6,gridColor:"#888",tickColor:L6}},q6="#4572a7",U6={background:"#fff",arc:{fill:q6},area:{fill:q6},line:{stroke:q6,strokeWidth:2},path:{stroke:q6},rect:{fill:q6},shape:{stroke:q6},symbol:{fill:q6,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},V6="#30a2da",W6="#cbcbcb",H6="#f0f0f0",G6="#333",X6={arc:{fill:V6},area:{fill:V6},axis:{domainColor:W6,grid:!0,gridColor:W6,gridWidth:1,labelColor:"#999",labelFontSize:10,titleColor:"#333",tickColor:W6,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:H6,group:{fill:H6},legend:{labelColor:G6,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:G6,titleFontSize:14,titlePadding:10},line:{stroke:V6,strokeWidth:2},path:{stroke:V6,strokeWidth:.5},rect:{fill:V6},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:V6},bar:{binSpacing:2,fill:V6,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},Y6="#000",J6={group:{fill:"#e5e5e5"},arc:{fill:Y6},area:{fill:Y6},line:{stroke:Y6},path:{stroke:Y6},rect:{fill:Y6},shape:{stroke:Y6},symbol:{fill:Y6,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},K6="Benton Gothic, sans-serif",Q6="#82c6df",Z6="Benton Gothic Bold, sans-serif",e7="normal",t7={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},n7={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Z6,fontSize:22,fontWeight:"normal"},arc:{fill:Q6},area:{fill:Q6},line:{stroke:Q6,strokeWidth:2},path:{stroke:Q6},rect:{fill:Q6},shape:{stroke:Q6},symbol:{fill:Q6,size:30},axis:{labelFont:K6,labelFontSize:11.5,labelFontWeight:"normal",titleFont:Z6,titleFontSize:13,titleFontWeight:e7},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:K6,labelFontSize:11.5,symbolType:"square",titleFont:Z6,titleFontSize:13,titleFontWeight:e7},range:{category:t7["category-6"],diverging:t7["fireandice-6"],heatmap:t7["fire-7"],ordinal:t7["fire-7"],ramp:t7["fire-7"]}},r7="#ab5787",i7="#979797",a7={background:"#f9f9f9",arc:{fill:r7},area:{fill:r7},line:{stroke:r7},path:{stroke:r7},rect:{fill:r7},shape:{stroke:r7},symbol:{fill:r7,size:30},axis:{domainColor:i7,domainWidth:.5,gridWidth:.2,labelColor:i7,tickColor:i7,tickWidth:.2,titleColor:i7},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},o7="#3e5c69",s7={background:"#fff",arc:{fill:o7},area:{fill:o7},line:{stroke:o7},path:{stroke:o7},rect:{fill:o7},shape:{stroke:o7},symbol:{fill:o7},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},l7="#1696d2",u7="#000000",c7="Lato",f7="Lato",d7={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},h7={background:"#FFFFFF",title:{anchor:"start",fontSize:18,font:c7},axisX:{domain:!0,domainColor:u7,domainWidth:1,grid:!1,labelFontSize:12,labelFont:f7,labelAngle:0,tickColor:u7,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:c7},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:"#DEDDDD",gridWidth:1,labelFontSize:12,labelFont:f7,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:c7,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:f7,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:c7,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:d7["six-groups-cat-1"],diverging:d7["diverging-colors"],heatmap:d7["diverging-colors"],ordinal:d7["six-groups-seq"],ramp:d7["shades-blue"]},area:{fill:l7},rect:{fill:l7},line:{color:l7,stroke:l7,strokeWidth:5},trail:{color:l7,stroke:l7,strokeWidth:0,size:1},path:{stroke:l7,strokeWidth:.5},point:{filled:!0},text:{font:"Lato",color:l7,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:l7,stroke:null}},arc:{fill:l7},shape:{stroke:l7},symbol:{fill:l7,size:30}},p7="#3366CC",m7="#ccc",g7="Arial, sans-serif",y7={arc:{fill:p7},area:{fill:p7},path:{stroke:p7},rect:{fill:p7},shape:{stroke:p7},symbol:{stroke:p7},circle:{fill:p7},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:g7,fontSize:12},"guide-title":{font:g7,fontSize:12},"group-title":{font:g7,fontSize:12}},title:{font:g7,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:m7,tickColor:m7,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},v7="2.9.1";var b7=Object.freeze({__proto__:null,dark:I6,excel:U6,fivethirtyeight:X6,ggplot2:J6,googlecharts:y7,latimes:n7,quartz:a7,urbaninstitute:h7,version:v7,vox:s7}),x7="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black; }\n  #vg-tooltip-element.visible {\n    visibility: visible; }\n  #vg-tooltip-element h2 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 13px; }\n  #vg-tooltip-element img {\n    max-width: 200px;\n    max-height: 200px; }\n  #vg-tooltip-element table {\n    border-spacing: 0; }\n    #vg-tooltip-element table tr {\n      border: none; }\n      #vg-tooltip-element table tr td {\n        overflow: hidden;\n        text-overflow: ellipsis;\n        padding-top: 2px;\n        padding-bottom: 2px; }\n        #vg-tooltip-element table tr td.key {\n          color: #808080;\n          max-width: 150px;\n          text-align: right;\n          padding-right: 4px; }\n        #vg-tooltip-element table tr td.value {\n          display: block;\n          max-width: 300px;\n          max-height: 7em;\n          text-align: left; }\n  #vg-tooltip-element.dark-theme {\n    background-color: rgba(32, 32, 32, 0.9);\n    border: 1px solid #f5f5f5;\n    color: white; }\n    #vg-tooltip-element.dark-theme td.key {\n      color: #bfbfbf; }\n";const w7="vg-tooltip-element",_7={offsetX:10,offsetY:10,id:w7,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")},maxDepth:2};function k7(e,t,n){if(Tu(e))return`[${e.map((e=>t(Cc(e)?e:O7(e,n)))).join(", ")}]`;if(Nu(e)){let r="";const i=e,{title:a,image:o}=i,s=
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(i,["title","image"]);a&&(r+=`<h2>${t(a)}</h2>`),o&&(r+=`<img src="${t(o)}">`);const l=Object.keys(s);if(l.length>0){r+="<table>";for(const e of l){let i=s[e];void 0!==i&&(Nu(i)&&(i=O7(i,n)),r+=`<tr><td class="key">${t(e)}:</td><td class="value">${t(i)}</td></tr>`)}r+="</table>"}return r||"{}"}return t(e)}function O7(e,t){return JSON.stringify(e,function(e){const t=[];return function(n,r){if("object"!=typeof r||null===r)return r;const i=t.indexOf(this)+1;return t.length=i,t.length>e?"[Object]":t.indexOf(r)>=0?"[Circular]":(t.push(r),r)}}(t))}class S7{constructor(e){this.options=Object.assign(Object.assign({},_7),e);const t=this.options.id;if(this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const e=document.createElement("style");e.setAttribute("id",this.options.styleId),e.innerHTML=function(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return x7.toString().replace(w7,e)}(t);const n=document.head;n.childNodes.length>0?n.insertBefore(e,n.childNodes[0]):n.appendChild(e)}this.el=document.getElementById(t),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",t),this.el.classList.add("vg-tooltip"),document.body.appendChild(this.el))}tooltipHandler(e,t,n,r){if(null==r||""===r)return void this.el.classList.remove("visible",`${this.options.theme}-theme`);this.el.innerHTML=k7(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:i,y:a}=function(e,t,n,r){let i=e.clientX+n;i+t.width>window.innerWidth&&(i=+e.clientX-n-t.width);let a=e.clientY+r;return a+t.height>window.innerHeight&&(a=+e.clientY-r-t.height),{x:i,y:a}}(t,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${a}px; left: ${i}px`)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function $7(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))}var E7,A7='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box; }\n  .vega-embed.has-actions {\n    padding-right: 38px; }\n  .vega-embed details:not([open]) > :not(summary) {\n    display: none !important; }\n  .vega-embed summary {\n    list-style: none;\n    position: absolute;\n    top: 0;\n    right: 0;\n    padding: 6px;\n    z-index: 1000;\n    background: white;\n    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n    color: #1b1e23;\n    border: 1px solid #aaa;\n    border-radius: 999px;\n    opacity: 0.2;\n    transition: opacity 0.4s ease-in;\n    outline: none;\n    cursor: pointer;\n    line-height: 0px; }\n    .vega-embed summary::-webkit-details-marker {\n      display: none; }\n    .vega-embed summary:active {\n      box-shadow: #aaa 0px 0px 0px 1px inset; }\n    .vega-embed summary svg {\n      width: 14px;\n      height: 14px; }\n  .vega-embed details[open] summary {\n    opacity: 0.7; }\n  .vega-embed:hover summary,\n  .vega-embed:focus summary {\n    opacity: 1 !important;\n    transition: opacity 0.2s ease; }\n  .vega-embed .vega-actions {\n    position: absolute;\n    z-index: 1001;\n    top: 35px;\n    right: -9px;\n    display: flex;\n    flex-direction: column;\n    padding-bottom: 8px;\n    padding-top: 8px;\n    border-radius: 4px;\n    box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n    border: 1px solid #d9d9d9;\n    background: white;\n    animation-duration: 0.15s;\n    animation-name: scale-in;\n    animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n    text-align: left; }\n    .vega-embed .vega-actions a {\n      padding: 8px 16px;\n      font-family: sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      white-space: nowrap;\n      color: #434a56;\n      text-decoration: none; }\n      .vega-embed .vega-actions a:hover {\n        background-color: #f7f7f9;\n        color: black; }\n    .vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n      content: "";\n      display: inline-block;\n      position: absolute; }\n    .vega-embed .vega-actions::before {\n      left: auto;\n      right: 14px;\n      top: -16px;\n      border: 8px solid #0000;\n      border-bottom-color: #d9d9d9; }\n    .vega-embed .vega-actions::after {\n      left: auto;\n      right: 15px;\n      top: -14px;\n      border: 7px solid #0000;\n      border-bottom-color: #fff; }\n  .vega-embed .chart-wrapper {\n    width: 100%;\n    height: 100%; }\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px; }\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6); }\n  to {\n    opacity: 1;\n    transform: scale(1); } }\n';function D7(e,...t){for(const n of t)C7(e,n);return e}function C7(e,t){for(const n of Object.keys(t))zu(e,n,t[n],!0)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});const M7=mH;let j7=z6;const F7="undefined"!=typeof window?window:void 0;void 0===j7&&(null===(E7=null==F7?void 0:F7.vl)||void 0===E7?void 0:E7.compile)&&(j7=F7.vl);const T7={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},N7={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},R7={vega:"Vega","vega-lite":"Vega-Lite"},P7={vega:M7.version,"vega-lite":j7?j7.version:"not available"},z7={vega:e=>e,"vega-lite":(e,t)=>j7.compile(e,{config:t}).spec},B7='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',L7="chart-wrapper";function I7(e,t,n,r){const i=`<html><head>${t}</head><body><pre><code class="json">`,a=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(i+e+a),o.document.title=`${R7[r]} JSON Source`}function q7(e,t,n={}){var r,i,a;return $7(this,void 0,void 0,(function*(){const o=(s=n.loader)&&"load"in s?n.loader:M7.loader(n.loader);var s;const l=Cc(t)?JSON.parse(yield o.load(t)):t,u=yield U7(null!==(r=l.usermeta&&l.usermeta.embedOptions)&&void 0!==r?r:{},o),c=yield U7(n,o),f=Object.assign(Object.assign({},D7(c,u)),{config:Pu(null!==(i=c.config)&&void 0!==i?i:{},null!==(a=u.config)&&void 0!==a?a:{})});return yield function(e,t,n={},r){var i,a,o,s,l,u;return $7(this,void 0,void 0,(function*(){const c=n.theme?Pu(b7[n.theme],null!==(i=n.config)&&void 0!==i?i:{}):n.config,f=Sc(n.actions)?n.actions:D7({},T7,null!==(a=n.actions)&&void 0!==a?a:{}),d=Object.assign(Object.assign({},N7),n.i18n),h=null!==(o=n.renderer)&&void 0!==o?o:"canvas",p=null!==(s=n.logLevel)&&void 0!==s?s:M7.Warn,m=null!==(l=n.downloadFileName)&&void 0!==l?l:"visualization",g="string"==typeof e?document.querySelector(e):e;if(!g)throw new Error(`${e} does not exist`);if(!1!==n.defaultStyle){const e="vega-embed-style",{root:t,rootContainer:r}=function(e){var t;const n=e.getRootNode?e.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:null!==(t=document.head)&&void 0!==t?t:document.body}}(g);if(!t.getElementById(e)){const t=document.createElement("style");t.id=e,t.innerText=void 0===n.defaultStyle||!0===n.defaultStyle?A7.toString():n.defaultStyle,r.appendChild(t)}}const y=function(e,t){var n;if(e.$schema){const r=B6(e.$schema);t&&t!==r.library&&console.warn(`The given visualization spec is written in ${R7[r.library]}, but mode argument sets ${null!==(n=R7[t])&&void 0!==n?n:t}.`);const i=r.library;return gu.satisfies(P7[i],`^${r.version.slice(1)}`)||console.warn(`The input spec uses ${R7[i]} ${r.version}, but the current version of ${R7[i]} is v${P7[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":null!=t?t:"vega"}(t,n.mode);let v=z7[y](t,c);if("vega-lite"===y&&v.$schema){const e=B6(v.$schema);gu.satisfies(P7.vega,`^${e.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${e.version}, but current version is v${P7.vega}.`)}g.classList.add("vega-embed"),f&&g.classList.add("has-actions"),g.innerHTML="";let b=g;if(f){const e=document.createElement("div");e.classList.add(L7),g.appendChild(e),b=e}const x=n.patch;x&&(v=x instanceof Function?x(v):Zo(v,x,!0,!1).newDocument),n.formatLocale&&M7.formatLocale(n.formatLocale),n.timeFormatLocale&&M7.timeFormatLocale(n.timeFormatLocale);const{ast:w}=n,_=M7.parse(v,"vega-lite"===y?{}:c,{ast:w}),k=new M7.View(_,Object.assign({loader:r,logLevel:p,renderer:h},w?{expr:M7.expressionInterpreter}:{}));if(!1!==n.tooltip){let e;e=function(e){return"function"==typeof e}(n.tooltip)?n.tooltip:new S7(!0===n.tooltip?{}:n.tooltip).call,k.tooltip(e)}let O,{hover:S}=n;if(void 0===S&&(S="vega"===y),S){const{hoverSet:e,updateSet:t}="boolean"==typeof S?{}:S;k.hover(e,t)}if(n&&(null!=n.width&&k.width(n.width),null!=n.height&&k.height(n.height),null!=n.padding&&k.padding(n.padding)),yield k.initialize(b,n.bind).runAsync(),!1!==f){let e=g;if(!1!==n.defaultStyle){const t=document.createElement("details");t.title=d.CLICK_TO_VIEW_ACTIONS,g.append(t),e=t;const n=document.createElement("summary");n.innerHTML=B7,t.append(n),O=e=>{t.contains(e.target)||t.removeAttribute("open")},document.addEventListener("click",O)}const r=document.createElement("div");if(e.append(r),r.classList.add("vega-actions"),!0===f||!1!==f.export)for(const e of["svg","png"])if(!0===f||!0===f.export||f.export[e]){const t=d[`${e.toUpperCase()}_ACTION`],i=document.createElement("a");i.text=t,i.href="#",i.target="_blank",i.download=`${m}.${e}`,i.addEventListener("mousedown",(function(t){return $7(this,void 0,void 0,(function*(){t.preventDefault();const r=yield k.toImageURL(e,n.scaleFactor);this.href=r}))})),r.append(i)}if(!0===f||!1!==f.source){const e=document.createElement("a");e.text=d.SOURCE_ACTION,e.href="#",e.addEventListener("click",(function(e){var r,i;I7(fs(t),null!==(r=n.sourceHeader)&&void 0!==r?r:"",null!==(i=n.sourceFooter)&&void 0!==i?i:"",y),e.preventDefault()})),r.append(e)}if("vega-lite"===y&&(!0===f||!1!==f.compiled)){const e=document.createElement("a");e.text=d.COMPILED_ACTION,e.href="#",e.addEventListener("click",(function(e){var t,r;I7(fs(v),null!==(t=n.sourceHeader)&&void 0!==t?t:"",null!==(r=n.sourceFooter)&&void 0!==r?r:"","vega"),e.preventDefault()})),r.append(e)}if(!0===f||!1!==f.editor){const e=null!==(u=n.editorUrl)&&void 0!==u?u:"https://vega.github.io/editor/",i=document.createElement("a");i.text=d.EDITOR_ACTION,i.href="#",i.addEventListener("click",(function(n){!function(e,t,n){const r=e.open(t),{origin:i}=new URL(t);let a=40;e.addEventListener("message",(function t(n){n.source===r&&(a=0,e.removeEventListener("message",t,!1))}),!1),setTimeout((function e(){a<=0||(r.postMessage(n,i),setTimeout(e,250),a-=1)}),250)}(window,e,{config:c,mode:y,renderer:h,spec:fs(t)}),n.preventDefault()})),r.append(i)}}function $(){O&&document.removeEventListener("click",O),k.finalize()}return{view:k,spec:t,vgSpec:v,finalize:$}}))}(e,l,f,o)}))}function U7(e,t){var n;return $7(this,void 0,void 0,(function*(){const r=Cc(e.config)?JSON.parse(yield t.load(e.config)):null!==(n=e.config)&&void 0!==n?n:{},i=Cc(e.patch)?JSON.parse(yield t.load(e.patch)):e.patch;return Object.assign(Object.assign(Object.assign({},e),i?{patch:i}:{}),r?{config:r}:{})}))}const V7={$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:"container",height:500,layer:[{data:{name:"simulated"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]}],layer:[{transform:[{aggregate:[{op:"min",field:"cumNetValue",as:"teamMinNetValue"},{op:"max",field:"cumNetValue",as:"teamMaxNetValue"}],groupby:["rollIndex","turn","activeTeamColor","activeTeamName"]},{joinaggregate:[{op:"min",field:"teamMinNetValue",as:"minNetValue"},{op:"max",field:"teamMaxNetValue",as:"maxNetValue"}]},{calculate:"datum.rollIndex - 0.5",as:"x"},{calculate:"datum.rollIndex + 0.5",as:"x2"}],mark:{type:"rect",opacity:.05},encoding:{x:{field:"x",type:"quantitative"},x2:{field:"x2",type:"quantitative"},y:{field:"minNetValue",type:"quantitative",title:"Net Value"},y2:{field:"maxNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"}]}},{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["activeTeamColor","rollIndex"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"value",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},detail:{field:"prob",type:"nominal"},tooltip:[{field:"activeTeamColor",title:"Active Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}}]},{data:{name:"playHead"},mark:{type:"rule"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}}}},{data:{name:"actual"},transform:[{calculate:"join([datum.activeTeamId, datum.activeTeamName], '. ')",as:"activeTeamColor"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["activeTeamId","iteration","type"]},{calculate:"'#roll-' + datum.rollIndex",as:"url"}],layer:[{mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"quantitative",field:"rollIndex",title:"Action",axis:{labelExpr:"floor(datum.label)"}},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Active Team",legend:{disable:!0}},detail:{field:"iteration",type:"nominal"}}},{transform:[{flatten:["outcomes","weights"]},{bin:{step:.5,anchor:-.25},field:"outcomes",as:["outcomes_min","outcomes_max"]},{aggregate:[{op:"sum",field:"weights",as:"weight_sum"}],groupby:["rollIndex","activeTeamColor","activeTeamName","outcomes_min","outcomes_max","cumNetValue","netValue","description"]},{calculate:"datum.outcomes_min + datum.cumNetValue - datum.netValue",as:"posNetValue_min"},{calculate:"datum.outcomes_max + datum.cumNetValue - datum.netValue",as:"posNetValue_max"},{calculate:"datum.rollIndex - (datum.weight_sum / 2)",as:"x"},{calculate:"datum.rollIndex + (datum.weight_sum / 2)",as:"x2"},{calculate:"datum.posNetValue_min",as:"y"},{calculate:"datum.posNetValue_max",as:"y2"},{calculate:"join([datum.outcomes_min, datum.outcomes_max], ' - ')",as:"outcomes_range"}],mark:{type:"rect",opacity:.7},encoding:{x:{type:"quantitative",field:"x"},x2:{type:"quantitative",field:"x2"},y:{type:"quantitative",field:"y"},y2:{type:"quantitative",field:"y2"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"description",title:"Roll"},{field:"outcomes_range",title:"Net Value Change"},{field:"weight_sum",title:"Probability",format:".2p"},{field:"activeTeamName",title:"Active Team"}]}},{mark:{type:"point"},selection:{zoom_x:{type:"interval",bind:"scales",encodings:["x"]}},encoding:{x:{type:"quantitative",field:"rollIndex"},y:{field:"cumNetValue",type:"quantitative",title:"Net Value"},color:{field:"activeTeamColor",type:"nominal",title:"Team",legend:{disable:!0}},tooltip:[{field:"turn",title:"Turn"},{field:"activeTeamName",title:"Active Team"},{field:"description",title:"Roll"},{field:"valueDescription",title:"Value"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}],href:{field:"url",type:"nominal"}}}]}]};function W7(t){let n;return{c(){n=w("div"),n.innerHTML='<div id="chart" class="col-sm-12 svelte-1yk3kez"></div>',A(n,"id","results")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}function H7(e,t,n){const r=I();let i,a,{rolls:o}=t,{replayStepIndex:s}=t,{selectedRoll:l}=t,{replayStart:u}=t,{replayEnd:c}=t;return L((()=>(console.log("Results onMount"),function(){const e=o.filter((e=>{const t=e.actual;return isFinite(t.outcomeValue)?!!isFinite(t.expectedValue)||(console.warn("Dice roll with non-finite expected value",{roll:e,dataPoint:t}),!1):(console.warn("Dice roll with non-finite outcome value",{roll:e,dataPoint:t}),!1)})),t=e.map((e=>e.actual));console.log("Valid rolls",e),console.log("Actual points",t),q7("#chart",V7).then((a=>{a.view.addEventListener("click",(function(e,t){t&&(n(0,l=t.datum.rollIndex),n(1,u=o[l].stepIndex),n(2,c=o[l+1].stepIndex),console.log("Results clicked",{selectedRoll:l,replayStart:u,replayEnd:c}))})),n(5,i=a.view),n(5,i=a.view.insert("actual",t).run()),n(5,i=i.insert("simulated",t).run());var s=0;function f(){for(var t=[],a=0;a<50;a++)s++,t=t.concat(e.map((e=>e.simulated(s))));var o=ag().insert(t);n(5,i=i.change("simulated",o).run()),r("iterationComplete",s),s<1e3&&window.setTimeout(f,200)}f()}))}(),console.log("Results onMount chart rendered"),()=>console.log("destroyed")))),e.$$set=e=>{"rolls"in e&&n(3,o=e.rolls),"replayStepIndex"in e&&n(4,s=e.replayStepIndex),"selectedRoll"in e&&n(0,l=e.selectedRoll),"replayStart"in e&&n(1,u=e.replayStart),"replayEnd"in e&&n(2,c=e.replayEnd)},e.$$.update=()=>{if(120&e.$$.dirty){if(console.log("Results reactive"),o&&s){let e=o.findIndex((e=>s<e.stepIndex));n(6,a=e>0?o[e-1].rollIndex:0)}if(i&&a){var t=ag().remove((()=>!0)).insert([{rollIndex:a}]);n(5,i=i.change("playHead",t).run())}}},[l,u,c,o,s,i,a]}class G7 extends Oe{constructor(e){super(),ke(this,e,H7,W7,s,{rolls:3,replayStepIndex:4,selectedRoll:0,replayStart:1,replayEnd:2})}}function X7(t){let n;return{c(){n=w("p"),n.textContent="Welcome to Diced or Not, the Blood Bowl 2 replay dice analyzer! If you've just\n  had a particularly good or bad game and you want to know if the dice are to\n  blame, this is the site for you. To get started, use the button below to\n  select the replay you want to load. These are .bbrz files that are usually\n  located in My Documents\\BloodBowl2\\Profiles\\(Coach Name or ID)\\Replays. Diced\n  or Not will analyze the replay and extract all the dice rolls, then show them\n  to you along with a bunch of statistics about just how lucky or unlucky you\n  were.",A(n,"id","about")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class Y7 extends Oe{constructor(e){super(),ke(this,e,null,X7,s,{})}}function J7(t){let n;return{c(){n=w("nav"),n.innerHTML='<a class="navbar-brand svelte-gb2y3h" href="/#">Diced or Not</a> \n    <ul class="navbar-nav"><li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#about">About</a></li> \n      <li class="dropdown svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#summary">Replay</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#explanation">Explain?</a></li> \n      <li class="nav-item svelte-gb2y3h"><a class="nav-link svelte-gb2y3h" href="#contact">Contact</a></li></ul>',A(n,"class","navbar-dark bg-dark sidenav svelte-gb2y3h")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class K7 extends Oe{constructor(e){super(),ke(this,e,null,J7,s,{})}}function Q7(e){let t,n,r,i,a,o,s;return n=new D8({props:{casType:"reserve",dugout:e[0]}}),i=new D8({props:{casType:"ko",dugout:e[0]}}),o=new D8({props:{casType:"cas",dugout:e[0]}}),{c(){t=w("div"),xe(n.$$.fragment),r=k(),xe(i.$$.fragment),a=k(),xe(o.$$.fragment),A(t,"class","bench svelte-4xq83r")},m(e,l){v(e,t,l),we(n,t,null),y(t,r),we(i,t,null),y(t,a),we(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),o.$set(s)},i(e){s||(ce(n.$$.fragment,e),ce(i.$$.fragment,e),ce(o.$$.fragment,e),s=!0)},o(e){fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),s=!1},d(e){e&&b(t),_e(n),_e(i),_e(o)}}}function Z7(e,t,n){let{dugout:r}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout)},[r]}class e8 extends Oe{constructor(e){super(),ke(this,e,Z7,Q7,s,{dugout:0})}}function t8(e){let t,n,r,i;const a=e[4].default,o=function(e,t,n,r){if(e){const i=l(e,t,n,r);return e[0](i)}}(a,e,e[3],null);return{c(){t=w("div"),n=w("div"),o&&o.c(),A(n,"class",r=c(`inner ${e[2]||""}`)+" svelte-190gtax"),A(t,"class","outer svelte-190gtax"),C(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},m(e,r){v(e,t,r),y(t,n),o&&o.m(n,null),i=!0},p(e,[s]){o&&o.p&&8&s&&u(o,a,e,e[3],s,null,null),(!i||4&s&&r!==(r=c(`inner ${e[2]||""}`)+" svelte-190gtax"))&&A(n,"class",r),(!i||3&s)&&C(t,"padding-top","calc(("+e[1]+"/"+e[0]+") * 100%)")},i(e){i||(ce(o,e),i=!0)},o(e){fe(o,e),i=!1},d(e){e&&b(t),o&&o.d(e)}}}function n8(e,t,n){let{$$slots:r={},$$scope:i}=t,{width:a=1}=t,{height:o=1}=t,{class:s=null}=t;return e.$$set=e=>{"width"in e&&n(0,a=e.width),"height"in e&&n(1,o=e.height),"class"in e&&n(2,s=e.class),"$$scope"in e&&n(3,i=e.$$scope)},[a,o,s,i,r]}class r8 extends Oe{constructor(e){super(),ke(this,e,n8,t8,s,{width:0,height:1,class:2})}}function i8(e,t,n){const r=e.slice();return r[5]=t[n],r[7]=n,r}function a8(e,t,n){const r=e.slice();return r[8]=t[n],r[10]=n,r}function o8(t){let n,r;return{c(){n=w("div"),A(n,"class","grid-item svelte-1gz3er0"),A(n,"id",r=t[0]+"_"+t[10]+"_"+t[7])},m(e,t){v(e,n,t)},p(e,t){7&t&&r!==(r=e[0]+"_"+e[10]+"_"+e[7])&&A(n,"id",r)},i:e,o:e,d(e){e&&b(n)}}}function s8(e){let t,r,i;const a=[{row:e[7]},{column:e[10]},{width:e[1]},{height:e[2]},e[4],{id:e[0]+"_"+e[10]+"_"+e[7]}];var o=e[3];function s(e){let t={};for(let e=0;e<a.length;e+=1)t=n(t,a[e]);return{props:t}}return o&&(t=new o(s())),{c(){t&&xe(t.$$.fragment),r=O()},m(e,n){t&&we(t,e,n),v(e,r,n),i=!0},p(e,n){const i=23&n?ye(a,[4&n&&{row:e[7]},2&n&&{column:e[10]},2&n&&{width:e[1]},4&n&&{height:e[2]},16&n&&ve(e[4]),7&n&&{id:e[0]+"_"+e[10]+"_"+e[7]}]):{};if(o!==(o=e[3])){if(t){le();const e=t;fe(e.$$.fragment,1,0,(()=>{_e(e,1)})),ue()}o?(t=new o(s()),xe(t.$$.fragment),ce(t.$$.fragment,1),we(t,r.parentNode,r)):t=null}else o&&t.$set(i)},i(e){i||(t&&ce(t.$$.fragment,e),i=!0)},o(e){t&&fe(t.$$.fragment,e),i=!1},d(e){e&&b(r),t&&_e(t,e)}}}function l8(e,t){let n,r,i,a,o;const s=[s8,o8],l=[];function u(e,t){return e[3]?0:1}return r=u(t),i=l[r]=s[r](t),{key:e,first:null,c(){n=O(),i.c(),a=O(),this.first=n},m(e,t){v(e,n,t),l[r].m(e,t),v(e,a,t),o=!0},p(e,t){let n=r;r=u(e),r===n?l[r].p(e,t):(le(),fe(l[n],1,1,(()=>{l[n]=null})),ue(),i=l[r],i?i.p(e,t):(i=l[r]=s[r](e),i.c()),ce(i,1),i.m(a.parentNode,a))},i(e){o||(ce(i),o=!0)},o(e){fe(i),o=!1},d(e){e&&b(n),l[r].d(e),e&&b(a)}}}function u8(e,t){let n,r,i,a=[],o=new Map,s=Array(t[1]);const l=e=>e[10];for(let e=0;e<s.length;e+=1){let n=a8(t,s,e),r=l(n);o.set(r,a[e]=l8(r,n))}return{key:e,first:null,c(){n=O();for(let e=0;e<a.length;e+=1)a[e].c();r=O(),this.first=n},m(e,t){v(e,n,t);for(let n=0;n<a.length;n+=1)a[n].m(e,t);v(e,r,t),i=!0},p(e,t){if(31&t){const n=Array(e[1]);le(),a=ge(a,t,l,1,e,n,o,r.parentNode,me,l8,r,a8),ue()}},i(e){if(!i){for(let e=0;e<s.length;e+=1)ce(a[e]);i=!0}},o(e){for(let e=0;e<a.length;e+=1)fe(a[e]);i=!1},d(e){e&&b(n);for(let t=0;t<a.length;t+=1)a[t].d(e);e&&b(r)}}}function c8(e){let t,n,r=[],i=new Map,a=Array(e[2]);const o=e=>e[7];for(let t=0;t<a.length;t+=1){let n=i8(e,a,t),s=o(n);i.set(s,r[t]=u8(s,n))}return{c(){t=w("div");for(let e=0;e<r.length;e+=1)r[e].c();A(t,"class","grid svelte-1gz3er0"),C(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),C(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},m(e,i){v(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,a){if(31&a){const n=Array(e[2]);le(),r=ge(r,a,o,1,e,n,i,t,me,u8,null,i8),ue()}(!n||2&a)&&C(t,"grid-template-columns","repeat("+e[1]+", minmax(0, 1fr))"),(!n||4&a)&&C(t,"grid-template-rows","repeat("+e[2]+", minmax(0, 1fr))")},i(e){if(!n){for(let e=0;e<a.length;e+=1)ce(r[e]);n=!0}},o(e){for(let e=0;e<r.length;e+=1)fe(r[e]);n=!1},d(e){e&&b(t);for(let e=0;e<r.length;e+=1)r[e].d()}}}function f8(e){let t,n;return t=new r8({props:{width:e[1],height:e[2],$$slots:{default:[c8]},$$scope:{ctx:e}}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,[n]){const r={};2&n&&(r.width=e[1]),4&n&&(r.height=e[2]),2079&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function d8(e,t,n){let{prefix:r}=t,{width:i}=t,{height:a}=t,{component:o=null}=t,{componentProps:s={}}=t;return e.$$set=e=>{"prefix"in e&&n(0,r=e.prefix),"width"in e&&n(1,i=e.width),"height"in e&&n(2,a=e.height),"component"in e&&n(3,o=e.component),"componentProps"in e&&n(4,s=e.componentProps)},[r,i,a,o,s]}class h8 extends Oe{constructor(e){super(),ke(this,e,d8,f8,s,{prefix:0,width:1,height:2,component:3,componentProps:4})}}function p8(e){const t=e-1;return t*t*t+1}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function m8(e,{delay:t=0,duration:n=400,easing:r=p8,start:i=0,opacity:a=0}){const o=getComputedStyle(e),s=+o.opacity,l="none"===o.transform?"":o.transform,u=1-i,c=s*(1-a);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${l} scale(${1-u*t});\n\t\t\topacity: ${s-c*t}\n\t\t`}}function g8(e){var{fallback:t}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["fallback"]);const i=new Map,a=new Map;function s(e,i,a){return(s,l)=>(e.set(l.key,{rect:s.getBoundingClientRect()}),()=>{if(i.has(l.key)){const{rect:e}=i.get(l.key);return i.delete(l.key),function(e,t,i){const{delay:a=0,duration:s=(e=>30*Math.sqrt(e)),easing:l=p8}=n(n({},r),i),u=t.getBoundingClientRect(),c=e.left-u.left,f=e.top-u.top,d=e.width/u.width,h=e.height/u.height,p=Math.sqrt(c*c+f*f),m=getComputedStyle(t),g="none"===m.transform?"":m.transform,y=+m.opacity;return{delay:a,duration:o(s)?s(p):s,easing:l,css:(e,t)=>`\n\t\t\t\topacity: ${e*y};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${g} translate(${t*c}px,${t*f}px) scale(${e+(1-e)*d}, ${e+(1-e)*h});\n\t\t\t`}}(e,s,l)}return e.delete(l.key),t&&t(s,l,a)})}return[s(a,i,!1),s(i,a,!0)]}function y8(e){let t,n;return{c(){t=w("img"),t.src!==(n=`/images/skills/${e[5]}.png`)&&A(t,"src",n),A(t,"alt",e[5]),A(t,"class","svelte-28czd8")},m(e,n){v(e,t,n)},p(e,r){32&r&&t.src!==(n=`/images/skills/${e[5]}.png`)&&A(t,"src",n),32&r&&A(t,"alt",e[5])},d(e){e&&b(t)}}}function v8(n){let r,i,s,l,u,f=n[5]&&y8(n);return{c(){r=w("div"),f&&f.c(),A(r,"id",n[7]),A(r,"class",i=c(n[6])+" svelte-28czd8"),M(r,"done",n[0]),M(r,"moving",n[1]),M(r,"stunned",n[2]),M(r,"prone",n[3]),M(r,"blitz",n[4])},m(e,t){v(e,r,t),f&&f.m(r,null),u=!0},p(e,t){(n=e)[5]?f?f.p(n,t):(f=y8(n),f.c(),f.m(r,null)):f&&(f.d(1),f=null),(!u||128&t)&&A(r,"id",n[7]),(!u||64&t&&i!==(i=c(n[6])+" svelte-28czd8"))&&A(r,"class",i),65&t&&M(r,"done",n[0]),66&t&&M(r,"moving",n[1]),68&t&&M(r,"stunned",n[2]),72&t&&M(r,"prone",n[3]),80&t&&M(r,"blitz",n[4])},i(i){u||(K((()=>{l&&l.end(1),s||(s=function(n,r,i){let a,s,l=r(n,i),u=!1,c=0;function f(){a&&P(n,a)}function h(){const{delay:r=0,duration:i=300,easing:o=t,tick:h=e,css:p}=l||de;p&&(a=R(n,0,1,i,r,o,p,c++)),h(0,1);const m=d()+r,y=m+i;s&&s.abort(),u=!0,K((()=>ae(n,!0,"start"))),s=g((e=>{if(u){if(e>=y)return h(1,0),ae(n,!0,"end"),f(),u=!1;if(e>=m){const t=o((e-m)/i);h(t,1-t)}}return u}))}let p=!1;return{start(){p||(P(n),o(l)?(l=l(),ie().then(h)):h())},invalidate(){p=!1},end(){u&&(f(),u=!1)}}}(r,n[9],{key:n[7]})),s.start()})),u=!0)},o(i){s&&s.invalidate(),l=function(n,r,i){let s,l=r(n,i),u=!0;const c=se;function f(){const{delay:r=0,duration:i=300,easing:o=t,tick:f=e,css:h}=l||de;h&&(s=R(n,1,0,i,r,o,h));const p=d()+r,m=p+i;K((()=>ae(n,!1,"start"))),g((e=>{if(u){if(e>=m)return f(0,1),ae(n,!1,"end"),--c.r||a(c.c),!1;if(e>=p){const t=o((e-p)/i);f(1-t,t)}}return u}))}return c.r+=1,o(l)?ie().then((()=>{l=l(),f()})):f(),{end(e){e&&l.tick&&l.tick(1,0),u&&(s&&P(n,s),u=!1)}}}(r,n[8],{key:n[7]}),u=!1},d(e){e&&b(r),f&&f.d(),e&&l&&l.end()}}}function b8(t){let n,r,i=t[7],a=v8(t);return{c(){a.c(),n=O()},m(e,t){a.m(e,t),v(e,n,t),r=!0},p(t,[r]){128&r&&s(i,i=t[7])?(le(),fe(a,1,1,e),ue(),a=v8(t),a.c(),ce(a),a.m(n.parentNode,n)):a.p(t,r)},i(e){r||(ce(a),r=!0)},o(e){fe(a),r=!1},d(e){e&&b(n),a.d(e)}}}function x8(e,t,n){let r,i,{id:a}=t,{race:o}=t,{model:s}=t,{team:l}=t,{done:u=!1}=t,{moving:c=!1}=t,{stunned:f=!1}=t,{prone:d=!1}=t,{blitz:h=!1}=t,{cas:p=null}=t,{stupidity:m=null}=t;const[g,y]=g8({duration:e=>Math.sqrt(200*e),fallback:m8});return e.$$set=e=>{"id"in e&&n(10,a=e.id),"race"in e&&n(11,o=e.race),"model"in e&&n(12,s=e.model),"team"in e&&n(13,l=e.team),"done"in e&&n(0,u=e.done),"moving"in e&&n(1,c=e.moving),"stunned"in e&&n(2,f=e.stunned),"prone"in e&&n(3,d=e.prone),"blitz"in e&&n(4,h=e.blitz),"cas"in e&&n(5,p=e.cas),"stupidity"in e&&n(14,m=e.stupidity)},e.$$.update=()=>{31744&e.$$.dirty&&(n(6,r=[o,s,l,"sprite"].concat(m?[m]:[]).join(" ")),n(7,i=`player_${a}`))},[u,c,f,d,h,p,r,i,g,y,a,o,s,l,m]}class w8 extends Oe{constructor(e){super(),ke(this,e,x8,b8,s,{id:10,race:11,model:12,team:13,done:0,moving:1,stunned:2,prone:3,blitz:4,cas:5,stupidity:14})}}function _8(e){let t,r;const i=[e[1]];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new w8({props:a}),{c(){xe(t.$$.fragment)},m(e,n){we(t,e,n),r=!0},p(e,n){const r=2&n?ye(i,[ve(e[1])]):{};t.$set(r)},i(e){r||(ce(t.$$.fragment,e),r=!0)},o(e){fe(t.$$.fragment,e),r=!1},d(e){_e(t,e)}}}function k8(e){let t,n,r=e[1]&&_8(e);return{c(){t=w("div"),r&&r.c(),A(t,"id",e[0]),A(t,"class","pitch-square svelte-eoi57j")},m(e,i){v(e,t,i),r&&r.m(t,null),n=!0},p(e,[i]){e[1]?r?(r.p(e,i),2&i&&ce(r,1)):(r=_8(e),r.c(),ce(r,1),r.m(t,null)):r&&(le(),fe(r,1,1,(()=>{r=null})),ue()),(!n||1&i)&&A(t,"id",e[0])},i(e){n||(ce(r),n=!0)},o(e){fe(r),n=!1},d(e){e&&b(t),r&&r.d()}}}function O8(e,t,n){let r,{dugout:i}=t,{id:a}=t,{row:o}=t,{column:s}=t,{width:l}=t,{height:u}=t,{casType:c}=t,f=null;return e.$$set=e=>{"dugout"in e&&n(2,i=e.dugout),"id"in e&&n(0,a=e.id),"row"in e&&n(3,o=e.row),"column"in e&&n(4,s=e.column),"width"in e&&n(5,l=e.width),"height"in e&&n(6,u=e.height),"casType"in e&&n(7,c=e.casType)},e.$$.update=()=>{508&e.$$.dirty&&i&&(n(8,r="ko"==c?i.cas.slice(l*u).concat(i[c]):"reserve"==c?i.ko.slice(l*u).concat(i[c]):i[c]),n(1,f=r[s*u+o]))},[a,f,i,o,s,l,u,c,r]}class S8 extends Oe{constructor(e){super(),ke(this,e,O8,k8,s,{dugout:2,id:0,row:3,column:4,width:5,height:6,casType:7})}}function $8(e){let t;return{c(){t=w("div"),t.innerHTML='<div id="player_14" class="vampire thrall3 sprite home"><img src="ArmourBust.png" width="20" height="20"/><img src="ArmourBust.png" width="20" height="20"/></div>',A(t,"class","grid_item"),A(t,"id","home_cas_0_0")},m(e,n){v(e,t,n)},d(e){e&&b(t)}}}function E8(e){let t,n,r,i;return n=new h8({props:{width:4,height:2,prefix:e[0],component:S8,componentProps:{casType:e[0],dugout:e[1]},$$slots:{default:[$8]},$$scope:{ctx:e}}}),{c(){t=w("div"),xe(n.$$.fragment),A(t,"class",r=`bench ${e[0]}`)},m(e,r){v(e,t,r),we(n,t,null),i=!0},p(e,[a]){const o={};1&a&&(o.prefix=e[0]),3&a&&(o.componentProps={casType:e[0],dugout:e[1]}),4&a&&(o.$$scope={dirty:a,ctx:e}),n.$set(o),(!i||1&a&&r!==(r=`bench ${e[0]}`))&&A(t,"class",r)},i(e){i||(ce(n.$$.fragment,e),i=!0)},o(e){fe(n.$$.fragment,e),i=!1},d(e){e&&b(t),_e(n)}}}function A8(e,t,n){let{casType:r}=t,{dugout:i}=t;return e.$$set=e=>{"casType"in e&&n(0,r=e.casType),"dugout"in e&&n(1,i=e.dugout)},[r,i]}class D8 extends Oe{constructor(e){super(),ke(this,e,A8,E8,s,{casType:0,dugout:1})}}function C8(e){let t,n,r,i,a,o,s;return n=new D8({props:{casType:"cas",dugout:e[0]}}),i=new D8({props:{casType:"ko",dugout:e[0]}}),o=new D8({props:{casType:"reserve",dugout:e[0]}}),{c(){t=w("div"),xe(n.$$.fragment),r=k(),xe(i.$$.fragment),a=k(),xe(o.$$.fragment),A(t,"class","bench svelte-kd7r5x")},m(e,l){v(e,t,l),we(n,t,null),y(t,r),we(i,t,null),y(t,a),we(o,t,null),s=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0]),n.$set(r);const a={};1&t&&(a.dugout=e[0]),i.$set(a);const s={};1&t&&(s.dugout=e[0]),o.$set(s)},i(e){s||(ce(n.$$.fragment,e),ce(i.$$.fragment,e),ce(o.$$.fragment,e),s=!0)},o(e){fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),s=!1},d(e){e&&b(t),_e(n),_e(i),_e(o)}}}function M8(e,t,n){let{dugout:r}=t;return e.$$set=e=>{"dugout"in e&&n(0,r=e.dugout)},[r]}class j8 extends Oe{constructor(e){super(),ke(this,e,M8,C8,s,{dugout:0})}}function F8(e){let t,n,r,i,a;return{c(){t=w("div"),t.innerHTML='<div class="inducement wizard svelte-ulwshi"></div>',n=k(),r=w("div"),r.innerHTML='<div class="inducement apo svelte-ulwshi"></div>',i=k(),a=w("div"),a.innerHTML='<div class="reroll svelte-ulwshi"></div>',A(t,"class","grid_item_dice"),A(r,"class","grid_item_dice"),A(a,"class","grid_item_dice")},m(e,o){v(e,t,o),v(e,n,o),v(e,r,o),v(e,i,o),v(e,a,o)},d(e){e&&b(t),e&&b(n),e&&b(r),e&&b(i),e&&b(a)}}}function T8(e){let t,n;return t=new h8({props:{width:10,height:3,prefix:"dice",$$slots:{default:[F8]},$$scope:{ctx:e}}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}class N8 extends Oe{constructor(e){super(),ke(this,e,null,T8,s,{})}}function R8(e){let t;return{c(){t=w("div"),t.innerHTML='<div id="selectedPlayerName"></div> \n    <div><div class="grid_stat">MV</div> \n      <div class="grid_stat" id="selectPlayer-MV"></div> \n      <div class="grid_stat">ST</div> \n      <div class="grid_stat" id="selectPlayer-ST"></div> \n      <div class="grid_stat">AG</div> \n      <div class="grid_stat" id="selectPlayer-AG"></div> \n      <div class="grid_stat">AV</div> \n      <div class="grid_stat" id="selectPlayer-AV"></div></div> \n    <div id="selectedPlayerCAS"></div> \n    <div id="skills"></div>',A(t,"id","selectedPlayerData"),A(t,"class","svelte-dj6vrn")},m(e,n){v(e,t,n)},d(e){e&&b(t)}}}function P8(e){let t,n;return t=new r8({props:{width:207,height:317,$$slots:{default:[R8]},$$scope:{ctx:e}}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,[n]){const r={};1&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}class z8 extends Oe{constructor(e){super(),ke(this,e,null,P8,s,{})}}function B8(e){let t,n,r;return{c(){t=w("div"),A(t,"class",n=c(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu"),A(t,"title",r=e[1][e[0]])},m(e,n){v(e,t,n)},p(e,i){1&i&&n!==(n=c(`weather sprite ${e[2][e[0]]}`)+" svelte-v8s2iu")&&A(t,"class",n),1&i&&r!==(r=e[1][e[0]])&&A(t,"title",r)},d(e){e&&b(t)}}}function L8(e){let t,n;return t=new r8({props:{$$slots:{default:[B8]},$$scope:{ctx:e}}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,[n]){const r={};9&n&&(r.$$scope={dirty:n,ctx:e}),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function I8(e,t,n){let{weather:r}=t;const i={[ut]:"perfect blood bowl weather",[ct]:"sweltering heat!",[ft]:"very sunny",[dt]:"pouring rain",[ht]:"blizzard go brrrr"},a={[ut]:"nice",[ct]:"heat",[ft]:"sunny",[dt]:"rain",[ht]:"blizzard"};return e.$$set=e=>{"weather"in e&&n(0,r=e.weather)},[r,i,a]}class q8 extends Oe{constructor(e){super(),ke(this,e,I8,L8,s,{weather:0})}}function U8(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,x,O,S,$,E,C,j,F,T,N,R,P=e[0].name+"",z=e[0].score+"",B=e[0].turn+"";return n=new j8({props:{dugout:e[0].dugout}}),$=new N8({}),j=new z8({}),N=new q8({props:{weather:e[1]}}),{c(){t=w("div"),xe(n.$$.fragment),r=k(),i=w("img"),s=k(),l=w("div"),u=_(P),c=k(),f=w("div"),d=w("p"),h=_(z),p=k(),m=w("div"),g=w("p"),x=_(B),O=k(),S=w("div"),xe($.$$.fragment),E=k(),C=w("div"),xe(j.$$.fragment),F=k(),T=w("div"),xe(N.$$.fragment),i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png")&&A(i,"src",a),A(i,"alt",o="Logo: "+e[0].logo),A(i,"class","logo svelte-x8vtg0"),A(l,"class","name svelte-x8vtg0"),A(f,"class","score svelte-x8vtg0"),A(m,"class","turn svelte-x8vtg0"),M(m,"active",e[0].active),A(S,"class","aids svelte-x8vtg0"),A(C,"class","selected svelte-x8vtg0"),A(T,"class","weather svelte-x8vtg0"),A(t,"class","dugout svelte-x8vtg0")},m(e,a){v(e,t,a),we(n,t,null),y(t,r),y(t,i),y(t,s),y(t,l),y(l,u),y(t,c),y(t,f),y(f,d),y(d,h),y(t,p),y(t,m),y(m,g),y(g,x),y(t,O),y(t,S),we($,S,null),y(t,E),y(t,C),we(j,C,null),y(t,F),y(t,T),we(N,T,null),R=!0},p(e,[t]){const r={};1&t&&(r.dugout=e[0].dugout),n.$set(r),(!R||1&t&&i.src!==(a="/images/logo/256x256/logo_"+e[0].logo+".png"))&&A(i,"src",a),(!R||1&t&&o!==(o="Logo: "+e[0].logo))&&A(i,"alt",o),(!R||1&t)&&P!==(P=e[0].name+"")&&D(u,P),(!R||1&t)&&z!==(z=e[0].score+"")&&D(h,z),(!R||1&t)&&B!==(B=e[0].turn+"")&&D(x,B),1&t&&M(m,"active",e[0].active);const s={};2&t&&(s.weather=e[1]),N.$set(s)},i(e){R||(ce(n.$$.fragment,e),ce($.$$.fragment,e),ce(j.$$.fragment,e),ce(N.$$.fragment,e),R=!0)},o(e){fe(n.$$.fragment,e),fe($.$$.fragment,e),fe(j.$$.fragment,e),fe(N.$$.fragment,e),R=!1},d(e){e&&b(t),_e(n),_e($),_e(j),_e(N)}}}function V8(e,t,n){let{homeTeam:r}=t,{weather:i}=t;return e.$$set=e=>{"homeTeam"in e&&n(0,r=e.homeTeam),"weather"in e&&n(1,i=e.weather)},[r,i]}class W8 extends Oe{constructor(e){super(),ke(this,e,V8,U8,s,{homeTeam:0,weather:1})}}function H8(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,x,O,S,$=e[0].score+"",E=e[0].turn+"",C=e[0].name+"";return r=new N8({props:{reverse:!0}}),O=new e8({props:{dugout:e[0].dugout}}),{c(){t=w("div"),n=w("div"),xe(r.$$.fragment),i=k(),a=w("div"),o=_($),s=k(),l=w("div"),u=_(E),c=k(),f=w("div"),d=_(C),h=k(),p=w("img"),x=k(),xe(O.$$.fragment),A(n,"class","aids svelte-1dth5by"),A(a,"class","score svelte-1dth5by"),A(l,"class","turn svelte-1dth5by"),M(l,"active",e[0].active),A(f,"class","name svelte-1dth5by"),A(p,"class","logo svelte-1dth5by"),p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png")&&A(p,"src",m),A(p,"alt",g="Logo: "+e[0].logo),A(t,"class","dugout svelte-1dth5by")},m(e,m){v(e,t,m),y(t,n),we(r,n,null),y(t,i),y(t,a),y(a,o),y(t,s),y(t,l),y(l,u),y(t,c),y(t,f),y(f,d),y(t,h),y(t,p),y(t,x),we(O,t,null),S=!0},p(e,[t]){(!S||1&t)&&$!==($=e[0].score+"")&&D(o,$),(!S||1&t)&&E!==(E=e[0].turn+"")&&D(u,E),1&t&&M(l,"active",e[0].active),(!S||1&t)&&C!==(C=e[0].name+"")&&D(d,C),(!S||1&t&&p.src!==(m="/images/logo/256x256/logo_"+e[0].logo+".png"))&&A(p,"src",m),(!S||1&t&&g!==(g="Logo: "+e[0].logo))&&A(p,"alt",g);const n={};1&t&&(n.dugout=e[0].dugout),O.$set(n)},i(e){S||(ce(r.$$.fragment,e),ce(O.$$.fragment,e),S=!0)},o(e){fe(r.$$.fragment,e),fe(O.$$.fragment,e),S=!1},d(e){e&&b(t),_e(r),_e(O)}}}function G8(e,t,n){let{awayTeam:r}=t;return e.$$set=e=>{"awayTeam"in e&&n(0,r=e.awayTeam)},[r]}class X8 extends Oe{constructor(e){super(),ke(this,e,G8,H8,s,{awayTeam:0})}}function Y8(t){let n;return{c(){n=w("div"),A(n,"class","logo svelte-5pwedy"),C(n,"background-image","url('/images/logo/256x256/logo_"+t[0]+".png')")},m(e,t){v(e,n,t)},p(e,[t]){1&t&&C(n,"background-image","url('/images/logo/256x256/logo_"+e[0]+".png')")},i:e,o:e,d(e){e&&b(n)}}}function J8(e,t,n){let{logo:r}=t;return e.$$set=e=>{"logo"in e&&n(0,r=e.logo)},[r]}class K8 extends Oe{constructor(e){super(),ke(this,e,J8,Y8,s,{logo:0})}}function Q8(t){let n,r;return{c(){n=w("div"),A(n,"class",r=c(`cell sprite ${t[4]}`)+" svelte-1t9kenh"),M(n,"active",t[0]),M(n,"target",t[1]),M(n,"moved",t[3]),M(n,"pushback-choice",t[2])},m(e,t){v(e,n,t)},p(e,[t]){16&t&&r!==(r=c(`cell sprite ${e[4]}`)+" svelte-1t9kenh")&&A(n,"class",r),17&t&&M(n,"active",e[0]),18&t&&M(n,"target",e[1]),24&t&&M(n,"moved",e[3]),20&t&&M(n,"pushback-choice",e[2])},i:e,o:e,d(e){e&&b(n)}}}function Z8(e,t,n){let r,{plus:i=null}=t,{active:a=!1}=t,{target:o=!1}=t,{pushbackChoice:s=!1}=t,{moved:l=!1}=t;return e.$$set=e=>{"plus"in e&&n(5,i=e.plus),"active"in e&&n(0,a=e.active),"target"in e&&n(1,o=e.target),"pushbackChoice"in e&&n(2,s=e.pushbackChoice),"moved"in e&&n(3,l=e.moved)},e.$$.update=()=>{33&e.$$.dirty&&n(4,r=!a&&i?`plus${i}`:"")},[a,o,s,l,r,i]}class e9 extends Oe{constructor(e){super(),ke(this,e,Z8,Q8,s,{plus:5,active:0,target:1,pushbackChoice:2,moved:3})}}function t9(t){let n;return{c(){n=w("div"),A(n,"id","ball"),A(n,"class","svelte-q0voaj"),M(n,"held",t[0])},m(e,t){v(e,n,t)},p(e,[t]){1&t&&M(n,"held",e[0])},i:e,o:e,d(e){e&&b(n)}}}function n9(e,t,n){let{held:r=!1}=t;return e.$$set=e=>{"held"in e&&n(0,r=e.held)},[r]}class r9 extends Oe{constructor(e){super(),ke(this,e,n9,t9,s,{held:0})}}function i9(e,t,n){const r=e.slice();return r[2]=t[n],r}function a9(e){let t,n=e[0],r=[];for(let t=0;t<n.length;t+=1)r[t]=o9(i9(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=O()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);v(e,t,n)},p(e,i){if(3&i){let a;for(n=e[0],a=0;a<n.length;a+=1){const o=i9(e,n,a);r[a]?r[a].p(o,i):(r[a]=o9(o),r[a].c(),r[a].m(t.parentNode,t))}for(;a<r.length;a+=1)r[a].d(1);r.length=n.length}},d(e){x(r,e),e&&b(t)}}}function o9(e){let t,n;return{c(){t=w("div"),A(t,"class",n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")},m(e,n){v(e,t,n)},p(e,r){1&r&&n!==(n="dice sprite d"+e[0].length+"h "+e[1][e[2]]+" svelte-1cue4bg")&&A(t,"class",n)},d(e){e&&b(t)}}}function s9(t){let n,r=t[0]&&a9(t);return{c(){n=w("div"),r&&r.c(),A(n,"class","dice-container svelte-1cue4bg")},m(e,t){v(e,n,t),r&&r.m(n,null)},p(e,[t]){e[0]?r?r.p(e,t):(r=a9(e),r.c(),r.m(n,null)):r&&(r.d(1),r=null)},i:e,o:e,d(e){e&&b(n),r&&r.d()}}}function l9(e,t,n){let{dice:r}=t;return e.$$set=e=>{"dice"in e&&n(0,r=e.dice)},[r,["attacker-down","both-down","push","defender-stumbles","defender-down"]]}class u9 extends Oe{constructor(e){super(),ke(this,e,l9,s9,s,{dice:0})}}function c9(t){let n;return{c(){n=w("div"),n.innerHTML='<div class="dice sprite d1h foul svelte-u76c3n"></div>',A(n,"class","dice-container svelte-u76c3n")},m(e,t){v(e,n,t)},p:e,i:e,o:e,d(e){e&&b(n)}}}class f9 extends Oe{constructor(e){super(),ke(this,e,null,c9,s,{})}}function d9(e){let t,n;return t=new K8({props:{logo:e[3].toLowerCase()}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};8&n&&(r.logo=e[3].toLowerCase()),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function h9(e){let t,n;return t=new K8({props:{logo:e[4].toLowerCase()}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};16&n&&(r.logo=e[4].toLowerCase()),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function p9(e){let t,r;const i=[e[6]];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new e9({props:a}),{c(){xe(t.$$.fragment)},m(e,n){we(t,e,n),r=!0},p(e,n){const r=64&n?ye(i,[ve(e[6])]):{};t.$set(r)},i(e){r||(ce(t.$$.fragment,e),r=!0)},o(e){fe(t.$$.fragment,e),r=!1},d(e){_e(t,e)}}}function m9(e){let t,r;const i=[e[5]];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new w8({props:a}),{c(){xe(t.$$.fragment)},m(e,n){we(t,e,n),r=!0},p(e,n){const r=32&n?ye(i,[ve(e[5])]):{};t.$set(r)},i(e){r||(ce(t.$$.fragment,e),r=!0)},o(e){fe(t.$$.fragment,e),r=!1},d(e){_e(t,e)}}}function g9(e){let t,n;return t=new u9({props:{dice:e[8]}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};256&n&&(r.dice=e[8]),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function y9(e){let t,n;return t=new f9({}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function v9(e){let t,r;const i=[e[7]];let a={};for(let e=0;e<i.length;e+=1)a=n(a,i[e]);return t=new r9({props:a}),{c(){xe(t.$$.fragment)},m(e,n){we(t,e,n),r=!0},p(e,n){const r=128&n?ye(i,[ve(e[7])]):{};t.$set(r)},i(e){r||(ce(t.$$.fragment,e),r=!0)},o(e){fe(t.$$.fragment,e),r=!1},d(e){_e(t,e)}}}function b9(e){let t,n,r,i,a,o,s,l,u=0==e[2]&&7==e[1]&&e[3]&&d9(e),c=25==e[2]&&7==e[1]&&e[4]&&h9(e),f=e[6]&&p9(e),d=e[5]&&m9(e),h=e[8]&&g9(e),p=e[9]&&y9(),m=e[7]&&v9(e);return{c(){t=w("div"),u&&u.c(),n=k(),c&&c.c(),r=k(),f&&f.c(),i=k(),d&&d.c(),a=k(),h&&h.c(),o=k(),p&&p.c(),s=k(),m&&m.c(),A(t,"id",e[0]),A(t,"class","pitch-square svelte-124v8fk")},m(e,g){v(e,t,g),u&&u.m(t,null),y(t,n),c&&c.m(t,null),y(t,r),f&&f.m(t,null),y(t,i),d&&d.m(t,null),y(t,a),h&&h.m(t,null),y(t,o),p&&p.m(t,null),y(t,s),m&&m.m(t,null),l=!0},p(e,[g]){0==e[2]&&7==e[1]&&e[3]?u?(u.p(e,g),14&g&&ce(u,1)):(u=d9(e),u.c(),ce(u,1),u.m(t,n)):u&&(le(),fe(u,1,1,(()=>{u=null})),ue()),25==e[2]&&7==e[1]&&e[4]?c?(c.p(e,g),22&g&&ce(c,1)):(c=h9(e),c.c(),ce(c,1),c.m(t,r)):c&&(le(),fe(c,1,1,(()=>{c=null})),ue()),e[6]?f?(f.p(e,g),64&g&&ce(f,1)):(f=p9(e),f.c(),ce(f,1),f.m(t,i)):f&&(le(),fe(f,1,1,(()=>{f=null})),ue()),e[5]?d?(d.p(e,g),32&g&&ce(d,1)):(d=m9(e),d.c(),ce(d,1),d.m(t,a)):d&&(le(),fe(d,1,1,(()=>{d=null})),ue()),e[8]?h?(h.p(e,g),256&g&&ce(h,1)):(h=g9(e),h.c(),ce(h,1),h.m(t,o)):h&&(le(),fe(h,1,1,(()=>{h=null})),ue()),e[9]?p?512&g&&ce(p,1):(p=y9(),p.c(),ce(p,1),p.m(t,s)):p&&(le(),fe(p,1,1,(()=>{p=null})),ue()),e[7]?m?(m.p(e,g),128&g&&ce(m,1)):(m=v9(e),m.c(),ce(m,1),m.m(t,null)):m&&(le(),fe(m,1,1,(()=>{m=null})),ue()),(!l||1&g)&&A(t,"id",e[0])},i(e){l||(ce(u),ce(c),ce(f),ce(d),ce(h),ce(p),ce(m),l=!0)},o(e){fe(u),fe(c),fe(f),fe(d),fe(h),fe(p),fe(m),l=!1},d(e){e&&b(t),u&&u.d(),c&&c.d(),f&&f.d(),d&&d.d(),h&&h.d(),p&&p.d(),m&&m.d()}}}function x9(e,t,n){let{id:r}=t,{row:i}=t,{column:a}=t,{width:o}=t,{height:s}=t,{pitch:l}=t,{homeLogo:u}=t,{awayLogo:c}=t,f=null,d=null,h=null,p=null,m=!1;return e.$$set=e=>{"id"in e&&n(0,r=e.id),"row"in e&&n(1,i=e.row),"column"in e&&n(2,a=e.column),"width"in e&&n(10,o=e.width),"height"in e&&n(11,s=e.height),"pitch"in e&&n(12,l=e.pitch),"homeLogo"in e&&n(3,u=e.homeLogo),"awayLogo"in e&&n(4,c=e.awayLogo)},e.$$.update=()=>{4102&e.$$.dirty&&n(5,({player:f,cell:d,ball:h,dice:p,foul:m}=l[`${a}-${i}`]||{}),f,(n(6,d),n(12,l),n(2,a),n(1,i)),(n(7,h),n(12,l),n(2,a),n(1,i)),(n(8,p),n(12,l),n(2,a),n(1,i)),(n(9,m),n(12,l),n(2,a),n(1,i)))},[r,i,a,u,c,f,d,h,p,m,o,s,l]}class w9 extends Oe{constructor(e){super(),ke(this,e,x9,b9,s,{id:0,row:1,column:2,width:10,height:11,pitch:12,homeLogo:3,awayLogo:4})}}function _9(e){let t,n,r;return n=new h8({props:{width:26,height:15,prefix:"pos",component:w9,componentProps:{homeLogo:e[1],awayLogo:e[2],pitch:e[0]}}}),{c(){t=w("div"),xe(n.$$.fragment),A(t,"class","pitch svelte-1d39j5z")},m(e,i){v(e,t,i),we(n,t,null),r=!0},p(e,[t]){const r={};7&t&&(r.componentProps={homeLogo:e[1],awayLogo:e[2],pitch:e[0]}),n.$set(r)},i(e){r||(ce(n.$$.fragment,e),r=!0)},o(e){fe(n.$$.fragment,e),r=!1},d(e){e&&b(t),_e(n)}}}function k9(e,t,n){let r,i,{homeTeam:a}=t,{awayTeam:o}=t,{pitch:s}=t;return e.$$set=e=>{"homeTeam"in e&&n(3,a=e.homeTeam),"awayTeam"in e&&n(4,o=e.awayTeam),"pitch"in e&&n(0,s=e.pitch)},e.$$.update=()=>{24&e.$$.dirty&&(n(1,r=a.logo),n(2,i=o.logo))},[s,r,i,a,o]}class O9 extends Oe{constructor(e){super(),ke(this,e,k9,_9,s,{homeTeam:3,awayTeam:4,pitch:0})}}function S9(e){let t,n;return{c(){t=w("div"),A(t,"class",n=c(`sprite ${e[0]}`)+" svelte-39bs0u")},m(e,n){v(e,t,n)},p(e,r){1&r&&n!==(n=c(`sprite ${e[0]}`)+" svelte-39bs0u")&&A(t,"class",n)},d(e){e&&b(t)}}}function $9(e){let t,n,r;return n=new r8({props:{width:2,height:1,$$slots:{default:[S9]},$$scope:{ctx:e}}}),{c(){t=w("div"),xe(n.$$.fragment),A(t,"class","banner svelte-39bs0u")},m(e,i){v(e,t,i),we(n,t,null),r=!0},p(e,[t]){const r={};3&t&&(r.$$scope={dirty:t,ctx:e}),n.$set(r)},i(e){r||(ce(n.$$.fragment,e),r=!0)},o(e){fe(n.$$.fragment,e),r=!1},d(e){e&&b(t),_e(n)}}}function E9(e,t,n){let{banner:r}=t;return e.$$set=e=>{"banner"in e&&n(0,r=e.banner)},[r]}class A9 extends Oe{constructor(e){super(),ke(this,e,E9,$9,s,{banner:0})}}const{document:D9}=he;function C9(e,t,n){const r=e.slice();return r[47]=t[n],r}function M9(e,t){let n,r;return{key:e,first:null,c(){n=w("link"),A(n,"rel","stylesheet"),A(n,"href",r="/styles/"+t[47]+".css"),this.first=n},m(e,t){v(e,n,t)},p(e,t){1&t[0]&&r!==(r="/styles/"+e[47]+".css")&&A(n,"href",r)},d(e){e&&b(n)}}}function j9(e){let t,n;return t=new A9({props:{banner:e[4]}}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},p(e,n){const r={};16&n[0]&&(r.banner=e[4]),t.$set(r)},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function F9(e){let t,n,r,i,a,o,s,l,u;n=new W8({props:{homeTeam:e[1],weather:e[5]}}),i=new O9({props:{pitch:e[3],homeTeam:e[1],awayTeam:e[2]}}),o=new X8({props:{awayTeam:e[2]}});let c=e[4]&&j9(e);return{c(){t=w("div"),xe(n.$$.fragment),r=k(),xe(i.$$.fragment),a=k(),xe(o.$$.fragment),s=k(),c&&c.c(),l=O(),A(t,"class","pitch svelte-70qdsx")},m(e,f){v(e,t,f),we(n,t,null),y(t,r),we(i,t,null),y(t,a),we(o,t,null),v(e,s,f),c&&c.m(e,f),v(e,l,f),u=!0},p(e,t){const r={};2&t[0]&&(r.homeTeam=e[1]),32&t[0]&&(r.weather=e[5]),n.$set(r);const a={};8&t[0]&&(a.pitch=e[3]),2&t[0]&&(a.homeTeam=e[1]),4&t[0]&&(a.awayTeam=e[2]),i.$set(a);const s={};4&t[0]&&(s.awayTeam=e[2]),o.$set(s),e[4]?c?(c.p(e,t),16&t[0]&&ce(c,1)):(c=j9(e),c.c(),ce(c,1),c.m(l.parentNode,l)):c&&(le(),fe(c,1,1,(()=>{c=null})),ue())},i(e){u||(ce(n.$$.fragment,e),ce(i.$$.fragment,e),ce(o.$$.fragment,e),ce(c),u=!0)},o(e){fe(n.$$.fragment,e),fe(i.$$.fragment,e),fe(o.$$.fragment,e),fe(c),u=!1},d(e){e&&b(t),_e(n),_e(i),_e(o),e&&b(s),c&&c.d(e),e&&b(l)}}}function T9(e){let t,n,r,i,a=[],o=new Map,s=e[0];const l=e=>e[47];for(let t=0;t<s.length;t+=1){let n=C9(e,s,t),r=l(n);o.set(r,a[t]=M9(r,n))}return r=new r8({props:{width:1335,height:1061,$$slots:{default:[F9]},$$scope:{ctx:e}}}),{c(){for(let e=0;e<a.length;e+=1)a[e].c();t=w("link"),n=k(),xe(r.$$.fragment),A(t,"rel","stylesheet"),A(t,"href","/styles/sprite.css")},m(e,o){for(let e=0;e<a.length;e+=1)a[e].m(D9.head,null);y(D9.head,t),v(e,n,o),we(r,e,o),i=!0},p(e,n){if(1&n[0]){const r=e[0];a=ge(a,n,l,1,e,r,o,t.parentNode,pe,M9,t,C9)}const i={};62&n[0]|524288&n[1]&&(i.$$scope={dirty:n,ctx:e}),r.$set(i)},i(e){i||(ce(r.$$.fragment,e),i=!0)},o(e){fe(r.$$.fragment,e),i=!1},d(e){for(let e=0;e<a.length;e+=1)a[e].d();b(t),e&&b(n),_e(r,e)}}}function N9(e,t){return{logo:e.Data.Logo.toLowerCase(),dugout:{cas:[],ko:[],reserve:[]},score:e.Touchdown||0,name:e.Data.Name,turn:e.GameTurn||1,active:t}}function R9(e){return e&&e.length?e:e?[e]:[]}function P9(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}function z9(e){}function B9(e,t,n){let r,i,a,o,s,l,{replaySteps:u}=t,{replayStepIndex:c}=t,{replayStart:f}=t,{replayEnd:d}=t,h=[],p={},m={},g={};const y={[st.Reserves]:"reserve",[st.KO]:"ko",[st.Casualty]:"cas",[st.SentOff]:"cas"};async function v(e,t,o){r=e.slice(t,o),t>0?await b(e[t-1].BoardState):(i=0,a=null,n(0,h=[]),n(1,p={}),n(2,m={}),n(3,g={}),n(5,l=ut))}async function b(e){S(),o=e.BlitzerId,n(1,p=N9(e.ListTeams.TeamState[0],1!=e.ActiveTeam)),n(2,m=N9(e.ListTeams.TeamState[1],1==e.ActiveTeam)),n(0,h=e.ListTeams.TeamState.map((e=>Kt[e.Data.IdRace])).filter(((e,t,n)=>n.indexOf(e)===t))),function(e){Object.values(g).forEach((e=>{e.player&&(e.player=null)})),e.ListTeams.TeamState[0].ListPitchPlayers.PlayerState.map((e=>_(e,"home"))),e.ListTeams.TeamState[1].ListPitchPlayers.PlayerState.map((e=>_(e,"away")))}(e),function(e){let{x:t,y:n}=e.Ball.Cell;Object.values(g).forEach((e=>{e.ball=null})),-1!=t&&-1!=n&&(x(e.Ball.Cell).ball={held:1==e.Ball.IsHeld})}(e),await J()}function x(e){return n(3,g[`${e.x||0}-${e.y||0}`]=g[`${e.x||0}-${e.y||0}`]||{},g)}function w(e){let t;return Object.entries(g).forEach((([r,i])=>{i.player&&i.player.id==e&&(n(3,g[r]=i,g),t=i.player)})),t}function _(e,t){let n=function(e,t){switch(t){case 71:case 414:case 459:return{race:"amazon",model:"blitzer"+(e%2+1)};case 70:case 413:case 458:return{race:"amazon",model:"catcher"+(e%2+1)};case 68:case 411:case 456:return{race:"amazon",model:"lineman"+(e%2+1)};case 69:case 457:case 412:return{race:"amazon",model:"thrower"};case 32:case 336:case 355:return{race:"chaos",model:"beastman"+(e%4+1)};case 34:case 338:case 357:return{race:"chaos",model:"minotaur"+(e%3+1)};case 33:case 337:case 356:return{race:"chaos",model:"warrior"+(e%6+1)};case 330:case 363:case 109:return{race:"chaosdwarf",model:"blocker"+(e%4+1)};case 331:case 364:case 110:return{race:"chaosdwarf",model:"bullcentaur"+(e%2+1)};case 329:case 362:case 108:return{race:"chaosdwarf",model:"hobgoblin"+(e%4+1)};case 332:case 365:case 111:return{race:"chaosdwarf",model:"minotaur"};case 47:case 345:case 391:return{race:"darkelf",model:"lineman"};case 48:case 347:case 392:return{race:"darkelf",model:"runner"};case 49:case 346:case 394:return{race:"darkelf",model:"assasin"};case 50:case 344:case 393:return{race:"darkelf",model:"blitzer"};case 51:case 348:case 395:return{race:"darkelf",model:"witchelf"};case 6:case 426:return{race:"dwarf",model:"longbeard"+(e%3+1)};case 8:case 427:return{race:"dwarf",model:"blitzer"+(e%2+1)};case 7:case 429:return{race:"dwarf",model:"runner"+(e%3+1)};case 9:case 428:return{race:"dwarf",model:"trollslayer"+(e%2+1)};case 10:case 430:return{race:"dwarf",model:"deathroller"};case 30:case 372:case 466:case 479:return{race:"goblin",model:"goblin"+(e%7+1)};case 31:case 373:case 467:case 481:return{race:"goblin",model:"looney"+(e%2+1)};case 44:case 377:case 471:case 484:return{race:"goblin",model:"troll"+(e%3+1)};case 45:case 374:case 468:case 482:return{race:"goblin",model:"pogo"+(e%2+1)};case 46:case 376:case 470:case 483:return{race:"goblin",model:"fanatic"+(e%2+1)};case 107:case 375:case 469:case 480:return{race:"goblin",model:"bomber"+(e%2+1)};case 60:case 431:case 485:return{race:"halfling",model:"halfling"+(e%5+1)};case 61:case 432:case 486:return{race:"halfling",model:"treeman"+(e%3+1)};case 77:case 323:case 387:return{race:"highelf",model:"lineman"+(e%2+1)};case 78:case 325:case 390:return{race:"highelf",model:"thrower"};case 79:case 389:case 326:return{race:"highelf",model:"catch"+(e%2+1)};case 80:case 324:case 388:return{race:"highelf",model:"blitzer"};case 1:case 422:case 438:return{race:"human",model:"lineman"+(e%2+1)};case 2:case 423:case 440:return{race:"human",model:"catcher"};case 3:case 424:case 441:return{race:"human",model:"thrower"};case 4:case 421:case 439:return{race:"human",model:"blitzer"};case 5:case 425:case 442:return{race:"human",model:"ogre"};case 81:case 499:return{race:"khemri",model:"lineman"+(e%4+1)};case 82:case 500:return{race:"khemri",model:"thrower"+(e%2+1)};case 83:case 501:return{race:"khemri",model:"blitzer"+(e%2+1)};case 84:case 502:return{race:"khemri",model:"mummy"+(e%2+1)};case 27:case 415:case 472:return{race:"lizardman",model:"skink"+(e%4+1)};case 28:case 416:case 473:return{race:"lizardman",model:"saurus"+(e%4+1)};case 29:case 417:case 474:return{race:"lizardman",model:"kroxigor"+(e%2+1)};case 86:return{race:"necromantic",model:"zombie"+(e%4+1)};case 87:return{race:"necromantic",model:"ghoul"+(e%2+1)};case 88:return{race:"necromantic",model:"wight"+(e%2+1)};case 89:case 498:return{race:"necromantic",model:"golem"+(e%2+1)};case 90:case 497:return{race:"necromantic",model:"werewolf"+(e%2+1)};case 62:case 405:case 450:return{race:"norse",model:"lineman"+(e%4+1)};case 63:case 406:case 452:return{race:"norse",model:"thrower"};case 64:case 407:case 451:return{race:"norse",model:"runner"};case 65:case 408:case 453:return{race:"norse",model:"berserker"+(e%2+1)};case 66:case 409:case 454:return{race:"norse",model:"ulfwerener"+(e%2+1)};case 67:case 410:case 455:return{race:"norse",model:"yhetee"};case 91:case 358:return{race:"nurgle",model:"rotter"+(e%6+1)};case 92:case 359:return{race:"nurgle",model:"pestigor"+(e%4+1)};case 93:case 360:return{race:"nurgle",model:"warrior"+(e%4+1)};case 94:case 361:return{race:"nurgle",model:"beast - of - nurgle"};case 95:case 476:case 478:case 737:return{race:"ogre",model:"snotling"+(e%7+1)};case 96:case 475:case 477:case 738:return{race:"ogre",model:"ogre"+(e%6+1)};case 21:case 366:case 460:return{race:"orc",model:"lineman"+(e%3+1)};case 22:case 369:case 463:return{race:"orc",model:"goblin"+(e%2+1)};case 23:case 368:case 462:return{race:"orc",model:"thrower"+(e%2+1)};case 24:case 370:case 464:return{race:"orc",model:"blocker"+(e%4+1)};case 25:case 367:case 461:return{race:"orc",model:"blitzer"+(e%3+1)};case 26:case 371:case 465:return{race:"orc",model:"troll"};case 72:case 739:return{race:"proelf",model:"lineman"+(e%2+1)};case 73:case 741:return{race:"proelf",model:"thrower"};case 74:case 749:return{race:"proelf",model:"catcher"+(e%2+1)};case 75:case 740:return{race:"proelf",model:"blitzer"+(e%2+1)};case 16:case 339:case 378:return{race:"skaven",model:"lineman"+(e%3+1)};case 17:case 340:case 380:return{race:"skaven",model:"thrower"};case 18:case 341:case 381:return{race:"skaven",model:"runner"+(e%2+1)};case 19:case 342:case 379:return{race:"skaven",model:"blitzer"+(e%2+1)};case 20:case 343:case 382:return{race:"skaven",model:"ratogre"};case 54:case 492:return{race:"undead",model:"skeleton"+(e%3+1)};case 55:case 493:return{race:"undead",model:"zombie"+(e%4+1)};case 56:case 494:return{race:"undead",model:"ghoul"+(e%2+1)};case 57:case 495:return{race:"undead",model:"wight"+(e%2+1)};case 58:case 496:return{race:"undead",model:"mummy"+(e%2+1)};case 123:case 732:return{race:"underworld",model:"goblin"+(e%5+1)};case 124:case 733:return{race:"underworld",model:"lineman"+(e%4+1)};case 125:case 734:return{race:"underworld",model:"thrower"+(e%2+1)};case 126:case 735:return{race:"underworld",model:"blitzer"+(e%2+1)};case 127:case 736:return{race:"underworld",model:"troll"};case 97:case 327:case 327:case 503:return{race:"vampire",model:"thrall"+(e%3+1)};case 98:case 328:case 328:case 504:return{race:"vampire",model:"vampire"+(e%3+1)};case 11:case 396:case 433:return{race:"woodelf",model:"lineman"+(e%4+1)};case 12:case 397:case 434:return{race:"woodelf",model:"catcher"+(e%4+1)};case 13:case 398:case 435:return{race:"woodelf",model:"thrower"+(e%2+1)};case 14:case 399:case 436:return{race:"woodelf",model:"wardancer"+(e%2+1)};case 15:case 400:case 437:return{race:"woodelf",model:"tree"};case 142:case 401:case 446:return{race:"kislev",model:"lineman"+(e%4+1)};case 143:case 403:case 448:return{race:"kislev",model:"catcher"+(e%2+1)};case 144:case 402:case 447:return{race:"kislev",model:"blitzer"+(e%2+1)};case 145:case 404:case 449:return{race:"kislev",model:"bear"};case 139:case 333:case 420:case 443:return{race:"bretonnia",model:"peasant"+(e%3+1)};case 140:case 335:case 419:case 445:return{race:"bretonnia",model:"blocker"+(e%2+1)};case 141:case 334:case 418:case 444:return{race:"bretonnia",model:"knight"+(e%2+1)};case 146:case 239:case 617:case 618:return{model:"barik-farblast",race:"starplayer"};case 293:case 294:case 619:case 620:return{model:"bertha-bigfist",race:"starplayer"};case 133:case 233:case 621:case 622:return{model:"bomber-dribblesnot",race:"starplayer"};case 309:case 310:case 623:case 624:return{model:"boomer-eziasson",race:"starplayer"};case 164:case 256:case 625:case 626:return{model:"brick-farth",race:"starplayer"};case 224:case 59:case 627:case 628:return{model:"count-luthorvon-drakenborg",race:"starplayer"};case 301:case 302:case 629:case 630:return{model:"crazy-igor",race:"starplayer"};case 103:case 229:case 631:case 632:return{model:"deeproot-strongbranch",race:"starplayer"};case 147:case 240:case 633:case 634:return{model:"dolfar-longstride",race:"starplayer"};case 101:case 227:case 635:case 636:return{model:"eldril-sidewinder",race:"starplayer"};case 154:case 247:case 637:case 638:return{model:"fezglitch",race:"starplayer"};case 313:case 314:case 639:case 640:return{model:"flint-churnblade",race:"starplayer"};case 303:case 304:case 641:case 642:return{model:"fungus-the-loon",race:"starplayer"};case 149:case 242:case 643:case 644:return{model:"glart-smashrip-jr",race:"starplayer"};case 214:case 36:case 645:case 646:return{model:"grashnak-blackhoof",race:"starplayer"};case 215:case 37:case 647:case 648:return{model:"griff-oberwald",race:"starplayer"};case 216:case 38:case 649:case 650:return{model:"grim-ironjaw",race:"starplayer"};case 148:case 241:case 651:case 652:return{model:"grotty",race:"starplayer"};case 315:case 316:case 653:case 654:return{model:"hack-enslash",race:"starplayer"};case 138:case 238:case 655:case 656:return{model:"hakflem-skuttlespike",race:"starplayer"};case 217:case 39:case 657:case 658:return{model:"headsplitter",race:"starplayer"};case 317:case 318:case 659:case 660:return{model:"helmut-wulf",race:"starplayer"};case 275:case 276:case 661:case 662:return{model:"hemlock",race:"starplayer"};case 222:case 52:case 663:case 664:return{model:"horkon-heartripper",race:"starplayer"};case 299:case 300:case 665:case 666:return{model:"hthark-the-unstoppable",race:"starplayer"};case 137:case 237:case 667:case 668:return{model:"hubris-rakarth",race:"starplayer"};case 307:case 308:case 669:case 670:return{model:"humerus-carpal",race:"starplayer"};case 106:case 232:case 671:case 672:return{model:"icepelt-hammerblow",race:"starplayer"};case 157:case 250:case 673:case 674:return{model:"ithaca-benoin",race:"starplayer"};case 136:case 236:case 675:case 676:return{model:"j-earlice",race:"starplayer"};case 218:case 40:case 677:case 678:return{model:"jordel-freshbreeze",race:"starplayer"};case 158:case 251:case 679:case 680:return{model:"lewdgrip-whiparm",race:"starplayer"};case 102:case 228:case 683:case 684:return{model:"lord-borak-the-despoiler",race:"starplayer"};case 281:case 282:case 681:case 682:return{model:"lottabottol",race:"starplayer"};case 160:case 252:case 685:case 686:return{model:"max-spleenripper",race:"starplayer"};case 135:case 235:case 687:case 688:return{model:"mighty-zug",race:"starplayer"};case 223:case 53:case 689:case 690:return{model:"morg-n-thorg",race:"starplayer"};case 305:case 306:case 693:case 694:return{model:"nobbla-blackwart",race:"starplayer"};case 150:case 243:case 691:case 692:return{model:"prince-moranion",race:"starplayer"};case 161:case 253:case 695:case 696:return{model:"puggy-baconbreath",race:"starplayer"};case 283:case 284:case 697:case 698:return{model:"quetzal-leap",race:"starplayer"};case 231:case 699:case 700:case 105:return{model:"ramtut-iii",race:"starplayer"};case 295:case 296:case 701:case 702:return{model:"rashnak-backstabber",race:"starplayer"};case 219:case 41:case 703:case 704:return{model:"ripper",race:"starplayer"};case 151:case 244:case 705:case 706:return{model:"roxanna-darknail",race:"starplayer"};case 100:case 226:case 707:case 708:return{model:"scrappa-sorehead",race:"starplayer"};case 104:case 230:case 709:case 710:return{model:"setekh",race:"starplayer"};case 319:case 320:case 711:case 712:return{model:"sinnedbad",race:"starplayer"};case 162:case 254:case 713:case 714:return{model:"skitter-stab-stab",race:"starplayer"};case 220:case 42:case 715:case 716:return{model:"slibli",race:"starplayer"};case 152:case 245:case 717:case 718:return{model:"soaren-hightower",race:"starplayer"};case 163:case 255:case 719:case 720:return{model:"ugroth-bolgrot",race:"starplayer"};case 221:case 43:case 721:case 722:return{model:"varag-ghoul-chewer",race:"starplayer"};case 277:case 278:case 725:case 726:return{model:"wilhelm-chaney",race:"starplayer"};case 279:case 280:case 723:case 724:return{model:"willow-rosebark",race:"starplayer"};case 225:case 727:case 728:case 99:return{model:"zara-the-slayer",race:"starplayer"};case 134:case 234:case 729:case 730:return{model:"zzharg-madeye",race:"starplayer"}}}(e.Id,e.Data.IdPlayerTypes);switch(n.id=e.Id,n.team=t,e.Status){case 1:n.prone=!0;break;case 2:n.stunned=!0}switch(e.disabled&&(e.usedSkills.indexOf(20)>-1?n.disabled="Rooted":e.usedSkills.indexOf(31)>-1?n.disabled="BoneHeaded":e.usedSkills.indexOf(51)>-1&&(n.disabled="Stupid")),e.Situation>=st.Casualty&&(e.Situation===st.Casualty?n.cas=Qt[Math.max(...P9(e.ListCasualties))].icon:n.cas="Expelled"),e.Situation){case st.Active:n.done=1!=e.CanAct,x(e.Cell).player=n;break;default:"home"==t?p.dugout[y[e.Situation]].push(n):m.dugout[y[e.Situation]].push(n)}}L((()=>(console.log("Viewer onMount start"),async function(){for(;;){0===r.length&&await v(u,f,d);const e=r.shift();n(8,c=e.index);for(const t of R9(e.RulesEventBoardAction)){t.ActionType!==pt&&(a=null);for(const e of R9(t.Results.BoardActionResult)){const n=k[t.ActionType||0];try{n(t,e),await J()}catch(e){throw await J(),console.error("Action failed",{error:e,boardAction:t}),e}await O()}}e.RulesEventEndTurn&&E(e.RulesEventEndTurn),e.BoardState&&await b(e.BoardState)}}(),console.log("Viewer onMount queue started"),()=>console.log("destroyed"))));let k=[A,$,$,async function(e,t){if(!t.IsOrderCompleted)return;let n=x(e.Order.CellFrom);if(n.ball.held=!1,await J(),t.ResultType===gt){x(e.Order.CellTo.Cell).ball=n.ball,n.ball=null,await O()}},function(e){let t=x(e.Order.CellFrom);x(e.Order.CellTo.Cell).ball=t.ball,t.ball=null},async function(e){x(e.Order.CellTo.Cell).foul=!0,await O()},function(e,t){if(!t.IsOrderCompleted)return;let r,i;switch(Object.entries(g).forEach((([t,a])=>{a.cell&&(a.cell.target=null),a.player&&a.player.id==e.PlayerId&&(r=a.player,n(3,g[t]=a,g),i=t)})),t.RollType){case 3:1===t.ResultType&&(r.prone=!0);break;case 4:if(2===t.SubResultType)r.stunned=!0;else if(3===t.SubResultType){("home"==r.team?p.dugout:m.dugout).ko.push(r),n(3,g[i].player=null,g)}break;case 8:("home"==r.team?p.dugout:m.dugout).cas.push(r),n(3,g[i].player=null,g),n(3,g[i].blood={blood:Math.floor(4*Math.random()+1)},g)}},function(e){x(e.Order.CellTo.Cell).ball={held:!1}},function(e){x(e.Order.CellFrom).ball=null,x(e.Order.CellTo.Cell).ball={held:!1}},function(e,t){if(!t.IsOrderCompleted)return;if(0!==t.ResultType)return;Object.values(g).forEach((e=>e.ball=null)),x(e.Order.CellTo.Cell).ball={held:!0}},async function(){n(4,s="touchdown"),S(),await O(5),n(4,s=null),await J()},function(e){let t=w(e.PlayerId);t.stunned=!1,t.prone=!0},z9,z9,function(e,t){t.IsOrderCompleted&&t.ResultType===gt&&Object.values(g).forEach((e=>{e.ball&&(e.ball.held=!0)}))},function(e,t){let n=x(e.Order.CellTo.Cell);if(t.ResultType===gt)return void(n.player.stupidity=null);{const e={[Zt.BoneHead]:"BoneHeaded",[Zt.ReallyStupid]:"Stupid",[Zt.TakeRoot]:"Rooted"};n.player.stupidity=e[t.RollType]}},z9,z9,z9,z9,z9,function(e){A(e)},z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,z9,function(e){S(),Object.entries(g).forEach((([t,r])=>{r.cell&&(r.cell.active=!1),r.player&&(r.player.id==e.ActivePlayerId&&(r.cell||(r.cell={}),r.cell.active=!0,r.player.prone=!1),r.player.id==i&&(r.player.done=!0),n(3,g[t]=r,g))})),i=e.PlayerId},z9,z9,z9,z9,function(e,t){const r=P9(t.CoachChoices.ListDices);n(5,l={2:ct,3:ft,11:dt,12:ht}[r[0]+r[1]]||ut)},z9,z9,z9,z9,z9,z9,z9,z9,z9,E];async function O(e){var t;await J(),await(t=300*(e||1),new Promise((e=>setTimeout(e,t))))}function S(){Object.entries(g).forEach((([e,t])=>{t.dice=null,t.cell=null,t.foul=!1,t.player&&(t.player.moving=!1),n(3,g[e]=t,g)}))}async function $(e,t){let n=x(e.Order.CellFrom);(n.cell=n.cell||{}).active=!0;let r=x(e.Order.CellTo.Cell),i=r.player;if(Object.values(g).forEach((e=>{e.dice=null})),t.RollType===Zt.Block){let n=x(e.Order.CellTo.Cell);if(n.cell||(n.cell={}),n.cell.target=!0,t.IsOrderCompleted)n.dice=[P9(t.CoachChoices.ListDices)[0]];else{let e=P9(t.CoachChoices.ListDices);n.dice=e.slice(0,e.length/2)}await O(2)}if(t.RollType===Zt.Push)if(t.IsOrderCompleted){Object.values(g).forEach((e=>{e.cell&&(e.cell.pushbackChoice=!1,e.cell.target=!1)}));let e=x(R9(t.CoachChoices.ListCells.Cell)[0]);a&&(i=a),a=e.player?e.player:null,e.player=i,r.player=null}else R9(t.CoachChoices.ListCells.Cell).forEach((e=>{let t=x(e);if(t.cell=t.cell||{},t.cell.pushbackChoice=!0,e.x<0||e.x>25||e.y<0||e.y>14)throw"Unexpected surf as a choice"}));if(t.RollType===Zt.FollowUp&&t.IsOrderCompleted){const n=x(e.Order.CellFrom);x(R9(t.CoachChoices.ListCells.Cell)[0]).player=n.player;n.player=null}}async function E(e){e.Turnover&&(n(4,s="turnover"),S(),await O(5),n(4,s=null),await J())}function A(e,t){let n=w(e.PlayerId),r=x(e.Order.CellFrom),i=x(e.Order.CellTo.Cell);if(n.prone=!1,n.moving=!0,t.IsOrderCompleted&&i!=r&&(r.player=null,i.player=n),r.cell=r.cell||{},r.cell.moved=!0,r.cell.active=!1,t.IsOrderCompleted&&(i.cell=i.cell||{},i.cell.active=!0),t.RollType&&[Zt.Dodge,Zt.GFI,Zt.Leap].includes(t.RollType)&&(i.cell=i.cell||{},i.cell.plus=t.Requirement),n.id==o&&(n.blitz=!0),r.ball){let e=r.ball;r.ball=null,i.ball=e}}return e.$$set=e=>{"replaySteps"in e&&n(9,u=e.replaySteps),"replayStepIndex"in e&&n(8,c=e.replayStepIndex),"replayStart"in e&&n(6,f=e.replayStart),"replayEnd"in e&&n(7,d=e.replayEnd)},e.$$.update=()=>{704&e.$$.dirty[0]&&(r=[],console.log("About to reset queue",{replayStart:f,replayEnd:d}),n(6,f=f||0),n(7,d=Math.max(d||u.length,f+1)),console.log("Resetting queue",{replayStart:f,replayEnd:d,queue:u.slice(f,d)}))},[h,p,m,g,s,l,f,d,c,u]}class L9 extends Oe{constructor(e){super(),ke(this,e,B9,T9,s,{replaySteps:9,replayStepIndex:8,replayStart:6,replayEnd:7},[-1,-1])}}function I9(e){let t,n;return t=new La({}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function q9(e){let t,n;return t=new Ga({}),{c(){xe(t.$$.fragment)},m(e,r){we(t,e,r),n=!0},i(e){n||(ce(t.$$.fragment,e),n=!0)},o(e){fe(t.$$.fragment,e),n=!1},d(e){_e(t,e)}}}function U9(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,x,_,O,S;function $(t){e[10].call(null,t)}function E(t){e[11].call(null,t)}function D(t){e[12].call(null,t)}r=new Ua({props:{gameDetails:e[0].gameDetails,filename:e[0].fullReplay.filename}});let C={rolls:e[0].rolls,replayStepIndex:e[4]};function M(t){e[13].call(null,t)}void 0!==e[5]&&(C.replayStart=e[5]),void 0!==e[6]&&(C.replayEnd=e[6]),void 0!==e[3]&&(C.selectedRoll=e[3]),s=new G7({props:C}),V.push((()=>be(s,"replayStart",$))),V.push((()=>be(s,"replayEnd",E))),V.push((()=>be(s,"selectedRoll",D)));let j={replaySteps:e[0]&&e[0].fullReplay.ReplayStep,replayStart:e[5],replayEnd:e[6]};return void 0!==e[4]&&(j.replayStepIndex=e[4]),d=new L9({props:j}),V.push((()=>be(d,"replayStepIndex",M))),g=new To({props:{rolls:e[0].rolls,selectedRoll:e[3]}}),O=new Wa({}),{c(){t=w("div"),n=w("div"),xe(r.$$.fragment),i=k(),a=w("div"),o=w("div"),xe(s.$$.fragment),f=k(),xe(d.$$.fragment),p=k(),m=w("div"),xe(g.$$.fragment),x=k(),_=w("div"),xe(O.$$.fragment),A(n,"class","row"),A(o,"class","col-8"),A(m,"class","col-4"),A(a,"class","row"),A(t,"class","container-fluid"),A(t,"role","main"),A(_,"class","container"),A(_,"role","main")},m(e,l){v(e,t,l),y(t,n),we(r,n,null),y(t,i),y(t,a),y(a,o),we(s,o,null),y(o,f),we(d,o,null),y(a,p),y(a,m),we(g,m,null),v(e,x,l),v(e,_,l),we(O,_,null),S=!0},p(e,t){const n={};1&t&&(n.gameDetails=e[0].gameDetails),1&t&&(n.filename=e[0].fullReplay.filename),r.$set(n);const i={};1&t&&(i.rolls=e[0].rolls),16&t&&(i.replayStepIndex=e[4]),!l&&32&t&&(l=!0,i.replayStart=e[5],Q((()=>l=!1))),!u&&64&t&&(u=!0,i.replayEnd=e[6],Q((()=>u=!1))),!c&&8&t&&(c=!0,i.selectedRoll=e[3],Q((()=>c=!1))),s.$set(i);const a={};1&t&&(a.replaySteps=e[0]&&e[0].fullReplay.ReplayStep),32&t&&(a.replayStart=e[5]),64&t&&(a.replayEnd=e[6]),!h&&16&t&&(h=!0,a.replayStepIndex=e[4],Q((()=>h=!1))),d.$set(a);const o={};1&t&&(o.rolls=e[0].rolls),8&t&&(o.selectedRoll=e[3]),g.$set(o)},i(e){S||(ce(r.$$.fragment,e),ce(s.$$.fragment,e),ce(d.$$.fragment,e),ce(g.$$.fragment,e),ce(O.$$.fragment,e),S=!0)},o(e){fe(r.$$.fragment,e),fe(s.$$.fragment,e),fe(d.$$.fragment,e),fe(g.$$.fragment,e),fe(O.$$.fragment,e),S=!1},d(e){e&&b(t),_e(r),_e(s),_e(d),_e(g),e&&b(x),e&&b(_),_e(O)}}}function V9(e){let t,n,r,i,a,o,s,l,u,c,f,d,h,p,m,g,x,_,O,S,$,E,D,C,M,j,F,T,N;g=new K7({}),$=new Y7({}),D=new za({}),D.$on("replayLoaded",e[7]),D.$on("replayLoading",e[8]),D.$on("replayError",e[9]);let R=e[1]&&I9(),P=e[2]&&q9(),z=e[0]&&U9(e);return{c(){t=w("meta"),n=w("meta"),r=w("meta"),i=w("meta"),a=w("meta"),o=w("meta"),s=w("meta"),l=w("meta"),u=w("meta"),c=w("meta"),f=w("meta"),d=w("link"),h=w("link"),p=k(),m=w("body"),xe(g.$$.fragment),x=k(),_=w("div"),O=w("div"),S=w("div"),xe($.$$.fragment),E=k(),xe(D.$$.fragment),C=k(),R&&R.c(),M=k(),P&&P.c(),j=k(),z&&z.c(),F=k(),T=w("footer"),T.innerHTML='<div class="container svelte-n2fmn3"><p class="text-muted svelte-n2fmn3">This website is under active development. If you notice issues, please\n          post the replay and a description of the problem to\n          <a href="https://github.com/cpennington/dicedornot/issues">Diced Or Not Issues</a>.</p></div>',A(t,"charset","utf-8"),A(n,"http-equiv","x-ua-compatible"),A(n,"content","ie=edge"),A(r,"name","viewport"),A(r,"content","width=device-width, initial-scale=1.0"),A(i,"property","og:title"),A(i,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),A(a,"property","og:type"),A(a,"content","website"),A(o,"property","og:url"),A(o,"content","http://vengefulpickle.com/DicedOrNot"),A(s,"property","og:description"),A(s,"content","Blood Bowl 2 replay and luck analyzer. Use it to decide whether you actually got diced."),A(l,"name","twitter:card"),A(l,"content","summary"),A(u,"name","twitter:url"),A(u,"content","http://vengefulpickle.com/DicedOrNot"),A(c,"name","twitter:title"),A(c,"content","Diced or Not? - Blood Bowl 2 Replay Luck Analyzer"),A(f,"name","twitter:description"),A(f,"content","Blood Bowl 2 replay luck analyzer. Use it to decide whether you actually got diced."),document.title="Diced or Not? - Blood Bowl 2 Replay Luck Analyzer",A(d,"rel","stylesheet"),A(d,"href","https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"),A(d,"integrity","sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="),A(d,"crossorigin","anonymous"),A(h,"rel","stylesheet"),A(h,"href","https://cdn.jsdelivr.net/npm/datatables@1.10.18/media/css/jquery.dataTables.min.css"),A(h,"integrity","sha256-YY1izqyhIj4W3iyJOaGWOpXDSwrHWFL4Nfk+W0LyCHE="),A(h,"crossorigin","anonymous"),A(S,"class","jumbotron svelte-n2fmn3"),A(O,"class","container-flex"),A(T,"class","footer svelte-n2fmn3"),A(T,"id","contact"),A(_,"id","content"),A(_,"class","svelte-n2fmn3")},m(e,b){y(document.head,t),y(document.head,n),y(document.head,r),y(document.head,i),y(document.head,a),y(document.head,o),y(document.head,s),y(document.head,l),y(document.head,u),y(document.head,c),y(document.head,f),y(document.head,d),y(document.head,h),v(e,p,b),v(e,m,b),we(g,m,null),y(m,x),y(m,_),y(_,O),y(O,S),we($,S,null),y(S,E),we(D,S,null),y(O,C),R&&R.m(O,null),y(O,M),P&&P.m(O,null),y(_,j),z&&z.m(_,null),y(_,F),y(_,T),N=!0},p(e,[t]){e[1]?R?2&t&&ce(R,1):(R=I9(),R.c(),ce(R,1),R.m(O,M)):R&&(le(),fe(R,1,1,(()=>{R=null})),ue()),e[2]?P?4&t&&ce(P,1):(P=q9(),P.c(),ce(P,1),P.m(O,null)):P&&(le(),fe(P,1,1,(()=>{P=null})),ue()),e[0]?z?(z.p(e,t),1&t&&ce(z,1)):(z=U9(e),z.c(),ce(z,1),z.m(_,F)):z&&(le(),fe(z,1,1,(()=>{z=null})),ue())},i(e){N||(ce(g.$$.fragment,e),ce($.$$.fragment,e),ce(D.$$.fragment,e),ce(R),ce(P),ce(z),N=!0)},o(e){fe(g.$$.fragment,e),fe($.$$.fragment,e),fe(D.$$.fragment,e),fe(R),fe(P),fe(z),N=!1},d(e){b(t),b(n),b(r),b(i),b(a),b(o),b(s),b(l),b(u),b(c),b(f),b(d),b(h),e&&b(p),e&&b(m),_e(g),_e($),_e(D),R&&R.d(),P&&P.d(),z&&z.d()}}}function W9(e,t,n){let r,i,a,o,s=!1,l=!1,u=0;return e.$$.update=()=>{1&e.$$.dirty&&console.log("Replay",r)},[r,s,l,i,u,a,o,e=>{n(1,s=!1),n(0,r=e.detail),n(5,a=null),n(6,o=null),console.log(e)},()=>{n(0,r=null),n(2,l=!1),n(1,s=!0)},()=>{n(1,s=!1),n(2,l=!0),n(0,r=null)},function(e){a=e,n(5,a)},function(e){o=e,n(6,o)},function(e){i=e,n(3,i)},function(e){u=e,n(4,u)}]}return new class extends Oe{constructor(e){super(),ke(this,e,W9,V9,s,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
