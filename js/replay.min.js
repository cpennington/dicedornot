function extractGameDetails(e){var t=e.replay.replaystep[0],a=e.replay.replaystep[e.replay.replaystep.length-1];return{stadiumName:t.gameinfos.namestadium,homeTeam:{coachName:t.gameinfos.coachesinfos.coachinfos[0].userid,teamName:t.boardstate.listteams.teamstate[0].data.name,raceId:t.boardstate.listteams.teamstate[0].data.idrace,score:a.ruleseventgamefinished.matchresult.row.homescore||0},awayTeam:{coachName:t.gameinfos.coachesinfos.coachinfos[1].userid,teamName:t.boardstate.listteams.teamstate[1].data.name,raceId:t.boardstate.listteams.teamstate[1].data.idrace,score:a.ruleseventgamefinished.matchresult.row.awayscore||0}}}function translateStringNumberList(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),a=[],l=0;l<t.length;l++)a.push(parseInt(t[l]));return a}function extractPlayerDetails(e,t){var a=(((e||{}).boardstate||{}).listteams||{}).teamstate;!a||a.length<2||(extractPlayerDetailsFromTeamState(a[0],t),extractPlayerDetailsFromTeamState(a[1],t))}function extractPlayerDetailsFromTeamState(e,t){var a=((e||{}).listpitchplayers||{}).playerstate;if(a)for(var l=0;l<a.length;l++){var r=a[l];r.id in t||(t[r.id]={id:r.id,teamId:r.data.teamid||0,type:r.data.idplayertypes,name:r.data.name})}}function extractActionsFromStep(e,t){var a=extractKickoffDetails(e);a&&t.push(a);var l=e.ruleseventboardaction;if(l&&l.length)for(var r=0;r<l.length;r++){processAction(e,l[r],t)}else l&&processAction(e,l,t)}function processAction(e,t,a){if(t){var l=t.results.boardactionresult;if(l&&l.length)for(var r=0;r<l.length;r++){processResult(e,t,l[r],a)}else processResult(e,t,l,a)}}function processResult(e,t,a,l){if(a&&a.coachchoices&&a.coachchoices.listdices){var r=extractActionDetails(e,t,a);r&&l.push(r)}}function extractActionDetails(e,t,a){if(ignoreResult(a))return null;console.log(t);var l=translateDice(a.coachchoices.listdices,a.rolltype);return 10==a.rolltype&&l.length>1&&(a.rolltype=-2),{team:e.boardstate.activeteam||0,turn:e.boardstate.listteams.teamstate[e.boardstate.activeteam||0].gameturn||0,player:t.playerid,rollType:a.rolltype,dice:l,outcomeValue:outcomeValue(a.rolltype,l,t.playerid,t.targetid),expectedValue:expectedValue(a.rolltype,l,t.playerid,t.targetid)}}function expectedValue(e,t,a,l){return e==ROLL_BLOCK?(1==t.length?values=BLOCK.values.map(blockResultValue):values=TWO_DIE_BLOCK.values.map(e=>Math.max(blockResultValue(e[0]),blockResultValue(e[1]))),values.reduce((e,t)=>e+t,0)/values.length):0}function outcomeValue(e,t,a,l){return e==ROLL_BLOCK?1==t.length?blockResultValue(asBlockDie(t)):Math.max(...t.map(asBlockDie).map(blockResultValue)):0}function ignoreResult(e){return 2==e.rollstatus||(15==e.rolltype||(61==e.rolltype||(63==e.rolltype||(5==e.rolltype&&2!=e.resulttype||8==e.rolltype&&2!=e.resulttype&&1!=e.subresulttype&&12!=e.subresulttype))))}function translateDice(e,t){var a=translateStringNumberList(e);return 5==t?a=a.slice(0,a.length/2):8==t&&(a=[(a=a.slice(0,a.length/2))[a.length-1]]),a}function extractKickoffDetails(e){return e.ruleseventkickofftable?{team:e.boardstate.activeteam||0,turn:e.boardstate.listteams.teamstate[e.boardstate.activeteam||0].gameturn||0,player:null,rollType:-1,dice:translateDice(e.ruleseventkickofftable.listdice,-1)}:null}replay={processReplay:function(e){for(var t=extractGameDetails(e),a={},l=[],r=0;r<e.replay.replaystep.length;r++){var s=e.replay.replaystep[r];extractPlayerDetails(s,a),l=l.concat(Roll.fromReplayStep(r,s))}return{gameDetails:t,playerDetails:a,rolls:l,version:1}}};