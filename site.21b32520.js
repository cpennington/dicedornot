!function(){var e,a=parcelRequire("6ae74b041207656216232b2198e327ca"),t=parcelRequire("8016873058de1762abb55249d07ce983"),r={},o=t();Object.defineProperty(r,"__esModule",{value:!0}),e=void 0,r.replay=e,e={processReplay:function(e){var a=function(e){var a=e.replay.replaystep[0],t=e.replay.replaystep[e.replay.replaystep.length-1];return{stadiumName:a.gameinfos.namestadium,homeTeam:{coachName:a.gameinfos.coachesinfos.coachinfos[0].userid,teamName:a.boardstate.listteams.teamstate[0].data.name,raceId:a.boardstate.listteams.teamstate[0].data.idrace,score:t.ruleseventgamefinished.matchresult.row.homescore||0},awayTeam:{coachName:a.gameinfos.coachesinfos.coachinfos[1].userid,teamName:a.boardstate.listteams.teamstate[1].data.name,raceId:a.boardstate.listteams.teamstate[1].data.idrace,score:t.ruleseventgamefinished.matchresult.row.awayscore||0}}}(e);console.log("Extracted game details...",a);for(var t,r=[],l=0;l<e.replay.replaystep.length;l++)t=e.replay.replaystep[l],r=r.concat(o.Roll.fromReplayStep(l,t));return console.log("Extracted rolls...",r),{gameDetails:a,playerDetails:{},rolls:r,version:1}}},r.replay=e;t();var l=a();function n(e){return function(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback((function(){$("#file-input-button").removeClass("disabled")}));var i=document.getElementById("file-input");i.addEventListener("change",(function(){0<i.files.length&&($("#loading").show(),$("#data-param-error").hide(),$("#summary-div").hide(),$("#results-div").hide(),$("#explanation-div").hide(),console.log("Preparing to parse XML..."),l.io.xmlToJson(i.files[0],(function(e){console.log("Preparing to process replay json...");var a=r.replay.processReplay(e);console.log("Preparing to render replay data..."),s(a,"")}),(function(e){$("#loading").hide(),alert(e)})))}));var c=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1])}("data");function s(e,a){var t="http://dicedornot.vengefulpickle.com/index.html?data="+a,r=encodeURIComponent(t);console.log("Rendering replay data..."),function(e){console.log(e);var a=n(new Set(e.map((function(e){return e.team}))));console.log(a);var t=[];t=t.concat(e.map((function(e){return e.actual}))),vegaEmbed("#chart",{$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:300,data:{name:"rolls",values:t},transform:[{calculate:"datum.outcomeValue - datum.expectedValue",as:"netValue"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["team","iteration"]}],layer:[{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["team","index"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"value",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"prob",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"iteration",type:"nominal"}}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"point"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"player",title:"Player"},{field:"playerSkills",title:"Player Skill"},{field:"rollName",title:"Roll"},{field:"dice",title:"Dice"},{field:"target",title:"Target"},{field:"outcomeValue",title:"Value",format:".2f"},{field:"expectedValue",title:"Expected Value",format:".2f"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}]}}]}).then((function(a){var t=0;!function r(){for(var o=[],l=Math.max(t,1),n=0;n<l;n++)t++,o=o.concat(e.map((function(e){return e.simulated(t)})));var i=vega.changeset().insert(o);a.view.change("rolls",i).run(),$("#game-count").text(t),console.log(t,o.length),64>=t&&window.setTimeout(r,100)}()}))}(e.rolls),function(e){$("#file-name").text(e.fileName),$("#home-coach").text(e.homeTeam.coachName),$("#home-team").text(e.homeTeam.teamName),$("#home-race").text(m(e.homeTeam.raceId)),$("#home-score").text(e.homeTeam.score),$("#away-coach").text(e.awayTeam.coachName),$("#away-team").text(e.awayTeam.teamName),$("#away-race").text(m(e.awayTeam.raceId)),$("#away-score").text(e.awayTeam.score),$("#stadium-name").text(e.stadiumName)}(e.gameDetails),$("#loading").hide(),$("#summary-div").show(),$("#results-div").show(),$("#explanation-div").show(),$("#share-massive-url").attr("href",t),$("#share-tiny-url").attr("href","http://tinyurl.com/create.php?url="+r+"#success"),$("#share-alert").show(),$(".other-stats").remove(),document.getElementById("results-with-padding").scrollIntoView()}function m(e){switch(e){case 1:return"Human";case 2:return"Dwarf";case 3:return"Skaven";case 4:return"Orc";case 5:return"Lizardman";case 6:return"Goblin";case 7:return"Wood Elf";case 8:return"Chaos";case 9:return"Dark Elf";case 10:return"Undead";case 14:return"Pro Elf";case 15:return"High Elf";case 17:return"Necromantic";case 21:return"Chaos Dwarf";case 22:return"Underworld";case 24:return"Bretonnian";case 25:return"Kislev";case 33:return"Chaos Pa";case 35:default:return e}}c&&($("#loading").show(),$("#data-param-error").hide(),google.setOnLoadCallback((function(){try{var e=LZString.decompressFromEncodedURIComponent(c);s(JSONC.decompress(JSON.parse(e)),c)}catch(e){$("#loading").hide(),$("#data-param-error").show(),console.error(e)}})))}();
//# sourceMappingURL=site.21b32520.js.map
