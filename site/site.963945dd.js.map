{"mappings":"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","sources":["./src/js/site.js"],"sourcesContent":["/* Minifier: http://jscompress.com/ */\n\ngoogle.load(\"visualization\", \"1.0\", { packages: [\"corechart\"] });\ngoogle.setOnLoadCallback(enableFileInput);\n\nfunction enableFileInput() {\n  $(\"#file-input-button\").removeClass(\"disabled\");\n  renderValueTable();\n}\n\nvar fileInput = document.getElementById(\"file-input\");\nfileInput.addEventListener(\"change\", function() {\n  if (fileInput.files.length > 0) {\n    $(\"#loading\").show();\n    $(\"#data-param-error\").hide();\n    $(\"#summary-div\").hide();\n    $(\"#results-div\").hide();\n    $(\"#explanation-div\").hide();\n    console.log(\"Preparing to parse XML...\");\n\n    io.xmlToJson(\n      fileInput.files[0],\n      function(jsonObj) {\n        console.log(\"Preparing to process replay json...\");\n        var replayData = replay.processReplay(jsonObj);\n\n        // var jsoncCompressedJson = JSONC.compress(replayData);\n        // var jsoncCompressedString = JSON.stringify(jsoncCompressedJson);\n        // var lzstringCompressed = LZString.compressToEncodedURIComponent(\n        // jsoncCompressedString\n        // );\n        console.log(\"Preparing to render replay data...\");\n        renderReplayData(replayData, \"\");\n      },\n      function(err) {\n        $(\"#loading\").hide();\n        alert(err);\n      }\n    );\n  }\n});\n\nfunction getParameterByName(name) {\n  name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n  var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\n    results = regex.exec(location.search);\n  return results === null ? \"\" : decodeURIComponent(results[1]);\n}\n\nvar dataParam = getParameterByName(\"data\");\nif (dataParam) {\n  $(\"#loading\").show();\n  $(\"#data-param-error\").hide();\n  google.setOnLoadCallback(renderDataParam);\n}\n\nfunction renderDataParam() {\n  try {\n    var decompressedString = LZString.decompressFromEncodedURIComponent(\n      dataParam\n    );\n    var replayData = JSONC.decompress(JSON.parse(decompressedString));\n    renderReplayData(replayData, dataParam);\n  } catch (err) {\n    $(\"#loading\").hide();\n    $(\"#data-param-error\").show();\n    console.error(err);\n  }\n}\n\nfunction renderReplayData(replayData, dataParam) {\n  //var baseUrl = \"http://localhost:8080\";\n  var baseUrl = \"http://dicedornot.vengefulpickle.com\";\n  var resultsPage = \"/index.html\";\n  var resultsUrl = baseUrl + resultsPage + \"?data=\" + dataParam;\n  var encodedResultsUrl = encodeURIComponent(resultsUrl);\n  var tinyUrlCreator =\n    \"http://tinyurl.com/create.php?url=\" + encodedResultsUrl + \"#success\";\n\n  console.log(\"Rendering replay data...\");\n  updateChart(replayData.rolls);\n\n  updateGameDetails(replayData.gameDetails);\n\n  $(\"#loading\").hide();\n  $(\"#summary-div\").show();\n  $(\"#results-div\").show();\n  $(\"#explanation-div\").show();\n\n  $(\"#share-massive-url\").attr(\"href\", resultsUrl);\n  $(\"#share-tiny-url\").attr(\"href\", tinyUrlCreator);\n  $(\"#share-alert\").show();\n\n  //console.log(\"Deleting other stats \" + $(\".other-stats\").length);\n  $(\".other-stats\").remove();\n\n  // drawCharts(gameStats, replayData.gameDetails);\n\n  document.getElementById(\"results-with-padding\").scrollIntoView();\n}\n\nfunction updateChart(rolls) {\n  console.log(rolls);\n  var teams = [...new Set(rolls.map(roll => roll.team))];\n  console.log(teams);\n  var values = [];\n  // for (const team of teams) {\n  //   values.push({ expectedValue: 0, outcomeValue: 0, team: team, index: 0 });\n  // }\n  values = values.concat(rolls.map(roll => roll.actual));\n  // Assign the specification to a local variable vlSpec.\n  // TODO: put details of the action into the popup\n  var vlSpec = {\n    $schema: \"https://vega.github.io/schema/vega-lite/v4.json\",\n    width: 1000,\n    height: 300,\n    data: {\n      name: \"rolls\",\n      values: values\n    },\n    transform: [\n      { calculate: \"datum.outcomeValue - datum.expectedValue\", as: \"netValue\" },\n      {\n        window: [{ op: \"sum\", field: \"netValue\", as: \"cumNetValue\" }],\n        groupby: [\"team\", \"iteration\"]\n      }\n    ],\n    // facet: { rows: \"team\" },\n    // spec: {\n    layer: [\n      {\n        transform: [\n          {\n            quantile: \"cumNetValue\",\n            probs: [0.01, 0.1, 0.25, 0.5, 0.75, 0.9, 0.99],\n            groupby: [\"team\", \"index\"]\n          },\n          {\n            calculate: \"datum.prob * 100\",\n            as: \"perc\"\n          }\n        ],\n        mark: {\n          type: \"line\",\n          opacity: 0.3,\n          interpolate: \"basis\"\n        },\n        encoding: {\n          x: {\n            type: \"ordinal\",\n            field: \"index\"\n          },\n          y: {\n            field: \"value\",\n            type: \"quantitative\"\n          },\n          color: {\n            field: \"team\",\n            type: \"nominal\"\n          },\n          detail: {\n            field: \"prob\",\n            type: \"nominal\"\n          },\n          tooltip: [\n            { field: \"team\", title: \"Team\" },\n            { field: \"value\", title: \"Cumulative Net Value\", format: \".2f\" },\n            { field: \"perc\", title: \"Percentile\", format: \".0f\" }\n          ]\n        }\n      },\n      {\n        transform: [\n          {\n            filter: \"datum.type == 'actual'\"\n          }\n        ],\n        mark: { type: \"line\", interpolate: \"monotone\" },\n        encoding: {\n          x: {\n            type: \"ordinal\",\n            field: \"index\"\n          },\n          y: {\n            field: \"cumNetValue\",\n            type: \"quantitative\"\n          },\n          color: {\n            field: \"team\",\n            type: \"nominal\"\n          },\n          detail: {\n            field: \"iteration\",\n            type: \"nominal\"\n          }\n        }\n      },\n      {\n        transform: [\n          {\n            filter: \"datum.type == 'actual'\"\n          }\n        ],\n        mark: { type: \"point\" },\n        encoding: {\n          x: {\n            type: \"ordinal\",\n            field: \"index\"\n          },\n          y: {\n            field: \"cumNetValue\",\n            type: \"quantitative\"\n          },\n          color: {\n            field: \"team\",\n            type: \"nominal\"\n          },\n          tooltip: [\n            { field: \"team\", title: \"Team\" },\n            { field: \"player\", title: \"Player\" },\n            { field: \"playerSkills\", title: \"Player Skill\" },\n            { field: \"rollName\", title: \"Roll\" },\n            { field: \"dice\", title: \"Dice\" },\n            { field: \"target\", title: \"Target\" },\n            { field: \"outcomeValue\", title: \"Value\", format: \".2f\" },\n            { field: \"expectedValue\", title: \"Expected Value\", format: \".2f\" },\n            { field: \"netValue\", title: \"Net Value\", format: \".2f\" },\n            {\n              field: \"cumNetValue\",\n              title: \"Cumulative Net Value\",\n              format: \".2f\"\n            }\n          ]\n        }\n      }\n    ]\n    // }\n  };\n\n  // Embed the visualization in the container with id `vis`\n  vegaEmbed(\"#chart\", vlSpec).then(res => {\n    var iteration = 0;\n    function addValues() {\n      var values = [];\n      var curIteration = Math.max(iteration, 1);\n      for (var x = 0; x < curIteration; x++) {\n        iteration++;\n        values = values.concat(rolls.map(roll => roll.simulated(iteration)));\n      }\n      var changeSet = vega.changeset().insert(values);\n      res.view.change(\"rolls\", changeSet).run();\n      $(\"#game-count\").text(iteration);\n      if (iteration < 1000) {\n        window.setTimeout(addValues, 100);\n      }\n    }\n    addValues();\n  });\n}\n\nfunction renderValueTable() {\n  var rollValues = Object.values(ROLL_TYPES)\n    .filter(c => !!c)\n    .map(c => c.valueTable())\n    .flatMap(Object.entries);\n\n  for (var [roll, value] of rollValues) {\n    $(\"#value-table tbody\").append(\n      `<tr scope=\"row\"><td>${roll}</td><td>${value}</td></tr>`\n    );\n  }\n  $(\"#value-table\")\n    .show()\n    .DataTable();\n}\n\nfunction raceIdToName(raceId) {\n  switch (raceId) {\n    case 1:\n      return \"Human\";\n    case 2:\n      return \"Dwarf\";\n    case 3:\n      return \"Skaven\";\n    case 4:\n      return \"Orc\";\n    case 5:\n      return \"Lizardman\";\n    case 6:\n      return \"Goblin\";\n    case 7:\n      return \"Wood Elf\";\n    case 8:\n      return \"Chaos\";\n    case 9:\n      return \"Dark Elf\";\n    case 10:\n      return \"Undead\";\n    case 14:\n      return \"Pro Elf\";\n    case 15:\n      return \"High Elf\";\n    case 17:\n      return \"Necromantic\";\n    case 21:\n      return \"Chaos Dwarf\";\n    case 22:\n      return \"Underworld\";\n    case 24:\n      return \"Bretonnian\";\n    case 25:\n      return \"Kislev\";\n    default:\n      return raceId;\n  }\n}\n\nfunction updateGameDetails(gameDetails) {\n  $(\"#file-name\").text(gameDetails.fileName);\n\n  $(\"#home-coach\").text(gameDetails.homeTeam.coachName);\n  $(\"#home-team\").text(gameDetails.homeTeam.teamName);\n  $(\"#home-race\").text(raceIdToName(gameDetails.homeTeam.raceId));\n  $(\"#home-score\").text(gameDetails.homeTeam.score);\n\n  $(\"#away-coach\").text(gameDetails.awayTeam.coachName);\n  $(\"#away-team\").text(gameDetails.awayTeam.teamName);\n  $(\"#away-race\").text(raceIdToName(gameDetails.awayTeam.raceId));\n  $(\"#away-score\").text(gameDetails.awayTeam.score);\n\n  $(\"#stadium-name\").text(gameDetails.stadiumName);\n}\n"],"names":["google","load","packages","setOnLoadCallback","$","removeClass","rollValues","Object","values","ROLL_TYPES","filter","c","map","valueTable","flatMap","entries","b","d","e","f","Symbol","iterator","next","done","g","$bd9ae5e99ecff46d330698ba8f180cc8$var$_slicedToArray","value","roll","append","concat","a","show","DataTable","renderValueTable","fileInput","document","getElementById","addEventListener","files","length","hide","console","log","io","xmlToJson","jsonObj","replayData","replay","processReplay","renderReplayData","err","alert","dataParam","name","replace","results","RegExp","exec","location","search","decodeURIComponent","getParameterByName","resultsUrl","encodedResultsUrl","encodeURIComponent","rolls","teams","$bd9ae5e99ecff46d330698ba8f180cc8$var$_toConsumableArray","Set","team","actual","vegaEmbed","$schema","width","height","data","transform","calculate","as","window","op","field","groupby","layer","quantile","probs","mark","type","opacity","interpolate","encoding","x","y","color","detail","tooltip","title","format","then","res","iteration","addValues","curIteration","Math","max","simulated","changeSet","vega","changeset","insert","view","change","run","text","setTimeout","updateChart","gameDetails","fileName","homeTeam","coachName","teamName","raceIdToName","raceId","score","awayTeam","stadiumName","updateGameDetails","attr","remove","scrollIntoView","decompressedString","LZString","decompressFromEncodedURIComponent","JSONC","decompress","JSON","parse","error"],"version":3,"file":"site.963945dd.js.map"}