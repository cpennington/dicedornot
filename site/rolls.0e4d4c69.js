!function(){var e=parcelRequire("9cbb4a330c64e4cea889ac71cb243027"),t=parcelRequire("b2a415d528d493b93245af0c39ac2ea6"),r={},n={},a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};null==a.parcelRequire&&(a.parcelRequire=function(e){if(e in n&&(n[e](),delete n[e]),e in r)return r[e];if("undefined"!=typeof module&&"function"==typeof module.require)return module.require(e);var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t},a.parcelRequire.register=function(e,t){r[e]=t},a.parcelRequire.registerBundle=function(e,t){n[e]=t,r[e]={}});var i,l,u={};Object.defineProperty(u,"__esModule",{value:!0}),l=void 0,i=u.Roll=l,u.ROLL_TYPES=i;var o=t(),s=e();function c(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],0<=t.indexOf(r)||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],!(0<=t.indexOf(r))&&Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e){return function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function p(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e,t,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(r):a.value}})(e,t,r||e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function k(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),e}function N(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e){return e[Math.floor(Math.random()*e.length)]}new WeakMap,new WeakMap;var D=function(){function e(t){b(this,e),Object.assign(this,t)}return k(e,[{key:"value",value:function(){throw"value must be defined by subclass"}},{key:"simulateDice",value:function(){throw"simulateDice must be defined by subclass"}},{key:"simulated",value:function(e){return this.dataPoint(e,this.simulateDice(),"simulated")}},{key:"dataPoint",value:function(e,t,r){return{iteration:e,index:this.stepIndex.toString().padStart(3,"0")+"."+this.actionIndex+"."+this.resultIndex,team:this.playerTeam?this.playerTeamId+". "+this.playerTeam:this.activeTeamId+". "+this.activeTeam,outcomeValue:this.value(t),type:r,expectedValue:this.expectedValue}}},{key:"expectedValue",get:function(){throw"expectedValue must be defined by subclass"}},{key:"actual",get:function(){return Object.assign(this.dataPoint(0,this.dice,"actual"),{turn:this.turn,player:this.playerName,playerSkills:this.playerSkills.map((function(e){return s.skillNames[e]})),rollName:this.constructor.rollName||this.rollName||this.rollType,dice:this.dice})}}],[{key:"argsFromXML",value:function(e,t,r,n,a,i){var l=this.currentPlayerData(t,n);return{replaystep:t,action:n,boardactionresult:i,stepIndex:e,actionIndex:r,resultIndex:a,team:this.activeTeamName(t),teamId:this.activeTeamId(t),turn:this.currentTurn(t),playerName:l.player.data.name,playerTeam:l.team.data.name,playerTeamId:l.teamId,playerSkills:this.translateStringNumberList(l.player.data.listskills),rollType:this.rollType(i),dice:this.dice(i)}}},{key:"valueTable",value:function(){throw"valueTable must be defined by subclass"}},{key:"ignore",value:function(){return!1}},{key:"dice",value:function(e){return this.translateStringNumberList(e.coachchoices.listdices)}},{key:"teamName",value:function(e,t){return e.boardstate.listteams.teamstate[t].data.name}},{key:"activeTeamName",value:function(e){return this.teamName(e,this.activeTeamId(e))}},{key:"activeTeamId",value:function(e){return e.boardstate.activeteam||0}},{key:"currentTurn",value:function(e){return e.boardstate.listteams.teamstate[this.activeTeamId(e)].gameturn||0}},{key:"currentPlayerData",value:function(e,t){for(var r=this.currentPlayer(t),n=e.boardstate.listteams.teamstate,a=0;a<n.length;a++){var i=n[a],l=!0,u=!1,o=void 0;try{for(var s,c,f=i.listpitchplayers.playerstate[Symbol.iterator]();!(l=(s=f.next()).done);l=!0)if((c=s.value).id===r)return{team:i,teamId:a,player:c,playerId:c.id}}catch(e){u=!0,o=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw o}}}console.log("No player found",{replaystep:e,action:t})}},{key:"currentPlayer",value:function(e){return e.playerid}},{key:"rollType",value:function(e){return e.rolltype}},{key:"translateStringNumberList",value:function(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),r=[],n=0;n<t.length;n++)r.push(parseInt(t[n]));return r}},{key:"fromReplayStep",value:function(t,r){var n=r.ruleseventboardaction;if(n&&n.length){for(var a,i=[],l=0;l<n.length;l++)a=n[l],i=i.concat(e.fromAction(t,r,l,a));return i}return n?e.fromAction(t,r,0,n):[]}},{key:"fromAction",value:function(e,t,r,n){var a=n.results.boardactionresult;if(a&&a.length){for(var i=[],l=0;l<a.length;l++){var u,o=a[l];(u=this.fromBoardActionResult(e,t,r,n,l,o))&&i.push(u)}return i}return a?(u=this.fromBoardActionResult(e,t,r,n,0,a))?[u]:[]:(console.warn("Unexpectedly missing boardactionresult",{stepIndex:e,replaystep:t,action:n}),[])}},{key:"fromBoardActionResult",value:function(e,t,r,n,a,i){if(void 0===i.rolltype)return null;if(void 0===i.coachchoices.listdices)return null;var l=L[i.rolltype];return null===l?null:l?l.ignore(t,n,i)?null:new l(l.argsFromXML(e,t,r,n,a,i)):(console.warn("Unknown roll "+i.rolltype,{stepIndex:e,replaystep:t,actionIndex:r,action:n,resultIndex:a,boardactionresult:i}),null)}}]),e}();l=D,u.Roll=l;var V=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),k(t,[{key:"value",value:function(e){var r=this.playerSkills;return Math.max.apply(Math,h(e.map((function(e){return t.dieValue(e,r)}))))}},{key:"simulateDice",value:function(){return this.dice.map((function(){return O([o.ATTACKER_DOWN,o.BOTH_DOWN,o.PUSH,o.PUSH,o.DEFENDER_STUMBLES,o.DEFENDER_DOWN])}))}},{key:"expectedValue",get:function(){var e,t=this;return(e=1==this.dice.length?o.BLOCK.values.map((function(e){return t.value([e])})):o.TWO_DIE_BLOCK.values.map((function(e){return t.value(e)}))).reduce((function(e,t){return e+t}),0)/e.length}}],[{key:"dice",value:function(e){var r=y(d(t),"dice",this).call(this,e);return r.slice(0,r.length/2).map(t.asBlockDie)}},{key:"ignore",value:function(e,t,r){return 2!=r.resulttype||35==r.subresulttype}},{key:"asBlockDie",value:function(e){return 0===e?o.ATTACKER_DOWN:1===e?o.BOTH_DOWN:2===e?o.PUSH:3===e?o.DEFENDER_STUMBLES:4===e?o.DEFENDER_DOWN:void 0}},{key:"dieValue",value:function(e,t,r){t=t||[],r=r||[];return e===o.ATTACKER_DOWN?-1:e===o.BOTH_DOWN?t.includes(s.skills.Block)?r.includes(s.skills.Block)?0:.75:t.includes(s.skills.Wrestle)?.5:-1:e===o.PUSH?.25:e===o.DEFENDER_STUMBLES?r.includes(s.skills.Dodge)?0:1:e===o.DEFENDER_DOWN?1:void 0}},{key:"valueTable",value:function(){var e;return N(e={},"".concat(this.rollName," - Attacker Down"),this.dieValue(o.ATTACKER_DOWN)),N(e,"".concat(this.rollName," - Both Down"),this.dieValue(o.BOTH_DOWN)),N(e,"".concat(this.rollName," - Both Down (Block vs None)"),this.dieValue(o.BOTH_DOWN,[s.skills.Block])),N(e,"".concat(this.rollName," - Both Down (Wrestle vs Anything)"),this.dieValue(o.BOTH_DOWN,[s.skills.Wrestle])),N(e,"".concat(this.rollName," - Both Down (Block vs Block)"),this.dieValue(o.BOTH_DOWN,[s.skills.Block],[s.skills.Block])),N(e,"".concat(this.rollName," - Both Down (None vs Block)"),this.dieValue(o.BOTH_DOWN,[],[s.skills.Block])),N(e,"".concat(this.rollName," - Push"),this.dieValue(o.PUSH)),N(e,"".concat(this.rollName," - Defender Stumbles"),this.dieValue(o.DEFENDER_STUMBLES)),N(e,"".concat(this.rollName," - Defender Down"),this.dieValue(o.DEFENDER_DOWN)),e}}]),t}(D);N(V,"rollName","Block");var T=function(e){function t(e){var r,n=e.target,a=e.modifier,i=c(e,["target","modifier"]);return b(this,t),(r=p(this,d(t).call(this,i))).target=n,r.modifier=a,r}return m(t,e),k(t,[{key:"value",value:function(e){return e.reduce((function(e,t){return e+t}),0)>=this.modifiedTarget?this.constructor.passValue:this.constructor.failValue}},{key:"simulateDice",value:function(){return this.dice.map((function(){return O([1,2,3,4,5,6])}))}},{key:"actual",get:function(){return Object.assign(y(d(t.prototype),"actual",this),{target:this.modifiedTarget})}},{key:"modifiedTarget",get:function(){return 1==this.dice.length?Math.min(6,Math.max(2,this.target-this.modifier)):this.target-this.modifier}},{key:"expectedValue",get:function(){for(var e,t=[0],r=0;r<this.dice.length;r++){e=[];for(var n=1;6>=n;n++){var a=!0,i=!1,l=void 0;try{for(var u,o,s=t[Symbol.iterator]();!(a=(u=s.next()).done);a=!0)o=u.value,e.push(o+n)}catch(e){i=!0,l=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw l}}}t=e}for(var c=t.length,f=0,h=0,p=t;h<p.length;h++)f+=p[h]>=this.modifiedTarget?this.constructor.passValue/c:this.constructor.failValue/c;return f}}],[{key:"argsFromXML",value:function(e,r,n,a,i,l){var u=y(d(t),"argsFromXML",this).call(this,e,r,n,a,i,l);return u.modifier=function(e){return e&&e.length?e:[e]}(l.listmodifiers.dicemodifier||[]).map((function(e){return e.value})).reduce((function(e,t){return e+t}),0)||0,u.target=l.requirement,u}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Pass")]=this.passValue,e["".concat(this.rollName," - Fail")]=this.failValue,e}}]),t}(D),E=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(E,"rollName","Pickup"),N(E,"passValue",1),N(E,"failValue",-1);var S=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),k(t,null,[{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Break")]=this.passValue,e["".concat(this.rollName," - Save")]=this.failValue,e}}]),t}(T);N(S,"rollName","Armor"),N(S,"passValue",-1),N(S,"failValue",0);var w=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(w,"rollName","Wild Animal"),N(w,"passValue",0),N(w,"failValue",-1);var B=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(B,"rollName","Dauntless"),N(B,"passValue",1),N(B,"failValue",0);var _=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(_,"rollName","Dodge"),N(_,"passValue",1),N(_,"failValue",-1);var R=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(R,"rollName","Jump Up"),N(R,"passValue",1),N(R,"failValue",0);var P=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(P,"rollName","Pass"),N(P,"passValue",1),N(P,"failValue",-1);var x=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(x,"rollName","Interception"),N(x,"passValue",1),N(x,"failValue",0);var I=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(I,"rollName","Wake Up"),N(I,"passValue",1),N(I,"failValue",-1);var j=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(j,"rollName","GFI"),N(j,"passValue",0),N(j,"failValue",-1);var W=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),t}(T);N(W,"rollName","Catch"),N(W,"passValue",1),N(W,"failValue",-1);var A=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),k(t,[{key:"value",value:function(e){var t=e[0]+e[1];return this.constructor.injuryValue(t)}},{key:"simulateDice",value:function(){return this.dice.map((function(){return O([1,2,3,4,5,6])}))}},{key:"expectedValue",get:function(){for(var e=0,t=1;6>=t;t++)for(var r=1;6>=r;r++)e+=this.value([t,r]);return e/36}}],[{key:"injuryValue",value:function(e){return 7>=e?0:9>=e?-.5:-1}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Stun")]=this.injuryValue(7),e["".concat(this.rollName," - KO")]=this.injuryValue(9),e["".concat(this.rollName," - Casualty")]=this.injuryValue(12),e}}]),t}(D);N(A,"rollName","Injury");var M=function(e){function t(){return b(this,t),p(this,d(t).apply(this,arguments))}return m(t,e),k(t,[{key:"value",value:function(e){return this.constructor.casValue(e)}},{key:"simulateDice",value:function(){return 10*O([1,2,3,4,5,6])+O([1,2,3,4,5,6,7,8])}},{key:"expectedValue",get:function(){for(var e=0,t=1;6>=t;t++)for(var r=1;8>=r;r++)e+=this.value(10*t+r);return e/48}}],[{key:"dice",value:function(e){var r=y(d(t),"dice",this).call(this,e);return[(r=r.slice(0,r.length/2))[r.length-1]]}},{key:"casValue",value:function(e){return 4>e?0:50>e?-.5:60>e?-.75:-1}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Badly Hurt")]=this.casValue(35),e["".concat(this.rollName," - Miss Next game")]=this.casValue(45),e["".concat(this.rollName," - Stat Damage")]=this.casValue(55),e["".concat(this.rollName," - Dead")]=this.casValue(65),e}}]),t}(D);N(M,"rollName","Casualty");var L={1:j,2:_,3:S,4:A,5:V,7:E,8:M,9:W,10:null,11:null,12:P,13:null,14:null,16:x,17:I,22:w,26:null,29:B,31:R,58:null,59:S,60:A,63:null,70:null};i=L,u.ROLL_TYPES=i,parcelRequire.register("8016873058de1762abb55249d07ce983",(function(){return u}))}();
//# sourceMappingURL=rolls.0e4d4c69.js.map
