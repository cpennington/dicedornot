!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var a=[],r=!0,o=!1,n=void 0;try{for(var l,i=e[Symbol.iterator]();!(r=(l=i.next()).done)&&(a.push(l.value),!t||a.length!==t);r=!0);}catch(e){o=!0,n=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw n}}return a}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function t(e){return function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback((function(){$("#file-input-button").removeClass("disabled"),function(){var t=Object.values(ROLL_TYPES).filter((function(e){return!!e})).map((function(e){return e.valueTable()})).flatMap(Object.entries),a=!0,r=!1,o=void 0;try{for(var n,l=t[Symbol.iterator]();!(a=(n=l.next()).done);a=!0){var i=e(n.value,2),c=i[0],u=i[1];$("#value-table tbody").append('<tr scope="row"><td>'.concat(c,"</td><td>").concat(u,"</td></tr>"))}}catch(t){r=!0,o=t}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}$("#value-table").show().DataTable()}()}));var a=document.getElementById("file-input");a.addEventListener("change",(function(){0<a.files.length&&($("#loading").show(),$("#data-param-error").hide(),$("#summary-div").hide(),$("#results-div").hide(),$("#explanation-div").hide(),console.log("Preparing to parse XML..."),io.xmlToJson(a.files[0],(function(e){console.log("Preparing to process replay json...");var t=replay.processReplay(e);console.log("Preparing to render replay data..."),o(t,"")}),(function(e){$("#loading").hide(),alert(e)})))}));var r=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1])}("data");function o(e,a){var r="http://dicedornot.vengefulpickle.com/index.html?data="+a,o=encodeURIComponent(r);console.log("Rendering replay data..."),function(e){console.log(e);var a=t(new Set(e.map((function(e){return e.team}))));console.log(a);var r=[];r=r.concat(e.map((function(e){return e.actual}))),vegaEmbed("#chart",{$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:300,data:{name:"rolls",values:r},transform:[{calculate:"datum.outcomeValue - datum.expectedValue",as:"netValue"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["team","iteration"]}],layer:[{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["team","index"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"value",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"prob",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"iteration",type:"nominal"}}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"point"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"player",title:"Player"},{field:"playerSkills",title:"Player Skill"},{field:"rollName",title:"Roll"},{field:"dice",title:"Dice"},{field:"target",title:"Target"},{field:"outcomeValue",title:"Value",format:".2f"},{field:"expectedValue",title:"Expected Value",format:".2f"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}]}}]}).then((function(t){var a=0;!function r(){for(var o=[],n=Math.max(a,1),l=0;l<n;l++)a++,o=o.concat(e.map((function(e){return e.simulated(a)})));var i=vega.changeset().insert(o);t.view.change("rolls",i).run(),$("#game-count").text(a),1e3>a&&window.setTimeout(r,100)}()}))}(e.rolls),function(e){$("#file-name").text(e.fileName),$("#home-coach").text(e.homeTeam.coachName),$("#home-team").text(e.homeTeam.teamName),$("#home-race").text(n(e.homeTeam.raceId)),$("#home-score").text(e.homeTeam.score),$("#away-coach").text(e.awayTeam.coachName),$("#away-team").text(e.awayTeam.teamName),$("#away-race").text(n(e.awayTeam.raceId)),$("#away-score").text(e.awayTeam.score),$("#stadium-name").text(e.stadiumName)}(e.gameDetails),$("#loading").hide(),$("#summary-div").show(),$("#results-div").show(),$("#explanation-div").show(),$("#share-massive-url").attr("href",r),$("#share-tiny-url").attr("href","http://tinyurl.com/create.php?url="+o+"#success"),$("#share-alert").show(),$(".other-stats").remove(),document.getElementById("results-with-padding").scrollIntoView()}function n(e){return 1===e?"Human":2===e?"Dwarf":3===e?"Skaven":4===e?"Orc":5===e?"Lizardman":6===e?"Goblin":7===e?"Wood Elf":8===e?"Chaos":9===e?"Dark Elf":10===e?"Undead":14===e?"Pro Elf":15===e?"High Elf":17===e?"Necromantic":21===e?"Chaos Dwarf":22===e?"Underworld":24===e?"Bretonnian":25===e?"Kislev":e}r&&($("#loading").show(),$("#data-param-error").hide(),google.setOnLoadCallback((function(){try{var e=LZString.decompressFromEncodedURIComponent(r);o(JSONC.decompress(JSON.parse(e)),r)}catch(e){$("#loading").hide(),$("#data-param-error").show(),console.error(e)}})))}();
//# sourceMappingURL=site.963945dd.js.map
