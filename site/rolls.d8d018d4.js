!function(){function e(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],0<=t.indexOf(n)||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],!(0<=t.indexOf(n))&&Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}function f(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function h(e){return e[Math.floor(Math.random()*e.length)]}var y=function(){function e(t){s(this,e),console.log(t),Object.assign(this,t)}return f(e,[{key:"value",value:function(){throw"value must be defined by subclass"}},{key:"simulateDice",value:function(){throw"simulateDice must be defined by subclass"}},{key:"simulated",value:function(e){return this.dataPoint(e,this.simulateDice(),"simulated")}},{key:"dataPoint",value:function(e,t,n){return{iteration:e,index:this.stepIndex.toString().padStart(3,"0")+"."+this.actionIndex+"."+this.resultIndex,team:this.playerTeam?this.playerTeamId+". "+this.playerTeam:this.activeTeamId+". "+this.activeTeam,outcomeValue:this.value(t),type:n,expectedValue:this.expectedValue}}},{key:"playerValue",value:function(){return 1/11}},{key:"knockdownValue",value:function(e){return activePlayer(e)?2*playerValue(e):playerValue(e)}},{key:"turnoverValue",value:function(){return unactivatedPlayers().map((function(e){return playerValue(e)})).reduce((function(e,t){return e+t}),0)}},{key:"expectedValue",get:function(){throw"expectedValue must be defined by subclass"}},{key:"actual",get:function(){return Object.assign(this.dataPoint(0,this.dice,"actual"),{turn:this.turn,player:this.playerName,playerSkills:this.playerSkills.map((function(e){return skillNames[e]})),rollName:this.constructor.rollName||this.rollName||this.rollType,dice:this.dice})}}],[{key:"argsFromXML",value:function(e,t,n,r,a,l){var i=this.currentPlayerData(t,r);return{stepIndex:e,actionIndex:n,resultIndex:a,team:this.activeTeamName(t),teamId:this.activeTeamId(t),turn:this.currentTurn(t),playerName:i.player.data.name,playerTeam:i.team.data.name,playerTeamId:i.teamId,playerSkills:this.translateStringNumberList(i.player.data.listskills),rollType:this.rollType(l),dice:this.dice(l)}}},{key:"valueTable",value:function(){throw"valueTable must be defined by subclass"}},{key:"ignore",value:function(){return!1}},{key:"dice",value:function(e){return this.translateStringNumberList(e.coachchoices.listdices)}},{key:"teamName",value:function(e,t){return e.boardstate.listteams.teamstate[t].data.name}},{key:"activeTeamName",value:function(e){return this.teamName(e,this.activeTeamId(e))}},{key:"activeTeamId",value:function(e){return e.boardstate.activeteam||0}},{key:"currentTurn",value:function(e){return e.boardstate.listteams.teamstate[this.activeTeamId(e)].gameturn||0}},{key:"currentPlayerData",value:function(e,t){for(var n=this.currentPlayer(t),r=e.boardstate.listteams.teamstate,a=0;a<r.length;a++){var l=r[a],i=!0,u=!1,o=void 0;try{for(var s,c,f=l.listpitchplayers.playerstate[Symbol.iterator]();!(i=(s=f.next()).done);i=!0)if((c=s.value).id===n)return{team:l,teamId:a,player:c,playerId:c.id}}catch(e){u=!0,o=e}finally{try{i||null==f.return||f.return()}finally{if(u)throw o}}}console.log("No player found",{replaystep:e,action:t})}},{key:"currentPlayer",value:function(e){return e.playerid}},{key:"rollType",value:function(e){return e.rolltype}},{key:"translateStringNumberList",value:function(e){if(!e)return[];for(var t=e.substring(1,e.length-1).split(","),n=[],r=0;r<t.length;r++)n.push(parseInt(t[r]));return n}},{key:"fromReplayStep",value:function(t,n){var r=n.ruleseventboardaction;if(r&&r.length){for(var a,l=[],i=0;i<r.length;i++)a=r[i],l=l.concat(e.fromAction(t,n,i,a));return l}return r?e.fromAction(t,n,0,r):[]}},{key:"fromAction",value:function(e,t,n,r){var a=r.results.boardactionresult;if(a&&a.length){for(var l=[],i=0;i<a.length;i++){var u,o=a[i];(u=this.fromBoardActionResult(e,t,n,r,i,o))&&l.push(u)}return l}if(a)return(u=this.fromBoardActionResult(e,t,n,r,0,a))?[u]:[];console.warn("Unexpectedly missing boardactionresult",{stepIndex:e,replaystep:t,action:r})}},{key:"fromBoardActionResult",value:function(e,t,n,r,a,l){if(void 0===l.rolltype)return null;if(void 0===l.coachchoices.listdices)return null;var i=B[l.rolltype];return null===i?null:i?i.ignore(t,r,l)?null:new i(i.argsFromXML(e,t,n,r,a,l)):(console.warn("Unknown roll "+l.rolltype,{stepIndex:e,replaystep:t,actionIndex:n,action:r,resultIndex:a,boardactionresult:l}),null)}}]),e}(),p=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),f(t,[{key:"value",value:function(e){var r=this;this.playerSkills;return Math.max.apply(Math,n(e.map((function(e){return t.dieValue(e,r.attacker,r.defender)}))))}},{key:"simulateDice",value:function(){return this.dice.map((function(){return h([ATTACKER_DOWN,BOTH_DOWN,PUSH,PUSH,DEFENDER_STUMBLES,DEFENDER_DOWN])}))}},{key:"expectedValue",get:function(){var e,t=this;return(e=1==this.dice.length?BLOCK.values.map((function(e){return t.value([e])})):TWO_DIE_BLOCK.values.map((function(e){return t.value(e)}))).reduce((function(e,t){return e+t}),0)/e.length}}],[{key:"dice",value:function(e){var n=a(l(t),"dice",this).call(this,e);return n.slice(0,n.length/2).map(t.asBlockDie)}},{key:"ignore",value:function(e,t,n){return 2!=n.resulttype||35==n.subresulttype}},{key:"asBlockDie",value:function(e){return 0===e?ATTACKER_DOWN:1===e?BOTH_DOWN:2===e?PUSH:3===e?DEFENDER_STUMBLES:4===e?DEFENDER_DOWN:void 0}},{key:"dieValue",value:function(e,t,n){var r=t.skills||[],a=n.skills||[];return e===ATTACKER_DOWN?-this.knockdownValue(t)-this.turnoverValue():e===BOTH_DOWN?r.includes(skills.Block)?a.includes(skills.Block)?0:this.knockdownValue(n):r.includes(skills.Wrestle)?this.knockdownValue(n)-this.knockdownValue(t):this.knockdownValue(n)-this.knockdownValue(t)-this.turnoverValue():e===PUSH?.25*this.knockdownValue(n):e===DEFENDER_STUMBLES?a.includes(skills.Dodge)?.25*this.knockdownValue(n):this.knockdownValue(n):e===DEFENDER_DOWN?this.knockdownValue(n):void 0}},{key:"valueTable",value:function(){var e;return o(e={},"".concat(this.rollName," - Attacker Down"),this.dieValue(ATTACKER_DOWN)),o(e,"".concat(this.rollName," - Both Down"),this.dieValue(BOTH_DOWN)),o(e,"".concat(this.rollName," - Both Down (Block vs None)"),this.dieValue(BOTH_DOWN,[skills.Block])),o(e,"".concat(this.rollName," - Both Down (Wrestle vs Anything)"),this.dieValue(BOTH_DOWN,[skills.Wrestle])),o(e,"".concat(this.rollName," - Both Down (Block vs Block)"),this.dieValue(BOTH_DOWN,[skills.Block],[skills.Block])),o(e,"".concat(this.rollName," - Both Down (None vs Block)"),this.dieValue(BOTH_DOWN,[],[skills.Block])),o(e,"".concat(this.rollName," - Push"),this.dieValue(PUSH)),o(e,"".concat(this.rollName," - Defender Stumbles"),this.dieValue(DEFENDER_STUMBLES)),o(e,"".concat(this.rollName," - Defender Down"),this.dieValue(DEFENDER_DOWN)),e}}]),t}(y);o(p,"rollName","Block");var d=function(t){function n(t){var a,i=t.target,u=t.modifier,o=e(t,["target","modifier"]);return s(this,n),(a=r(this,l(n).call(this,o))).target=i,a.modifier=u,a}return i(n,t),f(n,[{key:"value",value:function(e){return e.reduce((function(e,t){return e+t}),0)>=this.modifiedTarget?this.constructor.passValue:this.constructor.failValue}},{key:"simulateDice",value:function(){return this.dice.map((function(){return h([1,2,3,4,5,6])}))}},{key:"actual",get:function(){return Object.assign(a(l(n.prototype),"actual",this),{target:this.modifiedTarget})}},{key:"modifiedTarget",get:function(){return 1==this.dice.length?Math.min(6,Math.max(2,this.target-this.modifier)):this.target-this.modifier}},{key:"expectedValue",get:function(){for(var e,t=[0],n=0;n<this.dice.length;n++){e=[];for(var r=1;6>=r;r++){var a=!0,l=!1,i=void 0;try{for(var u,o,s=t[Symbol.iterator]();!(a=(u=s.next()).done);a=!0)o=u.value,e.push(o+r)}catch(e){l=!0,i=e}finally{try{a||null==s.return||s.return()}finally{if(l)throw i}}}t=e}for(var c=t.length,f=0,h=0,y=t;h<y.length;h++)f+=y[h]>=this.modifiedTarget?this.constructor.passValue/c:this.constructor.failValue/c;return f}}],[{key:"argsFromXML",value:function(e,t,r,i,u,o){var s=a(l(n),"argsFromXML",this).call(this,e,t,r,i,u,o);return s.modifier=function(e){return e&&e.length?e:[e]}(o.listmodifiers.dicemodifier||[]).map((function(e){return e.value})).reduce((function(e,t){return e+t}),0)||0,s.target=o.requirement,s}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Pass")]=this.passValue,e["".concat(this.rollName," - Fail")]=this.failValue,e}}]),n}(y),m=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(m,"rollName","Pickup"),o(m,"passValue",1),o(m,"failValue",-1);var v=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),f(t,null,[{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Break")]=this.passValue,e["".concat(this.rollName," - Save")]=this.failValue,e}}]),t}(d);o(v,"rollName","Armor"),o(v,"passValue",-1),o(v,"failValue",0);var k=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(k,"rollName","Wild Animal"),o(k,"passValue",0),o(k,"failValue",-1);var g=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(g,"rollName","Dauntless"),o(g,"passValue",1),o(g,"failValue",0);var b=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(b,"rollName","Dodge"),o(b,"passValue",1),o(b,"failValue",-1);var V=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(V,"rollName","Jump Up"),o(V,"passValue",1),o(V,"failValue",0);var N=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(N,"rollName","Pass"),o(N,"passValue",1),o(N,"failValue",-1);var D=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(D,"rollName","Interception"),o(D,"passValue",1),o(D,"failValue",0);var O=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(O,"rollName","Wake Up"),o(O,"passValue",1),o(O,"failValue",-1);var T=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(T,"rollName","GFI"),o(T,"passValue",0),o(T,"failValue",-1);var w=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),t}(d);o(w,"rollName","Catch"),o(w,"passValue",1),o(w,"failValue",-1);var S=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),f(t,[{key:"value",value:function(e){var t=e[0]+e[1];return this.constructor.injuryValue(t)}},{key:"simulateDice",value:function(){return this.dice.map((function(){return h([1,2,3,4,5,6])}))}},{key:"expectedValue",get:function(){for(var e=0,t=1;6>=t;t++)for(var n=1;6>=n;n++)e+=this.value([t,n]);return e/36}}],[{key:"injuryValue",value:function(e){return 7>=e?0:9>=e?-.5:-1}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Stun")]=this.injuryValue(7),e["".concat(this.rollName," - KO")]=this.injuryValue(9),e["".concat(this.rollName," - Casualty")]=this.injuryValue(12),e}}]),t}(y);o(S,"rollName","Injury");var E=function(e){function t(){return s(this,t),r(this,l(t).apply(this,arguments))}return i(t,e),f(t,[{key:"value",value:function(e){return this.constructor.casValue(e)}},{key:"simulateDice",value:function(){return 10*h([1,2,3,4,5,6])+h([1,2,3,4,5,6,7,8])}},{key:"expectedValue",get:function(){for(var e=0,t=1;6>=t;t++)for(var n=1;8>=n;n++)e+=this.value(10*t+n);return e/48}}],[{key:"dice",value:function(e){var n=a(l(t),"dice",this).call(this,e);return[(n=n.slice(0,n.length/2))[n.length-1]]}},{key:"casValue",value:function(e){return 4>e?0:50>e?-.5:60>e?-.75:-1}},{key:"valueTable",value:function(){var e={};return e["".concat(this.rollName," - Badly Hurt")]=this.casValue(35),e["".concat(this.rollName," - Miss Next game")]=this.casValue(45),e["".concat(this.rollName," - Stat Damage")]=this.casValue(55),e["".concat(this.rollName," - Dead")]=this.casValue(65),e}}]),t}(y);o(E,"rollName","Casualty");var B={1:T,2:b,3:v,4:S,5:p,7:m,8:E,9:w,10:null,11:null,12:N,13:null,14:null,16:D,17:O,22:k,26:null,29:g,31:V,58:null,59:v,60:S,63:null,70:null}}();
//# sourceMappingURL=rolls.d8d018d4.js.map
