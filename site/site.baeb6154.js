!function(){var e,a=parcelRequire("6ae74b041207656216232b2198e327ca"),t=parcelRequire("8016873058de1762abb55249d07ce983"),o={},r=t();Object.defineProperty(o,"__esModule",{value:!0}),e=void 0,o.replay=e,e={processReplay:function(e){var a=function(e){var a=e.replay.replaystep[0],t=e.replay.replaystep[e.replay.replaystep.length-1];return{stadiumName:a.gameinfos.namestadium,homeTeam:{coachName:a.gameinfos.coachesinfos.coachinfos[0].userid,teamName:a.boardstate.listteams.teamstate[0].data.name,raceId:a.boardstate.listteams.teamstate[0].data.idrace,score:t.ruleseventgamefinished.matchresult.row.homescore||0},awayTeam:{coachName:a.gameinfos.coachesinfos.coachinfos[1].userid,teamName:a.boardstate.listteams.teamstate[1].data.name,raceId:a.boardstate.listteams.teamstate[1].data.idrace,score:t.ruleseventgamefinished.matchresult.row.awayscore||0}}}(e);console.log("Extracted game details...",a);for(var t,o=[],l=0;l<e.replay.replaystep.length;l++)t=e.replay.replaystep[l],o=o.concat(r.Roll.fromReplayStep(l,t));return console.log("Extracted rolls...",o),{gameDetails:a,playerDetails:{},rolls:o,version:1}}},o.replay=e;t();var l=a();function i(e){return function(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}google.load("visualization","1.0",{packages:["corechart"]}),google.setOnLoadCallback((function(){$("#file-input-button").removeClass("disabled")}));var n=document.getElementById("file-input");n.addEventListener("change",(function(){0<n.files.length&&($("#loading").show(),$("#data-param-error").hide(),$("#summary-div").hide(),$("#results-div").hide(),$("#explanation-div").hide(),console.log("Preparing to parse XML..."),l.io.xmlToJson(n.files[0],(function(e){console.log("Preparing to process replay json...");var a=o.replay.processReplay(e);console.log("Preparing to render replay data..."),m(a,"")}),(function(e){$("#loading").hide(),alert(e)})))}));var c=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1])}("data");function m(e,a){var t="http://dicedornot.vengefulpickle.com/index.html?data="+a,o=encodeURIComponent(t);console.log("Rendering replay data..."),function(e){console.log(e);var a=i(new Set(e.map((function(e){return e.team}))));console.log(a);var t=[];t=t.concat(e.map((function(e){return e.actual}))),vegaEmbed("#chart",{$schema:"https://vega.github.io/schema/vega-lite/v4.json",width:1e3,height:300,data:{name:"rolls",values:t},transform:[{calculate:"datum.outcomeValue - datum.expectedValue",as:"netValue"},{window:[{op:"sum",field:"netValue",as:"cumNetValue"}],groupby:["team","iteration"]}],layer:[{transform:[{quantile:"cumNetValue",probs:[.01,.1,.25,.5,.75,.9,.99],groupby:["team","index"]},{calculate:"datum.prob * 100",as:"perc"}],mark:{type:"line",opacity:.3,interpolate:"basis"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"value",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"prob",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"value",title:"Cumulative Net Value",format:".2f"},{field:"perc",title:"Percentile",format:".0f"}]}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"line",interpolate:"monotone"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},detail:{field:"iteration",type:"nominal"}}},{transform:[{filter:"datum.type == 'actual'"}],mark:{type:"point"},encoding:{x:{type:"ordinal",field:"index"},y:{field:"cumNetValue",type:"quantitative"},color:{field:"team",type:"nominal"},tooltip:[{field:"team",title:"Team"},{field:"player",title:"Player"},{field:"playerSkills",title:"Player Skill"},{field:"rollName",title:"Roll"},{field:"dice",title:"Dice"},{field:"target",title:"Target"},{field:"outcomeValue",title:"Value",format:".2f"},{field:"expectedValue",title:"Expected Value",format:".2f"},{field:"netValue",title:"Net Value",format:".2f"},{field:"cumNetValue",title:"Cumulative Net Value",format:".2f"}]}}]}).then((function(a){var t=0;!function o(){for(var r=[],l=Math.max(t,1),i=0;i<l;i++)t++,r=r.concat(e.map((function(e){return e.simulated(t)})));var n=vega.changeset().insert(r);a.view.change("rolls",n).run(),$("#game-count").text(t),1e3>t&&window.setTimeout(o,100)}()}))}(e.rolls),function(e){$("#file-name").text(e.fileName),$("#home-coach").text(e.homeTeam.coachName),$("#home-team").text(e.homeTeam.teamName),$("#home-race").text(s(e.homeTeam.raceId)),$("#home-score").text(e.homeTeam.score),$("#away-coach").text(e.awayTeam.coachName),$("#away-team").text(e.awayTeam.teamName),$("#away-race").text(s(e.awayTeam.raceId)),$("#away-score").text(e.awayTeam.score),$("#stadium-name").text(e.stadiumName)}(e.gameDetails),$("#loading").hide(),$("#summary-div").show(),$("#results-div").show(),$("#explanation-div").show(),$("#share-massive-url").attr("href",t),$("#share-tiny-url").attr("href","http://tinyurl.com/create.php?url="+o+"#success"),$("#share-alert").show(),$(".other-stats").remove(),document.getElementById("results-with-padding").scrollIntoView()}function s(e){return 1===e?"Human":2===e?"Dwarf":3===e?"Skaven":4===e?"Orc":5===e?"Lizardman":6===e?"Goblin":7===e?"Wood Elf":8===e?"Chaos":9===e?"Dark Elf":10===e?"Undead":14===e?"Pro Elf":15===e?"High Elf":17===e?"Necromantic":21===e?"Chaos Dwarf":22===e?"Underworld":24===e?"Bretonnian":25===e?"Kislev":e}c&&($("#loading").show(),$("#data-param-error").hide(),google.setOnLoadCallback((function(){try{var e=LZString.decompressFromEncodedURIComponent(c);m(JSONC.decompress(JSON.parse(e)),c)}catch(e){$("#loading").hide(),$("#data-param-error").show(),console.error(e)}})))}();
//# sourceMappingURL=site.baeb6154.js.map
